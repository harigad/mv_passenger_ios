!function(){"use strict";function OneMVController($location,$scope,DivisionService,$rootScope,$interval,env,PageService,RedirectionService,$log){var vm=this;function activate(){DivisionService.getDivisionId()?DivisionService.getDivisionInfo().then(handleSuccess,handleFailure):handleFailure()}function handleSuccess(i){1===i.data.status&&setDivisionValues(i.data.result)}function handleFailure(i){$location.path("/division")}function getMajorAppVersion(i){var e=null;if(i){var n=i.split("v");n&&1<n.length&&(e=n[1])}else $log.error("App Version not setup correctly in DB.");return e}function getMajorSwVersion(i){var e=null;if(i){var n=i.split("sw");n&&1<n.length&&(e=n[1])}return e}function isANumber(i){return!isNaN(i)}function isMinVersion(division){var isMinVersion=!0;if(division.MinAppVersion){var dbAppVersions=division.MinAppVersion.split("."),currentVersions=env.ionic.appVersion.split("."),dbNo=1e4*getMajorAppVersion(dbAppVersions[0])+100*eval(dbAppVersions[1])+(dbAppVersions[2]?eval(dbAppVersions[2]):0),currentAppNo=1e4*getMajorAppVersion(currentVersions[0])+100*eval(currentVersions[1])+(currentVersions[2]?eval(currentVersions[2]):0);isMinVersion=dbNo<=currentAppNo}return isMinVersion}function setDivisionValues(i){var e={type:"checkMinAppVersion",data:i};try{console.dir(e),window.postMessage(JSON.stringify(e))}catch(i){console.log(i)}if(env.ionic&&!isMinVersion(i))return RedirectionService.redirectTo("/min-app-support"),!1;i.HasCustomSetup?vm.brand=i.DivisionID:vm.brand="base",vm.division=i.DivisionID,$rootScope.supportPhoneNumber=i.SupportPhoneNumber}vm.division="default",vm.PageService=PageService,vm.brand="base",env.ionic?vm.ionic=env.ionic:(vm.ionic={},vm.ionic.showMenu=!1),DivisionService.getDivisionId()&&activate(),$rootScope.$on("divisionChanged",activate)}angular.module("oneMVApp").controller("OneMVController",OneMVController),OneMVController.$inject=["$location","$scope","DivisionService","$rootScope","$interval","env","PageService","RedirectionService","$log"]}();
!function(){"use strict";function n(i){return{restrict:"A",replace:!0,link:function(t,c,n){t.$watch(n.dynamic,function(n){c.html(n),i(c.contents())(t)})}}}angular.module("oneMVApp").directive("dynamic",n),n.$inject=["$compile"]}();

!function(r){"use strict";angular.module("ngLoadScript",[]).directive("script",function(r,n,t){return{restrict:"E",terminal:!0,link:function(r,n,c){if(c.ngSrc){var i='<script src="'+c.ngSrc+'" async defer><\/script>';$(n).append(t(i)(r))}}}})}();
!function(){"use strict";function n(t,o){return{require:"ngModel",link:function(n,e,r,i){var u=function(){var n=e.val().replace(/[^0-9]/g,"");e.val(t("phonenumber")(n,!1))};i.$parsers.push(function(n){return n.replace(/[^0-9]/g,"")}),i.$render=function(){e.val(t("phonenumber")(i.$viewValue,!1))},e.bind("change",u),e.bind("keydown",function(n){var e=n.keyCode;91==e||15<e&&e<19||37<=e&&e<=40||o.defer(u)}),e.bind("paste cut",function(){o.defer(u)})}}}angular.module("oneMVApp").directive("phonenumberDirective",n).filter("phonenumber",function(){return function(n){if(!n)return"";var e=n=String(n),r="1"==n[0]?"1 ":"",i=(n="1"==n[0]?n.slice(1):n).substring(0,3),u=n.substring(3,6),t=n.substring(6,10);return u&&(e=r+"("+i+") "+u),t&&(e+="-"+t),e}}),n.$inject=["$filter","$browser"]}();
!function(){"use strict";function e(i,o,n){var r,t,u,e={getOneMVApiURL:function(){return(void 0).ApiURLs.OneMVApiURL},getOneMVApiURLPromise:s,resetUserAndDivision:function(){t=r=null},getCurrentUser:function(){_url="../Operation/GetCurrentUserDetails?rnd="+(new Date).getTime();var n=o.defer();r?n.resolve(r):i({method:"GET",url:_url}).then(function(e){r=e.data,t||(t={}),t=r.Divisions[0],r.CurrentLogin&&r.CurrentLogin.Division&&(t=r.CurrentLogin.Division),n.resolve(r)},function(e){n.reject(e)});return n.promise},getCurrentDivision:function(){var e="../Operation/GetCurrentUserDetails?rnd="+(new Date).getTime(),n=o.defer();t?n.resolve(t):i({method:"GET",url:e}).then(function(e){r=e.data,t||(t={}),t=r.Divisions[0],r.CurrentLogin&&r.CurrentLogin.Division&&(t=r.CurrentLogin.Division),n.resolve(t)},function(e){n.reject(e)});return n.promise},getCurrentDivisionTime:function(){var n=o.defer(),e="../Operation/GetCurrentDivisionTime?rnd="+(new Date).getTime();return i({method:"GET",url:e}).then(function(e){u=e.data,n.resolve(u)},function(e){n.reject(u)}),n.promise},getDivisionParameters:function(r){var t=o.defer();return s().then(function(e){if(e&&""!=e){var n=e+"division/"+r+"/systemParameters?appType=desktop&rnd="+(new Date).getTime();i({method:"GET",url:n}).then(function(e){1==e.data.status?t.resolve(e.data.result):t.reject(e.data.result)},function(e){t.reject(e)})}}),t.promise}};function s(){var e=o.defer();return e.resolve(n.oneMVApiUrl),e.promise}return s(),e}angular.module("oneMVApp").factory("ConfigFactory",e),e.$inject=["$http","$q","env"]}();
!function(){"use strict";function e(e,t,o){return{validateZipCode:function(e,n){var a;return o({method:"GET",url:"//maps.googleapis.com/maps/api/geocode/json?address="+e+"&sensor=true",withCredentials:!1}).then(function(e){if(null!=e.data){var t=e.data.results[0].address_components;a=t[t.length-2].short_name,t[t.length-2].long_name}return""!=a?n.stateabbr=a:""},function(e){return"N/A"})},validateZipCodeNew:function(e){return t="//maps.googleapis.com/maps/api/geocode/json?address="+e+"&sensor=true",o({url:t,method:"GET",withCredentials:!1});var t}}}angular.module("oneMVApp").factory("DataValidationFactory",e),e.$inject=["$log","$window","$http"]}();
!function(){"use strict";function e(i,e,m){return{getCustomTime:o,getDateFromCustomTime:function(e,t){var n,a,r,o=m.timeDifference;r=t._isAMomentObject?t.startOf("day"):t.setHours(0,0,0);"string"==typeof e&&(-1==e.indexOf(":")?(a=60*parseInt(e[0]+e[1])+parseInt(e[2]+e[3]),o&&(a+=o)):2==e.indexOf(":")&&(a=60*parseInt(e[0]+e[1])+parseInt(e[3]+e[4]),o&&(a+=o)));a?n=moment(r).add(a,"m"):(i.error("getDateFromCustomTime: Time is invalid!, Cannot calulate actual time"),i.log("error details","getDateFromCustomTime customTime: "+e),i.log("error details","getDateFromCustomTime serviceDate: "+r));return n},getPreviousDate:function(e){null==e&&(e=new Date);return e.setDate(e.getDate()-1),e},getTimeDifference:function(e){var t=new Date,n=new Date(Date.parse(e)),a=t-n;a=Math.abs(a/1e3/60)<1?0:a<0?Math.floor(a/1e3/60):Math.ceil(a/1e3/60);0<Math.abs(a)%10&&(a<0?(Math.abs(a)%10==1&&(a+=1),Math.abs(a)%10==9&&(a-=1)):(Math.abs(a)%10==1&&(a-=1),Math.abs(a)%10==9&&(a+=1)));return a},isDayLightsavingOn:function(){var e=new Date,t=new Date(e.getFullYear(),0,1),n=new Date(e.getFullYear(),6,1),a=Math.max(t.getTimezoneOffset(),n.getTimezoneOffset());return e.getTimezoneOffset()<a},getMinutesFromTimeString:function(e){var t=0;if("string"==typeof e)return-1==e.indexOf(":")?t=60*parseInt(e[0]+e[1])+parseInt(e[2]+e[3]):2==e.indexOf(":")&&(t=60*parseInt(e[0]+e[1])+parseInt(e[3]+e[4])),t},getPromiseWindowTimeDisplay:function(e,t,n){var a=o(e,n),r=moment(e).add(t,"minutes");return a+"-"+o(r,n)},getPromiseWindowEndTime:function(e,t){return moment(e).add("m",t).format()}};function o(e,t){var n="";try{if(e&&t){var a=moment(e).hours();if(moment(e).date()!=moment(t).date())a+=24*moment(e).diff(moment(t),"days");a<0&&-10<a&&(a="-0"+-1*a),a<10&&(a="0"+a),n=a+":"+moment(e).format("mm")}}catch(e){console.log(e)}return n}}angular.module("oneMVApp").factory("DateFactory",e),e.$inject=["$log","UtilityFactory","$rootScope"]}();
!function(){"use strict";function t(r,d,c,t){var u=[],p=[],f="",l="";return{setadd:function(t){f=t},getLocations:function(a,t,o,e,n){var i=d.defer(),s=[];1==n||"true"==n?r.get("https://maps.googleapis.com/maps/api/geocode/json",{params:{address:a+" "+f,sensor:!0,key:"AIzaSyCztqRTaQzgBxu0DMV9cDKq0IciqMaQI5E"},withCredentials:!1,skipAuthorization:!0}).then(function(t){for(var e in p=t.data.results)M(p[e])&&s.push({address:p[e].formatted_address,isGoogleLocation:!0,loc:p[e],description:p[e].Name,title:p[e].formatted_address});i.resolve({data:s})}):(c.getOneMVApiURLPromise().then(function(t){if(t&&""!=t){var e=t+"location/"+o+"/?SearchTerm="+a;r.get(e).then(function(t){for(var e in u=t.data.result)s.push({name:u[e].Name,address:u[e].Address+(m(u[e].City)?" ":", "+u[e].City)+(m(u[e].Zip)?"":", "+u[e].Zip),isGoogleLocation:!1,loc:u[e],title:h(u,e),description:u[e].Address+(m(u[e].City)?" ":", "+u[e].City)+(m(u[e].Zip)?"":", "+u[e].Zip)});if(0==l||"false"==l)return i.resolve({data:s}),i.promise;1!=l&&"true"!=l||r.get("https://maps.googleapis.com/maps/api/geocode/json",{params:{address:a+" "+f,sensor:!0,key:"AIzaSyCztqRTaQzgBxu0DMV9cDKq0IciqMaQI5E"},withCredentials:!1,skipAuthorization:!0}).then(function(t){for(var e in p=t.data.results)M(p[e])&&s.push({address:p[e].formatted_address,isGoogleLocation:!0,loc:p[e],description:p[e].Name,title:p[e].formatted_address});i.resolve({data:s})},function(t){i.reject(t)})},function(t){i.reject(t)})}},function(t){}),l=t);return i.promise},findClosestLocation:function(t,e){for(var a=0;a<e.length;a++)e[a].distance=(o=t,n=e[a].loc,void 0,i={Latitude:o.Latitude,Longitude:n.Longitude},s=parseFloat(g(o,i)),r=parseFloat(g(i,n)),(s+r).toFixed(2));var o,n,i,s,r;return e.sort(function(t,e){return t.distance-e.distance}),e[0]}};function h(t,e){var a="";return e&&(t[e].Name&&(a=t[e].Name.toUpperCase()),t[e].AliasNames&&(a=a+" ("+t[e].AliasNames+")")),a}function m(t){return!(!angular.isUndefined(t)&&null!==t&&""!=t)}function g(t,e){var a=t.Latitude,o=t.Longitude,n=e.Latitude,i=e.Longitude,s=(n-a)*Math.PI/180,r=(i-o)*Math.PI/180,d=Math.sin(s/2)*Math.sin(s/2)+Math.cos(a*Math.PI/180)*Math.cos(n*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2);return(6371*(2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)))*.62137).toFixed(2)}function M(t){for(var e in t.address_components)if("street_number"==t.address_components[e].types[0])return!0;return!1}}angular.module("oneMVApp").factory("LocationFactory",t),t.$inject=["$http","$q","ConfigFactory","authService"]}();
!function(){"use strict";function e(e,r,s,t){var i={},o=s("PermissionsCache");return{getPermissions:function(e,s){var n=r.defer();(i=o.get("permissions"))?n.resolve(i):t.getPermissions(e,s).then(function(e){o.put("permissions",e),n.resolve(e)});return n.promise},getLoadedPermissions:function(){return o.get("permissions")},setupSession:function(e,s){return t.setupSession(e,s)}}}angular.module("oneMVApp").factory("SecurityFactory",e),e.$inject=["$http","$q","$cacheFactory","securityService"]}();
!function(){"use strict";function a(e,o){var a,i,n={getData:function(a){return i[a]},setData:function(a,n){i[a]=n},getAPIBaseUrl:function(){return a},toastError:function(a,n,i){i=i||1e3,toastr.error(n,a,{timeOut:i}),e.error("Error: - "+a+"  - "+n,"")},toastInfo:function(a,n,i){i=i||1e3,toastr.info(n,a,{timeOut:i})},toastSuccess:function(a,n){toastr.success(n,a),e.debug("Success: - "+a+"  - "+n,"")},toastWarning:function(a,n){toastr.warning(n,a),e.warn("Warning: - "+a+"  - "+n,"")},logError:function(a,n){e.error("Error:"+a,n)},logInfo:function(a,n){e.info("Info:"+a,n)},logSuccess:function(a,n){e.debug("Success:"+a,n)},logWarning:function(a,n){e.warn("Warning:"+a,n)},log:e.log,getUsStates:function(){return n.usStates},getBrowserInfo:function(){var a=o.navigator.userAgent,n={chrome:/chrome/i,safari:/safari/i,firefox:/firefox/i,ie:/internet explorer/i};for(var i in n)if(n[i].test(a))return i;return"unknown"},isChrome:function(){return!!window.chrome&&!!window.chrome.webstore},isIE:function(){return!!document.documentMode},isFirefox:function(){return"undefined"!=typeof InstallTrigger},isSafari:function(){return 0<Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")},usStates:[{name:"Alabama",abbreviation:"AL"},{name:"Alaska",abbreviation:"AK"},{name:"American Samoa",abbreviation:"AS"},{name:"Arizona",abbreviation:"AZ"},{name:"Arkansas",abbreviation:"AR"},{name:"California",abbreviation:"CA"},{name:"Colorado",abbreviation:"CO"},{name:"Connecticut",abbreviation:"CT"},{name:"Delaware",abbreviation:"DE"},{name:"District Of Columbia",abbreviation:"DC"},{name:"Federated States Of Micronesia",abbreviation:"FM"},{name:"Florida",abbreviation:"FL"},{name:"Georgia",abbreviation:"GA"},{name:"Guam",abbreviation:"GU"},{name:"Hawaii",abbreviation:"HI"},{name:"Idaho",abbreviation:"ID"},{name:"Illinois",abbreviation:"IL"},{name:"Indiana",abbreviation:"IN"},{name:"Iowa",abbreviation:"IA"},{name:"Kansas",abbreviation:"KS"},{name:"Kentucky",abbreviation:"KY"},{name:"Louisiana",abbreviation:"LA"},{name:"Maine",abbreviation:"ME"},{name:"Marshall Islands",abbreviation:"MH"},{name:"Maryland",abbreviation:"MD"},{name:"Massachusetts",abbreviation:"MA"},{name:"Michigan",abbreviation:"MI"},{name:"Minnesota",abbreviation:"MN"},{name:"Mississippi",abbreviation:"MS"},{name:"Missouri",abbreviation:"MO"},{name:"Montana",abbreviation:"MT"},{name:"Nebraska",abbreviation:"NE"},{name:"Nevada",abbreviation:"NV"},{name:"New Hampshire",abbreviation:"NH"},{name:"New Jersey",abbreviation:"NJ"},{name:"New Mexico",abbreviation:"NM"},{name:"New York",abbreviation:"NY"},{name:"North Carolina",abbreviation:"NC"},{name:"North Dakota",abbreviation:"ND"},{name:"Northern Mariana Islands",abbreviation:"MP"},{name:"Ohio",abbreviation:"OH"},{name:"Oklahoma",abbreviation:"OK"},{name:"Oregon",abbreviation:"OR"},{name:"Palau",abbreviation:"PW"},{name:"Pennsylvania",abbreviation:"PA"},{name:"Puerto Rico",abbreviation:"PR"},{name:"Rhode Island",abbreviation:"RI"},{name:"South Carolina",abbreviation:"SC"},{name:"South Dakota",abbreviation:"SD"},{name:"Tennessee",abbreviation:"TN"},{name:"Texas",abbreviation:"TX"},{name:"Utah",abbreviation:"UT"},{name:"Vermont",abbreviation:"VT"},{name:"Virgin Islands",abbreviation:"VI"},{name:"Virginia",abbreviation:"VA"},{name:"Washington",abbreviation:"WA"},{name:"West Virginia",abbreviation:"WV"},{name:"Wisconsin",abbreviation:"WI"},{name:"Wyoming",abbreviation:"WY"}]};return n}angular.module("oneMVApp").factory("UtilityFactory",a),a.$inject=["$log","$window"]}();
!function(){"use strict";function t(r,o,a,n,i){var t={};return t.request=function(t){if(t.headers=t.headers||{},!t.url.includes("https://maps.googleapis.com")){var e=i.get("authorizationData");e&&(t.headers.Authorization="Bearer "+e.token)}return t},t.responseError=function(t){if(401===t.status){var e=o.get("authService");i.get("authorizationData"),e.logOut().then(function(){n.$broadcast("loggedout",null),a.path("/login")})}return r.reject(t)},t}angular.module("oneMVApp").factory("authInterceptorService",t),t.$inject=["$q","$injector","$location","$rootScope","localStorageService"]}();
!function(){"use strict";function e(e,o,n,t,s){var i=s.authServerUrl,r={},a={isAuth:!1,passengerId:"",userId:"",useRefreshTokens:!1};e.$on("loggedIn",function(e){console.log("loggedIn",e);var r={type:"register_push"};r.alias=localStorage.getItem("ls.alias"),r.division=localStorage.getItem("ls.division");var s=localStorage.getItem("ls.authorizationData");try{var o=JSON.parse(s);r.passengerId=o.passengerId,window.postMessage(JSON.stringify(r))}catch(e){console.log("error calling push registration")}});var u=function(){var r=n.defer();return o.post(s.authServerUrl+"account/signout",{}).then(function(e){t.remove("authorizationData"),a.isAuth=!1,a.passengerId="",a.useRefreshTokens=!1,a.userId="",a.loginProvider="",r.resolve(e)},function(e){console.log("Unable to logout user."),r.reject(e)}),r.promise};return r.saveRegistration=function(e){return u(),o.post(i+"account/register",e).then(function(e){return e})},r.login=function(r){var e="grant_type=password&username="+r.userName+"&password="+r.password;r.useRefreshTokens&&(e+="&client_id=mobiWeb");var s=n.defer();return o.post(i+"token",e,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){r.useRefreshTokens?t.set("authorizationData",{token:e.access_token,userName:r.userName,refreshToken:e.refresh_token,useRefreshTokens:!0}):t.set("authorizationData",{token:e.access_token,userName:r.userName,refreshToken:"",useRefreshTokens:!1}),a.isAuth=!0,a.userName=r.userName,a.useRefreshTokens=r.useRefreshTokens,s.resolve(e)}).error(function(e,r){u(),s.reject(e)}),s.promise},r.logOut=u,r.fillAuthData=function(){var e=t.get("authorizationData");e&&(a.isAuth=!0,a.useRefreshTokens=e.useRefreshTokens,a.userId=e.userId,a.passengerId=e.passengerId,a.loginProvider=e.loginProvider)},r.authentication=a,r.refreshToken=function(){var s=n.defer(),e=t.get("authorizationData");if(e&&e.useRefreshTokens){var r="grant_type=refresh_token&refresh_token="+e.refreshToken+"&client_id="+ngAuthSettings.clientId;t.remove("authorizationData"),o.post(i+"token",r,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){t.set("authorizationData",{token:e.access_token,refreshToken:e.refresh_token,useRefreshTokens:!0,loginProvider:e.loginProvider}),s.resolve(e)}).error(function(e,r){u(),s.reject(e)})}return s.promise},r.obtainAccessToken=function(e){var s=n.defer();return o.get(i+"account/ObtainLocalAccessToken",{params:{provider:e.provider,externalAccessToken:e.externalAccessToken,divisionId:e.divisionId,userName:e.userName}}).success(function(e){t.set("authorizationData",{token:e.access_token,refreshToken:"",useRefreshTokens:!1,userId:e.userId,passengerId:e.passengerId,loginProvider:e.loginProvider}),a.isAuth=!0,a.useRefreshTokens=!1,a.userId=e.userId,a.passengerId=e.passengerId,a.loginProvider=e.loginProvider,s.resolve(e)}).error(function(e,r){u(),s.reject(e)}),s.promise},r.externalAuthData={provider:"",userName:"",externalAccessToken:"",firstName:"",lastName:""},r.registerExternal=function(e){var s=n.defer();return o.post(i+"account/registerexternal",e).success(function(e){t.set("authorizationData",{token:e.access_token,refreshToken:"",useRefreshTokens:!1,userId:e.userId,passengerId:e.passengerId,loginProvider:e.loginProvider}),a.isAuth=!0,a.userId=e.userId,a.useRefreshTokens=!1,a.passengerId=e.passengerId,a.loginProvider=e.loginProvider,s.resolve(e)}).error(function(e,r){u(),s.reject(e)}),s.promise},r.isLoggedIn=function(){var e=t.get("authorizationData");return!(!e||""===e.userId)},r.loginOneMV=function(e){var s=n.defer();return o.post(i+"account/LoginOneMv",e).success(function(e){t.set("authorizationData",{token:e.access_token,refreshToken:"",useRefreshTokens:!1,userId:e.userId,passengerId:e.passengerId,loginProvider:e.loginProvider}),a.isAuth=!0,a.userId=e.userId,a.useRefreshTokens=!1,a.passengerId=e.passengerId,a.loginProvider=e.loginProvider,s.resolve(e)}).error(function(e,r){u(),s.reject(e)}),s.promise},r.registerOneMV=function(e){var s=n.defer();return o.post(i+"account/Register",e).success(function(e){t.set("authorizationData",{token:e.access_token,refreshToken:"",useRefreshTokens:!1,userId:e.userId,passengerId:e.passengerId,loginProvider:e.loginProvider}),a.isAuth=!0,a.userId=e.userId,a.useRefreshTokens=!1,a.passengerId=e.passengerId,a.loginProvider=e.loginProvider,s.resolve(e)}).error(function(e,r){u(),s.reject(e)}),s.promise},r.verifyCaptcha=function(e){var s=n.defer();return o.post(i+"account/VerifyCaptcha",'"'+e+'"').success(function(e){s.resolve(e)}).error(function(e,r){s.reject(e)}),s.promise},r.checkUserHasRegistered=function(e){var s=n.defer();return o.get(i+"account/CheckUserHasRegistered",{params:{provider:e.provider,providerKey:e.providerKey,divisionId:e.divisionId,userName:e.userName,divisionSupportsFeed:e.divisionSupportsFeed}}).success(function(e){s.resolve(e)}).error(function(e,r){s.reject(e)}),s.promise},r}angular.module("oneMVApp").factory("authService",e),e.$inject=["$rootScope","$http","$q","localStorageService","env"]}();
!function(){"use strict";function e(e,n,t){var r=t.oneMVApiUrl;return{GetAllStates:function(){var t=n.defer();return e({method:"GET",url:r+"common/GetAllStates?rnd="+(new Date).getTime()}).then(function(e){200==e.status?t.resolve(e.data.result):t.reject(e)},function(e){t.reject(e)}),t.promise},GetStatesWithDivisions:function(){var t=n.defer();return e({method:"GET",url:r+"common/GetStatesWithDivisions?rnd="+(new Date).getTime()}).then(function(e){200==e.status?t.resolve(e.data.result):t.reject(e)},function(e){t.reject(e)}),t.promise},ScheduleType:Object.freeze({Morning:"AM",Evening:"PM"})}}angular.module("oneMVApp").factory("CommonService",e),e.$inject=["$http","$q","env"]}();
!function(){"use strict";function t(r,t,e){return{contactDriver:function(n){var a=t.defer();return e.getOneMVApiURLPromise().then(function(t){if(t&&""!=t){var e=t+"communications/contactdriver/"+n+"?rnd="+(new Date).getTime();r({method:"GET",url:e}).then(function(t){t&&t.data&&t.data.status&&(1==t.data.status||2==t.data.status)?a.resolve(t.data):a.reject(t)},function(t){a.reject(t)})}}),a.promise}}}angular.module("oneMVApp").factory("CommunicationsService",t),t.$inject=["$http","$q","ConfigFactory"]}();

!function(){"use strict";function e(r,n,u,c,d,v){return{setDivision:function(i){var a=n.defer();return r({method:"GET",url:d.oneMVApiUrl+"division/v1?alias="+i}).then(function(n){if(1==n.data.status&&n.data.result){var s=(e=i,t=m(),!(!angular.isUndefined(t)&&null!==t&&""!==t.trim())||e.toLowerCase()!==t.toLowerCase()),o=n.data.result;r({method:"GET",url:d.oneMVApiUrl+"/division/"+o.DivisionID+"/systemParameters?appType=Desktop"}).then(function(e){if(200==e.status){for(var t in o.SystemParameters=e.data.result,o.SystemParameters){var i=o.SystemParameters[t];null!=i&&("true"==(i=i.toLowerCase())?o.SystemParameters[t]=!0:"false"==i&&(o.SystemParameters[t]=!1))}!function(e){if(c.set("division",e.DivisionID),c.set("timeZone",e.TimeZone),null==e.CommuterDivisionId){var t="",i=e.DivisionID;switch(i){case"206":t="206";break;case"1001":t="1001.1";break;case"1002":t="1002.1";break;case"1003":t="1003.1";break;case"1004":t="1004.1";break;case"1005":t="1005.1";break;default:t="-999"}e.CommuterDivisionId=t}c.set("cid",e.CommuterDivisionId),c.set("supportPhoneNumber",e.SupportPhoneNumber),c.set("alias",e.Alias),c.set("systemParameters",e.SystemParameters)}(o),l(n),r=s,v.isLoggedIn()&&r?v.logOut().then(function(){u.$broadcast("divisionChanged")}):r&&u.$broadcast("divisionChanged"),a.resolve(n)}else a.reject("division not found");var r},function(e){a.reject("division not found")})}else a.reject("division not found");var e,t},function(e){a.reject("division not found")}),a.promise},getDivisionInfo:function(){var t=n.defer();return r({method:"GET",url:d.oneMVApiUrl+"division/"+e()}).then(function(e){1==e.data.status&&e.data.result?(l(e),t.resolve(e)):t.reject()},function(e){t.reject()}),t.promise},getDivisions:function(){var t=n.defer();return r({method:"GET",url:d.oneMVApiUrl+"division/all/v1"}).then(function(e){1==e.data.status&&e.data.result?t.resolve(e):t.reject()},function(e){t.reject()}),t.promise},getDivisionId:e,getTimeZone:function(){return c.get("timeZone")},getAllowedServices:function(){return c.get("serviceInfo")},getDivisionAlias:m,getSupportPhoneNumber:function(){return c.get("supportPhoneNumber")},getSystemParameters:function(){return c.get("systemParameters")},getServiceDateByDivisionTime:function(e,t){var i=n.defer();return r({method:"GET",url:d.oneMVApiUrl+"division/"+e+"/"+t+"/serviceDateByDivisionTime?rnd="+(new Date).getTime()}).then(function(e){1==e.data.status&&e.data.result?i.resolve(e):i.reject()},function(e){i.reject()}),i.promise},getCurrentDivisionTime:function(){var t=n.defer();return r({method:"GET",url:d.oneMVApiOrgUrl+"division/"+e()+"/currentTime?rnd="+(new Date).getTime()}).then(function(e){1==e.data.status&&e.data.result?t.resolve(e):t.reject()},function(e){t.reject()}),t.promise},getDivisionByState:function(e){var t=n.defer();return r({method:"GET",url:d.oneMVApiUrl+"division/GetDivisionsByState/"+e+"?rnd="+(new Date).getTime()}).then(function(e){1==e.data.status&&e.data.result?t.resolve(e):t.reject()},function(e){t.reject()}),t.promise},getDivisionsByLocation:function(e,t){var i=n.defer();return r({method:"GET",url:d.oneMVApiUrl+"division/"+e+"/"+t+"/GetClosestDivisions?rnd="+(new Date).getTime()}).then(function(e){1==e.data.status&&e.data.result?i.resolve(e):i.reject()},function(e){i.reject()}),i.promise},isWaitlistAllowedByDivision:function(){var t=n.defer();return r({method:"GET",url:d.oneMVApiOrgUrl+"division/"+e()+"/systemParameters/allowcommuterwaitlist?rnd="+(new Date).getTime()}).then(function(e){1==e.data.status&&e.data.result?t.resolve("true"==e.data.result):t.reject(!1)},function(e){t.reject(!1)}),t.promise}};function l(e){for(var t=[],i=0;i<e.data.result.DivisionServices.length;i++){var r=e.data.result.DivisionServices[i].Service;t.push({id:r.Id,name:r.Name,alias:e.data.result.DivisionServices[i].Alias||r.Name})}c.set("serviceInfo",t)}function e(){return c.get("division")}function m(){return c.get("alias")}}angular.module("oneMVApp").factory("DivisionService",e),e.$inject=["$http","$q","$rootScope","localStorageService","env","authService"]}();
!function(){"use strict";function e(r,o,i,u){return{getWhatsNewData:function(){var t=o.defer(),e=i.oneMVApiOrgUrl+"whatsNew/GetCurrentWhatsNewList/"+u.getDivisionId();return r({method:"GET",url:e}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},getData:function(e){var t=o.defer(),n=i.commuterApiUrl+"common/"+u.getDivisionId()+"/dynamic/"+e;return r({method:"GET",url:n}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},getSupportFAQ:function(){var t=o.defer(),e=i.oneMVApiUrl+"common/"+u.getDivisionId()+"/supportFAQ";return r({method:"GET",url:e}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise}}}angular.module("oneMVApp").factory("DynamicContentService",e),e.$inject=["$http","$q","env","DivisionService"]}();
!function(){"use strict";function e(a,e,n,i){return{getCurrentPosition:function(){var o=e.defer();if(n.navigator.geolocation){var t=i(function(){o.reject("User cancelled")},1e4);n.navigator.geolocation.getCurrentPosition(function(e){a.$broadcast("GeoLocationService.gpsIsAvailable",{gpsIsEnabled:!0,lastPosition:e,timestamp:new Date}),i.cancel(t),o.resolve(e)},function(e){a.$broadcast("GeoLocationService.gpsIsAvailable",{gpsIsEnabled:!1,lastPosition:{},timestamp:new Date}),i.cancel(t),o.reject(e)},{maximumAge:0,enableHighAccuracy:!0})}else a.$broadcast("GeoLocationService.gpsIsAvailable",{gpsIsEnabled:!1,lastPosition:{},timestamp:new Date}),o.reject("Geolocation not supported");return o.promise}}}angular.module("oneMVApp").factory("GeoLocationService",e),e.$inject=["$rootScope","$q","$window","$timeout"]}();
!function(){"use strict";function e(o,i,u){return{authenticate:function(e,t){var n=i.defer(),r=u.commuterApiUrl+"account/ExternalLogin?provider="+e+"&returnUrl="+t;return o({method:"POST",url:r,headers:{"Content-Type":"text/plain"},data:{}}).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise}}}angular.module("oneMVApp").factory("LoginService",e),e.$inject=["$http","$q","env"]}();
!function(){"use strict";function e(a,o,s,i,r,l){return{verify:function(e){var t=s.oneMVApiOrgUrl+"passenger/luumLinkage/"+e;return a({method:"GET",url:t+"?rnd="+(new Date).getTime()}).then(function(n){if(n&&1==n.data.status&&n.data.result&&n.data.result.verify&&!n.data.result.isLinkedToLuum){var e=n.data.result.message;r.open({template:'<div class="modal-header" ><h3 class="modal-title">OneMV-LUUM Integration Info</h3> </div><div class="modal-body"><p>'+e+'</p></div><div class="modal-footer"><button class="btn btn-warning" type="button" ng-click="close()">OK</button> </div>',replace:!0,controller:function(e,t){e.close=function(){if(t.close(),n.data.result.disableCommuterNavigation){var e=l.path();(-1<e.indexOf("/commuter/selected-stop")||-1<e.indexOf("/passenger-trips")||-1<e.indexOf("/commuter/adv-schedule-setup")||-1<e.indexOf("/commuter/my-vehicles"))&&(i.passengerNotified=!0,l.replace().path("dashboard/"))}}},backdrop:"static",keyboard:!1})}},function(e){})},getNewPassengerLuumLinkageInfo:function(e){var t=o.defer(),n=s.oneMVApiOrgUrl+"division/"+e+"/newPassengerMessage";return a({method:"GET",url:n}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},displayNewPassengerMessage:function(e){r.open({template:'<div class="modal-header" ><h3 class="modal-title">OneMV-LUUM Integration Info</h3> </div><div class="modal-body"><p>'+e+'</p></div><div class="modal-footer"><button class="btn btn-warning" type="button" ng-click="close()">OK</button> </div>',replace:!0,controller:function(e,t){e.close=function(){t.close(),l.replace().path("dashboard/")}},backdrop:"static",keyboard:!1})}}}angular.module("oneMVApp").factory("LuumLinkedService",e),e.$inject=["$http","$q","env","$rootScope","$uibModal","$location"]}();
!function(){"use strict";function n(n){return{getCommuterStopIcon:function(){return n.isIE()?"images/pin-busstop-green.png":"images/pin-busstop-green.svg"},getCommuterHubIcon:function(){return n.isIE()?"images/pin-hub.png":"images/pin-hub.svg"},getDrtPickupIcon:function(){return"images/default/i-drt-pin-b.png"},getDrtDropoffIcon:function(){return"images/default/i-drt-pin-g.png"}}}angular.module("oneMVApp").factory("MapIconService",n),n.$inject=["PortalUtilityService"]}();
!function(){"use strict";function n(n,t,o){var i=void 0;return{setMapBounds:function(n,t){if(angular.isUndefined(i)||angular.isUndefined(n)||0==n.length)return;var o=new google.maps.LatLngBounds;angular.forEach(n,function(n){o.extend({lat:n.latitude,lng:n.longitude})}),t&&(i.markerEvent=(e=t,a={},angular.forEach(e,function(e){e.event&&"function"==typeof e.callback&&(a[e.event]=function(n,t,o){o.$id&&e.callback(o)})}),a));var e,a;i.control.getGMap().fitBounds(o),i.control.getGMap().setZoom(i.control.getGMap().getZoom()-1)},initializeMap:function(){return i={center:{latitude:47.6216026,longitude:-122.342862},zoom:15,mapOptions:{mapTypeControl:!1,zoomControl:!1,streetViewControl:!1,styles:o.mapStyles},control:{}}}}}angular.module("oneMVApp").factory("MapService",n),n.$inject=["$timeout","uiGmapIsReady","googleMapsConfig"]}();
!function(){"use strict";function t(i,l,s){return{info:function(t,o){var n='<div class="modal__content">\t\t\t\t<div class="modal__header">\t\t\t\t\t<h4 class="modal-title">'+t+'</h4>\t\t\t\t</div>\t\t\t\t<div class="modal__body">\t\t\t\t\t<p>'+o+'</p>\t\t\t\t\t<button type="button" ng-click="ok()" class="btn btn--primary">Ok</button>\t\t\t\t</div>\t\t\t</div>',e=i.defer();l.open({backdrop:!1,template:n,size:"-fs",controller:function(t){t.ok=function(){s.dismissAll()}}}).closed.then(function(){e.resolve()});return e.promise}}}angular.module("oneMVApp").factory("MessageBox",t),t.$inject=["$q","$uibModal","$uibModalStack"]}();
!function(){"use strict";function e(r){return{getCommuterInfo:function(){return e("commuter")},getFixedRouteInfo:function(){return e("fixed")},getDrtInfo:function(){return e("drt")}};function e(e){for(var n=r.getAllowedServices()||[],t=0;t<n.length;t++)if(n[t].name.toLowerCase()==e.toLowerCase())return n[t]}}angular.module("oneMVApp").factory("OneMvServices",e),e.$inject=["DivisionService"]}();
!function(){"use strict";function n(){var t="",e="",u="";return{title:function(){return t},setTitle:function(n){t=n},headline:function(){return e},setHeadline:function(n){e=n},product:function(){return u},setProduct:function(n){u=n}}}angular.module("oneMVApp").factory("PageService",n),n.$inject=[]}();
!function(){"use strict";function e(o,i,s,a,t){return{ChangePassword:function(e){var n=i.defer(),r=s.oneMVApiUrl+"/passenger/"+t.authentication.passengerId+"/changePassword";return o({method:"POST",url:r+"?rnd="+(new Date).getTime(),headers:{"Content-Type":"text/json"},data:JSON.stringify(e)}).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},VerifyAndUpdatePassword:function(e){var n=i.defer(),r=a.getDivisionId(),t=s.oneMVApiUrl+"password/"+r+"/updatePasswordWithTempCode";return o({method:"POST",url:t+"?rnd="+(new Date).getTime(),data:JSON.stringify(e)}).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},SendPasscode:function(e){var n=i.defer(),r=a.getDivisionId(),t=s.oneMVApiUrl+"password/"+r+"/sendTemporaryCode";return o.post(t,'"'+e+'"').then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise}}}angular.module("oneMVApp").factory("PasswordService",e),e.$inject=["$http","$q","env","DivisionService","authService"]}();
!function(){"use strict";function n(n){return{hasValue:function(n){return null!=n&&null!=n&&""!=n},isIE:function(){return 0<n.navigator.userAgent.indexOf("Trident")||0<n.navigator.userAgent.indexOf("MSIE")}}}angular.module("oneMVApp").factory("PortalUtilityService",n),n.$inject=["$window"]}();
!function(){"use strict";function e(n,e,t,r,o,u){var i=t.oneMVApiUrl;return{GetProfile:function(e){return n({method:"GET",url:i+"passenger/GetProfile/"+e+"?rnd="+(new Date).getTime()}).then(function(e){return 200==e.status?e.data.result:e},function(e){return null})},UpdateProfile:function(e){return n.post(i+"passenger/UpdateProfile",e).then(function(e){if(200==e.status)return e})},GetPassengerAge:function(e){return n({method:"GET",url:i+"passenger/"+e+"/age?rnd="+(new Date).getTime()}).then(function(e){if(200==e.status)return e},function(e){throw e})},GetHomeAddress:function(e){return n({method:"GET",url:i+"passenger/GetHomeAddress/"+e+"?rnd="+(new Date).getTime()}).then(function(e){return 200==e.status?e.data.result:e},function(e){throw e})},UpdateHomeAddress:function(e,t){return n.post(i+"passenger/UpdateHomeAddress/"+e,t).then(function(e){if(200==e.status)return e})},AllowEditHomeAddress:function(){var e=r.getSystemParameters();return e.DropoffHomeLocationOnly&&e.DropoffHomeLocationEdit},ShowHomeAddress:function(){return r.getSystemParameters().DropoffHomeLocationOnly},GetDefaultMobilityAids:function(e,t){return n({method:"GET",url:i+"passenger/GetDefaultMobilityAids/"+e+"/"+t+"?rnd="+(new Date).getTime()}).then(function(e){return 200==e.status?e.data.result:e},function(e){return null})}}}angular.module("oneMVApp").factory("ProfileService",e),e.$inject=["$http","$q","env","DivisionService","ConfigFactory","authService"]}();
!function(){"use strict";function o(e,n){return{save:function(o){n.set("coming-from",o)},redirect:function(){var o=n.get("coming-from");o?n.remove("coming-from"):o="dashboard/";r(o)},redirectTo:r};function r(o){e.path(o)}}angular.module("oneMVApp").factory("RedirectionService",o),o.$inject=["$location","localStorageService"]}();
!function(){"use strict";function e(s,a,c,p){return{cancelReservation:function(e,n){var t=a.defer(),o=c.oneMVApiUrl+"commuter/"+p.getDivisionId()+"/"+e+"/reservations/"+n+"/cancel";return s({method:"DELETE",url:o,contentType:"application/json",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},getAllReservationsForPassenger:function(e){var n=a.defer(),t=c.oneMVApiUrl+"commuter/"+p.getDivisionId()+"/reservations/all/"+e;return s({method:"GET",url:t,contentType:"application/json"}).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},getStopInfoforReservations:function(e,n){var t=a.defer(),o=c.commuterApiUrl+"reservation/"+p.getDivisionId()+"/stopInfo/"+e+"/"+n;return s({method:"GET",url:o,contentType:"application/json"}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},getPassengerReservationsForToday:function(e){var n=a.defer(),t=c.oneMVApiUrl+"commuter/"+p.getDivisionId()+"/reservations/today/"+e;return s({method:"GET",url:t,contentType:"application/json"}).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},getUserReservationFor:function(e,n,t){var o=a.defer(),r=c.oneMVApiUrl+"commuter/"+p.getDivisionId()+"/reservations/for/"+e+"/"+n+"/"+t+"/?rnd"+(new Date).getMilliseconds();return s({method:"GET",url:r,contentType:"application/json"}).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},getUserReservationsByDuration:function(e,n,t){var o=a.defer(),r=c.commuterApiUrl+"reservation/"+p.getDivisionId()+"/user/"+e+"/"+n+"?duration="+t;return s({method:"GET",url:r,contentType:"application/json"}).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},getTripTimingsByDuration:function(e,n,t,o){var r=a.defer(),i=c.commuterApiUrl+"reservation/"+p.getDivisionId()+"/tripTimings/"+e+"/"+n+"/"+t+"?duration="+o;return s({method:"GET",url:i,contentType:"application/json"}).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},addReservations:function(e,n){var t=a.defer(),o=c.oneMVApiUrl+"commuter/"+p.getDivisionId()+"/reservations/add/"+e;return s({method:"POST",url:o,contentType:"application/json",data:JSON.stringify(n),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},manageParkingForReservation:function(e,n,t){var o=a.defer(),r=c.oneMVApiUrl+"commuter/"+p.getDivisionId()+"/"+e+"/"+n+"/manageParkingReservation/"+t;return s({method:"PUT",url:r,contentType:"application/json"}).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},getAllTripsForCurrentReservation:function(e,n){var t=a.defer(),o=c.oneMVApiUrl+"commuter/"+p.getDivisionId()+"/reservations/"+e+"/altTrips/"+n+"?rnd"+(new Date).getMilliseconds();return s({method:"GET",url:o,contentType:"application/json"}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},modifyReservation:function(e,n,t){var o=a.defer(),r=c.oneMVApiUrl+"commuter/"+p.getDivisionId()+"/reservations/"+e+"/changePickup/"+n+"/"+t;return s({method:"GET",url:r,contentType:"application/json"}).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},getAdvReservationAllowedWeeks:function(){var e=c.oneMVApiUrl+"commuter/"+p.getDivisionId()+"/reservations/advReservationWindow?rnd="+(new Date).getMilliseconds(),n=a.defer();return s({method:"GET",url:e}).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},getReservationById:function(e,n){var t=a.defer(),o=c.oneMVApiUrl+"commuter/"+p.getDivisionId()+"/"+e+"/reservations/"+n;return s({method:"GET",url:o,contentType:"application/json"}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},addWaitlistedReservations:function(e,n){var t=a.defer(),o=c.oneMVApiUrl+"commuter/"+p.getDivisionId()+"/reservations/waitlist/add/"+e;return s({method:"POST",url:o,contentType:"application/json",data:JSON.stringify(n),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},getAvailableSeatsForTrip:function(e,n){var t=a.defer(),o=c.oneMVApiUrl+"commuter/"+p.getDivisionId()+"/availableSeats/"+e+"/"+n;return s({method:"GET",url:o,contentType:"application/json"}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},getPassengerTemplates:function(e){var n=a.defer(),t=c.oneMVApiUrl+"commuter/"+p.getDivisionId()+"/reservationTemplates/"+e;return s({method:"GET",url:t,contentType:"application/json"}).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},addPassengerTemplate:function(e,n){var t=a.defer(),o=c.oneMVApiUrl+"commuter/"+p.getDivisionId()+"/reservationTemplates/"+e;return s({method:"POST",url:o,contentType:"application/json",data:n,headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise}}}angular.module("oneMVApp").factory("ReservationService",e),e.$inject=["$http","$q","env","DivisionService"]}();
!function(){"use strict";function e(c,o,u){return{isInServiceArea:function(e,r,n){var t=o.defer(),i=u.oneMVApiOrgUrl+"servicearea/canRegisterOrLogin/"+e+"/"+r+"/"+n;return c({method:"GET",url:i}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise}}}angular.module("oneMVApp").factory("ServiceAreaService",e),e.$inject=["$http","$q","env"]}();
!function(){"use strict";function t(o,t,e){t.navigateToSelectedStop=function(t){e.setStop(t),o.path("/commuter/selected-stop")},t.getDirectionsToSelectedStop=function(t){e.setStop(t),o.path("/commuter/directions")},t.openMapApp=function(t){var o="";0<(o=-1!=navigator.platform.indexOf("iPhone")||-1!=navigator.platform.indexOf("iPod")||-1!=navigator.platform.indexOf("iPad")?"http://maps.apple.com/?q="+t.latitude+","+t.longitude:"http://maps.google.com/?q="+t.latitude+","+t.longitude).length&&($("body").hasClass("platform-cordova")?window.open(o,"_system",""):window.open(o))}}function o(o,e,n,s,c,t,i,a,l,r,p,u){var d,g,m,h,f,S=this;function v(t){for(var o=t.data.result.stops,e=0;e<o.length;e++)if(o&&o[e].id){var n=o[e];n.distance=null,n.icon="images/pin_pickup@1x.png",S.stops.push(n)}L()}function L(){if(0!=S.stops.length){S.mapControl.getGMap().markers=[],S.closestBusStop=[],S.allOtherStops=[];for(var t,o,e,n,s,i=[],a=0;a<S.stops.length;a++)if(null!=S.selectedLocation&&null!=S.selectedLocation){var l=(t=S.selectedLocation.coords,o=S.stops[a],void 0,e={latitude:t.latitude,longitude:o.longitude},n=parseFloat(M(t,e)),s=parseFloat(M(e,o)),(n+s).toFixed(2));l<=S.distance?(S.stops[a].distance=l,i.push(S.stops[a])):(S.stops[a].distance=null,S.allOtherStops.push(S.stops[a]))}else S.stops[a].distance=null,S.allOtherStops.push(S.stops[a]);null!=S.selectedLocation&&0<i.length?c.getDrivingDistances(S.selectedLocation.coords,i).then(function(t){for(var o=0;o<t.rows[0].elements.length;o++)i[o].distance=(parseFloat(t.rows[0].elements[o].distance.value)/1e3*.621371).toFixed(2),i[o].distance>S.distance?(i[o].distance=null,S.allOtherStops.indexOf(i[o])<0&&S.allOtherStops.push(i[o])):S.closestBusStop.push(i[o]);w()},function(t){Array.prototype.push.apply(S.allOtherStops,S.stops);var o={url:g,size:new google.maps.Size(34,60),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(24,57)};S.allOtherStops.sort(function(t,o){return null==t.distance||null==o.distance?1e4:t.distance-o.distance}),angular.forEach(S.allOtherStops,function(t){t.icon=o,t.distance=null}),google.maps.event.trigger(S.mapControl.getGMap(),"resize"),y()}):w()}}function w(){S.closestBusStop.sort(function(t,o){return null==t.distance||null==o.distance?1e4:t.distance-o.distance}),S.allOtherStops.sort(function(t,o){return t.name<o.name?-1:t.name>o.name?1:0});var o={url:g,size:new google.maps.Size(34,60),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(23,57)},e={url:d,size:new google.maps.Size(34,60),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(23,57)};angular.forEach(S.closestBusStop,function(t){t.isHub?t.icon=f:t.icon=e}),angular.forEach(S.allOtherStops,function(t){t.isHub?t.icon=f:t.icon=o}),S.closestCount=r("filter")(S.closestBusStop,{isHub:!1}).length,S.otherCount=r("filter")(S.allOtherStops,{isHub:!1}).length,google.maps.event.trigger(S.mapControl.getGMap(),"resize"),y()}function y(){var o=new google.maps.LatLngBounds;angular.forEach(S.stops,function(t){o.extend(new google.maps.LatLng(t.latitude,t.longitude))}),null!=S.selectedLocation&&null!=S.selectedLocation&&null!=S.stops[0].distance&&S.stops[0].distance<S.distance&&o.extend(new google.maps.LatLng(S.selectedLocation.coords.latitude,S.selectedLocation.coords.longitude)),S.mapControl.getGMap().fitBounds(o),S.mapControl.getGMap().setZoom(S.mapControl.getGMap().getZoom()-1),S.isLoading=!1}function M(t,o){var e=t.latitude,n=t.longitude,s=o.latitude,i=o.longitude,a=(s-e)*Math.PI/180,l=(i-n)*Math.PI/180,c=Math.sin(a/2)*Math.sin(a/2)+Math.cos(e*Math.PI/180)*Math.cos(s*Math.PI/180)*Math.sin(l/2)*Math.sin(l/2);return(6371*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)))*.62137).toFixed(2)}S.PageService=p,S.PageService.setTitle("Find a bus stop"),S.PageService.setHeadline(u.getCommuterInfo().alias),S.stops=[],S.closestBusStop=[],S.allOtherStops=[],S.search="",S.isLoading=!0,S.center={latitude:47.604356,longitude:-122.3360817},S.position=null,S.location=null,S.selectedLocation=null,S.showList=!0,f=0<a.navigator.userAgent.indexOf("Trident")||0<a.navigator.userAgent.indexOf("MSIE")?(d="images/pin-busstop-green.png",g="images/pin-busstop-grey.png",m="images/pin-location.png",h="images/pin-my-location.png","images/pin-hub.png"):(d="images/pin-busstop-green.svg",g="images/pin-busstop-grey.svg",m="images/pin-location.svg",h="images/pin-my-location.svg","images/pin-hub.svg"),S.zoom=15,S.myStyles=[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels.icon",stylers:[{visibility:"off"}]}],S.mapOptions={mapTypeControl:!1,zoomControl:!0,streetViewControl:!1,styles:S.myStyles},S.mapControl={},S.myLocationIcon={url:h,size:new google.maps.Size(42,42),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(20,20)},t.get("clientappsettings.json").then(function(t){S.distance=t.data.stopDistance,S.myStyles=t.data.googleMapOptons,s.promise().then(function(t){return e.getCurrentPosition()},function(t){l.showError("Map cannot be loaded.")}).then(function(t){if(null==t||null==t)return n.getAllBusStops();S.position={coords:{latitude:t.coords.latitude,longitude:t.coords.longitude},icon:S.myLocationIcon};var o=n.getGeoLocation();return null==o||null==o||null==o.isAddress||0==o.isAddress?S.selectedLocation=S.position:(S.location=o,S.selectedLocation=S.location,S.search=o.formatted_address),n.getAllBusStops()},function(t){S.selectedLocation=n.getGeoLocation()||null,null!=S.selectedLocation&&S.selectedLocation.isAddress?S.search=S.selectedLocation.formatted_address:(S.selectedLocation=null,n.clearItem("currLocation")),n.getAllBusStops().then(function(t){v(t)},function(t){S.isLoading=!1,l.showError("Error loading stops. Please try again later")})}).then(function(t){t&&v(t)},function(t){S.isLoading=!1,l.showError("Error loading stops. Please try again later.")})},function(t){l.showError("Error Loading Stops.")}),S.markerEvent={click:function(t,o,e){e.$id&&(S.selectedLocation&&n.setGeoLocation(S.selectedLocation),n.setStop(e.coords),S.coords=e.coords,S.show=!0)}},S.navigateToClosestStop=function(t){S.navigateToSelectedStop(S.closestBusStop[t])},S.getDirectionsToClosestStop=function(t){S.getDirectionsToSelectedStop(S.closestBusStop[t])},S.getDirectionsToOtherStop=function(t){S.getDirectionsToSelectedStop(S.allOtherStops[t])},S.displayMap=function(){S.showList=!1,i(function(){google.maps.event.trigger(S.mapControl.getGMap(),"resize"),y()},50)},S.navigateToOtherStop=function(t){S.navigateToSelectedStop(S.allOtherStops[t])},S.locationSearch=function(){if(S.selectedLocation=null,S.show=!1,""==S.search.trim())return n.clearItem("currLocation"),null!=S.position?S.selectedLocation=S.position:S.selectedLocation=null,S.location=null,void L();c.getLocation(S.search).then(function(t){if(0<t.length){S.search=t[0].formatted_address;var o={url:m};S.location={coords:{latitude:t[0].geometry.location.lat(),longitude:t[0].geometry.location.lng()},isAddress:!0,formatted_address:t[0].formatted_address,icon:o},S.selectedLocation=S.location,n.setGeoLocation(S.selectedLocation)}L()},function(t){l.showError("Cannot find the location")})},S.navigateToSelectedStop=function(t){n.setStop(t),n.setGeoLocation(S.selectedLocation),o.path("/commuter/selected-stop")},S.ionicInclude="app/modules/commuter/all-stops/all-stops.html",S.ionicCustomClassName="",S.ionicHideNavBar=!1,S.ionicUseRefresher=!1}angular.module("oneMVApp").controller("AllStopsController",o).controller("infoWindowController",t),t.$inject=["$location","$scope","StopDataService"],o.$inject=["$location","GeoLocationService","StopDataService","uiGmapIsReady","LocationService","$http","$timeout","$window","MessageService","$filter","PageService","OneMvServices"]}();
!function(){"use strict";function e(i,e,t,r,o,n,a,s){var l=this;if(l.title="Advance Reservations Confirmation",null!=e.obj&&null!=e.obj&&null!=e.obj.reservationInfo&&null!=e.obj.reservationInfo){var u,d=e.obj.config,c=e.obj.reservationInfo,v=a.authentication.passengerId;l.divisionAllowsWaitlist=!0,l.successAnime=f,l.schedule=d.schedule,l.reserve=function(){var e=(a=[],o=0,angular.forEach(c,function(e){var r=0;angular.forEach(e,function(e){if(g(e)){var t=h(e),i={reservationDate:e.date,tripId:t.tripId,pickupStopId:l.pickup.id,dropoffStopId:l.dropoff.id,passengerId:v,routeId:t.routeId,schedule:l.schedule,divisionId:n.getDivisionId(),vehicleId:null!=e.vehicle?e.vehicle.id:null,isAdvance:!0};a.push({reservation:i,id:o+"_"+r}),r++}}),o++}),a);var a,o;e&&0<e.length&&(l.reserving=!0);for(var t=0;t<e.length;t++)m(e[t].reservation,e[t].id)},l.showReservation=function(e){o.getReservationById(v,e).then(function(e){if(e&&1==e.data.status)r.open({animation:!0,size:"-fs",backdrop:!1,templateUrl:"app/modules/commuter/adv-schedule/reservation-modal.html",controller:"ReservationModalController as vm",resolve:{reservation:e.data.result}})})},l.bookReturnTrip=function(){s.getPickupForReturnTrip(d.pickup.id,d.dropoff.id).then(function(e){var t;d.schedule="PM",d.dropoff=angular.copy(l.pickup),d.pickup=(t=e)&&1==t.data.status&&t.data.result?t.data.result:angular.copy(l.dropoff),d.vehicle={licenceplate:"--",vehicleId:void 0},i.go("adv-schedule-setup",{obj:{config:d}})},function(e){console.log("error fetching pickup for return trip.")})},l.back=function(){i.go("adv-schedule",{obj:e.obj})},l.pickup=d.pickup,l.dropoff=d.dropoff,l.weeksToDisplay=(u=[],angular.forEach(c,function(e){var r={from:"",to:"",days:[]};r.from=t("date")(e[0].date,"MM/dd/yyyy"),r.to=t("date")(e[e.length-1].date,"MM/dd/yyyy"),angular.forEach(e,function(e){var t,i;g(e)&&r.days.push({date:e.date,vehicle:e.vehicle,trip:h(e),isReserved:!1,isWaitlist:(t=e,i=p(t),t.vehicle.id&&t.availableParking<=0||null!=i&&0<=i),waitlistCount:p(e)})}),u.push(r)}),u),l.reserving=!1,n.isWaitlistAllowedByDivision().then(function(e){l.divisionAllowsWaitlist=e})}else i.go("adv-schedule-setup");function f(){setTimeout(function(){anime({targets:".anim--success .lines path",strokeDashoffset:[anime.setDashoffset,0],easing:"easeInOutSine",duration:1500,direction:"alternate",loop:!1})},0)}function p(e){var t=h(e);if(t.availableCapacity<=0)return t.numberOfWaitlists}function h(e){if(e.trips&&e.selectedTrip)for(var t=0;t<e.trips.length;t++)if(e.trips[t].tripId==e.selectedTrip)return e.trips[t]}function g(e){var t=h(e);return e.isOpen&&null!=t&&0<t.totalPassengers}function m(e,a){var t;(t=y(a)).reservationFailed=!1,t.reservationError="",t.isReserved=!1,o.addReservations(v,[e]).then(function(e){var t,i,r;e&&e.data&&1==e.data.status&&0==e.data.result.errors.length?(t=a,i=e.data.result.id[0],(r=y(t)).isReserved=!0,r.reservation=i,f()):I(a,e.data.result.errors?e.data.result.errors[0]:e.data.result)},function(e){I(a,e)})}function y(e){var t=e.split("_"),i=t[0],r=t[1];return l.weeksToDisplay[i].days[r]}function I(e,t){var i=y(e);i.reservationFailed=!0,i.reservationError=t}}angular.module("oneMVApp").controller("AdvScheduleConfirmationController",e),e.$inject=["$state","$stateParams","$filter","$uibModal","ReservationService","DivisionService","authService","StopDataService"]}();
!function(){"use strict";function e(e,t,n,i,a,o,s,r,l,d,c,u,f,v,p,g,h,m){var k=this;if(k.PageService=u,null!=n.obj&&null!=n.obj&&null!=n.obj.config&&null!=n.obj.config||null!=n.obj&&null!=n.obj&&null!=n.obj.reservationInfo&&null!=n.obj.reservationInfo){var w,y=void 0,S=[],C=void 0,b=void 0,O=void 0,D=moment();I(),v.isWaitlistAllowedByDivision().then(function(e){k.divisionAllowsWaitlist=e}),(w=i.defer(),f.getAllReservationsForPassenger(y).then(function(e){1==e.data.status&&e.data.result.reservations&&(S=e.data.result.reservations.filter(T)),w.resolve(e)}),w.promise).then(function(){h.getServiceDateByDivision(v.getDivisionId()).then(function(e){D=e.data.result;var n,t,i,a=0,o=O,s=(n=moment(D),6==(t=n.day())?n.add(1,"days").toDate():0==t?n.toDate():n.subtract(t,"days").toDate());W(a,o,s,A),(6!=(i=moment(D)).day()||0!=i.day())&&(o=(a=O)+1,s=moment(s).add(7*O,"days").toDate(),W(a,o,s,P)),function(){for(var e=0;e<k.weeks.length;e++)for(var n=0;n<k.weeks[e].length;n++)k.weeks[e][n].isOpen&&!k.weeks[e][n].disable&&M(e,n)}(),k.weeksX=k.weeks,k.selectedConfig.schedule==g.ScheduleType.Morning&&function(){for(var e=0;e<k.weeks.length;e++)for(var n=0;n<k.weeks[e].length;n++)k.weeks[e][n].isOpen&&!k.weeks[e][n].disable&&V(e,n)}()})})}else t.go("adv-schedule-setup");function I(){k.reserve=L,k.filterWeekend=E,k.showSchedule=Y,k.dayClass=_,k.resetPassengerVehicle=R,k.back=B,k.showReservationInfo=x,k.noVehicle={licenceplate:"--",id:void 0},k.carouselOptions={navText:["",""],responsiveClass:!1,nav:!0,loop:!1,itemElement:"cal__week",onDragged:j,items:1},k.selectedConfig=n.obj.config,k.passengerVehicles=n.obj.vehicles,k.weeks=[],k.divisionAllowsWaitlist=!0,y=l.authentication.passengerId,S=[],C=k.selectedConfig.pickup,b=k.selectedConfig.dropoff,O=k.selectedConfig.numOfWeeks.name,k.PageService.setTitle(C.name+"-"+b.name)}function j(e){var n=document.getElementById(e.page.index);m(n,{duration:700,easing:"easeInQuad",offset:120})}function T(e){return e.scheduleType.toLowerCase()==k.selectedConfig.schedule.toLowerCase()}function $(n){var e=S.filter(function(e){return moment(e.reservationDate).dayOfYear()==n.dayOfYear()&&"Canceled"!=e.status});return null==e||0==e.length?void 0:e[0]}function W(e,n,t,i){for(var a,o,s,r,l,d=moment(t),c=e;c<n;c++){for(var u=[],f=0;f<7;f++)u.push({dayId:f,week:c,dayOfWeek:(l=d,void 0,["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][l.weekday()]),date:d.toDate(),isOpen:(s=d,r=i,!r(s)&&function(e){for(var n=0;n<k.selectedConfig.weekDays.length;n++)if(k.selectedConfig.weekDays[n].id==e.day())return!0;return!1}(s)&&void 0===$(s)),disable:(a=d,o=i,o(a)||null!=$(a)),selectedTrip:void 0,trips:void 0,vehicle:k.selectedConfig.vehicle,reservation:$(d)}),d=d.add(1,"days");k.weeks[c]=u}}function A(e){return e.dayOfYear()<moment(D).dayOfYear()}function P(e){return e.dayOfYear()>moment(D).dayOfYear()+7*O}function V(n,t){d.getAvailableParkingsForStop(C.id,Date.parse(k.weeks[n][t].date)).then(function(e){1==e.data.status&&(k.weeks[n][t].availableParking=e.data.result)})}function M(n,t){d.getNonPerformedTrips(C.id,b.id,k.selectedConfig.schedule,Date.parse(k.weeks[n][t].date)).then(function(e){1==e.data.status&&e.data.result&&(k.weeks[n][t].trips=e.data.result.NonPerformedTrips,function(e,n){if(null==k.weeks[e][n]||null==k.weeks[e][n].trips)return;for(var t=k.weeks[e][n].trips,i=0;i<t.length;i++)if(k.selectedConfig.tripTime.tripId==t[i].tripId)return k.weeks[e][n].selectedTrip=t[i].tripId}(n,t)),null==k.weeks[n][t].trips&&(k.weeks[n][t].isOpen=!1,k.weeks[n][t].disable=!0)})}function _(e){return F(e)?"cal__day--disabled":angular.isUndefined(e.trips)||!e.isOpen?"cal__day--inactive":"cal__day--active"}function Y(e){if(!F(e)&&!e.disable){e.isOpen=!e.isOpen,e.isOpen||(e.trips=void 0),M(e.week,e.dayId),V(e.week,e.dayId);e.dayId,e.week}}function E(){return function(e){return"Sat"!=e.dayOfWeek&&"Sun"!=e.dayOfWeek}}function F(e){"Sat"==e.dayOfWeek||e.dayOfWeek}function R(e){k.passengerVehicles&&0<k.passengerVehicles.length&&(e.vehicle=k.passengerVehicles[0])}function B(){t.go("adv-schedule-setup")}function x(e){r.open({animation:!0,templateUrl:"app/modules/commuter/adv-schedule/reservation-modal.html",controller:"ReservationModalController as vm",backdrop:!1,size:"-fs",resolve:{reservation:e}})}function L(){var n=!1;angular.forEach(k.weeks,function(e){angular.forEach(e,function(e){e.isOpen&&null!=e.selectedTrip&&(n=!0)})}),n&&t.go("adv-schedule-confirmation",{obj:{config:k.selectedConfig,vehicles:k.passengerVehicles,reservationInfo:k.weeks}})}}angular.module("oneMVApp").controller("AdvScheduleController",e),e.$inject=["$scope","$state","$stateParams","$q","$location","$anchorScroll","$timeout","$uibModal","authService","StopDataService","vehicleService","PageService","ReservationService","DivisionService","MessageService","CommonService","ScheduleService","smoothScroll"]}(),function(){"use strict";function e(){return{restrict:"E",transclude:!1,link:function(a){a.initCarousel=function(e){var n={},t=a.$eval($(e).attr("data-options"));for(var i in t)n[i]=t[i];angular.element(e).owlCarousel(n)}}}}angular.module("oneMVApp").directive("owlCarousel",e),e.$inject=[]}(),function(){"use strict";function e(){return{restrict:"A",transclude:!1,link:function(e,n){e.$last&&e.initCarousel(n.parent())}}}angular.module("oneMVApp").directive("owlCarouselItem",e),e.$inject=[]}();
!function(){"use strict";function e(e,t,i,s,n,o,d,a,l,c,r,f,p,u){var g=this;g.PageService=f,g.PageService.setTitle("Advanced Reservations"),g.PageService.setHeadline(u.getCommuterInfo().alias);var m=n.authentication.passengerId,h=[],v={pickupTime:"Optional",tripId:void 0},k={licenceplate:"--",vehicleId:void 0},C={id:void 0,name:"--",latitude:null,longitude:null},S=[{event:"click",callback:function(e){g.show=!0,g.coords=e.coords}}];g.map=c.initializeMap(),g.title="Advance Reservations Setup",g.isLoading=!1,g.isPassengerLoggedIn=n.isLoggedIn(),g.markers=[],g.selectedConfig={schedule:a.ScheduleType.Morning,pickup:void 0,dropoff:void 0,weekDays:[],tripTime:void 0,numOfWeeks:void 0,vehicle:void 0};var T=y()?s.obj.config:void 0;function y(){return null!=s.obj&&null!=s.obj&&null!=s.obj.config&&null!=s.obj.config}function W(){for(var e=0;e<g.templates.length;e++)if(g.templates[e].schedule==g.selectedConfig.schedule)return g.templates[e]}function O(){t.go("adv-schedule",{obj:{config:g.selectedConfig,vehicles:g.passengerVehicles}})}function I(){g.markers=[],g.selectedConfig.pickup&&void 0!==g.selectedConfig.pickup.id&&g.markers.push({latitude:g.selectedConfig.pickup.latitude,longitude:g.selectedConfig.pickup.longitude,icon:b(g.selectedConfig.pickup.isHub),name:g.selectedConfig.pickup.name,address:g.selectedConfig.pickup.address}),g.selectedConfig.dropoff&&void 0!==g.selectedConfig.dropoff.id&&g.markers.push({latitude:g.selectedConfig.dropoff.latitude,longitude:g.selectedConfig.dropoff.longitude,icon:b(g.selectedConfig.dropoff.isHub),name:g.selectedConfig.dropoff.name,address:g.selectedConfig.dropoff.address})}function b(e){return e?r.getCommuterHubIcon():r.getCommuterStopIcon()}function D(){g.selectedConfig.weekDays=[],angular.forEach(g.daysOfWeek,function(e,t){e.selected=!1})}function V(){g.pickupStops=h.filter(function(e){return e.isHub!=(g.selectedConfig.schedule==a.ScheduleType.Morning)}),g.pickupStops.splice(0,0,C),function(){var e=void 0;y()&&T?e=T.pickup.id:0<g.templates.length&&g.useDefaultTemplate&&(e=W().pickupId);for(var t=!1,i=0;i<g.pickupStops.length;i++)if(g.pickupStops[i].id==e){g.selectedConfig.pickup=g.pickupStops[i],t=!0;break}t||(g.selectedConfig.pickup=g.pickupStops[0]);g.pickupChanged()}()}function w(){g.isPassengerLoggedIn||L(),p.verify(n.authentication.passengerId),l.getPassengerTemplates(m).then(function(e){e&&e.data.status&&e.data.result&&0<e.data.result.length&&function(e){for(var t=0;t<e.length;t++)g.templates.push(e[t]);M()}(e.data.result),g.numOfWeeks=[],l.getAdvReservationAllowedWeeks().then(function(e){if(1==e.data.status){for(var t=e.data.result,i=1;i<=t;i++)g.numOfWeeks.push({name:i});var s=g.numOfWeeks[g.numOfWeeks.length-1];if(y())for(var i=0;i<g.numOfWeeks.length;i++)if(g.numOfWeeks[i].name===T.numOfWeeks.name){s=g.numOfWeeks[i];break}g.selectedConfig.numOfWeeks=s}}),o.getAllBusStops().then(function(e){if(1==e.data.status&&e.data.result){if(h=e.data.result.stops,y()&&T){g.selectedConfig=angular.copy(T),M();for(var t=0;t<g.daysOfWeek.length;t++)g.daysOfWeek[t].selected=P(g.daysOfWeek[t],T.weekDays)}V()}})}),A()}function M(){for(var e=!1,t=0;t<g.templates.length;t++)if(g.selectedConfig.schedule==g.templates[t].schedule){e=!0;break}g.hasTemplates=e}function P(e,t){for(var i=0;i<t.length;i++)if(e.name==t[i].name&&t[i].selected)return!0;return!1}function A(){d.getVehiclesForPassenger(m).then(function(e){e.data&&1==e.data.status&&e.data.result.passengerVehicles&&(g.passengerVehicles=e.data.result.passengerVehicles),0<g.passengerVehicles.length?g.passengerVehicles.splice(0,0,k):g.passengerVehicles=[k],R()})}function R(){var e=W();if(g.useDefaultTemplate&&null!=e&&"AM"==g.selectedConfig.schedule&&e.vehicleId){for(var t=0;t<g.passengerVehicles.length;t++)if(g.passengerVehicles[t].id==e.vehicleId){g.parkingSelected=!0,g.selectedConfig.vehicle=g.passengerVehicles[t];break}}else g.selectedConfig.vehicle=g.passengerVehicles[0]}function $(){if(0<g.templates.length&&g.useDefaultTemplate){var e=W();if(e){for(var t=0;t<g.tripTimes.length;t++)if(g.tripTimes[t].tripId==e.tripId){g.selectedConfig.tripTime=g.tripTimes[t];break}}else g.selectedConfig.tripTime=g.tripTimes[0]}else g.selectedConfig.tripTime=g.tripTimes[0]}function L(){t.go("login")}g.pickupStops=[],g.dropoffStops=[],g.tripTimes=[],g.passengerVehicles=[],g.coords=void 0,g.numOfWeeks=[],g.daysOfWeek=[{name:"S",selected:!1,id:0},{name:"M",selected:!1,id:1},{name:"T",selected:!1,id:2},{name:"W",selected:!1,id:3},{name:"TH",selected:!1,id:4},{name:"F",selected:!1,id:5},{name:"S",selected:!1,id:6}],g.hasTemplates=!1,g.templates=[],g.useDefaultTemplate=!1,g.overrideTemplate=!1,g.addTemplate=!1,g.pickupChanged=function(){if(!g.selectedConfig.pickup||!g.selectedConfig.pickup.id)return g.selectedConfig.dropoff=g.pickupStops[0],g.markers=[],void(g.addTemplate=!1);g.selectedConfig.dropoff=C,g.show=!1,I(),c.setMapBounds(g.markers,S),function(){if(!g.selectedConfig.pickup||!g.selectedConfig.pickup.id)return;o.getDropoffsForSelectedPickup(g.selectedConfig.pickup.id).then(function(e){1==e.data.status&&e.data.result&&(g.dropoffStops=e.data.result.dropoffs,g.dropoffStops.splice(0,0,C),function(){var e=void 0;y()&&T?e=T.dropoff.id:0<g.templates.length&&g.useDefaultTemplate&&(e=W().dropoffId);for(var t=!1,i=0;i<g.dropoffStops.length;i++)if(g.dropoffStops[i].id==e){g.selectedConfig.dropoff=g.dropoffStops[i],t=!0;break}t||(g.selectedConfig.dropoff=g.dropoffStops[0]);g.dropoffChanged()}())})}()},g.dropoffChanged=function(){g.selectedConfig.pickup&&g.selectedConfig.pickup.id&&(g.show=!1,g.selectedConfig.dropoff&&g.selectedConfig.dropoff.id?function(){if(!g.selectedConfig.pickup.id||!g.selectedConfig.dropoff.id)return;o.getTripTimesForAdvancedReservation(g.selectedConfig.pickup.id,g.selectedConfig.dropoff.id,g.selectedConfig.schedule).then(function(e){1==e.data.status&&e.data.result.allTrips&&(g.tripTimes=e.data.result.allTrips,g.tripTimes.splice(0,0,v),$())})}():g.addTemplate=!1,I(),c.setMapBounds(g.markers,S))},e.$watch("vm.daysOfWeek|filter:{selected:true}",function(e){g.selectedConfig.weekDays=e.map(function(e){return e})},!0),e.$watch("vm.parkingSelected",function(e){e||(g.selectedConfig.vehicle=k)}),e.$watch("vm.useDefaultTemplate",function(e){if(e||(g.parkingSelected=!1),$(),V(),D(),R(),0<g.templates.length&&g.useDefaultTemplate)for(var t=W(),i=0;i<g.daysOfWeek.length;i++)g.daysOfWeek[i].selected=P(g.daysOfWeek[i],t.daysOfWeek)}),g.scheduleChanged=function(){g.dropoffStops=[],g.markers=[],g.show=!1,g.useDefaultTemplate=!1,V(),D(),g.selectedConfig.tripTime={},g.tripTimes=[],M()},g.clearWeekSelection=function(){D()},g.next=function(){if(g.addTemplate||g.overrideTemplate){var e={PickupStopId:g.selectedConfig.pickup.id,DropoffStopId:g.selectedConfig.dropoff.id,TripId:g.selectedConfig.tripTime.tripId,Schedule:g.selectedConfig.schedule,VehicleId:g.selectedConfig.vehicle.id,SelectedDays:function(){for(var e=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],t={},i=0;i<g.selectedConfig.weekDays.length;i++){var s=e[g.selectedConfig.weekDays[i].id];t[s]=g.selectedConfig.weekDays[i].selected}return t}()};l.addPassengerTemplate(m,e).then(function(){O()},function(){O()})}O()},g.login=function(){L()},g.showAddVehicleDialog=function(){i.open({animation:!0,templateUrl:"app/modules/commuter/modals/add-vehicle-modal/add-vehicle.html",controller:"AddVehicleController as vm",size:"-fs",backdrop:!1,resolve:{atleastOneVehicleExist:0<g.passengerVehicles.length}}).result.then(function(e){e.isAdded&&A()})},w(),g.ionicInclude="app/modules/commuter/adv-schedule/adv-schedule-setup.html",g.ionicCustomClassName="",g.ionicHideNavBar=!1,g.ionicUseRefresher=!0,g.ionicPullingText="Refresh Reservations",g.ionicRefreshingText="Loading Reservations",g.ionicSpinner="spiral",g.refresh=function(e){g.isLoading=!0,w(),$rootScope.$broadcast("scroll.refreshComplete"),g.isLoading=!1}}angular.module("oneMVApp").controller("AdvScheduleSetupController",e),e.$inject=["$scope","$state","$uibModal","$stateParams","authService","StopDataService","vehicleService","CommonService","ReservationService","MapService","MapIconService","PageService","LuumLinkedService","OneMvServices"]}();
!function(){"use strict";function e(e,n){this.passengerReservations=[n],this.close=function(){e.close()}}angular.module("oneMVApp").controller("ReservationModalController",e),e.$inject=["$uibModalInstance","reservation"]}();
!function(){"use strict";function e(e,o,t,i,n,s){var r=this;r.selectedStop=n.getStop(),r.hasStopDescription=!1;var l=n.getGeoLocation();r.fromLocation=null!=l?l.coords.latitude+","+l.coords.longitude:"",r.center={latitude:40.651739,longitude:-73.953148},r.zoom=14,r.mapControl={};r.mapOptions={mapTypeControl:!1,zoomControl:!1,streetViewControl:!1,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels.icon",stylers:[{visibility:"off"}]}]},r.options={},r.markerEvents=function(){},r.showDirections=null==l;var a,c,p=new google.maps.LatLngBounds;s.promise().then(function(e){a=new google.maps.DirectionsRenderer,c=new google.maps.DirectionsService;var o=document.getElementById("directions");a.setMap(r.mapControl.getGMap()),a.setPanel(o),r.showDirections?(p.extend(new google.maps.LatLng(r.selectedStop.latitude,r.selectedStop.longitude)),r.center.latitude=r.selectedStop.latitude,r.center.longitude=r.selectedStop.longitude,google.maps.event.trigger(r.mapControl.getGMap(),"resize")):d(r.fromLocation)}),r.getDirection=function(){(new google.maps.Geocoder).geocode({address:r.fromLocation},function(e,o){o===google.maps.GeocoderStatus.OK&&d(e[0].geometry.location.lat()+","+e[0].geometry.location.lng())})};var d=function(e){c.route({origin:e,destination:r.selectedStop.latitude+","+r.selectedStop.longitude,travelMode:google.maps.DirectionsTravelMode.DRIVING},function(e,o){"OK"===o?(a.setDirections(e),r.stopDescription=r.selectedStop.description,""===r.stopDescription||angular.isUndefined(r.stopDescription)||(r.hasStopDescription=!0)):window.alert("Directions request failed due to "+o)})};r.ionicInclude="app/modules/commuter/directions/directions.html",r.ionicCustomClassName="",r.ionicHideNavBar=!1,r.ionicUseRefresher=!1}angular.module("oneMVApp").controller("DirectionsController",e),e.$inject=["$rootScope","$location","$stateParams","ScheduleService","StopDataService","uiGmapIsReady"]}();
!function(){"use strict";function e(e,t,s,i,o,n,a,r,l,c,d){var u=this;function p(t){i.getPassengerReservationsForToday(u.passengerId).then(function(e){e&&e.data&&1==e.data.status&&e.data.result.reservations?(u.passengerReservations=e.data.result.reservations,t?t():u.isLoading=!1):u.passengerReservations=[]},function(e){401!==e.status&&a.showError("Sorry! Could not load your Reservation!"),u.isLoading=!1})}function m(){l.getVehiclesForPassenger(u.passengerId).then(function(e){e.data&&1==e.data.status&&null!=e.data.result&&(u.vehicles=e.data.result),u.isLoading=!1},function(e){u.isLoading=!1})}function g(){u.isUserLoggedIn&&(u.passengerId=o.authentication.passengerId,p(m))}u.PageService=c,u.PageService.setTitle("Dashboard"),u.PageService.setHeadline(d.getCommuterInfo().alias),u.isUserLoggedIn=o.isLoggedIn(),u.reservationsAllowed=r.reservationsAllowed,u.passengerId="",u.passengerReservations=[],u.isLoading=!0,u.vehicles=[],u.updatingVehicleInfo=[],u.commuterFeatures=[{class:"carousel__item--all-stops",headline:"Explore",title:"Bus Stops",description:"Find a bus stop near you.",link:"commuter/all-stops",cta:"View Stops"},{class:"carousel__item--advanced-reservations",headline:"Book",title:"Reservations",description:"Up to two weeks in advance.",link:"commuter/adv-schedule-setup",cta:"Get Started"},{class:"carousel__item--commuter-schedule",headline:"View",title:"Published Schedules",description:"See all of the published schedule times at a glance.",link:"commuter/published-schedule",cta:"Show Schedule"}],u.showCommuterTrip=function(e){n.open({animation:!0,templateUrl:"app/modules/shared/trips/commuter-trip-modal.html",controller:"CommuterTripModalController as vm",size:"-fs",backdrop:!1,keyboard:!1,resolve:{tripId:e.id}}).result.then(function(e){(e.cancelled||e.isModified)&&p(m)})},e.carouselOptions={navText:["",""],responsiveClass:!1,nav:!0,responsive:{0:{items:1,stagePadding:34,startPosition:1,center:!0},375:{items:1,stagePadding:34,startPosition:1,center:!0},768:{items:2,stagePadding:16,startPosition:1,center:!0},992:{items:3,stagePadding:0,center:!1}}},u.updateParkingVehicle=function(e,t){u.updatingVehicleInfo[t]=!0,i.updateVehicleForReservation(e.ReservationId,e.VehicleId).then(function(e){u.updatingVehicleInfo[t]=!1},function(e){u.updatingVehicleInfo[t]=!1})},u.showStopsMap=function(e){n.open({animation:!0,windowClass:"map-modal",templateUrl:"app/modules/commuter/modals/reservation-map-modal/reservation-map.html",controller:"ReservationMapController as vm",backdrop:"static",resolve:{reservation_stops:function(){return e}}}).result.then(function(e){},function(){})},u.login=function(){s.path("/login")},u.ctaAction=function(e){s.path(e)},g(),u.ionicInclude="app/modules/commuter/home/home.html",u.ionicCustomClassName="ionic-top-padding",u.ionicHideNavBar=!1,u.ionicUseRefresher=!0,u.ionicPullingText="Refresh",u.ionicRefreshingText="Loading",u.ionicSpinner="spiral",u.refresh=function(e){u.isLoading=!0,u.title="Home",u.isUserLoggedIn=o.isLoggedIn(),u.reservationsAllowed=r.reservationsAllowed,u.passengerId="",u.userReservations={},u.vehicles=[],u.updatingVehicleInfo=[],g(),t.$broadcast("scroll.refreshComplete"),u.isLoading=!1}}angular.module("oneMVApp").controller("CommuterHomeController",e),e.$inject=["$scope","$rootScope","$location","ReservationService","authService","$uibModal","MessageService","env","vehicleService","PageService","OneMvServices"]}();
!function(){"use strict";function e(e,t,n,i,o,a,l,s,u,c,r,d,g){var p=this;p.mapControl={};var m,h,f,v;p.mapOptions={mapTypeControl:!1,zoomControl:!0,streetViewControl:!1,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels.icon",stylers:[{visibility:"off"}]}]};function b(){var t=new google.maps.LatLngBounds;"AM"==p.schedType&&(angular.isUndefined(p.stop)||null==p.stop||null==p.stop.latitude||0==p.stop.latitude||t.extend(new google.maps.LatLng(p.stop.latitude,p.stop.longitude))),null!=p.busLocation&&null!=p.busLocation.latitude&&0!=p.busLocation.latitude&&t.extend(new google.maps.LatLng(p.busLocation.latitude,p.busLocation.longitude)),"PM"==p.schedType&&0<p.hubs.length&&angular.forEach(p.hubs,function(e){t.extend(new google.maps.LatLng(e.latitude,e.longitude))}),t.isEmpty()||(p.mapControl.getGMap().fitBounds(t),p.mapControl.getGMap().setZoom(p.mapControl.getGMap().getZoom()-1))}function L(){"last-location"!=d.current.name?s.cancel(p.promise):t.getVehicle(p.vehicleId).then(function(e){angular.isUndefined(e.data.MDC)||null==e.data.MDC||(p.busLocation={latitude:parseFloat(e.data.MDC.LastLatitude),longitude:parseFloat(e.data.MDC.LastLongitude),icon:{url:m}})},function(e){s.cancel(p.promise)})}v=0<u.navigator.userAgent.indexOf("Trident")||0<u.navigator.userAgent.indexOf("MSIE")?(m="images/pin-vehicle-blue.png",h="images/pin-busstop-grey.png","images/pin-location.png",f="images/pin-my-location.png","images/pin-hub.png"):(m="images/pin-vehicle-blue.svg",h="images/pin-busstop-grey.svg","images/pin-location.svg",f="images/pin-my-location.svg","images/pin-hub.svg"),p.hubIcon={url:v},p.myLocationIcon={url:f,size:new google.maps.Size(42,42),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(20,20)},p.tripDetails={busName:"",ETA:""},p.show=!0,p.markerEvent={click:function(e,t,n){p.show=!p.show}},p.center={latitude:47.604356,longitude:-122.3360817},p.zoom=4,p.incident=t.getIncident(),p.vehicleId=t.getVehicleId(),(angular.isUndefined(p.vehicleId)||null==p.vehicleId)&&(p.show=!1),p.stop=t.getStop()||null,null!=p.stop&&null!=p.stop.latitude&&null!=p.stop.latitude?p.stop.icon={url:h}:p.stop=null,p.vehicle={},p.myLocation=void 0,p.busLocation=void 0,p.hubs=[],p.incident?(p.tripDetails.ETA=(-1<p.incident.EstimatedTimeString.indexOf("-")?"Departed ":"")+p.incident.EstimatedTimeString.replace("-","")+" min"+(-1<p.incident.EstimatedTimeString.indexOf("-")?" ago":""),p.tripDetails.busName=angular.isUndefined(p.incident.TheVehicle)||null==p.incident.TheVehicle?"":p.incident.TheVehicle.VehicleName,p.schedType=p.incident.AMPM,p.incident.IncidentHubs&&0<p.incident.IncidentHubs.length&&angular.forEach(p.incident.IncidentHubs,function(e){0!=e.latitude&&0!=e.longitude&&p.hubs.push(e)})):p.show=!1,a.promise().then(function(e){return t.getVehicle(p.vehicleId)},function(e){g.showError("Sorrry! Map could not be loaded.")}).then(function(e){p.busLocation={latitude:parseFloat(e.data.MDC.LastLatitude),longitude:parseFloat(e.data.MDC.LastLongitude),icon:{url:m}},r(function(){google.maps.event.trigger(p.mapControl.getGMap(),"resize"),b()},50)},function(e){r(function(){google.maps.event.trigger(p.mapControl.getGMap(),"resize"),b()},50)}),p.promise=s(L,15e3),p.$onDestroy=function(){s.cancel(p.promise)},p.ionicInclude="app/modules/commuter/location/last-location.html",p.ionicCustomClassName="",p.ionicHideNavBar=!1,p.ionicUseRefresher=!1}angular.module("oneMVApp").controller("LastLocationController",e),e.$inject=["$rootScope","StopDataService","$q","$http","env","uiGmapIsReady","$stateParams","$interval","$window","GeoLocationService","$timeout","$state","MessageService"]}();
!function(){"use strict";function e(e,i){return{getLocation:function(e){var o=i.defer(),t=new google.maps.Geocoder,n=e;t?t.geocode({address:n},function(e,t){t==google.maps.GeocoderStatus.OK?o.resolve(e):o.reject(t)}):o.reject("Geocoder service not available");return o.promise},getDrivingDistances:function(e,t){var o=i.defer(),n=[];return angular.forEach(t,function(e,t){n.push({lat:e.latitude,lng:e.longitude})}),(new google.maps.DistanceMatrixService).getDistanceMatrix({origins:[{lat:e.latitude,lng:e.longitude}],destinations:n,travelMode:"DRIVING",unitSystem:google.maps.UnitSystem.METRIC,avoidHighways:!1,avoidTolls:!1},function(e,t){"OK"!==t?o.reject("Cannot calculate distance"):o.resolve(e)}),o.promise}}}angular.module("oneMVApp").factory("LocationService",e),e.$inject=["$http","$q"]}();
!function(){"use strict";function e(e,s,c){var n=this;switch(n.title=c.type,n.content=c.message,n.isError=!1,n.isInfo=!1,n.isSuccess=!1,n.cancel=function(){s.close()},c.type){case"Error":n.isError=!0;break;case"Information":n.isInfo=!0;break;case"Success":n.isSuccess=!0}}angular.module("oneMVApp").controller("MessageController",e),e.$inject=["$location","$uibModalInstance","message"]}();
!function(){"use strict";function e(e,s){return{showError:function(e){o(e,"Error")},showInformation:function(e){o(e,"Information")},showSuccess:function(e){o(e,"Success")}};function o(e,o){var n={message:e,type:o};s.open({animation:!0,templateUrl:"app/modules/commuter/message/message.html",controller:"MessageController as vm",size:"-fs",backdrop:"static",resolve:{message:n}}).result.then(function(){})}}angular.module("oneMVApp").factory("MessageService",e),e.$inject=["$http","$uibModal"]}();
!function(){"use strict";function e(i,e,n,s,o,a,t,l){var r=this,c=s.authentication.passengerId;r.vehicles=[],r.vehicleInfo=void 0,r.isLoading=!1,r.isRemoving=!1,r.PageService=l,r.PageService.setTitle("My Vehicles"),r.PageService.setHeadline("Manage Vehicles"),r.addNew=function(){n.open({animation:!0,templateUrl:"app/modules/commuter/modals/add-vehicle-modal/add-vehicle.html",controller:"AddVehicleController as vm",backdrop:"static",resolve:{atleastOneVehicleExist:0<r.vehicles.length}}).result.then(function(e){e.isAdded&&d()})},r.remove=function(e,i){e&&n.open({animation:!0,templateUrl:"app/modules/commuter/modals/remove-vehicle-modal/remove-vehicle-confirmation.html",controller:"RemoveVehicleConfirmationController as vm",size:"-fs",resolve:{id:function(){return e}}}).result.then(function(e){e.removed&&r.vehicles.splice(i,1),e.errorMessage&&a.showError(e.errorMessage)})};var h=function(){t.verify(s.authentication.passengerId),d()};r.makeDefault=function(e,i){o.markDefault(e,c).then(function(e){1==e.data.status&&d()},function(e){essageService.showError(e.data.result)})};var d=function(){r.isLoading=!0,o.getVehiclesForPassenger(c).then(function(e){e.data&&1==e.data.status&&null!=e.data.result.passengerVehicles&&(r.vehicles=e.data.result.passengerVehicles,0<r.vehicles.length&&(r.selectedVehicle=r.vehicles[0],r.hasVehicles=!0,r.needsParking=!1)),r.isLoading=!1},function(e){r.hasVehicles=!1,r.isLoading=!1})};h(),r.ionicInclude="app/modules/commuter/my-vehicles/my-vehicles.html",r.ionicCustomClassName="is-myVehicles",r.ionicHideNavBar=!1,r.ionicUseRefresher=!0,r.ionicPullingText="Refresh Vehicles",r.ionicRefreshingText="Loading Vehicles",r.ionicSpinner="spiral",r.refresh=function(e){r.isLoading=!0,r.vehicles=[],h(),i.$broadcast("scroll.refreshComplete"),r.isLoading=!1}}angular.module("oneMVApp").controller("MyVehiclesController",e),e.$inject=["$rootScope","$location","$uibModal","authService","vehicleService","MessageService","LuumLinkedService","PageService"]}();
!function(){"use strict";function e(u,o,i,e){return{save:function(e,n){return u({data:e,method:"POST",url:i.oneMVApiUrl+"commuter/passengers/"+n+"/vehicles"}).then(function(e){return e},function(e){return e})},getVehiclesForPassenger:function(e){return u({method:"GET",url:i.oneMVApiUrl+"commuter/passengers/"+e+"/vehicles"}).then(function(e){return e},function(e){return e})},removeVehicle:function(e,n){return u({method:"PUT",url:i.oneMVApiUrl+"commuter/passengers/"+n+"/vehicles/"+e+"/deactivate"}).then(function(e){return e},function(e){return e})},canPark:function(e,n){var r=o.defer(),t=i.oneMVApiUrl+"commuter/stops/"+e+"/availableParking/"+n;return u({method:"GET",url:t}).then(function(e){r.resolve(e)},function(e){r.reject(e)})},markDefault:function(e,n){return u({method:"PUT",url:i.oneMVApiUrl+"commuter/passengers/"+n+"/vehicles/"+e+"/markDefault"}).then(function(e){return e},function(e){return e})}}}angular.module("oneMVApp").factory("vehicleService",e),e.$inject=["$http","$q","env","DivisionService"]}();
!function(){"use strict";function e(t,n,o,i,s,a,r,u,e,c){var l=this;l.PageService=e,l.PageService.setTitle("Published Schedule"),l.PageService.setHeadline(c.getCommuterInfo().alias);var d=new Date,p=d.getDate(),f=d.getMonth()+1,h=d.getFullYear();function g(e){i.open({animation:!0,windowClass:"map-modal",templateUrl:"app/modules/commuter/modals/stops-map-modal/stops-map.html",controller:"StopsMapController as vm",backdrop:"static",size:"-fs",resolve:{schedule_stops:function(){return l.stopsLatLong},routeData:function(){return e}}}).result.then(function(e){},function(){})}l.date=f+"/"+p+"/"+h,l.scheduleBlock=[],l.publicSchedule=[],l.allSchdeuleForStop=[],l.stopsLatLong=[],l.incidentRecords=[],l.futureRoutes=[],l.turnLatLong=[],l.isLoading=!0,l.searchBy="$",l.selectedRoute=s.getRoute(),l.getDropOffPickUpClass=function(e,t){var o;o=e?t?"dropoff":"pickup":t?"pickup":"dropoff";return o},o.getSchedules(l.date).then(function(e){l.incidentRecords=e.data.result.routes,l.filterChange(),l.isLoading=!1},function(e){a.showError("Sorry! Could not load the schedules!"),l.isLoading=!1}),o.getUpComingSchedules(l.date).then(function(e){l.futureRoutes=e.data.result,l.isLoading=!1},function(e){}),l.filterChange=function(){if(""!=l.searchText&&null!=l.searchText){var e='{ "'+l.searchBy+'" : "'+l.searchText+'" }',t=JSON.parse(e);l.filterIncidents=r("filter")(l.incidentRecords,t)}else l.filterIncidents=l.incidentRecords;if(l.incidentRecords&&l.incidentRecords.sort(function(e,t){return e.longName.toLowerCase()>t.longName.toLowerCase()?1:t.longName.toLowerCase()>e.longName.toLowerCase()?-1:0}),angular.forEach(l.incidentRecords,function(e){e.stops&&angular.forEach(e.stops,function(e){e.arrivals&&e.arrivals.sort(function(e,t){return moment(e,"h:mm a").isAfter(moment(t,"h:mm a"))?1:moment(e,"h:mm a").isBefore(moment(t,"h:mm a"))?-1:0})})}),null!=l.selectedRoute&&null!=l.selectedRoute.routeId){var o=l.selectedRoute.routeId;n.hash()!==o?n.hash(o):u()}},l.navigateToStop=function(e){if(!e.isHub){var t={name:e.name,id:e.stopId,distance:null,icon:"images/pin-busstop.svg",latitude:e.latitude,longitude:e.longitude,address:e.address};s.setStop(t);l.position={coords:{latitude:e.latitude,longitude:e.longitude},icon:{url:"images/pin-my-location.svg"}},s.setGeoLocation(l.position),n.path("/commuter/selected-stop")}},l.getMap=function(e){l.stopsLatLong=l.filterIncidents[e],o.getTurnLatLngs(l.stopsLatLong.id).then(function(e){g(e.data)},function(e){})},l.getFutureRouteMap=function(e){l.stopsLatLong=e,o.getTurnLatLngs(l.stopsLatLong.RouteId).then(function(e){g(e.data)},function(e){})},t.$on("$locationChangeStart",function(e){s.setRoute(null)}),l.ionicInclude="app/modules/commuter/published-schedule/published-schedule.html",l.ionicCustomClassName="",l.ionicUseRefresher=!0,l.ionicPullingText="Refresh Schedule",l.ionicRefreshingText="Loading Schedule",l.ionicSpinner="spiral",l.refresh=function(e){t.$broadcast("scroll.refreshComplete")}}angular.module("oneMVApp").controller("PublishedScheduleController",e),e.$inject=["$scope","$location","PublishedScheduleService","$uibModal","StopDataService","MessageService","$filter","$anchorScroll","PageService","OneMvServices"]}();
!function(){"use strict";function e(i,u,c,s){return{getSchedules:function(e){var n=u.defer(),t=c.oneMVApiUrl+"commuter/"+s.getDivisionId()+"/schedule/published";return i({method:"GET",url:t}).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},getIncidents:function(e,n,t){var o=u.defer(),r=c.commuterApiUrl+"common/"+s.getDivisionId()+"/incidents/"+e;return i({method:"GET",url:r}).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},getAllScheduleForStop:function(e,n){var t=u.defer(),o=c.commuterApiUrl+"common/"+s.getDivisionId()+"/stop/"+e+"?RouteId=0";return i({method:"GET",url:o}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},getTurnLatLngs:function(e){var n=u.defer(),t=c.oneMVFixedRouteApiUrl+"route/shapesByRoute/"+e+"/206";return i({method:"GET",url:t}).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},getUpComingSchedules:function(e){var n=u.defer(),t=c.oneMVApiUrl+"commuter/"+s.getDivisionId()+"/schedule/upcoming";return i({method:"GET",url:t}).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise}}}angular.module("oneMVApp").factory("PublishedScheduleService",e),e.$inject=["$http","$q","env","DivisionService"]}();
!function(){"use strict";function e(o,e,t,n,i,a,r,s,l){var c=this;c.userId="b1c57df3-7604-47eb-bf51-317332a9f6a0",c.ScheduleType="AM",c.reserve=function(e){t.open({animation:!0,templateUrl:"app/modules/commuter/modals/reservation-modal/reservation.html",controller:"ReservationController as vm",size:"",resolve:{incidentToReserve:e,isAdd:!0}}).result.then(function(){m()})},c.cancelReservation=function(e){var t=e.TheReservation;s.cancelReservation(t.Id).then(function(e){e&&e.data&&1==e.data.status?(alert("Reservation Cancelled"),m()):alert(e.data.message)})},c.changeSchedule=function(){},c.selectedStop={name:"Test Stop 1",id:152131145,distance:null,icon:{url:"images/pin-busstop-grey.svg"},latitude:43.75514221191406,longitude:-116.57597351074219,$$hashKey:"object:113"};var d=a.getGeoLocation();c.fromLocation=null!=d?d.coords.latitude+","+d.coords.longitude:"",c.center={latitude:40.651739,longitude:-73.953148},c.zoom=10,c.mapControl={},c.options={},c.markerEvents=function(){},c.showDirections=null==d;var u=new google.maps.LatLngBounds;r.promise().then(function(e){c.showDirections?(u.extend(new google.maps.LatLng(c.selectedStop.latitude,c.selectedStop.longitude)),c.mapControl.getGMap().fitBounds(u),google.maps.event.trigger(c.mapControl.getGMap(),"resize")):g(c.fromLocation)}),m(),c.getDirection=function(){(new google.maps.Geocoder).geocode({address:c.fromLocation},function(e,t){t===google.maps.GeocoderStatus.OK&&g(e[0].geometry.location.lat()+","+e[0].geometry.location.lng())})};var g=function(e){var o=new google.maps.DirectionsRenderer,t=new google.maps.DirectionsService,n=document.getElementById("directions");o.setPanel(n),t.route({origin:e,destination:c.selectedStop.latitude+","+c.selectedStop.longitude,travelMode:google.maps.DirectionsTravelMode.DRIVING},function(e,t){"OK"===t?(o.setDirections(e),o.setMap(c.mapControl.getGMap())):window.alert("Directions request failed due to "+t)})};function m(){n.getSchedule(c.selectedStop.id,c.userId,0).then(function(e){c.nonPerformedIncidents=e.data})}c.navigateToTripPage=function(e){var t=c.nonPerformedIncidents[e];o.path("/commuter/selected-trip/"+l.getDivisionId()+"/"+t.BlockId+"/"+t.IncidentId)}}angular.module("oneMVApp").controller("ScheduleController",e),e.$inject=["$location","$stateParams","$uibModal","ScheduleService","env","StopDataService","uiGmapIsReady","ReservationService","DivisionService"]}();
!function(){"use strict";function t(t,o,e){var r=this;r.title="Selected Trip";var n=o.stopId,i={};r.center={latitude:40.651739,longitude:-73.953148},r.zoom=10,r.mapControl={},r.stopsMarkerArray=[],e.promise().then(function(t){google.maps.event.trigger(r.mapControl.getGMap(),"resize")}),t.getTrips(o.blockId,o.minIncId,5).then(function(t){r.upComingStops=t.data,i=r.upComingStops.slice(-1)[0],r.endStoplocation=i.TheStop;for(var o=0;o<r.upComingStops.length;o++)r.upComingStops[o].TheStop.StopId==n?r.startStopLocation=r.upComingStops[o].TheStop:r.upComingStops[o].TheStop.StopId!=r.endStoplocation.StopId&&(r.stopsMarkers={lat:r.upComingStops[o].TheStop.Latitude,lng:r.upComingStops[o].TheStop.Longitude},r.stopsMarkerArray.push({location:r.stopsMarkers,stopover:!1}));p()},function(t){});var p=function(){var t=r.startStopLocation.Latitude+","+r.startStopLocation.Longitude,o=r.endStoplocation.Latitude+","+r.endStoplocation.Longitude,e=new google.maps.DirectionsRenderer({suppressMarkers:!0}),n=new google.maps.DirectionsService;r.stopsMarkerArray.splice(-1,1),n.route({origin:t,destination:o,waypoints:r.stopsMarkerArray,travelMode:google.maps.DirectionsTravelMode.DRIVING},function(t,o){"OK"===o?(e.setDirections(t),e.setMap(r.mapControl.getGMap())):window.alert("Directions request failed due to "+o)})}}angular.module("oneMVApp").controller("SelectedTripController",t),t.$inject=["SelectedTripService","$stateParams","uiGmapIsReady"]}();
!function(){"use strict";function e(c,o,u,m){return{getTrips:function(e,n,i){var t=o.defer(),r=u.commuterApiUrl+"common"+m.getDivisionId()+"/incidents/"+e+"?minIncId="+n+"&incCount="+i;return c({method:"GET",url:r}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise}}}angular.module("oneMVApp").factory("SelectedTripService",e),e.$inject=["$http","$q","env","DivisionService"]}();
!function(){"use strict";function t(){return{restrict:"E",scope:{divisionAllowsWaitlist:"=",trip:"="},templateUrl:"app/modules/commuter/stop/seat-availability.component.html"}}angular.module("oneMVApp").directive("seatAvailability",t),t.$inject=[]}();
!function(){"use strict";function e(a,o,e,i,t,s,n,r,l,d,c,u,p,v,m,g,h,f){var S=this;S.selectedStop=n.getStop(),S.PageService=v,S.PageService.setTitle(S.selectedStop.name),S.PageService.setHeadline(f.getCommuterInfo().alias),S.hubs=[],S.selectedHub=void 0,S.availableParking=0,S.nonPerformedTrips=[],S.show=!1,S.calendarOpened=!1,S.passengerReservation=void 0,S.isLoading=!1,S.calendar={},S.calendar.opened=!1,S.calendar.dateOptions={},S.isPassengerLoggedIn=l.isLoggedIn(),S.hasReservation=!1,S.advReservationWindow=14,S.markers=[],S.map=c.initializeMap();var C=void 0,D=[],L=void 0,M=[{event:"click",callback:function(e){S.show=!0,S.coords=e.coords}}];S.divisionAllowsWaitlist=!0,S.companionAllowed=!1,S.specialEvent=void 0,S.selectGuestDay=function(){S.selectedReservationDate=moment(S.specialEvent.date,"YYYY-MM-DD HH:mm").toDate(),S.dateChanged()},S.getDirectionsToSelectedStop=function(){n.setStop(S.selectedStop),a.path("/commuter/directions")},S.openMapApp=function(){var e="";0<(e=-1!=navigator.platform.indexOf("iPhone")||-1!=navigator.platform.indexOf("iPod")||-1!=navigator.platform.indexOf("iPad")?"http://maps.apple.com/?q="+S.selectedStop.latitude+","+S.selectedStop.longitude:"http://maps.google.com/?q="+S.selectedStop.latitude+","+S.selectedStop.longitude).length&&($("body").hasClass("platform-cordova")?window.open(e,"_system",""):window.open(e))},S.openCalendar=function(){S.calendar.opened=!0};var w=function(){var e,t,n;S.calendar.dateOptions={minDate:C,maxDate:(e=C,t=S.advReservationWindow,n=new Date(e),n.setDate(n.getDate()+t),n)}};function R(){S.specialEvent=void 0,n.getSpecialEvent(S.selectedStop.id,S.selectedSchedule).then(function(e){e&&1==e.data.status&&e.data.result.date&&(S.specialEvent=e.data.result)})}function b(){n.getMaxDaysAllowedForReservation(S.selectedStop.id,S.selectedSchedule).then(function(e){1==e.data.status&&e.data.result&&(S.advReservationWindow=e.data.result,w())},function(e){w()})}function P(){return S.selectedSchedule==u.ScheduleType.Morning?S.selectedStop:S.selectedHub}function T(){return S.selectedSchedule==u.ScheduleType.Morning?S.selectedHub:S.selectedStop}S.dateChanged=function(){null==S.selectedReservationDate&&(S.selectedReservationDate=C),S.selectedReservationDate=moment(moment(S.selectedReservationDate).format("MM/DD/YYYY")).toDate(),S.selectedSchedule=u.ScheduleType.Morning,R(),I()};var I=function(){S.isLoading=!0,S.nonPerformedTrips=[],S.passengerReservation=void 0,S.hasReservation=!1,S.companionAllowed=!1,S.selectedHub&&S.selectedSchedule&&S.selectedReservationDate&&n.getNonPerformedTrips(P().id,T().id,S.selectedSchedule,y()).then(function(e){1==e.data.status&&e.data.result.NonPerformedTrips&&(S.nonPerformedTrips=e.data.result.NonPerformedTrips,function(){for(var e=0;e<S.nonPerformedTrips.length;e++)if(0<S.nonPerformedTrips[e].allowedCompanions){S.companionAllowed=!0;break}}(),k(),Y(),A(),L=t(function(){Y()},3e4)),S.isLoading=!1,(S.availableParking=0)<S.nonPerformedTrips.length&&H()},function(e){})};var k=function(){S.isPassengerLoggedIn&&r.getUserReservationFor(l.authentication.passengerId,S.selectedSchedule,y()).then(function(e){1==e.data.status&&e.data.result&&e.data.result.reservations&&(S.passengerReservation=e.data.result.reservations[0],S.hasReservation=!0)},function(e){})},H=function(){n.getAvailableParkingsForStop(S.selectedStop.id,y()).then(function(e){1==e.data.status&&(S.availableParking=e.data.result)},function(e){})};e.$watch("vm.selectedSchedule",function(e){e&&(n.getHubs(S.selectedStop.id,S.selectedSchedule,y()).then(function(e){1==e.data.status&&(S.hubs=e.data.result.hubs,0<S.hubs.length&&(S.selectedHub=S.hubs[0]))},function(e){}),R())}),e.$watch("vm.selectedHub",function(e){e&&(I(),S.show=!1,S.markers=[],S.markers.push({latitude:S.selectedStop.latitude,longitude:S.selectedStop.longitude,icon:p.getCommuterStopIcon(),name:S.selectedStop.name,address:S.selectedStop.address}),S.markers.push({latitude:S.selectedHub.latitude,longitude:S.selectedHub.longitude,icon:p.getCommuterHubIcon(),name:S.selectedHub.name,address:S.selectedHub.address}),c.setMapBounds(S.markers,M))});var y=function(){return Date.parse(S.selectedReservationDate)};function Y(){var t=[],e=0;0<S.nonPerformedTrips.length&&(e=S.nonPerformedTrips[0].routeId,angular.forEach(S.nonPerformedTrips,function(e){e.vehicleId&&0!=e.vehicleId&&t.push(e.vehicleId)}),0<t.length&&0!=e&&m.GetCommuterVehicles(t,e).then(function(e){e&&1==e.data.status&&function(e){0<D.length&&angular.forEach(D,function(e){e.setMap(null)});D=[];for(var t=0;t<e.length;t++){var n=e[t],a=new google.maps.Marker({position:new google.maps.LatLng(n.latitude,n.longitude),map:S.map.control.getGMap(),optimized:!1,flat:!0,icon:{path:"M15.2413122,21.1527861 L11,26 L6.75861856,21.1527069 C2.78910959,19.4927506 0,15.5728475 0,11 C0,4.92486775 4.923532,0 11,0 C17.0751322,0 22,4.923532 22,11 C22,15.5720845 19.2113515,19.4926684 15.2413122,21.1527861 Z",scale:1.1,fillOpacity:1,fillColor:"#fff",strokeWeight:1,strokeOpacity:.3,rotation:n.heading,origin:new google.maps.Point(0,0),anchor:new google.maps.Point(n.anchorX,n.anchorY)},zIndex:2}),o=new google.maps.Marker({position:new google.maps.LatLng(n.latitude,n.longitude),map:S.map.control.getGMap(),icon:{path:"M0,10 C0,4.4771525 4.47593818,0 10,0 C15.5228475,0 20,4.47593818 20,10 C20,15.5228475 15.5240618,20 10,20 C4.4771525,20 0,15.5240618 0,10 Z M5,5 L5,13.8 L5.81904762,13.8 L5.81904762,15 L7,15 L7,13.8 L13,13.8 L13,15 L14.1809524,15 L14.1809524,13.8 L15,13.8 L15,5 L5,5 Z M14.6336996,9.71610209 C14.6336996,9.99255627 14.405522,10.2166667 14.1374134,10.2166667 L5.89921665,10.2166667 C5.62512532,10.2166667 5.4029304,10.0022513 5.4029304,9.71610209 L5.4029304,7.11723124 C5.4029304,6.84077706 5.63110799,6.61666667 5.89921665,6.61666667 L14.1374134,6.61666667 C14.4115047,6.61666667 14.6336996,6.83108203 14.6336996,7.11723124 L14.6336996,9.71610209 Z M5.38461538,5.8 C5.38461538,5.5790861 5.56076967,5.4 5.78125,5.4 L14.21875,5.4 C14.4378052,5.4 14.6153846,5.58554688 14.6153846,5.8 C14.6153846,6.0209139 14.4392303,6.2 14.21875,6.2 L5.78125,6.2 C5.56219475,6.2 5.38461538,6.01445313 5.38461538,5.8 Z M5.38461538,11.6 C5.38461538,11.2686292 5.65201099,11 5.99308894,11 L6.69921875,11 C7.03526942,11 7.30769231,11.2783203 7.30769231,11.6 C7.30769231,11.9313708 7.0402967,12.2 6.69921875,12.2 L5.99308894,12.2 C5.65703828,12.2 5.38461538,11.9216797 5.38461538,11.6 Z M12.6923077,11.6 C12.6923077,11.2686292 12.9597033,11 13.3007812,11 L14.0069111,11 C14.3429617,11 14.6153846,11.2783203 14.6153846,11.6 C14.6153846,11.9313708 14.347989,12.2 14.0069111,12.2 L13.3007812,12.2 C12.9647306,12.2 12.6923077,11.9216797 12.6923077,11.6 Z",fillOpacity:1,strokeOpacity:0,fillColor:"#555",scale:1},zIndex:3});D.push(a),D.push(o)}}(e.data.result)},function(e){}))}function A(){angular.isDefined(L)&&(t.cancel(L),L=void 0)}S.reserve=function(n){var e;S.isPassengerLoggedIn?function(e){if(S.hasReservation)return!1;return S.divisionAllowsWaitlist?0<e.totalPassengers:0<e.availableCapacity}(n)&&i.open((e=n,{animation:!0,templateUrl:"app/modules/commuter/modals/reservation-modal/reservation.html",controller:"ReservationController as vm",size:"-fs",backdrop:"static",resolve:{reservationInfo:{divisionId:d.getDivisionId(),passengerId:l.authentication.passengerId,pickupStop:P(),dropoffStop:T(),trip:e,scheduleType:S.selectedSchedule,reservationDate:S.selectedReservationDate},isAdd:!0}})).result.then(function(e){var t;e&&"close"===e.action&&e.isReserved?I():e&&"reservation"===e.action?a.path("/passenger-trips"):e&&"vehicle"===e.action&&(t=n,i.open({animation:!0,templateUrl:"app/modules/commuter/modals/add-vehicle-modal/add-vehicle.html",controller:"AddVehicleController as vm",backdrop:"static",resolve:{atleastOneVehicleExist:!1}}).result.then(function(e){S.reserve(t)})),o.$broadcast("reservationChanged")}):s.go("login")},S.cancelReservation=function(){var e={reservationId:S.passengerReservation.id,routeName:S.passengerReservation.routeName,passengerId:l.authentication.passengerId,startTime:S.passengerReservation.pickupTime,reservationDate:S.passengerReservation.reservationDate};i.open({animation:!0,templateUrl:"app/modules/commuter/modals/cancel-reservation-modal/cancel-reservation.html",controller:"CancelReservationController as vm",size:"-fs",resolve:{reservationInfo:function(){return e}}}).result.then(function(e){e.isCancel&&(I(),o.$broadcast("reservationChanged"))})},S.goToSchedule=function(){n.setRoute(stop),a.path("/commuter/published-schedule")},S.viewReservation=function(){i.open({animation:!0,templateUrl:"app/modules/shared/trips/commuter-trip-modal.html",controller:"CommuterTripModalController as vm",size:"-fs",backdrop:"static",keyboard:!1,resolve:{tripId:S.passengerReservation.id}}).result.then(function(e){(e.cancelled||e.isModified)&&(I(),o.$broadcast("reservationChanged"))})},h.verify(l.authentication.passengerId),d.getCurrentDivisionTime().then(function(e){1==e.data.status?(C=moment(e.data.result,"YYYY-MM-DD HH:mm").toDate(),S.selectedReservationDate=C,S.selectedSchedule=new Date(e.data.result).getHours()<12?u.ScheduleType.Morning:u.ScheduleType.Evening,b()):C=new Date},function(e){C=new Date}),d.isWaitlistAllowedByDivision().then(function(e){S.divisionAllowsWaitlist=e}),d.getCurrentDivisionTime().then(function(e){1==e.data.status?(C=moment(e.data.result,"YYYY-MM-DD HH:mm").toDate(),S.selectedReservationDate=C,S.selectedSchedule=new Date(e.data.result).getHours()<12?u.ScheduleType.Morning:u.ScheduleType.Evening,b(),R()):C=new moment},function(e){C=new moment}),e.$on("$destroy",function(e){A()}),S.ionicInclude="app/modules/commuter/stop/selected-stop.html",S.ionicCustomClassName="",S.ionicHideNavBar=!1,S.ionicUseRefresher=!1}angular.module("oneMVApp").controller("SelectedStopController",e),e.$inject=["$location","$rootScope","$scope","$uibModal","$interval","$state","StopDataService","ReservationService","authService","DivisionService","MapService","CommonService","MapIconService","PageService","VehicleDataService","ScheduleService","LuumLinkedService","OneMvServices"]}();
!function(){"use strict";angular.module("oneMVApp").directive("nonPerformedTripComponent",function(){return{restrict:"E",scope:{trip:"=",divisionAllowsWaitlist:"="},templateUrl:"app/modules/commuter/stop/selectedStop-npt.component.html"}})}();
!function(){"use strict";function e(c,u,s,e,t,l){e("LocationCache");return{setStop:function(e){t.set("stop",e),e},getStop:function(){return t.get("stop")},setGeoLocation:function(e){t.set("currLocation",e),e},getGeoLocation:function(){return t.get("currLocation")},getStopDetails:function(e){var t=c.defer(),n=s.commuterApiUrl+"stop/"+l.getDivisionId()+"/"+e;return u({method:"GET",url:n,contentType:"application/json"}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},getIncidentsForStop:function(e,t){var n=c.defer(),o=s.commuterApiUrl+"stop/"+l.getDivisionId()+"/incidents/"+e+"/"+t+"?rnd="+(new Date).getMilliseconds();return u({method:"GET",url:o,contentType:"application/json"}).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},getUserIncidentsForStop:function(e,t,n){var o=c.defer(),r=s.commuterApiUrl+"stop/"+l.getDivisionId()+"/incidents/"+e+"/"+t+"/"+n+"?rnd="+(new Date).getMilliseconds();return u({method:"GET",url:r,contentType:"application/json"}).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},getUserIncidentsById:function(e,t){var n=c.defer(),o=s.commuterApiUrl+"stop/"+l.getDivisionId()+"/incident/"+e+"/"+t+"?rnd="+(new Date).getMilliseconds();return u({method:"GET",url:o,contentType:"application/json"}).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},getVehicle:function(e){var t=s.commuterApiUrl+"common/"+l.getDivisionId()+"/vehicle/"+e+"?rnd="+(new Date).getMilliseconds(),n=c.defer();return angular.isUndefined(e)||null==e?n.reject("No Vehicle Found"):u({method:"GET",url:t}).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},getIncident:function(){return t.get("incident")},setIncident:function(e){t.set("incident",e)},getRoute:function(){return t.get("route")},setRoute:function(e){t.set("route",e)},getVehicleId:function(){return t.get("vehicle")},setVehicleId:function(e){t.set("vehicle",e)},clearItem:function(e){t.remove(e)},getHubs:function(e,t,n){var o=s.oneMVApiUrl+"commuter/"+l.getDivisionId()+"/"+e+"/hubs/"+t+"/"+n+"?rnd="+(new Date).getMilliseconds(),r=c.defer();return u({method:"GET",url:o}).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},getAvailableParkingsForStop:function(e,t){var n=s.oneMVApiUrl+"commuter/stops/"+e+"/availableParking/"+t+"?rnd="+(new Date).getMilliseconds(),o=c.defer();return u({method:"GET",url:n}).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},getNonPerformedTrips:function(e,t,n,o){var r=s.oneMVApiUrl+"commuter/"+l.getDivisionId()+"/stops/nonperformedtrips/"+e+"/"+t+"/"+o+"/"+n+"?rnd="+(new Date).getMilliseconds(),i=c.defer();return u({method:"GET",url:r}).then(function(e){i.resolve(e)},function(e){i.reject(e)}),i.promise},getDropoffsForSelectedPickup:function(e){var t=s.oneMVApiUrl+"commuter/"+l.getDivisionId()+"/"+e+"/dropOffs?rnd="+(new Date).getMilliseconds(),n=c.defer();return u({method:"GET",url:t}).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},getTripTimesForAdvancedReservation:function(e,t,n){var o=s.oneMVApiUrl+"commuter/"+l.getDivisionId()+"/alltrips/"+e+"/"+t+"/"+n+"/?rnd="+(new Date).getMilliseconds(),r=c.defer();return u({method:"GET",url:o}).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise},getMaxDaysAllowedForReservation:function(e,t){var n=s.oneMVApiUrl+"commuter/"+l.getDivisionId()+"/stops/"+e+"/advancedDays/"+t+"?rnd="+(new Date).getMilliseconds(),o=c.defer();return u({method:"GET",url:n}).then(function(e){o.resolve(e)},function(e){o.reject(e)}),o.promise},getAllBusStops:function(){var t=c.defer(),e=s.oneMVApiUrl+"commuter/"+l.getDivisionId()+"/stops/commuter/0";return u({method:"GET",url:e}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},getPickupForReturnTrip:function(e,t){var n=c.defer(),o=s.oneMVApiUrl+"commuter/pickup/"+l.getDivisionId()+"/"+e+"/"+t;return u({method:"GET",url:o}).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},getSpecialEvent:function(e,t){var n=c.defer(),o=s.oneMVApiUrl+"commuter/specialEvent/"+l.getDivisionId()+"/"+e+"/"+t;return u({method:"GET",url:o}).then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise}}}angular.module("oneMVApp").factory("StopDataService",e),e.$inject=["$q","$http","env","$cacheFactory","localStorageService","DivisionService"]}();
!function(){"use strict";function e(c,o,n,e,t,u){return{GetCommuterVehicles:function(e,t){var r=n.oneMVApiUrl+"commuter/"+u.getDivisionId()+"/CommuterVehicles",i=c.defer();return o({method:"GET",url:r,params:{vehicleIds:e,routeId:t}}).then(function(e){i.resolve(e)},function(e){i.reject(e)}),i.promise}}}angular.module("oneMVApp").factory("VehicleDataService",e),e.$inject=["$q","$http","env","$cacheFactory","localStorageService","DivisionService"]}();
!function(){"use strict";function o(o,e,t,i,n,l,a,s,r,g){var p,L,c,d=this;function m(){var a=d.mapControl.getGMap();l.getAllStops(p).then(function(o){for(var e=o.data,t=0;t<e.length;t++){var i=e[t],n=new google.maps.LatLng(i.Latitude,i.Longitude);new google.maps.Marker({position:n,map:a,optimized:!1,icon:{path:"M0,2.99420208 C0,1.34054993 1.34331197,0 2.99420208,0 L17.0057979,0 C18.6594501,0 20,1.34331197 20,2.99420208 L20,17.0057979 C20,18.6594501 18.656688,20 17.0057979,20 L2.99420208,20 C1.34054993,20 0,18.656688 0,17.0057979 L0,2.99420208 Z M6,20 L13.7690812,20 L9.75999999,22.76 L6,20 Z",fillOpacity:1,fillColor:"#F76F1E",strokeWeight:0,anchor:new google.maps.Point(9,21),size:new google.maps.Size(20,23)},zIndex:5,animation:google.maps.Animation.DROP}),new google.maps.Marker({position:n,map:a,optimized:!1,icon:{path:"M0,0 L0,13.0899217 C0,13.6367269 0.443667457,14.08 1.00653274,14.08 L1.31047619,14.08 L1.31047619,16 L3.2,16 L3.2,14.08 L12.8,14.08 L12.8,16 L14.6895238,16 L14.6895238,14.08 L14.9934673,14.08 C15.5493599,14.08 16,13.6274801 16,13.0899217 L16,0.990078259 C16,0.443273135 15.5553691,0 14.9991283,0 L0,0 Z M15.4139194,7.85557231 C15.4139194,8.12679623 15.1819301,8.34666667 14.9225207,8.34666667 L1.13608738,8.34666667 C0.864695354,8.34666667 0.644688645,8.12790141 0.644688645,7.85557231 L0.644688645,3.07776103 C0.644688645,2.8065371 0.876677992,2.58666667 1.13608738,2.58666667 L14.9225207,2.58666667 C15.1939127,2.58666667 15.4139194,2.80543193 15.4139194,3.07776103 L15.4139194,7.85557231 Z M0.615384615,1.1312207 C0.615384615,0.859927 0.847373962,0.64 1.10678335,0.64 L14.8932166,0.64 C15.1646087,0.64 15.3846154,0.862958984 15.3846154,1.1312207 L15.3846154,1.4287793 C15.3846154,1.700073 15.152626,1.92 14.8932166,1.92 L1.10678335,1.92 C0.835391324,1.92 0.615384615,1.69704102 0.615384615,1.4287793 L0.615384615,1.1312207 Z M0.615384615,10.56 C0.615384615,10.0298066 1.04321759,9.6 1.57207584,9.6 L2.73561646,9.6 C3.26398244,9.6 3.69230769,10.0261102 3.69230769,10.56 C3.69230769,11.0901934 3.26447472,11.52 2.73561646,11.52 L1.57207584,11.52 C1.04370987,11.52 0.615384615,11.0938898 0.615384615,10.56 Z M12.3076923,10.56 C12.3076923,10.0298066 12.7355253,9.6 13.2643835,9.6 L14.4279242,9.6 C14.9562901,9.6 15.3846154,10.0261102 15.3846154,10.56 C15.3846154,11.0901934 14.9567824,11.52 14.4279242,11.52 L13.2643835,11.52 C12.7360176,11.52 12.3076923,11.0938898 12.3076923,10.56 Z M11.423955,11.1999507 C11.6340659,11.3767363 11.5848839,11.5200493 11.3051605,11.5200493 L4.69483948,11.5200493 C4.41912022,11.5200493 4.36801543,11.3749851 4.57604503,11.1999507 L4.19560559,11.5200493 C4.40571649,11.3432637 4.80388725,11.1999507 5.06852983,11.1999507 L10.9314702,11.1999507 C11.203462,11.1999507 11.5963648,11.3450149 11.8043944,11.5200493 L11.423955,11.1999507 Z M11.423955,11.8399507 C11.6340659,12.0167363 11.5848839,12.1600493 11.3051605,12.1600493 L4.69483948,12.1600493 C4.41912022,12.1600493 4.36801543,12.0149851 4.57604503,11.8399507 L4.19560559,12.1600493 C4.40571649,11.9832637 4.80388725,11.8399507 5.06852983,11.8399507 L10.9314702,11.8399507 C11.203462,11.8399507 11.5963648,11.9850149 11.8043944,12.1600493 L11.423955,11.8399507 Z",fillColor:"#fff",fillOpacity:1,strokeWeight:0,anchor:new google.maps.Point(7,19),size:new google.maps.Size(16,16)},zIndex:6,animation:google.maps.Animation.DROP}),new google.maps.Marker({position:n,map:a,optimized:!1,icon:{path:"M-5.83252597,14.3155545 C-6.35350295,13.5889938 -5.4359106,13 -3.78917972,13 L10.1871155,13 C11.8366015,13 13.5969795,13.5902074 14.1170863,14.3155545 L18.5313877,20.4717917 C19.0523647,21.1983524 18.1347724,21.7873462 16.4880415,21.7873462 L2.51174624,21.7873462 C0.862260281,21.7873462 -0.898117751,21.1971389 -1.41822457,20.4717917 L-5.83252597,14.3155545 Z M5.5099714,21.7873462 L13.2594793,21.7873462 L10.1300263,23 L5.5099714,21.7873462 Z",fillColor:"#000",fillOpacity:.1,strokeWeight:0,anchor:new google.maps.Point(9,21),size:new google.maps.Size(21,10)},zIndex:4,animation:google.maps.Animation.DROP})}})}r.setTitle("Stops / Routes"),r.setHeadline(g.getFixedRouteInfo().alias),d.optionSelection="stop",d.gotoRoutes=function(){e.path("fixed-route/allRoutes")},d.gotoStops=function(){e.path("fixed-route/stops")},L=0<o.navigator.userAgent.indexOf("Trident")||0<o.navigator.userAgent.indexOf("MSIE")?"images/pin-my-location.png":"images/pin-my-location.svg",d.zoom=15,d.center={latitude:39.80986,longitude:-98.555183},d.myStyles=a.mapStyles,d.mapOptions={mapTypeControl:!1,zoomControl:!1,streetViewControl:!1,styles:d.myStyles},d.myLocationIcon={url:L,size:new google.maps.Size(42,42),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(20,20)},d.mapControl={},d.allStops=[],c=function(){i.promise().then(function(o){s.getCurrentPosition().then(function(o){d.position={coords:{latitude:o.coords.latitude,longitude:o.coords.longitude},icon:d.myLocationIcon},d.center.latitude=o.coords.latitude,d.center.longitude=o.coords.longitude,m(),google.maps.event.trigger(d.mapControl.getGMap(),"resize")},function(o){t.getServiceAreaLocation(p).then(function(o){1==o.data.status&&(d.center.latitude=o.data.result.Latitude,d.center.longitude=o.data.result.Longitude,void 0!==o.data.result.ZoomLevel&&null!==o.data.result.ZoomLevel&&""!=o.data.result.ZoomLevel&&(d.zoom=o.data.result.ZoomLevel))}),m(),google.maps.event.trigger(d.mapControl.getGMap(),"resize")})})},null!=(p=n.getDivisionId())&&null!=p&&""!=p?c&&"function"==typeof c&&c():e.path("dashboard/"),d.ionicSpinner="spiral",d.ionicInclude="app/modules/fixed-route/Landing/landing.html",d.ionicCustomClassName="ionic-fixed-route-landing",d.ionicHideNavBar=!1,d.ionicUseRefresher=!1}angular.module("oneMVApp").controller("LandingController",o),o.$inject=["$window","$location","ScheduleService","uiGmapIsReady","DivisionService","StopService","googleMapsConfig","GeoLocationService","PageService","OneMvServices"]}();
!function(){"use strict";function e(e,a,t,o,n,i,s,r,p,l,u,g){var c,d,f=this,L=new google.maps.InfoWindow({content:""});f.displaySelectedRoutes=function(){d=new google.maps.LatLngBounds;for(var e=0;e<f.filteredRoutes.length;e++){var t=f.filteredRoutes[e];t.displayOnMap?y(t):v(t)}},f.displayRoute=function(e){e.displayOnMap?y(e):v(e)},f.filterChange=function(e){return void 0===f.search_text||null===f.search_text||""===f.search_text.trim()||-1!==e.name.toLowerCase().indexOf(f.search_text.toLowerCase())||-1!==e.shortName.toLowerCase().indexOf(f.search_text.toLowerCase())},f.gotoStops=function(){t.path("fixed-route/stops")},f.displayButton=function(){for(var e=0;e<f.routes.length;e++)if(f.routes[e].displayOnMap)return!0;return!1},f.goToRoute=function(e){t.path("fixed-route/route/"+e)},f.hightlightRoute=function(e,t){if(null!=f.routesOnMap[e]&&null!=f.routesOnMap[e]&&f.routesOnMap[e].displayOnMap)for(var o in f.routesOnMap[e].lines)t?f.routesOnMap[e].lines[o].setOptions({strokeOpacity:.8}):f.routesOnMap[e].lines[o].setOptions({strokeOpacity:.5})},f.zoom=15,f.routes=[],f.filteredRoutes=[],f.loading=!0;var M=void 0;function C(t){if(void 0!==f.routesOnMap[t].vehicles)for(var e=0;e<f.routesOnMap[t].vehicles.length;e++)f.routesOnMap[t].vehicles[e].setMap(null);f.routesOnMap[t].vehicles=[],r.getVehiclesForRoute(t).then(function(e){e&&e.data&&0<e.data.length&&function(e,t){for(var o=0;o<e.data.length;o++){var n=e.data[o],a=new google.maps.Marker({position:new google.maps.LatLng(n.latitude,n.longitude),map:f.mapControl.getGMap(),optimized:!1,flat:!0,icon:{path:"M15.2413122,21.1527861 L11,26 L6.75861856,21.1527069 C2.78910959,19.4927506 0,15.5728475 0,11 C0,4.92486775 4.923532,0 11,0 C17.0751322,0 22,4.923532 22,11 C22,15.5720845 19.2113515,19.4926684 15.2413122,21.1527861 Z",scale:1.1,fillOpacity:1,fillColor:"#fff",strokeWeight:1,strokeOpacity:.3,rotation:n.heading,origin:new google.maps.Point(0,0),anchor:new google.maps.Point(n.anchorX,n.anchorY)},zIndex:2}),i=new google.maps.Marker({position:new google.maps.LatLng(n.latitude,n.longitude),map:f.mapControl.getGMap(),icon:{path:"M0,10 C0,4.4771525 4.47593818,0 10,0 C15.5228475,0 20,4.47593818 20,10 C20,15.5228475 15.5240618,20 10,20 C4.4771525,20 0,15.5240618 0,10 Z M5,5 L5,13.8 L5.81904762,13.8 L5.81904762,15 L7,15 L7,13.8 L13,13.8 L13,15 L14.1809524,15 L14.1809524,13.8 L15,13.8 L15,5 L5,5 Z M14.6336996,9.71610209 C14.6336996,9.99255627 14.405522,10.2166667 14.1374134,10.2166667 L5.89921665,10.2166667 C5.62512532,10.2166667 5.4029304,10.0022513 5.4029304,9.71610209 L5.4029304,7.11723124 C5.4029304,6.84077706 5.63110799,6.61666667 5.89921665,6.61666667 L14.1374134,6.61666667 C14.4115047,6.61666667 14.6336996,6.83108203 14.6336996,7.11723124 L14.6336996,9.71610209 Z M5.38461538,5.8 C5.38461538,5.5790861 5.56076967,5.4 5.78125,5.4 L14.21875,5.4 C14.4378052,5.4 14.6153846,5.58554688 14.6153846,5.8 C14.6153846,6.0209139 14.4392303,6.2 14.21875,6.2 L5.78125,6.2 C5.56219475,6.2 5.38461538,6.01445313 5.38461538,5.8 Z M5.38461538,11.6 C5.38461538,11.2686292 5.65201099,11 5.99308894,11 L6.69921875,11 C7.03526942,11 7.30769231,11.2783203 7.30769231,11.6 C7.30769231,11.9313708 7.0402967,12.2 6.69921875,12.2 L5.99308894,12.2 C5.65703828,12.2 5.38461538,11.9216797 5.38461538,11.6 Z M12.6923077,11.6 C12.6923077,11.2686292 12.9597033,11 13.3007812,11 L14.0069111,11 C14.3429617,11 14.6153846,11.2783203 14.6153846,11.6 C14.6153846,11.9313708 14.347989,12.2 14.0069111,12.2 L13.3007812,12.2 C12.9647306,12.2 12.6923077,11.9216797 12.6923077,11.6 Z",fillOpacity:1,strokeOpacity:0,fillColor:f.routesOnMap[t].route.color,scale:1},zIndex:3});f.routesOnMap[t].vehicles.push(i),f.routesOnMap[t].vehicles.push(a)}}(e,t)},h)}function h(){}function m(i,s){return function(){p.getArrivalsByStopId(c,i.Id).then(function(e){for(var t=e.data,o='<span style="font-weight: bold;">'+i.Name+"</span><br />",n=0;n<t.length;n++){o+='<span style="color:'+t[n].route.color+';">'+t[n].route.shortName+"</span><br />";for(var a=0;a<t[n].trips.length;a++)o+="&nbsp;&nbsp;"+(null==t[n].trips[a].vehicle.name?"Bus":t[n].trips[a].vehicle.name)+" in "+t[n].trips[a].etaInMins+" minutes <br />"}""==o&&(o="No current arrivals at this stop"),L.setContent(o),L.open(f.mapControl.getGMap(),s)})}}function O(){var e=0;for(var t in d=new google.maps.LatLngBounds,f.routesOnMap)if(f.routesOnMap[t].displayOnMap){e++;for(var o=0;o<f.routesOnMap[t].lines.length;o++)d.union(R(f.routesOnMap[t].lines[o]))}0<e&&f.mapControl.getGMap().fitBounds(d)}function v(e){if(null!=f.routesOnMap[e.id]&&null!=f.routesOnMap[e.id]&&f.routesOnMap[e.id].displayOnMap){f.routesOnMap[e.id].displayOnMap=!1;for(var t=0;t<f.routesOnMap[e.id].lines.length;t++)f.routesOnMap[e.id].lines[t].setMap(null);for(t=0;t<f.routesOnMap[e.id].stops.length;t++)f.routesOnMap[e.id].stops[t].setMap(null);for(t=0;t<f.routesOnMap[e.id].vehicles.length;t++)f.routesOnMap[e.id].vehicles[t].setMap(null);f.routesOnMap[e.id].vehicles=[],O()}}function y(s){if(null!=f.routesOnMap[s.id]&&null!=f.routesOnMap[s.id]){f.routesOnMap[s.id].displayOnMap=!0;for(var e=0;e<f.routesOnMap[s.id].lines.length;e++)f.routesOnMap[s.id].lines[e].setMap(f.mapControl.getGMap());for(e=0;e<f.routesOnMap[s.id].stops.length;e++)f.routesOnMap[s.id].stops[e].setMap(f.mapControl.getGMap());C(s.id),O()}else{f.routesOnMap[s.id]={route:s};var l=[];f.selectedRoute=s,r.getShapesByRoute(s.id).then(function(e){for(var r,t=e.data,o=0;o<t.length;o++){var n=google.maps.geometry.encoding.decodePath(t[o].line),a=new google.maps.Polyline({path:n,strokeColor:s.color,strokeOpacity:.5,strokeWeight:5,icons:[{icon:{path:google.maps.SymbolPath.FORWARD_OPEN_ARROW,strokeOpacity:0,fillColor:s.color,fillOpacity:1,scale:2.5},offset:"25px",repeat:"200px"}],zIndex:1}),i=new google.maps.Polyline({path:n,strokeColor:"#fff",strokeOpacity:1,strokeWeight:8,zindex:0});a.setMap(f.mapControl.getGMap()),i.setMap(f.mapControl.getGMap()),l.push(a),l.push(i)}f.routesOnMap[s.id].lines=l,f.routesOnMap[s.id].displayOnMap=!0,r=s,p.getStopsByRoute(c,r.id).then(function(e){for(var t=[],o=e.data,n=0;n<o.length;n++){var a=new google.maps.Marker({position:new google.maps.LatLng(o[n].Latitude,o[n].Longitude),icon:{path:"M0,2.99420208 C0,1.34054993 1.34331197,0 2.99420208,0 L17.0057979,0 C18.6594501,0 20,1.34331197 20,2.99420208 L20,17.0057979 C20,18.6594501 18.656688,20 17.0057979,20 L2.99420208,20 C1.34054993,20 0,18.656688 0,17.0057979 L0,2.99420208 Z M6,20 L13.7690812,20 L9.75999999,22.76 L6,20 Z",fillColor:f.selectedRoute.color,fillOpacity:1,strokeWeight:0,anchor:new google.maps.Point(9,21),size:new google.maps.Size(20,23)},zIndex:5}),i=new google.maps.Marker({position:new google.maps.LatLng(o[n].Latitude,o[n].Longitude),icon:{path:"M0,0 L0,13.0899217 C0,13.6367269 0.443667457,14.08 1.00653274,14.08 L1.31047619,14.08 L1.31047619,16 L3.2,16 L3.2,14.08 L12.8,14.08 L12.8,16 L14.6895238,16 L14.6895238,14.08 L14.9934673,14.08 C15.5493599,14.08 16,13.6274801 16,13.0899217 L16,0.990078259 C16,0.443273135 15.5553691,0 14.9991283,0 L0,0 Z M15.4139194,7.85557231 C15.4139194,8.12679623 15.1819301,8.34666667 14.9225207,8.34666667 L1.13608738,8.34666667 C0.864695354,8.34666667 0.644688645,8.12790141 0.644688645,7.85557231 L0.644688645,3.07776103 C0.644688645,2.8065371 0.876677992,2.58666667 1.13608738,2.58666667 L14.9225207,2.58666667 C15.1939127,2.58666667 15.4139194,2.80543193 15.4139194,3.07776103 L15.4139194,7.85557231 Z M0.615384615,1.1312207 C0.615384615,0.859927 0.847373962,0.64 1.10678335,0.64 L14.8932166,0.64 C15.1646087,0.64 15.3846154,0.862958984 15.3846154,1.1312207 L15.3846154,1.4287793 C15.3846154,1.700073 15.152626,1.92 14.8932166,1.92 L1.10678335,1.92 C0.835391324,1.92 0.615384615,1.69704102 0.615384615,1.4287793 L0.615384615,1.1312207 Z M0.615384615,10.56 C0.615384615,10.0298066 1.04321759,9.6 1.57207584,9.6 L2.73561646,9.6 C3.26398244,9.6 3.69230769,10.0261102 3.69230769,10.56 C3.69230769,11.0901934 3.26447472,11.52 2.73561646,11.52 L1.57207584,11.52 C1.04370987,11.52 0.615384615,11.0938898 0.615384615,10.56 Z M12.3076923,10.56 C12.3076923,10.0298066 12.7355253,9.6 13.2643835,9.6 L14.4279242,9.6 C14.9562901,9.6 15.3846154,10.0261102 15.3846154,10.56 C15.3846154,11.0901934 14.9567824,11.52 14.4279242,11.52 L13.2643835,11.52 C12.7360176,11.52 12.3076923,11.0938898 12.3076923,10.56 Z M11.423955,11.1999507 C11.6340659,11.3767363 11.5848839,11.5200493 11.3051605,11.5200493 L4.69483948,11.5200493 C4.41912022,11.5200493 4.36801543,11.3749851 4.57604503,11.1999507 L4.19560559,11.5200493 C4.40571649,11.3432637 4.80388725,11.1999507 5.06852983,11.1999507 L10.9314702,11.1999507 C11.203462,11.1999507 11.5963648,11.3450149 11.8043944,11.5200493 L11.423955,11.1999507 Z M11.423955,11.8399507 C11.6340659,12.0167363 11.5848839,12.1600493 11.3051605,12.1600493 L4.69483948,12.1600493 C4.41912022,12.1600493 4.36801543,12.0149851 4.57604503,11.8399507 L4.19560559,12.1600493 C4.40571649,11.9832637 4.80388725,11.8399507 5.06852983,11.8399507 L10.9314702,11.8399507 C11.203462,11.8399507 11.5963648,11.9850149 11.8043944,12.1600493 L11.423955,11.8399507 Z",fillColor:"#fff",fillOpacity:1,strokeWeight:0,anchor:new google.maps.Point(7,19),size:new google.maps.Size(16,16)},zIndex:6}),s=new google.maps.Marker({position:new google.maps.LatLng(o[n].Latitude,o[n].Longitude),icon:{path:"M-5.83252597,14.3155545 C-6.35350295,13.5889938 -5.4359106,13 -3.78917972,13 L10.1871155,13 C11.8366015,13 13.5969795,13.5902074 14.1170863,14.3155545 L18.5313877,20.4717917 C19.0523647,21.1983524 18.1347724,21.7873462 16.4880415,21.7873462 L2.51174624,21.7873462 C0.862260281,21.7873462 -0.898117751,21.1971389 -1.41822457,20.4717917 L-5.83252597,14.3155545 Z M5.5099714,21.7873462 L13.2594793,21.7873462 L10.1300263,23 L5.5099714,21.7873462 Z",fillColor:"#000",fillOpacity:.1,strokeWeight:0,anchor:new google.maps.Point(9,21),size:new google.maps.Size(21,10)},zIndex:4});a.setMap(f.mapControl.getGMap()),i.setMap(f.mapControl.getGMap()),s.setMap(f.mapControl.getGMap()),google.maps.event.addListener(i,"click",m(o[n],a)),t.push(a),t.push(i),t.push(s)}f.routesOnMap[r.id].stops=t,google.maps.event.trigger(f.mapControl.getGMap(),"resize")}),C(s.id),O()})}}function w(){i.promise().then(function(e){n.getServiceAreaLocation(c).then(function(e){1==e.data.status&&(f.center.latitude=e.data.result.Latitude,f.center.longitude=e.data.result.Longitude,void 0!==e.data.result.ZoomLevel&&null!==e.data.result.ZoomLevel&&""!=e.data.result.ZoomLevel&&(f.zoom=e.data.result.ZoomLevel)),r.getRoutes().then(function(e){f.routes=e.data,f.filteredRoutes=f.routes,f.loading=!1,M=o(function(){r.getRoutes().then(function(e){var o=e.data;for(var n in o){var t=a("filter")(f.filteredRoutes,{id:o[n].id});angular.forEach(t,function(e,t){e.IsActive=o[n].IsActive})}},function(){}),function(){for(var e in f.routesOnMap)f.routesOnMap[e].displayOnMap&&C(e)}()},3e4)},function(){f.loading=!1})})})}function R(e){var o=new google.maps.LatLngBounds;return e.getPath().forEach(function(e,t){o.extend(new google.maps.LatLng(e.lat(),e.lng()))}),o}f.PageService=u,f.PageService.setTitle("Routes"),u.setHeadline(g.getFixedRouteInfo().alias),f.vehicles=[],f.allStops=[],f.toStops=[],f.routesOnMap=[],f.center={latitude:39.80986,longitude:-98.555183},f.myStyles=l.mapStyles,f.mapOptions={mapTypeControl:!1,zoomControl:!1,streetViewControl:!1,styles:f.myStyles},f.mapControl={},f.highlightParent=function(e){angular.element(e.target).parent().addClass("active")},f.blurParent=function(e){angular.element(e.target).parent().removeClass("active")},e.$on("$destroy",function(e){angular.isDefined(M)&&(o.cancel(M),M=void 0)}),c=s.getDivisionId(),w(),f.ionicSpinner="spiral",f.ionicInclude="app/modules/fixed-route/routes/all-routes.html",f.ionicCustomClassName="ionic-fixed-route-all-routes",f.ionicUseFixedRouteNav=!0,f.ionicHideNavBar=!1,f.ionicUseRefresher=!1}angular.module("oneMVApp").controller("AllRoutesController",e),e.$inject=["$scope","$filter","$location","$interval","ScheduleService","uiGmapIsReady","DivisionService","RouteService","StopService","googleMapsConfig","PageService","OneMvServices"]}();
!function(){"use strict";function e(e,t,o,s,i,n,u,r,l){var a,c,d=this;function p(){t.getSchedule(a).then(function(e){d.schedule=e.data,d.scheduleView=angular.copy(d.schedule)},function(e){})}d.schedule,d.scheduleView,d.showBackButton=!1,d.showTrip=function(e){for(var t,o=0;o<d.schedule.routes.length;o++)for(var s=0;s<d.schedule.routes[o].stops.length;s++)for(var i=0;i<d.schedule.routes[o].stops[s].trips.length;i++)if(d.schedule.routes[o].stops[s].trips[i].id==e)if(t){for(var n=!1,u=0;u<t.routes[0].stops.length;u++)d.schedule.routes[o].stops[s].id==t.routes[0].stops[u].id&&(n=!0,t.routes[0].stops[u].trips.push(angular.copy(d.schedule.routes[o].stops[s].trips[i])));n||(t.routes[0].stops.push(angular.copy(d.schedule.routes[o].stops[s])),t.routes[0].stops[t.routes[0].stops.length-1].trips=[],t.routes[0].stops[t.routes[0].stops.length-1].trips.push(angular.copy(d.schedule.routes[o].stops[s].trips[i])))}else(t={routes:[]}).routes.push(angular.copy(d.schedule.routes[o])),t.routes[0].stops=[],t.routes[0].stops.push(angular.copy(d.schedule.routes[o].stops[s])),t.routes[0].stops[0].trips=[],t.routes[0].stops[0].trips.push(angular.copy(d.schedule.routes[o].stops[s].trips[i]));d.scheduleView=t,d.showBackButton=!0},d.showSchedules=function(){d.schedule?d.scheduleView=d.schedule:p();d.showBackButton=!1},d.filterEmptyTimes=function(e){return 0<e.time.length},d.PageService=r,d.PageService.setTitle("Schedule"),r.setHeadline(l.getFixedRouteInfo().alias),c=0<e.navigator.userAgent.indexOf("Trident")||0<e.navigator.userAgent.indexOf("MSIE")?"images/pin-my-location.png":"images/pin-my-location.svg",d.zoom=15,d.center={latitude:47.604356,longitude:-122.3360817},d.myStyles=n.mapStyles,d.mapOptions={mapTypeControl:!1,zoomControl:!1,streetViewControl:!1,styles:d.myStyles},d.myLocationIcon={url:c,size:new google.maps.Size(42,42),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(20,20)},d.mapControl={},null!=(a=s.getDivisionId())&&null!=a&&""!=a&&(p(),u.promise().then(function(e){i.getCurrentPosition().then(function(e){d.position={coords:{latitude:e.coords.latitude,longitude:e.coords.longitude},icon:d.myLocationIcon},d.center.latitude=e.coords.latitude,d.center.longitude=e.coords.longitude,google.maps.event.trigger(d.mapControl.getGMap(),"resize")},function(e){o.getServiceAreaLocation(a).then(function(e){1==e.data.status&&(d.center.latitude=e.data.result.Latitude,d.center.longitude=e.data.result.Longitude)})})})),d.highlightParent=function(e){angular.element(e.target).parent().addClass("active")},d.blurParent=function(e){angular.element(e.target).parent().removeClass("active")},d.ionicInclude="app/modules/fixed-route/schedule/fr-schedule.html",d.ionicCustomClassName="ionic-fixed-route-schedule",d.ionicUseFixedRouteNav=!0,d.ionicHideNavBar=!1,d.ionicUseRefresher=!1}angular.module("oneMVApp").controller("FrScheduleController",e),e.$inject=["$window","FrScheduleService","ScheduleService","DivisionService","GeoLocationService","googleMapsConfig","uiGmapIsReady","PageService","OneMvServices"]}();
!function(){"use strict";function e(n,i,o){return{get:function(e){var t=i.defer();return n({method:"GET",url:o.oneMVFixedRouteApiUrl+"notifications/"+e}).then(function(e){t.resolve(e)},function(e){t.reject()}),t.promise}}}angular.module("oneMVApp").service("FixedRouteNotificationsService",e),e.$inject=["$http","$q","env"]}();
!function(){"use strict";function e(r,u,c){return{getSchedule:function(e){return n="schedule/"+e,t=u.defer(),r({method:"GET",url:c.oneMVFixedRouteApiUrl+n}).then(function(e){t.resolve(e)},function(e){t.reject()}),t.promise;var n,t}}}angular.module("oneMVApp").service("FrScheduleService",e),e.$inject=["$http","$q","env"]}();
!function(){"use strict";function e(o,n,i,t){function r(e){var t=n.defer();return o({method:"GET",url:i.oneMVFixedRouteApiUrl+"route/"+e}).then(function(e){t.resolve(e)},function(e){t.reject()}),t.promise}return{getRouteInfo:function(e){return r(e+"/"+t.getDivisionId())},getRoutes:function(){return r("allRoutes/"+t.getDivisionId())},getShapesByRoute:function(e){return r("shapesByRoute/"+e+"/"+t.getDivisionId())},getRoutesForStop:function(e){return r("routesByStop/"+e+"/"+divisionId)},getArrivalsForRoute:function(e,t){return r(t+"/arrivalsForRoute/"+e)},getVehiclesForRoute:function(e){return r(t.getDivisionId()+"/vehiclesByRoute/"+e)}}}angular.module("oneMVApp").factory("RouteService",e),e.$inject=["$http","$q","env","DivisionService"]}();
!function(){"use strict";function t(r,e,n){return{getStopsByRoute:function(t,o){return s("stops/"+t+"/stopsByRoute/"+o)},getArrivalsForStop:function(t,o,r){return s("stops/"+t+"/arrivalsByStop/"+o+"/"+r)},getAllStops:function(t){return s("stops/"+t)},getStopsForStop:function(t){return s("stopsByStop/"+t)},getArrivalsByStopId:function(t,o){return s("stops/"+t+"/arrivals/"+o)},getUpcomingArrivalsForStop:function(t,o,r,e){return s("stops/"+t+"/arrivalsByStop/"+o+"/"+r+"/"+e+"?rnd="+(new Date).getTime())}};function s(t){var o=e.defer();return r({method:"GET",url:n.oneMVFixedRouteApiUrl+t}).then(function(t){o.resolve(t)},function(t){o.reject()}),o.promise}}angular.module("oneMVApp").factory("StopService",t),t.$inject=["$http","$q","env"]}();
!function(){"use strict";function e(o,r,e,c,u){return{getVehiclesForRoute:function(e){var i=u.getDivisionId(),t=c.oneMVFixedRouteApiUrl,n=r.defer();return o({method:"GET",url:t+"fixedroute/"+i+"/vehiclesByRoute/"+e}).then(function(e){n.resolve(e)},function(e){n.reject()}),n.promise}}}angular.module("oneMVApp").factory("VehicleService",e),e.$inject=["$http","$q","ConfigFactory","env","DivisionService"]}();
!function(){"use strict";function e(e,o,t,n,s,a,i,l,p,r,d){var u=this;u.selectedFromStop,u.selectedToStop,u.allStops,u.fromStops,u.toStops,u.populateFromStops=w,u.selectFromStop=function(e){u.selectedFromStop&&y(u.selectedFromStop.Id);u.selectedFromStop=e,u.fromStopName=u.selectedFromStop.Name,O(e,"from"),u.selectedToStop?C():($("#txtToStopName").focus(),$("#txtFromStopName").parent().removeClass("active"),$("#txtToStopName").parent().addClass("active"),T())},u.populateToStops=T,u.selectToStop=function(e){u.selectedToStop&&y(u.selectedToStop.Id);u.selectedToStop=e,u.toStopName=u.selectedToStop.Name,O(e,"to"),u.selectedFromStop?C():($("#txtFromStopName").focus(),w())},u.gotoRoutes=function(){e.path("fixed-route/allRoutes")},u.gotoStops=function(){e.path("fixed-route/stops")},u.handleKeyPress=function(e,o){e&&8===e.keyCode&&e.currentTarget&&0==e.currentTarget.selectionStart&&e.currentTarget.selectionEnd==e.currentTarget.value.length&&("from"==o?(u.fromStopName="",y(u.selectedFromStop.Id),u.selectedFromStop=null,w()):(u.toStopName="",y(u.selectedToStop.Id),u.selectedToStop=null,T()))},u.mapRoute=function(e){e.isSelected?(!function(i){if(null!=u.routesOnMap[i.id]&&null!=u.routesOnMap[i.id]){u.routesOnMap[i.id].displayOnMap=!0;for(var e=0;e<u.routesOnMap[i.id].lines.length;e++)u.routesOnMap[i.id].lines[e].setMap(u.mapControl.getGMap());v()}else{u.routesOnMap[i.id]={};var l=[];p.getShapesByRoute(i.id).then(function(e){for(var o=e.data,t=0;t<o.length;t++){var n=google.maps.geometry.encoding.decodePath(o[t].line),s=new google.maps.Polyline({path:n,strokeColor:i.color,strokeOpacity:.5,strokeWeight:5,icons:[{icon:{path:google.maps.SymbolPath.FORWARD_OPEN_ARROW,strokeOpacity:0,fillColor:i.color,fillOpacity:1,scale:2.5},offset:"25px",repeat:"200px"}],zIndex:1}),a=new google.maps.Polyline({path:n,strokeColor:"#fff",strokeOpacity:1,strokeWeight:8,zindex:0});s.setMap(u.mapControl.getGMap()),a.setMap(u.mapControl.getGMap()),l.push(s),l.push(a)}u.routesOnMap[i.id].lines=l,u.routesOnMap[i.id].displayOnMap=!0,v()})}}(e.route),u.activeSchedule=e,u.isAnyRouteSelected=!0):(!function(e){if(null!=u.routesOnMap[e.id]&&null!=u.routesOnMap[e.id]&&u.routesOnMap[e.id].displayOnMap){u.routesOnMap[e.id].displayOnMap=!1;for(var o=0;o<u.routesOnMap[e.id].lines.length;o++)u.routesOnMap[e.id].lines[o].setMap(null);v()}}(e.route),u.activeSchedule=null);u.isHidden=e.isSelected},u.clearPins=function(){if(u.isHidden=!u.isHidden,!u.isHidden){for(var e=0;e<u.upcomingSchedules.length;e++)u.upcomingSchedules[e].isSelected=!1;u.isAnyRouteSelected=!1,M()}},u.loading=!1,u.upcomingSchedules,u.showFromStops=!0,u.showToStops=!1,u.showRoutes=!1,u.divisionId=n.getDivisionId();var c,g,S="images/bus-green.svg",m="images/bus-darkblue.svg",f=[];function h(e){var t=new google.maps.LatLngBounds;return e.getPath().forEach(function(e,o){t.extend(new google.maps.LatLng(e.lat(),e.lng()))}),t}function v(){var e=0;for(var o in c=new google.maps.LatLngBounds,u.routesOnMap)if(u.routesOnMap[o].displayOnMap){e++;for(var t=0;t<u.routesOnMap[o].lines.length;t++)c.union(h(u.routesOnMap[o].lines[t]))}0<e&&u.mapControl.getGMap().fitBounds(c)}function M(){for(var e=0;e<u.routesOnMap.length;e++)if(null!=u.routesOnMap[e]&&null!=u.routesOnMap[e]&&u.routesOnMap[e].displayOnMap){u.routesOnMap[e].displayOnMap=!1;for(var o=0;o<u.routesOnMap[e].lines.length;o++)u.routesOnMap[e].lines[o].setMap(null);v()}}function O(e,o){var t,n,s,a=new google.maps.Marker({position:new google.maps.LatLng(e.Latitude,e.Longitude),optimized:!1,icon:{url:"from"==o?S:m,scaledSize:new google.maps.Size(28,24)},animation:google.maps.Animation.DROP});a.id=e.Id,a.setMap(u.mapControl.getGMap()),f.push(a),google.maps.event.addListener(a,"click",(t=e,n=a,s=new google.maps.InfoWindow({content:""}),function(){var e='<span style="font-weight: bold;">'+t.Name+"</span><br />";s.setContent(e),s.open(u.mapControl.getGMap(),n)}))}function y(e){M();for(var o=0;o<f.length;o++)if(f[o].id==e)return f[o].setMap(null),void f.splice(o,1)}function w(){if(u.showFromStops=!0,u.showToStops=!1,u.showRoutes=!1,u.loading=!0,u.fromStops=[],u.selectedFromStop&&$("#txtFromStopName").select(),u.allStops&&0<u.allStops.length){var e=[];if(u.selectedToStop)for(var o=0;o<u.allStops.length;o++)u.allStops[o].Id!=u.selectedToStop.Id&&e.push(u.allStops[o]);else e=u.allStops;u.loading=!1,u.fromStops=e}else t.getAllStops(u.divisionId).then(function(e){u.loading=!1,u.allStops=e.data,u.fromStops=u.allStops},function(e){})}function T(){if(u.showFromStops=!1,u.showToStops=!0,u.showRoutes=!1,u.loading=!0,u.toStops=[],u.selectedToStop&&$("#txtToStopName").select(),u.allStops&&0<u.allStops.length){var e=[];if(u.selectedFromStop)for(var o=0;o<u.allStops.length;o++)u.allStops[o].Id!=u.selectedFromStop.Id&&e.push(u.allStops[o]);else e=u.allStops;u.loading=!1,u.toStops=e}else t.getAllStops(u.divisionId).then(function(e){u.loading=!1,u.allStops=e.data,u.toStops=u.allStops},function(e){})}function C(){return function(){for(var e=new google.maps.LatLngBounds,o=0;o<f.length;o++)e.extend(f[o].position);u.mapControl.getGMap().fitBounds(e),u.mapControl.getGMap().setZoom(u.mapControl.getGMap().getZoom()-1)}(),u.selectedFromStop?u.selectedToStop?(u.showFromStops=!1,u.showToStops=!1,u.showRoutes=!0,u.loadingRoutes=!0,void t.getArrivalsForStop(u.divisionId,u.selectedFromStop.Id,u.selectedToStop.Id).then(function(e){u.loadingRoutes=!1,u.upcomingSchedules=e.data;for(var o=0;o<u.upcomingSchedules.length;o++)u.upcomingSchedules[o].isSelected=!1;u.isAnyRouteSelected=!1},function(e){})):($("#txtToStopName").focus(),void T()):($("#txtFromStopName").focus(),void w())}u.routesOnMap=[],u.activeSchedule,u.isAnyRouteSelected=!1,u.PageService=r,u.PageService.setTitle("Stops"),r.setHeadline(d.getFixedRouteInfo().alias),function(){null!=u.divisionId&&null!=u.divisionId&&""!=u.divisionId&&l.promise().then(function(e){s.getCurrentPosition().then(function(e){u.position={coords:{latitude:e.coords.latitude,longitude:e.coords.longitude},icon:u.myLocationIcon},u.center.latitude=e.coords.latitude,u.center.longitude=e.coords.longitude,google.maps.event.trigger(u.mapControl.getGMap(),"resize")},function(e){a.getServiceAreaLocation(u.divisionId).then(function(e){1==e.data.status&&(u.center.latitude=e.data.result.Latitude,u.center.longitude=e.data.result.Longitude)})})});$("#txtFromStopName").parent().addClass("active"),w()}(),g=0<o.navigator.userAgent.indexOf("Trident")||0<o.navigator.userAgent.indexOf("MSIE")?"images/pin-my-location.png":"images/pin-my-location.svg",u.zoom=15,u.center={latitude:47.604356,longitude:-122.3360817},u.myStyles=i.mapStyles,u.mapOptions={mapTypeControl:!1,zoomControl:!1,streetViewControl:!1,styles:u.myStyles},u.myLocationIcon={url:g,size:new google.maps.Size(42,42),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(20,20)},u.mapControl={},u.highlightParent=function(e){angular.element(e.target).parent().addClass("active")},u.blurParent=function(e){angular.element(e.target).parent().removeClass("active")},u.ionicInclude="app/modules/fixed-route/stops/fr-stops.html",u.ionicCustomClassName="ionic-fixed-route-stops",u.ionicUseFixedRouteNav=!0,u.ionicHideNavBar=!1,u.ionicUseRefresher=!1}angular.module("oneMVApp").controller("FrStopsController",e),e.$inject=["$location","$window","StopService","DivisionService","GeoLocationService","ScheduleService","googleMapsConfig","uiGmapIsReady","RouteService","PageService","OneMvServices"]}();
!function(){"use strict";function e(o,e,t,n,i,a,r,l,g,s,c,p,d){var u=this,L=void 0,m=void 0,C=void 0,f=void 0,h=2e4,v=2e4,M="fixed-route-landing",w=!1;function y(e){i.getCurrentPosition().then(k,P)}function k(e,o){u.position={coords:{latitude:e.coords.latitude,longitude:e.coords.longitude},icon:{url:c.isIE()?"images/pin-my-location.png":"images/pin-my-location.svg",size:new google.maps.Size(42,42),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(20,20)}},u.center.latitude=e.coords.latitude,u.center.longitude=e.coords.longitude,google.maps.event.trigger(u.mapControl.getGMap(),"resize")}function P(e){s.getServiceAreaLocation(C).then(function(e){1==e.data.status&&(u.center.latitude=e.data.result.Latitude,u.center.longitude=e.data.result.Longitude)})}function S(){l.getVehiclesForRoute(f).then(I,O)}function I(e){e&&e.data&&0<e.data.length&&function(e){for(var o=0;o<e.data.length;o++){var t=e.data[o];if(-1<Z(u.vehicleMarkers,t.id)){new google.maps.LatLng(t.latitude,t.longitude);z(t)}else{var n=(a=t,void 0,r=u.mapControl.getGMap(),l=new google.maps.LatLng(a.latitude,a.longitude),new google.maps.Marker({id:a.id,markerType:"heading",position:l,map:r,flat:!0,icon:{path:"M15.2413122,21.1527861 L11,26 L6.75861856,21.1527069 C2.78910959,19.4927506 0,15.5728475 0,11 C0,4.92486775 4.923532,0 11,0 C17.0751322,0 22,4.923532 22,11 C22,15.5720845 19.2113515,19.4926684 15.2413122,21.1527861 Z",scale:1.1,fillOpacity:1,fillColor:"#fff",strokeWeight:1,strokeOpacity:.3,rotation:a.heading,origin:new google.maps.Point(0,0),anchor:new google.maps.Point(a.anchorX,a.anchorY)},zIndex:1})),i=R(t);u.vehicleMarkers.push(n),u.vehicleMarkers.push(i)}}var a,r,l}(e)}function z(e){for(var o=function(e,o){for(var t=[],n=0;n<e.length;n++)e[n].id===o&&t.push(e[n]);return t}(u.vehicleMarkers,e.id),t=u.mapControl.getGMap(),n=new google.maps.LatLng(e.latitude,e.longitude),i=0;i<o.length;i++){var a=o[i];if("heading"===a.markerType){var r=a.getIcon();r.rotation=e.heading,r.anchor=new google.maps.Point(e.anchorX,e.anchorY),r.origin=new google.maps.Point(0,0),a.setIcon(r)}a.setDuration(h),a.setPosition(n),google.maps.event.trigger(t,"resize")}}function R(e){var o,t,n,i,a=u.mapControl.getGMap(),r=new google.maps.LatLng(e.latitude,e.longitude),l=new google.maps.Marker({id:e.id,markerType:"vehicle",position:r,flat:!0,map:a,icon:{path:"M0,10 C0,4.4771525 4.47593818,0 10,0 C15.5228475,0 20,4.47593818 20,10 C20,15.5228475 15.5240618,20 10,20 C4.4771525,20 0,15.5240618 0,10 Z M5,5 L5,13.8 L5.81904762,13.8 L5.81904762,15 L7,15 L7,13.8 L13,13.8 L13,15 L14.1809524,15 L14.1809524,13.8 L15,13.8 L15,5 L5,5 Z M14.6336996,9.71610209 C14.6336996,9.99255627 14.405522,10.2166667 14.1374134,10.2166667 L5.89921665,10.2166667 C5.62512532,10.2166667 5.4029304,10.0022513 5.4029304,9.71610209 L5.4029304,7.11723124 C5.4029304,6.84077706 5.63110799,6.61666667 5.89921665,6.61666667 L14.1374134,6.61666667 C14.4115047,6.61666667 14.6336996,6.83108203 14.6336996,7.11723124 L14.6336996,9.71610209 Z M5.38461538,5.8 C5.38461538,5.5790861 5.56076967,5.4 5.78125,5.4 L14.21875,5.4 C14.4378052,5.4 14.6153846,5.58554688 14.6153846,5.8 C14.6153846,6.0209139 14.4392303,6.2 14.21875,6.2 L5.78125,6.2 C5.56219475,6.2 5.38461538,6.01445313 5.38461538,5.8 Z M5.38461538,11.6 C5.38461538,11.2686292 5.65201099,11 5.99308894,11 L6.69921875,11 C7.03526942,11 7.30769231,11.2783203 7.30769231,11.6 C7.30769231,11.9313708 7.0402967,12.2 6.69921875,12.2 L5.99308894,12.2 C5.65703828,12.2 5.38461538,11.9216797 5.38461538,11.6 Z M12.6923077,11.6 C12.6923077,11.2686292 12.9597033,11 13.3007812,11 L14.0069111,11 C14.3429617,11 14.6153846,11.2783203 14.6153846,11.6 C14.6153846,11.9313708 14.347989,12.2 14.0069111,12.2 L13.3007812,12.2 C12.9647306,12.2 12.6923077,11.9216797 12.6923077,11.6 Z",fillOpacity:1,strokeOpacity:0,fillColor:u.route.color,scale:1},zIndex:2});return google.maps.event.addListener(l,"click",(o=a,t=l,n=e.name,i=new google.maps.InfoWindow({content:""}),function(){var e='<span style="font-weight: bold;">#'+n+"</span><br />";i.setContent(e),i.open(o,t)})),l}function Z(e,o){for(var t=0;t<e.length;t++)if(e[t].id===o)return t;return-1}function O(){}function x(){L=t(function(){S()},h)}function A(){l.getArrivalsForRoute(f,C).then(D,G).then(F)}function D(e){u.routeArrivals=e.data.arrivals,u.loading=!1,w||function(){for(var e=u.mapControl.getGMap(),o=0;o<u.routeArrivals.length;o++){var t=u.routeArrivals[o].stop,n=new google.maps.LatLng(t.Latitude,t.Longitude),i=(new google.maps.Marker({id:t.Id,position:n,map:e,optimized:!1,icon:{path:"M0,2.99420208 C0,1.34054993 1.34331197,0 2.99420208,0 L17.0057979,0 C18.6594501,0 20,1.34331197 20,2.99420208 L20,17.0057979 C20,18.6594501 18.656688,20 17.0057979,20 L2.99420208,20 C1.34054993,20 0,18.656688 0,17.0057979 L0,2.99420208 Z M6,20 L13.7690812,20 L9.75999999,22.76 L6,20 Z",fillColor:u.route.color,fillOpacity:1,strokeWeight:0,anchor:new google.maps.Point(9,21),size:new google.maps.Size(20,23)},zIndex:5,animation:google.maps.Animation.DROP}),new google.maps.Marker({id:t.Id,position:n,map:e,optimized:!1,icon:{path:"M0,0 L0,13.0899217 C0,13.6367269 0.443667457,14.08 1.00653274,14.08 L1.31047619,14.08 L1.31047619,16 L3.2,16 L3.2,14.08 L12.8,14.08 L12.8,16 L14.6895238,16 L14.6895238,14.08 L14.9934673,14.08 C15.5493599,14.08 16,13.6274801 16,13.0899217 L16,0.990078259 C16,0.443273135 15.5553691,0 14.9991283,0 L0,0 Z M15.4139194,7.85557231 C15.4139194,8.12679623 15.1819301,8.34666667 14.9225207,8.34666667 L1.13608738,8.34666667 C0.864695354,8.34666667 0.644688645,8.12790141 0.644688645,7.85557231 L0.644688645,3.07776103 C0.644688645,2.8065371 0.876677992,2.58666667 1.13608738,2.58666667 L14.9225207,2.58666667 C15.1939127,2.58666667 15.4139194,2.80543193 15.4139194,3.07776103 L15.4139194,7.85557231 Z M0.615384615,1.1312207 C0.615384615,0.859927 0.847373962,0.64 1.10678335,0.64 L14.8932166,0.64 C15.1646087,0.64 15.3846154,0.862958984 15.3846154,1.1312207 L15.3846154,1.4287793 C15.3846154,1.700073 15.152626,1.92 14.8932166,1.92 L1.10678335,1.92 C0.835391324,1.92 0.615384615,1.69704102 0.615384615,1.4287793 L0.615384615,1.1312207 Z M0.615384615,10.56 C0.615384615,10.0298066 1.04321759,9.6 1.57207584,9.6 L2.73561646,9.6 C3.26398244,9.6 3.69230769,10.0261102 3.69230769,10.56 C3.69230769,11.0901934 3.26447472,11.52 2.73561646,11.52 L1.57207584,11.52 C1.04370987,11.52 0.615384615,11.0938898 0.615384615,10.56 Z M12.3076923,10.56 C12.3076923,10.0298066 12.7355253,9.6 13.2643835,9.6 L14.4279242,9.6 C14.9562901,9.6 15.3846154,10.0261102 15.3846154,10.56 C15.3846154,11.0901934 14.9567824,11.52 14.4279242,11.52 L13.2643835,11.52 C12.7360176,11.52 12.3076923,11.0938898 12.3076923,10.56 Z M11.423955,11.1999507 C11.6340659,11.3767363 11.5848839,11.5200493 11.3051605,11.5200493 L4.69483948,11.5200493 C4.41912022,11.5200493 4.36801543,11.3749851 4.57604503,11.1999507 L4.19560559,11.5200493 C4.40571649,11.3432637 4.80388725,11.1999507 5.06852983,11.1999507 L10.9314702,11.1999507 C11.203462,11.1999507 11.5963648,11.3450149 11.8043944,11.5200493 L11.423955,11.1999507 Z M11.423955,11.8399507 C11.6340659,12.0167363 11.5848839,12.1600493 11.3051605,12.1600493 L4.69483948,12.1600493 C4.41912022,12.1600493 4.36801543,12.0149851 4.57604503,11.8399507 L4.19560559,12.1600493 C4.40571649,11.9832637 4.80388725,11.8399507 5.06852983,11.8399507 L10.9314702,11.8399507 C11.203462,11.8399507 11.5963648,11.9850149 11.8043944,12.1600493 L11.423955,11.8399507 Z",fillColor:"#fff",fillOpacity:1,strokeWeight:0,anchor:new google.maps.Point(7,19),size:new google.maps.Size(16,16)},zIndex:6,animation:google.maps.Animation.DROP}));new google.maps.Marker({id:t.Id,position:n,map:e,optimized:!1,icon:{path:"M-5.83252597,14.3155545 C-6.35350295,13.5889938 -5.4359106,13 -3.78917972,13 L10.1871155,13 C11.8366015,13 13.5969795,13.5902074 14.1170863,14.3155545 L18.5313877,20.4717917 C19.0523647,21.1983524 18.1347724,21.7873462 16.4880415,21.7873462 L2.51174624,21.7873462 C0.862260281,21.7873462 -0.898117751,21.1971389 -1.41822457,20.4717917 L-5.83252597,14.3155545 Z M5.5099714,21.7873462 L13.2594793,21.7873462 L10.1300263,23 L5.5099714,21.7873462 Z",fillColor:"#000",fillOpacity:.1,strokeWeight:0,anchor:new google.maps.Point(9,21),size:new google.maps.Size(21,10)},zIndex:4,animation:google.maps.Animation.DROP});google.maps.event.addListener(i,"click",$(e,i,t.Name))}w=!0}()}function W(){var a=u.mapControl.getGMap();l.getShapesByRoute(f).then(function(e){var o,t,n=e.data,i=new google.maps.Polyline({path:google.maps.geometry.encoding.decodePath(n[0].line),strokeColor:u.route.color,strokeOpacity:4,strokeWeight:4,map:a,icons:[{icon:{path:google.maps.SymbolPath.FORWARD_CLOSED_ARROW,scale:3},offset:"25px",repeat:"200px"}]});a.fitBounds((o=i,t=new google.maps.LatLngBounds,o.getPath().forEach(function(e,o){t.extend(new google.maps.LatLng(e.lat(),e.lng()))}),t))},function(e){})}function G(e){u.loading=!1}function $(o,t,n){var i=new google.maps.InfoWindow({content:""});return function(){var e='<span style="font-weight: bold;">'+n+"</span><br />";i.setContent(e),i.open(o,t)}}function F(){c.hasValue(m)||(m=t(function(){A()},v))}u.PageService=p,u.PageService.setTitle("Stops for Route"),p.setHeadline(d.getFixedRouteInfo().alias),u.route={},u.routeArrivals=[],u.loading=!0,u.vehicleMarkers=[],u.selectedStopId="",u.mapControl={},u.zoom=15,u.center={latitude:47.604356,longitude:-122.3360817},u.mapOptions={mapTypeControl:!1,zoomControl:!1,streetViewControl:!1,styles:a.mapStyles},c.hasValue(e.routeId)||o.go(M),f=e.routeId,C=g.getDivisionId(),c.hasValue(C)||o.go("division"),l.getRouteInfo(f).then(function(e){e&&e.data&&(u.route=e.data,r.promise().then(y).then(W).then(S).then(x))},function(e){o.go(M)}).then(A),n.$on("$destroy",function(e){!function(){angular.isDefined(L)&&(t.cancel(L),L=void 0);angular.isDefined(m)&&(t.cancel(m),m=void 0)}()}),u.ionicInclude="app/modules/fixed-route/stops-for-route/stops-for-route.html",u.ionicCustomClassName="ionic-fixed-route-stops-for-route",u.ionicUseFixedRouteNav=!0,u.ionicHideNavBar=!1,u.ionicUseRefresher=!1}angular.module("oneMVApp").controller("StopsForRouteController",e),e.$inject=["$state","$stateParams","$interval","$scope","GeoLocationService","googleMapsConfig","uiGmapIsReady","RouteService","DivisionService","ScheduleService","PortalUtilityService","PageService","OneMvServices"]}();
!function(){"use strict";function activeTripController($scope,$location,$interval,$window,$uibModal,ConfigFactory,ScheduleService,uiGmapIsReady,DivisionService,authService,UtilityFactory,RedirectionService,CommunicationsService,SettingsService,PageService,OneMvServices){var vm=this;PageService.setTitle("Active Trip"),PageService.setHeadline(OneMvServices.getDrtInfo().alias);var options=void 0,autoRefresh=void 0;vm.passengerId=authService.authentication.passengerId,vm.cancelTrip=cancelTrip,vm.getActiveTrip=getActiveTrip,vm.tryContactDriver=tryContactDriver,vm.isCancelling=!1,vm.activeTrip,vm.contactingDriver=!1;var divisionId="",operatorId=null,directionsDisplay=new google.maps.DirectionsRenderer({suppressMarkers:!0,draggable:!1}),directionsService=new google.maps.DirectionsService,closestPin,otherPin,locationPin,myLocationPin,hubIcon;function setAutoRefresh(){autoRefresh=$interval(function(){getActiveTrip()},3e4)}function tryContactDriver(e){vm.contactingDriver=!0,vm.type=e,SettingsService.getSettings(authService.authentication.passengerId).then(function(e){10<=e.length?contactDriver():CollectPassengerMobile()},function(e){})}function showSupportPopUp(){var e=DivisionService.getSupportPhoneNumber(),t="Could not contact driver. Please call Help desk at <a href='tel:"+e+"'>"+e+"</a>";$uibModal.open({template:'<div class="modal-header" ><h3 class="modal-title">Support</h3> </div><div class="modal-body"><p>'+t+'</p></div><div class="modal-footer"><button class="btn btn-warning" type="button" ng-click="close()">OK</button> </div>',replace:!0,controller:function(e,t){e.close=function(){t.close()}},backdrop:"static",keyboard:!1})}function contactDriver(){CommunicationsService.contactDriver(vm.activeTrip.TripID).then(function(e){1==e.status&&e.result?"call"==vm.type?document.location.href="tel:"+e.result:"sms"==vm.type&&(document.location.href="sms:"+e.result):(e.status,showSupportPopUp()),vm.contactingDriver=!1},function(e){vm.contactingDriver=!1,showSupportPopUp()})}function CollectPassengerMobile(){$uibModal.open({animation:!0,templateUrl:"app/modules/on-demand/activeTrip/passenger-mobile-modal.html",controller:"PassengerMobileController as vm",size:"sm",resolve:{settings:function(){return{passengerId:authService.authentication.passengerId}}}}).result.then(function(e){1==e?contactDriver():0==e&&UtilityFactory.toastError("Error","Could not update your mobile number.")})}function getActiveTrip(){ScheduleService.getlastripdetails(vm.passengerId).then(function(e){if(1==e.data.status){vm.activeTrip=e.data.result;var t=new moment(vm.activeTrip.StartPickupWindowTime),i=new moment(vm.activeTrip.EndPickupWindowTime);vm.activeTrip.promiseWindowStartTime=t.format("h:mm A"),vm.activeTrip.promiseWindowEndTime=i.format("h:mm A"),mapTrip()}else vm.activeTrip=null,vm.scheduleMarkers=[],directionsDisplay.setMap(null),$location.path("on-demand/reservations")},function(e){vm.activeTrip=null,vm.isLoading=!1})}function cancelTrip(e){var t={tripId:e.TripID,passengerId:e.PassengerID,from:e.StartAddressViewModel.Name,to:e.EndAddressViewModel.Name,scheduledTime:e.ScheduledPickupTime};$uibModal.open({animation:!0,templateUrl:"app/modules/on-demand/activeTrip/trip-cancellation-prompt.html",controller:"TripCancellationController as vm",size:"",resolve:{tripToCancel:function(){return t},showCancelOptions:vm.reservationFormOptions.showCancelOptions}}).result.then(function(e){e.isCancel?(UtilityFactory.toastSuccess("Success!","Trip cancelled"),$location.path("on-demand/reservations")):UtilityFactory.toastError("Error!","Unable to cancel the trip.")})}function getMap(){uiGmapIsReady.promise().then(function(e){ScheduleService.getServiceAreaLocation(vm.divisionId).then(function(e){1==e.data.status&&(vm.center.latitude=e.data.result.Latitude,vm.center.longitude=e.data.result.Longitude),getActiveTrip(),setAutoRefresh()})})}function mapTrip(){vm.scheduleMarkers=[],directionsDisplay.setMap(vm.mapControl.getGMap()),vm.scheduleMarkers.push({latitude:vm.activeTrip.StartAddressViewModel.Latitude,longitude:vm.activeTrip.StartAddressViewModel.Longitude,icon:"images/default/i-drt-pin-b.png",tripId:vm.activeTrip.TripID}),vm.scheduleMarkers.push({latitude:vm.activeTrip.EndAddressViewModel.Latitude,longitude:vm.activeTrip.EndAddressViewModel.Longitude,icon:"images/default/i-drt-pin-g.png",tripId:vm.activeTrip.TripID});var e={origin:new google.maps.LatLng(vm.activeTrip.StartAddressViewModel.Latitude,vm.activeTrip.StartAddressViewModel.Longitude),destination:new google.maps.LatLng(vm.activeTrip.EndAddressViewModel.Latitude,vm.activeTrip.EndAddressViewModel.Longitude),travelMode:google.maps.DirectionsTravelMode.DRIVING};vm.vehicleInfo={coords:{latitude:vm.activeTrip.VehicleLatitude,longitude:vm.activeTrip.VehicleLongitude},icon:"images/i-car-green.svg"},google.maps.event.trigger(vm.mapControl.getGMap(),"resize"),directionsService.route(e,function(e,t){t===google.maps.DirectionsStatus.OK&&directionsDisplay.setDirections(e)}),vm.isLoading=!1}function activate(e){authService.isLoggedIn()?null!=(divisionId=DivisionService.getDivisionId())&&null!=divisionId&&""!=divisionId&&e&&"function"==typeof e&&e():(save("/on-demand/active-trip"),$location.path("login"))}function populateDivisionParameters(){options={DivisionId:divisionId,OperatorId:operatorId},ConfigFactory.getDivisionParameters(divisionId).then(function(params){params&&(options.passengersLimit=params.PassengersLimit?eval(params.PassengersLimit):5,options.allowWillCall=!!params.AllowWillCall&&eval(params.AllowWillCall.toLowerCase()),options.allowEquipment=!!params.AllowEquipment&&eval(params.AllowEquipment.toLowerCase()),options.isAdvancedReservation=!!params.AllowAdvancedReservation&&eval(params.AllowAdvancedReservation.toLowerCase()),options.allowMultipleSeatBooking=!!params.AllowMultipleSeatBooking&&eval(params.AllowMultipleSeatBooking.toLowerCase()),options.isWheelChair=!!params.HasWheelChair&&eval(params.HasWheelChair.toLowerCase()),options.isPCA=!!params.HasPersonalCareAssistant&&eval(params.HasPersonalCareAssistant.toLowerCase()),options.isServiceAnimal=!!params.HasServiceAnimal&&eval(params.HasServiceAnimal.toLowerCase()),options.isCompanion=!!params.HasCompanions&&eval(params.HasCompanions.toLowerCase()),options.companionsLimit=0==params.HasCompanions?0:params.CompanionsLimit?eval(params.CompanionsLimit):1,options.allowCustomLocation=!!params.AllowCustomLocation&&eval(params.AllowCustomLocation.toLowerCase()),options.allowOnlySameDayAdvRes=!!params.AllowOnlySameDayAdvRes&&eval(params.AllowOnlySameDayAdvRes.toLowerCase()),options.promiseWindow=params.PromiseWindow?eval(params.PromiseWindow):10,options.showCancelOptions=!!params.CancelReasonRequired&&eval(params.CancelReasonRequired.toLowerCase()),options.reservationType=vm.reservationType,options.allowFaring=!!params.AllowFaring&&eval(params.AllowFaring.toLowerCase()),options.allowLocationNotes=!!params.AllowLocationNotes&&eval(params.AllowLocationNotes),options.allowPassengerToCall=!!params.AllowPCD&&eval(params.AllowPCD.toLowerCase()),options.allowPassengerToSms=!!params.AllowPSD&&eval(params.AllowPSD.toLowerCase()),options.allowChildren=!!params.AllowChildren&&eval(params.AllowChildren),vm.reservationFormOptions=options,options.isPassenger=!0,options.isReadOnly=!0,options.autoRefresh=!0,options.batchDays=params.BatchDays?eval(params.BatchDays):7,options.minFromDays=params.MinFromDays?eval(params.MinFromDays):30,vm.reservationFormOptions=options)},function(e){UtilityFactory.toastError("Error",e.data.ReturnMessage)}),getMap()}vm.isLoading=!1,vm.vehicleInfo=null,vm.drawerState=1,hubIcon=0<$window.navigator.userAgent.indexOf("Trident")||0<$window.navigator.userAgent.indexOf("MSIE")?(closestPin="images/default/i-drt-pin-b.png",otherPin="images/default/i-drt-pin-g.png",locationPin="images/pin-location.png",myLocationPin="images/pin-my-location.png","images/pin-hub.png"):(closestPin="images/default/i-pin-drt-b.svg",otherPin="images/default/i-drt-pin-g.svg",locationPin="images/pin-location.svg",myLocationPin="images/pin-my-location.svg","images/pin-hub.svg"),$scope.swipeUp=function(e){vm.drawerState<2&&(vm.drawerState+=1)},$scope.swipeDown=function(e){0<vm.drawerState&&(vm.drawerState-=1)},vm.zoom=15,vm.center={latitude:39.80986,longitude:-98.555183},vm.myStyles=[{elementType:"geometry",stylers:[{color:"#ebe3cd"}]},{elementType:"labels.text.fill",stylers:[{color:"#523735"}]},{elementType:"labels.text.stroke",stylers:[{color:"#f5f1e6"}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#c9b2a6"}]},{featureType:"administrative.land_parcel",elementType:"geometry.stroke",stylers:[{color:"#dcd2be"}]},{featureType:"administrative.land_parcel",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.land_parcel",elementType:"labels.text.fill",stylers:[{color:"#ae9e90"}]},{featureType:"landscape.natural",elementType:"geometry",stylers:[{color:"#dfd2ae"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#dfd2ae"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#93817c"}]},{featureType:"poi.business",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{color:"#a5b076"}]},{featureType:"poi.park",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#447530"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#f5f1e6"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#fdfcf8"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#f8c967"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#e9bc62"}]},{featureType:"road.highway.controlled_access",elementType:"geometry",stylers:[{color:"#e98d58"}]},{featureType:"road.highway.controlled_access",elementType:"geometry.stroke",stylers:[{color:"#db8555"}]},{featureType:"road.local",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#806b63"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{color:"#dfd2ae"}]},{featureType:"transit.line",elementType:"labels.text.fill",stylers:[{color:"#8f7d77"}]},{featureType:"transit.line",elementType:"labels.text.stroke",stylers:[{color:"#ebe3cd"}]},{featureType:"transit.station",elementType:"geometry",stylers:[{color:"#dfd2ae"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#b9d3c2"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#92998d"}]}],vm.mapOptions={mapTypeControl:!1,zoomControl:!1,streetViewControl:!1,styles:vm.myStyles},vm.mapControl={},activate(populateDivisionParameters),$scope.$on("$destroy",function(e){angular.isDefined(autoRefresh)&&($interval.cancel(autoRefresh),autoRefresh=void 0)}),vm.ionicInclude="app/modules/on-demand/activeTrip/active-trip.html",vm.ionicCustomClassName="",vm.ionicHideNavBar=!1,vm.ionicUseRefresher=!1}angular.module("oneMVApp").controller("ActiveTripController",activeTripController),activeTripController.$inject=["$scope","$location","$interval","$window","$uibModal","ConfigFactory","ScheduleService","uiGmapIsReady","DivisionService","authService","UtilityFactory","RedirectionService","CommunicationsService","SettingsService","PageService","OneMvServices"]}();
!function(){"use strict";function e(e,n,t,i,s){var o=this;o.updateSettings=function(){if(o.isUpdating=!0,""!=o.clientTelephone&&!isNaN(o.clientTelephone)&&0<o.clientTelephone){var e="+1"+o.clientTelephone,n={PassengerId:o.passengerId,ClientTelephone:e};i.updateSettings(n).then(function(e){o.isUpdating=!1,l(e)},function(e){o.isUpdating=!1,l(!1)})}else o.isUpdating=!1,s.toastError("Error","Please enter a valid number")},o.cancel=function(){n.close()},o.passengerId=t.passengerId,o.clientTelephone="",o.isUpdating=!1;var l=function(e){n.close(e)}}angular.module("oneMVApp").controller("PassengerMobileController",e),e.$inject=["$location","$uibModalInstance","settings","SettingsService","UtilityFactory"]}();
!function(){"use strict";function e(n,a,e,o,t){var r=this;r.tripToCancel=a,r.showCancelOptions=e,r.cancelError=!1,r.disable=!1,r.reasonComment="",r.cancelTrip=function(){r.disable=!0;var e={TripID:a.tripId,PassengerID:a.passengerId,OperationID:null};if(r.showCancelOptions){if(!r.cancelReason)return o.toastError("Error!","Please provide a reason for cancellation"),void(r.disable=!1);if(e.CancelReasonId=r.cancelReason.ReasonId,e.CancelReasonText=r.cancelReason.Reason,""!=r.reasonComment.trim()){if(e.CancelReasonText+=" - "+r.reasonComment.trim().replace(/[^a-zA-Z\d,@!\.\(\)\-\* \s]/g,""),250<e.CancelReasonText.length)return o.toastError("Error!","Comment too long. Please make it shorter"),void(r.disable=!1)}else if("Other"===r.cancelReason.Reason&&""===r.reasonComment.trim())return o.toastError("Error!","You selected Other, please type a reason."),void(r.disable=!1)}t.cancelpost(e).then(function(e){e&&e.data&&1==e.data.status?n.close({action:"close",isCancel:!0}):r.cancelError=!0,r.disable=!1},function(e){r.disable=!1,r.cancelError=!0})},r.cancel=function(){n.dismiss("cancel")},this.MakeDisable=function(){return!!r.disable},r.disallowSpecialChar=function(){""!==r.reasonComment.trim()&&(r.reasonComment=r.reasonComment.replace(/[^a-zA-Z\d,@!\.\(\)\-\* \s]/g,""))},r.showCancelOptions&&t.getTripCancelStatusList().then(function(e){1==e.data.status&&(r.cancelReasons=e.data.result)},function(e){})}angular.module("oneMVApp").controller("TripCancellationController",e),e.$inject=["$uibModalInstance","tripToCancel","showCancelOptions","UtilityFactory","ScheduleService"]}();
!function(){"use strict";function e(r,o,e,n,a,t,i,s,u){r.cancel=function(){r.reservationRequest.IsWheelChair=!1,r.reservationRequest.IsPCA=!1,r.reservationRequest.IsServiceAnimal=!1,r.reservationRequest.TripFares=[],r.reservationRequest.BaseFare=void 0,r.maxCompanionCountWarning=!1,a.close(r.reservationRequest)},r.saveCompanions=function(){r.showCompanionSelection=!r.showCompanionSelection},r.resetCompanions=function(){r.fareTypes=angular.copy(m),r.companionFare=c,r.companionCount=p,r.showCompanionSelection=!r.showCompanionSelection,r.maxCompanionCountWarning=!1},r.editCompanions=function(){m=angular.copy(r.fareTypes),c=r.companionFare,p=r.companionCount,r.showCompanionSelection=!r.showCompanionSelection},r.increaseCount=function(e){r.companionCount<r.maxCount?(r.fareTypes[e].NumberOfPassengers++,r.companionFare=r.companionFare+r.fareTypes[e].Fare,r.companionCount++,r.maxCompanionCountWarning=!1):r.maxCompanionCountWarning=!0},r.decreaseCount=function(e){0<r.fareTypes[e].NumberOfPassengers&&(r.fareTypes[e].NumberOfPassengers--,r.companionFare=r.companionFare-r.fareTypes[e].Fare,r.companionCount--,r.maxCompanionCountWarning=!1)},r.bookTrip=function(){if(null==r.baseFare)return void o.toastError("Error","Can not get faring information. Please try again later.");r.$parent.options.allowLocationNotes&&(r.reservationRequest.locationNotes.from=r.locationNotes.from,r.reservationRequest.locationNotes.to=r.locationNotes.to);r.reservationRequest.TripFares=r.fareTypes,r.reservationRequest.TotalTripFare=r.baseFare+r.companionFare,r.reservationRequest.CompanionsCount=r.companionCount,r.reservationRequest.BaseFare=r.baseFare,r.$parent.saveReservation(r.reservationRequest),a.close()},r.isHidden=!0,r.locationNotes={from:"",to:""},r.maxCount=r.$parent.options.isCompanion?r.$parent.options.companionsLimit:0,r.companionCount=0,r.reservationRequest=s,r.serviceDate=u.format("YYYY-MM-DD"),r.companionFare=0,r.baseFare=void 0,r.maxCompanionCountWarning=!1;var m=void 0,c=0,p=0,f=void 0;r.fareTypes=[];var l;s.fromLocation,s.toLocation;l=function(){if(r.requestedTime=f.format("MM/DD/YYYY hh:mm A"),null!=r.reservationRequest.TripFares&&0<r.reservationRequest.TripFares.length)return r.fareTypes=r.reservationRequest.TripFares,r.baseFare=r.reservationRequest.BaseFare,angular.forEach(r.fareTypes,function(e,o){0<e.NumberOfPassengers&&(r.companionCount+=e.NumberOfPassengers,r.companionFare+=e.Fare*e.NumberOfPassengers)}),r.reservationRequest.locationNotes&&""!=r.reservationRequest.locationNotes.from&&(r.locationNotes.from=r.reservationRequest.locationNotes.from),void(r.reservationRequest.locationNotes&&""!=r.reservationRequest.locationNotes.to&&(r.locationNotes.to=r.reservationRequest.locationNotes.to));r.fareTypes=[],e.GetZoneFares(r.divisionId,r.reservationRequest.fromZone,r.reservationRequest.toZone,f.format("YYYY-MM-DD HHmmss"),r.serviceDate).then(function(e){if(1==e.data.status){var o=e.data.result;angular.forEach(o,function(e,o){r.fareTypes.push({PassengerFareTypeId:e.PassengerFareTypeId,NumberOfPassengers:0,Name:e.FareType,Fare:e.Fare,ZoneFareId:e.ZoneFareId})}),function(e){for(var o=0;o<e.length;o++)if(e[o].IsDefault)return r.baseFare=e[o].Fare;r.baseFare=void 0}(a=o),i.GetPassengerAge(r.$parent.passenger.Id).then(function(e){if(1==e.data.status)for(var o=e.data.result,n=0;n<a.length;n++)if(null!=a[n].FromAge&&o>=a[n].FromAge&&(null==a[n].ToAge||o<=a[n].ToAge)){r.baseFare=a[n].Fare;break}},function(e){})}else r.baseFare=void 0;var a},function(e){o.toastError("Error","Can not get faring information. Please try again later."),r.baseFare=void 0})},r.divisionId=t.getDivisionId(),null!=r.divisionId&&null!=r.divisionId&&""!=r.divisionId?(f=r.reservationRequest.reservationType!=r.$parent.reservationTypeEnum.ASAP?r.$parent.getReservationDateTime(r.reservationRequest):moment.tz(t.getTimeZone()),t.getServiceDateByDivisionTime(r.divisionId,f.format("YYYY-MM-DD HHmmss")).then(function(e){r.serviceDate=moment(e.data.result).format("YYYY-MM-DD"),l&&"function"==typeof l&&l()},function(e){o.toastError("Error","Can not get faring information. Please try again later."),r.baseFare=void 0})):$location.path("dashboard/")}angular.module("oneMVApp").controller("FaringModalController",e),e.$inject=["$scope","UtilityFactory","FaringService","$log","$uibModalInstance","DivisionService","ProfileService","reservationRequest","serviceDate"]}();
!function(){"use strict";function o(o,i,t,n,e,r,a,l,c){var m=this;m.trip=a;var p=c;m.allowFaring=p.allowFaring,m.allowChildren=p.allowChildren,m.allowLocationNotes=p.allowLocationNotes;var s=new moment(m.trip.ScheduledPickupTime);m.trip.promiseWindowStartTime=s.format("h:mm A"),moment.isMoment(s)&&(m.trip.promiseWindowEndTime=s.add(parseInt(p.promiseWindow),"m").format("h:mm A")),m.cancel=function(){r.close()},m.cancelTrip=function(o){}}angular.module("oneMVApp").controller("DisplayScheduledTripController",o),o.$inject=["$scope","$http","UtilityFactory","DateFactory","$log","$uibModalInstance","trip","ConfigFactory","options"]}();
!function(){"use strict";function e(u,e,f,n){return{GetZoneIDForLocation:function(n,t,o){var r=e.defer();return f.getOneMVApiURLPromise().then(function(e){e&&""!=e&&u({method:"GET",url:e+"faring/getZoneIdForLocation/"+o+"/"+n+"/"+t+"/"}).then(function(e){r.resolve(e)},function(e){r.reject(e)})}),r.promise},GetZoneFares:function(n,t,o,r,i){var c=e.defer();return f.getOneMVApiURLPromise().then(function(e){e&&""!=e&&u({method:"GET",url:e+"faring/"+n+"/"+t+"/"+o+"/"+r+"/"+i}).then(function(e){c.resolve(e)},function(e){c.reject(e)})}),c.promise}}}angular.module("oneMVApp").factory("FaringService",e),e.$inject=["$http","$q","ConfigFactory","authService"]}();
!function(){"use strict";function e(o,e,t,a,c){return{SaveFeedback:function(n){var i=e.defer();return t.getOneMVApiURLPromise().then(function(e){if(e&&""!=e){var t=e+"trip/"+a.authentication.passengerId+"/feedback/save";o({method:"POST",url:t,data:JSON.stringify(n)}).then(function(e){i.resolve(e)},function(e){i.reject(e)})}}),i.promise},addCommuterFeedback:function(n,i){var r=e.defer();return t.getOneMVApiURLPromise().then(function(e){if(e&&""!=e){var t=e+"commuter/"+c.getDivisionId()+"/reservations/feedback/"+a.authentication.passengerId+"/"+i;o({method:"POST",url:t,data:n}).then(function(e){r.resolve(e)},function(e){r.reject(e)})}}),r.promise}}}angular.module("oneMVApp").factory("FeedbackService",e),e.$inject=["$http","$q","ConfigFactory","authService","DivisionService"]}();
!function(){"use strict";function e(e,o,n,c){var t=this;t.upcomingSchedules=o,t.fromStopName=n,t.cancel=function(){e.close()},t.frInfo=c.getFixedRouteInfo()}angular.module("oneMVApp").controller("FixedRoutesController",e),e.$inject=["$uibModalInstance","upcomingSchedules","fromStopName","OneMvServices"]}();
!function(){"use strict";function e(t,e,o,i,s,n,a){return{link:function(e,t,o){e.type=o.labelname},controller:function(n){n.data=t.getLocations,n.reservationRequest={},n.initialValue="",n.resultsAPI=function(e,t){return n.data(e,n.locationfilter,n.divisionId,n.passengerId,n.googleonly,{timeout:t})},n.selectedGoogleLocationFrom=function(e){if(null!=e){var t="";for(var o in e.address_components)"street_number"==e.address_components[o].types[0]?t=t+" "+e.address_components[o].short_name:"route"==e.address_components[o].types[0]?t=t+" "+e.address_components[o].short_name:"locality"==e.address_components[o].types[0]?n.reservationRequest.City=e.address_components[o].short_name:"administrative_area_level_1"==e.address_components[o].types[0]?n.reservationRequest.State=e.address_components[o].short_name:"postal_code"==e.address_components[o].types[0]&&(n.reservationRequest.ZipCode=e.address_components[o].short_name);n.reservationRequest.Address1=t,n.reservationRequest.From=e.formatted_address,n.reservationRequest.Latitude=e.geometry.location.lat,n.reservationRequest.Longitude=e.geometry.location.lng,n.reservationRequest.GooglePlaceId=e.place_id}},n.onLocationSelectedNotify=function(e){if(n.reservationRequest={},null!=e){var t=e.originalObject;null!=t&&(t.isGoogleLocation?n.selectedGoogleLocationFrom(t.loc):n.reservationRequest=t.loc)}"function"==typeof n.onLocationSelected&&n.onLocationSelected({location:n.reservationRequest})},n.$on("closestLocation",function(e,t){"FROM"===n.type&&(n.initialValue=t.title)}),n.$on("initialLocationValue",function(e,t){n.initialValue=t}),n.$on("homeLocationDisable",function(e,t){"FROM"!=n.type&&(n.disableInput=t)}),n.$on("homeLocationText",function(e,t){"FROM"!=n.type&&(n.initialValue=t)}),n.$on("toggle-from-address",function(e,t){"FROM"==n.type&&(n.disableInput=!t)}),e=function(){i.getServiceAreaLocation(n.divisionId).then(function(e){null!==e.data&&null!=e.data.result&&(n.addressRest=e.data.result.Address,t.setadd(n.addressRest))},function(e){s.toastError("Error","")})},null!=n.addressRest&&""!=n.addressRest||(n.divisionId=a.getDivisionId(),null!=n.divisionId&&null!=n.divisionId&&""!=n.divisionId&&e&&"function"==typeof e&&e());var e},replace:!0,restrict:"E",scope:{onLocationSelected:"&",minlength:"=minlength",locationfilter:"@",labelname:"=labelname",selectedlocation:"=selectedlocation",passengerId:"@",googleonly:"@"},templateUrl:"app/modules/on-demand/reservations/locationSearch.html"}}angular.module("oneMVApp").directive("locationSearchDirective",e),e.$inject=["LocationFactory","$rootScope","$q","ScheduleService","UtilityFactory","authService","DivisionService"]}();
!function(){"use strict";function e(r,n,e){return{saveLocation:function(t){console.log(t);var o=n.defer();return e.getOneMVApiURLPromise().then(function(e){e&&""!=e?r({method:"POST",url:e+"Trip/SaveLocation",data:JSON.stringify(t),ContentType:"application/json; charset=utf-8"}).then(function(e){o.resolve(e)},function(e){o.reject(e)}):($log.error("Error: - Could not fetch service api url"),UtilityFactory.toastError("Could not fetch service api url"))}),o.promise},isAddressInService:function(t){var o=n.defer();return e.getOneMVApiURLPromise().then(function(e){e&&""!=e?r({method:"POST",url:e+"Trip/IsAddressInService",data:JSON.stringify(t),ContentType:"application/json; charset=utf-8"}).then(function(e){o.resolve(e)},function(e){o.reject(e)}):($log.error("Error: - Could not fetch service api url"),UtilityFactory.toastError("Could not fetch service api url"))}),o.promise},getLocationTypes:function(){var t=n.defer();return r({method:"GET",url:"../ServiceArea/GetLocationTypes",ContentType:"application/json; charset=utf-8"}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},getReverseGeoCode:function(e){var t=n.defer();return r.get("//maps.googleapis.com/maps/api/geocode/json",{params:{latlng:e,sensor:!0},withCredentials:!1}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},getGeoCode:function(e){var t=n.defer();return r.get("//maps.googleapis.com/maps/api/geocode/json",{params:{address:e,sensor:!0},withCredentials:!1}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},getLocationData:function(t){var o=n.defer();return e.getOneMVApiURLPromise().then(function(e){e&&""!=e?r({method:"GET",url:e+"Trip/GetManualLocations/?DivisionId="+t,ContentType:"application/json; charset=utf-8"}).then(function(e){o.resolve(e)},function(e){o.reject(e)}):($log.error("Error: - Could not fetch service api url"),UtilityFactory.toastError("Could not fetch service api url"))}),o.promise},editManualLocation:function(t){var o=n.defer();return e.getOneMVApiURLPromise().then(function(e){e&&""!=e?r({method:"GET",url:e+"Trip/EditManualLocation/?locationId="+t,ContentType:"application/json; charset=utf-8"}).then(function(e){o.resolve(e)},function(e){o.reject(e)}):($log.error("Error: - Could not fetch service api url"),UtilityFactory.toastError("Could not fetch service api url"))}),o.promise}}}angular.module("oneMVApp").factory("locationService",e),e.$inject=["$http","$q","ConfigFactory"]}();
!function(){"use strict";function t(o,t,e){return{getDivisionAids:function(i){var n=t.defer();return e.getOneMVApiURLPromise().then(function(t){if(t&&""!=t){var e=t+"MobilityAids/"+i+"?rnd="+(new Date).getTime();o({method:"GET",url:e}).then(function(t){1==t.data.status?n.resolve(t.data.result):n.reject(t.data.result)},function(t){n.reject(t)})}}),n.promise},saveDivisionAids:function(i,n){var r=t.defer();return e.getOneMVApiURLPromise().then(function(t){if(t&&""!=t){var e=t+"MobilityAids/"+i+"?rnd="+(new Date).getTime();o({method:"POST",data:n,url:e}).then(function(t){1==t.data.status?r.resolve(t.data.result):r.reject(t.data.result)},function(t){r.reject(t)})}}),r.promise}}}angular.module("oneMVApp").factory("MobilityAidsService",t),t.$inject=["$http","$q","ConfigFactory"]}();
!function(){"use strict";function e(t,e,o,i,r,n,a,s){var c=this;c.proposedSlots=s.proposedSlots,c.selectedSlot="",c.reservation=angular.copy(s.reservationRequest),c.selectedReservationType="";var d=0,l=0,p=(s.serviceDate,{1:"ASAP",2:"ADVANCED",3:"APPOINTMENT"});c.toPromiseWindow=function(e){return o("date")(e.ProposedStartWindow,"h:mm a")+" - "+o("date")(e.ProposedEndWindow,"h:mm a")};var u=function(e){t.close(e)};c.reject=function(){n.addRejectionLog(l,d),u({canNegotiate:!1})},c.close=function(){u({canNegotiate:!1})},c.accept=function(){if(""!=c.selectedSlot){var e=function(){if(""!=c.selectedSlot)for(var e=0;e<c.proposedSlots.length;e++)if(c.proposedSlots[e].ProposedDate==c.selectedSlot)return c.proposedSlots[e].id;return-1}();n.addApprovalLog(l,e,d),u({canNegotiate:!0,selectedTime:c.selectedSlot,tripRequestId:l,negotiationLogId:e})}},l=s.tripRequestId,d=i.authentication.userId,r.getSystemParameters().PromiseWindow,c.selectedReservationType=p[c.reservation.reservationType]}angular.module("oneMVApp").controller("NegotiationController",e),e.$inject=["$uibModalInstance","$scope","$filter","authService","DivisionService","TripNegotiationLogService","DateFactory","negotiationRequest"]}();
!function(){"use strict";function e(e,n){var o=this;o.msg=n.message.ErrorMessage,o.header=n.header||"Information",o.cancel=function(){e.close()}}angular.module("oneMVApp").controller("ReservationErrorModalController",e),e.$inject=["$uibModalInstance","message"]}();
!function(){"use strict";function e(v,T,S,A,P,M,w,C,y,O,N,q,k){return{link:function(o,e,t){o.isLoading&&o.options&&o.activate();o.$watch("options",function(e,t){e!=t&&e&&(o.options=e,o.activate())})},controller:function(p,f){p.reservationRequest={},p.aids=[],p.assistants=[],p.populateRuns=u,p.populateCount=function(e){return new Array(e)},p.childrenCount=function(e){for(var t=[],o=0;o<=e;o++)t.push(o);return t},p.populateHours=function(){return new Array("01","02","03","04","05","06","07","08","09","10","11","12")},p.populateMinutes=function(){for(var e=new Array,t=0;t<60;t+=5)e.push(t<10?"0"+t.toString():t.toString());return e},p.dataServiceFrom=T.dataServiceFrom,p.dataServiceTo=T.dataServiceTo,p.saveReservation=function(a){p.options.allowReservationOnlyWhenGpsIsOn&&i()&&C.getCurrentPosition().then(function(){i()});if((a.reservationType==g.ADVANCED||a.reservationType==g.APPOINTMENT)&&!p.isDateSelected)return void r();p.isDateSelected||(a.IsASAP=!0);p.isSaving=!0;var e=R(),t=p.schedMin;if(a.ReservationTime=1==e.toString().length?"0"+e.toString()+t:e.toString()+t,function(e){if(!p.passenger||!p.passenger.Id)return S.toastInfo("Please select a Passenger"),!1;if(p.passenger.IsDeactivated)return S.toastInfo("Please select an Active Passenger"),!1;if("reservation"==p.mode&&!e.IsASAP&&p.options.isAdvancedReservation){if(!e.ReservationTime||null==e.ReservationTime)return S.toastInfo("Please enter a valid Reservation Time"),!1;var t=w.getTimeZone(),o=e.ReservationDate.getDate(),n=e.ReservationDate.getMonth()+1,i=e.ReservationDate.getFullYear(),a=i+"/"+n+"/"+o+" "+e.ReservationTime,s=moment.tz(a,"YYYY/M/D HHmm",t),r=moment.tz(t);if(s.isBefore(r))return S.toastInfo("Please enter a Reservation Time which is greater than the current time"),!1}if(!e.FromLocation)return S.toastInfo("Please enter a valid From Location"),!1;if(!e.ToLocation)return S.toastInfo("Please enter a valid To Location"),!1;if(e.FromLocation.GooglePlaceId&&e.ToLocation.GooglePlaceId){if(e.FromLocation.GooglePlaceId==e.ToLocation.GooglePlaceId)return S.toastInfo("From and To locations should not be same"),!1}else if(e.FromLocation.LocationId&&e.ToLocation.LocationId&&e.FromLocation.LocationId==e.ToLocation.LocationId)return S.toastInfo("From and To locations should not be same"),!1;if("reconciliation"==p.mode){if(null==e.ReservationDate||null==e.ReservationDate)return S.toastInfo("Please enter a valid Reservation Date"),!1;if(!e.ArrivePickUpTime||null==e.ArrivePickUpTime)return S.toastInfo("Please enter a valid Arrive PickUpTime"),!1;if(!e.PerformDropOffTime||null==e.PerformDropOffTime)return S.toastInfo("Please enter a valid Perform DropOffTime"),!1;if(null==e.Run||!e.Run.RunId)return S.toastInfo("Please select a Run"),!1}return!0}(a))if(p.isFRServiceActive){var o=p.options.checkFRBeforeDRT,n=p.options.noOfFRArrivals;o?y.getUpcomingArrivalsForStop(p.options.DivisionId,a.FromLocation.LocationId,a.ToLocation.LocationId,n).then(function(e){var t,o,n,i=e.data;0<i.length?(t=i,o=a.FromLocation.Name,n=M.defer(),f.open({animation:!0,templateUrl:"app/modules/on-demand/reservations/fixed-routes.html",controller:"FixedRoutesController as vm",size:"-fs",backdrop:"static",resolve:{upcomingSchedules:function(){return t},fromStopName:function(){return o}}}).result.then(function(e){}),n.promise,p.isSaving=!1):d(a)},function(e){}):d(a)}else d(a);else p.isSaving=!1},p.disableSaveButton=function(){return isSaving},p.setPickupDateTime=l,p.activate=function(){p.isFRServiceActive=!angular.isUndefined(k.getFixedRouteInfo()),A.getServiceDateByDivision(p.options.DivisionId).then(function(e){1==e.data.status&&(p.serviceDate=moment(e.data.result),"reconciliation"==p.mode&&(p.minDate=new Date(1990,5,22),p.maxDateAllowed=p.serviceDate))},function(e){S.toastError("Error!","Failed to get service date.")}).then(u),p.isStartDp=!1;var e=new Date;p.dateOptions.minDate=new Date(e.setDate(e.getDate()+p.options.passengerBookingMinDays)),p.dateOptions.maxDate=new Date(e.setDate(e.getDate()+p.options.passengerBookingMaxDays)),p.reservationRequest.ReservationDateView=p.dateOptions.minDate,p.showCalendar=!p.options.isAdvancedReservation,p.showCalendarButton=t(),p.isLoading=!1,h()},p.resetForm=h,p.closeDateTimePicker=function(){p.options.isAdvancedReservation&&0<p.options.passengerBookingMinDays?a():(p.timepickerObject.schedHrView=p.schedHr,p.timepickerObject.schedMinView=p.schedMin,p.timepickerObject.AMPMView=p.AMPM,p.displayDateTimepicker=!1,p.reservationRequest.ReservationDateView=p.reservationRequest.ReservationDate,p.isDateSelected||s(),p.showCalendarButton=t())},p.timepickerClicked=r,p.resetDateOptionFields=o,p.resetDates=a,p.displayFaring=function(){f.open({animation:!0,templateUrl:"app/modules/on-demand/faring/faring-modal.html",controller:"FaringModalController as vm",size:"-fs",windowClass:"phone-modal--fullscreen",backdrop:"static",scope:p,resolve:{reservationRequest:function(){return p.reservationRequest},serviceDate:function(){return p.serviceDate}}}).result.then(function(e){e&&(p.reservationRequest=e)})},p.disableFaringButton=function(){return!(p.isAllowed&&!p.isSaving&&null!=p.reservationRequest.FromLocation&&!angular.equals(p.reservationRequest.FromLocation,{})&&null!=p.reservationRequest.ToLocation&&!angular.equals(p.reservationRequest.ToLocation,{}))},p.getReservationDateTime=function(e){var t=R(),o=new Date(e.ReservationDate.setHours(t,parseInt(p.schedMin),0)),n=o.getDate(),i=o.getMonth()+1,a=o.getFullYear()+"/"+i+"/"+n+" "+t.toString()+":"+p.schedMin;return moment.tz(a,"YYYY/M/D HH:mm",w.getTimeZone())},p.toggleOptions=function(){p.isHidden=!p.isHidden},p.isLoading=!0,p.isHidden=!1,p.showCalendarButton=!0,p.showCalendar=!1,p.runs=[],p.loadingRuns=!1,p.isSaving=!1,p.division,p.operator,p.systemParameters,p.displayDateTimepicker=!1,p.minDate=new Date,p.requestDateTime=void 0,p.isDateSelected=!1,p.isGpsEnabled=!0,p.hasGpsBeenChecked=!1,p.dateOptions={formatYear:"yy",minDate:new Date,startingDay:1,showWeeks:!1},p.timepickerObject={},p.isFRServiceActive=!1,p.isUserAllowedToMakeAReservation=i,n(),p.isAllowed=!0;var g={ASAP:1,ADVANCED:2,APPOINTMENT:3};p.reservationTypeEnum=g;function t(){return!!p.options.isAdvancedReservation&&(!p.displayDateTimepicker&&!p.isDateSelected)}function i(){p.hasGpsBeenChecked||(p.hasGpsBeenChecked=!0,C.getCurrentPosition());var e=!0;return p.options&&p.options.allowReservationOnlyWhenGpsIsOn&&p.hasGpsBeenChecked&&(e=!p.options.allowReservationOnlyWhenGpsIsOn||p.isGpsEnabled),e}function e(){var e=moment.tz(w.getTimeZone()),t=parseInt(e.format("HH")),o=parseInt(e.format("mm")),n=12<t?t-12:0==t?12:t,i=0==o?0:5==o?5:5*Math.ceil(o/5);p.timepickerObject.AMPMView=e.format("a").toUpperCase(),p.timepickerObject.schedHrView=n<10?"0"+n.toString():n.toString(),p.timepickerObject.schedMinView=o<5?"0"+i.toString():i.toString(),p.reservationRequest.ReservationDateView=p.dateOptions.minDate,p.schedHr=p.timepickerObject.schedHrView,p.schedMin=p.timepickerObject.schedMinView,p.AMPM=p.timepickerObject.AMPMView,p.reservationRequest.ReservationDate=p.reservationRequest.ReservationDateView}function h(){o(),p.$broadcast("angucomplete-alt:clearInput")}function o(){p.reservationRequest={},p.reservationRequest.PassengerCount="1",p.reservationRequest.CompanionsCount="0",p.reservationRequest.mobilityAid="none",p.reservationRequest.IsWheelChair=!1,p.reservationRequest.IsPCA=!1,p.reservationRequest.IsServiceAnimal=!1,p.reservationRequest.TripFares=[],s(),a(),n()}function n(){p.options&&p.options.allowLocationNotes&&(p.reservationRequest.locationNotes={from:"",to:""})}function a(){e(),p.options.isAdvancedReservation&&0<p.options.passengerBookingMinDays?p.reservationRequest.ReservationDate&&l():(p.isDateSelected=!1,p.displayDateTimepicker=!1),p.showCalendarButton=t()}function s(){p.options.isAdvancedReservation&&0<p.options.passengerBookingMinDays?p.reservationRequest.reservationType=p.reservationTypeEnum.ADVANCED:p.options.allowASAPReservations?p.reservationRequest.reservationType=p.reservationTypeEnum.ASAP:p.options.isAdvancedReservation&&(p.reservationRequest.reservationType=p.reservationTypeEnum.ADVANCED)}function r(){p.displayDateTimepicker=!p.displayDateTimepicker,p.options.isAdvancedReservation?p.reservationRequest.reservationType=String(g.ADVANCED):p.options.allowAppointments&&(p.reservationRequest.reservationType=String(g.APPOINTMENT)),p.isDateSelected=!1,p.showCalendarButton=!1,e()}function l(){if(p.schedHr=p.timepickerObject.schedHrView,p.schedMin=p.timepickerObject.schedMinView,p.AMPM=p.timepickerObject.AMPMView,p.reservationRequest.ReservationDate=p.reservationRequest.ReservationDateView,p.isDateSelected=!0,angular.isUndefined(p.reservationRequest)||null===p.reservationRequest||p.reservationRequest.reservationType==g.ASAP)return!1;var e=0;e="PM"===p.AMPM&&12!=parseInt(p.schedHr)?parseInt(p.schedHr)+12:"AM"===p.AMPM&&12==parseInt(p.schedHr)?0:parseInt(p.schedHr),p.requestDateTime=new Date(p.reservationRequest.ReservationDate).setHours(e,parseInt(p.schedMin),0),p.displaySelectedDate=!0,p.displayDateTimepicker=!1}function u(){$("#rdoNoMobilityAids").prop("checked",!0),q.GetDefaultMobilityAids(p.options.DivisionId,p.passenger.Id).then(function(e){p.aids.length=0;var t={IsSelected:!(p.assistants.length=0),KeyName:"no aids",Group:2,DisplayName:"No Mobility Aid Required"};p.aids.push(t);for(var o=0,n=0;n<e.length;n++){var i=e[n];1==i.Group?(i.selected=i.IsSelected,p.assistants.push(i)):2==i.Group&&(1==i.IsSelected&&(0<o&&(i.IsSelected=!1),o++),i.selected=i.IsSelected,i.IsSelected&&(t.IsSelected=!1),p.aids.push(i))}},function(e){S.toastError("Error",e.Message)}),p.passenger||(p.loadingRuns=!0,"reconciliation"==p.mode?A.getPastRuns(p.options.DivisionId,runDate).then(function(e){if(p.loadingRuns=!1,null!=e.data){p.runs=e.data.result;for(var t=0;t<p.runs.length;t++)p.runs[t].StartTimeDisplay=P.getCustomTime(p.runs[t].StartTime,runDate),p.runs[t].EndTimeDisplay=P.getCustomTime(p.runs[t].EndTime,runDate)}else S.toastError("Error",e.data.ReturnMessage)},function(e){p.loadingRuns=!1,S.toastError("Error",e.data.ReturnMessage)}):A.getActiveRuns(p.options.DivisionId,runDate).then(function(e){if(p.loadingRuns=!1,null!=e.data){p.runs=e.data.result;for(var t=0;t<p.runs.length;t++)p.runs[t].StartTimeDisplay=P.getCustomTime(p.runs[t].StartTime,runDate),p.runs[t].EndTimeDisplay=P.getCustomTime(p.runs[t].EndTime,runDate);var o=[];angular.forEach(p.runs,function(e,t){"109"==e.logisticStatus||"Frozen"==e.Status||e.IsDeleted||o.push(e)}),p.runs=o}else S.toastError("Error",e.data.ReturnMessage)},function(e){p.loadingRuns=!1,S.toastError("Error",e.data.ReturnMessage)}))}function D(e,t){"function"==typeof p.notifySucessfullReservation&&p.notifySucessfullReservation(e,t)}function R(){return"PM"===p.AMPM&&12!=parseInt(p.schedHr)?parseInt(p.schedHr)+12:"AM"===p.AMPM&&12==parseInt(p.schedHr)?0:parseInt(p.schedHr)}function d(u){S.toastInfo("Creating Trip");var d={},c={};if(d.PassengerID=parseInt(p.passenger.Id),u&&u.reservationType!=g.ASAP&&u.ReservationTime)if(p.passenger){var e=R(),t=new Date(u.ReservationDate.setHours(e,parseInt(p.schedMin),0)),o=t.getDate(),n=t.getMonth()+1,i=t.getFullYear(),a=i+"/"+n+"/"+o+" "+e.toString()+":"+p.schedMin;d.RequestedStartDateTime=moment.tz(a,"YYYY/M/D HH:mm",w.getTimeZone())}else d.RequestedStartDateTime=P.getDateFromCustomTime(u.ReservationTime,moment(u.ReservationDate));if(d.OperationID=null!=p.options.OperatorId?p.options.OperatorId:null,d.NumOfPassengers=u.PassengerCount,d.NumOfWheelChairPassengers=0,d.NumOfXLWheelChairPassengers=0,d.NumOfScooterPassengers=0,d.NumOfWalkerPassengers=0,d.NumOfPCAs=0,d.NumOfServiceAnimals=0,d.NumOfBikePassengers=0,p.options.allowEquipment){if(0<p.aids.length)for(var s=0;s<p.aids.length;s++){var r=p.aids[s];if(r.IsSelected){d.SelectedMobilityAidId=r.MVMobilityAidsId;var l=r.KeyName.trim().toLowerCase();"wc"==l?(d.NumOfPassengers=u.PassengerCount-1,d.NumOfWheelChairPassengers=1):"wcxl"==l?(d.NumOfPassengers=u.PassengerCount-1,d.NumOfXLWheelChairPassengers=1):"sctr"==l?(d.NumOfPassengers=u.PassengerCount-1,d.NumOfScooterPassengers=1):"wkr"==l?(d.NumOfPassengers=u.PassengerCount-1,d.NumOfWalkerPassengers=1):"birk"==l&&(d.NumOfPassengers=u.PassengerCount-1,d.NumOfBikePassengers=1)}}if(0<p.assistants.length)for(var s=0;s<p.assistants.length;s++){var m=p.assistants[s];if(m.IsSelected){var l=m.KeyName.trim().toLowerCase();"sa"==l?d.NumOfServiceAnimals=1:"pca"==l&&(d.NumOfPCAs=1)}}}if(d.NumOfCompanions=u.CompanionsCount,d.RunId=u&&u.Run&&u.Run.RunId?u.Run.RunId:null,d.StartAddressViewModel=u.FromLocation,d.EndAddressViewModel=u.ToLocation,d.ReservationType=u.reservationType,angular.equals(d.StartAddressViewModel,{})||null==d.StartAddressViewModel)return S.toastError("Error","Invalid location"),p.isSaving=!1;if(angular.equals(d.EndAddressViewModel,{})||null==d.EndAddressViewModel)return S.toastError("Error","Invalid location"),p.isSaving=!1;if(p.options&&p.options.allowLocationNotes&&(d.StartAddressViewModel.LocationNote=u.locationNotes.from.trim(),d.EndAddressViewModel.LocationNote=u.locationNotes.to.trim()),null!=u.TripFares&&(d.TripFares=u.TripFares),null!=u.TotalTripFare&&(d.TotalTripFare=u.TotalTripFare),d.IsDivisionAdvanced=p.options.isAdvancedReservation,d.ServiceDate=p.serviceDate,d.IsWillCall=u.IsWillCall,"reconciliation"==p.mode){d.RunId||(d.RunId=-1),d.RunDate=u.ReservationDate;var v=moment(u.ReservationDate);d.ArrivePickUpDateTimeUTC=P.getDateFromCustomTime(u.ArrivePickUpTime,v),d.PerformPickUpDateTimeUTC=P.getDateFromCustomTime(u.PerformPickUpTime,v),d.ArriveDropOffDateTimeUTC=P.getDateFromCustomTime(u.ArriveDropOffTime,v),d.PerformDropOffDateTimeUTC=P.getDateFromCustomTime(u.PerformDropOffTime,v),A.savePastTrip(d).then(function(e){1==e.data.status?(c=e.data.result,h(),S.toastSuccess(e.data.message),D(c)):S.toastInfo(e.data.message),p.isSaving=!1},function(e){S.toastError("Error",e.data),p.isSaving=!1})}else"reservation"==p.mode&&A.schedulepost(d).then(function(t){if(1==t.data.status)c=t.data.result,h(),S.toastSuccess(t.data.message),D(c,parseInt(u.reservationType)==g.ASAP);else if(null!=t.data.errors){var n=-1,i=-1,a=!1,s=!1;$.each(t.data.errors,function(e,t){var o=t.ErrorCode;-8==o?n=e:-7==o?i=e:9==o?a=!0:10==o&&(s=!0)}),0<=n?I(t.data.errors[n]).then(function(e){0<=i&&showOverrideModal(t.data.errors[i]).then(function(e){})}):0<=i?I(t.data.errors[i]).then(function(e){}):s?(e=t,(r=d).NegotiationInfo=void 0,e.data.result&&(o=e.data,l=M.defer(),f.open({animation:!0,templateUrl:"app/modules/on-demand/reservations/negotiation-modal.html",controller:"NegotiationController as vm",size:"-fs",resolve:{negotiationRequest:function(){return{proposedSlots:o.result.ProposedSlots,reservationRequest:p.reservationRequest,tripRequestId:o.result.tripRequestId,serviceDate:p.serviceDate}}}}).result.then(function(e){e.canNegotiate?e.selectedTime&&e.canNegotiate&&l.resolve({NegotiationInfo:{IsNegotiated:!0,SelectedTime:e.selectedTime,tripRequestId:e.tripRequestId,NegotiationLogId:e.negotiationLogId}}):l.resolve({NegotiationInfo:{IsNegotiated:!1}})}),l.promise).then(function(e){var t,o,n;o=r,(t=e)&&t.NegotiationInfo&&t.NegotiationInfo.IsNegotiated&&(o.NegotiationInfo=t.NegotiationInfo,o.RequestedStartDateTime=t.NegotiationInfo.SelectedTime,n=o,A.schedulepost(n).then(function(e){if(1==e.data.status){var t=e.data.result;h(),S.toastSuccess(e.data.message),D(t,parseInt(n.ReservationType)==g.ASAP)}else S.toastError("Creating Reservation",e.data.message);p.isSaving=!1},function(e){S.toastError("Error",e.data),p.isSaving=!1}))})):a?I(t.data.errors[0],"Capacity Unavailable"):S.toastError("Creating Reservation",t.data.message)}else S.toastError("Creating Reservation",t.data.message);var e,r,o,l;p.isSaving=!1},function(e){S.toastError("Error",e.data),p.isSaving=!1})}function I(e,t){var o=M.defer(),n=f.open({animation:!0,templateUrl:"app/modules/on-demand/reservations/reservation-modal-message.html",controller:"ReservationErrorModalController as vm",size:"-fs",backdrop:"static",resolve:{message:function(){return{message:e,header:t}}}});return n.result.then(function(e){o.resolve(e)}),o.promise}function c(e,t){O.GetZoneIDForLocation(e.Latitude,e.Longitude,p.options.DivisionId).then(function(e){"from"===t?p.reservationRequest.fromZone=null==e.data.result?0:e.data.result:p.reservationRequest.toZone=null==e.data.result?0:e.data.result},function(e){})}function m(n){C.getCurrentPosition().then(function(e){if(e){var t=function(e,t){var o=e.latitude,n=e.longitude,i=t.latitude,a=t.longitude,s=(i-o)*Math.PI/180,r=(a-n)*Math.PI/180,l=Math.sin(s/2)*Math.sin(s/2)+Math.cos(o*Math.PI/180)*Math.cos(i*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2),u=2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l));Math.asin(Math.sqrt(l));return Number(6371*u*.62137*5280).toFixed(2)}({latitude:e.coords.latitude,longitude:e.coords.longitude},{latitude:n.Latitude,longitude:n.Longitude}),o=p.options.maxRadiusToAllowBooking;o<t&&(S.toastError("Cannot book trip!","The pickup location must be within "+o+" feet of your current location.",15e3),p.isAllowed=!1)}})}p.$on("GeoLocationService.gpsIsAvailable",function(e,t){p.isGpsEnabled=t.gpsIsEnabled,!t.gpsIsEnabled&&p.options&&p.options.allowReservationOnlyWhenGpsIsOn&&(p.isGpsEnabled||(p.$broadcast("toggle-from-address",!p.options.allowReservationOnlyWhenGpsIsOn),document.getElementById("toast-container")||S.toastInfo("Information","Enable gps to make a reservation.",1e4),N(function(){$("[uib-modal-window=modal-window]").remove(),$("body").removeClass("modal-open")},3e3),N(function(){i()||($("[uib-modal-window=modal-window]").remove(),$("body").removeClass("modal-open"),v.location.replace("#/"),v.location.reload(!0))},15e3))),p.hasGpsBeenChecked=!0}),p.clickMobilityAid=function(e){if(p.aids&&0<p.aids.length){for(var t=0;t<p.aids.length;t++)p.aids[t].IsSelected=!1;e&&(e.IsSelected=!0)}},p.selectedLocationFrom=function(e){p.reservationRequest.FromLocation=e,p.isAllowed=!0,p.options.allowReservationOnlyWhenGpsIsOn&&m(e),c(e,"from")},p.selectedLocationTo=function(e){c(p.reservationRequest.ToLocation=e,"to")},p.$on("closestLocation",function(e,t){p.reservationRequest.FromLocation=t.loc,c(t.loc,"from")}),p.$on("homeLocation",function(e,t){p.selectedLocationTo(t)})},restrict:"E",scope:{passenger:"<",options:"<",mode:"@",notifySucessfullReservation:"=onReservationSuccess"},replace:!0,templateUrl:"app/modules/on-demand/reservations/passengerReservationForm.html"}}angular.module("oneMVApp").directive("reservationFormDirective",e),e.$inject=["$window","LocationFactory","UtilityFactory","ScheduleService","DateFactory","$q","DivisionService","GeoLocationService","StopService","FaringService","$timeout","ProfileService","OneMvServices"]}();
!function(){"use strict";function e(e,t,i,o,l,r,c,p,g){return{link:{pre:function(t,e,i){l.getServiceAreaLocation().then(function(e){null!==e.data&&(t.centerLatitude=e.data.Latitude,t.centerLongitude=e.data.Longitude,t.addressRest=e.data.Address,0<t.tripRequest.length?("string"==typeof t.tripRequest&&(t.tripRequest=JSON.parse(t.tripRequest)),t.isFleetMap=!1):t.isFleetMap=!0,t.setMap())},function(e){p.toastError("Error",$scope.returnMsg)})},post:function(i,e,t){i.$watch("currentTrip",function(e,t){e!==t&&""!=e&&("string"==typeof e?i.currentTrip=JSON.parse(e):"object"==typeof e&&(i.currentTrip=e,i.setCurrentTripMap()))}),i.$watch("passenger",function(e,t){e!==t&&""!=e&&("string"==typeof e?i.passenger=JSON.parse(e):"object"==typeof e&&(i.passenger=e,i.getCurrentActiveTrip()))}),i.$watch("dispatchSelectedRunId",function(e,t){e!==t&&""!=e&&("string"==typeof e?(i.dispatchSelectedRunId=JSON.parse(e),i.clearMarkers(),i.selectedTripmarkerDetails=[]):"object"==typeof e&&(i.dispatchSelectedRunId=e))}),i.$watch("dispatchSelectedTrip",function(e,t){e!==t&&""!=e&&("string"==typeof e?(i.dispatchSelectedTrip=JSON.parse(e),i.selectedTripmarkerDetails=[]):"object"==typeof e&&(i.selectedTripmarkerDetails=[],i.dispatchSelectedTrip=e,i.setSelectedTripMap()))})}},controller:function(r){r.minlengthlimit=3,r.map={center:{latitude:40.680638,longitude:-99.228516},zoom:10,lineStyle:{color:"#333",weight:5,opacity:.7}},r.showTraffic=!1,null!=r.dispatchSelectedRunId&&(r.showTraffic=!0);r.mapControl={},r.mapOptions={mapTypeControl:!1,zoomControl:!1,streetViewControl:!1};var t="";r.stopMarker=[],r.addressRest=null,r.setMap=function(){r.map={center:{latitude:r.centerLatitude,longitude:r.centerLongitude},zoom:15},r.isFleetMap?i=g(function(){!function(){e();null!=r.tripId&&l.getDriverGPS(r.tripId).then(function(e){if(null!=e.data)if(r.activeTripRunId=e.data.RunId,a=e.data.IsTripActive)e.data.IsCancelable||(r.disableCancel=!0);else{r.passengerId;l.getlastripdetails(r.passengerId).then(function(e){if(1!=e.data.status)return r.tripId=null,r.tripRequest.From=null,r.tripRequest.To=null,r.activeTrip=!1,r.cancelTrip=!0,r.scheduleMarkers=[],void n.setMap(null);r.tripRequest.From=e.data.result.StartAddressViewModel.Address1+", "+e.data.result.StartAddressViewModel.City+", "+e.data.result.StartAddressViewModel.ZipCode,r.tripRequest.To=e.data.result.EndAddressViewModel.Address1+", "+e.data.result.EndAddressViewModel.City+", "+e.data.result.EndAddressViewModel.ZipCode,r.tripRequest.FromLat=e.data.result.StartAddressViewModel.Latitude,r.tripRequest.FromLong=e.data.result.StartAddressViewModel.Longitude,r.tripRequest.ToLat=e.data.result.EndAddressViewModel.Latitude,r.tripRequest.ToLong=e.data.result.EndAddressViewModel.Longitude,r.activeTrip=!0,r.cancelTrip=!1,r.tripId=e.data.result.TripID,r.tripRequest.Shuttle=e.data.result.VehicleName,r.tripRequest.RunName=e.data.result.RunName,r.tripRequest.StartTime=e.data.result.EstimatedPickupTime,r.tripRequest.EndTime=e.data.result.EstimatedDestinationTime,r.disableCancel=!1,d(r.tripRequest)},function(e){p.toastError("Error",e.data)})}},function(e){});null!=r.dispatchSelectedRunId?l.getActiveRuns(t.DivisionID,null).then(function(e){if(null!=e.data){for(var t=0;t<e.data.result.length;t++)if(r.getActiveRuns=e.data.result[t],r.getActiveRuns.RunId==r.dispatchSelectedRunId&&null!=r.getActiveRuns.LatestVehicleLatitude&null!=r.getActiveRuns.LatestVehicleLongitude){r.vehiclesMarkerDetails.push({vehicleName:r.getActiveRuns.VehicleName,driverName:r.getActiveRuns.DriverName,latitude:r.getActiveRuns.LatestVehicleLatitude,longitude:r.getActiveRuns.LatestVehicleLongitude,runName:r.getActiveRuns.RunName,runId:r.getActiveRuns.RunId,icon:"../../images/VehicleCurrentTrip.png"})}}else p.toastError("Error",r.returnMsg)},function(e){p.toastError("Error",r.returnMsg)}):l.getActiveRuns(t.DivisionID,null).then(function(e){if(null!=e.data){for(var t=0;t<e.data.result.length;t++)if(r.getActiveRuns=e.data.result[t],null!=r.getActiveRuns.LatestVehicleLatitude&null!=r.getActiveRuns.LatestVehicleLongitude)if(null!=r.activeTripRunId&&r.getActiveRuns.RunId==r.activeTripRunId&&a){var i="../../images/VehicleCurrentTrip.png";r.vehiclesMarkerDetails.push({vehicleName:r.getActiveRuns.VehicleName,driverName:r.getActiveRuns.DriverName,latitude:r.getActiveRuns.LatestVehicleLatitude,longitude:r.getActiveRuns.LatestVehicleLongitude,runName:r.getActiveRuns.RunName,runId:r.getActiveRuns.RunId,icon:i})}else if(null!=r.getActiveRuns.DriverId&&null!=r.getActiveRuns.VehicleId)if(0<r.getActiveRuns.NumOfActiveTrips){var i="../../images/VehicleActiveTrips.png";r.vehiclesMarkerDetails.push({vehicleName:r.getActiveRuns.VehicleName,driverName:r.getActiveRuns.DriverName,latitude:r.getActiveRuns.LatestVehicleLatitude,longitude:r.getActiveRuns.LatestVehicleLongitude,runName:r.getActiveRuns.RunName,runId:r.getActiveRuns.RunId,icon:i})}else{var i="../../images/VehicleNoTrips.png";r.vehiclesMarkerDetails.push({vehicleName:r.getActiveRuns.VehicleName,driverName:r.getActiveRuns.DriverName,latitude:r.getActiveRuns.LatestVehicleLatitude,longitude:r.getActiveRuns.LatestVehicleLongitude,runName:r.getActiveRuns.RunName,runId:r.getActiveRuns.RunId,icon:i})}}else p.toastError("Error",r.returnMsg)},function(e){p.toastError("Error",r.returnMsg)})}()},5e3):d(r.tripRequest)},r.getCurrentActiveTrip=function(){if(r.passengerId=r.passenger.Id,null==r.passenger.Id)return void p.toastError("Error",errormsg.data);l.getlastripdetails(r.passenger.Id).then(function(e){if(1==e.data.status){e.data;r.activeTripRunId=e.data.result.RunID,r.tripRequest.FromLat=e.data.result.StartAddressViewModel.Latitude,r.tripRequest.FromLong=e.data.result.StartAddressViewModel.Longitude,r.tripRequest.ToLat=e.data.result.EndAddressViewModel.Latitude,r.tripRequest.ToLong=e.data.result.EndAddressViewModel.Longitude,r.tripRequest.tripId=e.data.result.TripID,r.tripId=e.data.result.TripID,d(r.tripRequest)}else r.tripId=null,r.tripRequest.From=null,r.tripRequest.To=null,r.scheduleMarkers=[],n.setMap(null)},function(e){p.toastError("Error",e.data)})},r.setCurrentTripMap=function(){r.tripRequest.FromLat=r.currentTrip.StartAddressViewModel.Latitude,r.tripRequest.FromLong=r.currentTrip.StartAddressViewModel.Longitude,r.tripRequest.ToLat=r.currentTrip.EndAddressViewModel.Latitude,r.tripRequest.ToLong=r.currentTrip.EndAddressViewModel.Longitude,r.tripRequest.tripId=r.currentTrip.TripID,r.tripId=r.currentTrip.TripID,d(r.tripRequest)},r.setSelectedTripMap=function(){for(var e=0;e<r.dispatchSelectedTrip.length;e++)t="pickup"==r.dispatchSelectedTrip[e].Type?"../../images/pickup.png":"../../images/dropoff.png",r.selectedTripmarkerDetails.push({tripId:r.dispatchSelectedTrip[e].TripID,scheduleTime:r.dispatchSelectedTrip[e].SchedTimeView,latitude:r.dispatchSelectedTrip[e].Latitude,longitude:r.dispatchSelectedTrip[e].Longitude,locationName:r.dispatchSelectedTrip[e].LoactionName,locationAddress:r.dispatchSelectedTrip[e].LoactionAddress,icon:t});var t=null;u()},r.clearMarkers=e;var a,i=void 0;r.tripid=null,r.passengerId=null,r.activeTripRunId=null,r.passenger={},r.tripRequest={},r.currentTrip={},r.dispatchSelectedRunId=null,r.dispatchSelectedTrip=[],r.activeTrip=!1,r.cancelTrip=!1,r.disableCancel=!1,r.vehiclesMarkerDetails=[],r.selectedTripmarkerDetails=[],r.centerLatLong;var n=new google.maps.DirectionsRenderer({suppressMarkers:!0,draggable:!1}),s=new google.maps.DirectionsService;function d(e){r.scheduleMarkers=[],n.setMap(r.mapControl.getGMap()),r.scheduleMarkers.push({latitude:e.FromLat,longitude:e.FromLong,icon:"../../images/pickup.png",tripId:r.tripRequest.tripId}),r.scheduleMarkers.push({latitude:e.ToLat,longitude:e.ToLong,icon:"../../images/dropoff.png",tripId:r.tripRequest.tripId});var t={origin:new google.maps.LatLng(e.FromLat,e.FromLong),destination:new google.maps.LatLng(e.ToLat,e.ToLong),travelMode:google.maps.DirectionsTravelMode.DRIVING};s.route(t,function(e,t){t===google.maps.DirectionsStatus.OK?(n.setDirections(e),u()):window.alert("Directions request failed due to "+t)})}function u(){var t=new google.maps.LatLngBounds;angular.forEach(r.selectedTripmarkerDetails,function(e){t.extend(new google.maps.LatLng(e.latitude,e.longitude))}),r.mapControl.getGMap().fitBounds(t)}function e(){r.vehiclesMarkerDetails=[]}o.getCurrentDivision().then(function(e){t=e},function(){}),r.tripMarkerEvent={click:function(e,t,i){i.$id&&(r.tripCoords=i.coords,r.showTrip=!0)}},c.promise().then(function(e){google.maps.event.trigger(r.mapControl.getGMap(),"resize")}),r.markerEvent={click:function(e,t,i){i.$id&&(r.coords=i.coords,r.show=!0)}},r.$on("$destroy",function(e){angular.isDefined(i)&&(g.cancel(i),i=void 0)})},restrict:"E",scope:{passenger:"@",tripRequest:"@",currentTrip:"@",dispatchSelectedRunId:"@",dispatchSelectedTrip:"@"},templateUrl:"app/modules/on-demand/reservations/reservationMap.html"}}angular.module("oneMVApp").directive("reservationMapDirective",e),e.$inject=["$window","$http","$filter","ConfigFactory","ScheduleService","DateFactory","uiGmapIsReady","UtilityFactory","$interval"]}();
!function(){"use strict";function reservationsController($location,$scope,$state,$timeout,$window,$uibModal,ConfigFactory,ScheduleService,uiGmapIsReady,DivisionService,MessageBox,UtilityFactory,authService,GeoLocationService,LocationFactory,RedirectionService,ProfileService,googleMapsConfig,PageService){var vm=this;PageService.setTitle("New Reservation"),PageService.setHeadline("On Demand"),vm.reservationRequest={},vm.reservationRequest.ReservationDate=new Date,vm.minDate=new Date,vm.maxDateAllowed=new Date(2017,2,28),vm.currentPassenger={Id:authService.authentication.passengerId};var operatorId=null;vm.userReservationOptions={},vm.hasActiveTrip=!1,vm.hasFutureTrips=!1,vm.position=null,vm.reservationType="current";var divisionId="",closestPin,otherPin,locationPin,myLocationPin,hubIcon;vm.homePassengerId=null,myLocationPin=0<$window.navigator.userAgent.indexOf("Trident")||0<$window.navigator.userAgent.indexOf("MSIE")?"images/pin-my-location.png":"images/pin-my-location.svg";var getActiveTrip=function(){ScheduleService.getlastripdetails(vm.currentPassenger.Id).then(function(o){1===o.data.status&&o.data.result?vm.hasActiveTrip=!0:ScheduleService.tripsForServiceDate(vm.currentPassenger.Id).then(function(o){1===o.data.status&&o.data.result&&0<o.data.result.length&&(vm.hasFutureTrips=!0)},function(o){vm.hasFutureTrips=!1})},function(o){vm.hasActiveTrip=!1,vm.hasFutureTrips=!1})};function populateDivisionParameters(){getActiveTrip(),vm.userReservationOptions={DivisionId:divisionId,OperatorId:operatorId},ConfigFactory.getDivisionParameters(divisionId).then(function(params){if(params){var options=vm.userReservationOptions;options.passengersLimit=params.PassengersLimit?eval(params.PassengersLimit):5,options.allowWillCall=!!params.AllowWillCall&&eval(params.AllowWillCall.toLowerCase()),options.allowPassengerWillCall=!!params.AllowPassengerWillCall&&eval(params.AllowPassengerWillCall.toLowerCase()),options.allowEquipment=!!params.AllowEquipment&&eval(params.AllowEquipment.toLowerCase()),options.isAdvancedReservation=!!params.AllowAdvancedReservation&&eval(params.AllowAdvancedReservation.toLowerCase()),options.allowMultipleSeatBooking=!!params.AllowMultipleSeatBooking&&eval(params.AllowMultipleSeatBooking.toLowerCase()),options.isWheelChair=!!params.HasWheelChair&&eval(params.HasWheelChair.toLowerCase()),options.isCompanion=!!params.HasCompanions&&eval(params.HasCompanions.toLowerCase()),options.companionsLimit=0==params.HasCompanions?0:params.CompanionsLimit?eval(params.CompanionsLimit):1,options.isPCA=!!params.HasPCA&&eval(params.HasPCA.toLowerCase()),options.isServiceAnimal=!!params.HasServiceAnimal&&eval(params.HasServiceAnimal.toLowerCase()),options.allowCustomLocation=!!params.AllowCustomLocation&&eval(params.AllowCustomLocation.toLowerCase()),options.promiseWindow=params.PromiseWindow?eval(params.PromiseWindow):10,options.reservationType=vm.reservationType,options.allowOnlySameDayAdvRes=!!params.AllowOnlySameDayAdvRes&&eval(params.AllowOnlySameDayAdvRes.toLowerCase()),options.dropoffHomeLocationOnly=!!params.DropoffHomeLocationOnly&&eval(params.DropoffHomeLocationOnly.toLowerCase()),options.homePassengerId=options.dropoffHomeLocationOnly?vm.currentPassenger.Id:null,options.checkFRBeforeDRT=!!params.CheckFRBeforeDRT&&eval(params.CheckFRBeforeDRT.toLowerCase()),options.noOfFRArrivals=params.NoOfFRArrivals?eval(params.NoOfFRArrivals):3,options.allowASAPReservations=!!params.AllowASAPReservations&&eval(params.AllowASAPReservations),options.allowAppointments=!!params.AllowAppointments&&eval(params.AllowAppointments),options.allowLocationNotes=!!params.AllowLocationNotes&&eval(params.AllowLocationNotes),options.allowReservationOnlyWhenGpsIsOn=!!params.AllowBookingIffGpsIsOn&&eval(params.AllowBookingIffGpsIsOn),options.maxRadiusToAllowBooking=!!params.MaxRadiusToAllowBooking&&eval(params.MaxRadiusToAllowBooking),options.allowFaring=!!params.AllowFaring&&eval(params.AllowFaring),options.sameDayResLowerBound=params.SameDayResLowerBound?params.SameDayResLowerBound:"00:00",options.sameDayResUpperBound=params.SameDayResUpperBound?params.SameDayResUpperBound:"24:00",options.futureResLowerBound=params.FutureResLowerBound?params.FutureResLowerBound:"00:00",options.futureResUpperBound=params.FutureResUpperBound?params.FutureResUpperBound:"24:00",options.allowChildren=!!params.AllowChildren&&eval(params.AllowChildren),options.childrenLimit=params.ChildrenLimit?eval(params.ChildrenLimit):3,vm.reservationFormOptions=options,options.dropoffHomeLocationOnly&&$timeout(getDestinationHomeLocation,0),options.isPassenger=!0,options.isReadOnly=!0,options.autoRefresh=!0,options.batchDays=params.BatchDays?eval(params.BatchDays):7,options.minFromDays=params.MinFromDays?eval(params.MinFromDays):30,options.passengerBookingMinDays=params.PassengerBookingMinDays?eval(params.PassengerBookingMinDays):0,options.passengerBookingMaxDays=params.PassengerBookingMaxDays?eval(params.PassengerBookingMaxDays):14,vm.reservationFormOptions=options}},function(o){UtilityFactory.toastError("Error",o.data.ReturnMessage)}),getMap()}function getMap(){uiGmapIsReady.promise().then(function(o){ScheduleService.getServiceAreaLocation(divisionId).then(function(o){1==o.data.status&&(vm.center.latitude=o.data.result.Latitude,vm.center.longitude=o.data.result.Longitude,void 0!==o.data.result.ZoomLevel&&null!==o.data.result.ZoomLevel&&""!=o.data.result.ZoomLevel&&(vm.zoom=o.data.result.ZoomLevel)),vm.showMap=!0}),GeoLocationService.getCurrentPosition().then(function(o){vm.position={coords:{Latitude:o.coords.latitude,Longitude:o.coords.longitude},icon:vm.myLocationIcon},LocationFactory.getLocations("","false",divisionId).then(function(o){var e=angular.copy(o.data),a=LocationFactory.findClosestLocation(vm.position.coords,e);a&&5280*parseFloat(a.distance)<=300&&$scope.$broadcast("closestLocation",a)},function(o){})},function(o){})})}function getDestinationHomeLocation(){ProfileService.GetHomeAddress(vm.currentPassenger.Id).then(function(o){if($scope.$broadcast("homeLocationDisable",!0),o){var e=((vm.reservationRequest.ToLocation=o).Name||"")+" "+(o.Address||"")+" "+(o.City||"")+" "+(o.Zip||"");$scope.$broadcast("homeLocation",o),$scope.$broadcast("homeLocationText",e),$timeout(function(){$scope.$broadcast("homeLocation",o),$scope.$broadcast("homeLocationText",e),$scope.$broadcast("homeLocationDisable",!0)},4e3)}else{if(DivisionService.getSystemParameters().DropoffHomeLocationEdit)$uibModal.open({animation:!0,backdrop:!1,templateUrl:"app/modules/shared/profile/home-address-modal.html",controller:function(){},size:""}).closed.then(function(){$state.reload()});else{var a="Please call Help desk at "+DivisionService.getSupportPhoneNumber()+" and ask them to create a Home Address for you.";MessageBox.info("Home Address is Required",a).then(function(){$window.history.back()})}}},function(o){console.log("Error getting home location"),console.log(o)})}function activate(o){authService.isLoggedIn()?null!=(divisionId=DivisionService.getDivisionId())&&null!=divisionId&&""!=divisionId?o&&"function"==typeof o&&o():$location.path("dashboard/"):(RedirectionService.save("/on-demand/reservations"),$location.path("login"))}vm.onReservationSuccess=function(o,e){(vm.addedTrip=o,e)?$location.path("on-demand/active-trip"):$uibModal.open({animation:!0,templateUrl:"app/modules/on-demand/reservations/displayTrip-modal.html",controller:"DisplayScheduledTripController as vm",size:"",resolve:{trip:function(){return o},options:function(){return vm.reservationFormOptions}}}).result.then(function(){})},vm.showMap=!1,vm.zoom=15,vm.center={latitude:39.80986,longitude:-98.555183},vm.myStyles=googleMapsConfig.mapStyles,vm.mapOptions={mapTypeControl:!1,zoomControl:!1,streetViewControl:!1,styles:vm.myStyles},vm.myLocationIcon={url:myLocationPin,size:new google.maps.Size(42,42),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(20,20)},vm.mapControl={},activate(populateDivisionParameters),vm.ionicInclude="app/modules/on-demand/reservations/reservations.html",vm.ionicCustomClassName="",vm.disableScroll=!0,vm.ionicHideNavBar=!1,vm.ionicUseRefresher=!1}angular.module("oneMVApp").controller("ReservationsController",["$location","$scope","$state","$timeout","$window","$uibModal","ConfigFactory","ScheduleService","uiGmapIsReady","DivisionService","MessageBox","UtilityFactory","authService","GeoLocationService","LocationFactory","RedirectionService","ProfileService","googleMapsConfig","PageService",reservationsController])}();
!function(){"use strict";function e(a,s,c,e,n,t,o){return{getCurrentUser:function(){var t=s.defer();return a({method:"GET",url:"../Operation/GetCurrentUser"}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},getPassdatall:function(){var t=s.defer(),e="../Passenger/getpassDataauto?rnd="+(new Date).getTime();return a({method:"GET",url:e}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},getpassenger:function(e){var t=s.defer(),r="../Passenger/GetPassDetailByPassId?rnd="+(new Date).getTime();return a({method:"GET",url:r,params:{PassengerId:e},dataType:"json",contentType:"application/json; charset=utf-8"}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},schedulepost:function(r){var n=s.defer();return c.getOneMVApiURLPromise().then(function(e){if(e&&""!=e){var t=e+"passenger/"+r.PassengerID+"/trip/schedule";a({method:"POST",url:t,data:JSON.stringify(r),ContentType:"application/json; charset=utf-8"}).then(function(e){n.resolve(e)},function(e){n.reject(e)})}else $log.error("Error: - Could not fetch service api url"),UtilityFactory.toastError("Could not fetch service api url")}),n.promise},cancelpost:function(r){var n=s.defer();return c.getOneMVApiURLPromise().then(function(e){if(e&&""!=e){var t=e+"passenger/"+r.PassengerID+"/trip/cancel";a({method:"POST",url:t,data:JSON.stringify(r),ContentType:"application/json; charset=utf-8"}).then(function(e){n.resolve(e)},function(e){n.reject(e)})}else $log.error("Error: - Could not fetch service api url"),UtilityFactory.toastError("Could not fetch service api url")}),n.promise},getlastripdetails:function(r){var n=s.defer();return c.getOneMVApiURLPromise().then(function(e){if(e&&""!=e){var t=e+"passenger/"+parseInt(r)+"/activeTrip?rnd="+(new Date).getTime();a({method:"GET",url:t,dataType:"json",ContentType:"application/json; charset=utf-8"}).then(function(e){o.$broadcast("hasActiveTripChanged",1==e.data.status),n.resolve(e)},function(e){n.reject(e)})}else $log.error("Error: - Could not fetch service api url"),UtilityFactory.toastError("Could not fetch service api url")}),n.promise},updateEmailPhoneandAddress:function(e){var t=s.defer();return a({method:"POST",url:"/Passenger/UpdateEmailPhoneandAddress",data:JSON.stringify(e),dataType:"json",contentType:"application/json; charset=utf-8"}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},getActiveRuns:function(r){var n=s.defer();return c.getOneMVApiURLPromise().then(function(e){if(e&&""!=e){var t=e+"Dispatch/GetRuns?rnd="+(new Date).getTime();a({method:"POST",url:t,data:JSON.stringify({DivisionId:r,ServiceDate:null}),dataType:"json",ContentType:"application/json; charset=utf-8"}).then(function(e){n.resolve(e)},function(e){n.reject(e)})}else $log.error("Error: - Could not fetch service api url"),UtilityFactory.toastError("Could not fetch service api url")}),n.promise},getServiceAreaLocation:function(r){var n=s.defer();return c.getOneMVApiURLPromise().then(function(e){if(e&&""!=e){var t=e+"division/"+r+"/serviceArea?rnd="+(new Date).getTime();a({method:"GET",url:t,dataType:"json",contentType:"application/json; charset=utf-8"}).then(function(e){n.resolve(e)},function(e){n.reject(e)})}}),n.promise},getDriverGPS:function(e){var t=s.defer(),r="../Passenger/GetDriverGPS?rnd="+(new Date).getTime();return a({method:"GET",url:r,params:{TripId:e},dataType:"json",contentType:"application/json; charset=utf-8"}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},getSearchPassanger:function(e){var t=s.defer();return a({method:"GET",url:"../Passenger/GetSearchPassanger?ClientPassangerID="+e,dataType:"json",contentType:"application/json; charset=utf-8"}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},getPastRuns:function(r,n){var o=s.defer();return c.getOneMVApiURLPromise().then(function(e){if(e&&""!=e){var t=e+"Dispatch/GetPastRuns?rnd="+(new Date).getTime();a({method:"POST",url:t,data:JSON.stringify({DivisionId:r,ServiceDate:n}),dataType:"json",ContentType:"application/json; charset=utf-8"}).then(function(e){o.resolve(e)},function(e){o.reject(e)})}else $log.error("Error: - Could not fetch service api url"),UtilityFactory.toastError("Could not fetch service api url")}),o.promise},savePastTrip:function(t){var r=s.defer();return c.getOneMVApiURLPromise().then(function(e){e&&""!=e?a({method:"POST",url:e+"Dispatch/InsertPastTrip",data:JSON.stringify(t),ContentType:"application/json; charset=utf-8"}).then(function(e){r.resolve(e)},function(e){r.reject(e)}):($log.error("Error: - Could not fetch service api url"),UtilityFactory.toastError("Could not fetch service api url"))}),r.promise},getPassengerTrips:function(e,r,n,o){var i=s.defer();return c.getOneMVApiURLPromise().then(function(e){if(e&&""!=e){var t=e+"passenger/"+r+"/trips/"+n+"/"+o+"?rnd="+(new Date).getTime();a({method:"GET",url:t,ContentType:"application/json; charset=utf-8"}).then(function(e){i.resolve(e)},function(e){i.reject(e)})}else $log.error("Error: - Could not fetch service api url"),UtilityFactory.toastError("Could not fetch service api url")}),i.promise},getServiceDateByDivision:function(r){var n=s.defer();return c.getOneMVApiURLPromise().then(function(e){if(e&&""!=e){var t=e+"division/"+r+"/serviceDate?rnd="+(new Date).getTime();a({method:"GET",url:t,ContentType:"application/json; charset=utf-8"}).then(function(e){n.resolve(e)},function(e){n.reject(e)})}else $log.error("Error: - Could not fetch service api url"),UtilityFactory.toastError("Could not fetch service api url")}),n.promise},getStates:function(){var t=s.defer();return a({method:"GET",url:"../Passenger/getStates?rnd="+(new Date).getTime()}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},searchPassenger:function(e,t){var r=s.defer();return c.getOneMVApiURLPromise().then(function(e){a({method:"GET",url:e+"passenger/search/"+t+"?rnd="+(new Date).getTime()}).then(function(e){r.resolve(e)},function(e){r.reject(e)})},function(e){r.reject(e)}),r.promise},tripsForServiceDate:function(e){var t=s.defer(),r=n.oneMVApiUrl+"passenger/"+e+"/tripsForServiceDate";return a({method:"GET",url:r+"?rnd="+(new Date).getTime()}).then(function(e){t.resolve(e)},function(e){t.reject(e)}),t.promise},getTripCancelStatusList:function(){var r=s.defer();return c.getOneMVApiURLPromise().then(function(e){if(e&&""!=e){var t=e+"passenger/getCancellationReasons?rnd="+(new Date).getTime();a({method:"GET",url:t,ContentType:"application/json; charset=utf-8"}).then(function(e){r.resolve(e)},function(e){r.reject(e)})}else $log.error("Error: - Could not fetch service api url"),UtilityFactory.toastError("Could not fetch service api url")}),r.promise}}}angular.module("oneMVApp").factory("ScheduleService",e),e.$inject=["$http","$q","ConfigFactory","authService","env","localStorageService","$rootScope"]}();
!function(){"use strict";function t(a,i,u){return{addApprovalLog:function(t,e,r){var o=i.defer(),n=u.oneMVApiUrl+"tripNegotiationLog/accept/"+t+"/"+e+"/"+r;return a({method:"PUT",url:n}).then(function(t){1==t.data.status?o.resolve(t.data.result):o.reject(t.data.result)}),o.promise},addRejectionLog:function(t,e){var r=i.defer(),o=u.oneMVApiUrl+"tripNegotiationLog/reject/"+t+"/"+e;return a({method:"PUT",url:o}).then(function(t){1==t.data.status?r.resolve(t.data.result):r.reject(t.data.result)}),r.promise}}}angular.module("oneMVApp").factory("TripNegotiationLogService",t),t.$inject=["$http","$q","env"]}();
!function(){"use strict";function DashboardController($scope,$stateParams,$location,$uibModal,$rootScope,$interval,DivisionService,ReservationService,ScheduleService,authService,UtilityFactory,ConfigFactory,env,PageService,OneMvServices){var vm=this;vm.userId="",vm.PageService=PageService,vm.PageService.setTitle("Dashboard"),vm.isUserLoggedIn=authService.isLoggedIn(),vm.passengerReservations=[],vm.todaysTrips=[],vm.allowedServices=[],vm.loadingServices=!1,vm.allowFaring=!1,vm.passengerId="";var autoRefresh=void 0;vm.currentYear=(new Date).getFullYear(),vm.showDrt=!1,vm.showCommuter=!1,vm.commuterInfo=OneMvServices.getCommuterInfo(),vm.drtInfo=OneMvServices.getDrtInfo();var options={};function populateDivisionParameters(callback){var divisionId=DivisionService.getDivisionId();ConfigFactory.getDivisionParameters(divisionId).then(function(params){params&&(options.promiseWindow=params.PromiseWindow?eval(params.PromiseWindow):10,options.showCancelOptions=!!params.CancelReasonRequired&&eval(params.CancelReasonRequired.toLowerCase()),options.allowLocationNotes=!!params.AllowLocationNotes&&eval(params.AllowLocationNotes.toLowerCase()),vm.allowFaring=!!params.AllowFaring&&eval(params.AllowFaring.toLowerCase()),options.allowChildren=!!params.AllowChildren&&eval(params.AllowChildren),options.allowMultipleSeatBooking=!!params.AllowMultipleSeatBooking&&eval(params.AllowMultipleSeatBooking.toLowerCase()),fetchTripsAndReservations(callback))},function(e){UtilityFactory.toastError("Error",e.data.ReturnMessage)})}vm.login=function(){$location.path("/login")},vm.menuClass=function(){return vm.allowedServices&&0<vm.allowedServices.length?"col-sm-"+12/vm.allowedServices.length:"col-sm-12"};var getPassengerTrips=function(a){ScheduleService.tripsForServiceDate(vm.passengerId).then(function(e){if(1==e.data.status&&null!=e.data.result){vm.todaysTrips=e.data.result;options.promiseWindow;vm.todaysTrips.sort(function(e,o){return new Date(e.schedPickupTime).getTime()-new Date(o.schedPickupTime).getTime()});for(var o=0;o<vm.todaysTrips.length;o++)if(vm.serviceDate=vm.todaysTrips[o].serviceDate,vm.todaysTrips[o].estimatedPickupTime){var i=new moment(vm.todaysTrips[o].startPickupWindowTime),t=new moment(vm.todaysTrips[o].endPickupWindowTime);vm.todaysTrips[o].promiseWindowStartTime=i.format("h:mm A"),vm.todaysTrips[o].promiseWindowEndTime=t.format("h:mm A")}}angular.isUndefined(a)||null==a||a()},function(e){})},getPassengerReservationsForToday=function(){ReservationService.getPassengerReservationsForToday(vm.passengerId).then(function(e){e&&e.data&&1==e.data.status&&e.data.result.reservations?vm.passengerReservations=e.data.result.reservations:vm.passengerReservations=[]},function(e){401!==e.status&&UtilityFactory.toastError("Error!","'Sorry! Could not load your Reservation!'")})};function setAutoRefresh(){authService.isLoggedIn()&&(autoRefresh=$interval(function(){fetchTripsAndReservations()},3e4))}var activate=function(){vm.loadingServices=!0;var e=aliasNotFoundInRoute()?DivisionService.getDivisionAlias():$stateParams.division;DivisionService.setDivision(e).then(handleSuccess,handleFailure)};function aliasNotFoundInRoute(){return angular.isUndefined($stateParams.division)||null===$stateParams.division||""===$stateParams.division.trim()}function handleSuccess(e){1==e.data.status?(vm.allowedServices=sort(e.data.result.DivisionServices),vm.showCommuter=!angular.isUndefined(vm.commuterInfo),vm.showDrt=!angular.isUndefined(vm.drtInfo),vm.isUserLoggedIn&&fetchUserDetails(),$rootScope.divisionName=e.data.result.DivisionName?e.data.result.DivisionName:"One Portal",$rootScope.supportPhoneNumber=e.data.result.SupportPhoneNumber?e.data.result.SupportPhoneNumber:"",vm.loadingServices=!1,vm.PageService.setHeadline($rootScope.divisionName)):$location.path("division")}function handleFailure(e){vm.loadingServices=!1,$location.path("division")}var sort=function(e){return e.sort(function(e,o){return parseInt(e.DisplayOrder)-parseInt(o.DisplayOrder)})},fetchUserDetails=function(){vm.userId=authService.authentication.userId,vm.passengerId=authService.authentication.passengerId,populateDivisionParameters(setAutoRefresh)};vm.showStopsMap=function(e){$uibModal.open({animation:!0,windowClass:"map-modal",templateUrl:"app/modules/commuter/modals/reservation-map-modal/reservation-map.html",controller:"ReservationMapController as vm",backdrop:"static",resolve:{reservation_stops:function(){return e}}}).result.then(function(e){},function(){})};var fetchTripsAndReservations=function(){vm.showCommuter&&getPassengerReservationsForToday(),vm.showDrt&&(getPassengerTrips(),ScheduleService.getlastripdetails(vm.passengerId))};$scope.$on("$destroy",function(e){stopAutoRefresh()});var stopAutoRefresh=function(){angular.isDefined(autoRefresh)&&($interval.cancel(autoRefresh),autoRefresh=void 0)};function cancelTrip(e){var o={tripId:e.TripId,passengerId:e.PassengerId,from:e.startName,to:e.endName,scheduledTime:e.schedPickupTime};$uibModal.open({animation:!0,templateUrl:"app/modules/on-demand/activeTrip/trip-cancellation-prompt.html",controller:"TripCancellationController as vm",size:"-fs",resolve:{tripToCancel:function(){return o},showCancelOptions:options.showCancelOptions}}).result.then(function(e){e.isCancel?(UtilityFactory.toastSuccess("Success!","Trip cancelled"),getPassengerTrips()):UtilityFactory.toastError("Error!","Unable to cancel the trip.")})}$scope.$on("divisionChanged",stopAutoRefresh),vm.navigate=function(e,o,i){"external"===o?$("body").hasClass("platform-cordova")?window.open(e,"_system",""):window.location=e:"internal"===o&&$location.path(e)},vm.showCommuterTrip=function(e){$uibModal.open({animation:!0,templateUrl:"app/modules/shared/trips/commuter-trip-modal.html",controller:"CommuterTripModalController as vm",size:"-fs",backdrop:"static",keyboard:!1,resolve:{tripId:e.id}}).result.then(function(e){(e.cancelled||e.isModified)&&getPassengerReservationsForToday()})},vm.showDrtTrip=function(o){var e={passengerTrip:o,options:options,serviceDate:vm.serviceDate};$uibModal.open({templateUrl:"app/modules/shared/trips/drt-trip-modal.html",controller:"TripDetailsModalController as vm",size:"-fs",resolve:{tripModalRequest:e}}).result.then(function(e){e&&"cancel"===e.action&&cancelTrip(o)})},activate(),env.ionic?(vm.appVersion=env.ionic.appVersion,vm.appVersion+=null==env.ionic.softwareVersion?"":" "+env.ionic.softwareVersion,vm.appVersion+=null==env.ionic.environment?"":"."+env.ionic.environment,vm.appVersion+=null==env.ionic.localEnvironment?"":"."+env.ionic.localEnvironment):vm.appVersion="",vm.refresh=function(e){activate(),$rootScope.$broadcast("scroll.refreshComplete")}}angular.module("oneMVApp").controller("DashboardController",DashboardController),DashboardController.$inject=["$scope","$stateParams","$location","$uibModal","$rootScope","$interval","DivisionService","ReservationService","ScheduleService","authService","UtilityFactory","ConfigFactory","env","PageService","OneMvServices"]}();
!function(){"use strict";function i(i,o,e,s,n,t,a,c,d){var v=this;v.divisions=[],v.selectedDivision="",v.isDivisionLoaded=!1,v.showDivisionDropdown=!0,v.states=[];var l={Alias:"--",DivisionName:"--"},r={Name:"--",Id:"--"};function D(i){if(null!=i.data.result&&0<i.data.result.length){if(v.divisions=i.data.result,v.divisions.splice(0,0,l),c.isIonic&&c.isIonicDevice)if("amazon"==c.ionic.divisionName)v.selectedDivision="amazon",v.setDivision();else{var s=[206];angular.forEach(v.divisions,function(i,o){if(-1!=s.indexOf(parseInt(i.DivisionID))){var e=v.divisions.indexOf(i);-1<e&&v.divisions.splice(e,1)}})}v.selectedDivision=v.divisions[0].Alias,v.isDivisionLoaded=!0}}function u(){c.isIonic&&c.isIonicDevice&&"amazon"==c.ionic.divisionName&&(v.selectedDivision="amazon",v.setDivision()),t.getCurrentPosition().then(function(i){var o=i.coords.latitude,e=i.coords.longitude;n.getDivisionsByLocation(o,e).then(D,function(i){v.isDivisionLoaded=!0,v.showDivisionDropdown=!1})}),a.GetStatesWithDivisions().then(function(i){v.states=i,v.states.splice(0,0,r),v.selectedState=v.states[0].Id},function(i){d.toastError("","Could not load states list. Please try again later.")})}v.setDivision=function(){if(v.selectedDivision!=l.Alias){var i=v.selectedDivision;s.path("dashboard/"+i)}},v.fetchDivisionsForSelectedState=function(){v.selectedState!=r.Id&&(v.divisions=[],v.divisions.splice(0,0,l),n.getDivisionByState(v.selectedState).then(D,function(i){v.isDivisionLoaded=!0,v.showDivisionDropdown=!1}))},u(),o.reloadPage=function(){i.location.reload()},c.isIonic?v.env=c.ionic.env:v.env="",v.refresh=function(i){u(),e.$broadcast("scroll.refreshComplete")}}angular.module("oneMVApp").controller("DivisionsController",i),i.$inject=["$window","$scope","$rootScope","$location","DivisionService","GeoLocationService","CommonService","env","UtilityFactory"]}();
!function(){"use strict";function e(e,i,a,o,t,c,n,s,r){var l=this;l.captchaPublicKey=a.captchaPublicKey,l.WidgetCreate=function(e){d=e},l.setCaptchaResponse=function(e){t.verifyCaptcha(e).then(function(e){e.success||c.reload(d)},function(e){})},l.verifyEmail=function(){o.SendPasscode(l.Email).then(function(e){e.data&&e.data.result&&(e.data.result.ChangeStatus?i.go("verify-update-password",{obj:{email:l.Email}}):(l.isClicked=!l.isClicked,r.showError(e.data.result.ChangeStatusDescription)))},function(e){l.isClicked=!l.isClicked,r.showError(e)})},l.cancel=function(){i.go("loginOneMV")};var u,d=-1;l.ionicInclude="app/shared/login/forgot-password.html",l.ionicCustomClassName="ionic-onemv-login",l.ionicHideNavBar=!1,l.ionicUseRefresher=!1,l.showRecaptcha=!a.isIonic,u=n.getDivisionId(),s.hasValue(u)||i.go("division")}angular.module("oneMVApp").controller("ForgotPasswordController",e),e.$inject=["$scope","$state","env","PasswordService","authService","vcRecaptchaService","DivisionService","PortalUtilityService","MessageService"]}();
!function(){"use strict";function LoginController($location,$scope,$rootScope,authService,env,MessageService,DivisionService,ConfigFactory,GeoLocationService,ServiceAreaService,$timeout,$window,PageService){var vm=this,division={},divisionSupportsFeed=!1;vm.message="",vm.providers=[],$scope.hideHeader="/login"===$location.path(),vm.isAmazonProvider=!1,vm.navigateToHome=function(){window.history.back()},vm.allowedToLoginOrRegister=!1,vm.loginOrRegisterMessage="",vm.hasGpsBeenChecked=!1,vm.PageService=PageService,vm.PageService.setTitle("Whats New"),vm.PageService.setHeadline("Latest Service Updates");var activate=function(){DivisionService.getDivisionInfo().then(onDivisionSuccess,onDivisionFailure)};function getSystemParams(){ConfigFactory.getDivisionParameters(division.DivisionID).then(function(params){if(params){divisionSupportsFeed=!params.DivisionSupportsFeed||eval(params.DivisionSupportsFeed.toLowerCase());var allowRegisterIffGpsIsOn=!!params.AllowRegisterIffGpsIsOn&&eval(params.AllowRegisterIffGpsIsOn);allowRegisterIffGpsIsOn?isGpsEnabled():(vm.allowedToLoginOrRegister=!0,vm.hasGpsBeenChecked=!0)}})}function isGpsEnabled(){GeoLocationService.getCurrentPosition().then(function(e){e?isInServiceArea(e):disableLogin("Your device is unable to determine your GPS location.")},function(e){disableLogin("GPS must be enabled to use this application.")})}function isInServiceArea(e){vm.hasGpsBeenChecked=!0,ServiceAreaService.isInServiceArea(division.DivisionID,e.coords.latitude,e.coords.longitude).then(function(e){e&&!e.data.result?disableLogin("You must be within the service area to login or register."):vm.allowedToLoginOrRegister=!0},function(e){disableLogin("We are unable to verify your GPS location. Please try again later.")})}function disableLogin(e){vm.hasGpsBeenChecked=!0,vm.allowedToLoginOrRegister=!1,vm.loginOrRegisterMessage=e,vm.redirectTimeout=$timeout(function(){$window.location.replace("#/")},1e4)}function onDivisionSuccess(e){if(1===e.data.status){division=e.data.result,vm.alias=division.Alias;for(var i=e.data.result.AllowedLogins.split(","),o=0;o<i.length;o++)vm.isAmazonProvider="amazon"==i[o].toLowerCase(),vm.providers.push({name:i[o]});getSystemParams()}}function onDivisionFailure(e){$location.path("dashboard/")}$scope.$on("$destroy",function(){vm.redirectTimeout&&$timeout.cancel(vm.redirectTimeout)}),activate(),vm.ionicUseExternalLink=null!=env.ionic&&"v9.6.52"==env.ionic.appVersion,vm.authExternalProvider=function(e){if("OneMV"!=e&&"One MV"!=e)if("Google"==e&&$("body").hasClass("platform-cordova"))$location.path("loginGoogleIonic");else{var i=location.protocol+"//"+location.host;($("body").hasClass("platform-ios")||$("body").hasClass("platform-android"))&&(i="http://localhost/callback/"),$("body").hasClass("platform-browser")&&(i+="/index.ionic.html#");var o=env.authServerUrl+"Account/ExternalLogin?provider="+e+"&response_type=token&client_id="+env.audience+"&redirect_uri="+i+"&divisionSupportsFeed="+divisionSupportsFeed+"&divisionId="+DivisionService.getDivisionId();if($("body").hasClass("platform-cordova")){var n=window.open(o,"_blank","location=no,toolbar=yes,clearcache=yes,clearsessioncache=yes,closebuttoncaption=Back to Passenger App,toolbar=yes,transitionstyle=coververtical");n.addEventListener("loadstart",function(e){if(0==e.url.indexOf("http://localhost/callback/#")||0==e.url.indexOf("file:///#/")){var i=e.url.substring(e.url.indexOf("#"),e.url.length);n.close(),window.location=i}}),n.addEventListener("loaderror",function(e){console.log("loaderror:"+JSON.stringify(e))})}else window.location=o}else $location.path("loginOneMV")},vm.ionicInclude="app/shared/login/login.html",vm.ionicCustomClassName="ionic-login-class",vm.ionicHideNavBar=!0,vm.ionicUseRefresher=!1}angular.module("oneMVApp").controller("LoginController",LoginController),LoginController.$inject=["$location","$scope","$rootScope","authService","env","MessageService","DivisionService","ConfigFactory","GeoLocationService","ServiceAreaService","$timeout","$window","PageService"]}();
!function(){"use strict";function e(i,e,o,n,a,r,s,c){var t=this;t.login=function(){var e={UserName:t.username,Password:t.password,DivisionId:t.divisionId,Provider:"MvLogin"};n.loginOneMV(e).then(function(e){o.$broadcast("loggedIn",null),i.path("dashboard/")},function(e){t.isClicked=!t.isClicked,e&&r.showError(e.Message)})},t.cancel=function(){i.path("dashboard/")},t.divisionId=s.getDivisionId(),t.PageService=c,t.PageService.setTitle("Login"),t.PageService.setHeadline("With your ONEMV account"),t.ionicInclude="app/shared/login/onemv-login.html",t.ionicCustomClassName="ionic-onemv-login",t.ionicHideNavBar=!1,t.ionicUseRefresher=!1}angular.module("oneMVApp").controller("OneMVLoginController",e),e.$inject=["$location","$scope","$rootScope","authService","env","MessageService","DivisionService","PageService"]}();
!function(){"use strict";function e(e,i,a,s,o,r,t,n){var c=this;c.submit=function(){if(c.newPassword!=c.repeatNewPassword)return t.showError("New and Repeat Passwords don't match."),void(c.isClicked=!c.isClicked);var e={TemporaryCode:c.temporaryCode,Email:c.email,NewPassword:c.newPassword};r.VerifyAndUpdatePassword(e).then(function(e){e.data&&e.data.result&&e.data.result?e.data.result.ChangeStatus?i.go("loginOneMV"):(c.isClicked=!c.isClicked,t.showError(e.data.result.ChangeStatusDescription)):(t.showError("Could not update password"),c.isClicked=!c.isClicked)},function(e){t.showError(e),c.isClicked=!c.isClicked})},c.captchaPublicKey=o.captchaPublicKey,c.WidgetCreate=function(e){l=e},c.setCaptchaResponse=function(e){n.verifyCaptcha(e).then(function(e){e.success||vcRecaptchaService.reload(l)},function(e){})},c.email=a.obj?a.obj.email:"";var d=s.search();d&&(d.email&&(c.email=d.email),d.division&&(c.division=d.division));var l=-1;c.ionicInclude="app/shared/login/verify-update-password.html",c.ionicCustomClassName="ionic-onemv-login",c.ionicHideNavBar=!1,c.ionicUseRefresher=!1,c.showRecaptcha=!o.isIonic}angular.module("oneMVApp").controller("VerifyUpdatePasswordController",e),e.$inject=["$scope","$state","$stateParams","$location","env","PasswordService","MessageService","authService"]}();
!function(){"use strict";function o(o,t,n){n.logOut().then(function(){t.$broadcast("loggedout",null),o.path("dashboard/")},function(){console.log("Unable to sign-out user.")})}angular.module("oneMVApp").controller("LogoutController",o),o.$inject=["$location","$rootScope","authService"]}();
!function(){"use strict";function e(e,r,o,i,n){var t=this;t.PageService=i;var s="This version is no longer supported. Please download the latest version from app store";function a(e){if(1===e.data.status){var r=e.data.result;t.ErrorMessage=r.MinAppError}}function p(){t.ErrorMessage=s}t.PageService.setTitle("App Error"),t.PageService.setHeadline("This version is no longer supported"),n.getDivisionId()?n.getDivisionInfo().then(a,p):p()}angular.module("oneMVApp").controller("MinAppSupportController",e),e.$inject=["$rootScope","$location","DynamicContentService","PageService","DivisionService"]}();
!function(){function e(t,a,r,s,o,e,i,n,l,c){t.title="MOBI",t.hasActiveTrip=!1;var u=void 0,d=!1,f=!1;t.parentState=void 0;var v=l.getAllowedServices(),m=[{name:"commuter",service:"commuter",url:"commuter/home-commuter",order:6,class:"link--commuter",level:1,isServiceMenu:!0,subPages:[{name:"Advanced Reservations",url:"commuter/adv-schedule-setup",service:"commuter",showOffline:!1,order:7},{name:"Bus Stops",url:"commuter/all-stops",service:"commuter",order:8},{name:"Published Schedule",url:"commuter/published-schedule",service:"commuter",order:9}]},{name:"drt",isServiceMenu:!0,order:10,url:"on-demand/reservations",service:"drt",class:"link--demand",showOffline:!1,level:1,subPages:[{name:"Active Trip",url:"on-demand/active-trip",service:"drt",showOffline:!1,showActive:!1,order:11}]},{name:"fixed",isServiceMenu:!0,url:"fixed-route/landing",service:"fixed",class:"link--fixed",order:12,level:1,subPages:[{name:"Routes",url:"fixed-route/allRoutes",service:"fixed",order:13},{name:"Stops",url:"fixed-route/stops",service:"fixed",order:14},{name:"Schedule",url:"fixed-route/schedule",service:"fixed",order:15},{name:"Published Schedule",url:"http://thebus.mobi/content/documents/amz-published-schedule.pdf",service:"fixed",isExternal:!0,order:16}]},{name:"My Trips",url:"passenger-trips",service:"drt,commuter",class:"link--trips",order:17,showOffline:!1,level:1},{name:"User Profile",id:"menuProfile",url:"shared/profile",service:"commuter,fr,drt",showOffline:!1,isProfileMenu:!0,order:20,level:2},{name:"Change Password",id:"changePassword",url:"change-password",service:"commuter,fr,drt",showOffline:!1,isOneMV:!0,order:21,level:2},{name:"Manage Vehicles",url:"commuter/my-vehicles",service:"commuter",showOffline:!1,order:22,level:2},{name:"What's New",url:"news",service:"commuter,fr,drt",order:23,level:2},{name:"Policies",url:"commuter/policy",service:"commuter",order:24,level:2},{name:"Support",url:"support",service:"commuter",order:25,level:2},{name:"Notifications",url:"notifications",service:"commuter,fr,drt",order:26,level:2},{name:"Settings",url:"settings",service:"commuter,drt,fr",showOffline:!1,order:27,level:2},{name:"Sign in",url:"login",service:"commuter,drt",order:28,showOffline:!0,level:2},{name:"Sign out",url:"logout",service:"commuter,drt",order:29,showOffline:!1,level:2}];function p(e){var n=angular.isUndefined(e.showOffline)||!e.showOffline;n&&e.isProfileMenu&&(n=l.getSystemParameters().DropoffHomeLocationOnly);return n&&e.isOneMV&&(n="MvLogin"===i.authentication.loginProvider),n}function g(e){return angular.isUndefined(e.showOffline)||e.showOffline}function h(e){if(v){for(var n=e.service.split(","),r=0;r<n.length;r++)for(var o=0;o<v.length;o++)if(v[o].name.toLowerCase()==n[r].toLowerCase())return!0;return!1}return!1}function w(e,n){return e.order>n.order}function b(e){return Object.assign({},e)}function S(){for(var e=i.isLoggedIn()?p:g,n=h,r=m.map(b).filter(n).filter(e).sort(w),o=0;o<r.length;o++)r[o].subPages&&(r[o].subPages=r[o].subPages.map(b).filter(n).filter(e).sort(w));t.pages=function e(n){if(!n)return;var r=[];for(var o=0;o<n.length;o++){var i={alias:O(n[o]),name:n[o].name,order:n[o].order,service:n[o].service,showAsModal:n[o].showAsModal,class:n[o].class,showActive:n[o].showActive,level:n[o].level};n[o].url&&(i.url=n[o].url),n[o].subPages&&(i.subPages=e(n[o].subPages)),i.isExternal=n[o].isExternal,r.push(i)}return r}(r)}function O(e){if(!e.isServiceMenu)return e.name;for(var n=0;n<v.length;n++)if(e.service.toLowerCase().includes(v[n].name.toLowerCase()))return v[n].alias}function P(e){e:for(var n in t.pages)if("drt"==t.pages[n].name)for(var r in t.pages[n].subPages)if("Active Trip"==t.pages[n].subPages[r].name){t.pages[n].subPages[r].showActive=e;break e}}function M(){t.pages=[],v=l.getAllowedServices(),S(),angular.isUndefined(u)&&!r.navAutoRefreshIsRunning&&(u=e(function(){var e;e=i.authentication.passengerId,!angular.isUndefined(c.getDrtInfo())&&i.isLoggedIn()&&n.getlastripdetails(e,"").then(function(e){if(1===e.data.status&&e.data.result?P(!0):P(!1),1==e.data.status){var n=e.data.result;d||null==n.TripID||null==n.PickUpGeofenceTime||null!=n.StartTime||null!=n.OriginDepartTime?f||null==n.TripID||null==n.StartTime||null!=n.OriginDepartTime||(d&&(d=!1,t.close()),event.preventDefault(),t.modelinstance=s.open({template:'<div class="modal-header" ><h3 class="modal-title">Info</h3> </div><div class="modal-body"><p>Your vehicle has just arrived</p></div><div class="modal-footer"><button class="btn btn-warning" type="button" ng-click="close()">OK</button> </div>',scope:t,replace:!0,backdrop:"static",keyboard:!1}),f=!0,A()):(event.preventDefault(),t.modelinstance=s.open({template:'<div class="modal__header" ><h4 class="modal-title">Info</h4> </div><div class="modal__-body"><p>Your vehicle will be arriving soon</p></div><div class="modal__footer"><button class="btn btn-warning" type="button" ng-click="close()">OK</button> </div>',scope:t,replace:!0,backdrop:"static",keyboard:!1}),d=!0)}},function(e){console.log("CheckVehicleStatusForTrip",e)})},15e3),r.navAutoRefreshIsRunning=!angular.isUndefined(u))}function A(){angular.isDefined(u)&&(e.cancel(u),u=void 0,r.navAutoRefreshIsRunning=!1)}t.pagelink=function(e,n,r,o,i){null!=n&&t.ionicToggleMenu(),r?s.open({animation:!0,templateUrl:"app/shared/notification/notification.html",controller:"NotificationController as vm",size:""}):!angular.isUndefined(i)&&i?window.open(e,"_system",""):e?a.path(e):a.path("#")},t.isActive=function(e){return o=e,-1<a.path().indexOf("commuter")&&"commuter"===o||"My Trips"==e&&"/passenger-trips"==a.path()||(r=e,-1<a.path().indexOf("on-demand")&&"drt"===r)||(n=e,-1<a.path().indexOf("fixed-route")&&"fixed"===n);var n,r,o},t.closeDropDown=function(){t.isopen=!1},t.goBack=function(e){angular.element("#page-wrapper").addClass("back"),o(function(){angular.element("#page-wrapper").removeClass("back")},1e3),window.history.back()},t.close=function(){t.modelinstance.close(),d=f=!1},t.$on("$destroy",function(e){A()}),t.$on("loggedIn",function(){M()}),t.$on("loggedout",function(){M(),A()}),t.$on("divisionChanged",function(){M()}),t.$on("hasActiveTripChanged",function(e,n){t.hasActiveTrip!=n&&(P(t.hasActiveTrip=n),M())}),M(),t.toggleGroupIonic=function(e,n){t.isGroupShownIonic(e)?n&&(t.shownGroupIonic=null):t.shownGroupIonic=e},t.wipeLocalStorageInfo=function(){console.log("go 1"),r.$broadcast("ionicShowSplashScreen"),t.ionicToggleMenu();var e=window.localStorage.ionicCHCPOn?window.localStorage.ionicCHCPOn:"true",n=window.localStorage.env?window.localStorage.env:"-dev";window.localStorage.clear(),window.localStorage.ionicCHCPOn=e,window.localStorage.env=n,window.location.replace("#/nav/division"),o(function(){window.location.reload(!0)},500)},t.isGroupShownIonic=function(e){return t.shownGroupIonic===e},t.ionicToggleMenu=function(){r.$broadcast("ionicToggleLeftMenu")}}angular.module("oneMVApp").controller("nav",e),e.$inject=["$scope","$location","$rootScope","$uibModal","$timeout","$interval","authService","ScheduleService","DivisionService","OneMvServices"]}();
!function(){"use strict";function i(o,i,t,n,e){var a=this;function r(){a.isCommuterNotificationLoading=!0,i.getCommuterNotifications().then(function(i){a.CommuterNotifications=i.data.result,a.isCommuterNotificationLoading=!1},function(i){a.isCommuterNotificationLoading=!1})}a.title="Notifications",a.PageService=t,a.PageService.setTitle("Notifications"),a.PageService.setHeadline("Service updates"),a.commuterAlerts=[],a.frNotifications=[],a.isFrNotificationLoading=!0,a.isCommuterAlertLoading=!1,a.isCommuterNotificationLoading=!1,a.isDRTNotificationLoading=!1,a.hasCommuter=!1,a.hasFixedRoute=!1,a.hasDRT=!1,a.commuterInfo=e.getCommuterInfo(),a.fixedRouteInfo=e.getFixedRouteInfo(),a.drtInfo=e.getDrtInfo(),a.cancel=function(){},function(){a.isloggedIn=n.isLoggedIn(),angular.isUndefined(a.commuterInfo)||(a.hasCommuter=!0,r());angular.isUndefined(a.fixedRouteInfo)||(a.hasFixedRoute=!0,a.isFrNotificationLoading=!0,i.getFixedRouteNotification().then(function(i){a.frNotifications=i.data.notifications,angular.forEach(a.frNotifications,function(i){i.Title=i.linkTitle,i.Message=i.text}),a.isFrNotificationLoading=!1},function(i){a.isFrNotificationLoading=!1}));angular.isUndefined(a.drtInfo)||(a.hasDRT=!0,a.isDRTNotificationLoading=!0,i.getDRTNotifications().then(function(i){a.DRTNotifications=i.data.result,a.isDRTNotificationLoading=!1},function(i){a.isDRTNotificationLoading=!1}))}(),a.showTripInfo=function(i){t=i.LinkedId,o.open({animation:!0,templateUrl:"app/shared/trips/commuter-trip-modal.html",controller:"CommuterTripModalController as vm",size:"-fs",backdrop:"static",keyboard:!1,resolve:{tripId:t}}).result.then(function(i){(i.cancelled||i.isModified)&&r()});var t}}angular.module("oneMVApp").controller("NotificationController",i),i.$inject=["$uibModal","NotificationService","PageService","authService","OneMvServices"]}();
!function(){"use strict";angular.module("oneMVApp").directive("notificationItem",function(){return{restrict:"E",scope:{data:"="},templateUrl:"app/modules/shared/notification/notification-item.component.html"}})}();
!function(){"use strict";function e(n,o,r,c,s){return{getServiceAlerts:function(){var i=o.defer(),e=c.isLoggedIn()?"/serviceAlertsForUser/"+c.authentication.userId:"/serviceAlerts",t=r.commuterApiUrl+"common/"+s.getDivisionId()+e+"?rnd="+Date.parse(new Date);return n({method:"GET",url:t}).then(function(e){i.resolve(e)},function(e){i.reject(e)}),i.promise},getFixedRouteNotification:function(){var i=o.defer();return n({method:"GET",url:r.oneMVFixedRouteApiUrl+"notifications/"+s.getDivisionId()}).then(function(e){i.resolve(e)},function(e){i.reject()}),i.promise},getCommuterNotifications:function(){var i=o.defer(),e=c.isLoggedIn()?c.authentication.passengerId:0,t=0==e?r.oneMVApiUrl+"notifications/commuter/"+s.getDivisionId():r.oneMVApiUrl+"notifications/commuter/"+s.getDivisionId()+"/"+e;return n({method:"GET",url:t}).then(function(e){i.resolve(e)},function(e){i.reject()}),i.promise},getDRTNotifications:function(){var i=o.defer();if(c.isLoggedIn()){var e=c.authentication.passengerId,t=r.oneMVApiUrl+"notifications/DRT/"+s.getDivisionId()+"/"+e;n({method:"GET",url:t}).then(function(e){i.resolve(e)},function(e){i.reject()})}else i.reject();return i.promise}}}angular.module("oneMVApp").factory("NotificationService",e),e.$inject=["$http","$q","env","authService","DivisionService"]}();
!function(){"use strict";function e(e,s,o,l){var a=this;a.messageType=l,a.messageTitle=s,a.messageBody=o,console.log("modal",a),a.close=function(){e.close({result:"ok"})}}angular.module("oneMVApp").controller("DisplayPushMessageController",e),e.$inject=["$uibModalInstance","messageTitle","messageBody","messageType"]}();
!function(){"use strict";function e(e,s,a,i,o,r,n){var d=this;d.changePassword=function(){if(d.newPassword!==d.newPasswordRetype)return i.showError("New Password and Retype Password do not match"),void(d.isClicked=!d.isClicked);var e={UserName:d.username,OldPassword:d.oldPassword,NewPassword:d.newPassword,DivisionId:d.divisionId,PassengerId:s.authentication.passengerId,Provider:"MvLogin"};n.ChangePassword(e).then(function(e){d.isClicked=!d.isClicked,e.data&&e.data.result&&(e.data.result.ChangeStatus?(i.showSuccess("Password Changed successfully"),d.oldPassword="",d.newPassword="",d.newPasswordRetype=""):i.showError(e.data.result.ChangeStatusDescription))},function(e){d.isClicked=!d.isClicked,e&&i.showError(e.Message)})},d.cancel=function(){e.path("dashboard/")},d.divisionId=o.getDivisionId(),d.PageService=r,d.PageService.setTitle("Change Password"),d.PageService.setHeadline("Update your password"),d.ionicInclude="app/shared/profile/change-password.html",d.ionicCustomClassName="ionic-onemv-login",d.ionicHideNavBar=!1,d.ionicUseRefresher=!1}angular.module("oneMVApp").controller("ChangePasswordController",e),e.$inject=["$location","authService","env","MessageService","DivisionService","PageService","PasswordService"]}();
!function(){"use strict";function e(d,s,t,a,r,i,l,e){return{controller:function(n,o){function c(){l.toastError("Find Home Address","Home location not found. Please change address and try again.")}n.hasModalParent=void 0!==o.getTop(),n.loading=!0,n.invalid=!0,n.hasHomeAddress=!1,n.isContainerManagingData=void 0!==n.HomeAddress,n.HomeAddress=null==n.HomeAddress?{}:n.HomeAddress,n.HomeAddressSearch={},n.googleLocations=[],n.states=[],n.countries=[{name:"United States",code:"USA"}],n.divisionId=s.getDivisionId(),n.passengerId=a.authentication.passengerId,n.submitted=!1,n.AddEdit=!0,n.zipcode="",n.stateabbr="",n.isValidZip=!1,n.allowEditHomeAddress=!1,n.showHomeAddress=!1,n.dataServiceTo=t.dataServiceTo,i.GetAllStates().then(function(e){n.states=e},function(e){l.toastError("","Could not load states list. Please try again later.")}),n.Cancel=function(){o.dismissAll(),d.history.back()},n.SelectedHomeAddress=function(s){var e=n.HomeAddressSearch.Suite;n.HomeAddressSearch=angular.copy(s),n.HomeAddressSearch.Suite=e,n.HomeAddressSearch.StateId=n.states.filter(function(e){return e.Abbr==s.State})[0].Id,n.HomeAddress=angular.copy(n.HomeAddressSearch),n.HomeAddressGooglePlaceId=s.GooglePlaceId,n.invalid=!1},n.GoogleSearch=function(){n.invalid=!0,n.googleLocations=[],l.toastInfo("Home Address - Search","Searching for matching addresses. Please wait.");var e=n.states.filter(function(e){return e.Id==n.HomeAddressSearch.StateId})[0],s=(n.HomeAddressSearch.Address||"")+", "+(n.HomeAddressSearch.City||"")+", "+(e&&e.Abbr||"")+", "+(n.HomeAddressSearch.Zip||"");t.getLocations(s,!0,n.divisionId,n.passengerId,!0).then(function(e){for(var s=0;s<e.data.length;s++){var o=e.data[s].loc,d={},t="",a="";for(var r in o.address_components){var i=o.address_components[r];if("street_number"==i.types[0])t=i.short_name;else if("route"==i.types[0])a=i.short_name;else if("locality"==i.types[0])d.City=i.short_name;else if("administrative_area_level_1"==i.types[0])d.State=i.short_name;else if("postal_code"==i.types[0])d.Zip=i.short_name;else;}d.Address=t+" "+a,d.Name=o.formatted_address,d.Latitude=o.geometry.location.lat,d.Longitude=o.geometry.location.lng,d.GooglePlaceId=o.place_id,n.googleLocations.push(d)}0==n.googleLocations.length?c():n.hasHomeAddress=!0},function(e){c()})},n.UpdateHomeAddress=function(){r.UpdateHomeAddress(n.passengerId,n.HomeAddress).then(function(e){var s=e.data.result;1==e.data.status?(n.submitted=!0,l.toastSuccess("Success",s),setTimeout(function(){n.hasModalParent?o.dismissAll():d.history.back()},0)):l.toastError("Error",s)},function(e){var s=e.data.Result;l.toastError("Error",s)})};var e=function(){n.showHomeAddress=r.ShowHomeAddress(),n.showHomeAddress&&(n.allowEditHomeAddress=r.AllowEditHomeAddress()),n.isContainerManagingData||r.GetHomeAddress(n.passengerId).then(function(e){n.HomeAddress=null==e?{}:e,n.invalid=!1},function(e){n.error=e.error_description})};n.isUpdatingSuite=!1,n.$watch("HomeAddressSearch.Suite",function(){n.isUpdatingSuite=!0,n.HomeAddress.Suite=n.HomeAddressSearch.Suite},!0),n.$watch("HomeAddress",function(e,s){1==n.isUpdatingSuite&&(n.isUpdatingSuite=!1),n.hasHomeAddress=!1,n.HomeAddressSearch={},n.HomeAddress&&(n.hasHomeAddress=n.HomeAddress.GooglePlaceId,n.HomeAddressSearch=angular.copy(n.HomeAddress),n.HomeAddress&&n.HomeAddress.GooglePlaceId&&(n.googleLocations=[],n.HomeAddress&&n.HomeAddress.GooglePlaceId&&""!=n.HomeAddress.GooglePlaceId&&(n.googleLocations.push(n.HomeAddress),n.invalid=!1),n.loading=!1))},!0),$("body").hasClass("is-ionic")?$(document).ready(function(){e()}):this.$onInit=e},replace:!0,restrict:"E",scope:{HomeAddress:"=?data",invalid:"=?invalid"},templateUrl:"app/modules/shared/profile/homeAddress.html"}}angular.module("oneMVApp").directive("homeAddressDirective",e),e.$inject=["$window","DivisionService","LocationFactory","authService","ProfileService","CommonService","UtilityFactory","$uibModalStack"]}();
!function(){"use strict";function e(e,i,o,r,s,t,n,a,c,d,l,u,f,p){var v=this;v.PageService=p,v.PageService.setTitle("Profile"),v.PageService.setHeadline("Latest Service Updates"),v.loading=!0,v.invalid=!0,v.passenger={},v.passenger.HomeAddress={},v.passengerId=n.authentication.passengerId,v.divisionId=s.getDivisionId(),v.submitted=!1,v.Cancel=function(){r.history.back()},v.UpdateProfile=function(){a.UpdateProfile(v.passenger).then(function(e){var i=e.data.result;1==e.data.status?(v.submitted=!0,d.toastSuccess("Success",i),setTimeout(function(){r.history.back()},0)):d.toastError("Error",i)},function(e){var i=e.data.Result;d.toastError("Error",i)})};var g=function(){n.isLoggedIn()?(v.showHomeAddress=a.ShowHomeAddress(),v.showHomeAddress&&(v.allowEditHomeAddress=a.AllowEditHomeAddress()),a.GetProfile(v.passengerId).then(function(e){v.passenger=e,v.loading=!1},function(e){v.error=e.error_description,v.loading=!1})):(f.save("/shared/profile"),o.path("login"))};$("body").hasClass("is-ionic")?$(document).ready(function(){g()}):v.$onInit=g,v.ionicInclude="app/shared/profile/profile.html",v.ionicCustomClassName="ionic-profile card",v.ionicHideNavBar=!1,v.ionicUseRefresher=!1}angular.module("oneMVApp").controller("ProfileController",e),e.$inject=["$scope","$rootScope","$location","$window","DivisionService","LocationFactory","authService","ProfileService","CommonService","UtilityFactory","LocationService","MessageService","RedirectionService","PageService"]}();
!function(){"use strict";function t(e,i,n,s,t){var o=this;function a(){r()}function r(){o.isSettingsLoading=!0,o.isSettingsLoaded=!1,i.getSettings(n.authentication.passengerId).then(function(t){t&&10<t.length&&(t=t.substring(t.length-10)),o.clientTelephone=t,o.isSettingsLoading=!1,o.isSettingsLoaded=!0},function(t){o.isSettingsLoading=!1})}o.isSettingsLoading=!1,o.isSettingsLoaded=!1,o.isSettingsUpdating=!1,o.settings=null,o.updateSettings=function(){o.isSettingsUpdating=!0;var t=o.clientTelephone;if(""!=t&&!isNaN(t)&&0<t){t="+1"+t;var e={PassengerId:n.authentication.passengerId,ClientTelephone:t};i.updateSettings(e).then(function(t){t?s.toastSuccess("Success","Settings updates sucessfully"):s.toastError("Error","Could not update settings"),o.isSettingsUpdating=!1,r()},function(t){s.toastError("Error","Could not update settings"),o.isSettingsUpdating=!1,r()})}else s.toastError("Error","Please enter a valid number"),o.isSettingsUpdating=!1},o.PageService=t,o.PageService.setTitle("Settings"),o.PageService.setHeadline("Manage App Settings"),a(),o.ionicInclude="app/shared/settings/settings.html",o.ionicCustomClassName="ionic-settings",o.ionicHideNavBar=!1,o.ionicUseRefresher=!0,o.ionicPullingText="Refresh Settings",o.ionicRefreshingText="Loading Settings",o.ionicSpinner="spiral",o.refresh=function(t){a(),e.$broadcast("scroll.refreshComplete")}}angular.module("oneMVApp").controller("SettingsController",t),t.$inject=["$rootScope","SettingsService","authService","UtilityFactory","PageService"]}();
!function(){"use strict";function t(r,a,s){return{getSettings:function(t){var e=a.defer(),n=s.oneMVApiUrl+"passenger/"+t+"/settings?rnd="+Date.parse(new Date);return r.get(n).then(function(t){t&&t.data&&1==t.data.status?e.resolve(t.data.result):e.reject(t.data.errors)},function(t){e.reject(t)}),e.promise},updateSettings:function(t){var e=a.defer(),n=s.oneMVApiUrl+"passenger/settings";return r.post(n,t).then(function(t){t&&t.data&&1==t.data.status?e.resolve(t.data.result):e.reject(t.data.errors)},function(t){e.reject(t)}),e.promise}}}angular.module("oneMVApp").factory("SettingsService",t),t.$inject=["$http","$q","env"]}();
!function(){"use strict";function e(e,t,o,n){var i=this;i.PageService=n,i.PageService.setTitle("Support"),i.PageService.setHeadline("FAQ"),o.getSupportFAQ().then(function(e){1==e.data.status&&(i.data=e.data.result.FAQContent)},function(e){console.log("something is wrong")})}angular.module("oneMVApp").controller("SupportController",e),e.$inject=["$rootScope","$location","DynamicContentService","PageService"]}();
!function(){"use strict";function ExternalRegistrationController($location,$timeout,$rootScope,vcRecaptchaService,authService,VerificationService,env,DivisionService,ConfigFactory,RedirectionService,PageService){var vm=this,widgetId=-1;vm.captchaPublicKey=env.captchaPublicKey,vm.WidgetCreate=widgetCreate,vm.setCaptchaResponse=setCaptchaResponse,vm.isClicked=!1,vm.savedSuccessfully=!1,vm.organisationIdLabel="",vm.showOrganisationId=!1,vm.showAllowSms=!1,vm.showFirstName=!1,vm.showLastName=!1,vm.showClientTelephone=!1,vm.allowSms=!1,vm.telNum="",vm.clientPassengerId="",vm.PageService=PageService,vm.PageService.setTitle("New Account"),vm.PageService.setHeadline("Create a ONEMV Login");var feedType="",registrationFailedMsg="Failed to register. Please try again later.";function setCaptchaResponse(e){authService.verifyCaptcha(e).then(function(e){e.success||vcRecaptchaService.reload(widgetId)},function(e){})}function widgetCreate(e){widgetId=e}var activate=function(){var divisionId=DivisionService.getDivisionId();DivisionService.getDivisionInfo().then(function(e){feedType=e.data.result.DivisionFeedType.FeedType}),vm.registerData={userName:authService.externalAuthData.userName,provider:authService.externalAuthData.provider,externalAccessToken:authService.externalAuthData.externalAccessToken,divisionId:divisionId,firstName:authService.externalAuthData.firstName,lastName:authService.externalAuthData.lastName},vm.firstName=vm.registerData.firstName,vm.lastName=vm.registerData.lastName,vm.provider=vm.registerData.provider,vm.PageService.setHeadline(vm.provider+" Sign Up"),ConfigFactory.getDivisionParameters(divisionId).then(function(params){params&&(vm.organisationIdLabel=params.OrganisationIdLabel?params.OrganisationIdLabel:"Client Passenger Id",vm.showOrganisationId=!!params.ShowOrganisationId&&eval(params.ShowOrganisationId.toLowerCase()),vm.showAllowSms=!!params.ShowAllowSms&&eval(params.ShowAllowSms.toLowerCase()),vm.showFirstName=!!params.ShowFirstName&&eval(params.ShowFirstName.toLowerCase()),vm.showLastName=!params.ShowLastName||eval(params.ShowLastName.toLowerCase()),vm.showClientTelephone=!!params.ShowClientTelephone&&eval(params.ShowClientTelephone.toLowerCase()))})};function register(e){var a=vm.telNum;a&&""!=a&&(a="+1"+a),vm.registerData.telephoneNumber=a,vm.registerData.allowSms=vm.allowSms,vm.registerData.divisionSupportsFeed=e,vm.registerData.clientPassengerId=vm.clientPassengerId,vm.registerData.firstName=vm.firstName,vm.registerData.lastName=vm.lastName,authService.registerExternal(vm.registerData).then(function(e){vm.savedSuccessfully=!0,startTimer()},function(e){vm.message=e.Message,vm.isClicked=!1,vcRecaptchaService.reload(widgetId)})}activate(),vm.cancel=function(){RedirectionService.redirectTo("dashboard/")},vm.registerExternal=function(){vm.message="",vm.isClicked=!0,VerificationService.passengerExists(vm.clientPassengerId).then(function(e){return 1!=e.data.status?(vm.message=registrationFailedMsg,void(vm.isClicked=!1)):"FeedOnly"!=feedType||e.data.result?void register(e.data.result):(vm.message="Passenger not found.",void(vm.isClicked=!1))})};var startTimer=function(){var e=$timeout(function(){$timeout.cancel(e),$rootScope.$broadcast("loggedIn",null),RedirectionService.redirect()},2e3)};vm.ionicInclude="app/shared/registration/external-registration.html",vm.ionicCustomClassName="ionic-template-external-registration",vm.ionicHideNavBar=!1,vm.ionicUseRefresher=!1,vm.showRecaptcha=!env.isIonic}angular.module("oneMVApp").controller("ExternalRegistrationController",ExternalRegistrationController),ExternalRegistrationController.$inject=["$location","$timeout","$rootScope","vcRecaptchaService","authService","VerificationService","env","DivisionService","ConfigFactory","RedirectionService","PageService"]}();
!function(){"use strict";function OneMVRegistrationController($location,$scope,$rootScope,authService,env,MessageService,DivisionService,ConfigFactory,vcRecaptchaService,VerificationService,PageService){var vm=this;vm.cancel=cancel,vm.register=register,vm.captchaPublicKey=env.captchaPublicKey,vm.WidgetCreate=widgetCreate,vm.setCaptchaResponse=setCaptchaResponse,vm.message="",vm.organisationIdLabel="",vm.showOrganisationId=!1,vm.showAllowSms=!1,vm.showFirstName=!1,vm.showLastName=!1,vm.showClientTelephone=!1;var widgetId=-1,divisionId=-1,feedType="";function cancel(){$location.path("dashboard/")}function setCaptchaResponse(e){authService.verifyCaptcha(e).then(function(e){e.success||vcRecaptchaService.reload(widgetId)},function(e){})}function widgetCreate(e){widgetId=e}function register(){vm.message="",vm.isClicked=!0,VerificationService.passengerExists(vm.clientPassengerId).then(function(e){return 1!=e.data.status?(vm.message="Failed to register. Please try again later.",void(vm.isClicked=!1)):"FeedOnly"!=feedType||e.data.result?void registerUser(e.data.result):(vm.message="Passenger not found.",void(vm.isClicked=!1))})}function registerUser(e){var i=vm.phoneNumber;i&&""!=i&&(i="+1"+i);var a={TelephoneNumber:i,AllowSMS:vm.sendSMS,UserName:vm.email,Password:vm.password,ConfirmPassword:vm.confirmPassword,ClientPassengerId:vm.clientPassengerId,DivisionId:divisionId,FirstName:vm.firstName,LastName:vm.lastName,Provider:"MvLogin",DivisionSupportsFeed:e};authService.registerOneMV(a).then(function(e){$rootScope.$broadcast("loggedIn",null),$location.path("dashboard/")},function(e){vm.message=e.Message,vm.isClicked=!1,-1!=widgetId&&vcRecaptchaService.reload(widgetId)})}function activate(){divisionId=DivisionService.getDivisionId(),DivisionService.getDivisionInfo().then(function(e){feedType=e.data.result.DivisionFeedType.FeedType}),ConfigFactory.getDivisionParameters(divisionId).then(function(params){vm.organisationIdLabel=params.OrganisationIdLabel?params.OrganisationIdLabel:"Passenger Id",vm.showOrganisationId=!!params.ShowOrganisationId&&eval(params.ShowOrganisationId.toLowerCase()),vm.showAllowSms=!!params.ShowAllowSms&&eval(params.ShowAllowSms.toLowerCase()),vm.showFirstName=!!params.ShowFirstName&&eval(params.ShowFirstName.toLowerCase()),vm.showLastName=!params.ShowLastName||eval(params.ShowLastName.toLowerCase()),vm.showClientTelephone=!!params.ShowClientTelephone&&eval(params.ShowClientTelephone.toLowerCase())},function(e){vm.divisionHasFeed=!1})}vm.clientPassengerId="",vm.PageService=PageService,vm.PageService.setTitle("New Account"),vm.PageService.setHeadline("Create a ONEMV Login"),activate(),vm.ionicInclude="app/shared/registration/onemv-registration.html",vm.ionicCustomClassName="",vm.ionicHideNavBar=!1,vm.ionicUseRefresher=!1,vm.showRecaptcha=!env.isIonic}angular.module("oneMVApp").controller("OneMVRegistrationController",OneMVRegistrationController),OneMVRegistrationController.$inject=["$location","$scope","$rootScope","authService","env","MessageService","DivisionService","ConfigFactory","vcRecaptchaService","VerificationService","PageService"]}();
!function(){"use strict";function e(i,a,t,e,r,n,c){var s=this;s.isClicked=!1,s.savedSuccessfully=!1,s.message="",s.code="",s.PageService=c,s.PageService.setTitle("Verification");s.registerData={userName:t.externalAuthData.userName,provider:t.externalAuthData.provider,externalAccessToken:t.externalAuthData.externalAccessToken,divisionId:r.getDivisionId(),divisionSupportsFeed:!1},s.PageService.setHeadline("Verify your "+t.externalAuthData.provider+" account"),s.cancel=function(){n.redirectTo("dashboard/")},s.registerExternal=function(){s.message="",s.isClicked=!0,""!==s.code.trim()?o():(s.message="Validation code missing.",s.isClicked=!1)};var o=function(){e.validate(s.code.trim()).then(function(e){1==e.data.status?t.registerExternal(s.registerData).then(function(e){s.savedSuccessfully=!0,l()},function(e){s.message="An error occured. Please try again later.",s.isClicked=!1}):(s.message="Invalid code.",s.isClicked=!1)},function(e){s.message=e.data.Message,s.isClicked=!1})};var l=function(){var e=i(function(){i.cancel(e),a.$broadcast("loggedIn",null),n.redirect()},2e3)};s.ionicInclude="app/shared/verification/verification.html",s.ionicCustomClassName="ionic-template-verification",s.ionicHideNavBar=!1,s.ionicUseRefresher=!1}angular.module("oneMVApp").controller("VerificationController",e),e.$inject=["$timeout","$rootScope","authService","VerificationService","DivisionService","RedirectionService","PageService"]}();
!function(){"use strict";function e(t,r,o,s){return{validate:function(e){var i=r.defer(),n=o.oneMVApiUrl+"division/"+s.getDivisionId()+"/Validate?key="+e;return t.get(n).then(function(e){i.resolve(e)},function(e){i.reject(e)}),i.promise},passengerExists:function(e){var i=r.defer(),n=o.oneMVApiOrgUrl+"passenger/exists/"+s.getDivisionId()+"/"+e;return t.get(n).then(function(e){i.resolve(e)},function(e){i.reject(e)}),i.promise}}}angular.module("oneMVApp").factory("VerificationService",e),e.$inject=["$http","$q","env","DivisionService"]}();
!function(){"use strict";function e(i,e,t,n){var a=this;function o(){t.getWhatsNewData().then(function(e){a.data=e.data.result})}a.PageService=n,a.PageService.setTitle("Whats New"),a.PageService.setHeadline("Latest Service Updates"),o(),a.ionicInclude="app/shared/whats-new/whats-new.html",a.ionicCustomClassName="ionic-whats-new card",a.ionicHideNavBar=!1,a.ionicUseRefresher=!0,a.ionicPullingText="Refresh",a.ionicRefreshingText="Loading",a.ionicSpinner="spiral",a.refresh=function(e){o(),i.$broadcast("scroll.refreshComplete")}}angular.module("oneMVApp").controller("WhatsNewController",e),e.$inject=["$rootScope","$location","DynamicContentService","PageService"]}();
!function(){"use strict";function e(n,o,r,e,t,a,i,s,c){var l=this,d=t.authentication.passengerId,u=!1,f=[{event:"click",callback:function(e){l.show=!0,l.coords=e.coords}}],p={id:null,licenceplate:"--"};l.show=!1,l.reservationInfo={},l.details=!0,l.markers=[],l.cancel=function(){var e={reservationId:l.reservationInfo.id,routeName:l.reservationInfo.routeName,passengerId:d,startTime:l.reservationInfo.pickupTime,reservationDate:l.reservationInfo.reservationDate};o.open({templateUrl:"app/modules/commuter/modals/cancel-reservation-modal/cancel-reservation.html",controller:"CancelReservationController as vm",size:"-fs",backdrop:!0,ariaLabelledBy:"Cancel reservation",resolve:{reservationInfo:function(){return e}}}).result.then(function(e){e.isCancel&&(r.$broadcast("reservationChanged"),n.close({cancelled:!0}))})},l.modifyReservation=function(){o.open({templateUrl:"app/modules/commuter/modals/modify-reservation-modal/modify-reservation-pickup.html",controller:"ModifyReservationPickup as vm",ariaLabelledBy:"Modify reservation time",backdrop:!1,size:"-fs",resolve:{reservation:function(){return l.reservationInfo}}}).result.then(function(e){e.refresh&&(u=!0,I(e.reservationId))},function(){})},l.close=function(){n.close({isModified:u})},l.loading=!0,l.passengerVehicles=[];var v=void 0;function m(){var e;e=document.getElementById("ticketQRcode"),new QRCode(e,{width:100,height:100,text:l.reservationInfo.encryptedId,correctLevel:1,useSVG:!0}),l.show=!1,l.markers.push({latitude:l.reservationInfo.pickupLatitude,longitude:l.reservationInfo.pickupLongitude,icon:g("pickup",l.reservationInfo.scheduleType),name:l.reservationInfo.pickupStopName,address:l.reservationInfo.pickupAddress}),l.markers.push({latitude:l.reservationInfo.dropoffLatitude,longitude:l.reservationInfo.dropoffLongitude,icon:g("dropoff",l.reservationInfo.scheduleType),name:l.reservationInfo.dropoffStopName,address:l.reservationInfo.dropoffAddress}),a.setMapBounds(l.markers,f),l.loading=!1}function I(e){i.getReservationById(d,e).then(function(e){1===e.data.status&&(l.reservationInfo=e.data.result,l.isWaitlisted="Waitlisted"==l.reservationInfo.status,v=l.reservationInfo.vehicleId,l.selectedRating=l.reservationInfo.feedbackRating,c.getVehiclesForPassenger(d).then(function(e){1===e.data.status&&null!=e.data.result.passengerVehicles&&(l.passengerVehicles=e.data.result.passengerVehicles),0<l.passengerVehicles.length?l.passengerVehicles.splice(0,0,p):l.passengerVehicles.push(p);for(var n=0;n<l.passengerVehicles.length;n++)if(l.passengerVehicles[n].id==v){l.vehicleForReservation=l.passengerVehicles;break}},function(e){}),m(),h())})}function h(){return null==l.reservationInfo.feedbackRating||null==l.reservationInfo.feedbackRating}function g(e,n){return"pickup"===e?"AM"===n?s.getCommuterStopIcon():s.getCommuterHubIcon():"PM"===n?s.getCommuterStopIcon():s.getCommuterHubIcon()}l.vehicleForReservation=void 0,l.isWaitlisted=!0,l.selectedRating=0,l.canRateTrip=h,l.showRatingModal=function(){if(!h())return!1;o.open({templateUrl:"app/modules/commuter/modals/feedback-modal/commuter-feedback-modal.html",controller:"CommuterFeedbackModalController as vm",resolve:{feedbackInfo:function(){return{reservationId:l.reservationInfo.id,rating:l.selectedRating,comment:""}}}}).result.then(function(e){!angular.isUndefined(e)&&e.isSaved&&I(l.reservationInfo.id)},function(){})},I(e),l.map=a.initializeMap()}angular.module("oneMVApp").controller("CommuterTripModalController",e),e.$inject=["$uibModalInstance","$uibModal","$rootScope","tripId","authService","MapService","ReservationService","MapIconService","vehicleService"]}();

!function(){"use strict";function e(e,s,r,n,t,a){var i=this,o=[{event:"click",callback:function(e){i.show=!0,i.coords=e.coords}}];i.show=!1,i.passengerTrip=r.passengerTrip,i.options="string"==typeof r.options?JSON.parse(r.options):r.options,i.serviceDate=r.serviceDate,i.map=t.initializeMap(),s(function(){i.markers=[],i.markers.push({latitude:i.passengerTrip.startLatitude,longitude:i.passengerTrip.startLongitude,icon:a.getDrtPickupIcon(),name:i.passengerTrip.startName,address:i.passengerTrip.startAddress}),i.markers.push({latitude:i.passengerTrip.endLatitude,longitude:i.passengerTrip.endLongitude,icon:a.getDrtDropoffIcon(),name:i.passengerTrip.endName,address:i.passengerTrip.endAddress}),t.setMapBounds(i.markers,o)},1e3),i.cancel=function(){e.close({action:"cancel"})},i.closeModal=function(){e.close({action:"close"})},i.displayRatingOption=function(){return"End"===i.passengerTrip.Status||"Reserved"===i.passengerTrip.Status&&i.serviceDate>i.passengerTrip.serviceDate}}angular.module("oneMVApp").controller("TripDetailsModalController",e),e.$inject=["$uibModalInstance","$timeout","tripModalRequest","uiGmapIsReady","MapService","MapIconService"]}();
!function(){"use strict";function PassengerTripsCtrl($state,$uibModal,authService,ReservationService,PageService,LuumLinkedService,OneMvServices,ConfigFactory,DivisionService){var vm=this;vm.pastTrips=[],vm.futureTrips=[],vm.todaysTrips=[],vm.PageService=PageService,PageService.setTitle("Passenger Trips"),PageService.setHeadline("My Trips"),vm.addressRest=null,vm.centerLatLong,vm.onTripCancelled=onTripCancelled,vm.showTripDetails=showTripDetails;var options={reservationType:"current",OperatorId:"",isPassenger:!0,reloadTrips:!1},divisionId=DivisionService.getDivisionId(),passengerId=authService.authentication.passengerId;function activate(){LuumLinkedService.verify(authService.authentication.passengerId),populateDivisionParameters(),getUpcomingTrips()}function getUpcomingTrips(){ReservationService.getAllReservationsForPassenger(passengerId).then(function(e){1===e.data.status&&populateTrips(e.data.result.reservations),vm.loading=!1},function(){vm.loading=!1})}function populateTrips(e){if(vm.pastTrips=[],vm.futureTrips=[],vm.todaysTrips=[],vm.totalTripsCount=0,e){vm.totalTripsCount=e.length;for(var i=0;i<e.length;i++){var o=e[i],a=moment().dayOfYear()-moment(e[i].reservationDate).dayOfYear();0<a?vm.pastTrips.push(o):a<0?vm.futureTrips.push(o):vm.todaysTrips.push(e[i])}}}function showTripDetails(e){$uibModal.open({animation:!0,templateUrl:"app/modules/shared/trips/commuter-trip-modal.html",controller:"CommuterTripModalController as vm",size:"-fs",backdrop:!1,keyboard:!0,resolve:{tripId:e.id}}).result.then(function(e){(e.cancelled||e.isModified)&&getUpcomingTrips()})}function populateDivisionParameters(){ConfigFactory.getDivisionParameters(divisionId).then(function(params){options.promiseWindow=params.PromiseWindow,options.DivisionId=divisionId,options.batchDays=params.BatchDays?eval(params.BatchDays):7,options.minFromDays=params.MinFromDays?eval(params.MinFromDays):30,options.isAdvancedReservation=!!params.AllowAdvancedReservation&&eval(params.AllowAdvancedReservation.toLowerCase()),options.showCancelOptions=!!params.CancelReasonRequired&&eval(params.CancelReasonRequired.toLowerCase()),options.allowFaring=!!params.AllowFaring&&eval(params.AllowFaring.toLowerCase()),options.allowLocationNotes=!!params.AllowLocationNotes&&eval(params.AllowLocationNotes),options.allowChildren=!!params.AllowChildren&&eval(params.AllowChildren),options.allowMultipleSeatBooking=!!params.AllowMultipleSeatBooking&&eval(params.AllowMultipleSeatBooking.toLowerCase())}),vm.userReservationOptions=options}function onTripCancelled(){}vm.currentPassenger={Id:passengerId},authService.isLoggedIn()||$state.go("login"),vm.commuterInfo=OneMvServices.getCommuterInfo(),vm.drtInfo=OneMvServices.getDrtInfo(),vm.hasCommuter=!angular.isUndefined(vm.commuterInfo),vm.hasDrt=!angular.isUndefined(vm.drtInfo),vm.loading=!0,vm.totalTripsCount=0,activate(),vm.ionicOnTouch=function(){$rootScope.$broadcast("ionicScrollResize",{action:"resize"})},vm.ionicInclude="app/modules/on-demand/trips/my-trips.html",vm.ionicCustomClassName="ionic.my-trips",vm.ionicHideNavBar=!1,vm.ionicUseRefresher=!0,vm.ionicPullingText="Refresh Trips",vm.ionicRefreshingText="Loading Trips",vm.ionicSpinner="spiral",vm.refresh=function(e){options.reloadTrips=!options.reloadTrips,$rootScope.$broadcast("scroll.refreshComplete")}}angular.module("oneMVApp").controller("PassengerTripsCtrl",PassengerTripsCtrl),PassengerTripsCtrl.$inject=["$state","$uibModal","authService","ReservationService","PageService","LuumLinkedService","OneMvServices","ConfigFactory","DivisionService"]}();
!function(){"use strict";function e(i,a){return{controller:function(n){n.passengerTrip=JSON.parse(n.trip),n.opts=JSON.parse(n.options),n.serviceDate=n.divisionServiceDate,n.detailsModal=function(){var e=i.open({templateUrl:"app/modules/shared/trips/drt-trip-modal.html",controller:"TripDetailsModalController as vm",size:"-fs",backdrop:!1,resolve:{tripModalRequest:function(){return{passengerTrip:n.passengerTrip,options:n.options,serviceDate:n.serviceDate}}}});e.result.then(function(e){e&&"cancel"===e.action&&n.cancel(n.passengerTrip)})},n.getDisplayStatus=function(e){var t=e;switch(e){case"Cancel":t="Cancelled";break;case"No-show":t="No show";break;case"Un-scheduled":t="Reserved"}return t},n.cancel=function(e){var t={tripId:e.TripId,passengerId:e.PassengerId,from:e.startName,to:e.endName,scheduledTime:e.schedPickupTime},r=i.open({animation:!0,templateUrl:"app/modules/on-demand/activeTrip/trip-cancellation-prompt.html",controller:"TripCancellationController as vm",size:"-fs",resolve:{tripToCancel:function(){return t},showCancelOptions:n.opts.showCancelOptions}});r.result.then(function(e){e.isCancel?(a.toastSuccess("Success!","Trip cancelled"),"function"==typeof n.notifyOnCancel&&n.notifyOnCancel()):a.toastError("Error!","Unable to cancel the trip.")})}},restrict:"E",link:function(r,e,t){r.$watch("trip",function(e,t){e!=t&&("string"==typeof e?r.passengerTrip=JSON.parse(e):"object"==typeof e&&(r.passengerTrip=e))})},replace:!0,scope:{trip:"@",options:"@",tripType:"@",divisionServiceDate:"=",allowTripRating:"=",notifyOnCancel:"=onTripCancel"},templateUrl:"app/modules/shared/trips/tripCard.html"}}angular.module("oneMVApp").directive("tripCardDirective",e),e.$inject=["$uibModal","UtilityFactory"]}();
!function(){"use strict";function e(T,h,D,w,I,y){return{controller:function(s,e){var a=void 0,i=7,o=30,r="MM-DD-YYYY";s.isCancelling=!1,s.loading=!0;var t=void 0,n=void 0;if(s.showTabs=!1,s.commuterInfo=e.getCommuterInfo(),s.drtInfo=e.getDrtInfo(),s.opts=void 0,s.activeTrip={TripId:null},s.passengerFutureTrips=[],s.passengerPastTrips=[],s.passengerActiveTrips=[],""!=s.passenger){var d=JSON.parse(s.passenger);s.passengerId=d?d.Id:void 0}function c(){s.loading=!0,I.getServiceDateByDivision(a).then(function(e){if(1==e.data.status){var t=e.data.result;(function(e){if(s.isPassenger)s.opts.isAdvancedReservation?s.date.to=moment(e).add(i,"d").format(r):s.date.to=moment(e).format(r),s.date.from=moment(e).add(-o,"d").format(r);else{var t=moment(e).format(r);s.date.from=t,s.date.to=t;var n=moment(t,r).add(i,"d");s.minToDateAllowed=t,s.maxToDateAllowed=new Date(n);var a=moment(t,r).add(-o,"d");s.minFromDateAllowed=new Date(a),s.maxFromDateAllowed=t}})(s.serviceDate=t),s.loading=!1;var n=s.opts.autoRefresh?p:null;u(n)}},function(e){s.loading=!1,w.toastError("Error!","Failed to get Service Date.")})}function p(){n=h(function(){l()},3e4),t=h(function(){u()},6e4)}function l(n){var e=JSON.parse(s.passenger);s.passengerId=e?e.Id:void 0,I.getlastripdetails(s.passengerId,a).then(function(e){if(1==e.data.status){if(!angular.isUndefined(s.passengerFutureTrips)){var t=T("filter")(s.passengerFutureTrips,{TripId:e.data.result.TripID});0<t.length&&(s.activeTrip=t[0])}}else s.activeTrip={TripId:null};n&&n()},function(){})}function m(e,t){var n=new Date(e).getTime()<=new Date(t).getTime();return n}function u(o,r){s.loading=!0;var e=T("date")(s.date.from,"yyyy-MM-dd"),t=T("date")(s.date.to,"yyyy-MM-dd"),n=JSON.parse(s.passenger);s.passengerId=n?n.Id:void 0,I.getPassengerTrips(a,s.passengerId,e,t).then(function(e){var t,n,a,i;1==e.data.status&&(function(e){for(var t=0;t<e.length;t++)g(e[t])}(i=e.data.result),s.passengerPastTrips=(t=f,n=v,(a=i.filter(t))&&a.sort(n),a),s.passengerFutureTrips=function(e){for(var t=angular.copy(e),n=0;n<s.passengerPastTrips.length;n++){var a=s.passengerPastTrips[n].TripId;t=T("filter")(t,{TripId:"!"+a})}return t}(i)),s.loading=!1,o?l(o):r&&l()},function(e){s.loading=!1,w.toastError("Error",e.data)})}function f(e){moment.tz(y.getTimeZone()).format("x");return"Cancel"===e.Status||"No-show"===e.Status||"End"===e.Status||e.serviceDate<s.serviceDate}function v(e,t){return t.schedEpoch-e.schedEpoch}function g(e){s.opts.promiseWindow;if(e.schedEpoch=moment.tz(e.schedPickupTime,y.getTimeZone()).format("x"),e.estEpoch=moment.tz(e.estimatedPickupTime,y.getTimeZone()).format("x"),e.estimatedPickupTime){var t=new moment(e.startPickupWindowTime),n=new moment(e.endPickupWindowTime);e.promiseWindowStartTime=t.format("h:mm A"),e.promiseWindowEndTime=n.format("h:mm A"),null==e.vehicleLicense&&(e.vehicleLicense="N/A")}}s.showTabs=!angular.isUndefined(s.commuterInfo)&&!angular.isUndefined(s.drtInfo),s.getDisplayStatus=function(e){var t=e;switch(e){case"Cancel":t="Canceled";break;case"No-show":t="No Show"}return t},s.activate=function(e){s.passengerId=e.Id,s.loading=!0,c()},s.displayRatingOption=function(e){return"End"===e.Status||"Reserved"===e.Status&&s.serviceDate>e.serviceDate},s.cancel=function(e){var t={tripId:e.TripId,passengerId:e.PassengerId,from:e.startName,to:e.endName,scheduledTime:e.schedPickupTime},n=D.open({animation:!0,templateUrl:"app/modules/on-demand/activeTrip/trip-cancellation-prompt.html",controller:"TripCancellationController as vm",size:"-fs",backdrop:!1,resolve:{tripToCancel:function(){return t},showCancelOptions:s.opts.showCancelOptions}});n.result.then(function(e){e.isCancel?(w.toastSuccess("Success!","Trip cancelled"),u(null,!0)):w.toastError("Error!","Unable to cancel the trip.")})},s.init=function(){s.loading=!0,s.isPassenger=s.opts.isPassenger,s.reservationType=s.opts.reservationType,a=s.opts.DivisionId,s.opts.OperatorId,i=s.opts.batchDays,s.opts.autoRefresh=!0,o=s.opts.minFromDays,s.isStartDp=!1,s.isEndtDp=!1,s.date={from:void 0,to:void 0},s.minFromDateAllowed=void 0,s.maxFromDateAllowed=void 0,s.minToDateAllowed=void 0,s.maxToDateAllowed=void 0,s.showMap=[],s.isPassenger&&s.activate(s.passenger)},s.onTripCancel=function(){u(null,!0)},s.dateChanged=function(){var e=s.date.from;s.minToDateAllowed=e,m(s.date.to,s.date.from)&&(s.date.to=angular.copy(s.date.from)),u()},s.addNewTrip=function(e){var t=moment(e.ScheduledPickupTime).format(r);m(s.date.from,t)&&m(t,s.date.to)&&u()},s.$on("$destroy",function(e){angular.isDefined(t)&&(h.cancel(t),t=void 0),angular.isDefined(n)&&(h.cancel(n),n=void 0)})},link:function(n,e,t){var a=!0;n.$watch("options",function(e,t){(e!=t||a)&&("string"==typeof e?n.opts=JSON.parse(e):"object"==typeof e&&(n.opts=e),a=!1,n.init())})},restrict:"E",replace:!1,scope:{passenger:"@",newTrip:"@",options:"@",divisionId:"@",notifyTripCancelled:"=onTripCancelled",allowTripRating:"="},templateUrl:"app/modules/shared/trips/userReservations.html"}}angular.module("oneMVApp").directive("mvPassengerTrips",e),e.$inject=["$filter","$interval","$uibModal","UtilityFactory","ScheduleService","DivisionService","PageService"]}();
!function(){"use strict";function e(e,i,a,n,t){var l=this;l.vehicleInfo=void 0,l.atleastOneVehicleExist=n,l.message="",l.isSaving=!1,l.errorMessage="Add failed",l.showMessage=!1;var c=e.authentication.passengerId,o=!1;function s(){return{year:"",make:"",model:"",color:"",licencePlate:"",isDefault:!l.atleastOneVehicleExist,isActive:!0}}function r(e){l.message=e,l.showMessage=!0,t(function(){l.showMessage=!1},5e3)}l.maxYear=(new Date).getFullYear()+1,l.isYearValid=function(){return""===l.vehicleInfo.year||"1930"<=l.vehicleInfo.year&&l.vehicleInfo.year<=l.maxYear},l.save=function(){l.isSaving=!0,o=!1,""!==l.vehicleInfo.color&&""!=l.vehicleInfo.color.trim()&&""!==l.vehicleInfo.licencePlate&&""!=l.vehicleInfo.licencePlate.trim()&&""!==l.vehicleInfo.make&&""!=l.vehicleInfo.make.trim()&&""!==l.vehicleInfo.model&&""!=l.vehicleInfo.model.trim()&&""!==l.vehicleInfo.year?i.save(l.vehicleInfo,c).then(function(e){e.data&&1==e.data.status&&-1<e.data.result?(l.vehicleInfo.id=e.data.result,l.vehicleInfo=s(),o=!0,a.close({isAdded:o})):r(e.data.result),l.isSaving=!1},function(e){r(response.data.message),l.isSaving=!1}):(r("Invalid Input!"),l.isSaving=!1)},l.cancel=function(){a.close({isAdded:o})},l.vehicleInfo=s()}angular.module("oneMVApp").controller("AddVehicleController",e),e.$inject=["authService","vehicleService","$uibModalInstance","atleastOneVehicleExist","$timeout"]}();
!function(){"use strict";function e(e,r,a,n,t,o){var s=this;s.reservationInfo=a,s.routeName=s.reservationInfo.routeName,s.startTime=s.reservationInfo.startTime,s.reservationDate=moment(s.reservationInfo.reservationDate).format("MM/DD/YYYY"),s.cancelError=!1,s.disable=!1,s.errorMessage="Sorry, we were unable to cancel this reservation.",s.cancelReservation=function(){s.disable=!0,s.reservationInfo.reservationId?n.cancelReservation(s.reservationInfo.passengerId,s.reservationInfo.reservationId).then(function(e){e&&e.data&&1==e.data.status?r.close({action:"close",isCancel:!0}):(s.cancelError=!0,e.data.result&&"Failure"==e.data.message&&(s.errorMessage=e.data.result)),s.disable=!1}):s.cancelError=!0},s.cancel=function(){r.dismiss("cancel")},this.MakeDisable=function(){return!!s.disable}}angular.module("oneMVApp").controller("CancelReservationController",e),e.$inject=["$location","$uibModalInstance","reservationInfo","ReservationService","StopDataService","MessageService"]}();
!function(){"use strict";function e(a,o,e,n,t){var c=this;c.feedbackInfo=angular.copy(t),c.cancel=function(){a.close({isSaved:!1})},c.saveFeedback=function(){n.addCommuterFeedback({Comment:c.feedbackInfo.comment.trim(),Rating:c.feedbackInfo.rating},c.feedbackInfo.reservationId).then(function(e){1==e.data.status?(c.isSaving=!1,o.toastSuccess("Success!","Feedback saved successfully"),a.close({isSaved:!0})):(c.isSaving=!1,o.toastError("Error!","Could not save feedback"),console.log("Error: - "+e.data.message))},function(e){c.isSaving=!1,o.toastError("Error!","Could not save feedback"),console.log("Error: - "+e.data.message)})},c.disableSubmit=function(){return c.feedbackInfo.rating<=0||null==c.feedbackInfo.rating}}angular.module("oneMVApp").controller("CommuterFeedbackModalController",e),e.$inject=["$uibModalInstance","UtilityFactory","ConfigFactory","FeedbackService","feedbackInfo"]}();
!function(){"use strict";function e(e,s,i,n,a,t,r){var o=this,l=t.authentication.passengerId,c={id:null,licenceplate:"--"};o.reservationInfo=r,o.message="",o.isSaving=!1,o.currentTripId=o.reservationInfo.tripId,o.selectedTripId=o.reservationInfo.tripId,o.availableParking=0,o.selectedVehicleId=angular.copy(o.reservationInfo.vehicleId),o.divisionAllowsWaitlist=!0,o.manageVehicle=function(){o.message="",i.manageParkingForReservation(l,o.reservationInfo.id,o.selectedVehicleId).then(function(e){if(0==e.data.status){var i=e.data.result.message;o.message=i}else s.close({action:"close",refresh:!0,reservationId:e.data.result.id})},function(e){})},o.modifyTrip=function(){o.isSaving=!0,o.message="",i.modifyReservation(o.reservationInfo.id,o.selectedTripId,l).then(function(e){0==e.data.status?(o.message=e.data.result.message,o.isSaving=!1):(o.isSaving=!1,s.close({action:"close",refresh:!0,reservationId:e.data.result.id}))},function(e){o.message=e,o.isSaving=!1})},o.cancel=function(){s.close({action:"close"})},a.isWaitlistAllowedByDivision().then(function(e){o.divisionAllowsWaitlist=e}),i.getAllTripsForCurrentReservation(o.reservationInfo.id,l).then(function(e){o.trips=e.data.result.altTrips,o.availableParking=o.trips[0].availableParking},function(e){}),n.getVehiclesForPassenger(l).then(function(e){1===e.data.status&&null!=e.data.result.passengerVehicles&&(o.passengerVehicles=e.data.result.passengerVehicles),0<o.passengerVehicles.length?o.passengerVehicles.splice(0,0,c):o.passengerVehicles.push(c)},function(e){})}angular.module("oneMVApp").controller("ModifyReservationPickup",e),e.$inject=["$location","$uibModalInstance","ReservationService","vehicleService","DivisionService","authService","reservation"]}();
!function(){"use strict";function e(e,t,n,o,i){var a=this;a.isRemoving=!1,a.removeVehicle=function(){a.isRemoving=!0,n.removeVehicle(o,i.authentication.passengerId).then(function(e){e.data&&1==e.data.status?t.close({removed:!0}):e.data.result&&""!==e.data.result&&t.close({removed:!1,errorMessage:e.data.result})},function(e){})},a.cancel=function(){t.dismiss({removed:!1})}}angular.module("oneMVApp").controller("RemoveVehicleConfirmationController",e),e.$inject=["$location","$uibModalInstance","vehicleService","id","authService"]}();
!function(){"use strict";function o(o,t,e,n,i,s,r,p,a,d,c){var u=this;u.title="Schedule Stops",u.mapControl={},u.stopMarker=[];var l=void 0;u.map={center:{latitude:43.75514221191406,longitude:-116.57597351074219},zoom:10,lineStyle:{color:"#333",weight:5,opacity:.7}},u.mapOptions={mapTypeControl:!1,zoomControl:!1,streetViewControl:!1};function g(){angular.isDefined(l)&&(s.cancel(l),l=void 0)}u.myLocationIcon={url:"images/pin-my-location.png",size:new google.maps.Size(42,42),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(20,20)},u.reservationStops=c,null==u.reservationStops.id&&""==u.reservationStops.id||("AM"==u.reservationStops.scheduleType?(u.icon="images/pin-busstop-green.svg",u.hubIcon="images/pin-hub.svg",u.stopMarker.push({stopId:u.reservationStops.pickupStopId,stopName:u.reservationStops.pickupStopName,latitude:u.reservationStops.pickupLatitude,longitude:u.reservationStops.pickupLongitude,icon:u.icon,address:u.reservationStops.pickupAddress}),u.stopMarker.push({stopId:u.reservationStops.dropoffStopId,stopName:u.reservationStops.dropoffStopName,latitude:u.reservationStops.dropoffLatitude,longitude:u.reservationStops.dropoffLongitude,icon:u.hubIcon,address:u.reservationStops.dropoffAddress})):(u.icon="images/pin-busstop-grey.svg",u.hubIcon="images/pin-hub.svg",u.stopMarker.push({stopId:u.reservationStops.pickupStopId,stopName:u.reservationStops.pickupStopName,latitude:u.reservationStops.pickupLatitude,longitude:u.reservationStops.pickupLongitude,icon:u.hubIcon,address:u.reservationStops.pickupAddress}),u.stopMarker.push({stopId:u.reservationStops.dropoffStopId,stopName:u.reservationStops.dropoffStopName,latitude:u.reservationStops.dropoffLatitude,longitude:u.reservationStops.dropoffLongitude,icon:u.icon,address:u.reservationStops.dropoffAddress})),l=s(function(){r.getCurrentPosition().then(function(o){null!=o&&null!=o?u.myLocation={coords:{latitude:o.coords.latitude,longitude:o.coords.longitude},icon:u.myLocationIcon}:g()},function(o){})},1e4),a.promise().then(function(o){google.maps.event.trigger(u.mapControl.getGMap(),"resize");var t=new google.maps.LatLngBounds;angular.forEach(u.stopMarker,function(o){t.extend(new google.maps.LatLng(o.latitude,o.longitude))}),u.mapControl.getGMap().fitBounds(t)}),u.markerEvent={click:function(o,t,e){e.$id&&(u.selectedLocation&&p.setGeoLocation(u.selectedLocation),p.setStop(e.coords),u.coords=e.coords,u.show=!0)}},u.cancel=function(){g(),i.dismiss("cancel"),u.isDone=!0},o.$on("$locationChangeStart",function(o){g()}))}angular.module("oneMVApp").controller("ReservationMapController",o),o.$inject=["$scope","$location","$timeout","$http","$uibModalInstance","$interval","GeoLocationService","StopDataService","uiGmapIsReady","LocationService","reservation_stops"]}();
!function(){"use strict";function e(e,i,t,a,s,n,o,r,l,d,c){var v=this;v.isAdd=n,v.disable=!1,v.isReserved=!1,v.hasVehicles=!1,v.needsParking=!1,v.vehicles=[],v.selectedVehicle=void 0,v.loadingVehicles=!0,v.isAMReservation="AM"===t.scheduleType,v.parkingNotAvailable=!1,v.noParkingMessage="Parking not available.",v.availableParkingSlots=0,v.isParkingAttachedToReservation=!0,v.reservationData=t,v.updateLabels=h;var u=0;v.divisionAllowsWaitlist=!0,v.numCompanions=[];var p={licenceplate:"--",id:void(v.selectedCompanions=0)};v.reserve=function(){v.disable=!0;var e={pickupStopId:t.pickupStop.id,dropoffStopId:t.dropoffStop.id,tripId:t.trip.tripId,reservationDate:t.reservationDate,passengerId:t.passengerId,divisionId:t.divisionId,routeId:t.trip.routeId,schedule:t.scheduleType,companions:v.selectedCompanions};v.needsParking&&!angular.isUndefined(v.selectedVehicle.id)&&(e.vehicleId=v.selectedVehicle.id);o.addReservations(t.passengerId,[e]).then(b)};function h(){v.divisionAllowsWaitlist&&(v.isAMReservation&&v.selectedVehicle!==p&&v.availableParkingSlots<=0||u<1+v.selectedCompanions)?(v.btnText="Add To Waitlist",v.modalText="Add to waitlist",v.modalSuccessText="Added To Waitlist"):f()}function g(){o.getAvailableSeatsForTrip(t.trip.tripId,Date.parse(t.reservationDate)).then(function(e){if(l.getVehiclesForPassenger(t.passengerId).then(function(e){!function(){if(!v.isAMReservation)return h();d.getAvailableParkingsForStop(t.pickupStop.id,S()).then(function(e){1===e.data.status&&(v.availableParkingSlots=e.data.result),v.availableParkingSlots<=0&&(v.parkingNotAvailable=!0),h()},function(e){r.showInformation(e)})}(),1===e.data.status&&null!=e.data.result.passengerVehicles&&(v.vehicles=e.data.result.passengerVehicles,v.vehicles.splice(0,0,p),v.selectedVehicle=function(e){for(var i=0;i<e.length;i++)if(e[i].isDefault)return e[i];return p}(v.vehicles),v.hasVehicles=!0,v.isAMReservation&&(v.needsParking=!0)),v.vehicles&&0!==v.vehicles.length||(v.selectedVehicle=p),v.loadingVehicles=!1},function(e){v.hasVehicles=!1,v.loadingVehicles=!1}),1===e.data.status&&(u=e.data.result.availableCapacity,0<e.data.result.allowedCompanions))for(var i=0;i<=e.data.result.allowedCompanions;i++)v.numCompanions.push(i)},function(e){})}function f(){v.btnText="Reserve Seat",v.modalText="Reserve a seat",v.modalSuccessText="Reservation Created"}function S(){return Date.parse(t.reservationDate)}function b(e){var i,a;e.data&&1==e.data.status?e.data.result.errors&&0<e.data.result.errors.length?r.showInformation(e.data.result.errors[0]):(i=t.passengerId,a=e.data.result.id[0],o.getReservationById(i,a).then(function(e){v.isReserved=!0,v.confirmationNumber=e.data.result.confirmationNumber,v.needsParking||(v.isParkingAttachedToReservation=!1),d.getAvailableParkingsForStop(t.pickupStop.id,S()).then(function(e){1===e.data.status&&e.data.result&&(v.availableParkingSlots=e.data.result)})})):r.showInformation("Error processing reservation."),v.disable=!1}v.cancel=function(){i.close({action:"close",isReserved:v.isReserved})},v.navigateToReservationPage=function(){i.close({action:"reservation"})},v.navigateToAddVehicles=function(){i.close({action:"vehicle"})},this.MakeDisable=function(){return!!v.disable},c.isWaitlistAllowedByDivision().then(function(e){v.divisionAllowsWaitlist=e,g()},function(){g()})}angular.module("oneMVApp").controller("ReservationController",e),e.$inject=["$location","$uibModalInstance","reservationInfo","$interval","$rootScope","isAdd","ReservationService","MessageService","vehicleService","StopDataService","DivisionService"]}();
!function(){"use strict";function e(e,o,i,t,n,s,a,p,l,r,g){var c=this;c.title="Schedule Stops",c.mapControl={},c.stopMarker=[],c.map={center:{latitude:43.75514221191406,longitude:-116.57597351074219},zoom:10,lineStyle:{color:"#333",weight:5,opacity:.7}};var u,d,m,h;c.mapOptions={mapTypeControl:!1,zoomControl:!1,streetViewControl:!1,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels.icon",stylers:[{visibility:"off"}]}]},h=0<g.navigator.userAgent.indexOf("Trident")||0<g.navigator.userAgent.indexOf("MSIE")?(u="images/pin-busstop-green.png",d="images/pin-busstop-grey.png",m="images/pin-hub.png","images/pin_pickup.png"):(u="images/pin-busstop-green.svg",d="images/pin-busstop-grey.svg",m="images/pin-hub.svg","images/pin_pickup.svg"),c.scheduleStops=p,c.scheduleStops.IsAM?angular.forEach(c.scheduleStops.stops,function(e){c.icon={url:u},e.isHub&&(c.icon={url:m}),c.stopMarker.push({stopId:e.stopId,stopName:e.name,latitude:e.latitude,longitude:e.longitude,icon:c.icon,address:e.address})}):angular.forEach(c.scheduleStops.stops,function(e){c.icon={url:d},e.isHub&&(c.icon={url:m}),c.stopMarker.push({stopId:e.stopId,stopName:e.name,latitude:e.latitude,longitude:e.longitude,icon:c.icon,address:e.address})}),c.icon="images/pin_pickup.svg",c.icon={url:h},t.promise().then(function(e){if(google.maps.event.trigger(c.mapControl.getGMap(),"resize"),null!=l&&0<l.length){var o=google.maps.geometry.encoding.decodePath(l[0].line),t=new google.maps.Polyline({path:o,strokeOpacity:.5,strokeWeight:5,icons:[{icon:{path:google.maps.SymbolPath.FORWARD_OPEN_ARROW,strokeOpacity:0,fillOpacity:1,scale:2.5},offset:"25px",repeat:"200px"}],zIndex:1}),i=new google.maps.Polyline({path:o,strokeColor:"#fff",strokeOpacity:1,strokeWeight:8,zindex:0});t.setMap(c.mapControl.getGMap()),i.setMap(c.mapControl.getGMap())}var n=new google.maps.LatLngBounds;o&&0<o.length?angular.forEach(o,function(e){n.extend(new google.maps.LatLng(e.lat(),e.lng()))}):angular.forEach(c.stopMarker,function(e){n.extend(new google.maps.LatLng(e.latitude,e.longitude))}),c.mapControl.getGMap().fitBounds(n)}),c.polylines=[{id:1,path:c.path,stroke:{color:"#6060FB",weight:5},editable:!1,draggable:!1,geodesic:!0,visible:!0}],c.markerEvent={click:function(e,o,t){t.$id&&(c.selectedLocation&&i.setGeoLocation(c.selectedLocation),i.setStop(t.coords),c.coords=t.coords,c.show=!0)}},c.cancel=function(){r.dismiss("cancel"),c.isDone=!0}}angular.module("oneMVApp").controller("StopsMapController",e),e.$inject=["$location","GeoLocationService","StopDataService","uiGmapIsReady","LocationService","$http","$timeout","schedule_stops","routeData","$uibModalInstance","$window"]}();
!function(){"use strict";function t(t){return{restrict:"E",controller:function(t,c){t.goBack=function(){c.history.back()}},replace:!0,template:'<button class="go-back" ng-click="goBack()">Back</button>'}}angular.module("oneMVApp").directive("backControl",t),t.$inject=["$window"]}();
!function(){"use strict";function t(t){return{link:function(o,t,e){o.$watch("routeInfo",function(t,e){t!==e&&""!=t&&("string"==typeof t?o.routeInfo=JSON.parse(t):"object"==typeof t&&(o.routeInfo=t),o.activate())})},restrict:"EA",controller:function(o,t){function e(){for(var t=!1,e=0;e<o.routeInfo.trips.length;e++)if(o.routeInfo.trips[e].isActive){o.activeTrip=o.routeInfo.trips[e],t=!0;break}t||o.routeInfo&&o.routeInfo.trips&&!o.activeTrip&&(o.activeTrip=o.routeInfo.trips[0],o.routeInfo.trips[0].isActive=!0)}o.activateTrip=function(t){o.activeTrip=t;for(var e=0;e<o.routeInfo.trips.length;e++)o.routeInfo.trips[e]===t?o.routeInfo.trips[e].isActive=!0:o.routeInfo.trips[e].isActive=!1},o.activateRoute=function(){o.routeInfo.isSelected=!o.routeInfo.isSelected,o.onSelect&&"function"==typeof o.onSelect&&o.onSelect({schedule:o.routeInfo})},o.gotoRouteWithStops=function(){t.path("fixed-route/routes/"+o.routeInfo.route.id)},o.activate=e,o.activeTrip=null,e()},scope:{routeInfo:"=",onSelect:"&",pinnable:"="},templateUrl:"app/modules/fixed-route/directives/route-card/route-card.html"}}angular.module("oneMVApp").filter("routeStopsName",function(){return function(t){if(t&&0<t.length){var e=t.indexOf("-")+1,o=t.length;return t.substring(e,o)}}}),angular.module("oneMVApp").filter("routeShortName",function(){return function(t){if(t&&0<t.length){var e=t.indexOf("-")-1;return t.substring(0,e)}}}),angular.module("oneMVApp").directive("routeCard",t),t.$inject=["$window"]}();
!function(){"use strict";function e(){return{link:function(e,t,r){},restrict:"E",controller:function(t){t.selectedArrivalIndex=0,t.showArrivals=function(e){t.selectedArrivalIndex=e};t.selectedStopId},scope:{routeArrival:"=",selectedStopId:"="},templateUrl:"app/modules/fixed-route/directives/stop-arrival-info/stop-arrival-info.html"}}angular.module("oneMVApp").directive("stopArrivalInfo",e),e.$inject=[]}();
!function(){"use strict";function e(e,a,t,r,n,o,c,i,s){var d=this;d.trip=o,d.cancel=function(){n.close()},d.saveFeedback=function(){var a={PassengerRating:d.feedback.rating,Comment:d.feedback.comment,TripId:d.trip.TripId,CreatedBy:s.authentication.passengerId};i.SaveFeedback(a).then(function(e){1==e.data.status?(d.isSaving=!1,t.toastSuccess("Success!","Feedback saved successfully"),n.close(a)):(d.isSaving=!1,t.toastError("Error!","Could not save feedback"),$log.error("Error: - "+e.data.message))},function(e){d.isSaving=!1,t.toastError("Error!","Could not save feedback"),$log.error("Error: - "+e.data.message)})},d.feedback={rating:c,comment:""},d.disableSubmit=function(){var e=!0;return 0<d.feedback.rating&&(e=!1),e}}angular.module("oneMVApp").controller("RatingModalController",e),e.$inject=["$scope","$http","UtilityFactory","ConfigFactory","$uibModalInstance","trip","selectedRating","FeedbackService","authService"]}();
!function(){"use strict";angular.module("oneMVApp").directive("starRatingDirective",function(){return{restrict:"E",scope:{tripInfo:"=",options:"@",allowTripRating:"@"},templateUrl:"app/modules/on-demand/reservations/rating-component/starRating.html",controller:function(t,r){t.jsTripInfo=t.tripInfo,t.jsOptions=JSON.parse(t.options),t.rating=t.jsTripInfo.rating,t.ratingComment=t.jsTripInfo.ratingComment,t.mvReadOnly=!1;t.showRatingModal=function(){if(t.mvReadOnly)return!1;var n=r.open({templateUrl:"app/modules/on-demand/reservations/rating-component/ratingModal.html",controller:"RatingModalController as vm",resolve:{trip:t.jsTripInfo,selectedRating:t.rating}});n.result.then(function(n){angular.isUndefined(n)?t.rating=0:(t.rating=n.PassengerRating,t.ratingComment=n.Comment,t.jsTripInfo.ratingComment=n.Comment,t.jsTripInfo.rating=n.PassengerRating,t.mvReadOnly=!0)},function(){})},function(){new Date(t.jsTripInfo.serviceDate);var n=["No-show","Cancel"];0==t.allowTripRating&&t.jsTripInfo.rating<=0?t.mvReadOnly=!1:0<=n.indexOf(t.jsTripInfo.Status)?t.mvReadOnly=!1:0<t.jsTripInfo.rating&&(t.mvReadOnly=!0)}()}}})}();
!function(){"use strict";function e(n){n.onHammer=function(e){n.eventType=e.type,console.log(e.type)},n.carouselOptions={navText:["",""],responsiveClass:!1,nav:!0,onDrag:function(e){angular.element("html").addClass("no-scroll")},onDragged:function(e){angular.element("html").removeClass("no-scroll")},responsive:{0:{items:1,stagePadding:34,startPosition:1,center:!0},375:{items:1,stagePadding:34,startPosition:1,center:!0},768:{items:2,stagePadding:16,startPosition:1,center:!0},992:{items:3,stagePadding:0,center:!1,mergeFit:!0}}}}angular.module("oneMVApp").controller("MenuController",e),e.$inject=["$scope"]}(),function(){"use strict";function e(){return{restrict:"E",transclude:!1,link:function(r){r.initCarousel=function(e){var n={},t=r.$eval($(e).attr("data-options"));for(var o in t)n[o]=t[o];$(e).owlCarousel(n)}}}}angular.module("oneMVApp").directive("owlCarousel",e),e.$inject=[]}();