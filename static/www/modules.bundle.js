(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('OneMVController', OneMVController);

    OneMVController.$inject = ['$location', '$scope', 'DivisionService', '$rootScope', '$interval', 'env', 'PageService', 'RedirectionService', '$log'];

    function OneMVController($location, $scope, DivisionService, $rootScope, $interval, env, PageService, RedirectionService, $log) {

        var vm = this;
        vm.division = "default";
        vm.PageService = PageService;
        vm.brand = 'base';
        if (env.ionic) {
            vm.ionic = env.ionic;
        } else {
            vm.ionic = {};
            vm.ionic.showMenu = false;
        }


        function activate() {
            if (DivisionService.getDivisionId())
                DivisionService
                     .getDivisionInfo()
                 .then(handleSuccess, handleFailure);
            else
                handleFailure();
        }

        function handleSuccess(response) {
            if (response.data.status === 1) {
                setDivisionValues(response.data.result);
            }
        }

        function handleFailure(error) {
            $location.path('/division');
        }

        function getMajorAppVersion(majorNo) {
            var _majorAppNo = null;
            if (majorNo) {
                var _arr = majorNo.split('v');
                if (_arr && _arr.length > 1) {
                    _majorAppNo = _arr[1];
                }
            } else {
                $log.error("App Version not setup correctly in DB.");
        };
            return _majorAppNo;
        }

        function getMajorSwVersion(majorNo) {
            var _majorSwNo = null;
            if (majorNo) {
                var _arr = majorNo.split('sw');
                if (_arr && _arr.length > 1) {
                    _majorSwNo = _arr[1];
                }
            }
            return _majorSwNo;
        };

        function isANumber(no) {
            return !isNaN(no);
        }

        function isMinVersion(division) {
            var isMinVersion = true;
            if (division.MinAppVersion) {
                var dbAppVersions = division.MinAppVersion.split('.');
                var currentVersions = env.ionic.appVersion.split('.');
                
                var dbNo = (getMajorAppVersion(dbAppVersions[0]) * 10000) + 
                            (eval(dbAppVersions[1]) * 100) +
                            (dbAppVersions[2] ? eval(dbAppVersions[2]) : 0)

                var currentAppNo = (getMajorAppVersion(currentVersions[0]) * 10000) +
                                    (eval(currentVersions[1]) * 100) +
                                    (currentVersions[2] ? eval(currentVersions[2]) : 0)

                isMinVersion = currentAppNo >= dbNo;
            };

            return isMinVersion;
        };

        function setDivisionValues(division) {
            var msg = {type:"checkMinAppVersion", data: division};
             try{
                console.dir(msg);
                window.postMessage(JSON.stringify(msg));
             }catch(e){
                console.log(e);
             }
             
            if (env.ionic && !isMinVersion(division)) {
                RedirectionService.redirectTo('/min-app-support');
                return false;
            }
            if (division.HasCustomSetup){
                vm.brand = division.DivisionID;
            } else {
                vm.brand = 'base';
            }

            vm.division = division.DivisionID;


            // document.title = division.MetaTitle;
            // vm.title = division.MetaTitle;;
            // vm.description = division.MetaDescription;
            $rootScope.supportPhoneNumber = division.SupportPhoneNumber;
    }


        if (DivisionService.getDivisionId())
            activate();

        $rootScope.$on('divisionChanged', activate);
        
    }

})();

(function() {
    'use strict';

    angular
        .module('oneMVApp')
        .directive('dynamic', HtmlDirective);

    HtmlDirective.$inject = ['$compile'];
    
    function HtmlDirective($compile) {
        return {
            restrict: 'A',
            replace: true,
            link: function (scope, ele, attrs) {
                scope.$watch(attrs.dynamic, function (html) {
                    ele.html(html);
                    $compile(ele.contents())(scope);
                });
            }
        };
    }

})();
//var mod = angular.module('oneMVApp');
//mod.directive('onKeydown', function () {
//    return {
//        restrict: 'A',
//        link: function (scope, elem, attrs) {
//            // this next line will convert the string
//            // function name into an actual function
//            var functionToCall = scope.$eval(attrs.onKeydown);
//            elem.on('keydown', function (e) {
//                // on the keydown event, call my function
//                // and pass it the keycode of the key
//                // that was pressed
//                // ex: if ENTER was pressed, e.which == 13
//                functionToCall(e);
//            });
//        }
//    };
//});
/*global angular */
(function (ng) {
  'use strict';

  var app = ng.module('ngLoadScript', []);

  app.directive('script', function ($parse, $rootScope, $compile) {
      return {
          restrict: 'E',
          terminal: true,
          link: function (scope, element, attr) {
              if (attr.ngSrc) {
                  var domElem = '<script src="' + attr.ngSrc + '" async defer></script>';
                  $(element).append($compile(domElem)(scope));


              }
          }
      };
  });

}(angular));
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .directive('phonenumberDirective', phonenumberDirective)
        .filter('phonenumber', phonenumber);
    phonenumberDirective.$inject = ['$filter', '$browser'];

    function phonenumberDirective($filter, $browser) {
        /*
		Intended use:
			<phonenumber-directive placeholder='prompt' model='someModel.phonenumber'></phonenumber-directive>
		Where:
			someModel.phonenumber: {String} value which to bind only the numeric characters [0-9] entered
				ie, if user enters 617-2223333, value of 6172223333 will be bound to model
			prompt: {String} text to keep in placeholder when no numeric input entered
		*/

        return {
            require: 'ngModel',
            link: function ($scope, $element, $attrs, ngModelCtrl) {
                var listener = function () {
                    var value = $element.val().replace(/[^0-9]/g, '');
                    $element.val($filter('phonenumber')(value, false));
                };

                // This runs when we update the text field
                ngModelCtrl.$parsers.push(function ($viewValue) {
                    return $viewValue.replace(/[^0-9]/g, '');
                });

                // This runs when the model gets updated on the scope directly and keeps our view in sync
                ngModelCtrl.$render = function () {
                    $element.val($filter('phonenumber')(ngModelCtrl.$viewValue, false));
                };

                $element.bind('change', listener);
                $element.bind('keydown', function (event) {
                    var key = event.keyCode;
                    // If the keys include the CTRL, SHIFT, ALT, or META keys, or the arrow keys, do nothing.
                    // This lets us support copy and paste too
                    if (key == 91 || (15 < key && key < 19) || (37 <= key && key <= 40)) {
                        return;
                    }
                    $browser.defer(listener); // Have to do this or changes don't get picked up properly
                });

                $element.bind('paste cut', function () {
                    $browser.defer(listener);
                });
            }

        };
    }

    function phonenumber() {
        /* 
	    Format phonenumber as: c (xxx) xxx-xxxx
	    	or as close as possible if phonenumber length is not 10
	    	if c is not '1' (country code not USA), does not use country code
	    */

        return function (number) {
            /* 
		    @param {Number | String} number - Number that will be formatted as telephone number
		    Returns formatted number: (###) ###-####
		    	if number.length < 4: ###
		    	else if number.length < 7: (###) ###
 
		    Does not handle country codes that are not '1' (USA)
		    */
            if (!number) { return ''; }

            number = String(number);

            // Will return formattedNumber. 
            // If phonenumber isn't longer than an area code, just show number
            var formattedNumber = number;

            // if the first character is '1', strip it out and add it back
            var c = (number[0] == '1') ? '1 ' : '';
            number = number[0] == '1' ? number.slice(1) : number;

            // # (###) ###-#### as c (area) front-end
            var area = number.substring(0, 3);
            var front = number.substring(3, 6);
            var end = number.substring(6, 10);

            if (front) {
                formattedNumber = (c + "(" + area + ") " + front);
            }
            if (end) {
                formattedNumber += ("-" + end);
            }
            return formattedNumber;
        };
    }


})();
(function () {
    //debugger;
    'use strict';

    angular.module('oneMVApp').factory('ConfigFactory', ConfigFactory);
    ConfigFactory.$inject = ['$http', '$q', 'env'];



function ConfigFactory($http, $q, env) {
    var Factory = {
        getOneMVApiURL: getOneMVApiURL,
        getOneMVApiURLPromise: getOneMVApiURLPromise,
        resetUserAndDivision: resetUserAndDivision,
        getCurrentUser: getCurrentUser,
        getCurrentDivision: getCurrentDivision,
        getCurrentDivisionTime: getCurrentDivisionTime,
        getDivisionParameters: getDivisionParameters
    };

    var configData;
    var currentUser;
    var currentDivision;
    var currentDivisionDate;
    var currentDivisionSysParams;
    var value;

    function getDivisionParameters(divisionId) {
        var defer = $q.defer();
            getOneMVApiURLPromise().then(function (oneMVURL) {
            if (oneMVURL && oneMVURL != "") {
                //get the base url from config.
                var _url = oneMVURL + 'division/' + divisionId + '/systemParameters?appType=desktop&rnd=' + new Date().getTime();
                $http({
                    method: 'GET',
                    url: _url
                }).then(function successCallback(response) {
                    if (response.data.status == 1) {
                        defer.resolve(response.data.result);
                    } else {
                        defer.reject(response.data.result);
                    }
                }, function errorCallback(response) {
                    defer.reject(response);
                });
            }
        });
        return defer.promise;
    }
   
    //function getOneMVApiURLPromise() {
    //    var _url = '../clientappsettings.json';
    //    var defer = $q.defer();
    //    if (!configData) {
    //        $http({
    //            method: 'GET',
    //            url: _url
    //        }).then(function successCallback(response) {
    //            //TBD
    //            configData = response.data
    //            defer.resolve(configData.ApiURLs.OneMVApiURL);
    //        }, function errorCallback(response) {
    //            //Error handling TBD
    //            defer.reject(response);
    //        });
    //    } else {
    //        defer.resolve(configData.ApiURLs.OneMVApiURL);
    //    }
    //    return defer.promise;
    //}
    function getOneMVApiURLPromise() {
       
        var defer = $q.defer();
       
        defer.resolve(env.oneMVApiUrl);
       
        return defer.promise;
    }
    function getOneMVApiURL() {
        return configData.ApiURLs.OneMVApiURL;
    }
    function resetUserAndDivision() {
        currentUser = null;
        currentDivision = null;
    }
    function getCurrentUser() {
        _url = '../Operation/GetCurrentUserDetails?rnd=' + new Date().getTime();
        var defer = $q.defer();
        if (!currentUser) {
            $http({
                method: 'GET',
                url: _url
            }).then(function successCallback(response) {
                currentUser = response.data;
                if (!currentDivision)
                    currentDivision = {};
                currentDivision = currentUser.Divisions[0];
                if (currentUser.CurrentLogin && currentUser.CurrentLogin.Division) {
                    currentDivision = currentUser.CurrentLogin.Division;

                }

                defer.resolve(currentUser);
            }, function errorCallback(response) {
                //Error handling TBD
                defer.reject(response);
            });
        } else {
            defer.resolve(currentUser);
        }
        return defer.promise;

    }
    function getCurrentDivision() {
        var _url = '../Operation/GetCurrentUserDetails?rnd=' + new Date().getTime();
        var defer = $q.defer();
        if (!currentDivision) {
            $http({
                method: 'GET',
                url: _url
            }).then(function successCallback(response) {
                currentUser = response.data;
                if (!currentDivision)
                    currentDivision = {};
                currentDivision = currentUser.Divisions[0];
                if (currentUser.CurrentLogin && currentUser.CurrentLogin.Division) {
                    currentDivision = currentUser.CurrentLogin.Division;
                }
                defer.resolve(currentDivision);
            }, function errorCallback(response) {
                //Error handling TBD
                defer.reject(response);
            });
        } else {
            defer.resolve(currentDivision);
        }
        return defer.promise;
    }
    function getCurrentDivisionTime() {
        var defer = $q.defer();
        var _url = '../Operation/GetCurrentDivisionTime?rnd=' + new Date().getTime();
        $http({
            method: 'GET',
            url: _url
        }).then(function successCallback(response) {
            currentDivisionDate = response.data;
            defer.resolve(currentDivisionDate);
        }, function errorCallback(response) {
            defer.reject(currentDivisionDate);
        });

        return defer.promise;
    }

    getOneMVApiURLPromise(); //One manual call to set the URL. To get the guaranteed url we need to use the promise method.
    return Factory;
}

})();

(function () {
    //debugger;
    'use strict';

    angular.module('oneMVApp').factory('DataValidationFactory', DataValidationFactory);
    DataValidationFactory.$inject = ['$log', '$window', '$http'];


    function DataValidationFactory($log, $window, $http) {
        var factory = {
            validateZipCode: validateZipCode,
            validateZipCodeNew: validateZipCodeNew

        };

        return factory;



        function doPostHttpRequest(url) {
            var googleUrl = url;
            return $http({
                url: googleUrl,
                method: 'GET',
                withCredentials: false
            })
        }

        function validateZipCodeNew(zip) {
            var googleUrl = "//maps.googleapis.com/maps/api/geocode/json?address=" + zip + "&sensor=true";
            return doPostHttpRequest(googleUrl);
        }

        function validateZipCode(zip, vm) {
            var stateCode;
            var state;
            var googleUrl = "//maps.googleapis.com/maps/api/geocode/json?address=" + zip + "&sensor=true";
            return $http({
                method: 'GET',
                url: googleUrl,
                withCredentials: false
            }).then(function successCallback(response) {
                // this callback will be called asynchronously

                if (response.data != null) {
                    var addressComponents = response.data.results[0].address_components;

                    stateCode = addressComponents[addressComponents.length - 2].short_name;
                    state = addressComponents[addressComponents.length - 2].long_name;
                }
                if (stateCode != '') {
                    vm.stateabbr = stateCode;

                    return stateCode;
                } else
                    return '';

            }, function errorCallback(response) {
                return "N/A";
                // $scope.err = response;
                // called asynchronously if an error occurs
                // or server returns response with an error status.
            });
        }
    }

})();


(function () {
    'use strict';
    //debugger

    angular
        .module('oneMVApp')
        .factory('DateFactory', DateFactory);

    DateFactory.$inject = ['$log', 'UtilityFactory', '$rootScope'];

function DateFactory($log, UtilityFactory, $rootScope) {
    var factory = {
        getCustomTime: getCustomTime,
        getDateFromCustomTime: getDateFromCustomTime,
        getPreviousDate: getPreviousDate,
        getTimeDifference: getTimeDifference,
        isDayLightsavingOn: isDayLightsavingOn,
        getMinutesFromTimeString: getMinutesFromTimeString,
        getPromiseWindowTimeDisplay: getPromiseWindowTimeDisplay,
        getPromiseWindowEndTime: getPromiseWindowEndTime
        
    };

    return factory;

    //get difference in minutes from given dateTime and current browser datetime
    function getTimeDifference(divisionDate) {
        var today = new Date();
        var serverDate = new Date(Date.parse(divisionDate));  //get the date in correct format for Date function

        var difference = today - serverDate;

        //convert difference from milliseconds to minutes
        if (Math.abs(difference / 1000 / 60) < 1)
            difference = 0
        else {
            if (difference < 0)
                difference = Math.floor(difference / 1000 / 60);
            else
                difference = Math.ceil((difference / 1000) / 60)
        }
        //we only care if the time is 1 minute less or 1 minute more than should be because of rounding
        if (Math.abs(difference) % 10 > 0) {
            if (difference < 0) {
                if (Math.abs(difference) % 10 == 1)
                    difference = difference + 1;
                if (Math.abs(difference) % 10 == 9)
                    difference = difference - 1;
            }

            else {
                if (Math.abs(difference) % 10 == 1)
                    difference = difference - 1;
                if (Math.abs(difference) % 10 == 9)
                    difference = difference + 1;
            }
        }
        return difference;
    }

    // 33 hr display logic
    function getCustomTime(dateToRender, serviceDate) {
        var _customTime = "";

        try {
            if (dateToRender && serviceDate) {
                var _hrsToAdd = moment(dateToRender).hours();
                if (moment(dateToRender).date() != moment(serviceDate).date()) {
                    //Add the difference days * 24. Generic solution to handle more than 33 hrs.
                    var _diff = moment(dateToRender).diff(moment(serviceDate), 'days');
                    _hrsToAdd = _hrsToAdd + (_diff * 24);
                }
                if (_hrsToAdd < 0 && _hrsToAdd > -10)
                    _hrsToAdd = "-0" + (_hrsToAdd * -1)//When service date is less than datetoRender
                if (_hrsToAdd < 10)
                    _hrsToAdd = "0" + _hrsToAdd;

                _customTime = _hrsToAdd + ":" + moment(dateToRender).format('mm');
            }
        }
        catch (err) {
            console.log(err)
        }

        return _customTime
    };

    // Reverse of getCustomTime function
    // Using custom time and service date calculate the actual date
    // We need to figure out based on division so get difference from division time and adjust time accordingly
    function getDateFromCustomTime(customTime, serviceDate) {
        var date;
        var diff_Minutes;
        var _serviceDate;
        var difference = $rootScope.timeDifference;


        //Handling both moment date and native JS date format
        if (serviceDate._isAMomentObject)
            _serviceDate = serviceDate.startOf('day')
        else
            _serviceDate = serviceDate.setHours(0, 0, 0);
        if (typeof customTime == "string") {
            if (customTime.indexOf(':') == -1) {
                diff_Minutes = (parseInt(customTime[0] + customTime[1])) * 60 + parseInt(customTime[2] + customTime[3]);
                if (difference) {
                    diff_Minutes = diff_Minutes + difference;
                }
            }
            else if (customTime.indexOf(':') == 2) {
                diff_Minutes = (parseInt(customTime[0] + customTime[1])) * 60 + parseInt(customTime[3] + customTime[4]);
                if (difference) {
                    diff_Minutes = diff_Minutes + difference;
                }
            }
        } else if (typeof customTime == "date") {
            //handle date time
        }


        if (diff_Minutes) {
            date = moment(_serviceDate).add(diff_Minutes, 'm');
        }
        else {
            $log.error("getDateFromCustomTime: Time is invalid!, Cannot calulate actual time");
            $log.log("error details", "getDateFromCustomTime customTime: " + customTime);
            $log.log("error details", "getDateFromCustomTime serviceDate: " + _serviceDate);
        }
        return date;

    }
    function getPreviousDate(date) {
        if (date == null) date = new Date();
        date.setDate(date.getDate() - 1);
        return date;
    }
    function isDayLightsavingOn() {
        var today = new Date();
        var january = new Date(today.getFullYear(), 0, 1);
        var july = new Date(today.getFullYear(), 6, 1);
        var timezoneDiff = Math.max(january.getTimezoneOffset(), july.getTimezoneOffset());
        return today.getTimezoneOffset() < timezoneDiff;
    }

    function getMinutesFromTimeString(timeString) {
        var diff_Minutes = 0;
        if (typeof timeString == "string") {
            if (timeString.indexOf(':') == -1) {
                diff_Minutes = (parseInt(timeString[0] + timeString[1])) * 60 + parseInt(timeString[2] + timeString[3]);
            }
            else if (timeString.indexOf(':') == 2) {
                diff_Minutes = (parseInt(timeString[0] + timeString[1])) * 60 + parseInt(timeString[3] + timeString[4]);
            }
            return diff_Minutes;
        }
    }
  
    function getPromiseWindowTimeDisplay(scheduleTime, promiseWindow, serviceDate) {
        var scheduleTimeView = getCustomTime(scheduleTime, serviceDate);
        var formatDate = moment(scheduleTime).add(promiseWindow, 'minutes');
        var promiseWindowTime = scheduleTimeView + "-" + getCustomTime(formatDate, serviceDate);
        return promiseWindowTime;
    }

    //windowStartTime is expected to be in ISO string format
    //promiseWindow in minutes
    function getPromiseWindowEndTime(windowStartTime, promiseWindow) {
        var oldDateObj = moment(windowStartTime);
        var newDateObj = oldDateObj.add('m', promiseWindow);
        return newDateObj.format();
    }
};
})();
(function () {

    'use strict';

    angular.module('oneMVApp').factory('LocationFactory', LocationFactory);

    LocationFactory.$inject = ['$http', '$q', 'ConfigFactory', 'authService'];

    function LocationFactory($http, $q, ConfigFactory, authService) {

    var locationFrom = [];
    var locationTo = [];
    var AdLocationFrom = [];
    var AdLocationTo = [];
    var GoogleLocationFrom = [];
    var GoogleLocationTo = [];
    var addressRest = '';
    var locationFilter = '';
    var factory = {
        setadd: stt,
        getLocations: getLocations,
        findClosestLocation: findClosestLocation
    };

    return factory;

    function stt(newName) {
        addressRest = newName;

    }
    function setLocationFilter(filterStatus) {
        locationFilter = filterStatus;
    }

    function getAddress(AdLocationFrom, loc) {
        var addressDetails = "";
        if (loc) {
        	//var addressDetails = AdLocationFrom[loc].IsManuallyAdded ? (AdLocationFrom[loc].Name).toUpperCase() : '';
        	if (AdLocationFrom[loc].Name)
        		addressDetails = AdLocationFrom[loc].Name.toUpperCase();
        	if (AdLocationFrom[loc].AliasNames)
        		addressDetails = addressDetails + " (" + AdLocationFrom[loc].AliasNames + ")";
        }
        return addressDetails;
    }

    //move to UtilityFactory (may be)
    function isNullOrEmpty(input) {
        if (angular.isUndefined(input) || input === null || input == '')   //angular.equals(input, {});//empty object comparison
            return true;
        else
            return false;
    }

    function findClosestLocation(myposition, locations) {

        for (var i = 0; i < locations.length; i++) {
            locations[i].distance = rectilinearHaversine(myposition, locations[i].loc);
        }
        locations.sort(function (a, b) {
            return a.distance - b.distance;

        })
        return locations[0];
    }
    function haversineFormula(gpsLoc, bldg) {
        //position1 =  vm.position
        //position2 = stop
        var lat1 = gpsLoc.Latitude;
        var lon1 = gpsLoc.Longitude;
        var lat2 = bldg.Latitude;
        var lon2 = bldg.Longitude

        var R = 6371; // km 
        var x1 = lat2 - lat1;
        var dLat = x1 * Math.PI / 180;
        var x2 = lon2 - lon1;
        var dLon = x2 * Math.PI / 180;
        var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                        Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                        Math.sin(dLon / 2) * Math.sin(dLon / 2);
        var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        var d = R * c * 0.62137; //convert to miles
        return d.toFixed(2);
    }

    function rectilinearHaversine(loc1, loc2) {
        var tempPoint = {
            "Latitude": loc1.Latitude,
            "Longitude": loc2.Longitude
        }

        var d1 = parseFloat(haversineFormula(loc1, tempPoint));
        var d2 = parseFloat(haversineFormula(tempPoint, loc2));
        return (d1 + d2).toFixed(2);
    }


    function checkIfValid(address) {
        for (var i in address.address_components) {
            if (address.address_components[i].types[0] == "street_number") {
                return true;
            }
        }
        return false;
    }
    // this is the only function that will be in use for both from and to locations, when the directive is in place.
    //The above 2 functions are only for the existing functionality, they can be cleaned up once the new advanced reservation is ready

    function getLocations(SearchTerm, locationfilter, divisionId, passengerId, googleOnly) {
        var defer = $q.defer();
        var locationData = [];
        if (googleOnly == true || googleOnly == "true") {
        	$http.get('https://maps.googleapis.com/maps/api/geocode/json', {
        		params: {
        			address: SearchTerm + ' ' + addressRest,
        			sensor: true,
        			key: 'AIzaSyCztqRTaQzgBxu0DMV9cDKq0IciqMaQI5E'
        		},
        		withCredentials: false,
        		skipAuthorization: true
        	}).then(function successCallback(response) {
        		GoogleLocationFrom = response.data.results;
        		for (var loc in GoogleLocationFrom) {
        		    if (checkIfValid(GoogleLocationFrom[loc])) {
        		        locationData.push(
                        {
                            address: GoogleLocationFrom[loc].formatted_address,
                            isGoogleLocation: true,
                            loc: GoogleLocationFrom[loc],
                            description: GoogleLocationFrom[loc].Name,
                            title: GoogleLocationFrom[loc].formatted_address
                        });
        		    }
        		}
        		defer.resolve({ "data": locationData });
        	});
        } else {
        	ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
        		if (oneMVURL && oneMVURL != "") {
        			var serviceUrl = oneMVURL + "location/" + divisionId + "/?SearchTerm=" + SearchTerm;

        			$http.get(serviceUrl)
			   .then(function successCallback(response) {
			   	AdLocationFrom = response.data.result;
			   	for (var loc in AdLocationFrom) {
			   		locationData.push(
						 {
						 	name: AdLocationFrom[loc].Name,
						 	address: AdLocationFrom[loc].Address +
                                 (!isNullOrEmpty(AdLocationFrom[loc].City) ? ", " + AdLocationFrom[loc].City : " ") +
                                 (!isNullOrEmpty(AdLocationFrom[loc].Zip) ? ", " + AdLocationFrom[loc].Zip : ""),
						 	isGoogleLocation: false,
						 	loc: AdLocationFrom[loc],
						 	title: getAddress(AdLocationFrom, loc),
						 	description: AdLocationFrom[loc].Address +
                                 (!isNullOrEmpty(AdLocationFrom[loc].City) ? ", " + AdLocationFrom[loc].City : " ") +
                                 (!isNullOrEmpty(AdLocationFrom[loc].Zip) ? ", " + AdLocationFrom[loc].Zip : "")
						 });
			   	}
			   	if (locationFilter == false || locationFilter == "false") {
			   		defer.resolve({ "data": locationData });
			   		return defer.promise;
			   	}
			   	else if (locationFilter == true || locationFilter == "true") {

			   		$http.get('https://maps.googleapis.com/maps/api/geocode/json', {
			   			params: {
			   				address: SearchTerm + ' ' + addressRest,
			   				sensor: true,
			   				key: 'AIzaSyCztqRTaQzgBxu0DMV9cDKq0IciqMaQI5E'
			   			},
			   			withCredentials: false,
			   			skipAuthorization: true
			   		}).then(function successCallback(response) {
			   			GoogleLocationFrom = response.data.results;
			   			for (var loc in GoogleLocationFrom) {
			   			    if (checkIfValid(GoogleLocationFrom[loc])) {
			   			        locationData.push(
                                     {
                                         address: GoogleLocationFrom[loc].formatted_address,
                                         isGoogleLocation: true,
                                         loc: GoogleLocationFrom[loc],
                                         description: GoogleLocationFrom[loc].Name,
                                         title: GoogleLocationFrom[loc].formatted_address
                                     });
			   			    }
			   			}
			   			defer.resolve({ "data": locationData });
			   		}, function errorCallback(err) {
			   			defer.reject(err);
			   		});
			   	}
			   }, function errorCallback(err) {
			   	defer.reject(err);
			   });


        		}
        	}, function errorhandler(err) {
        	});
        	setLocationFilter(locationfilter);
        }
        return defer.promise;
    };
}

})();
(function () {
    'use strict';

    angular.module('oneMVApp').factory('SecurityFactory', SecurityFactory);
    SecurityFactory.$inject = ['$http', '$q', '$cacheFactory', 'securityService'];


    function SecurityFactory($http, $q, $cacheFactory, securityService) {
        var _permissions = {};
        var cache = $cacheFactory("PermissionsCache");
        var service = {
            getPermissions: getPermissions,
            getLoadedPermissions: getLoadedPermissions,
            setupSession: setupSession
        };
        return service;

        function getPermissions(userId, divisionid) {
            var defer = $q.defer();
            _permissions = cache.get("permissions");
            if (_permissions) {
                defer.resolve(_permissions);
            } else {
                securityService.getPermissions(userId, divisionid).then(function (permissions) {
                    cache.put("permissions", permissions);
                    defer.resolve(permissions);
                });
            }
            return defer.promise;
        };

        function setupSession(userId, divisionid) {
            return securityService.setupSession(userId, divisionid);
        };

        function getLoadedPermissions() {
            return cache.get("permissions");
        };
    }


})();



(function () {

    'use strict';

    angular.module('oneMVApp').factory('UtilityFactory', UtilityFactory);
    UtilityFactory.$inject = ['$log', '$window'];
    function UtilityFactory($log, $window) {


        var service = {

            getData: getData,
            setData: setData,
            getAPIBaseUrl: getAPIBaseUrl,

            toastError: toastError,
            toastInfo: toastInfo,
            toastSuccess: toastSuccess,
            toastWarning: toastWarning,

            logError: logError,
            logInfo: logInfo,
            logSuccess: logSuccess,
            logWarning: logWarning,

            log: $log.log,

            getUsStates: getUsStates,
            getBrowserInfo: getBrowserInfo,

            isChrome: isChrome,
            isIE: isIE,
            isFirefox: isFirefox,
            isSafari: isSafari,

            usStates: [
                 {
                     "name": "Alabama",
                     "abbreviation": "AL"
                 },
                 {
                     "name": "Alaska",
                     "abbreviation": "AK"
                 },
                 {
                     "name": "American Samoa",
                     "abbreviation": "AS"
                 },
                 {
                     "name": "Arizona",
                     "abbreviation": "AZ"
                 },
                 {
                     "name": "Arkansas",
                     "abbreviation": "AR"
                 },
                 {
                     "name": "California",
                     "abbreviation": "CA"
                 },
                 {
                     "name": "Colorado",
                     "abbreviation": "CO"
                 },
                 {
                     "name": "Connecticut",
                     "abbreviation": "CT"
                 },
                 {
                     "name": "Delaware",
                     "abbreviation": "DE"
                 },
                 {
                     "name": "District Of Columbia",
                     "abbreviation": "DC"
                 },
                 {
                     "name": "Federated States Of Micronesia",
                     "abbreviation": "FM"
                 },
                 {
                     "name": "Florida",
                     "abbreviation": "FL"
                 },
                 {
                     "name": "Georgia",
                     "abbreviation": "GA"
                 },
                 {
                     "name": "Guam",
                     "abbreviation": "GU"
                 },
                 {
                     "name": "Hawaii",
                     "abbreviation": "HI"
                 },
                 {
                     "name": "Idaho",
                     "abbreviation": "ID"
                 },
                 {
                     "name": "Illinois",
                     "abbreviation": "IL"
                 },
                 {
                     "name": "Indiana",
                     "abbreviation": "IN"
                 },
                 {
                     "name": "Iowa",
                     "abbreviation": "IA"
                 },
                 {
                     "name": "Kansas",
                     "abbreviation": "KS"
                 },
                 {
                     "name": "Kentucky",
                     "abbreviation": "KY"
                 },
                 {
                     "name": "Louisiana",
                     "abbreviation": "LA"
                 },
                 {
                     "name": "Maine",
                     "abbreviation": "ME"
                 },
                 {
                     "name": "Marshall Islands",
                     "abbreviation": "MH"
                 },
                 {
                     "name": "Maryland",
                     "abbreviation": "MD"
                 },
                 {
                     "name": "Massachusetts",
                     "abbreviation": "MA"
                 },
                 {
                     "name": "Michigan",
                     "abbreviation": "MI"
                 },
                 {
                     "name": "Minnesota",
                     "abbreviation": "MN"
                 },
                 {
                     "name": "Mississippi",
                     "abbreviation": "MS"
                 },
                 {
                     "name": "Missouri",
                     "abbreviation": "MO"
                 },
                 {
                     "name": "Montana",
                     "abbreviation": "MT"
                 },
                 {
                     "name": "Nebraska",
                     "abbreviation": "NE"
                 },
                 {
                     "name": "Nevada",
                     "abbreviation": "NV"
                 },
                 {
                     "name": "New Hampshire",
                     "abbreviation": "NH"
                 },
                 {
                     "name": "New Jersey",
                     "abbreviation": "NJ"
                 },
                 {
                     "name": "New Mexico",
                     "abbreviation": "NM"
                 },
                 {
                     "name": "New York",
                     "abbreviation": "NY"
                 },
                 {
                     "name": "North Carolina",
                     "abbreviation": "NC"
                 },
                 {
                     "name": "North Dakota",
                     "abbreviation": "ND"
                 },
                 {
                     "name": "Northern Mariana Islands",
                     "abbreviation": "MP"
                 },
                 {
                     "name": "Ohio",
                     "abbreviation": "OH"
                 },
                 {
                     "name": "Oklahoma",
                     "abbreviation": "OK"
                 },
                 {
                     "name": "Oregon",
                     "abbreviation": "OR"
                 },
                 {
                     "name": "Palau",
                     "abbreviation": "PW"
                 },
                 {
                     "name": "Pennsylvania",
                     "abbreviation": "PA"
                 },
                 {
                     "name": "Puerto Rico",
                     "abbreviation": "PR"
                 },
                 {
                     "name": "Rhode Island",
                     "abbreviation": "RI"
                 },
                 {
                     "name": "South Carolina",
                     "abbreviation": "SC"
                 },
                 {
                     "name": "South Dakota",
                     "abbreviation": "SD"
                 },
                 {
                     "name": "Tennessee",
                     "abbreviation": "TN"
                 },
                 {
                     "name": "Texas",
                     "abbreviation": "TX"
                 },
                 {
                     "name": "Utah",
                     "abbreviation": "UT"
                 },
                 {
                     "name": "Vermont",
                     "abbreviation": "VT"
                 },
                 {
                     "name": "Virgin Islands",
                     "abbreviation": "VI"
                 },
                 {
                     "name": "Virginia",
                     "abbreviation": "VA"
                 },
                 {
                     "name": "Washington",
                     "abbreviation": "WA"
                 },
                 {
                     "name": "West Virginia",
                     "abbreviation": "WV"
                 },
                 {
                     "name": "Wisconsin",
                     "abbreviation": "WI"
                 },
                 {
                     "name": "Wyoming",
                     "abbreviation": "WY"
                 }
            ]

        };

        return service;


        //  *************  base api URL  **********************************
        // This will be removed and moved to a ConfigFactory and to USE a JSON data 
        var apiBaseUrl = 'https://onemvapi-dev.mvtransit.com/api/';

        function getAPIBaseUrl() {
            return apiBaseUrl;
        }


        // *********   session    *******************

        //set default values 1st  --- not using to remove 
        //data['isDispatch'] = false;
        //data['isReporting'] = false;
        //data['isUserManagement'] = false;

        var data = {};




        function getData(key) {
            return data[key];
        };

        function setData(key, value) {
            data[key] = value;
        };



        // *************   ---    get browser information 

        function getBrowserInfo() {

            var userAgent = $window.navigator.userAgent;

            var browsers = { chrome: /chrome/i, safari: /safari/i, firefox: /firefox/i, ie: /internet explorer/i };

            for (var key in browsers) {
                if (browsers[key].test(userAgent)) {
                    return key;
                }
            };

            return 'unknown';

        }

        // *************   ---    detect browsers information 
        function isChrome() {
            return !!window.chrome && !!window.chrome.webstore;
        }
        function isIE() {
            return false || !!document.documentMode;
        }
        function isFirefox() {
            return typeof InstallTrigger !== 'undefined';
        }
        function isSafari() {
            return Object.prototype.toString.call(window.HTMLElement).indexOf('Constructor') > 0;
        }

        //  *********   Toaster    *******************

        function toastError(title, message, timeout) {
                
            timeout = timeout || 1000;
            toastr.error(message, title, { timeOut: timeout });

            $log.error('Error: - ' + title + '  - ' + message, '')
        }

        function toastInfo(title, message, timeout) {

            timeout = timeout || 1000;

            toastr.info(message, title, {
                timeOut: timeout
            });
        }

        function toastSuccess(title, message) {
            toastr.success(message, title);
            $log.debug('Success: - ' + title + '  - ' + message, '')
        }

        function toastWarning(title, message) {
            toastr.warning(message, title);
            $log.warn('Warning: - ' + title + '  - ' + message, '')
        }


        //  *********   Logging    *******************

        function logError(message, data) {
            $log.error('Error:' + message, data)
        }

        function logInfo(message, data) {
            $log.info('Info:' + message, data)
        }

        function logSuccess(message, data) {
            $log.debug('Success:' + message, data)
        }

        function logWarning(message, data) {
            $log.warn('Warning:' + message, data)
        }


        //  *********   US State    *******************


        function getUsStates() {
            //debugger;
            return service.usStates;
        }

    };

})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('authInterceptorService', authInterceptorService);

    authInterceptorService.$inject = ['$q', '$injector', '$location', '$rootScope', 'localStorageService'];

    function authInterceptorService($q, $injector,$location,$rootScope, localStorageService) {
        var authInterceptorServiceFactory = {};

        var _request = function (config) {

            config.headers = config.headers || {};


            if (!config.url.includes('https://maps.googleapis.com')) {
            	var authData = localStorageService.get('authorizationData');
            	if (authData) {
            		config.headers.Authorization = 'Bearer ' + authData.token;
            	}
            }

            return config;
        }

        var _responseError = function (rejection) {
            if (rejection.status === 401) {
                var authService = $injector.get('authService');
                var authData = localStorageService.get('authorizationData');

                authService.logOut().then(function () {
                    $rootScope.$broadcast('loggedout', null);
                    $location.path('/login');
                });
                
            }
            return $q.reject(rejection);
        }

        authInterceptorServiceFactory.request = _request;
        authInterceptorServiceFactory.responseError = _responseError;

        return authInterceptorServiceFactory;
    }
})();
(function () {
    'use strict';

    //var authApp = angular.module('authApp', []);

    angular
   .module('oneMVApp')
        .factory('authService', authService);

    authService.$inject = ['$rootScope','$http', '$q' ,'localStorageService', 'env'];

    function authService($rootScope, $http, $q, localStorageService, env) {
        var serviceBase = env.authServerUrl;
        var authServiceFactory = {};

        var _authentication = {
            isAuth: false,
            passengerId: "",
            userId: "",
            useRefreshTokens: false
        };

        var _externalAuthData = {
            provider: "",
            userName: "",
            externalAccessToken: "",
            firstName: "",
            lastName: ""
        };
       
        $rootScope.$on('loggedIn', function (data) {
            debugger;
            console.log('loggedIn', data);
            var msg = {};
            msg.type = "register_push";
            msg.alias = localStorage.getItem("ls.alias");
            msg.division = localStorage.getItem("ls.division");
            var authData = localStorage.getItem("ls.authorizationData");
            try{
                var authDataObj = JSON.parse(authData);
                msg.passengerId = authDataObj.passengerId;
                window.postMessage(JSON.stringify(msg));
            }catch(e){
                console.log("error calling push registration");
            }
        });
       
        var _saveRegistration = function (registration) {

            _logOut();

            return $http.post(serviceBase + 'account/register', registration).then(function (response) {
                return response;
            });

        };

        var _login = function (loginData) {

            var data = "grant_type=password&username=" + loginData.userName + "&password=" + loginData.password;

            if (loginData.useRefreshTokens) {
                data = data + "&client_id=" + "mobiWeb";
            }

            var deferred = $q.defer();

            $http.post(serviceBase + 'token', data, { headers: { 'Content-Type': 'application/x-www-form-urlencoded' } }).success(function (response) {

                if (loginData.useRefreshTokens) {
                    localStorageService.set('authorizationData',
                        {
                            token: response.access_token,
                            userName: loginData.userName,
                            refreshToken: response.refresh_token,
                            useRefreshTokens: true
                        });
                }
                else {
                    localStorageService.set('authorizationData',
                        {
                            token: response.access_token,
                            userName: loginData.userName,
                            refreshToken: "",
                            useRefreshTokens: false
                        });
                }
                _authentication.isAuth = true;
                _authentication.userName = loginData.userName;
                _authentication.useRefreshTokens = loginData.useRefreshTokens;

                deferred.resolve(response);

            }).error(function (err, status) {
                _logOut();
                deferred.reject(err);
            });

            return deferred.promise;

        };


        var _clearUpSession = function () {            

            localStorageService.remove('authorizationData');

            _authentication.isAuth = false;
            _authentication.passengerId = "";
            _authentication.useRefreshTokens = false;
            _authentication.userId = "";
            _authentication.loginProvider = "";
        }

        var _logOut = function () {

            var deferred = $q.defer();

            $http.post(env.authServerUrl + 'account/signout', {}).then(function (response) {

                _clearUpSession();

                deferred.resolve(response);
            }, function (err) {
                console.log('Unable to logout user.');
                deferred.reject(err);
        });
            return deferred.promise;
        };


        var _fillAuthData = function () {

            var authData = localStorageService.get('authorizationData');
            if (authData) {
                _authentication.isAuth = true;
                _authentication.useRefreshTokens = authData.useRefreshTokens;
                _authentication.userId = authData.userId;
                _authentication.passengerId = authData.passengerId;
                _authentication.loginProvider = authData.loginProvider;
        }

        };

        var _isLoggedIn = function () {
            var authData = localStorageService.get('authorizationData');
            if (authData && authData.userId !== "") return true;
            return false;
        }


        var _refreshToken = function () {
            var deferred = $q.defer();

            var authData = localStorageService.get('authorizationData');

            if (authData) {

                if (authData.useRefreshTokens) {

                    var data = "grant_type=refresh_token&refresh_token=" +authData.refreshToken + "&client_id=" +ngAuthSettings.clientId;

                    localStorageService.remove('authorizationData');

                    $http.post(serviceBase + 'token', data, { headers: { 'Content-Type': 'application/x-www-form-urlencoded' } }).success(function (response) {

                        localStorageService.set('authorizationData', {
                            token: response.access_token,
                            refreshToken: response.refresh_token,
                            useRefreshTokens: true,
                            loginProvider: response.loginProvider
                    });

                        deferred.resolve(response);

                    }).error(function (err, status) {
                        _logOut();
                        deferred.reject(err);
                });
            }
        }

            return deferred.promise;
        };
        var _checkUserHasRegistered = function (externalData) {
            var deferred = $q.defer();
            $http.get(serviceBase + 'account/CheckUserHasRegistered',
                            {
                                params:
                                    {
                                        provider: externalData.provider,
                                        providerKey: externalData.providerKey,
                                        divisionId: externalData.divisionId,
                                        userName: externalData.userName,
                                        divisionSupportsFeed: externalData.divisionSupportsFeed
                                    }
                            }).success(function (success) {
                                deferred.resolve(success);
                            }).error(function (err, status) {
                                deferred.reject(err);
                            });
            return deferred.promise;
        }
        var _obtainAccessToken = function (externalData) {

            var deferred = $q.defer();

            $http.get(serviceBase + 'account/ObtainLocalAccessToken',
                {
                    params:
                        {
                            provider: externalData.provider,
                            externalAccessToken: externalData.externalAccessToken,
                            divisionId: externalData.divisionId,
                            userName:externalData.userName
                        }
                })
                .success(function (response) {                    
                    localStorageService.set('authorizationData',
                        {
                            token: response.access_token,
                            refreshToken: "",
                            useRefreshTokens: false,
                            userId: response.userId,
                            passengerId: response.passengerId,
                            loginProvider: response.loginProvider
                        });

                _authentication.isAuth = true;
                _authentication.useRefreshTokens = false;
                _authentication.userId = response.userId;
                _authentication.passengerId = response.passengerId;
                _authentication.loginProvider = response.loginProvider;
                deferred.resolve(response);

            }).error(function (err, status) {
                _logOut();
                deferred.reject(err);
        });

            return deferred.promise;

        };

        var _registerExternal = function (registerExternalData) {

            var deferred = $q.defer();

            $http.post(serviceBase + 'account/registerexternal', registerExternalData).success(function (response) {

                localStorageService.set('authorizationData',
                    {
                        token: response.access_token,
                        refreshToken: "",
                        useRefreshTokens: false,
                        userId: response.userId,
                        passengerId: response.passengerId,
                        loginProvider: response.loginProvider
                    });

                _authentication.isAuth = true;
                _authentication.userId = response.userId;
                _authentication.useRefreshTokens = false;
                _authentication.passengerId = response.passengerId;
                _authentication.loginProvider = response.loginProvider;

                deferred.resolve(response);

            }).error(function (err, status) {
                _logOut();
                deferred.reject(err);
        });

            return deferred.promise;
        };

        function _registerOneMv(registrationObject)
        {
            var deferred = $q.defer();
            $http.post(serviceBase + 'account/Register', registrationObject).success(function (response) {

                localStorageService.set('authorizationData',
                    {
                        token: response.access_token,
                        refreshToken: "",
                        useRefreshTokens: false,
                        userId: response.userId,
                        passengerId: response.passengerId,
                        loginProvider: response.loginProvider
                    });

                _authentication.isAuth = true;
                _authentication.userId = response.userId;
                _authentication.useRefreshTokens = false;
                _authentication.passengerId = response.passengerId;
                _authentication.loginProvider = response.loginProvider;

                deferred.resolve(response);

            }).error(function (err, status) {
                _logOut();
                deferred.reject(err);
            });

            return deferred.promise;
        }
        function _loginOneMv(loginData)
        {
            var deferred = $q.defer();
            $http.post(serviceBase + 'account/LoginOneMv', loginData).success(function (response) {

                localStorageService.set('authorizationData',
                    {
                        token: response.access_token,
                        refreshToken: "",
                        useRefreshTokens: false,
                        userId: response.userId,
                        passengerId: response.passengerId,
                        loginProvider: response.loginProvider
                    });

                _authentication.isAuth = true;
                _authentication.userId = response.userId;
                _authentication.useRefreshTokens = false;
                _authentication.passengerId = response.passengerId;
                _authentication.loginProvider = response.loginProvider;

                deferred.resolve(response);

            }).error(function (err, status) {
                _logOut();
                deferred.reject(err);
            });

            return deferred.promise;
        }

        function _verifyCaptcha(captcha) {
            var deferred = $q.defer();
            $http.post(serviceBase + 'account/VerifyCaptcha', '"' + captcha + '"').success(function (response) {

                deferred.resolve(response);

            }).error(function (err, status) {
                
                deferred.reject(err);
            });

            return deferred.promise;
        }
        authServiceFactory.saveRegistration = _saveRegistration;
        authServiceFactory.login = _login;
        authServiceFactory.logOut = _logOut;
        authServiceFactory.fillAuthData = _fillAuthData;
        authServiceFactory.authentication = _authentication;
        authServiceFactory.refreshToken = _refreshToken;

        authServiceFactory.obtainAccessToken = _obtainAccessToken;
        authServiceFactory.externalAuthData = _externalAuthData;
        authServiceFactory.registerExternal = _registerExternal;
        authServiceFactory.isLoggedIn = _isLoggedIn;
        authServiceFactory.loginOneMV = _loginOneMv;
        authServiceFactory.registerOneMV = _registerOneMv;
        authServiceFactory.verifyCaptcha = _verifyCaptcha;
        authServiceFactory.checkUserHasRegistered = _checkUserHasRegistered;

        return authServiceFactory;
    }
})();
(function () {
	'use strict';

	angular
        .module('oneMVApp')
        .factory('CommonService', CommonService);

	CommonService.$inject = ['$http', '$q', 'env'];

	function CommonService($http, $q, env) {
		var serviceBase = env.oneMVApiUrl;

		var service = {
		    GetAllStates: GetAllStates,
		    GetStatesWithDivisions: GetStatesWithDivisions,
		    ScheduleType: GetScheduleTypes()
		};

		return service;

		function GetAllStates() {
			var deferred = $q.defer();
			var url = serviceBase + 'common/GetAllStates';

			$http({
				method: 'GET',
				url: url + '?rnd=' + new Date().getTime(),
			}).then(function (response) {
				if (response.status == 200) {
					deferred.resolve(response.data.result);
				} else {
					deferred.reject(response);
				}
			}, function (err) {
				deferred.reject(err);
			});

			return deferred.promise;
		}
		function GetStatesWithDivisions()
		{
		    var deferred = $q.defer();
		    var url = serviceBase + 'common/GetStatesWithDivisions';

		    $http({
		        method: 'GET',
		        url: url + '?rnd=' + new Date().getTime(),
		    }).then(function (response) {
		        if (response.status == 200) {
		            deferred.resolve(response.data.result);
		        } else {
		            deferred.reject(response);
		        }
		    }, function (err) {
		        deferred.reject(err);
		    });

		    return deferred.promise;
		}

		function GetScheduleTypes() {
		    return Object.freeze({ 'Morning': 'AM', 'Evening': 'PM' });
		}

	}
})();

(function () {
    'use strict';

    var app = angular.module('oneMVApp');
    app.factory('CommunicationsService', CommunicationsService);
    CommunicationsService.$inject = ['$http', '$q', 'ConfigFactory'];

    function CommunicationsService($http, $q, ConfigFactory) {
        var service = {
            contactDriver: contactDriver
        };
        return service;

        function contactDriver(tripId) {
            var defer = $q.defer();
            ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
                if (oneMVURL && oneMVURL != "") {
                    //get the base url from config.
                    var _url = oneMVURL + "communications/contactdriver/" + tripId + "?rnd=" + new Date().getTime();
                    $http({
                        method: 'GET',
                        url: _url
                    }).then(function successCallback(response) {
                        if (response && response.data && response.data.status && (response.data.status == 1 || response.data.status == 2)) {
                            defer.resolve(response.data);
                        } else {
                          defer.reject(response);
                        }
                    }, function errorCallback(response) {
                        defer.reject(response);
                    });
                }
            });
            return defer.promise;
        }
    }
})();
//(function () {
//    'use strict';

//    angular
//        .module('oneMVApp')
//        .factory('DateUtilityService', DateUtilityService);

//    DateUtilityService.$inject = [];

//    function DateUtilityService() {
//        var service = {
//            addDays: addDays,
//            getWeek: getWeek,
//            getDayOfYear: getDayOfYear
//        };

//        return service;

//        function addDays(input, numOfDays) {
//            var dat = new Date(input);
//            dat.setDate(dat.getDate() + numOfDays);
//            return dat;
//        }

//        function getWeek(input) {
//            var date = new Date(input.getTime());
//            date.setHours(0, 0, 0, 0);
//            // Thursday in current week decides the year.
//            date.setDate(date.getDate() + 3 - (date.getDay() + 6) % 7);
//            // January 4 is always in week 1.
//            var week1 = new Date(date.getFullYear(), 0, 4);
//            // Adjust to Thursday in week 1 and count number of weeks from date to week1.
//            return 1 + Math.round(((date.getTime() - week1.getTime()) / 86400000
//                                  - 3 + (week1.getDay() + 6) % 7) / 7);
//        }

//        function getDayOfYear(input) {
//            var now = new Date(input);
//            var start = new Date(now.getFullYear(), 0, 0);
//            var diff = (now - start) + ((start.getTimezoneOffset() - now.getTimezoneOffset()) * 60 * 1000);
//            var oneDay = 1000 * 60 * 60 * 24;
//            var day = Math.floor(diff / oneDay);
//            return day;
//        }
//    }
//})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('DivisionService', DivisionService);

    DivisionService.$inject = [ '$http', '$q', '$rootScope', 'localStorageService', 'env', 'authService'];

    function DivisionService($http, $q, $rootScope,  localStorageService, env, authService) {
        var service = {
            setDivision: _setDivision,
            getDivisionInfo: _getDivisionInfo,            
            getDivisions: _getAllDivisions,
            getDivisionId: _getDivisionIdFromLocalStorage,
            getTimeZone: _getTimeZoneFromLocalStorage,            
            getAllowedServices: _getAllowedServicesFromLocalStorage,
            getDivisionAlias: _getDivisionAliasFromLocalStorage,
            getSupportPhoneNumber: _getSupportPhoneNumberFromLocalStorage,
            getSystemParameters: _getSystemParametersFromLocalStorage,
            getServiceDateByDivisionTime: _getServiceDateByDivisionTime,
            getCurrentDivisionTime: _getCurrentDivisionTime,
            getDivisionByState: _getDivisionByState,
            getDivisionsByLocation: _getDivisionsByLocation,
            isWaitlistAllowedByDivision: _isWaitlistAllowedByDivision
        };

        return service;

        function _getCurrentDivisionTime() {
            var deferred = $q.defer();
            $http({
                method: 'GET',
                'url': env.oneMVApiOrgUrl + 'division/' + _getDivisionIdFromLocalStorage() + '/currentTime?rnd=' + new Date().getTime()
            }).then(function (response) {
                if (response.data.status == 1 && response.data.result) {                    
                    deferred.resolve(response);
                }
                else deferred.reject();
            }, function (err) {
                deferred.reject();
            });
            return deferred.promise;
        }



        function _setDivision(inputAlias) {
            var deferred = $q.defer();

			// get division info
            $http({
                method: 'GET',
                'url': env.oneMVApiUrl + 'division/v1?alias=' + inputAlias
            }).then(function (response) {
                if (response.data.status == 1 && response.data.result) {
                    var hasDivisionChanged = _hasDivisionChanged(inputAlias);
                	var division = response.data.result;

                	// get division system parameters
                    $http({
                    	method: 'GET',
                    	'url': env.oneMVApiUrl + '/division/' + division.DivisionID +'/systemParameters?appType=Desktop'
                    }).then(function (paramResponse) {
                    	if (paramResponse.status == 200) {
                    		division.SystemParameters = paramResponse.data.result;
							// convert boolean text to boolean
                    		for (var param in division.SystemParameters) {
                    			var value = division.SystemParameters[param];
                    			if (value != null) {
                    				value = value.toLowerCase();
                    				if (value == "true") {
                    					division.SystemParameters[param] = true;
                    				} else if (value == "false") {
                    					division.SystemParameters[param] = false;
                    				}
                    			}
                    		}

                    	    // remember division properties for future access
                    		_setDivisionProperties(division);
                    		_setServices(response);

                    		_broadcastDivisionChanged(hasDivisionChanged);
                    		deferred.resolve(response);
                    	}
                    	else deferred.reject('division not found');
                    }, function (err) {
                    	deferred.reject('division not found');
                    });
                }
                else deferred.reject('division not found');
            }, function (err) {
                deferred.reject('division not found');
            });

            return deferred.promise;
        }
        
        function _hasDivisionChanged(inputAlias) {
            var localStorageAlias = _getDivisionAliasFromLocalStorage();
            
            if(angular.isUndefined(localStorageAlias) 
                ||  localStorageAlias === null 
                || localStorageAlias.trim() === '') 
                return true;

            return inputAlias.toLowerCase() !== localStorageAlias.toLowerCase();
        }

        function _getDivisionInfo() {            

            var deferred = $q.defer();
            $http({
                method: 'GET',
                'url': env.oneMVApiUrl + 'division/' + _getDivisionIdFromLocalStorage()
            }).then(function (response) {
                if (response.data.status == 1 && response.data.result) {
                    _setServices(response);
                    deferred.resolve(response);
                }
                else deferred.reject();
            }, function (err) {
                deferred.reject();
            });
            return deferred.promise;
        }

        function _getAllDivisions() {
            var deferred = $q.defer();
            $http({
                method: 'GET',
                'url': env.oneMVApiUrl + 'division/all/v1'
            }).then(function (response) {
                if (response.data.status == 1 && response.data.result) {                   
                    deferred.resolve(response);
                }
                else deferred.reject();
            }, function (err) {
                deferred.reject();
            });
            return deferred.promise;                     
        }

        function _getServiceDateByDivisionTime(divisionId, divisionTime) {
            var deferred = $q.defer();
            $http({
                method: 'GET',
                'url': env.oneMVApiUrl + 'division/' + divisionId + '/' + divisionTime + '/serviceDateByDivisionTime?rnd=' + new Date().getTime()
            }).then(function (response) {
                if (response.data.status == 1 && response.data.result) {
                    deferred.resolve(response);
                }
                else deferred.reject();
            }, function (err) {
                deferred.reject();
            });
            return deferred.promise;
        }
        function _getDivisionByState(stateCode)
        {
            var deferred = $q.defer();
            $http({
                method: 'GET',
                'url': env.oneMVApiUrl + 'division/GetDivisionsByState/' + stateCode + '?rnd=' + new Date().getTime()
            }).then(function (response) {
                if (response.data.status == 1 && response.data.result) {
                    deferred.resolve(response);
                }
                else deferred.reject();
            }, function (err) {
                deferred.reject();
            });
            return deferred.promise;
        }

        function _getDivisionsByLocation(latitude, longitude)
        {
            var deferred = $q.defer();
            $http({
                method: 'GET',
                'url': env.oneMVApiUrl + 'division/' + latitude + '/' + longitude + '/GetClosestDivisions?rnd=' + new Date().getTime()
            }).then(function (response) {
                if (response.data.status == 1 && response.data.result) {
                    deferred.resolve(response);
                }
                else deferred.reject();
            }, function (err) {
                deferred.reject();
            });
            return deferred.promise;
        }
        function _setDivisionProperties(division) {
            localStorageService.set('division', division.DivisionID);
            localStorageService.set('timeZone', division.TimeZone);
            //localStorageService.set('allowedServices', division.AllowedServices.toLowerCase());
            //
            // Test stuf because it is broken. 
            // Do not publish this.
            //
            if (division.CommuterDivisionId == null) {
                var mapCommuterDivisionId = '';
                var divisionID = division.DivisionID;
                switch (divisionID) {
                    case '206':
                        mapCommuterDivisionId = '206'
                        break;
                    case '1001':
                        mapCommuterDivisionId = '1001.1'
                        break;
                    case '1002':
                        mapCommuterDivisionId = '1002.1'
                        break;
                    case '1003':
                        mapCommuterDivisionId = '1003.1'
                        break;
                    case '1004':
                        mapCommuterDivisionId = '1004.1'
                        break;
                    case '1005':
                        mapCommuterDivisionId = '1005.1'
                        break;
                    default:
                        mapCommuterDivisionId = '-999'
                        break;
                }; division.CommuterDivisionId = mapCommuterDivisionId;
            }
            localStorageService.set('cid', division.CommuterDivisionId);
            localStorageService.set('supportPhoneNumber', division.SupportPhoneNumber);
            localStorageService.set('alias', division.Alias);
            localStorageService.set('systemParameters', division.SystemParameters);
        }

        function _setServices(response) {
            var serviceInfo = [];    
            for (var i = 0; i < response.data.result.DivisionServices.length; i++) {
                var svcInfo =   response.data.result.DivisionServices[i].Service;              
                serviceInfo.push(
                    {
                        id: svcInfo.Id,
                        name:svcInfo.Name,
                        alias: response.data.result.DivisionServices[i].Alias || svcInfo.Name
                    });
                }
            localStorageService.set("serviceInfo",serviceInfo);            
        }

        function _broadcastDivisionChanged(hasDivisionChanged) {
            if (authService.isLoggedIn() && hasDivisionChanged) {
                authService
                    .logOut()
                    .then(function () {
                        $rootScope.$broadcast('divisionChanged');
                    });
            }
            else if (hasDivisionChanged)
            {
                // only broadcast if the division has actually changed.
                $rootScope.$broadcast('divisionChanged');
            }

                
        }

        function _getTimeZoneFromLocalStorage() {
            return localStorageService.get('timeZone');
        }

        function _getDivisionIdFromLocalStorage() {
            return localStorageService.get('division');
        }

        function _getAllowedServicesFromLocalStorage() {
            return localStorageService.get('serviceInfo');
        }

        function _getDivisionAliasFromLocalStorage() {
            return localStorageService.get('alias');
        }

        function _getSupportPhoneNumberFromLocalStorage() {
        	return localStorageService.get('supportPhoneNumber');
        }

        function _getSystemParametersFromLocalStorage() {
        	return localStorageService.get('systemParameters');
        }    
             
        function _isWaitlistAllowedByDivision() {

            var deferred = $q.defer();
            $http({
                method: 'GET',
                'url': env.oneMVApiOrgUrl + 'division/' + _getDivisionIdFromLocalStorage()
                        + '/systemParameters/allowcommuterwaitlist' + '?rnd=' + new Date().getTime()
            }).then(function (response) {
                if (response.data.status == 1 && response.data.result) {
                    deferred.resolve(response.data.result == 'true');
                }
                else deferred.reject(false);
            }, function (err) {
                deferred.reject(false);
            });
            return deferred.promise;
        }

    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('DynamicContentService', DynamicContentService);

    DynamicContentService.$inject = ['$http', '$q', 'env', 'DivisionService'];

    function DynamicContentService($http, $q, env, DivisionService) {
        var service = {
            getWhatsNewData: getWhatsNewData,
            getData: getData,
            getSupportFAQ: getSupportFAQ
        };

        return service;

        function getSupportFAQ() {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiUrl + 'common/' + DivisionService.getDivisionId() + '/supportFAQ';
            $http({
                method: 'GET',
                'url': serviceUrl
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;
        }

        function getWhatsNewData() {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiOrgUrl + 'whatsNew/GetCurrentWhatsNewList/' + DivisionService.getDivisionId();
            $http({
                method: 'GET',
                'url': serviceUrl
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;
        }

        function getData(page) {
            var deferred = $q.defer();
            var serviceUrl = env.commuterApiUrl + 'common/' + DivisionService.getDivisionId() + '/dynamic/' + page;
            $http({
                method: 'GET',
                'url': serviceUrl
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('GeoLocationService', GeoLocationService);

    GeoLocationService.$inject = ['$rootScope','$q', '$window', '$timeout'];

    function GeoLocationService($rootScope, $q, $window, $timeout) {
        var service = {
            getCurrentPosition: getCurrentPosition
        };

        return service;

        function getCurrentPosition() {
            var deferred = $q.defer();
            //
            // We have multiple people calling this function to determine if GPS is turned on.
            // This is an issue in Android environment.  I added a Broadcast so that anyone can
            // listen to find out if GPS is turned on, or off.
            //
            if (!$window.navigator.geolocation) {
                $rootScope.$broadcast('GeoLocationService.gpsIsAvailable', { gpsIsEnabled: false, lastPosition: {}, timestamp: new Date() });
                deferred.reject('Geolocation not supported');
            } else {
               var timeoutPromise =  $timeout(function () {
                   deferred.reject('User cancelled');                   
                }, 10000);
                    $window.navigator.geolocation.getCurrentPosition(function (position) {
                        $rootScope.$broadcast('GeoLocationService.gpsIsAvailable', { gpsIsEnabled: true, lastPosition: position, timestamp: new Date() });
                        $timeout.cancel(timeoutPromise);
                        deferred.resolve(position);
                    }, function (err) {
                        $rootScope.$broadcast('GeoLocationService.gpsIsAvailable', { gpsIsEnabled: false, lastPosition: {}, timestamp: new Date() });
                        $timeout.cancel(timeoutPromise);
                        deferred.reject(err);
                    },{maximumAge: 0, enableHighAccuracy: true });
                
            }
            return deferred.promise;
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('LoginService', LoginService);

    LoginService.$inject = ['$http','$q','env'];

    function LoginService($http, $q,env) {
        var service = {
            authenticate: authenticate
        };

        return service;

        function authenticate(provider, returnUrl) {
            var deferred = $q.defer();
            var serviceUrl = env.commuterApiUrl + 'account/ExternalLogin?provider=' + provider + '&returnUrl=' + returnUrl;
            $http({
                method: 'POST',
                'url': serviceUrl,
                headers: {
                    'Content-Type': 'text/plain'
                },
                data: {}
            }).then(function (response) {
               
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('LuumLinkedService', LuumLinkedService);

    LuumLinkedService.$inject = ['$http', '$q', 'env','$rootScope','$uibModal','$location'];

    function LuumLinkedService($http, $q, env, $rootScope, $uibModal, $location) {

        var service = {
            verify: verify,
            getNewPassengerLuumLinkageInfo: getNewPassengerLuumLinkageInfo,
            displayNewPassengerMessage : displayNewPassengerMessage
        };

        return service;


        function displayNewPassengerMessage(message) {
             $uibModal.open({
            template: '<div class="modal-header" >' +
                            '<h3 class="modal-title">OneMV-LUUM Integration Info</h3>' +
                          ' </div>' +
                          '<div class="modal-body">' +
                            '<p>' +message + '</p>' +
                          '</div>' +
                          '<div class="modal-footer">' +
                          '<button class="btn btn-warning" type="button" ng-click="close()">OK</button>' +
                              ' </div>',
                                  replace : true,
                              controller: function ($scope, $uibModalInstance) {
                                  $scope.close = function () {
                                      $uibModalInstance.close();
                                      $location.replace().path('dashboard/');
                                      };
                                      },
                                          backdrop: 'static',
                                          keyboard: false
                                      });
        }

        function getNewPassengerLuumLinkageInfo(divisionId) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiOrgUrl + 'division/' + divisionId + '/newPassengerMessage';
            $http({
                method: 'GET',
                'url': serviceUrl
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;
        }


        function verify(passengerId) {
            var url = env.oneMVApiOrgUrl + 'passenger/luumLinkage/' + passengerId;
            return $http({
                method: 'GET',
                url: url + '?rnd=' + new Date().getTime()
            }).then(function (response) {

                if (response && response.data.status == 1) {
                    //execute iff, division need or current date has passed start date for applicable division.
                    if (response.data.result && response.data.result.verify) {
                        if (!response.data.result.isLinkedToLuum) {

                            var message = response.data.result.message;

                            $uibModal.open({
                                template: '<div class="modal-header" >' +
                                            '<h3 class="modal-title">OneMV-LUUM Integration Info</h3>' +
                                          ' </div>' +
                                          '<div class="modal-body">' +
                                            '<p>' + message + '</p>' +
                                          '</div>' +
                                          '<div class="modal-footer">' +
                                          '<button class="btn btn-warning" type="button" ng-click="close()">OK</button>' +
                                  ' </div>',
                                replace: true,
                                controller: function ($scope, $uibModalInstance) {
                                    $scope.close = function () {
                                        $uibModalInstance.close();

                                        if (response.data.result.disableCommuterNavigation) {
                                            var path = $location.path();
                                            if (path.indexOf('/commuter/selected-stop') > -1
                                                || path.indexOf('/passenger-trips') > -1
                                                || path.indexOf('/commuter/adv-schedule-setup') > -1
                                                || path.indexOf('/commuter/my-vehicles') > -1) {

                                                $rootScope.passengerNotified = true;
                                                $location.replace().path('dashboard/');
                                            }

                                            // return;
                                        }

                                    };
                                },
                                backdrop: 'static',
                                keyboard: false
                            });
                        }
                    }
                }
            }, function (err) {
            });
        }
    }
})();

(function () {

    'use strict';

    angular.module('oneMVApp')
    .factory('MapIconService', MapIconService);

    MapIconService.$inject = ['PortalUtilityService'];

    function MapIconService(PortalUtilityService) {                        

        var service = {
            getCommuterStopIcon : _getCommuterStopIcon,
            getCommuterHubIcon: _getCommuterHubIcon,
            getDrtPickupIcon: _getDrtPickupIcon,
            getDrtDropoffIcon: _getDrtDropoffIcon
        };

        function _getCommuterHubIcon() {
            return PortalUtilityService.isIE() ? 'images/pin-hub.png' : 'images/pin-hub.svg';
        }

        function _getCommuterStopIcon() {
            return PortalUtilityService.isIE() ? 'images/pin-busstop-green.png' : 'images/pin-busstop-green.svg';
        }

        function _getDrtPickupIcon() {
            return 'images/default/i-drt-pin-b.png';
        }

        function _getDrtDropoffIcon() {
            return 'images/default/i-drt-pin-g.png';
        }

        return service;
    }

})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('MapService', MapService);

    MapService.$inject = ['$timeout', 'uiGmapIsReady', 'googleMapsConfig'];

    function MapService($timeout, uiGmapIsReady, googleMapsConfig) {


        var _map = undefined;


        var service = {
            setMapBounds: setMapBounds,
            initializeMap: _setMap,
        };

        return service;

        function setMapBounds(markers, events) {

            if (angular.isUndefined(_map) || angular.isUndefined(markers) || markers.length == 0)
                return;

            var bounds = new google.maps.LatLngBounds();
            angular.forEach(markers, function (marker) {
                bounds.extend({
                    'lat': marker.latitude,
                    'lng': marker.longitude
                });
            });


            if (events) 
                _map.markerEvent = setMarkerEvents(events);

            _map.control.getGMap().fitBounds(bounds);
            _map.control.getGMap().setZoom(_map.control.getGMap().getZoom() - 1);
        }


        function _setMap() {

            _map = {
                center:
                    {
                        latitude: 47.6216026,
                        longitude: -122.342862
                    },
                zoom: 15,
                mapOptions: {
                    mapTypeControl: false,
                    zoomControl: false,
                    streetViewControl: false,
                    styles: googleMapsConfig.mapStyles
                },
                control: {},
            }
            return _map;
        }

        function setMarkerEvents(events) {
            var evntObj = {};

            angular.forEach(events, function (e) {
                if (e.event && typeof e.callback === 'function')
                    evntObj[e.event] = function (gMarker, eventName, model) {
                        if (model.$id) {
                            e.callback(model);
                        }
                    };
            });

            return evntObj;
        }

    }
})();

(function () {
	'use strict';

	angular
        .module('oneMVApp')
        .factory('MessageBox', MessageBox);

	MessageBox.$inject = ['$q', '$uibModal', '$uibModalStack'];

	function MessageBox($q, $uibModal, $uibModalStack) {
		var service = {
			info: info
		};

		return service;

		function info(title, message) {
			var template =
			'<div class="modal__content">\
				<div class="modal__header">\
					<h4 class="modal-title">' + title + '</h4>\
				</div>\
				<div class="modal__body">\
					<p>' + message + '</p>\
					<button type="button" ng-click="ok()" class="btn btn--primary">Ok</button>\
				</div>\
			</div>';

			var deferred = $q.defer();

			var messageBox = $uibModal.open({
				backdrop: false, // prevent user from dismissing messagebox by clicking background
				template: template,
				size:'-fs',
				controller: function ($scope) {
					$scope.ok = function () {
						$uibModalStack.dismissAll();
					};
				}
			}).closed.then(function () {
				deferred.resolve();
			});

			return deferred.promise;
		}
	}
})();

(function(){
    'use strict';

    angular
        .module('oneMVApp')
        .factory('OneMvServices',OneMvServices);

    OneMvServices.$inject = ['DivisionService'];

    function OneMvServices(DivisionService){
        var service = {
            getCommuterInfo :_getCommuterServiceInfo,
            getFixedRouteInfo :_getFixedRouteServiceInfo,
            getDrtInfo :_getDrtServiceInfo       
        };

        return service;

        function _getCommuterServiceInfo(){            
            return find('commuter');
        }

        function _getFixedRouteServiceInfo(){            
            return find('fixed');
        }

        function _getDrtServiceInfo(){
            return find('drt');    
        }

        function find(serviceName){
            var services = DivisionService.getAllowedServices() || [] ;

            for(var i = 0; i<services.length;i++){
                if(services[i].name.toLowerCase() == serviceName.toLowerCase())
                    return services[i];
            }

            return undefined;
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('PageService', PageService);

    PageService.$inject = [];

    function PageService() {
        var title = '';
        var headline = '';
        var product = '';
        return {
            title: function () { return title; },
            setTitle: function (newTitle) { title = newTitle; },

            headline: function () { return headline; },
            setHeadline: function (newHeadline) { headline = newHeadline; },

            product: function () { return product; },
            setProduct: function (newProduct) { product = newProduct; }
        };
    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('PasswordService', PasswordService);

    PasswordService.$inject = ['$http', '$q', 'env', 'DivisionService', 'authService'];

    function PasswordService($http, $q, env, DivisionService, authService) {
        var service = {
            ChangePassword: changePassword,
            VerifyAndUpdatePassword: updateAndVerifyPassword,
            SendPasscode: sendPasscode
        };

        return service;

        function updateAndVerifyPassword(verifyAndUpdateVM) {
            var deferred = $q.defer();
            var divisionId = DivisionService.getDivisionId();
            var url = env.oneMVApiUrl + 'password/' + divisionId + '/updatePasswordWithTempCode';
            $http({
                method: 'POST',
                url: url + '?rnd=' + new Date().getTime(),
                data: JSON.stringify(verifyAndUpdateVM)
            }).then(function (response) {
                deferred.resolve(response);  //put all hte if statments here also what to resolve.

            }, function (err) {
                deferred.reject(err);
            });

            return deferred.promise;
        }

        function changePassword(changePwdVM) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiUrl + "/passenger/" + authService.authentication.passengerId + "/changePassword";
            $http({
                method: 'POST',
                'url': serviceUrl + '?rnd=' + new Date().getTime(),
                headers: {
                    'Content-Type': 'text/json'
                },
                data: JSON.stringify(changePwdVM)
            }).then(function (response) {

                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;

        }

        function sendPasscode(email)
        {
            var deferred = $q.defer();
            var divisionId = DivisionService.getDivisionId();
            var serviceUrl = env.oneMVApiUrl + "password/"  + divisionId + "/sendTemporaryCode";
            //$http({
            //    method: 'POST',
            //    'url': serviceUrl + '?rnd=' + new Date().getTime(),
            //    data: JSON.stringify({ email })
            //})
            
            $http.post(serviceUrl, '"' + email + '"').then(function (response) {

                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;
        }

    }
    
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('PortalUtilityService', PortalUtilityService);

    PortalUtilityService.$inject = ['$window'];

    function PortalUtilityService($window) {
        var service = {
            hasValue: hasValue,
            isIE :isIE
        };

        return service;

        function hasValue(input) {
            return input != null && input != undefined && input != '';
        }


        function isIE() {
            return $window.navigator.userAgent.indexOf("Trident") > 0
                    || $window.navigator.userAgent.indexOf("MSIE") > 0;
        }
    }
})();
(function () {
	'use strict';

	angular
        .module('oneMVApp')
        .factory('ProfileService', ProfileService);

	ProfileService.$inject = ['$http', '$q', 'env', 'DivisionService', 'ConfigFactory', 'authService'];

	function ProfileService($http, $q, env, DivisionService, ConfigFactory, authService) {
		var serviceBase = env.oneMVApiUrl;

		var service = {
			// passenger profile, including home address
			GetProfile: GetProfile,
			UpdateProfile: UpdateProfile,
            GetPassengerAge: getPassengerAge,

			// home address only
			GetHomeAddress: GetHomeAddress,
			UpdateHomeAddress: UpdateHomeAddress,

			AllowEditHomeAddress: AllowEditHomeAddress,
			ShowHomeAddress: ShowHomeAddress,
			GetDefaultMobilityAids: GetDefaultMobilityAids
		};

		return service;

		// determine if home location should be displayed
		function ShowHomeAddress() {
			var divisionParameters = DivisionService.getSystemParameters();
			return divisionParameters.DropoffHomeLocationOnly;
		}

		// determine if the given passenger may change his home location
		function AllowEditHomeAddress() {
			var divisionParameters = DivisionService.getSystemParameters();
			var allowEditProfile = divisionParameters.DropoffHomeLocationOnly
				&& divisionParameters.DropoffHomeLocationEdit;
			return allowEditProfile;
		}

		function getPassengerAge(passengerId)
		{
		    var url = serviceBase + 'passenger/' + passengerId + '/age';

		    return $http({
		        method: 'GET',
		        url: url + '?rnd=' + new Date().getTime()
		    }).then(function (response) {
		        if (response.status == 200) {
		            return response;
		        }
		    }, function (err) {
		        throw err;
		    });
		}
		function GetHomeAddress(passengerId) {
			var url = serviceBase + 'passenger/GetHomeAddress/' + passengerId;

			return $http({
				method: 'GET',
				url: url + '?rnd=' + new Date().getTime()
			}).then(function (response) {
				if (response.status == 200) {
					return response.data.result;
				} else {
					return response;
				}
			}, function (err) {
				throw err;
			});
		}

		function GetProfile(passengerId) {
			var url = serviceBase + 'passenger/GetProfile/' + passengerId;

			return $http({
				method: 'GET',
				url: url + '?rnd=' + new Date().getTime()
			}).then(function (response) {
				if (response.status == 200) {
					return response.data.result;
				} else {
					return response;
				}
			}, function (err) {
				return null;
			});
		}

		function UpdateHomeAddress(passengerId, homeAddress) {
			return $http.post(serviceBase + 'passenger/UpdateHomeAddress/' + passengerId, homeAddress)
				.then(function (response) {
					if (response.status == 200) {
						return response;
					}
				});
		}

		function UpdateProfile(profile) {
			return $http.post(serviceBase + 'passenger/UpdateProfile', profile)
				.then(function (response) {
					if (response.status == 200) {
						return response;
					}
				});
		}

		function GetDefaultMobilityAids(divisionId, passengerId) {
			var url = serviceBase + 'passenger/GetDefaultMobilityAids/' + divisionId + '/' + passengerId;
			return $http({
				method: 'GET',
				url: url + '?rnd=' + new Date().getTime()
			}).then(function (response) {
				if (response.status == 200) {
					return response.data.result;
				} else {
					return response;
				}
			}, function (err) {
				return null;
			});
		}
	}
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('RedirectionService', RedirectionService);

    RedirectionService.$inject = ['$location','localStorageService'];

    function RedirectionService($location,localStorageService) {
        var service = {
            save: save,
            redirect: redirect,
            redirectTo: redirectTo
        };

        return service;

        function save(path) {
            localStorageService.set('coming-from', path);
        }

        function redirect() {
            var comingFrom = localStorageService.get('coming-from');
            if (comingFrom)
                localStorageService.remove('coming-from');
            else
                comingFrom = 'dashboard/';

            redirectTo(comingFrom);
        }

        function redirectTo(url) {
            $location.path(url);
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('ReservationService', ReservationService);

    ReservationService.$inject = ['$http', '$q', 'env','DivisionService'];

    function ReservationService($http, $q, env, DivisionService) {
        var service = {
            cancelReservation: cancelReservation,
            getAllReservationsForPassenger: getAllReservationsForPassenger,
            getStopInfoforReservations: getStopInfoforReservations,
            getPassengerReservationsForToday: getPassengerReservationsForToday,
            getUserReservationFor: getUserReservationFor,
            getUserReservationsByDuration: getUserReservationsByDuration,
            getTripTimingsByDuration: getTripTimingsByDuration,
            addReservations: addReservations,
            manageParkingForReservation: manageParkingForReservation,            
            getAllTripsForCurrentReservation: getAllTripsForCurrentReservation,
            modifyReservation: modifyReservation,
            getAdvReservationAllowedWeeks: getAdvReservationAllowedWeeks,
            getReservationById: getReservationById,
            addWaitlistedReservations: addWaitlistedReservations,
            getAvailableSeatsForTrip: getAvailableSeatsForTrip,
            getPassengerTemplates: getPassengerTemplates,
            addPassengerTemplate:addPassengerTemplate
        };

        return service;


        function getAdvReservationAllowedWeeks() {
            var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/reservations/advReservationWindow?rnd=' + new Date().getMilliseconds();
            var deferred = $q.defer();
            $http({
                method: 'GET',
                'url': serviceUrl
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err);
            });
            return deferred.promise;
        }


        function modifyReservation(reservationId,newTripId, passengerId) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() +
                                '/reservations/' + reservationId + '/changePickup/' + newTripId + '/' +passengerId;
            $http({
                method: 'GET',
                url: serviceUrl,
                contentType: 'application/json'                
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err);
            });

            return deferred.promise;
        }


        function getAllTripsForCurrentReservation(reservationId, passengerId) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/reservations/' + reservationId + '/altTrips/' + passengerId +
                '?rnd' + new Date().getMilliseconds();
            $http({
                method: 'GET',
                url: serviceUrl,
                contentType: 'application/json'
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err);
            });
            return deferred.promise;
        }


        function getUserReservationFor(passengerId, scheduleType, reservationDate) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/reservations/for/' + passengerId + '/' + scheduleType +
                '/' + reservationDate + '/' + '?rnd' + new Date().getMilliseconds();
            $http({
                method: 'GET',
                url: serviceUrl,
                contentType: 'application/json'
                }).then(function (response) {
                    deferred.resolve(response);
                    }, function (err) {
                deferred.reject(err);
            });
            return deferred.promise;
            }
       
        function addReservations(passengerId, reservations) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/reservations/add/' + passengerId;
            $http({
                method: 'POST',
                url: serviceUrl,
                contentType: 'application/json',
                data: JSON.stringify(reservations),
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                }
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err);
            });

            return deferred.promise;
        };

        function addWaitlistedReservations(passengerId, reservations) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/reservations/waitlist/add/' + passengerId;
            $http({
                method: 'POST',
                url: serviceUrl,
                contentType: 'application/json',
                data: JSON.stringify(reservations),
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                }
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err);
            });

            return deferred.promise;
        };

        function cancelReservation(passengerId,reservationId) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId()  + '/' + passengerId + '/reservations/' + reservationId + '/cancel';
            $http({
                method: 'DELETE',
                url: serviceUrl,
                contentType: 'application/json',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                }
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err);
            });

            return deferred.promise;
        }

        function getAllReservationsForPassenger(passengerId) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/reservations/all/' + passengerId;
            $http({
                method: 'GET',
                url: serviceUrl,
                contentType: 'application/json'
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err);
            });
            return deferred.promise;
        }

        function getStopInfoforReservations(incidentId,stopId) {
            var deferred = $q.defer();
            var serviceUrl = env.commuterApiUrl + 'reservation/' + DivisionService.getDivisionId() + '/stopInfo/' + incidentId + '/' + stopId;
            $http({
                method: 'GET',
                url: serviceUrl,
                contentType: 'application/json'
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });
            return deferred.promise;
        }

        function getPassengerReservationsForToday( passengerId) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/reservations/today/' + passengerId;
            $http({
                method: 'GET',
                url: serviceUrl,
                contentType: 'application/json'
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err);
            });
            return deferred.promise;
        }

        function getUserReservationsByDuration(userId, scheduleType, duration) {
            var deferred = $q.defer();
            var serviceUrl = env.commuterApiUrl + 'reservation/' + DivisionService.getDivisionId() + '/user/' + userId + '/' + scheduleType + '?duration=' + duration;
            $http({
                method: 'GET',
                url: serviceUrl,
                contentType: 'application/json'
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err);
            });
            return deferred.promise;
        }

        function getTripTimingsByDuration(fromStopId, toStopId, scheduleType, duration) {
            var deferred = $q.defer();
            var serviceUrl = env.commuterApiUrl + 'reservation/' + DivisionService.getDivisionId() + '/tripTimings/' + fromStopId + '/' + toStopId + '/' + scheduleType + '?duration=' + duration;
            $http({
                method: 'GET',
                url: serviceUrl,
                contentType: 'application/json'
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err);
            });
            return deferred.promise;
        };


        function manageParkingForReservation(passengerId, reservationId, vehicleId) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/' + passengerId + '/' + reservationId + '/manageParkingReservation/' + vehicleId;
            $http({
                method: 'PUT',
                url: serviceUrl,
                contentType: 'application/json'
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err);
            });
            return deferred.promise;
        };

        
        function getReservationById(passengerId, id) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/' + passengerId + '/reservations/' + id;
            $http({
                method: 'GET',
                url: serviceUrl,
                contentType: 'application/json'
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err);
            });
            return deferred.promise;
        }

        function getAvailableSeatsForTrip(tripId, reservationDate) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/availableSeats/' + tripId + '/' + reservationDate;
            $http({
                method: 'GET',
                url: serviceUrl,
                contentType: 'application/json'
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err);
            });
            return deferred.promise;
        };

        function getPassengerTemplates(passengerId) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/reservationTemplates/' + passengerId;
            $http({
                method: 'GET',
                url: serviceUrl,
                contentType: 'application/json'
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err);
            });
            return deferred.promise;
        }

        function addPassengerTemplate(passengerId, template) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/reservationTemplates/' + passengerId;
            $http({
                method: 'POST',
                url: serviceUrl,
                contentType: 'application/json',
                data: template,
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                }
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err);
            });

            return deferred.promise;
        };        
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('ServiceAreaService', ServiceAreaService);

    ServiceAreaService.$inject = ['$http','$q','env'];

    function ServiceAreaService($http,$q,env) {
        var service = {
            isInServiceArea: isInServiceArea
        };

        return service;

        function isInServiceArea(divisionId, lat, lon) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiOrgUrl + 'servicearea/canRegisterOrLogin/' + divisionId + '/' + lat + '/' + lon;
            $http({
                method: 'GET',
                'url': serviceUrl
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;
        }
    }
})();
(function () {
    'use strict';
    angular
        .module('oneMVApp')
        .controller('AllStopsController', AllStopsController)
        .controller('infoWindowController', infoWindowController);

    infoWindowController.$inject = ['$location', '$scope', 'StopDataService'];
    function infoWindowController($location, $scope, StopDataService) {
       
        $scope.navigateToSelectedStop = function (stop) {
            StopDataService.setStop(stop);
            $location.path('/commuter/selected-stop');
        };
        $scope.getDirectionsToSelectedStop = function (stop) {
            StopDataService.setStop(stop);
            $location.path('/commuter/directions');
        };
        $scope.openMapApp = function (stop) {
            var url = "";
            if ((navigator.platform.indexOf("iPhone") != -1)
                || (navigator.platform.indexOf("iPod") != -1)
                || (navigator.platform.indexOf("iPad") != -1)) {
                url = "http://maps.apple.com/?q=" + stop.latitude + "," + stop.longitude;
            } else {
                url = "http://maps.google.com/?q=" + stop.latitude + "," + stop.longitude;
            }
                
            if (url.length > 0) {
                // For Ionic
                if ($('body').hasClass('platform-cordova')) {
                    window.open(url, '_system', '');
                } else {
                    window.open(url);
                }
            }
        };    
    }
    //address not in service area
    AllStopsController.$inject = ['$location', 'GeoLocationService', 'StopDataService',
        'uiGmapIsReady', 'LocationService', '$http', '$timeout', '$window', 'MessageService', '$filter', 'PageService','OneMvServices'];

    function AllStopsController($location, GeoLocationService, StopDataService,
        uiGmapIsReady, LocationService, $http, $timeout, $window, MessageService, $filter, PageService,OneMvServices) {
        var vm = this;
        vm.PageService = PageService;
        vm.PageService.setTitle('Find a bus stop');
        vm.PageService.setHeadline(OneMvServices.getCommuterInfo().alias);
        vm.stops = [];
        vm.closestBusStop = [];
       // vm.otherBusStops = [];
        vm.allOtherStops = [];
        vm.search = '';
        vm.isLoading = true;
        vm.center = {
            latitude: 47.604356,
            longitude: -122.3360817
        };
        vm.position = null;
        vm.location = null;
        vm.selectedLocation = null;
        vm.showList = true;
        
        var closestPin, otherPin, locationPin, myLocationPin, hubIcon;
        if ($window.navigator.userAgent.indexOf("Trident") > 0 || $window.navigator.userAgent.indexOf("MSIE") > 0)
        {
            closestPin = 'images/pin-busstop-green.png';
            otherPin = 'images/pin-busstop-grey.png';
            locationPin = 'images/pin-location.png';
            myLocationPin = 'images/pin-my-location.png';
            hubIcon = 'images/pin-hub.png';
        }
        else
        {
            closestPin = 'images/pin-busstop-green.svg';
            otherPin = 'images/pin-busstop-grey.svg';
            locationPin = 'images/pin-location.svg';
            myLocationPin = 'images/pin-my-location.svg';
            hubIcon = 'images/pin-hub.svg';
        }
        //if close to amazon current location does not apply
        // if you are way out current Location does not apply
        //havershine formula to get distance
        vm.zoom = 15;
        vm.myStyles = [
        {
            featureType: "poi",
            elementType: "labels",
            stylers: [
                  { visibility: "off" }
            ]
        },
        {
            "featureType": "transit",
            "elementType": "labels.icon",
            "stylers": [
                {
                    "visibility": "off"
                }
            ]
        }
        ];

        vm.mapOptions = {
            mapTypeControl: false,
            zoomControl: true,
            streetViewControl: false,
            styles: vm.myStyles
            
        };
        vm.mapControl = {}; //this object gets the map control instance so that we can manipulate it
        vm.myLocationIcon = {
            url: myLocationPin,
            size: new google.maps.Size(42, 42),
            origin: new google.maps.Point(0, 0),
            anchor: new google.maps.Point(20, 20)
        };
        
        activate();

        function getMap() {
            uiGmapIsReady.promise().then(function (maps) {
                
                        return GeoLocationService.getCurrentPosition();
                }, function (err) {
                    MessageService.showError('Map cannot be loaded.');
                })
            .then(function (position) {
               
                if (position == undefined || position == null)
                    return StopDataService.getAllBusStops();
                vm.position = {
                        "coords": {
                            "latitude": position.coords.latitude,
                            "longitude": position.coords.longitude
                        },
                        "icon": vm.myLocationIcon
                    };

                    var selectedPos = StopDataService.getGeoLocation();
                    if (selectedPos == undefined || selectedPos == null || selectedPos.isAddress == undefined || selectedPos.isAddress == false)
                    {
                        vm.selectedLocation = vm.position;
                   
                    } else {
                        vm.location = selectedPos;
                        vm.selectedLocation = vm.location;
                        vm.search = selectedPos.formatted_address
                    }
               // vm.center = vm.position;
                    return StopDataService.getAllBusStops()
            }, function (err) {
                vm.selectedLocation = StopDataService.getGeoLocation() || null;
                if (vm.selectedLocation != null && vm.selectedLocation.isAddress)
                    vm.search = vm.selectedLocation.formatted_address;
                else {
                    vm.selectedLocation = null;
                    StopDataService.clearItem('currLocation');
                }
                

                StopDataService
                   .getAllBusStops()
                       .then(function (response) {
                           fillStops(response);

                       }, function (err) {
                           vm.isLoading = false;
                           MessageService.showError('Error loading stops. Please try again later');
                           //alert(err);
                       })
            })
            .then(function (response) {
                if (response)
                    fillStops(response);

            }, function (err) {
                vm.isLoading = false;
                MessageService.showError('Error loading stops. Please try again later.');
                //alert(err);
            });
        }
        //marker click function
        vm.markerEvent = {
                click: function (gMarker, eventName, model) {
                if (model.$id) {
                    //navigateToSelectedStop(model.coords);
                    
                    if(vm.selectedLocation)
                        StopDataService.setGeoLocation(vm.selectedLocation);
                    StopDataService.setStop(model.coords);
                    vm.coords = model.coords;
                    vm.show = true;
                }
              
            }
        };

        vm.navigateToClosestStop = function (index) {
            vm.navigateToSelectedStop(vm.closestBusStop[index]);
        }
        vm.getDirectionsToClosestStop = function (index) {
            vm.getDirectionsToSelectedStop(vm.closestBusStop[index]);
        }
        vm.getDirectionsToOtherStop = function (index) {
            vm.getDirectionsToSelectedStop(vm.allOtherStops[index]);
        }
        //vm.getDirectionsToSelectedStop = function (stop) {
        //    StopDataService.setStop(stop);
        //    StopDataService.setGeoLocation(vm.selectedLocation);
        //    $location.path('/commuter/directions');
        //};
        vm.displayMap = function () {
            
           
            vm.showList = false;
            $timeout(function () {
                google.maps.event.trigger(vm.mapControl.getGMap(), 'resize');
                resetMap();
            }, 50);
            
            
        };
      
        vm.navigateToOtherStop = function (index) {
            vm.navigateToSelectedStop(vm.allOtherStops[index]);
        };
        
        vm.locationSearch = function () {
            vm.selectedLocation = null;
            vm.show = false;
            if (vm.search.trim() == '')
            {
                StopDataService.clearItem('currLocation')
                if(vm.position != null)
                    vm.selectedLocation = vm.position;
                else {
                    vm.selectedLocation = null;
                }
                vm.location = null;
                populateStops();
                return;
            }
            LocationService.getLocation(vm.search).then(function (response) {
                if(response.length > 0)
                {
                    vm.search = response[0].formatted_address;
                    var locationIcon = {
                        url: locationPin

                    };
                    vm.location = {
                        "coords": {
                            "latitude": response[0].geometry.location.lat(),
                            "longitude": response[0].geometry.location.lng()
                        },
                        "isAddress": true,
                        "formatted_address": response[0].formatted_address, 
                        "icon": locationIcon
                    };
                    vm.selectedLocation = vm.location;
                    StopDataService.setGeoLocation(vm.selectedLocation);
                }
                populateStops();

            }, function (err) {
                MessageService.showError('Cannot find the location');
                        //alert(err);
            });
        };

        

       vm.navigateToSelectedStop = function (stop) {
            StopDataService.setStop(stop);
                //if (vm.position != undefined && vm.position != null)
            StopDataService.setGeoLocation(vm.selectedLocation)
            $location.path('/commuter/selected-stop');
        }
       //vm.openMapApp = function (stop) {
       //    var url = "";
       //    if ((navigator.platform.indexOf("iPhone") != -1)
       // || (navigator.platform.indexOf("iPod") != -1)
       //        || (navigator.platform.indexOf("iPad") != -1)) {
       //        url = "http://maps.apple.com/?q=" + stop.latitude + "," + stop.longitude;
       //    }
       //    else {
       //        url = "http://maps.google.com/?q=" + stop.latitude + "," + stop.longitude;
       //    }
                       
       //    if (url.length > 0) {
       //        // For Ionic
       //        if ($('body').hasClass('platform-cordova')) {
       //            window.open(url, '_system', '');
       //        } else {
       //            window.open(url);
       //        }
       //    }
       //}
      
        function fillStops(response) {
            
            var stops = response.data.result.stops;
            for (var i = 0; i < stops.length; i++) {
                if (stops && stops[i].id) {
                    var stop = stops[i];
                    stop.distance = null;
                    stop.icon = 'images/pin_pickup@1x.png';
                    vm.stops.push(stop);
                }
            }
            populateStops();
        }

      function populateStops() {
            if (vm.stops.length == 0)
                    return;
            vm.mapControl.getGMap().markers =[];
            vm.closestBusStop = [];
            vm.allOtherStops = [];
            var stopsToCheck = [];
           

            for (var i = 0; i < vm.stops.length; i++) {
                if (vm.selectedLocation != undefined && vm.selectedLocation != null) {//here cull the ones with long distances
                    var d = rectilinearHaversine(vm.selectedLocation.coords, vm.stops[i]);
                    if (d <= vm.distance) {
                        vm.stops[i].distance = d;
                        stopsToCheck.push(vm.stops[i])
                    } else {
                        vm.stops[i].distance = null;
                        vm.allOtherStops.push(vm.stops[i]);
                    }

                }
                else {
                    vm.stops[i].distance = null;
                    vm.allOtherStops.push(vm.stops[i]);
                }
                    
            }
        
            
            if (vm.selectedLocation != null && stopsToCheck.length > 0) {
                LocationService.getDrivingDistances(vm.selectedLocation.coords, stopsToCheck)
                    .then(function (response) {
                        for (var i = 0; i < response.rows[0].elements.length; i++) {
                            stopsToCheck[i].distance = (parseFloat(response.rows[0].elements[i].distance.value) / 1000 * 0.621371).toFixed(2);
                            if (stopsToCheck[i].distance > vm.distance) {
                                stopsToCheck[i].distance = null;
                                if(vm.allOtherStops.indexOf(stopsToCheck[i]) < 0)
                                    vm.allOtherStops.push(stopsToCheck[i]);
                            }
                            else {
                                vm.closestBusStop.push(stopsToCheck[i]);
                            }
                        }

                        updateStops();


                    }, function (err) {
                        //when location services err.
                        Array.prototype.push.apply(vm.allOtherStops, vm.stops);
                         var otherStopIcon = {
                             url: otherPin,
                             size: new google.maps.Size(34, 60),
                             origin: new google.maps.Point(0, 0),
                             anchor: new google.maps.Point(24, 57)
                        };

                        vm.allOtherStops.sort(function (a, b) {
                            if(a.distance == null || b.distance == null)
                                return 10000
                             return a.distance -b.distance
                        });
       
                         angular.forEach(vm.allOtherStops, function (stop) {
                             stop.icon = otherStopIcon;
                             stop.distance = null;
                        });
                        google.maps.event.trigger(vm.mapControl.getGMap(), 'resize');
                        resetMap();
                        
                    });
            } else {
                updateStops();
            }
                 
           
        }

      
      function updateStops()
      {
          vm.closestBusStop.sort(function (a, b) {
              if(a.distance == null || b.distance == null)
                  return 10000      
              return a.distance - b.distance
          });
          
          vm.allOtherStops.sort(function (a, b) {
              return (a.name < b.name) ? -1 : (a.name > b.name) ? 1 : 0;
          });
          
          var otherStopIcon = {
              url: otherPin,
              size: new google.maps.Size(34, 60),
              origin: new google.maps.Point(0, 0),
              anchor: new google.maps.Point(23, 57)
          };
          var closestStopIcon = {
              url: closestPin,
              size: new google.maps.Size(34, 60),
              origin: new google.maps.Point(0, 0),
              anchor: new google.maps.Point(23, 57)
          };
          angular.forEach(vm.closestBusStop, function (stop) {
              if (stop.isHub)
                  stop.icon = hubIcon;
              else
                  stop.icon = closestStopIcon;
          });
          angular.forEach(vm.allOtherStops, function (stop) {
              if (stop.isHub)
                  stop.icon = hubIcon;
              else
                  stop.icon = otherStopIcon;
          });
          vm.closestCount = $filter('filter')(vm.closestBusStop, { isHub: false }).length;
          vm.otherCount = $filter('filter')(vm.allOtherStops, { isHub: false }).length;

          google.maps.event.trigger(vm.mapControl.getGMap(), 'resize');
          resetMap();
         
      }

      function resetMap()
      {
          var bounds = new google.maps.LatLngBounds();

          angular.forEach(vm.stops, function (stop) {
              bounds.extend(new google.maps.LatLng(stop.latitude, stop.longitude));
          });
         
          if (vm.selectedLocation != undefined && vm.selectedLocation != null && vm.stops[0].distance != null && vm.stops[0].distance < vm.distance) {
              bounds.extend(new google.maps.LatLng(vm.selectedLocation.coords.latitude, vm.selectedLocation.coords.longitude));
          }
          vm.mapControl.getGMap().fitBounds(bounds);
          vm.mapControl.getGMap().setZoom(vm.mapControl.getGMap().getZoom() - 1); 
          vm.isLoading = false;
        }
      function haversineFormula(origin, stop) {
          //position1 =  vm.position
          //position2 = stop
          var lat1 = origin.latitude;
          var lon1 = origin.longitude;
          var lat2 = stop.latitude;
          var lon2 = stop.longitude

          var R = 6371; // km 
          var x1 = lat2 - lat1;
          var dLat = x1 * Math.PI / 180;
          var x2 = lon2 - lon1;
          var dLon = x2 * Math.PI / 180;
          var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                          Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                          Math.sin(dLon / 2) * Math.sin(dLon / 2);
          var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
          var d = R * c * 0.62137; //convert to miles
          return d.toFixed(2);
      }

      function rectilinearHaversine(loc1, loc2) {
          var tempPoint = {
              "latitude": loc1.latitude,
               "longitude": loc2.longitude
          }
            
          var d1 = parseFloat(haversineFormula(loc1, tempPoint));
          var d2 = parseFloat(haversineFormula(tempPoint, loc2));
          return (d1 + d2).toFixed(2);
       }

 function activate()
    {
     $http.get('clientappsettings.json').then(function (response) {
         vm.distance = response.data.stopDistance;
         vm.myStyles = response.data.googleMapOptons;
         getMap();
     }, function (err) {
         MessageService.showError('Error Loading Stops.')
         //alert(err);
     });
 }

        // Start of code for Ionic
         vm.ionicInclude = 'app/modules/commuter/all-stops/all-stops.html';
         vm.ionicCustomClassName = '';
         vm.ionicHideNavBar = false;
         vm.ionicUseRefresher = false;
        // End of code for Ionic

 
    }
   
   

})();
(function () {
    'use strict';

    angular
   .module('oneMVApp')
   .controller('AdvScheduleConfirmationController', AdvScheduleConfirmationController);

    AdvScheduleConfirmationController.$inject = ['$state', '$stateParams', '$filter', '$uibModal',
        'ReservationService', 'DivisionService', 'authService', 'StopDataService'];

    function AdvScheduleConfirmationController($state, $stateParams, $filter, $uibModal,
        ReservationService, DivisionService, authService, StopDataService) {

        var vm = this;
        vm.title = 'Advance Reservations Confirmation';
        if (isNotFromAdvSchedule()) {
            $state.go('adv-schedule-setup');
            return;
        }

        var selectedConfig = $stateParams.obj.config;
        var weeks = $stateParams.obj.reservationInfo;
        var reservations = [];
        var passengerId = authService.authentication.passengerId;
        vm.divisionAllowsWaitlist = true;
       
        vm.successAnime = successAnime;
        vm.schedule = selectedConfig.schedule;
        vm.reserve = reserve;

        vm.showReservation = showReservation;
        vm.bookReturnTrip = bookReturnTrip;
        vm.back = back;
        vm.pickup = selectedConfig.pickup;
        vm.dropoff = selectedConfig.dropoff;
        vm.weeksToDisplay = filterSelectedTrips();
        vm.reserving = false;

        //Success Animation
        function successAnime(){
            setTimeout(function(){
            anime({
                targets: '.anim--success .lines path',
                strokeDashoffset: [anime.setDashoffset, 0],
                easing: 'easeInOutSine',
                duration: 1500,
                direction: 'alternate',
                loop: false
            });
        }, 0);
        }


        DivisionService
               .isWaitlistAllowedByDivision()
           .then(function (response) {
               vm.divisionAllowsWaitlist = response;
           });
        

        function bookReturnTrip() {

            StopDataService.getPickupForReturnTrip(selectedConfig.pickup.id, selectedConfig.dropoff.id)
            .then(function (response) {

                selectedConfig.schedule = "PM";
                selectedConfig.dropoff = angular.copy(vm.pickup);
                selectedConfig.pickup = mapPickup(response);
                selectedConfig.vehicle = { 'licenceplate': '--', 'vehicleId': undefined };

                $state.go('adv-schedule-setup', { obj: { config: selectedConfig } });

            }, function (error) {
                console.log("error fetching pickup for return trip.");
            });
        }

        function mapPickup(response) {
            if (response && response.data.status == 1 && response.data.result)
                return response.data.result;
            else
                return angular.copy(vm.dropoff);

        }


        function filterSelectedTrips() {

            var result = [];

            angular.forEach(weeks, function (week) {
                var selectedRecords = { from: '', to: '', days: [] };
                selectedRecords.from = $filter('date')(week[0].date, 'MM/dd/yyyy');
                selectedRecords.to = $filter('date')(week[week.length - 1].date, 'MM/dd/yyyy');
                angular.forEach(week, function (day) {                    
                    if (canReserve(day))
                        selectedRecords.days.push({
                            date: day.date,
                            vehicle: day.vehicle,
                            trip: getTrip(day),
                            isReserved: false,
                            isWaitlist: isWaitlistRequest(day),
                            waitlistCount: getWaitlistCount(day),
                        });
                });
                result.push(selectedRecords);
            });

            return result;
        }


        function isWaitlistRequest(day) {
            var waitlistCount = getWaitlistCount(day);

            return (day.vehicle.id && day.availableParking <= 0) || (waitlistCount != undefined && waitlistCount >= 0);
        }

        function getWaitlistCount(day) {

            var trip = getTrip(day);
            if (trip.availableCapacity <= 0) return trip.numberOfWaitlists;

            return undefined;
        }


        function getTrip(day) {
            if (day.trips && day.selectedTrip) {
                for (var i = 0; i < day.trips.length; i++) {
                    if (day.trips[i].tripId == day.selectedTrip)
                        return day.trips[i];
                }
            }

            return undefined;
        }

        function back() {
            $state.go('adv-schedule', { obj: $stateParams.obj });
        }

        function isNotFromAdvSchedule() {
            return $stateParams.obj == undefined || $stateParams.obj == null ||
                $stateParams.obj.reservationInfo == null || $stateParams.obj.reservationInfo == undefined;
        }

        function canReserve(day) {

            var selectedTrip = getTrip(day);

            return day.isOpen && selectedTrip != null && selectedTrip.totalPassengers > 0;
        }

        function createReservationRequest() {

            var reservations = [];

            var weekIndex = 0;
            angular.forEach(weeks, function (week) {
                var dayIndex = 0;
                angular.forEach(week, function (day) {
                    if (canReserve(day)) {

                        var trip = getTrip(day);

                        var reservation = {
                            reservationDate: day.date,
                            tripId: trip.tripId,
                            pickupStopId: vm.pickup.id,
                            dropoffStopId: vm.dropoff.id,
                            passengerId: passengerId,
                            routeId: trip.routeId,
                            schedule :vm.schedule,
                            divisionId: DivisionService.getDivisionId(),
                            vehicleId: day.vehicle != null ? day.vehicle.id : null,
                            isAdvance: true
                        };
                        reservations.push(
                            {
                                'reservation': reservation,
                                'id': weekIndex + '_' + dayIndex
                            });
                        dayIndex++;
                    }
                });
                weekIndex++;
            });
            return reservations;
        }

        function resetReservationVariables(id) {
            var day = getDayIdentifier(id);
            day.reservationFailed = false;
            day.reservationError = '';
            day.isReserved = false;
        }

        function reserve() {
            var reservations = createReservationRequest();

            if (reservations && reservations.length > 0)
                vm.reserving = true;

            for (var i = 0; i < reservations.length; i++) {
                (createReservation)(reservations[i].reservation, reservations[i].id);
                
            }
        }
        function createReservation(request, id) {

            resetReservationVariables(id);

            ReservationService.addReservations(passengerId, [request])
                    .then(function (response) {
                        if (response && response.data && response.data.status == 1
                            && response.data.result.errors.length == 0){
                            markReserved(id, response.data.result.id[0]);
                            successAnime();
                        }else {
                            setReservationFailureMessage(id, response.data.result.errors ? response.data.result.errors[0] : response.data.result);
                        }
                    }, function (error) {
                        setReservationFailureMessage(id, error);
                    });
        }

        function getDayIdentifier(dayIdentifier) {
            var idParts = dayIdentifier.split('_');
            var week = idParts[0];
            var day = idParts[1];
            return vm.weeksToDisplay[week].days[day];
        }

        function setReservationFailureMessage(dayIdentifier, errorMessage) {
            var day = getDayIdentifier(dayIdentifier);
            day.reservationFailed = true;
            day.reservationError = errorMessage; 
        }

        function markReserved(dayIdentifier, reservationId) {
            var day = getDayIdentifier(dayIdentifier);
            day.isReserved = true;
            day.reservation = reservationId;
        }


        function showReservation(id) {

            ReservationService.getReservationById(passengerId, id)
            .then(function (response) {

                if (response && response.data.status == 1)
                    var modalReserve = $uibModal.open({
                        animation: true,
                        size: '-fs',
                        backdrop: false,
                        templateUrl: 'app/modules/commuter/adv-schedule/reservation-modal.html',
                        controller: 'ReservationModalController as vm',
                        resolve: {
                            reservation: response.data.result
                        }
                    });
            });


        }

    }

})();
(function () {

    'use strict';
    angular
    .module('oneMVApp')
    .controller('AdvScheduleController', AdvScheduleController);
    AdvScheduleController.$inject = ['$scope', '$state', '$stateParams', '$q', '$location', '$anchorScroll', '$timeout', '$uibModal',
        'authService', 'StopDataService', 'vehicleService', 'PageService',
        'ReservationService', 'DivisionService', 'MessageService', 'CommonService', 'ScheduleService', 'smoothScroll'];

    function AdvScheduleController($scope, $state, $stateParams, $q, $location, $anchorScroll, $timeout, $uibModal,
        authService, StopDataService, vehicleService, PageService,
        ReservationService, DivisionService, MessageService, CommonService, ScheduleService, smoothScroll) {

        var vm = this;
        vm.PageService = PageService;

        if (isNotFromAdvSetup() && !isFromAdvConfirm()) {
            $state.go('adv-schedule-setup');
            return;
        }

        var passengerId = undefined;
        var passengerReservations = [];
        var pickup = undefined;
        var dropoff = undefined;
        var advWeeks = undefined;
        var divisionDate = moment();


        function init() {

            //event bindings
            vm.reserve = reserve;
            vm.filterWeekend = filterWeekend;
            vm.showSchedule = showSchedule;
            vm.dayClass = applyClass;
            vm.resetPassengerVehicle = resetPassengerVehicle;
            vm.back = back;
            vm.showReservationInfo = showReservationInfo;

            //global variables
            vm.noVehicle = { 'licenceplate': '--', 'id': undefined };
            vm.carouselOptions = setCarouselOptions();
            vm.selectedConfig = $stateParams.obj.config;
            vm.passengerVehicles = $stateParams.obj.vehicles;
            vm.weeks = [];
            vm.divisionAllowsWaitlist = true;

            //local variables
            passengerId = authService.authentication.passengerId;
            passengerReservations = [];
            pickup = vm.selectedConfig.pickup;
            dropoff = vm.selectedConfig.dropoff;
            advWeeks = vm.selectedConfig.numOfWeeks.name;

            vm.PageService.setTitle(pickup.name + '-' + dropoff.name);
        }

        function setCarouselOptions() {
            return {
                navText: ["", ""],
                responsiveClass: false,
                nav: true,
                loop: false,
                itemElement: 'cal__week',
                onDragged: carouselItemChangedEvent,
                items: 1
            };
        }

        function carouselItemChangedEvent(event) {
            var element = document.getElementById(event.page.index);
            var options = {
                duration: 700,
                easing: 'easeInQuad',
                offset: 120
            };
            smoothScroll(element, options);
        }


        function getStartDate(input) {
            var momentInput = moment(input);
            var day = momentInput.day();
            if (day == 6) return momentInput.add(1, 'days').toDate();
            if (day == 0) return momentInput.toDate();
            return momentInput.subtract(day, 'days').toDate();
        }

        function activate() {

            init();

            DivisionService
             .isWaitlistAllowedByDivision()
            .then(function (response) {
                    vm.divisionAllowsWaitlist = response;
                });

            getPassengerReservations()
              .then(function () {
                  populateWeeks();
              });
        }

        function getPassengerReservations() {
            var deferred = $q.defer();

            ReservationService
            .getAllReservationsForPassenger(passengerId)
            .then(function (response) {
                if (response.data.status == 1 && response.data.result.reservations)
                    passengerReservations = response.data.result.reservations.filter(reservationsForSchedule);
                deferred.resolve(response);
            });

            return deferred.promise;
        }

        function reservationsForSchedule(r) {
            return r.scheduleType.toLowerCase() == vm.selectedConfig.schedule.toLowerCase();
        }

        function reservationForDay(date) {
            var reservations = passengerReservations.filter(function (r) {
                return moment(r.reservationDate).dayOfYear() == date.dayOfYear() && r.status != 'Canceled';
            });
            return reservations == null || reservations.length == 0 ? undefined : reservations[0];
        }

        function populateWeeks() {
            ScheduleService.getServiceDateByDivision(DivisionService.getDivisionId())
                .then(function (response) {
                    divisionDate = response.data.result;
                    var startWeek = 0;
                    var endWeek = advWeeks;
                    var startDate = getStartDate(divisionDate);


                    populateCalendar(startWeek, endWeek, startDate, isInPast);

                    if (isWeekday(divisionDate)) {
                        startWeek = advWeeks;
                        endWeek = startWeek + 1;
                        startDate = (moment(startDate).add(7 * advWeeks, 'days')).toDate();
                        populateCalendar(startWeek, endWeek, startDate, isOutsideAllowedRange);
                    }
                    getTrips();
                    vm.weeksX = vm.weeks;
                    if (vm.selectedConfig.schedule == CommonService.ScheduleType.Morning)
                        getParking();

                });
        }

        function isWeekday(date) {

            var input = moment(date);
            return input.day() != 6 || input.day() != 0;
        }


        function populateCalendar(from, to, startDate, predicate) {
            var currentDate = moment(startDate);

            for (var week = from; week < to; week++) {
                var calendarDays = [];
                for (var day = 0; day < 7; day++) {
                    calendarDays.push({
                        'dayId': day,
                        'week': week,
                        'dayOfWeek': getWeekDay(currentDate),
                        'date': currentDate.toDate(),
                        'isOpen': setOpen(currentDate, predicate),
                        'disable': disable(currentDate, predicate),
                        'selectedTrip': undefined,
                        'trips': undefined,
                        'vehicle': vm.selectedConfig.vehicle,
                        'reservation': reservationForDay(currentDate)
                    });
                    currentDate = currentDate.add(1, 'days');
                }
                vm.weeks[week] = calendarDays;
            }
        }

        function disable(currentDate, predicate) {
            return predicate(currentDate) || reservationForDay(currentDate) != undefined;
        }

        function setOpen(currentDate, predicate) {
            return !predicate(currentDate) && wasSelected(currentDate) && reservationForDay(currentDate) === undefined;
        }

        function isInPast(date) {
            return date.dayOfYear() < moment(divisionDate).dayOfYear();
        }

        function isOutsideAllowedRange(date) {
            return date.dayOfYear() > moment(divisionDate).dayOfYear() + advWeeks * 7;
        }

        function getWeekDay(date) {
            var weekDays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

            return weekDays[date.weekday()];
        }

        function wasSelected(date) {
            for (var i = 0; i < vm.selectedConfig.weekDays.length; i++) {
                if (vm.selectedConfig.weekDays[i].id == date.day())
                    return true;
            }
            return false;
        }



        function getTrips() {
            for (var j = 0; j < vm.weeks.length; j++) {
                for (var i = 0; i < vm.weeks[j].length; i++) {
                    if (vm.weeks[j][i].isOpen && !vm.weeks[j][i].disable)
                        (getTripInfo)(j, i);
                }
            }
        }

        function getParking() {
            for (var j = 0; j < vm.weeks.length; j++) {
                for (var i = 0; i < vm.weeks[j].length; i++) {
                    if (vm.weeks[j][i].isOpen && !vm.weeks[j][i].disable)
                        (getAvailableParking)(j, i);
                }
            }
        }

        function getAvailableParking(week, day) {
            StopDataService
              .getAvailableParkingsForStop(pickup.id, Date.parse(vm.weeks[week][day].date))
          .then(function (response) {
              if (response.data.status == 1) {
                  vm.weeks[week][day].availableParking = response.data.result;
              }
          });
        }

        function getTripInfo(week, day) {
            StopDataService
              .getNonPerformedTrips(pickup.id, dropoff.id, vm.selectedConfig.schedule, Date.parse(vm.weeks[week][day].date))
          .then(function (response) {
              if (response.data.status == 1 && response.data.result) {
                  vm.weeks[week][day].trips = response.data.result.NonPerformedTrips;
                  mapSelectedTrip(week, day);
              }

              if (vm.weeks[week][day].trips == null) {
                  vm.weeks[week][day].isOpen = false;
                  vm.weeks[week][day].disable = true;
              }
          });
        }

        function mapSelectedTrip(week, day) {
            if (vm.weeks[week][day] == undefined || vm.weeks[week][day].trips == undefined)
                return;

            var trips = vm.weeks[week][day].trips;
            for (var i = 0; i < trips.length; i++) {
                if (vm.selectedConfig.tripTime.tripId == trips[i].tripId) {
                    vm.weeks[week][day].selectedTrip = trips[i].tripId;
                    return;
                }
            }
        }

        function applyClass(day) {
            if (isWeekend(day)) return 'cal__day--disabled';

            if (angular.isUndefined(day.trips) || !day.isOpen) return 'cal__day--inactive';
            return 'cal__day--active';
        }

        function showSchedule(day) {

            if (isWeekend(day) || day.disable) return;

            day.isOpen = !day.isOpen;

            if (!day.isOpen)
                day.trips = undefined;

            getTripInfo(day.week, day.dayId);
            getAvailableParking(day.week, day.dayId);

            var hash = day.dayId + '_' + day.week;
        }

        function filterWeekend() {
            return function (day) {
                return day.dayOfWeek != 'Sat' && day.dayOfWeek != 'Sun';
            };
        };

        function isWeekend(day) {
            day.dayOfWeek == 'Sat' || day.dayOfWeek == 'Sun'
        }

        function resetPassengerVehicle(day) {
            if (vm.passengerVehicles && vm.passengerVehicles.length > 0)
                day.vehicle = vm.passengerVehicles[0];
        }

        function isNotFromAdvSetup() {
            return $stateParams.obj == null
                || $stateParams.obj == undefined
                || $stateParams.obj.config == null
                || $stateParams.obj.config == undefined;
        }

        function isFromAdvConfirm() {
            return $stateParams.obj != null
                && $stateParams.obj != undefined
                && $stateParams.obj.reservationInfo != null
                && $stateParams.obj.reservationInfo != undefined;
        }

        function back() {
            $state.go('adv-schedule-setup');
        }

        function showReservationInfo(reservation) {
            $uibModal.open({
                animation: true,
                templateUrl: 'app/modules/commuter/adv-schedule/reservation-modal.html',
                controller: 'ReservationModalController as vm',
                backdrop: false,
                size: '-fs',
                resolve: {
                    reservation: reservation
                }
            });
        }

        function reserve() {
            var allowReservation = false;
            angular.forEach(vm.weeks, function (week) {
                angular.forEach(week, function (day) {
                    if (day.isOpen && day.selectedTrip != null) {
                        allowReservation = true;
                    }
                });
            });

            if (allowReservation) {
                $state.go('adv-schedule-confirmation',
                {
                    obj:
                    {
                        config: vm.selectedConfig,
                        vehicles: vm.passengerVehicles,
                        reservationInfo: vm.weeks
                    }
                });
            }

        }
        activate();
    }
})();



(function () {
    'use strict';

    angular.module('oneMVApp')
    .directive('owlCarousel', MVOwlCarousel);

    MVOwlCarousel.$inject = [];

    function MVOwlCarousel() {
        return {
            restrict: 'E',
            transclude: false,
            link: function (scope) {
                scope.initCarousel = function (element) {
                    // provide any default options you want
                    var defaultOptions = {
                    };
                    var customOptions = scope.$eval($(element).attr('data-options'));
                    // combine the two options objects
                    for (var key in customOptions) {
                        defaultOptions[key] = customOptions[key];
                    }
                    // init carousel
                    angular.element(element).owlCarousel(defaultOptions);
                };
            }
        };
    }

})();

(function () {
    'use strict';

    angular.module('oneMVApp')
    .directive('owlCarouselItem', MVOwlCarouselItem);

    MVOwlCarouselItem.$inject = [];

    function MVOwlCarouselItem() {
        return {
            restrict: 'A',
            transclude: false,
            link: function (scope, element) {
                // wait for the last item in the ng-repeat then call init
                if (scope.$last) {
                    scope.initCarousel(element.parent());
                }
            }
        };
    }
})();


(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('AdvScheduleSetupController', AdvScheduleSetupController);

    AdvScheduleSetupController.$inject = ['$scope', '$state', '$uibModal', '$stateParams',
        'authService', 'StopDataService', 'vehicleService', 'CommonService',
        'ReservationService', 'MapService', 'MapIconService', 'PageService','LuumLinkedService','OneMvServices'];

    function AdvScheduleSetupController($scope, $state, $uibModal, $stateParams,
        authService, StopDataService, vehicleService, CommonService,
        ReservationService, MapService, MapIconService, PageService, LuumLinkedService,OneMvServices) {

        var vm = this;
        vm.PageService = PageService;             
        vm.PageService.setTitle('Advanced Reservations');
        vm.PageService.setHeadline(OneMvServices.getCommuterInfo().alias);
        var passengerId = authService.authentication.passengerId;
        var allStops = [];
        var noTripTime = { 'pickupTime': 'Optional', 'tripId': undefined };
        var noVehicle = { 'licenceplate': '--', 'vehicleId': undefined };
        var noStop = { 'id': undefined, 'name': '--', 'latitude': null, 'longitude': null };
        var markerEvents = [{ event: 'click', callback: iconClickHandler }];

        vm.map = MapService.initializeMap();
        vm.title = 'Advance Reservations Setup';
        vm.isLoading = false;
        vm.isPassengerLoggedIn = authService.isLoggedIn();
        vm.markers = [];
        vm.selectedConfig = getDefaultConfig();

        var returnTripConfig = getReturnTripConfig();

        vm.pickupStops = [];
        vm.dropoffStops = [];
        vm.tripTimes = [];
        vm.passengerVehicles = [];
        vm.coords = undefined;
        vm.numOfWeeks = [];
        vm.daysOfWeek =
                    [
                    { 'name': 'S', 'selected': false, 'id': 0 },
                    { 'name': 'M', 'selected': false, 'id': 1 },
                    { 'name': 'T', 'selected': false, 'id': 2 },
                    { 'name': 'W', 'selected': false, 'id': 3 },
                    { 'name': 'TH', 'selected': false, 'id': 4 },
                    { 'name': 'F', 'selected': false, 'id': 5 },
                    { 'name': 'S', 'selected': false, 'id': 6 }
                    ];

        vm.hasTemplates = false;
        vm.templates = [];
        vm.useDefaultTemplate = false;
        vm.overrideTemplate = false;
        vm.addTemplate = false;

        function isReturnTripRequest() {
            return $stateParams.obj != null
                && $stateParams.obj != undefined
                && $stateParams.obj.config != null
                && $stateParams.obj.config != undefined;
        }

        function getReturnTripConfig() {
            return isReturnTripRequest() ? $stateParams.obj.config : undefined;
        }

        function getDefaultConfig() {
            return {
                schedule: CommonService.ScheduleType.Morning,
                pickup: undefined,
                dropoff: undefined,
                weekDays: [],
                tripTime: undefined,
                numOfWeeks: undefined,
                vehicle: undefined
            };
        }


        vm.pickupChanged = function () {
            if (!vm.selectedConfig.pickup || !vm.selectedConfig.pickup.id) {
                vm.selectedConfig.dropoff = vm.pickupStops[0];
                vm.markers = [];
                vm.addTemplate = false;
                return;
            };
            
            vm.selectedConfig.dropoff = noStop;
            vm.show = false;
            setMarkers();
            MapService.setMapBounds(vm.markers, markerEvents);
            getDropoffs();
        }

        vm.dropoffChanged = function () {
            if (!vm.selectedConfig.pickup || !vm.selectedConfig.pickup.id) {                
                return
            };

            vm.show = false;
            if (vm.selectedConfig.dropoff && vm.selectedConfig.dropoff.id)
                getTripTimes();
            else
                vm.addTemplate = false;

            setMarkers();
            MapService.setMapBounds(vm.markers, markerEvents);
        }     

        $scope.$watch('vm.daysOfWeek|filter:{selected:true}', function (value) {
            vm.selectedConfig.weekDays = value.map(function (day) {
                return day;
            });
        }, true);

        $scope.$watch('vm.parkingSelected', function (value) {
            if (!value)
                vm.selectedConfig.vehicle = noVehicle;
        });



        $scope.$watch('vm.useDefaultTemplate', function (value) {

            if (!value)
                vm.parkingSelected = false;

            setSelectedTrip();
            filterPickups();
            resetWeekDays();
            setSelectedVehicle();
            

            if (vm.templates.length > 0 && vm.useDefaultTemplate) {
                var template = getTemplate();
                for (var i = 0; i < vm.daysOfWeek.length; i++) {
                    vm.daysOfWeek[i].selected = isWeekdaySelected(vm.daysOfWeek[i], template.daysOfWeek);
                }
            }
        });


        function getTemplate() {
            for (var i = 0; i < vm.templates.length; i++) {
                if (vm.templates[i].schedule == vm.selectedConfig.schedule)
                    return vm.templates[i];
            }

            return undefined;
        }

        vm.scheduleChanged = function () {
            vm.dropoffStops = [];
            vm.markers = [];
            vm.show = false;
            vm.useDefaultTemplate = false;
            filterPickups();
            resetWeekDays();
            resetTripTimes();
            setHasTemplate();
        }

        vm.clearWeekSelection = function () {
            resetWeekDays();
        }


        vm.next = function () {
            if (vm.addTemplate || vm.overrideTemplate) {

                var template = {
                    PickupStopId: vm.selectedConfig.pickup.id,
                    DropoffStopId: vm.selectedConfig.dropoff.id,
                    TripId: vm.selectedConfig.tripTime.tripId,
                    Schedule: vm.selectedConfig.schedule,
                    VehicleId : vm.selectedConfig.vehicle.id,
                    SelectedDays : getSelectedDays()
                };

                ReservationService.addPassengerTemplate(passengerId, template)
                .then(function () {
                    next();
                }, function () {
                    next();
                });
            }

            next();
        }


        function getSelectedDays() {

            var weekdays = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
            
            var selectedDays = {};
            for (var i = 0; i < vm.selectedConfig.weekDays.length; i++) {
                var key = weekdays[vm.selectedConfig.weekDays[i].id];
                selectedDays[key] = vm.selectedConfig.weekDays[i].selected;
            }

            return selectedDays;
        }


        function next() {
            $state.go('adv-schedule', {
                obj: {
                    config: vm.selectedConfig, vehicles: vm.passengerVehicles
                }
            });
        }


        vm.login = function () {
            redirectToLogin();
        }


        vm.showAddVehicleDialog = function () {
            var modalReserve = $uibModal.open({
                animation: true,
                templateUrl: 'app/modules/commuter/modals/add-vehicle-modal/add-vehicle.html',
                controller: 'AddVehicleController as vm',
                size: "-fs",
                backdrop: false,
                resolve: {
                    atleastOneVehicleExist: vm.passengerVehicles.length > 0
                }
            });
            modalReserve.result.then(function (result) {
                if (result.isAdded)
                    getPassengerVehicles();
            });
        }

        function setMarkers() {
            vm.markers = [];

            if (vm.selectedConfig.pickup && vm.selectedConfig.pickup.id !== undefined)
                vm.markers.push({
                    latitude: vm.selectedConfig.pickup.latitude,
                    longitude: vm.selectedConfig.pickup.longitude,
                    icon: getMapIcon(vm.selectedConfig.pickup.isHub),
                    name: vm.selectedConfig.pickup.name,
                    address: vm.selectedConfig.pickup.address
                });

            if (vm.selectedConfig.dropoff && vm.selectedConfig.dropoff.id !== undefined)
                vm.markers.push({
                    latitude: vm.selectedConfig.dropoff.latitude,
                    longitude: vm.selectedConfig.dropoff.longitude,
                    icon: getMapIcon(vm.selectedConfig.dropoff.isHub),
                    name: vm.selectedConfig.dropoff.name,
                    address: vm.selectedConfig.dropoff.address
                });
        }


        function getMapIcon(isHub) {
            return isHub ? MapIconService.getCommuterHubIcon() :
                MapIconService.getCommuterStopIcon();
        }

        function resetWeekDays() {
            vm.selectedConfig.weekDays = [];
           
                angular.forEach(vm.daysOfWeek, function (dayOfWeek, key) {
                    dayOfWeek.selected = false;
                });
        }

        function resetTripTimes() {
            vm.selectedConfig.tripTime = {};
            vm.tripTimes = [];
        }


        function filterPickups() {
            vm.pickupStops = allStops.filter(function (stop) {
                return stop.isHub != (vm.selectedConfig.schedule == CommonService.ScheduleType.Morning);
            });
            vm.pickupStops.splice(0, 0, noStop);

            setPickupStop();            
        }

        function setPickupStop() {

            var pickupId = undefined;            

            if (isReturnTripRequest() && returnTripConfig)
                pickupId = returnTripConfig.pickup.id;
            else if (vm.templates.length > 0 && vm.useDefaultTemplate)
                pickupId = getTemplate().pickupId;
            
            var matchFound = false;
            for (var i = 0; i < vm.pickupStops.length; i++) {
                if (vm.pickupStops[i].id == pickupId){
                    vm.selectedConfig.pickup = vm.pickupStops[i];
                    matchFound =true;
                    break;
                }
            }

            if (!matchFound)
                vm.selectedConfig.pickup = vm.pickupStops[0];

            vm.pickupChanged();
        }


        function setDropoffStop() {

            var dropoffId = undefined;

            if (isReturnTripRequest() && returnTripConfig) 
                dropoffId = returnTripConfig.dropoff.id;            
            else if (vm.templates.length > 0 && vm.useDefaultTemplate)
                dropoffId = getTemplate().dropoffId;

            var matchFound = false;
            for (var i = 0; i < vm.dropoffStops.length; i++) {
                if (vm.dropoffStops[i].id == dropoffId) {
                    vm.selectedConfig.dropoff = vm.dropoffStops[i];
                    matchFound = true;
                    break;
                }
            }

            if(!matchFound)
                vm.selectedConfig.dropoff = vm.dropoffStops[0];

            vm.dropoffChanged();

        }

        function activate() {
            if (!vm.isPassengerLoggedIn)
                redirectToLogin();
            LuumLinkedService.verify(authService.authentication.passengerId);
            getPassengerTemplates();            
            getPassengerVehicles();
        }


        function getPassengerTemplates() {
            ReservationService.getPassengerTemplates(passengerId)
           .then(function (response) {
               if (response && response.data.status && response.data.result && response.data.result.length > 0) {                   
                   mapTemplates(response.data.result);
               }

               getAdvReservationWindow();
               getAllStops();

           });
        }


        function mapTemplates(templates) {
            for (var i = 0; i < templates.length; i++)
                vm.templates.push(templates[i]);

            setHasTemplate();
        }

        function setHasTemplate() {
            var found = false;
            for (var i = 0; i < vm.templates.length; i++) {
                if (vm.selectedConfig.schedule == vm.templates[i].schedule) {
                    found = true;
                    break;
                }
            }
            vm.hasTemplates = found;
        }


        function iconClickHandler(model) {
            vm.show = true;
            vm.coords = model.coords;
        }


        function getAdvReservationWindow() {
            vm.numOfWeeks = [];
            ReservationService.getAdvReservationAllowedWeeks()
            .then(function (response) {
                if (response.data.status == 1) {
                    var numWeeks = response.data.result;
                    for (var i = 1; i <= numWeeks; i++) {
                        vm.numOfWeeks.push({
                            'name': i
                        });
                    }

                    var  weekToSelect = vm.numOfWeeks[vm.numOfWeeks.length - 1];

                    if (isReturnTripRequest()) {
                        for (var i = 0; i < vm.numOfWeeks.length; i++) {
                            if (vm.numOfWeeks[i].name === returnTripConfig.numOfWeeks.name) {
                                weekToSelect = vm.numOfWeeks[i];
                                break;
                            }
                        }
                    }

                    vm.selectedConfig.numOfWeeks = weekToSelect;
                }
            });
        }

        function getAllStops() {
            StopDataService.getAllBusStops()
                .then(function (response) {
                    if (response.data.status == 1 && response.data.result) {
                        allStops = response.data.result.stops;

                        if (isReturnTripRequest() && returnTripConfig) {
                            vm.selectedConfig = angular.copy(returnTripConfig);
                            setHasTemplate();
                            for (var i = 0; i < vm.daysOfWeek.length; i++) {                                                                
                                vm.daysOfWeek[i].selected = isWeekdaySelected(vm.daysOfWeek[i], returnTripConfig.weekDays);
                            }
                        }                        

                        filterPickups();
                    }
                });
        }


        function isWeekdaySelected(input, configurationWeekDays) {
            for (var i = 0; i < configurationWeekDays.length; i++) {
                if (input.name == configurationWeekDays[i].name
                    && configurationWeekDays[i].selected)
                    return true;
            }
            return false;
        }

        function getPassengerVehicles() {
            vehicleService
                .getVehiclesForPassenger(passengerId)
            .then(function (response) {
                if (response.data && response.data.status == 1 && response.data.result.passengerVehicles)
                    vm.passengerVehicles = response.data.result.passengerVehicles;

                if (vm.passengerVehicles.length > 0)
                    vm.passengerVehicles.splice(0, 0, noVehicle);
                else
                    vm.passengerVehicles = [noVehicle];

                setSelectedVehicle();                
            });
        }

        function setSelectedVehicle() {

            var template = getTemplate();

            if (vm.useDefaultTemplate && template != undefined
                    && vm.selectedConfig.schedule == "AM" && template.vehicleId) {

                for (var i = 0; i < vm.passengerVehicles.length; i++) {
                    if (vm.passengerVehicles[i].id == template.vehicleId) {
                        vm.parkingSelected = true;
                        vm.selectedConfig.vehicle = vm.passengerVehicles[i];
                        break;
                    }
                }
            }

            else
                vm.selectedConfig.vehicle = vm.passengerVehicles[0];
        }


        function getDropoffs() {
            if (!vm.selectedConfig.pickup || !(vm.selectedConfig.pickup.id))
                return;

            StopDataService
                .getDropoffsForSelectedPickup(vm.selectedConfig.pickup.id)
            .then(function (response) {
                if (response.data.status == 1 && response.data.result) {
                    vm.dropoffStops = response.data.result.dropoffs;
                    vm.dropoffStops.splice(0, 0, noStop);

                    setDropoffStop();
                }
            });
        }

        function getTripTimes() {
            if (!vm.selectedConfig.pickup.id || !vm.selectedConfig.dropoff.id)
                return;

            StopDataService
                .getTripTimesForAdvancedReservation
                (vm.selectedConfig.pickup.id, vm.selectedConfig.dropoff.id, vm.selectedConfig.schedule)
                .then(function (response) {
                    if (response.data.status == 1 && response.data.result.allTrips) {
                        vm.tripTimes = response.data.result.allTrips;
                        vm.tripTimes.splice(0, 0, noTripTime);

                        setSelectedTrip();
                    }
                });
        }


        function setSelectedTrip() {
            if (vm.templates.length > 0 && vm.useDefaultTemplate) {
                var template = getTemplate();
                if (!template)
                    vm.selectedConfig.tripTime = vm.tripTimes[0];
                else {
                    for (var i = 0; i < vm.tripTimes.length; i++) {
                        if (vm.tripTimes[i].tripId == template.tripId) {
                            vm.selectedConfig.tripTime = vm.tripTimes[i];
                            break;
                        }
                    }
                }
            }
            else
                vm.selectedConfig.tripTime = vm.tripTimes[0];
        }

        function redirectToLogin() {
            $state.go('login');
        }

        activate();

        // Start of code for Ionic
        vm.ionicInclude = 'app/modules/commuter/adv-schedule/adv-schedule-setup.html';
        vm.ionicCustomClassName = '';
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = true;
        vm.ionicPullingText = 'Refresh Reservations';
        vm.ionicRefreshingText = 'Loading Reservations';
        vm.ionicSpinner = 'spiral'; // none to disable.
        vm.refresh = function (refresher) {
            vm.isLoading = true;
            activate();
            $rootScope.$broadcast('scroll.refreshComplete');
            vm.isLoading = false
        }
        // End of code for Ionic
    }

})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('ReservationModalController', ReservationModalController);

    ReservationModalController.$inject = ['$uibModalInstance','reservation'];

    function ReservationModalController($uibModalInstance, reservation) {
        var vm = this;


        vm.passengerReservations = [reservation];

        vm.close = function () {
            $uibModalInstance.close();
        };
    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('DirectionsController', DirectionsController);

    DirectionsController.$inject = ['$rootScope','$location', '$stateParams', 'ScheduleService', 'StopDataService', 'uiGmapIsReady'];

    function DirectionsController($rootScope,$location, $stateParams, ScheduleService, StopDataService, uiGmapIsReady) {

        var vm = this;
        
        vm.selectedStop = StopDataService.getStop();
        vm.hasStopDescription = false;

        //if (vm.selectedStop == undefined || vm.selectedStop == null || vm.selectedStop.latitude == undefined || vm.selectedStop.latitude == null)
        //    vm.selectedStop = {
        //        latitude: 40.651739,
        //        longitude: -73.953148
        //    }
        var currentLocation = StopDataService.getGeoLocation();
        //currentLocation = {
        //    coords: {
        //        latitude: 32.604777,
        //        longitude: -99.4343127
        //    }
        //}

        vm.fromLocation = currentLocation != null ? currentLocation.coords.latitude + ',' + currentLocation.coords.longitude : '';
        
        vm.center = {
            latitude: 40.651739,
            longitude: -73.953148
        };

        vm.zoom = 14;
        vm.mapControl = {};
        var myStyles = [
           {
               featureType: "poi",
               elementType: "labels",
               stylers: [
                     { visibility: "off" }
               ]
           },
           {
               "featureType": "transit",
               "elementType": "labels.icon",
               "stylers": [
                   {
                       "visibility": "off"
                   }
               ]
           }
        ];
        vm.mapOptions = {
            mapTypeControl: false,
            zoomControl: false,
            streetViewControl: false,
            styles: myStyles

        };
        vm.options = {};
        vm.markerEvents = function () {
            //for future?
        };
        vm.showDirections = currentLocation == null;

        var bounds = new google.maps.LatLngBounds();
        var directionsDisplay;
        var directionsService;
        uiGmapIsReady.promise().then(function (maps) {

            directionsDisplay = new google.maps.DirectionsRenderer;
            directionsService = new google.maps.DirectionsService;
            var directions = document.getElementById('directions');

            directionsDisplay.setMap(vm.mapControl.getGMap());
            directionsDisplay.setPanel(directions);

            if (vm.showDirections) {
                bounds.extend(new google.maps.LatLng(vm.selectedStop.latitude, vm.selectedStop.longitude));
                vm.center.latitude = vm.selectedStop.latitude;
                vm.center.longitude = vm.selectedStop.longitude;
              //  vm.mapControl.getGMap().fitBounds(bounds);
                google.maps.event.trigger(vm.mapControl.getGMap(), "resize");
            }
            else {
                mapDirection(vm.fromLocation);
            }
        });

        vm.getDirection = function () {

            var geocoder = new google.maps.Geocoder;
            geocoder.geocode({ 'address': vm.fromLocation },
                function (response, status) {
                    if (status === google.maps.GeocoderStatus.OK) {
                        mapDirection(response[0].geometry.location.lat() + ',' + response[0].geometry.location.lng());
                    }
                });
        };

        var mapDirection = function (start) {

            

            directionsService.route({
                origin: start,
                destination: vm.selectedStop.latitude + ',' + vm.selectedStop.longitude,
                travelMode: google.maps.DirectionsTravelMode.DRIVING
            }, function (response, status) {
                if (status === 'OK') {
                    directionsDisplay.setDirections(response);
                    vm.stopDescription = vm.selectedStop.description;
                    if (vm.stopDescription !== "" && !angular.isUndefined(vm.stopDescription))
                        vm.hasStopDescription = true;
                } else {
                    window.alert('Directions request failed due to ' + status);
                }
            });
        };


        //vm.navigateToTripPage = function (index) {
        //    var incident = vm.nonPerformedIncidents[index];
        //    $location.path('/selected-trip/' + 249.1 + '/' + incident.BlockId + '/' + incident.IncidentId);
        //}

        // Start of code for Ionic
        vm.ionicInclude = 'app/modules/commuter/directions/directions.html';
        vm.ionicCustomClassName = '';
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = false;
        // End of code for Ionic
    }
})();

/// <reference path="home.html" />


(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('CommuterHomeController', CommuterHomeController);

    CommuterHomeController.$inject =
        ['$scope', '$rootScope', '$location', 'ReservationService', 'authService',
             '$uibModal', 'MessageService', 'env', 'vehicleService', 'PageService','OneMvServices'];

    function CommuterHomeController($scope, $rootScope, $location, ReservationService,
        authService, 
        $uibModal, MessageService, env, vehicleService, PageService,OneMvServices) {

        var vm = this;
        vm.PageService = PageService;
        vm.PageService.setTitle('Dashboard');
        vm.PageService.setHeadline(OneMvServices.getCommuterInfo().alias);
        vm.isUserLoggedIn = authService.isLoggedIn();
        vm.reservationsAllowed = env.reservationsAllowed;
        vm.passengerId = '';
        vm.passengerReservations = [];
        vm.isLoading = true;
        vm.vehicles = [];
        vm.updatingVehicleInfo = [];
        vm.commuterFeatures = [

                                {
                                    "class": "carousel__item--all-stops",
                                    "headline": "Explore",
                                    "title": "Bus Stops",
                                    "description": "Find a bus stop near you.",
                                    "link": "commuter/all-stops",
                                    "cta" : "View Stops"
                                },
                                {
                                    "class": "carousel__item--advanced-reservations",
                                    "headline": "Book",
                                    "title": "Reservations",
                                    "description": "Up to two weeks in advance.",
                                    "link": "commuter/adv-schedule-setup",
                                    "cta": "Get Started"
                                },
                                {
                                    "class": "carousel__item--commuter-schedule",
                                    "headline": "View",
                                    "title": "Published Schedules",
                                    "description": "See all of the published schedule times at a glance.",
                                    "link": "commuter/published-schedule",
                                    "cta": "Show Schedule"
                                }
                            ];


        
        //method exposed to view
        vm.showCommuterTrip = showCommuterTrip;

        //var vm = this;

        $scope.carouselOptions = {
            navText: ["", ""],
            responsiveClass: false,
            nav: true,

            responsive: {
                0: {
                    items: 1,
                    stagePadding: 34,
                    startPosition: 1,
                    center: true,
                },
                375: {
                    items: 1,
                    stagePadding: 34,
                    startPosition: 1,
                    center: true,
                },
                768: {
                    items: 2,
                    stagePadding: 16,
                    startPosition: 1,
                    center: true,
                },
                992: {
                    items: 3,
                    stagePadding: 0,
                    center: false,
                }

            }
        };


        function getUserReservations(callback) {
            ReservationService.getPassengerReservationsForToday(vm.passengerId)
            .then(function (response) {
                if (response && response.data && response.data.status == 1 && response.data.result.reservations) {
                    vm.passengerReservations = response.data.result.reservations;
                    if (callback)
                        callback();
                    else
                        vm.isLoading = false;
                } else {
                    vm.passengerReservations = [];
                }
            }, function (err) {
                if (err.status !== 401) {
                    MessageService.showError('Sorry! Could not load your Reservation!');
                }
                vm.isLoading = false;
            });

        };


        function getVehicles() {
            vehicleService.getVehiclesForPassenger(vm.passengerId)
            .then(function (response) {
                if (response.data && response.data.status == 1 && response.data.result != null)
                    vm.vehicles = response.data.result;
                vm.isLoading = false;
            }, function (error) {
                vm.isLoading = false;
            });
        };

        function showCommuterTrip(trip) {
            var commuterTripModal = $uibModal.open({
                animation: true,
                templateUrl: 'app/modules/shared/trips/commuter-trip-modal.html',
                controller: 'CommuterTripModalController as vm',
                size: '-fs',
                backdrop: false,
                keyboard: false,
                resolve: {
                    tripId: trip.id
                }
            });

            commuterTripModal.result.then(function (response) {
                if (response.cancelled || response.isModified) {
                    getUserReservations(getVehicles);
                }
            });
        }
        function activate() {
            if (vm.isUserLoggedIn) {
                vm.passengerId = authService.authentication.passengerId;
                getUserReservations(getVehicles);
            }
        }


        vm.updateParkingVehicle = function (reservation, index) {
            vm.updatingVehicleInfo[index] = true;
            ReservationService
                .updateVehicleForReservation(reservation.ReservationId, reservation.VehicleId)
                .then(function (response) {
                    vm.updatingVehicleInfo[index] = false;
                }, function (error) {
                    vm.updatingVehicleInfo[index] = false;
                });
        };

        vm.showStopsMap = function (inc) {
            var modalGetMap = $uibModal.open({
                animation: true,
                windowClass: 'map-modal',
                templateUrl: 'app/modules/commuter/modals/reservation-map-modal/reservation-map.html',
                controller: 'ReservationMapController as vm',
                backdrop: 'static',
                resolve: {
                    reservation_stops: function () {
                        return inc;
                    }
                }
            });

            modalGetMap.result.then(function (isDone) {
                if (isDone) {
                }

            }, function () {

            });
        };

        vm.login = function () {
            $location.path('/login');
        };
        vm.ctaAction = function(link){
            $location.path(link);
        };
        activate();

        // Start of code for Ionic
        vm.ionicInclude = 'app/modules/commuter/home/home.html';
        vm.ionicCustomClassName = 'ionic-top-padding';
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = true;
        vm.ionicPullingText = 'Refresh';
        vm.ionicRefreshingText = 'Loading';
        vm.ionicSpinner = 'spiral'; // none to disable.
        vm.refresh = function (refresher) {
            vm.isLoading = true;
            vm.title = 'Home';
            vm.isUserLoggedIn = authService.isLoggedIn();
            vm.reservationsAllowed = env.reservationsAllowed;
            vm.passengerId = '';
            vm.userReservations = {};
            vm.vehicles = [];
            vm.updatingVehicleInfo = [];
            activate();
            $rootScope.$broadcast('scroll.refreshComplete');
            vm.isLoading = false;
        }
        // End of code for Ionic
    }
})();


(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('LastLocationController', LastLocationController);

    LastLocationController.$inject = ['$rootScope','StopDataService', '$q', '$http', 'env', 'uiGmapIsReady', '$stateParams', '$interval', '$window', 'GeoLocationService', '$timeout', '$state', 'MessageService'];

    function LastLocationController($rootScope,StopDataService, $q, $http, env, uiGmapIsReady, $stateParams, $interval, $window, GeoLocationService, $timeout, $state, MessageService) {
        var vm = this;
        vm.mapControl = {};
        var myStyles = [
           {
               featureType: "poi",
               elementType: "labels",
               stylers: [
                     { visibility: "off" }
               ]
           },
           {
               "featureType": "transit",
               "elementType": "labels.icon",
               "stylers": [
                   {
                       "visibility": "off"
                   }
               ]
           }
        ];
        vm.mapOptions = {
            mapTypeControl: false,
            zoomControl: true,
            streetViewControl: false,
            styles: myStyles

        };
        var busPin, stopPin, locationPin, myLocationPin, pinHub;
        var k = 0.001;
        if($window.navigator.userAgent.indexOf("Trident") > 0 || $window.navigator.userAgent.indexOf("MSIE") > 0) {
            busPin = 'images/pin-vehicle-blue.png';
            stopPin = 'images/pin-busstop-grey.png';
            locationPin = 'images/pin-location.png';
            myLocationPin = 'images/pin-my-location.png';
            pinHub = 'images/pin-hub.png';
        }
        else {
            busPin = 'images/pin-vehicle-blue.svg';
            stopPin = 'images/pin-busstop-grey.svg';
            locationPin = 'images/pin-location.svg';
            myLocationPin = 'images/pin-my-location.svg';
            pinHub = 'images/pin-hub.svg';
        }

        vm.hubIcon = { url: pinHub };
        vm.myLocationIcon = {
            url: myLocationPin,
            size: new google.maps.Size(42, 42),
            origin: new google.maps.Point(0, 0),
            anchor: new google.maps.Point(20, 20)
        };
        vm.tripDetails = {
            busName: '',
            ETA: ''
            

        };
        vm.show = true;
        vm.markerEvent = {
            click: function (gMarker, eventName, model) {
               vm.show = !vm.show
                }
        };

        vm.center = {
            latitude: 47.604356,
            longitude: -122.3360817
        };
        vm.zoom = 4;
        vm.incident = StopDataService.getIncident();
        vm.vehicleId = StopDataService.getVehicleId();
      //  vm.vehicleId = '103';
        if (angular.isUndefined(vm.vehicleId) || vm.vehicleId == null)
            vm.show = false;
        vm.stop = StopDataService.getStop() || null;
        if (vm.stop != null && vm.stop.latitude != undefined && vm.stop.latitude != null)
            vm.stop.icon = { url: stopPin };
        else
            vm.stop = null;
        vm.vehicle = {};
        vm.myLocation = undefined;
        vm.busLocation = undefined;
       
        vm.hubs = [];
        

        if (vm.incident) {
            //check for -ve in string and say ago or in
            vm.tripDetails.ETA = (vm.incident.EstimatedTimeString.indexOf('-') > -1 ? 'Departed ' : '') + vm.incident.EstimatedTimeString.replace('-', '') + ' min' + (vm.incident.EstimatedTimeString.indexOf('-') > -1 ? ' ago' : '');
            vm.tripDetails.busName = (!angular.isUndefined(vm.incident.TheVehicle) && vm.incident.TheVehicle != null) ? vm.incident.TheVehicle.VehicleName : '';
            vm.schedType = vm.incident.AMPM;
            if (vm.incident.IncidentHubs && vm.incident.IncidentHubs.length > 0) {
                angular.forEach(vm.incident.IncidentHubs, function (hub) {
                    if (hub.latitude != 0 && hub.longitude != 0)
                        vm.hubs.push(hub);
                });
            }
                
        }
        else {
            vm.show = false;
        }

        function getMap() {
            uiGmapIsReady.promise().then(function (maps) {
                return StopDataService.getVehicle(vm.vehicleId)
            }, function (err) {
                MessageService.showError('Sorrry! Map could not be loaded.')
            })
            .then(function (vehicle) {
                vm.busLocation = {
                    latitude: parseFloat(vehicle.data.MDC.LastLatitude),
                    longitude: parseFloat(vehicle.data.MDC.LastLongitude),
                    icon: { url: busPin }
                };
                $timeout(function () {
                    google.maps.event.trigger(vm.mapControl.getGMap(), 'resize');
                    resetMap()
                }, 50);

            },
                function (err) {
                    $timeout(function () {
                        google.maps.event.trigger(vm.mapControl.getGMap(), 'resize');
                        resetMap()
                    }, 50);
                });
            //.then(function (position) {
            //     vm.myLocation = {
            //        coords: {
            //            latitude:position.coords.latitude,
            //            longitude: position.coords.longitude
            //        },
            //        icon: vm.myLocationIcon
            //     };
               
            //     $timeout(function () {
            //         google.maps.event.trigger(vm.mapControl.getGMap(), 'resize');
            //         resetMap()
            //     }, 50);
            //}, function (err) {
            //    $timeout(function () {
            //        google.maps.event.trigger(vm.mapControl.getGMap(), 'resize');
            //        resetMap();
            //    }, 50);
            //});
        }

        activate();

       function activate() {
           getMap();

            vm.promise = $interval(updateVehiclePosition, 15000);
       }

       vm.$onDestroy = function () {
           $interval.cancel(vm.promise);
       };
       function resetMap() {
           var bounds = new google.maps.LatLngBounds();
           
           if (vm.schedType == 'AM') {
               if (!angular.isUndefined(vm.stop) && vm.stop != null && vm.stop.latitude != null && vm.stop.latitude != 0)
                   bounds.extend(new google.maps.LatLng(vm.stop.latitude, vm.stop.longitude));
           }
           if (vm.busLocation != null && vm.busLocation.latitude != null && vm.busLocation.latitude != 0)
               bounds.extend(new google.maps.LatLng(vm.busLocation.latitude, vm.busLocation.longitude));
           if (vm.schedType == 'PM') {
               if (vm.hubs.length > 0) {
                   angular.forEach(vm.hubs, function (hub) {
                       bounds.extend(new google.maps.LatLng(hub.latitude, hub.longitude));
                   });
               }
           }
           if (!bounds.isEmpty()) {
               vm.mapControl.getGMap().fitBounds(bounds);
               vm.mapControl.getGMap().setZoom(vm.mapControl.getGMap().getZoom() - 1);
           }
           //if (vm.busLocation != null && vm.busLocation.latitude != null && vm.busLocation.latitude != 0) {
           //    vm.center = {
           //        latitude: vm.busLocation.latitude,
           //        longitude: vm.busLocation.longitude
           //    };
           //}

       }

       function updateVehiclePosition() {
           if($state.current.name != 'last-location')
           {
               $interval.cancel(vm.promise);
           }
           else
           {
               
               StopDataService.getVehicle(vm.vehicleId).then(function (vehicle) {
                   if (!angular.isUndefined(vehicle.data.MDC) && vehicle.data.MDC != null) {
                       vm.busLocation = {
                           latitude: parseFloat(vehicle.data.MDC.LastLatitude),
                           longitude: parseFloat(vehicle.data.MDC.LastLongitude),
                           icon: { url: busPin }
                       };
                   }
                   //vm.center = {
                   //    latitude: parseFloat(vehicle.data.MDC.LastLatitude),
                   //    longitude: parseFloat(vehicle.data.MDC.LastLongitude),
                   //};
              
               }, function (err) {
                   $interval.cancel(vm.promise);
               });
           }
       }

        // Start of code for Ionic
       vm.ionicInclude = 'app/modules/commuter/location/last-location.html';
       vm.ionicCustomClassName = '';
       vm.ionicHideNavBar = false;
       vm.ionicUseRefresher = false;
        // End of code for Ionic

    }

    
})();

(function () {
	'use strict';

	angular
        .module('oneMVApp')
        .factory('LocationService', LocationService);

	LocationService.$inject = ['$http', '$q'];

	function LocationService($http, $q) {

		var service = {
			getLocation: getLocationFromGoogle,
			getDrivingDistances: getDrivingDistances

		};

		function getDrivingDistances(position, destinations) {
			var deferred = $q.defer();
			var dests = [];
			angular.forEach(destinations, function (value, key) {
				dests.push({ 'lat': value.latitude, 'lng': value.longitude });
			});

			var service = new google.maps.DistanceMatrixService;
			service.getDistanceMatrix({
				origins: [{ 'lat': position.latitude, 'lng': position.longitude }],
				destinations: dests,
				travelMode: 'DRIVING',
				unitSystem: google.maps.UnitSystem.METRIC,
				avoidHighways: false,
				avoidTolls: false
			}, function (response, status) {
				if (status !== 'OK') {
					deferred.reject('Cannot calculate distance');
				} else {
					deferred.resolve(response);
				}
			});
			return deferred.promise;

		}


		function getLocationFromGoogle(searchTerm) {
			var deferred = $q.defer();
			//$http.get('https://maps.googleapis.com/maps/api/geocode/json', {
			//    params: {
			//        address: searchTerm,
			//        sensor: true,
			//        key: 'AIzaSyCA5jVfa7sJk7OYR_dUbTsZrGJA7E1AduI'
			//    }
			//}).then(function successCallback(response) {
			//    deferred.resolve(response);
			//}, function (err) {
			//    deferred.reject(err);
			//});
			//return deferred.promise;



			var geocoder = new google.maps.Geocoder;
			var address = searchTerm;

			if (geocoder) {
				geocoder.geocode({ 'address': address }, function (results, status) {
					if (status == google.maps.GeocoderStatus.OK) {
						deferred.resolve(results);
					}
					else {
						deferred.reject(status);
					}
				});


			}
			else
				deferred.reject('Geocoder service not available');
			return deferred.promise;


		}



		return service;

	}




})();





(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('MessageController', MessageController);

    MessageController.$inject = ['$location', '$uibModalInstance', 'message'];

    function MessageController($location, $uibModalInstance, message) {
        var vm = this;
        vm.title = message.type;
        vm.content = message.message;

        vm.isError = false;
        vm.isInfo = false;
        vm.isSuccess = false;

        vm.cancel = cancel;
        function cancel() {
            $uibModalInstance.close();
        };

        switch (message.type) {
            case 'Error':
                vm.isError = true;
                break;
            case 'Information':
                vm.isInfo = true;
                break;
            case 'Success':
                vm.isSuccess = true;
                break;
        }
    };
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('MessageService', MessageService);

    MessageService.$inject = ['$http', '$uibModal'];

    function MessageService($http, $uibModal) {
        var service = {
            showError: showError,
            showInformation: showInformation,
            showSuccess: showSuccess
        };

        return service;

        function showError(message) {
            showMessage(message, 'Error');
        }
        function showInformation(message) {
            showMessage(message, 'Information');
        }
        function showSuccess(message) {
            showMessage(message, 'Success');
        }

        function showMessage(messageToDisplay, type) {
            var messageObj = {
                message: messageToDisplay,
                type: type
            };
            var modalReserve = $uibModal.open({
                animation: true,
                templateUrl: 'app/modules/commuter/message/message.html',
                controller: 'MessageController as vm',
                size: '-fs',
                backdrop: 'static',
                resolve: {
                    message: messageObj
                }
            });
            modalReserve.result.then(function () {
            });
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('MyVehiclesController', MyVehiclesController);

    MyVehiclesController.$inject = ['$rootScope','$location', '$uibModal', 'authService', 'vehicleService', 'MessageService','LuumLinkedService', 'PageService'];

    function MyVehiclesController($rootScope, $location, $uibModal, authService, vehicleService, MessageService, LuumLinkedService, PageService) {
        var vm = this;
        var passengerId = authService.authentication.passengerId;

        vm.vehicles = [];
        vm.vehicleInfo = undefined;
        vm.isLoading = false;
        vm.isRemoving = false;
        vm.PageService = PageService;
        vm.PageService.setTitle('My Vehicles');
        vm.PageService.setHeadline('Manage Vehicles');

        vm.addNew = function () {
            var modalReserve = $uibModal.open({
                animation: true,
                templateUrl: 'app/modules/commuter/modals/add-vehicle-modal/add-vehicle.html',
                controller: 'AddVehicleController as vm',
                backdrop: 'static',
                resolve: {
                    atleastOneVehicleExist: vm.vehicles.length > 0
                }
            });
            modalReserve.result.then(function (result) {
                if(result.isAdded)
                    getVehicles();
            });
        };
        
        
        vm.remove = function (id, index) {
            if (id) {
                var removeVehicleConfirmation = $uibModal.open({
                    animation: true,
                    templateUrl: 'app/modules/commuter/modals/remove-vehicle-modal/remove-vehicle-confirmation.html',
                    controller: 'RemoveVehicleConfirmationController as vm',
                    size: '-fs',
                    resolve: {
                        id: function () {
                            return id;
                        }
                    }
                });
                removeVehicleConfirmation.result.then(function (result) {
                    if (result.removed) {
                        vm.vehicles.splice(index, 1);
                    }

                    if (result.errorMessage) {
                        MessageService.showError(result.errorMessage);
                    }
                });
            }
        }

        var activate = function () {
            LuumLinkedService.verify(authService.authentication.passengerId);
            getVehicles();
        }

        vm.makeDefault = function (vId, index) {
            vehicleService.markDefault(vId, passengerId)
            .then(function (response) { 
                if (response.data.status == 1)
                    getVehicles();
            }, function (error) {
                essageService.showError(error.data.result);
            });
        };

        var getVehicles = function () {
            vm.isLoading = true;
            vehicleService.getVehiclesForPassenger(passengerId)
              .then(function (response) {
                  if (response.data && response.data.status == 1 && response.data.result.passengerVehicles != null) {
                      vm.vehicles = response.data.result.passengerVehicles;
                      if (vm.vehicles.length > 0) {
                          vm.selectedVehicle = vm.vehicles[0];
                          vm.hasVehicles = true;
                          vm.needsParking = false;
                  }
              }

                  vm.isLoading = false;
            }, function (error) {
                  vm.hasVehicles = false;
                  vm.isLoading = false;
            });
            };

        activate();

        // Start of code for Ionic
        vm.ionicInclude = 'app/modules/commuter/my-vehicles/my-vehicles.html';
        vm.ionicCustomClassName = 'is-myVehicles';
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = true;
        vm.ionicPullingText = 'Refresh Vehicles';
        vm.ionicRefreshingText = 'Loading Vehicles';
        vm.ionicSpinner = 'spiral'; // none to disable.
        vm.refresh = function (refresher) {
            vm.isLoading = true;
            vm.vehicles = [];
            activate();
            $rootScope.$broadcast('scroll.refreshComplete');
            vm.isLoading = false;
        }
        // End of code for Ionic
       

    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('vehicleService', vehicleService);

    vehicleService.$inject = ['$http','$q','env','DivisionService'];

    function vehicleService($http, $q, env, DivisionService) {
        var service = {
            save: saveVehicle,
            getVehiclesForPassenger: getVehicles,
            removeVehicle: deactivateVehicle,
            canPark: getAvailableParkingForStop,
            markDefault :markDefault
        };        

        return service;

        function getVehicles(passengerId) {
            return $http({ method: 'GET', 'url': env.oneMVApiUrl + 'commuter/passengers/' + passengerId + '/vehicles' })
                .then(function (response) {
                    return response;
                }, function (err) { 
                    return err; });
        };

        function saveVehicle(vehicleInfo, passengerId) {
            return $http({ data: vehicleInfo, method: 'POST', 'url': env.oneMVApiUrl + 'commuter/passengers/' + passengerId + '/vehicles' })
                .then(function (response) {
                    return response;
            }, function (err) {
                    return err;
            });
        };

        function deactivateVehicle(vehicleId,passengerId) {            
            return $http({ method: 'PUT', 'url': env.oneMVApiUrl + 'commuter/passengers/' + passengerId + '/vehicles' + '/' + vehicleId + '/deactivate' })
                .then(function (response) {
                return response;
            }, function (err) {
                return err;
            });
        };       

        function markDefault(vehicleId,passengerId) {            
            return $http({ method: 'PUT', 'url': env.oneMVApiUrl + 'commuter/passengers/' + passengerId + '/vehicles' + '/' + vehicleId + '/markDefault' })
                .then(function (response) {
                return response;
            }, function (err) {
                return err;
            });
        };

        //move this out while working on selected stop page
        function getAvailableParkingForStop(stopId, reservationDate) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiUrl + 'commuter/stops/' + stopId + '/availableParking/' + reservationDate;
            return $http({
                method: 'GET',
                'url': serviceUrl
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err);
            });

            return deferred.promise;
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('PublishedScheduleController', PublishedScheduleController);

    PublishedScheduleController.$inject = ['$scope', '$location', 'PublishedScheduleService', '$uibModal', 'StopDataService',
        'MessageService', '$filter', '$anchorScroll', 'PageService','OneMvServices'];

    function PublishedScheduleController($scope, $location, PublishedScheduleService, $uibModal, StopDataService,
        MessageService, $filter, $anchorScroll, PageService,OneMvServices) {

        var vm = this;
        vm.PageService = PageService;
        vm.PageService.setTitle('Published Schedule');
        vm.PageService.setHeadline(OneMvServices.getCommuterInfo().alias);


        var today = new Date();
        var dd = today.getDate();
        var mm = today.getMonth() + 1;
        var yyyy = today.getFullYear();
        vm.date = mm + '/' + dd + '/' + yyyy;
        vm.scheduleBlock = [];
        vm.publicSchedule = [];
        vm.allSchdeuleForStop = [];
        vm.stopsLatLong = [];
        vm.incidentRecords = [];
        vm.futureRoutes = [];
        vm.turnLatLong = [];
        vm.isLoading = true;
        vm.searchBy = "$";
        vm.selectedRoute = StopDataService.getRoute();

        vm.getDropOffPickUpClass = getDropOffPickUpClass;


        PublishedScheduleService.getSchedules(vm.date)
        .then(function (response) {
            vm.incidentRecords = response.data.result.routes;
            vm.filterChange();
            vm.isLoading = false;
        }, function (err) {
            MessageService.showError('Sorry! Could not load the schedules!');
            vm.isLoading = false;
        });

        PublishedScheduleService.getUpComingSchedules(vm.date)
        .then(function (response) {
            vm.futureRoutes = response.data.result;
            vm.isLoading = false;
        }, function (err) {
        });

        //filter users based on search result
        vm.filterChange = function () {
            if (vm.searchText != '' && vm.searchText != undefined) {
                var serchTerm = '{ "' + vm.searchBy + '" : "' + vm.searchText + '" }';
                var serchTermObj = JSON.parse(serchTerm);
                vm.filterIncidents = $filter('filter')(vm.incidentRecords, serchTermObj);

            } else {
                vm.filterIncidents = vm.incidentRecords;
            }

            sortRoutes();
            sortArrivals();

            if (vm.selectedRoute != null && vm.selectedRoute.routeId != null) {
                var newHash = vm.selectedRoute.routeId;
                if ($location.hash() !== newHash) {
                    // set the $location.hash to `newHash` and
                    // $anchorScroll will automatically scroll to it
                    $location.hash(newHash);
                } else {
                    // call $anchorScroll() explicitly,
                    // since $location.hash hasn't changed
                    $anchorScroll();
                }
            }
        };

        function sortRoutes() {
            if (vm.incidentRecords)
                vm.incidentRecords.sort(function (a, b) {
                    return (a.longName.toLowerCase() > b.longName.toLowerCase())
                        ? 1
                        : ((b.longName.toLowerCase() > a.longName.toLowerCase()) ? -1 : 0);
                });
        }

        function sortArrivals() {
            angular.forEach(vm.incidentRecords, function (route) {
                if (route.stops)
                    angular.forEach(route.stops, function (stop) {
                        if (stop.arrivals)
                            stop.arrivals.sort(function (a, b) {
                                return moment(a, 'h:mm a').isAfter(moment(b, 'h:mm a')) ? 1 :
                                    moment(a, 'h:mm a').isBefore(moment(b, 'h:mm a')) ? -1 : 0;
                            });
                    });
            })
        }


        vm.navigateToStop = function (selectedStop) {

            if (selectedStop.isHub) return;

            var stop = {
                'name': selectedStop.name,
                'id': selectedStop.stopId,
                'distance': null,
                'icon': 'images/pin-busstop.svg',
                'latitude': selectedStop.latitude,
                'longitude': selectedStop.longitude,
                'address': selectedStop.address
            };
            StopDataService.setStop(stop);
            var locationIcon = {
                url: 'images/pin-my-location.svg'
            };
            vm.position = {
                "coords": {
                    "latitude": selectedStop.latitude,
                    "longitude": selectedStop.longitude
                },
                "icon": locationIcon
            };
            //if (vm.position != undefined && vm.position != null)
            StopDataService.setGeoLocation(vm.position)
            $location.path('/commuter/selected-stop');
        };

        vm.getMap = function (index) {

            vm.stopsLatLong = vm.filterIncidents[index];

            PublishedScheduleService.getTurnLatLngs(vm.stopsLatLong.id)
            .then(function (response) {
                var routeData = response.data;
                //if (routeData.RouteDir1.Vertices.length > 0) {
                //    vm.turnLatLong = routeData.RouteDir1.Vertices
                //}
                //else
                //{
                //    MessageService.showError('Sorry! Could not load the map, cannot find the stops.');
                //}
                mapPage(routeData);

            }, function (err) {
            });
        };

        vm.getFutureRouteMap = function (route) {

            vm.stopsLatLong = route;

            PublishedScheduleService.getTurnLatLngs(vm.stopsLatLong.RouteId)
            .then(function (response) {
                var routeData = response.data;


                //else
                //{
                //    MessageService.showError('Sorry! Could not load the map, cannot find the stops.');
                //}
                mapPage(routeData);

            }, function (err) {
            });
        };

        function mapPage(routeData) {
            var modalGetMap = $uibModal.open({
                animation: true,
                windowClass: 'map-modal',
                templateUrl: 'app/modules/commuter/modals/stops-map-modal/stops-map.html',
                controller: 'StopsMapController as vm',
                backdrop: 'static',
                size: '-fs',
                resolve: {
                    schedule_stops: function () {
                        return vm.stopsLatLong;
                    },
                    routeData: function () {
                        return routeData;
                    },

                }
            });

            modalGetMap.result.then(function (isDone) {
                if (isDone) {
                }
            }, function () {
            });
        };
        activate();

        function activate() { }

        function getDropOffPickUpClass(isAM, isHub) {
            var className;
            if (isAM) {
                if (isHub)
                    className = 'dropoff';
                else
                    className = 'pickup';
            } else {
                if (isHub)
                    className = 'pickup';
                else
                    className = 'dropoff';
            }
            return className;
        }

        $scope.$on('$locationChangeStart', function (event) {
            StopDataService.setRoute(null);
        });
        // Start of code for Ionic
        vm.ionicInclude = 'app/modules/commuter/published-schedule/published-schedule.html';
        vm.ionicCustomClassName = '';
        vm.ionicUseRefresher = true;
        vm.ionicPullingText = 'Refresh Schedule';
        vm.ionicRefreshingText = 'Loading Schedule';
        vm.ionicSpinner = 'spiral'; // none to disable.
        vm.refresh = function (refresher) {
            activate();
            $scope.$broadcast('scroll.refreshComplete');
        }
        // End of code for Ionic

    }
})();


(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('PublishedScheduleService', PublishedScheduleService);

    PublishedScheduleService.$inject = ['$http', '$q', 'env','DivisionService'];

    function PublishedScheduleService($http, $q, env, DivisionService) {
        var service = {
            getSchedules: getSchedules,
            getIncidents: getIncidents,
            getAllScheduleForStop: getAllScheduleForStop,
            getTurnLatLngs: getTurnLatLngs,
            getUpComingSchedules: getUpComingSchedules
        };

        return service;

        function getSchedules(date) {
            var deferred = $q.defer();
            //get the base url from config.
            var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/schedule/published';
            $http({
                method: 'GET',
                'url': serviceUrl
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;
        }

        function getUpComingSchedules(date) {
            var deferred = $q.defer();
            //get the base url from config.
            var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/schedule/upcoming';
            $http({
                method: 'GET',
                'url': serviceUrl
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;
        }

        function getTurnLatLngs(routeId) {
            var deferred = $q.defer();
            //get the base url from config.
            var serviceUrl = env.oneMVFixedRouteApiUrl + 'route/shapesByRoute/' + routeId + '/206';// + DivisionService.getDivisionId();
            $http({
                method: 'GET',
                'url': serviceUrl
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;
        }

        function getIncidents(blockId, minIncId, incCount) {
            var deferred = $q.defer();
            var includeStops = true;
            //get the base url from config.
            var serviceUrl = env.commuterApiUrl + 'common/' + DivisionService.getDivisionId() + '/incidents/' + blockId;
            $http({
                method: 'GET',
                'url': serviceUrl
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;
        }

        function getAllScheduleForStop(stopId, routeId) {
            var deferred = $q.defer();
            var routeId = 0;
            //get the base url from config.
            var serviceUrl = env.commuterApiUrl + 'common/' + DivisionService.getDivisionId() + '/stop/' + stopId + '?RouteId=' + routeId;
            $http({
                method: 'GET',
                'url': serviceUrl
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;
        }
    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('ScheduleController', ScheduleController);

    ScheduleController.$inject = ['$location', '$stateParams', '$uibModal',
        'ScheduleService', 'env', 'StopDataService', 'uiGmapIsReady', 'ReservationService','DivisionService'];

    function ScheduleController($location, $stateParams, $uibModal,
        ScheduleService, env, StopDataService, uiGmapIsReady, ReservationService, DivisionService) {
        
        var vm = this;

        vm.userId = 'b1c57df3-7604-47eb-bf51-317332a9f6a0' //hard-coding. Waiting for social login task to get over

        //default values set-up
        vm.ScheduleType = "AM";

        //functions exposed to view
        vm.reserve = reserve;
        vm.cancelReservation = cancelReservation;
        vm.changeSchedule = changeSchedule;
        
        //vm.selectedStop = StopDataService.getStop();
        vm.selectedStop = { "name": "Test Stop 1", "id": 152131145, "distance": null, "icon": { "url": "images/pin-busstop-grey.svg" }, "latitude": 43.75514221191406, "longitude": -116.57597351074219, "$$hashKey": "object:113" };
        var currentLocation = StopDataService.getGeoLocation();
        vm.fromLocation = currentLocation !=null ? currentLocation.coords.latitude + ',' + currentLocation.coords.longitude : '';

        vm.center = {
            latitude: 40.651739,
            longitude: -73.953148
        };

        vm.zoom = 10;
        vm.mapControl = {};
        vm.options = {};
        vm.markerEvents = function () {
            //for future?
        };
        vm.showDirections = currentLocation == null;

        var bounds = new google.maps.LatLngBounds();


        uiGmapIsReady.promise().then(function (maps) {       
            
            if(vm.showDirections){
                bounds.extend(new google.maps.LatLng(vm.selectedStop.latitude, vm.selectedStop.longitude));
                vm.mapControl.getGMap().fitBounds(bounds);
                google.maps.event.trigger(vm.mapControl.getGMap(), "resize");
            }
            else{
                mapDirection(vm.fromLocation);
            }
        });
        
        loadIncidents();

        vm.getDirection = function () {

            var geocoder = new google.maps.Geocoder;
            geocoder.geocode({ 'address': vm.fromLocation },
                function (response, status) {
                    if (status === google.maps.GeocoderStatus.OK) {
                        mapDirection(response[0].geometry.location.lat() + ',' + response[0].geometry.location.lng());
                    }
                });            
        };

        var mapDirection = function (start) {

            var directionsDisplay = new google.maps.DirectionsRenderer;
            var directionsService = new google.maps.DirectionsService;
            var directions = document.getElementById('directions');
            directionsDisplay.setPanel(directions);

            directionsService.route({
                origin: start,
                destination: vm.selectedStop.latitude + ',' + vm.selectedStop.longitude,
                travelMode: google.maps.DirectionsTravelMode.DRIVING
            }, function (response, status) {
                if (status === 'OK') {
                    directionsDisplay.setDirections(response);
                    directionsDisplay.setMap(vm.mapControl.getGMap());

                } else {
                    window.alert('Directions request failed due to ' + status);
                }
            });
        };


        vm.navigateToTripPage = function (index) {
            var incident = vm.nonPerformedIncidents[index];
            $location.path('/commuter/selected-trip/' + DivisionService.getDivisionId() + '/' + incident.BlockId + '/' + incident.IncidentId);
        };


        
        function loadIncidents() {
            ScheduleService.getSchedule( vm.selectedStop.id, vm.userId, 0)
                          .then(function (response) {
                              vm.nonPerformedIncidents = response.data;
                          });
        };

        function reserve(incidentToReserve) {
            //alert(incidentToReserve.Vehicle.VehicleName);
            var modalReserve = $uibModal.open({
                animation: true,
                templateUrl: 'app/modules/commuter/modals/reservation-modal/reservation.html',
                controller: 'ReservationController as vm',
                size: '',
                resolve: {
                    incidentToReserve: incidentToReserve,
                    isAdd: true
                }
            });
            modalReserve.result.then(function () {
                //refresh the grid to show the incident as reserved
                loadIncidents();
            });
        };

        function cancelReservation(incidentToCancel) {
            var _reservation = incidentToCancel.TheReservation;
            ReservationService.cancelReservation(_reservation.Id)
            .then(function (response) {
                if (response && response.data && response.data.status == 1) {
                    alert('Reservation Cancelled');
                    loadIncidents();
                } else {
                    alert(response.data.message)
                }
            });
        };


        function changeSchedule() {
            //alert(vm.ScheduleType);
        };
    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('SelectedTripController', SelectedTripController);

    SelectedTripController.$inject = ['SelectedTripService','$stateParams', 'uiGmapIsReady'];

    function SelectedTripController(SelectedTripService, $stateParams, uiGmapIsReady) {
        /* jshint validthis:true */
        var vm = this;
        vm.title = 'Selected Trip';
        var stopId = $stateParams.stopId;
        var startLocation = {};
        var endLocation = {};
        vm.center = {
            latitude: 40.651739,
            longitude: -73.953148
        };

        vm.zoom = 10;
        vm.mapControl = {};
        vm.stopsMarkerArray = [];

        //getMap();

        //function getMap() {
        //    var mapOptions = {
        //        zoom: vm.zoom,
        //        center: vm.center,
        //        mapTypeId: google.maps.MapTypeId.ROADMAP
        //    }
        //    vm.map = new google.maps.Map(document.getElementById('map'), mapOptions);
        //};

        uiGmapIsReady.promise().then(function (maps) {  
            //vm.mapControl.getGMap().fitBounds(bounds);
            google.maps.event.trigger(vm.mapControl.getGMap(), "resize");
        });

        SelectedTripService.getTrips($stateParams.blockId, $stateParams.minIncId, 5)
        .then(function (response) {
            vm.upComingStops = response.data;
            endLocation = vm.upComingStops.slice(-1)[0];
            vm.endStoplocation = endLocation.TheStop;

            for (var i = 0; i < vm.upComingStops.length; i++)
            {
                if (vm.upComingStops[i].TheStop.StopId == stopId)
                {
                    vm.startStopLocation = vm.upComingStops[i].TheStop;
                }
                else {
                    if (vm.upComingStops[i].TheStop.StopId != vm.endStoplocation.StopId) {
                        vm.stopsMarkers = { lat: vm.upComingStops[i].TheStop.Latitude, lng: vm.upComingStops[i].TheStop.Longitude }
                        vm.stopsMarkerArray.push({'location' : vm.stopsMarkers, 'stopover' : false});
                    }
                }                
            }
            mapDirection();
        }, function (err) {
            //alert(err);
        });

        var mapDirection = function () {
            var start = vm.startStopLocation.Latitude + ',' + vm.startStopLocation.Longitude;
            var end = vm.endStoplocation.Latitude + ',' + vm.endStoplocation.Longitude;
            var directionsDisplay = new google.maps.DirectionsRenderer({
                suppressMarkers: true
            });
            var directionsService = new google.maps.DirectionsService;            
            vm.stopsMarkerArray.splice(-1, 1);
            directionsService.route({
                origin: start,
                destination: end,
                waypoints: vm.stopsMarkerArray,
                travelMode: google.maps.DirectionsTravelMode.DRIVING
            }, function (response, status) {
                if (status === 'OK') {
                    directionsDisplay.setDirections(response);
                    directionsDisplay.setMap(vm.mapControl.getGMap());

                } else {
                    window.alert('Directions request failed due to ' + status);
                }
            });
        };
    }
})();


(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('SelectedTripService', SelectedTripService);

    SelectedTripService.$inject = ['$http', '$q','env','DivisionService'];

    function SelectedTripService($http, $q, env, DivisionService) {
        var service = {
            getTrips: getTrips
        };

        return service;

        function getTrips(blockId, minIncId, incCount) {
            var deferred = $q.defer();
            //get the base url from config.
            var serviceUrl = env.commuterApiUrl + 'common' + DivisionService.getDivisionId() + '/incidents/' + blockId + '?minIncId=' + minIncId + '&incCount=' + incCount;
            $http({
                method: 'GET',
                'url': serviceUrl
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;
        }
    }
})();
(function () {
    "use strict";

    angular
        .module('oneMVApp')
        .directive('seatAvailability', seatAvailability);

    seatAvailability.$inject = [];

    function seatAvailability() {
        return {
            restrict: 'E',
            scope: {
                divisionAllowsWaitlist: '=',
                trip:'='
            },
            templateUrl: 'app/modules/commuter/stop/seat-availability.component.html'
        };
    }

})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('SelectedStopController', SelectedStopController);

    SelectedStopController.$inject = ['$location', '$rootScope', '$scope', '$uibModal', '$interval', '$state',
                                      'StopDataService', 'ReservationService', 'authService',
                                       'DivisionService', 'MapService', 'CommonService', 'MapIconService', 'PageService',
                                       'VehicleDataService', 'ScheduleService', 'LuumLinkedService','OneMvServices'];

    function SelectedStopController($location, $rootScope, $scope, $uibModal, $interval, $state,
                                    StopDataService, ReservationService, authService,
                                    DivisionService, MapService, CommonService, MapIconService, PageService,
                                    VehicleDataService, ScheduleService, LuumLinkedService,OneMvServices) {
        var vm = this;
        vm.selectedStop = StopDataService.getStop();
        vm.PageService = PageService;
        vm.PageService.setTitle(vm.selectedStop.name);
        vm.PageService.setHeadline(OneMvServices.getCommuterInfo().alias);

        vm.hubs = [];
        vm.selectedHub = undefined;
        vm.availableParking = 0;
        vm.nonPerformedTrips = [];
        vm.show = false;
        vm.calendarOpened = false;
        vm.passengerReservation = undefined;
        vm.isLoading = false;
        vm.calendar = {};
        vm.calendar.opened = false;
        vm.calendar.dateOptions = {};
        vm.isPassengerLoggedIn = authService.isLoggedIn();
        vm.hasReservation = false;
        vm.advReservationWindow = 14;
        vm.markers = [];
        vm.map = MapService.initializeMap();
        var divisionDate = undefined;
        var mapVehicles = [];
        var vehiclePoll = undefined;
        var markerEvents = [{ event: 'click', callback: iconClickHandler }];        
        vm.divisionAllowsWaitlist = true;
        vm.companionAllowed = false;
        vm.specialEvent = undefined;
        vm.selectGuestDay = selectGuestDay;


        vm.getDirectionsToSelectedStop = function () {
            StopDataService.setStop(vm.selectedStop);
            //StopDataService.setGeoLocation(vm.selectedLocation);
            $location.path('/commuter/directions');
        };

        vm.openMapApp = function () {
            var url = "";
            if ((navigator.platform.indexOf("iPhone") != -1)
         || (navigator.platform.indexOf("iPod") != -1)
                || (navigator.platform.indexOf("iPad") != -1)) {
                url = "http://maps.apple.com/?q=" + vm.selectedStop.latitude + "," + vm.selectedStop.longitude;
            }
            else {
                url = "http://maps.google.com/?q=" + vm.selectedStop.latitude + "," + vm.selectedStop.longitude;
            }

            if (url.length > 0) {
                // For Ionic
                if ($('body').hasClass('platform-cordova')) {
                    window.open(url, '_system', '');
                } else {
                    window.open(url);
                }
            }
        }

        function iconClickHandler(model) {
            vm.show = true;
            vm.coords = model.coords;
        }

        vm.openCalendar = function () {
            vm.calendar.opened = true;
        };

        var addDays = function (date, days) {
            var result = new Date(date);
            result.setDate(result.getDate() + days);
            return result;
        };

        var setDate = function () {
            vm.calendar.dateOptions = {
                'minDate': divisionDate,
                'maxDate': addDays(divisionDate, vm.advReservationWindow)
            };

        };


        function selectGuestDay() {            
            vm.selectedReservationDate = moment(vm.specialEvent.date, 'YYYY-MM-DD HH:mm').toDate();
            vm.dateChanged();
        }

        var activate = function () {
            LuumLinkedService.verify(authService.authentication.passengerId);
            DivisionService
                .getCurrentDivisionTime()
                .then(function (response) {
                    if (response.data.status == 1) {
                        divisionDate = moment(response.data.result, 'YYYY-MM-DD HH:mm').toDate();
                        vm.selectedReservationDate = divisionDate;

                        vm.selectedSchedule = new Date(response.data.result).getHours() < 12 ? CommonService.ScheduleType.Morning : CommonService.ScheduleType.Evening;

                        getMaxDaysForAdvReservation();
                    }
                    else {
                        //fallback 
                        divisionDate = new Date();
                    }
                }, function (err) {
                    divisionDate = new Date();
                });

            DivisionService
                .isWaitlistAllowedByDivision()
            .then(function (response) {
                vm.divisionAllowsWaitlist = response;
            });
            

            DivisionService
                .getCurrentDivisionTime()
                .then(function (response) {
                    if (response.data.status == 1) {
                        divisionDate = moment(response.data.result, 'YYYY-MM-DD HH:mm').toDate();
                        vm.selectedReservationDate = divisionDate;

                        vm.selectedSchedule = new Date(response.data.result).getHours() < 12
                            ? CommonService.ScheduleType.Morning
                            : CommonService.ScheduleType.Evening;

                        getMaxDaysForAdvReservation();

                        getSpecialEvent();

                    }
                    else {
                        //fallback 
                        divisionDate = new moment();
                    }
                }, function (err) {
                    divisionDate = new moment();
                });



        }

        function getSpecialEvent() {
            vm.specialEvent = undefined;
            StopDataService
                .getSpecialEvent(vm.selectedStop.id, vm.selectedSchedule)
                .then(function (response) {
                    if (response && response.data.status == 1 && response.data.result.date) {
                        vm.specialEvent = response.data.result;
                    }
                });
        }



        function getMaxDaysForAdvReservation() {
            StopDataService
                .getMaxDaysAllowedForReservation(vm.selectedStop.id, vm.selectedSchedule)
            .then(function (response) {
                if (response.data.status == 1 && response.data.result) {
                    vm.advReservationWindow = response.data.result;
                    setDate();
                }
            }, function (error) {

                setDate();
            });
        }

        vm.dateChanged = function () {
            //when user clicks on clear button on the calendar, the model is set to null, this will reset the model back to current date
            if (vm.selectedReservationDate == null) {
                vm.selectedReservationDate = divisionDate;
            }
            vm.selectedReservationDate = moment(moment(vm.selectedReservationDate).format('MM/DD/YYYY')).toDate();
			//vm.selectedReservationDate = moment(moment.tz(vm.selectedReservationDate, DivisionService.getTimeZone()).format('MM/DD/YYYY')).toDate();
			
            vm.selectedSchedule = CommonService.ScheduleType.Morning;
            getSpecialEvent();
            getNonPerformedTrips();
        }


        function getPickUp() {
            return vm.selectedSchedule == CommonService.ScheduleType.Morning ? vm.selectedStop : vm.selectedHub;

        }

        function getDropOff() {
            return vm.selectedSchedule == CommonService.ScheduleType.Morning ? vm.selectedHub : vm.selectedStop;
        }


        var getNonPerformedTrips = function () {
            vm.isLoading = true;
            vm.nonPerformedTrips = [];
            vm.passengerReservation = undefined;
            vm.hasReservation = false;
            vm.companionAllowed = false;


            if (vm.selectedHub && vm.selectedSchedule && vm.selectedReservationDate) {
                StopDataService
                .getNonPerformedTrips(getPickUp().id, getDropOff().id, vm.selectedSchedule, reservationTimespan())
                .then(function (response) {
                    if (response.data.status == 1 && response.data.result.NonPerformedTrips) {
                        vm.nonPerformedTrips = response.data.result.NonPerformedTrips;

                        companionsAllowed();

                        getPassengerReservationFor();

                        getCommuterVehicleInfoForTrips();
                        //every time new non performed events are retrieved stop polling for old and start polling
                        stopPolling();
                        pollVehiclesForRoute();
                    }

                    vm.isLoading = false;

                    vm.availableParking = 0;
                    if (vm.nonPerformedTrips.length > 0)
                        getAvailableParkingsForStop();

                }, function (error) {

                });
            }
        }

        function companionsAllowed() {
            for (var i = 0; i < vm.nonPerformedTrips.length; i++) {
                if (vm.nonPerformedTrips[i].allowedCompanions > 0) {
                    vm.companionAllowed = true;
                    break;
                }
            }
        }


        var getPassengerReservationFor = function () {
            if (!vm.isPassengerLoggedIn)
                return;

            ReservationService
            .getUserReservationFor(authService.authentication.passengerId, vm.selectedSchedule, reservationTimespan())
            .then(function (response) {
                if (response.data.status == 1 && response.data.result
                    && response.data.result.reservations) {
                    vm.passengerReservation = response.data.result.reservations[0];
                    vm.hasReservation = true;
                }
            }, function (error) {

            });
        }


        var getAvailableParkingsForStop = function () {
            StopDataService
                .getAvailableParkingsForStop(vm.selectedStop.id, reservationTimespan())
                    .then(
                        function (response) {
                            if (response.data.status == 1) {
                                vm.availableParking = response.data.result;
                            }
                        },
                        function (error) {

                        });
        }

        var getHubs = function () {

            StopDataService
            .getHubs(vm.selectedStop.id, vm.selectedSchedule, reservationTimespan())
            .then(function (response) {
                if (response.data.status == 1) {
                    vm.hubs = response.data.result.hubs;
                    if (vm.hubs.length > 0)
                        vm.selectedHub = vm.hubs[0];
                }
            }, function (error) {

            });
        }


        $scope.$watch('vm.selectedSchedule', function (value) {
            if (value) {
                getHubs();
                getSpecialEvent();
            }
        });


        $scope.$watch('vm.selectedHub', function (value) {
            if (value) {
                getNonPerformedTrips();
                setMarkers();
            }
        });


        function setMarkers() {
            vm.show = false;
            vm.markers = [];

            vm.markers.push({
                latitude: vm.selectedStop.latitude,
                longitude: vm.selectedStop.longitude,
                icon: MapIconService.getCommuterStopIcon(),
                name: vm.selectedStop.name,
                address: vm.selectedStop.address
            });
            vm.markers.push({
                latitude: vm.selectedHub.latitude,
                longitude: vm.selectedHub.longitude,
                icon: MapIconService.getCommuterHubIcon(),
                name: vm.selectedHub.name,
                address: vm.selectedHub.address
            });

            MapService.setMapBounds(vm.markers, markerEvents);
        }

        var reservationTimespan = function () {
            return Date.parse(vm.selectedReservationDate);
        }

        vm.reserve = function (trip) {

            if (!vm.isPassengerLoggedIn) {
                $state.go('login');
                return;
            }

            if (!canReserve(trip)) return;

            var modalReserve = $uibModal.open(getReservationModal(trip));

            modalReserve.result.then(function (result) {
                if (result && result.action === 'close' && result.isReserved) {
                    getNonPerformedTrips();
                }
                else if (result && result.action === 'reservation') {
                    $location.path('/passenger-trips');
                }
                else if (result && result.action === 'vehicle') {
                    showAddVehicleModal(trip);
                }

                $rootScope.$broadcast('reservationChanged');
            });
        }

        function canReserve(trip) {
            if(vm.hasReservation) return false;            

            if (vm.divisionAllowsWaitlist) {
                return trip.totalPassengers >0;
            }            
            else {
                return trip.availableCapacity > 0;
            }
        }


        vm.cancelReservation = function () {
            var reservationInfo =
                {
                    reservationId: vm.passengerReservation.id,
                    routeName: vm.passengerReservation.routeName,
                    passengerId: authService.authentication.passengerId,
                    startTime: vm.passengerReservation.pickupTime,
                    reservationDate: vm.passengerReservation.reservationDate
                };

            var modalCancelReservation = $uibModal.open({
                animation: true,
                templateUrl: 'app/modules/commuter/modals/cancel-reservation-modal/cancel-reservation.html',
                controller: 'CancelReservationController as vm',
                size: '-fs',
                resolve: {
                    reservationInfo: function () {
                        return reservationInfo;
                    }
                }
            });

            modalCancelReservation.result.then(function (result) {
                if (result.isCancel) {
                    getNonPerformedTrips();
                    $rootScope.$broadcast('reservationChanged');
                }
            });
        };

        function getCommuterVehicleInfoForTrips() {
            var commuterVehiclesIds = [];
            var routeId = 0;

            if (vm.nonPerformedTrips.length > 0) {
                routeId = vm.nonPerformedTrips[0].routeId;
                angular.forEach(vm.nonPerformedTrips, function (trip) {
                    if (trip.vehicleId && trip.vehicleId != 0)
                        commuterVehiclesIds.push(trip.vehicleId);
                });

                if (commuterVehiclesIds.length > 0 && routeId != 0)
                    VehicleDataService.GetCommuterVehicles(commuterVehiclesIds, routeId).then(function (response) {
                        if (response && response.data.status == 1) {
                            var vehicles = response.data.result;
                            displayVehicles(vehicles);
                        }
                    }, function (err) {
                        //err here
                    });
            }
        };

        function displayVehicles(vehicles) {
            if (mapVehicles.length > 0)
                angular.forEach(mapVehicles, function (vehicleIcon) {
                    vehicleIcon.setMap(null);
                });
            mapVehicles = [];
            for (var i = 0; i < vehicles.length; i++) {
                var vehicleInfo = vehicles[i];

                var vehicle = new google.maps.Marker({
                    //id: vehicleInfo.id,
                    position: new google.maps.LatLng(vehicleInfo.latitude, vehicleInfo.longitude),
                    map: vm.map.control.getGMap(),
                    optimized: false,
                    flat: true,
                    icon: {
                        path: 'M15.2413122,21.1527861 L11,26 L6.75861856,21.1527069 C2.78910959,19.4927506 0,15.5728475 0,11 C0,4.92486775 4.923532,0 11,0 C17.0751322,0 22,4.923532 22,11 C22,15.5720845 19.2113515,19.4926684 15.2413122,21.1527861 Z',//google.maps.SymbolPath.FORWARD_CLOSED_ARROW,
                        scale: 1.1,
                        fillOpacity: 1,
                        fillColor: '#fff',
                        strokeWeight: 1,
                        strokeOpacity: .3,
                        rotation: vehicleInfo.heading,
                        origin: new google.maps.Point(0, 0),
                        anchor: new google.maps.Point(vehicleInfo.anchorX, vehicleInfo.anchorY)//getAnchor(vehicleInfo.heading)
                    },
                    zIndex: 2
                });

                var vehicleColor = new google.maps.Marker({
                    //id: vehicleInfo.id,
                    position: new google.maps.LatLng(vehicleInfo.latitude, vehicleInfo.longitude),
                    map: vm.map.control.getGMap(),
                    icon: {
                        path: 'M0,10 C0,4.4771525 4.47593818,0 10,0 C15.5228475,0 20,4.47593818 20,10 C20,15.5228475 15.5240618,20 10,20 C4.4771525,20 0,15.5240618 0,10 Z M5,5 L5,13.8 L5.81904762,13.8 L5.81904762,15 L7,15 L7,13.8 L13,13.8 L13,15 L14.1809524,15 L14.1809524,13.8 L15,13.8 L15,5 L5,5 Z M14.6336996,9.71610209 C14.6336996,9.99255627 14.405522,10.2166667 14.1374134,10.2166667 L5.89921665,10.2166667 C5.62512532,10.2166667 5.4029304,10.0022513 5.4029304,9.71610209 L5.4029304,7.11723124 C5.4029304,6.84077706 5.63110799,6.61666667 5.89921665,6.61666667 L14.1374134,6.61666667 C14.4115047,6.61666667 14.6336996,6.83108203 14.6336996,7.11723124 L14.6336996,9.71610209 Z M5.38461538,5.8 C5.38461538,5.5790861 5.56076967,5.4 5.78125,5.4 L14.21875,5.4 C14.4378052,5.4 14.6153846,5.58554688 14.6153846,5.8 C14.6153846,6.0209139 14.4392303,6.2 14.21875,6.2 L5.78125,6.2 C5.56219475,6.2 5.38461538,6.01445313 5.38461538,5.8 Z M5.38461538,11.6 C5.38461538,11.2686292 5.65201099,11 5.99308894,11 L6.69921875,11 C7.03526942,11 7.30769231,11.2783203 7.30769231,11.6 C7.30769231,11.9313708 7.0402967,12.2 6.69921875,12.2 L5.99308894,12.2 C5.65703828,12.2 5.38461538,11.9216797 5.38461538,11.6 Z M12.6923077,11.6 C12.6923077,11.2686292 12.9597033,11 13.3007812,11 L14.0069111,11 C14.3429617,11 14.6153846,11.2783203 14.6153846,11.6 C14.6153846,11.9313708 14.347989,12.2 14.0069111,12.2 L13.3007812,12.2 C12.9647306,12.2 12.6923077,11.9216797 12.6923077,11.6 Z',
                        fillOpacity: 1,
                        strokeOpacity: 0,
                        fillColor: '#555',
                        scale: 1,
                    },

                    zIndex: 3
                });

                mapVehicles.push(vehicle);
                mapVehicles.push(vehicleColor);
            }
        };
        function pollVehiclesForRoute() {
            vehiclePoll = $interval(function () {
                getCommuterVehicleInfoForTrips();

            }, 30000);
        }
        function stopPolling() {
            if (angular.isDefined(vehiclePoll)) {
                $interval.cancel(vehiclePoll);
                vehiclePoll = undefined;
            }

        }

        function getReservationModal(trip) {
            return {
                animation: true,
                templateUrl: 'app/modules/commuter/modals/reservation-modal/reservation.html',
                controller: 'ReservationController as vm',
                size: '-fs',
                backdrop: 'static',
                resolve: {
                    reservationInfo: {
                        'divisionId': DivisionService.getDivisionId(),
                        'passengerId': authService.authentication.passengerId,
                        'pickupStop': getPickUp(),
                        'dropoffStop': getDropOff(),
                        'trip': trip,
                        'scheduleType': vm.selectedSchedule,
                        'reservationDate': vm.selectedReservationDate
                    },
                    isAdd: true
                }
            };
        }

        function showAddVehicleModal(trip) {
            var modalReserve = $uibModal.open({
                animation: true,
                templateUrl: 'app/modules/commuter/modals/add-vehicle-modal/add-vehicle.html',
                controller: 'AddVehicleController as vm',
                backdrop: 'static',
                resolve: {
                    atleastOneVehicleExist: false
                }
            });
            modalReserve.result.then(function (result) {
                vm.reserve(trip);
            });
        }

        vm.goToSchedule = function () {
            StopDataService.setRoute(stop);
            $location.path('/commuter/published-schedule');
        };


        vm.viewReservation = function () {
            var commuterTripModal = $uibModal.open({
                animation: true,
                templateUrl: 'app/modules/shared/trips/commuter-trip-modal.html',
                controller: 'CommuterTripModalController as vm',
                size: '-fs',
                backdrop: 'static',
                keyboard: false,
                resolve: {
                    tripId: vm.passengerReservation.id
                }
            });

            commuterTripModal.result.then(function (response) {
                if (response.cancelled || response.isModified) {
                    getNonPerformedTrips();
                    $rootScope.$broadcast('reservationChanged');
                }
            });
        }

        activate();

        $scope.$on('$destroy', function (event) {
            stopPolling();
        });

        // Start of code for Ionic
        vm.ionicInclude = 'app/modules/commuter/stop/selected-stop.html';
        vm.ionicCustomClassName = '';
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = false;
        // End of code for Ionic
    }


})();

(function() {
    "use strict";

    angular
        .module("oneMVApp")
        .directive("nonPerformedTripComponent", nonPerformedTripComponent);

    function nonPerformedTripComponent() {
        return {
            restrict: "E",
            scope: {
                trip: "=",
                divisionAllowsWaitlist : '='
            },
            templateUrl: "app/modules/commuter/stop/selectedStop-npt.component.html"
        };

    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('StopDataService', StopDataService);

    StopDataService.$inject = ['$q', '$http', 'env', '$cacheFactory', 'localStorageService','DivisionService'];

    function StopDataService($q, $http, env, $cacheFactory, localStorageService, DivisionService) {

        var selectedStop = undefined;
        var cache = $cacheFactory('LocationCache');

        var setSelectedStop = function (stop) {
            //cache.put("stop", stop);
            localStorageService.set('stop', stop);
            selectedStop = stop;
        }
        var clearItemFromStorage = function (key) {
            localStorageService.remove(key);
        }
        var getSelectedStop = function () {
            //return cache.get("stop");
            return localStorageService.get('stop');
        }
        var getIncident = function () {
            return localStorageService.get('incident');
        }
        var setIncident = function (incident) {
            localStorageService.set('incident', incident);
        }
        var getRoute = function () {
            return localStorageService.get('route');
        }
        var setRoute = function (route) {
            localStorageService.set('route', route);
        }
        var getVehicleId = function () {
            return localStorageService.get('vehicle');
        }
        var setVehicleId = function (vehicleId) {
            localStorageService.set('vehicle', vehicleId);
        }
        var currGeoLocation = undefined;

        var setGeoLocation = function (currLocation) {
            localStorageService.set("currLocation", currLocation);
            currGeoLocation = currLocation
        }
        
        var getGeoLocation = function () {
            return localStorageService.get("currLocation");
        }

        function getStopDetails(stopId) {
            var deferred = $q.defer();
            var serviceUrl = env.commuterApiUrl + 'stop/' + DivisionService.getDivisionId() + '/' + stopId;
            $http({
                method: 'GET',
                url: serviceUrl,
                contentType: 'application/json'
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });
            return deferred.promise;
        };

        function getIncidentsForStop(stopId, day) {
            var deferred = $q.defer();
            var serviceUrl = env.commuterApiUrl + 'stop/' + DivisionService.getDivisionId() + '/incidents/' + stopId + '/' + day + '?rnd=' + new Date().getMilliseconds();
            $http({
                method: 'GET',
                url: serviceUrl,
                contentType: 'application/json'
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });
            return deferred.promise;
        }

        function getUserIncidentsForStop(stopId, day, userId) {
            var deferred = $q.defer();
            var serviceUrl = env.commuterApiUrl + 'stop/' + DivisionService.getDivisionId() + '/incidents/' + stopId + '/' + day + '/' + userId + '?rnd=' + new Date().getMilliseconds();
            $http({
                method: 'GET',
                url: serviceUrl,
                contentType: 'application/json'
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });
            return deferred.promise;
        }

        function getUserIncidentsById(incidentId, userId) {
            var deferred = $q.defer();
            var serviceUrl = env.commuterApiUrl + 'stop/' + DivisionService.getDivisionId() + '/incident/' + incidentId + '/' + userId + '?rnd=' + new Date().getMilliseconds();
            $http({
                method: 'GET',
                url: serviceUrl,
                contentType: 'application/json'
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });
            return deferred.promise;
        }
         function getVehicle(vehId)
        {
             var serviceUrl = env.commuterApiUrl + 'common/' + DivisionService.getDivisionId() + '/vehicle/' + vehId + '?rnd=' +new Date().getMilliseconds();
             var deferred = $q.defer();
             if (angular.isUndefined(vehId) || vehId == null)
                 deferred.reject('No Vehicle Found');
             else{
                $http({
                    method: 'GET',
                    'url': serviceUrl
                }).then(function (response) {
                    deferred.resolve(response);
                }, function (err) {
                    deferred.reject(err)
                });
            }
            return deferred.promise;
         }
        
         function getHubs(stopId, scheduleType, timespan) {
             var serviceUrl = env.oneMVApiUrl + 'commuter/' +  DivisionService.getDivisionId() + '/' + stopId + '/hubs/' + scheduleType + '/' + timespan + '?rnd=' + new Date().getMilliseconds();
             var deferred = $q.defer();
             $http({
                 method: 'GET',
                 'url': serviceUrl
             }).then(function (response) {
                 deferred.resolve(response);
             }, function (err) {
                 deferred.reject(err)
             });
             return deferred.promise;
         }

         function getAvailableParkingsForStop(stopId, reservationDate) {
             var serviceUrl = env.oneMVApiUrl + 'commuter/stops/' + stopId + '/availableParking/' + reservationDate + '?rnd=' + new Date().getMilliseconds();
             var deferred = $q.defer();
             $http({
                 method: 'GET',
                 'url': serviceUrl
             }).then(function (response) {
                 deferred.resolve(response);
             }, function (err) {
                 deferred.reject(err)
             });
             return deferred.promise;
         }

         function getNonPerformedTrips(pickupStopId, dropoffStopId, scheduleType, scheduleDate){
             var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/stops/nonperformedtrips/' + pickupStopId + '/' 
                 + dropoffStopId + '/' + scheduleDate + '/' + scheduleType + '?rnd=' + new Date().getMilliseconds();
             var deferred = $q.defer();
             $http({
                 method: 'GET',
                 'url': serviceUrl
             }).then(function (response) {
                 deferred.resolve(response);
             }, function (err) {
                 deferred.reject(err)
             });
             return deferred.promise;
         }       


         function getMaxDaysAllowedForReservation(stopId,scheduleType) {
             var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/stops/' + stopId + '/advancedDays/' + scheduleType +  '?rnd=' + new Date().getMilliseconds();
             var deferred = $q.defer();
             $http({
                 method: 'GET',
                 'url': serviceUrl
             }).then(function (response) {
                 deferred.resolve(response);
             }, function (err) {
                 deferred.reject(err)
             });
             return deferred.promise;
         }


         function getDropoffsForSelectedPickup(stopId) {
             var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/' + stopId + '/dropOffs?rnd=' + new Date().getMilliseconds();
             var deferred = $q.defer();
             $http({
                 method: 'GET',
                 'url': serviceUrl
             }).then(function (response) {
                 deferred.resolve(response);
             }, function (err) {
                 deferred.reject(err)
             });
             return deferred.promise;
         }


         function getTripTimesForAdvancedReservation(pickupStopId, dropoffStopId, scheduleType) {
             var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/alltrips/'
                                + pickupStopId + '/' + dropoffStopId + '/' + scheduleType + '/?rnd=' + new Date().getMilliseconds();
             var deferred = $q.defer();
             $http({
                 method: 'GET',
                 'url': serviceUrl
             }).then(function (response) {
                 deferred.resolve(response);
             }, function (err) {
                 deferred.reject(err)
             });
             return deferred.promise;
         }

         function getAllBusStops() {
             var deferred = $q.defer();
             var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/stops/commuter/0';
             $http({
                 method: 'GET',
                 'url': serviceUrl
             }).then(function (response) {
                 deferred.resolve(response);
             }, function (err) {
                 deferred.reject(err)
             });

             return deferred.promise;
         }


         function getPickupForReturnTrip(amPickup, amHub) {
             var deferred = $q.defer();
             var serviceUrl = env.oneMVApiUrl + 'commuter/pickup/' + DivisionService.getDivisionId() + '/' + amPickup + '/' + amHub;
             $http({
                 method: 'GET',
                 'url': serviceUrl
             }).then(function (response) {
                 deferred.resolve(response);
             }, function (err) {
                 deferred.reject(err)
             });

             return deferred.promise;
         }



         function getSpecialEvent(stopId, schedule) {
             var deferred = $q.defer();
             var serviceUrl = env.oneMVApiUrl + 'commuter/specialEvent/' + DivisionService.getDivisionId() +  '/' + stopId + '/' + schedule;
             $http({
                 method: 'GET',
                 'url': serviceUrl
             }).then(function (response) {
                 deferred.resolve(response);
             }, function (err) {
                 deferred.reject(err)
             });

             return deferred.promise;
         }

        return {
            setStop: setSelectedStop,
            getStop: getSelectedStop,
            setGeoLocation: setGeoLocation,
            getGeoLocation: getGeoLocation,
            getStopDetails: getStopDetails,
            getIncidentsForStop: getIncidentsForStop,
            getUserIncidentsForStop: getUserIncidentsForStop,
            getUserIncidentsById: getUserIncidentsById,
            getVehicle: getVehicle,
            getIncident: getIncident,
            setIncident: setIncident,
            getRoute: getRoute,
            setRoute: setRoute,
            getVehicleId: getVehicleId,
            setVehicleId: setVehicleId,
            clearItem: clearItemFromStorage,
            getHubs: getHubs,
            getAvailableParkingsForStop: getAvailableParkingsForStop,
            getNonPerformedTrips: getNonPerformedTrips,
            getDropoffsForSelectedPickup: getDropoffsForSelectedPickup,
            getTripTimesForAdvancedReservation: getTripTimesForAdvancedReservation,
            getMaxDaysAllowedForReservation: getMaxDaysAllowedForReservation,
            getAllBusStops: getAllBusStops,
            getPickupForReturnTrip: getPickupForReturnTrip,
            getSpecialEvent: getSpecialEvent
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('VehicleDataService', VehicleDataService);

    VehicleDataService.$inject = ['$q', '$http', 'env', '$cacheFactory', 'localStorageService', 'DivisionService'];

    function VehicleDataService($q, $http, env, $cacheFactory, localStorageService, DivisionService) {
        return {
            GetCommuterVehicles : getCommuterVehicles
        };

        function getCommuterVehicles(vehiclesArray, routeId)
        {
            var serviceUrl = env.oneMVApiUrl + 'commuter/' + DivisionService.getDivisionId() + '/CommuterVehicles';
            var deferred = $q.defer();
            $http({
                method: 'GET',
                'url': serviceUrl,
                params: {
                    'vehicleIds': vehiclesArray,
                    'routeId': routeId
                }
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });
            return deferred.promise;
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('LandingController', LandingController);
    LandingController.$inject = ['$window', '$location',
        'ScheduleService', 'uiGmapIsReady', 'DivisionService', 'StopService',
        'googleMapsConfig', 'GeoLocationService','PageService','OneMvServices'];
    function LandingController($window, $location,
        ScheduleService, uiGmapIsReady, DivisionService,StopService,
        googleMapsConfig, GeoLocationService, PageService,OneMvServices) {
        var vm = this;

        PageService.setTitle('Stops / Routes');
        PageService.setHeadline(OneMvServices.getFixedRouteInfo().alias);
        vm.optionSelection = "stop";
        vm.gotoRoutes = gotoRoutes;
        vm.gotoStops = gotoStops;
        var divisionId;
        var gObject;
        var closestPin, otherPin, locationPin, myLocationPin, hubIcon;
        if ($window.navigator.userAgent.indexOf("Trident") > 0 || $window.navigator.userAgent.indexOf("MSIE") > 0) {

            myLocationPin = 'images/pin-my-location.png';

        }
        else {

            myLocationPin = 'images/pin-my-location.svg';

        }
        vm.zoom = 15;
        vm.center = {
                latitude: 39.809860,
                longitude: -98.555183
        };
        vm.myStyles = googleMapsConfig.mapStyles;
        vm.mapOptions = {
            mapTypeControl: false,
            zoomControl: false,
            streetViewControl: false,
            styles: vm.myStyles

        };
        vm.myLocationIcon = {
            url: myLocationPin,
            size: new google.maps.Size(42, 42),
            origin: new google.maps.Point(0, 0),
            anchor: new google.maps.Point(20, 20)
        };
        vm.mapControl = {};
        vm.allStops = [];

        function gotoRoutes() {
            $location.path('fixed-route/allRoutes');
        }

        function gotoStops() {
            $location.path('fixed-route/stops');
        }

        function getMap() {
            uiGmapIsReady.promise().then(function (maps) {


                GeoLocationService.getCurrentPosition().then(function (position) {
                    vm.position = {
                        coords: {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude
                        },
                        icon: vm.myLocationIcon
                    };
                    vm.center.latitude = position.coords.latitude;
                    vm.center.longitude = position.coords.longitude;
                    getStops();

                    google.maps.event.trigger(vm.mapControl.getGMap(), "resize");


                }, function (err) {
                    //position error
                    ScheduleService.getServiceAreaLocation(divisionId).then(function (response) {
                        if (response.data.status == 1) {
                            vm.center.latitude = response.data.result.Latitude;
                            vm.center.longitude = response.data.result.Longitude;
                            if (response.data.result.ZoomLevel !== undefined && response.data.result.ZoomLevel !== null && response.data.result.ZoomLevel != '')
                                vm.zoom = response.data.result.ZoomLevel;
                        }
                    });
                    getStops();
                    google.maps.event.trigger(vm.mapControl.getGMap(), "resize");
                });
            });




        }

        function getStops() {
            var stopss = [];
            var map = vm.mapControl.getGMap();

            StopService.getAllStops(divisionId).then(function (result) {
                var allStops = result.data;
                for (var i = 0; i < allStops.length; i++) {                    
                    var stop = allStops[i];

                        var position = new google.maps.LatLng(stop.Latitude, stop.Longitude);

                        var stopMarker = new google.maps.Marker({
                            position: position,
                            map: map,
                            optimized: false,
                            icon: {
                                path: 'M0,2.99420208 C0,1.34054993 1.34331197,0 2.99420208,0 L17.0057979,0 C18.6594501,0 20,1.34331197 20,2.99420208 L20,17.0057979 C20,18.6594501 18.656688,20 17.0057979,20 L2.99420208,20 C1.34054993,20 0,18.656688 0,17.0057979 L0,2.99420208 Z M6,20 L13.7690812,20 L9.75999999,22.76 L6,20 Z',                                
                                fillOpacity: 1,
                                fillColor: '#F76F1E',
                                strokeWeight: 0,
                                anchor: new google.maps.Point(9, 21),
                                size: new google.maps.Size(20, 23)
                            },
                            zIndex: 5,
                            animation: google.maps.Animation.DROP
                        });

                        var icon = new google.maps.Marker({
                            position: position,
                            map: map,
                            optimized: false,
                            icon: {
                                path: 'M0,0 L0,13.0899217 C0,13.6367269 0.443667457,14.08 1.00653274,14.08 L1.31047619,14.08 L1.31047619,16 L3.2,16 L3.2,14.08 L12.8,14.08 L12.8,16 L14.6895238,16 L14.6895238,14.08 L14.9934673,14.08 C15.5493599,14.08 16,13.6274801 16,13.0899217 L16,0.990078259 C16,0.443273135 15.5553691,0 14.9991283,0 L0,0 Z M15.4139194,7.85557231 C15.4139194,8.12679623 15.1819301,8.34666667 14.9225207,8.34666667 L1.13608738,8.34666667 C0.864695354,8.34666667 0.644688645,8.12790141 0.644688645,7.85557231 L0.644688645,3.07776103 C0.644688645,2.8065371 0.876677992,2.58666667 1.13608738,2.58666667 L14.9225207,2.58666667 C15.1939127,2.58666667 15.4139194,2.80543193 15.4139194,3.07776103 L15.4139194,7.85557231 Z M0.615384615,1.1312207 C0.615384615,0.859927 0.847373962,0.64 1.10678335,0.64 L14.8932166,0.64 C15.1646087,0.64 15.3846154,0.862958984 15.3846154,1.1312207 L15.3846154,1.4287793 C15.3846154,1.700073 15.152626,1.92 14.8932166,1.92 L1.10678335,1.92 C0.835391324,1.92 0.615384615,1.69704102 0.615384615,1.4287793 L0.615384615,1.1312207 Z M0.615384615,10.56 C0.615384615,10.0298066 1.04321759,9.6 1.57207584,9.6 L2.73561646,9.6 C3.26398244,9.6 3.69230769,10.0261102 3.69230769,10.56 C3.69230769,11.0901934 3.26447472,11.52 2.73561646,11.52 L1.57207584,11.52 C1.04370987,11.52 0.615384615,11.0938898 0.615384615,10.56 Z M12.3076923,10.56 C12.3076923,10.0298066 12.7355253,9.6 13.2643835,9.6 L14.4279242,9.6 C14.9562901,9.6 15.3846154,10.0261102 15.3846154,10.56 C15.3846154,11.0901934 14.9567824,11.52 14.4279242,11.52 L13.2643835,11.52 C12.7360176,11.52 12.3076923,11.0938898 12.3076923,10.56 Z M11.423955,11.1999507 C11.6340659,11.3767363 11.5848839,11.5200493 11.3051605,11.5200493 L4.69483948,11.5200493 C4.41912022,11.5200493 4.36801543,11.3749851 4.57604503,11.1999507 L4.19560559,11.5200493 C4.40571649,11.3432637 4.80388725,11.1999507 5.06852983,11.1999507 L10.9314702,11.1999507 C11.203462,11.1999507 11.5963648,11.3450149 11.8043944,11.5200493 L11.423955,11.1999507 Z M11.423955,11.8399507 C11.6340659,12.0167363 11.5848839,12.1600493 11.3051605,12.1600493 L4.69483948,12.1600493 C4.41912022,12.1600493 4.36801543,12.0149851 4.57604503,11.8399507 L4.19560559,12.1600493 C4.40571649,11.9832637 4.80388725,11.8399507 5.06852983,11.8399507 L10.9314702,11.8399507 C11.203462,11.8399507 11.5963648,11.9850149 11.8043944,12.1600493 L11.423955,11.8399507 Z',
                                fillColor: '#fff',
                                fillOpacity: 1,
                                strokeWeight: 0,
                                anchor: new google.maps.Point(7, 19),
                                size: new google.maps.Size(16, 16)
                            },
                            zIndex: 6,
                            animation: google.maps.Animation.DROP
                        });

                        var shadow = new google.maps.Marker({
                            position: position,
                            map: map,
                            optimized: false,
                            icon: {
                                path: 'M-5.83252597,14.3155545 C-6.35350295,13.5889938 -5.4359106,13 -3.78917972,13 L10.1871155,13 C11.8366015,13 13.5969795,13.5902074 14.1170863,14.3155545 L18.5313877,20.4717917 C19.0523647,21.1983524 18.1347724,21.7873462 16.4880415,21.7873462 L2.51174624,21.7873462 C0.862260281,21.7873462 -0.898117751,21.1971389 -1.41822457,20.4717917 L-5.83252597,14.3155545 Z M5.5099714,21.7873462 L13.2594793,21.7873462 L10.1300263,23 L5.5099714,21.7873462 Z',
                                fillColor: '#000',
                                fillOpacity: 0.10,
                                strokeWeight: 0,
                                anchor: new google.maps.Point(9, 21),
                                size: new google.maps.Size(21, 10)

                            },
                            zIndex: 4,
                            animation: google.maps.Animation.DROP
                        });
                    }               

            });
        }
        function activate(callback) {

            divisionId = DivisionService.getDivisionId();
            if (divisionId != null && divisionId != undefined && divisionId != '') {
                if (callback && typeof callback === "function")
                    callback();
            }
            else
                $location.path('dashboard/');
        }


        activate(getMap);

        // Start of code for Ionic
        vm.ionicSpinner = 'spiral'; // none to disable.
        vm.ionicInclude = 'app/modules/fixed-route/Landing/landing.html';
        vm.ionicCustomClassName = 'ionic-fixed-route-landing';
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = false;
        // End of code for Ionic

    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('AllRoutesController', AllRoutesController);
    AllRoutesController.$inject = [ '$scope', '$filter','$location', '$interval',
        'ScheduleService', 'uiGmapIsReady', 'DivisionService', 'RouteService', 'StopService', 'googleMapsConfig', 'PageService','OneMvServices'];
    function AllRoutesController($scope, $filter, $location, $interval,
        ScheduleService, uiGmapIsReady, DivisionService, RouteService, StopService, googleMapsConfig, PageService,OneMvServices) {
        var vm = this;
        var divisionId;
        var bounds;
        var infoWindow = new google.maps.InfoWindow({content: ''});
        vm.displaySelectedRoutes = displaySelectedRoutes;
        vm.displayRoute = displayRoute;
        vm.filterChange = filterChange;
        vm.gotoStops = goToStops;
       
        vm.displayButton = displayButton;
        vm.goToRoute = goToRoute;
        vm.hightlightRoute = hightlightRoute;
        vm.zoom = 15;
        vm.routes = [];
        vm.filteredRoutes = [];
        vm.loading = true;
        var vehiclePoll = undefined;
        var vehicleIconL1 = 'images/marker-bus-l1.svg';
        vm.PageService = PageService;
        vm.PageService.setTitle('Routes');
        PageService.setHeadline(OneMvServices.getFixedRouteInfo().alias);

        vm.vehicles = [];
        vm.allStops = [];
        vm.toStops = [];
        vm.routesOnMap = [];
        vm.center = {
            latitude: 39.809860, 
            longitude: -98.555183
        };
        vm.myStyles = googleMapsConfig.mapStyles;
           
        vm.mapOptions = {
            mapTypeControl: false,
            zoomControl: false,
            streetViewControl: false,
            styles: vm.myStyles

        };
        vm.mapControl = {};
        
        function filterChange(item) {
            if (vm.search_text === undefined || vm.search_text === null || vm.search_text.trim() === '')
                return true;
            return item.name.toLowerCase().indexOf(vm.search_text.toLowerCase()) !== -1 || item.shortName.toLowerCase().indexOf(vm.search_text.toLowerCase()) !== -1;

        }

       
        function displayButton()
        {
            for (var i = 0; i < vm.routes.length; i++)
                if (vm.routes[i].displayOnMap)
                    return true;

            return false;

        }


        function getVehiclesByRoute(routeId) {
            if (vm.routesOnMap[routeId].vehicles !== undefined)
            {
                for (var i = 0; i < vm.routesOnMap[routeId].vehicles.length; i++)
                    vm.routesOnMap[routeId].vehicles[i].setMap(null);
            }
            vm.routesOnMap[routeId].vehicles = [];
           RouteService
                .getVehiclesForRoute(routeId)
                    .then(function (response) {
                        if (response && response.data && response.data.length > 0)
                            mapActiveVehicles(response, routeId);
                    }, vehiclesFailureHandler);
        }


        vm.highlightParent = function (e) {
            angular.element(e.target).parent().addClass('active');
        }
        vm.blurParent = function (e) {
            angular.element(e.target).parent().removeClass('active');
        }
        function hightlightRoute(routeId, show)
        {
            if (vm.routesOnMap[routeId] != undefined && vm.routesOnMap[routeId] != null) {
                if (vm.routesOnMap[routeId].displayOnMap) {
                    for (var index in vm.routesOnMap[routeId].lines) {
                        if (show)
                            vm.routesOnMap[routeId].lines[index].setOptions({ strokeOpacity: 0.8 });
                        else
                            vm.routesOnMap[routeId].lines[index].setOptions({ strokeOpacity: 0.5 });
                    }
                }
            }
        }
        function mapActiveVehicles(response, routeId) {
           

            for (var i = 0; i < response.data.length; i++) {
                var vehicleInfo = response.data[i];

                var vehicle = new google.maps.Marker ({
                    //id: vehicleInfo.id,
                    position: new google.maps.LatLng(vehicleInfo.latitude, vehicleInfo.longitude),
                    map: vm.mapControl.getGMap(),
                    optimized: false,
                    flat: true,
                    icon: {
                        path: 'M15.2413122,21.1527861 L11,26 L6.75861856,21.1527069 C2.78910959,19.4927506 0,15.5728475 0,11 C0,4.92486775 4.923532,0 11,0 C17.0751322,0 22,4.923532 22,11 C22,15.5720845 19.2113515,19.4926684 15.2413122,21.1527861 Z',//google.maps.SymbolPath.FORWARD_CLOSED_ARROW,
                        scale: 1.1,
                        fillOpacity: 1,
                        fillColor: '#fff',
                        strokeWeight: 1,
                        strokeOpacity: .3,
                        rotation: vehicleInfo.heading,
                        origin: new google.maps.Point(0, 0),
                        anchor: new google.maps.Point(vehicleInfo.anchorX, vehicleInfo.anchorY)//getAnchor(vehicleInfo.heading)
                    },
                   zIndex: 2
                });
                var vehicleColor = new google.maps.Marker({
                    //id: vehicleInfo.id,
                    position: new google.maps.LatLng(vehicleInfo.latitude, vehicleInfo.longitude),
                    map: vm.mapControl.getGMap(),
                    icon: {
                        path: 'M0,10 C0,4.4771525 4.47593818,0 10,0 C15.5228475,0 20,4.47593818 20,10 C20,15.5228475 15.5240618,20 10,20 C4.4771525,20 0,15.5240618 0,10 Z M5,5 L5,13.8 L5.81904762,13.8 L5.81904762,15 L7,15 L7,13.8 L13,13.8 L13,15 L14.1809524,15 L14.1809524,13.8 L15,13.8 L15,5 L5,5 Z M14.6336996,9.71610209 C14.6336996,9.99255627 14.405522,10.2166667 14.1374134,10.2166667 L5.89921665,10.2166667 C5.62512532,10.2166667 5.4029304,10.0022513 5.4029304,9.71610209 L5.4029304,7.11723124 C5.4029304,6.84077706 5.63110799,6.61666667 5.89921665,6.61666667 L14.1374134,6.61666667 C14.4115047,6.61666667 14.6336996,6.83108203 14.6336996,7.11723124 L14.6336996,9.71610209 Z M5.38461538,5.8 C5.38461538,5.5790861 5.56076967,5.4 5.78125,5.4 L14.21875,5.4 C14.4378052,5.4 14.6153846,5.58554688 14.6153846,5.8 C14.6153846,6.0209139 14.4392303,6.2 14.21875,6.2 L5.78125,6.2 C5.56219475,6.2 5.38461538,6.01445313 5.38461538,5.8 Z M5.38461538,11.6 C5.38461538,11.2686292 5.65201099,11 5.99308894,11 L6.69921875,11 C7.03526942,11 7.30769231,11.2783203 7.30769231,11.6 C7.30769231,11.9313708 7.0402967,12.2 6.69921875,12.2 L5.99308894,12.2 C5.65703828,12.2 5.38461538,11.9216797 5.38461538,11.6 Z M12.6923077,11.6 C12.6923077,11.2686292 12.9597033,11 13.3007812,11 L14.0069111,11 C14.3429617,11 14.6153846,11.2783203 14.6153846,11.6 C14.6153846,11.9313708 14.347989,12.2 14.0069111,12.2 L13.3007812,12.2 C12.9647306,12.2 12.6923077,11.9216797 12.6923077,11.6 Z',
                        fillOpacity: 1,
                        strokeOpacity: 0,
                        fillColor: vm.routesOnMap[routeId].route.color,
                        scale: 1,
                    },
                   
                    zIndex: 3
                });
                vm.routesOnMap[routeId].vehicles.push(vehicleColor);
                vm.routesOnMap[routeId].vehicles.push(vehicle);
                
            }
        }

        function vehiclesFailureHandler() {

        }
       
      
        function getStopsByRoute(route)
        {
            StopService.getStopsByRoute(divisionId, route.id).then(function (result) {
                var stops = [];
                var routeStops = result.data;
                for (var i = 0; i < routeStops.length; i++)
                {
                    //icon path allows us to rotate icon.
                    var stop = new google.maps.Marker({
                        position: new google.maps.LatLng(routeStops[i].Latitude, routeStops[i].Longitude),
                        icon: {
                            path: 'M0,2.99420208 C0,1.34054993 1.34331197,0 2.99420208,0 L17.0057979,0 C18.6594501,0 20,1.34331197 20,2.99420208 L20,17.0057979 C20,18.6594501 18.656688,20 17.0057979,20 L2.99420208,20 C1.34054993,20 0,18.656688 0,17.0057979 L0,2.99420208 Z M6,20 L13.7690812,20 L9.75999999,22.76 L6,20 Z',
                            fillColor: vm.selectedRoute.color,
                            fillOpacity: 1,
                            strokeWeight: 0,
                            anchor: new google.maps.Point(9, 21),
                            size: new google.maps.Size(20, 23)
                        },
                        zIndex:5
                    });
                    var stopIcon = new google.maps.Marker({
                        position: new google.maps.LatLng(routeStops[i].Latitude, routeStops[i].Longitude),
                        icon: {
                            path: 'M0,0 L0,13.0899217 C0,13.6367269 0.443667457,14.08 1.00653274,14.08 L1.31047619,14.08 L1.31047619,16 L3.2,16 L3.2,14.08 L12.8,14.08 L12.8,16 L14.6895238,16 L14.6895238,14.08 L14.9934673,14.08 C15.5493599,14.08 16,13.6274801 16,13.0899217 L16,0.990078259 C16,0.443273135 15.5553691,0 14.9991283,0 L0,0 Z M15.4139194,7.85557231 C15.4139194,8.12679623 15.1819301,8.34666667 14.9225207,8.34666667 L1.13608738,8.34666667 C0.864695354,8.34666667 0.644688645,8.12790141 0.644688645,7.85557231 L0.644688645,3.07776103 C0.644688645,2.8065371 0.876677992,2.58666667 1.13608738,2.58666667 L14.9225207,2.58666667 C15.1939127,2.58666667 15.4139194,2.80543193 15.4139194,3.07776103 L15.4139194,7.85557231 Z M0.615384615,1.1312207 C0.615384615,0.859927 0.847373962,0.64 1.10678335,0.64 L14.8932166,0.64 C15.1646087,0.64 15.3846154,0.862958984 15.3846154,1.1312207 L15.3846154,1.4287793 C15.3846154,1.700073 15.152626,1.92 14.8932166,1.92 L1.10678335,1.92 C0.835391324,1.92 0.615384615,1.69704102 0.615384615,1.4287793 L0.615384615,1.1312207 Z M0.615384615,10.56 C0.615384615,10.0298066 1.04321759,9.6 1.57207584,9.6 L2.73561646,9.6 C3.26398244,9.6 3.69230769,10.0261102 3.69230769,10.56 C3.69230769,11.0901934 3.26447472,11.52 2.73561646,11.52 L1.57207584,11.52 C1.04370987,11.52 0.615384615,11.0938898 0.615384615,10.56 Z M12.3076923,10.56 C12.3076923,10.0298066 12.7355253,9.6 13.2643835,9.6 L14.4279242,9.6 C14.9562901,9.6 15.3846154,10.0261102 15.3846154,10.56 C15.3846154,11.0901934 14.9567824,11.52 14.4279242,11.52 L13.2643835,11.52 C12.7360176,11.52 12.3076923,11.0938898 12.3076923,10.56 Z M11.423955,11.1999507 C11.6340659,11.3767363 11.5848839,11.5200493 11.3051605,11.5200493 L4.69483948,11.5200493 C4.41912022,11.5200493 4.36801543,11.3749851 4.57604503,11.1999507 L4.19560559,11.5200493 C4.40571649,11.3432637 4.80388725,11.1999507 5.06852983,11.1999507 L10.9314702,11.1999507 C11.203462,11.1999507 11.5963648,11.3450149 11.8043944,11.5200493 L11.423955,11.1999507 Z M11.423955,11.8399507 C11.6340659,12.0167363 11.5848839,12.1600493 11.3051605,12.1600493 L4.69483948,12.1600493 C4.41912022,12.1600493 4.36801543,12.0149851 4.57604503,11.8399507 L4.19560559,12.1600493 C4.40571649,11.9832637 4.80388725,11.8399507 5.06852983,11.8399507 L10.9314702,11.8399507 C11.203462,11.8399507 11.5963648,11.9850149 11.8043944,12.1600493 L11.423955,11.8399507 Z',
                            fillColor: '#fff',
                            fillOpacity: 1,
                            strokeWeight: 0,
                            anchor: new google.maps.Point(7, 19),
                            size: new google.maps.Size(16, 16)
                        },
                        zIndex:6
                    });
                    var stopShadow = new google.maps.Marker({
                        position: new google.maps.LatLng(routeStops[i].Latitude, routeStops[i].Longitude),
                        icon: {
                            path: 'M-5.83252597,14.3155545 C-6.35350295,13.5889938 -5.4359106,13 -3.78917972,13 L10.1871155,13 C11.8366015,13 13.5969795,13.5902074 14.1170863,14.3155545 L18.5313877,20.4717917 C19.0523647,21.1983524 18.1347724,21.7873462 16.4880415,21.7873462 L2.51174624,21.7873462 C0.862260281,21.7873462 -0.898117751,21.1971389 -1.41822457,20.4717917 L-5.83252597,14.3155545 Z M5.5099714,21.7873462 L13.2594793,21.7873462 L10.1300263,23 L5.5099714,21.7873462 Z',
                            fillColor: '#000',
                            fillOpacity: .10,
                            strokeWeight: 0,
                            anchor: new google.maps.Point(9, 21),
                            size: new google.maps.Size(21, 10)
                            
                        },
                        zIndex: 4
                    });
                    stop.setMap(vm.mapControl.getGMap());
                    stopIcon.setMap(vm.mapControl.getGMap());
                   stopShadow.setMap(vm.mapControl.getGMap());
                    //add event listner to call service and render info window.
                   google.maps.event.addListener(stopIcon, 'click', getArrivalsForStop(routeStops[i], stop));

                    stops.push(stop);
                    stops.push(stopIcon);
                    stops.push(stopShadow);

                }
                vm.routesOnMap[route.id].stops = stops;
                google.maps.event.trigger(vm.mapControl.getGMap(), "resize");
            });
        }

        function getArrivalsForStop(stop, marker)
        {
            return function () {
                StopService.getArrivalsByStopId(divisionId, stop.Id).then(function (result) {
                    var arrivals = result.data;
                    var content = '<span style="font-weight: bold;">' + stop.Name + '</span><br />';
                    for (var i = 0; i < arrivals.length; i++) {
                        
                        content += '<span style="color:' + arrivals[i].route.color + ';">' + arrivals[i].route.shortName + '</span><br />';
                        for (var j = 0; j < arrivals[i].trips.length; j++)
                            content += '&nbsp;&nbsp;' + (arrivals[i].trips[j].vehicle.name == null ? 'Bus' : arrivals[i].trips[j].vehicle.name) + ' in ' + arrivals[i].trips[j].etaInMins +
                                 ' minutes <br />';
                    }
                    if (content == '')
                        content = 'No current arrivals at this stop';
                    infoWindow.setContent(content);
                    infoWindow.open(vm.mapControl.getGMap(), marker);
                });
            }
        }
       

        //TODO: add remove lines for check unchcek.
        function displaySelectedRoutes()
        {
            bounds = new google.maps.LatLngBounds();
            for (var rt = 0; rt < vm.filteredRoutes.length; rt++)
            {
                var route = vm.filteredRoutes[rt];
                if(route.displayOnMap)
                {
                    mapRoute(route)
                }
                else {
                    hideRoute(route);
                }
            }
            
        }
        function displayRoute(route)
        {
            
            if (route.displayOnMap)
                mapRoute(route)
            else
                hideRoute(route);
            
        }
        function displayAllVehicles()
        {
            for(var routeId in vm.routesOnMap)
            {
                if (vm.routesOnMap[routeId].displayOnMap)
                {
                    getVehiclesByRoute(routeId);
                }
            }
        }
        function adjustMapBounds()
        {
            var numberOnMap = 0;
            bounds = new google.maps.LatLngBounds();
            for (var route in vm.routesOnMap)
            {
                if (vm.routesOnMap[route].displayOnMap)
                {
                    numberOnMap++;
                    for (var i = 0; i < vm.routesOnMap[route].lines.length; i++) {
                        bounds.union(getLineBounds(vm.routesOnMap[route].lines[i]));
                    }
                }
            }
            if(numberOnMap > 0) 
                vm.mapControl.getGMap().fitBounds(bounds);
        }

        function hideRoute(route)
        {
            if(vm.routesOnMap[route.id]!= undefined && vm.routesOnMap[route.id] != null)
            {
                if (vm.routesOnMap[route.id].displayOnMap) {
                    vm.routesOnMap[route.id].displayOnMap = false;
                    for (var i = 0; i < vm.routesOnMap[route.id].lines.length; i++) {
                        vm.routesOnMap[route.id].lines[i].setMap(null);
                    }
                    for (var i = 0; i < vm.routesOnMap[route.id].stops.length; i++) {
                        vm.routesOnMap[route.id].stops[i].setMap(null);
                    }
                    for (var i = 0; i < vm.routesOnMap[route.id].vehicles.length; i++)
                    {
                        vm.routesOnMap[route.id].vehicles[i].setMap(null);
                    }
                    vm.routesOnMap[route.id].vehicles = [];
                    adjustMapBounds();
                }
            }
        }
        function mapRoute(route)
        {
            if (vm.routesOnMap[route.id] != undefined && vm.routesOnMap[route.id] != null) {
                vm.routesOnMap[route.id].displayOnMap = true;
                for (var i = 0; i < vm.routesOnMap[route.id].lines.length; i++) {
                    vm.routesOnMap[route.id].lines[i].setMap(vm.mapControl.getGMap());
                }
                for (var i = 0; i < vm.routesOnMap[route.id].stops.length; i++) {
                    vm.routesOnMap[route.id].stops[i].setMap(vm.mapControl.getGMap());
                   
                }
                getVehiclesByRoute(route.id);
                adjustMapBounds();

            }
            else {
                vm.routesOnMap[route.id] = { route: route };
                var lines = [];
                vm.selectedRoute = route;
                RouteService.getShapesByRoute(route.id).then(function (result) {
                    var shapes = result.data;
                    for (var i = 0; i < shapes.length; i++) {
                        var decodedPath = google.maps.geometry.encoding.decodePath(shapes[i].line);

                        var line = new google.maps.Polyline({
                            path: decodedPath,
                            strokeColor: route.color,
                            strokeOpacity: 0.5,
                            strokeWeight:5, 
                            icons: [{
                                icon: {
                                    path: google.maps.SymbolPath.FORWARD_OPEN_ARROW,
                                    strokeOpacity: 0,
                                    fillColor: route.color,
                                    fillOpacity: 1,
                                    scale: 2.5
                                },
                                offset: '25px',
                                repeat: '200px',
                              
                            }],
                            zIndex:1
                        });
                        var lineStroke = new google.maps.Polyline({
                            path: decodedPath,
                            strokeColor: '#fff',
                            strokeOpacity: 1.0,
                            strokeWeight: 8,
                            zindex:0
                        });
                        line.setMap(vm.mapControl.getGMap());
                        lineStroke.setMap(vm.mapControl.getGMap());
                        lines.push(line);
                        lines.push(lineStroke);
                        //break;
                    }
                    vm.routesOnMap[route.id].lines = lines;
                    vm.routesOnMap[route.id].displayOnMap = true;
                   
                    getStopsByRoute(route);
                    getVehiclesByRoute(route.id);
                    adjustMapBounds();

                });
            }

        }
        function getMap() {
            uiGmapIsReady.promise().then(function (maps) {
                ScheduleService.getServiceAreaLocation(divisionId).then(function (response) {
                    if (response.data.status == 1) {
                        vm.center.latitude = response.data.result.Latitude;
                        vm.center.longitude = response.data.result.Longitude;
                        if (response.data.result.ZoomLevel !== undefined && response.data.result.ZoomLevel !== null
                            && response.data.result.ZoomLevel != '')
                                vm.zoom = response.data.result.ZoomLevel;

                    }
                    getAllRoutes();                    
                });
            });

        }
        function goToRoute(routeId) {
            $location.path('fixed-route/route/' + routeId);
        }
        function goToStops()
        {
            $location.path('fixed-route/stops');
        }

        function getLineBounds(line) {
            var bound = new google.maps.LatLngBounds();
            line.getPath().forEach(function (item, index) {
                bound.extend(new google.maps.LatLng(item.lat(), item.lng()));
            });
            return bound;
        };

        function getRouteStatus()
        {
            RouteService
               .getRoutes()
                   .then(function (result) {
                       var routes = result.data;
                       for (var index in routes) {
                           var r = $filter('filter')(vm.filteredRoutes, { id: routes[index].id });
                           angular.forEach(r, function(value, key){
                               value.IsActive = routes[index].IsActive;
                            });
                       }

                   }, function () {
                   });
        };
       
        function getAllRoutes() {
            RouteService
                .getRoutes()
                    .then(function (result) {
                        vm.routes = result.data;               
                        vm.filteredRoutes = vm.routes;
                        vm.loading = false;
                        pollVehiclesForRoute();
                    }, function () {
                        vm.loading = false;
                    });
        };
        function getAllStops() {
            vm.allStops = [];
            var stopss = [];
            StopService.getAllStops().then(function (result) {
                var allStops = result.data;
                for (var i = 0; i < allStops.length; i++)
                {
                    if (!stopss.includes(allStops[i].Id))
                    {
                        vm.allStops.push(allStops[i]);
                        stopss.push(allStops[i].Id);
                    }
               }
                vm.allStops.sort(function (a, b) {
                    return a.Name > b.Name ? 1 : a.Name == b.Name ? 0 : -1;
                });
                vm.filteredStops = vm.allStops;

            });
        };
        
        function activate() {
            divisionId = DivisionService.getDivisionId();
            getMap();
        }

        $scope.$on('$destroy', function (event) {
            stopPolling();
        });

        function pollVehiclesForRoute() {
            vehiclePoll = $interval(function () {
                getRouteStatus();
                displayAllVehicles();
            }, 30000);
        }
        function stopPolling() {
            if (angular.isDefined(vehiclePoll)) {
                $interval.cancel(vehiclePoll);
                vehiclePoll = undefined;
            }

        }


        activate();

        // Start of code for Ionic
        vm.ionicSpinner = 'spiral'; // none to disable.
        vm.ionicInclude = 'app/modules/fixed-route/routes/all-routes.html';
        vm.ionicCustomClassName = 'ionic-fixed-route-all-routes';
        vm.ionicUseFixedRouteNav = true;
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = false;
        // End of code for Ionic
    }
  

})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('FrScheduleController', FrScheduleController);

    FrScheduleController.$inject = ['$window', 'FrScheduleService', 'ScheduleService', 'DivisionService',
     'GeoLocationService', 'googleMapsConfig', 'uiGmapIsReady', 'PageService','OneMvServices'];

    function FrScheduleController($window, FrScheduleService, ScheduleService, DivisionService,
         GeoLocationService, googleMapsConfig, uiGmapIsReady, PageService,OneMvServices) {
        /* jshint validthis:true */
        var vm = this;
        vm.schedule;
        var divisionId;
        vm.scheduleView;
        vm.showBackButton = false;
        vm.showTrip = showTrip;
        vm.showSchedules = showSchedules;
        vm.filterEmptyTimes = filterEmptyTimes;
        vm.PageService = PageService;
        vm.PageService.setTitle('Schedule');
        PageService.setHeadline(OneMvServices.getFixedRouteInfo().alias);
        //map stuff
        var closestPin, otherPin, locationPin, myLocationPin, hubIcon;
        if ($window.navigator.userAgent.indexOf("Trident") > 0 || $window.navigator.userAgent.indexOf("MSIE") > 0) {

            myLocationPin = 'images/pin-my-location.png';

        }
        else {

            myLocationPin = 'images/pin-my-location.svg';

        }
        vm.zoom = 15;
        vm.center = {
            latitude: 47.604356,
            longitude: -122.3360817
        };
        vm.myStyles = googleMapsConfig.mapStyles;
        vm.mapOptions = {
            mapTypeControl: false,
            zoomControl: false,
            streetViewControl: false,
            styles: vm.myStyles

        };
        vm.myLocationIcon = {
            url: myLocationPin,
            size: new google.maps.Size(42, 42),
            origin: new google.maps.Point(0, 0),
            anchor: new google.maps.Point(20, 20)
        };
        vm.mapControl = {};
        function getMap() {
            uiGmapIsReady.promise().then(function (maps) {


                GeoLocationService.getCurrentPosition().then(function (position) {
                    vm.position = {
                        coords: {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude
                        },
                        icon: vm.myLocationIcon
                    };
                    vm.center.latitude = position.coords.latitude;
                    vm.center.longitude = position.coords.longitude;

                    google.maps.event.trigger(vm.mapControl.getGMap(), "resize");


                }, function (err) {
                    //position error
                    ScheduleService.getServiceAreaLocation(divisionId).then(function (response) {
                        if (response.data.status == 1) {
                            vm.center.latitude = response.data.result.Latitude;
                            vm.center.longitude = response.data.result.Longitude;
                        }
                    });
                });
            });
        }
        //map stuff

        activate();

        function activate() {
            divisionId = DivisionService.getDivisionId();
            if (divisionId != null && divisionId != undefined && divisionId != '') {
                populateSchedule();
                getMap();
            };

        }

        function populateSchedule() {
            FrScheduleService.getSchedule(divisionId)
                           .then(function (response) {
                               vm.schedule = response.data;
                               vm.scheduleView = angular.copy(vm.schedule);
                           }, function (error) {

                           });
        }

        function showSchedules() {
            if (vm.schedule) {
                vm.scheduleView = vm.schedule;
            } else {
                populateSchedule();
            }
            vm.showBackButton = false;
        }

        function showTrip(tripId) {
            var tripSchedule;
            for (var r = 0; r < vm.schedule.routes.length; r++) {
                for (var s = 0; s < vm.schedule.routes[r].stops.length; s++) {
                    for (var t = 0; t < vm.schedule.routes[r].stops[s].trips.length; t++) {
                        if (vm.schedule.routes[r].stops[s].trips[t].id == tripId) {
                            if (!tripSchedule) {
                                tripSchedule = {};
                                tripSchedule.routes = []
                                tripSchedule.routes.push(angular.copy(vm.schedule.routes[r]));
                                tripSchedule.routes[0].stops = [];
                                tripSchedule.routes[0].stops.push(angular.copy(vm.schedule.routes[r].stops[s]));
                                tripSchedule.routes[0].stops[0].trips = [];
                                tripSchedule.routes[0].stops[0].trips.push(angular.copy(vm.schedule.routes[r].stops[s].trips[t]));
                            } else {
                                var isStopFound = false
                                for (var ss = 0; ss < tripSchedule.routes[0].stops.length; ss++) {
                                    if (vm.schedule.routes[r].stops[s].id == tripSchedule.routes[0].stops[ss].id) {
                                        isStopFound = true;
                                        tripSchedule.routes[0].stops[ss].trips.push(angular.copy(vm.schedule.routes[r].stops[s].trips[t]));
                                    }
                                }
                                if (!isStopFound) {
                                    tripSchedule.routes[0].stops.push(angular.copy(vm.schedule.routes[r].stops[s]));
                                    tripSchedule.routes[0].stops[tripSchedule.routes[0].stops.length - 1].trips = [];
                                    tripSchedule.routes[0].stops[tripSchedule.routes[0].stops.length - 1].trips.push(angular.copy(vm.schedule.routes[r].stops[s].trips[t]));
                                }
                            }

                        }
                    }
                }
            }
            //Bind the trip schedule to the view
            vm.scheduleView = tripSchedule;
            vm.showBackButton = true;
        }

        function filterEmptyTimes(trip) {
            return trip.time.length > 0;
        }

        //UI INTERACTIONS
        //Adds and removes the active class to the parent of an element.
        vm.highlightParent = function (e) {
            angular.element(e.target).parent().addClass('active');
        }
        vm.blurParent = function (e) {
            angular.element(e.target).parent().removeClass('active');
        }

        // Start of code for Ionic
        vm.ionicInclude = 'app/modules/fixed-route/schedule/fr-schedule.html';
        vm.ionicCustomClassName = 'ionic-fixed-route-schedule';
        vm.ionicUseFixedRouteNav = true;
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = false;
        // End of code for Ionic

    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .service('FixedRouteNotificationsService', FixedRouteNotificationsService);

    FixedRouteNotificationsService.$inject = ['$http', '$q', 'env'];

    function FixedRouteNotificationsService($http, $q, env) {
        var service = {
            get: _get
        };
        return service;

        function _get(divisionId) {
            var deferred = $q.defer();
            $http({
                method: 'GET',
                'url': env.oneMVFixedRouteApiUrl + "notifications/" + divisionId
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject();
            });
            return deferred.promise;
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .service('FrScheduleService', FrScheduleService);

    FrScheduleService.$inject = ['$http', '$q', 'env'];

    function FrScheduleService($http, $q, env) {
        var service = {

            getSchedule: _getSchedule

        };
        return service;

        function _get(urlSegment) {
            var deferred = $q.defer();
            $http({
                method: 'GET',
                'url': env.oneMVFixedRouteApiUrl + urlSegment
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject();
            });
            return deferred.promise;
        }

        function _getSchedule(divisionId) {
            return _get('schedule/' + divisionId);
        }
    }
})();
(function () {
    'use strict';

    var app = angular.module('oneMVApp');
    app.factory('RouteService', RouteService);
    RouteService.$inject = ['$http', '$q', 'env', 'DivisionService'];
    function RouteService($http, $q, env, DivisionService)
    {
        function _getRoute(routeId) {
            var divisionId = DivisionService.getDivisionId();
            return _get(routeId + '/' + divisionId);
        }

        function _getRoutes() {
            var divisionId = DivisionService.getDivisionId();
            return _get('allRoutes/' + divisionId);
        }

        function _getShapesByRoute(routeId) {
            var divisionId = DivisionService.getDivisionId();
            return _get('shapesByRoute/' + routeId + '/' + divisionId);
        }

        function _getRoutesForStop(stopId) {
            return _get('routesByStop/' + stopId + '/' + divisionId);
        }

        function _getArrivalsForRoute(routeId, divisionId) {
            return _get(divisionId + '/arrivalsForRoute/' + routeId);
        }

        function _getVehiclesForRoute(routeId) {
            var divisionId = DivisionService.getDivisionId();
            return _get(divisionId + '/vehiclesByRoute/' + routeId);
        }


        function _get(urlSegment) {
            var deferred = $q.defer();
            $http({
                method: 'GET',
                'url': env.oneMVFixedRouteApiUrl + 'route/' + urlSegment
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject();
            });
            return deferred.promise;
        }


        var service = {
            getRouteInfo : _getRoute,
            getRoutes: _getRoutes,
            getShapesByRoute: _getShapesByRoute,
            getRoutesForStop: _getRoutesForStop,
            getArrivalsForRoute: _getArrivalsForRoute,
            getVehiclesForRoute : _getVehiclesForRoute
        };

        return service;        
    }
})();
(function () {
    'use strict';

    angular.module('oneMVApp')
           .factory('StopService', StopService);

    StopService.$inject = ['$http', '$q', 'env'];

    function StopService($http, $q, env) {
        var service = {

            getStopsByRoute: _getStopsByRoute,
            getArrivalsForStop: _getArrivalsForStop,
            getAllStops: _getAllStops,
            getStopsForStop: _getStopsForStop,
            getArrivalsByStopId: _getArrivalsByStopId,
            getUpcomingArrivalsForStop: _getUpcomingArrivalsForStop
        };
        return service;

        function _getAllStops(divisionId) {
            return _get('stops/' + divisionId);
        }

        function _getStopsByRoute(divisionId, routeId) {
            return _get('stops/' + divisionId + '/stopsByRoute/' + routeId);
        }

        function _getArrivalsForStop(divisionId, fromStopId, toStopId) {
            return _get('stops/' + divisionId + '/arrivalsByStop/' + fromStopId + '/' + toStopId);
        }

        function _getUpcomingArrivalsForStop(divisionId, fromStopId, toStopId, noOfArrivals) {
            return _get('stops/' + divisionId + '/arrivalsByStop/' + fromStopId + '/' + toStopId + '/' + noOfArrivals + '?rnd=' + new Date().getTime());
        }

        function _getStopsForStop(stopId) {
            return _get('stopsByStop/' + stopId);
        }
        function _getArrivalsByStopId(divisionId, stopId) {
            return _get('stops/' + divisionId + '/arrivals/' + stopId);
        }

       

        function _get(urlSegment) {
            var deferred = $q.defer();
            $http({
                method: 'GET',
                'url': env.oneMVFixedRouteApiUrl + urlSegment
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject();
            });
            return deferred.promise;
        }       
    }
})();
(function () {
    'use strict';

    var app = angular.module('oneMVApp');
    app.factory('VehicleService', VehicleService);
    VehicleService.$inject = ['$http', '$q', 'ConfigFactory', 'env', 'DivisionService'];

    function VehicleService($http, $q, ConfigFactory, env, DivisionService)
    {

        var service = {
            
          
            getVehiclesForRoute: _getVehiclesForRoute
        
        };
        return service;
        
        
        
        
        function _getVehiclesForRoute(routeId) {
            var divisionId = DivisionService.getDivisionId();
            var url = _getUrl();
            var deferred = $q.defer();
            $http({
                method: 'GET',
                'url': url + 'fixedroute/' + divisionId + '/vehiclesByRoute/' + routeId
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject();
            });
            return deferred.promise;
        }
        function _getUrl()
        {
            return env.oneMVFixedRouteApiUrl;
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('FrStopsController', FrStopsController);

    FrStopsController.$inject = ['$location', '$window', 'StopService', 'DivisionService', 'GeoLocationService',
        'ScheduleService', 'googleMapsConfig', 'uiGmapIsReady', 'RouteService', 'PageService','OneMvServices'];

    function FrStopsController($location, $window, StopService, DivisionService, GeoLocationService,
         ScheduleService, googleMapsConfig, uiGmapIsReady, RouteService, PageService,OneMvServices) {
        var vm = this;
        vm.selectedFromStop;
        vm.selectedToStop;
        vm.allStops;
        vm.fromStops;
        vm.toStops;
        vm.populateFromStops = populateFromStops;
        vm.selectFromStop = selectFromStop;
        vm.populateToStops = populateToStops;
        vm.selectToStop = selectToStop;
        vm.gotoRoutes = gotoRoutes;
        vm.gotoStops = gotoStops;
        vm.handleKeyPress = handleKeyPress;
        vm.mapRoute = mapRoute;
        vm.clearPins = clearPins;
        vm.loading = false;
        vm.upcomingSchedules;
        vm.showFromStops = true;
        vm.showToStops = false;
        vm.showRoutes = false;
        vm.divisionId = DivisionService.getDivisionId();
        var fromStopPin = 'images/bus-green.svg';
        var toStopPin = 'images/bus-darkblue.svg';
        var markers = [];
        var bounds;
        vm.routesOnMap = [];
        vm.activeSchedule;
        vm.isAnyRouteSelected = false;
        vm.PageService = PageService;
        vm.PageService.setTitle('Stops');
        PageService.setHeadline(OneMvServices.getFixedRouteInfo().alias);
        //var infoWindow = new google.maps.InfoWindow({ content: '' });

        activate();

        //map stuff
        var closestPin, otherPin, locationPin, myLocationPin, hubIcon;
        if ($window.navigator.userAgent.indexOf("Trident") > 0 || $window.navigator.userAgent.indexOf("MSIE") > 0) {

            myLocationPin = 'images/pin-my-location.png';

        }
        else {

            myLocationPin = 'images/pin-my-location.svg';

        }
        vm.zoom = 15;
        vm.center = {
            latitude: 47.604356,
            longitude: -122.3360817
        };
        vm.myStyles = googleMapsConfig.mapStyles;
        vm.mapOptions = {
            mapTypeControl: false,
            zoomControl: false,
            streetViewControl: false,
            styles: vm.myStyles

        };
        vm.myLocationIcon = {
            url: myLocationPin,
            size: new google.maps.Size(42, 42),
            origin: new google.maps.Point(0, 0),
            anchor: new google.maps.Point(20, 20)
        };
        vm.mapControl = {};
        function getMap() {
            uiGmapIsReady.promise().then(function (maps) {
                GeoLocationService.getCurrentPosition().then(function (position) {
                    vm.position = {
                        coords: {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude
                        },
                        icon: vm.myLocationIcon
                    };
                    vm.center.latitude = position.coords.latitude;
                    vm.center.longitude = position.coords.longitude;

                    google.maps.event.trigger(vm.mapControl.getGMap(), "resize");


                }, function (err) {
                    //position error
                    ScheduleService.getServiceAreaLocation(vm.divisionId).then(function (response) {
                        if (response.data.status == 1) {
                            vm.center.latitude = response.data.result.Latitude;
                            vm.center.longitude = response.data.result.Longitude;
                        }
                    });
                });
            });
        }
        function getLineBounds(line) {
            var bound = new google.maps.LatLngBounds();
            line.getPath().forEach(function (item, index) {
                bound.extend(new google.maps.LatLng(item.lat(), item.lng()));
            });
            return bound;
        };
        function setMapBounds() {
            var bounds = new google.maps.LatLngBounds();
            for (var i = 0; i < markers.length; i++)
                bounds.extend(markers[i].position);
            vm.mapControl.getGMap().fitBounds(bounds);
            vm.mapControl.getGMap().setZoom(vm.mapControl.getGMap().getZoom() - 1);

        }
        function adjustMapBounds() {
            var numberOnMap = 0;
            bounds = new google.maps.LatLngBounds();
            for (var route in vm.routesOnMap) {
                if (vm.routesOnMap[route].displayOnMap) {
                    numberOnMap++;
                    for (var i = 0; i < vm.routesOnMap[route].lines.length; i++) {
                        bounds.union(getLineBounds(vm.routesOnMap[route].lines[i]));
                    }
                }
            }
            if (numberOnMap > 0)
                vm.mapControl.getGMap().fitBounds(bounds);
        }
        function hideRouteOnMap(route) {
            if (vm.routesOnMap[route.id] != undefined && vm.routesOnMap[route.id] != null) {
                if (vm.routesOnMap[route.id].displayOnMap) {
                    vm.routesOnMap[route.id].displayOnMap = false;
                    for (var i = 0; i < vm.routesOnMap[route.id].lines.length; i++) {
                        vm.routesOnMap[route.id].lines[i].setMap(null);
                    }
                    adjustMapBounds();
                }
            }
        }
        function clearAllRoutesOnMap() {
            for (var r = 0; r < vm.routesOnMap.length; r++) {
                if (vm.routesOnMap[r] != undefined && vm.routesOnMap[r] != null) {
                    if (vm.routesOnMap[r].displayOnMap) {
                        vm.routesOnMap[r].displayOnMap = false;
                        for (var i = 0; i < vm.routesOnMap[r].lines.length; i++) {
                            vm.routesOnMap[r].lines[i].setMap(null);
                        }
                        adjustMapBounds();
                    }
                }
            }
        }
        function showRouteOnMap(route) {
            if (vm.routesOnMap[route.id] != undefined && vm.routesOnMap[route.id] != null) {
                vm.routesOnMap[route.id].displayOnMap = true;
                for (var i = 0; i < vm.routesOnMap[route.id].lines.length; i++) {
                    vm.routesOnMap[route.id].lines[i].setMap(vm.mapControl.getGMap());
                }
                adjustMapBounds();

            } else {
                vm.routesOnMap[route.id] = {
                };
                var lines = [];
                RouteService.getShapesByRoute(route.id).then(function (result) {
                    var shapes = result.data;
                    for (var i = 0; i < shapes.length; i++) {
                        var decodedPath = google.maps.geometry.encoding.decodePath(shapes[i].line);

                        //var line = new google.maps.Polyline({
                        //    path: decodedPath,
                        //    strokeColor: route.color,
                        //    strokeOpacity: 1.0,
                        //    strokeWeight: 2,
                        //    icons: [{
                        //        icon: {
                        //            path: google.maps.SymbolPath.FORWARD_OPEN_ARROW
                        //        },
                        //        offset: '25px',
                        //        repeat: '100px'
                        //    }]

                        //});
                        var line = new google.maps.Polyline({
                            path: decodedPath,
                            strokeColor: route.color,
                            strokeOpacity: 0.5,
                            strokeWeight: 5,
                            icons: [{
                                icon: {
                                    path: google.maps.SymbolPath.FORWARD_OPEN_ARROW,
                                    strokeOpacity: 0,
                                    fillColor: route.color,
                                    fillOpacity: 1,
                                    scale: 2.5
                                },
                                offset: '25px',
                                repeat: '200px',

                            }],
                            zIndex: 1
                        });
                        var lineStroke = new google.maps.Polyline({
                            path: decodedPath,
                            strokeColor: '#fff',
                            strokeOpacity: 1.0,
                            strokeWeight: 8,
                            zindex: 0
                        });

                        line.setMap(vm.mapControl.getGMap());
                        lineStroke.setMap(vm.mapControl.getGMap());
                        lines.push(line);
                        lines.push(lineStroke);
                    }
                    vm.routesOnMap[route.id].lines = lines;
                    vm.routesOnMap[route.id].displayOnMap = true;
                    adjustMapBounds();

                });
            }
        };
        function dropStopMarker(stop, fromTo) {

          
            var stopMarker = new google.maps.Marker({
                position: new google.maps.LatLng(stop.Latitude, stop.Longitude),
                optimized: false,
                icon: { url: fromTo == "from" ? fromStopPin : toStopPin, scaledSize: new google.maps.Size(28, 24) },
                animation: google.maps.Animation.DROP
            });
            stopMarker.id = stop.Id;
           stopMarker.setMap(vm.mapControl.getGMap());
            markers.push(stopMarker);
            google.maps.event.addListener(stopMarker, 'click', showStopNameWindow(stop, stopMarker));
        };
        function showStopNameWindow(stop, marker) {
            var infoWindow = new google.maps.InfoWindow({ content: '' });
            return function () {
                var content = '<span style="font-weight: bold;">' + stop.Name + '</span><br />';
                infoWindow.setContent(content);
                infoWindow.open(vm.mapControl.getGMap(), marker);
            }
        };
        function deleteMarker(id) {
            //First clear all the routes on the map
            clearAllRoutesOnMap();
            //Find and remove the marker from the Array
            for (var i = 0; i < markers.length; i++) {
                if (markers[i].id == id) {
                    //Remove the marker from Map                  
                    markers[i].setMap(null);
                    //Remove the marker from array.
                    markers.splice(i, 1);
                    return;
                }
            }
        };
        //map stuff

        function gotoRoutes() {
            $location.path('fixed-route/allRoutes')
        }

        function gotoStops() {
            $location.path('fixed-route/stops')
        }

        function activate() {
            if (vm.divisionId != null && vm.divisionId != undefined && vm.divisionId != '') { getMap(); };
 
            $("#txtFromStopName").parent().addClass('active');//Activate the class to highlight the input control
            populateFromStops();//Load the from stops
        }

        //UI INTERACTIONS
        //Adds and removes the active class to the parent of an element.
        vm.highlightParent = function (e) {
            angular.element(e.target).parent().addClass('active');
        }
        vm.blurParent = function (e) {
            angular.element(e.target).parent().removeClass('active');
        }

        //Fix to handle user hitting backspace to clear the stop.
        function handleKeyPress(e, fromTo) {
            if ( (e && e.keyCode === 8) && //check for backspace
                 (e.currentTarget && e.currentTarget.selectionStart == 0 && e.currentTarget.selectionEnd == e.currentTarget.value.length)) { //check when backspace is hit, if the whole text is selected
                if (fromTo == "from") {
                    vm.fromStopName = "";
                    clearFromStop();
                } else {
                    vm.toStopName = "";
                    clearToStop();
                }
            }
        }


        function populateFromStops() {
            vm.showFromStops = true;
            vm.showToStops = false;
            vm.showRoutes = false;
            vm.loading = true;
            vm.fromStops = [];
            if (vm.selectedFromStop) {
                $("#txtFromStopName").select();
            }

            if (vm.allStops && vm.allStops.length > 0) {
                var filteredList = [];
                if (vm.selectedToStop) {
                    for (var i = 0; i < vm.allStops.length; i++) {
                        if (vm.allStops[i].Id != vm.selectedToStop.Id) {
                            filteredList.push(vm.allStops[i])
                        }
                    }
                } else {
                    filteredList = vm.allStops;
                }
                vm.loading = false;
                vm.fromStops = filteredList;
            } else {
                StopService.getAllStops(vm.divisionId)
                           .then(function (response) {
                               vm.loading = false;
                               vm.allStops = response.data;
                               vm.fromStops = vm.allStops;
                           }, function (error) {

                           });
            }
        }

        function populateToStops() {
            vm.showFromStops = false;
            vm.showToStops = true;
            vm.showRoutes = false;
            vm.loading = true;
            vm.toStops = [];
            if (vm.selectedToStop) {
                $("#txtToStopName").select();
            }

            if (vm.allStops && vm.allStops.length > 0) {
                var filteredList = [];
                if (vm.selectedFromStop) {
                    for (var i = 0; i < vm.allStops.length; i++) {
                        if (vm.allStops[i].Id != vm.selectedFromStop.Id) {
                            filteredList.push(vm.allStops[i])
                        }
                    }
                } else {
                    filteredList = vm.allStops;
                }
                vm.loading = false;
                vm.toStops = filteredList;
            } else {
                StopService.getAllStops(vm.divisionId)
                           .then(function (response) {
                               vm.loading = false;
                               vm.allStops = response.data;
                               vm.toStops = vm.allStops;
                           }, function (error) {

                           });
            }
        }

        function selectFromStop(stop) {
            if (vm.selectedFromStop) { deleteMarker(vm.selectedFromStop.Id) };
            vm.selectedFromStop = stop;
            vm.fromStopName = vm.selectedFromStop.Name;

            dropStopMarker(stop, "from");

            if (!vm.selectedToStop) {
                $("#txtToStopName").focus();
                $("#txtFromStopName").parent().removeClass('active');//Remove the class to highlight the input control
                $("#txtToStopName").parent().addClass('active');//Activate the class to highlight the input control

                populateToStops();
            } else {
                showRoutesForSelectedStops();
            };
        }

        function selectToStop(stop) {
            if (vm.selectedToStop) { deleteMarker(vm.selectedToStop.Id) };
            vm.selectedToStop = stop;
            vm.toStopName = vm.selectedToStop.Name;

            dropStopMarker(stop, "to");

            if (!vm.selectedFromStop) {
                $("#txtFromStopName").focus();
                populateFromStops();
            } else {
                showRoutesForSelectedStops();
            };
        };

        


        function mapRoute(schedule) {
            if (schedule.isSelected) {
                showRouteOnMap(schedule.route);
                vm.activeSchedule = schedule;
                vm.isAnyRouteSelected = true;
            } else {
                hideRouteOnMap(schedule.route);
                vm.activeSchedule = null;
            }
            vm.isHidden = schedule.isSelected;
        };

        function clearFromStop() {
            deleteMarker(vm.selectedFromStop.Id)
            vm.selectedFromStop = null;
            populateFromStops();
        };

        function clearToStop() {
            deleteMarker(vm.selectedToStop.Id)
            vm.selectedToStop = null;
            populateToStops();
        };

        function showRoutesForSelectedStops() {
            setMapBounds();
            if (!vm.selectedFromStop) {
                $("#txtFromStopName").focus();
                populateFromStops();
                return;
            };

            if (!vm.selectedToStop) {
                $("#txtToStopName").focus();
                populateToStops();
                return;
            };

            vm.showFromStops = false;
            vm.showToStops = false;
            vm.showRoutes = true;
            vm.loadingRoutes = true;
            StopService.getArrivalsForStop(vm.divisionId, vm.selectedFromStop.Id, vm.selectedToStop.Id)
                      .then(function (response) {
                          vm.loadingRoutes = false;
                          vm.upcomingSchedules = response.data;
                          for (var i = 0; i < vm.upcomingSchedules.length; i++) {
                              vm.upcomingSchedules[i].isSelected = false;
                          }
                          vm.isAnyRouteSelected = false;
                      }, function (error) {

                      });
        }

        function clearPins() {
            vm.isHidden = !vm.isHidden;
            if (!vm.isHidden) {
                for (var i = 0; i < vm.upcomingSchedules.length; i++) {
                    vm.upcomingSchedules[i].isSelected = false;
                }
                vm.isAnyRouteSelected = false;
                clearAllRoutesOnMap();
            }
        };

                // Start of code for Ionic
        vm.ionicInclude = 'app/modules/fixed-route/stops/fr-stops.html';
        vm.ionicCustomClassName = 'ionic-fixed-route-stops';
        vm.ionicUseFixedRouteNav = true;
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = false;
        // End of code for Ionic

    }

})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('StopsForRouteController', StopsForRouteController);

    StopsForRouteController.$inject = ['$state', '$stateParams', '$interval', '$scope',
        'GeoLocationService', 'googleMapsConfig', 'uiGmapIsReady', 'RouteService',
         'DivisionService', 'ScheduleService', 'PortalUtilityService', 'PageService','OneMvServices'];

    function StopsForRouteController($state, $stateParams, $interval, $scope,
        GeoLocationService, googleMapsConfig, uiGmapIsReady, RouteService,
         DivisionService, ScheduleService, PortalUtilityService, PageService,OneMvServices) {

        var vm = this;        
        var vehiclePoll = undefined;
        var arrivalPoll = undefined;
        var divisionId = undefined;
        var routeId = undefined;
        var vehiclePollInterval = 20000;
        var arrivalPollInterval = 20000;
        var fixedRouteLandingRoute = 'fixed-route-landing';
        var stopsLoaded = false;

        vm.PageService = PageService;
        vm.PageService.setTitle('Stops for Route');
        PageService.setHeadline(OneMvServices.getFixedRouteInfo().alias);

        function activate() {
            vm.route = {};
            vm.routeArrivals = [];
            vm.loading = true;
            vm.vehicleMarkers = [];
            vm.selectedStopId = '';

            vm.mapControl = {};
            vm.zoom = 15;
            vm.center = { latitude: 47.604356, longitude: -122.3360817 };
            vm.mapOptions = {
                mapTypeControl: false,
                zoomControl: false,
                streetViewControl: false,
                styles: googleMapsConfig.mapStyles
            };

            if (!PortalUtilityService.hasValue($stateParams.routeId))
                $state.go(fixedRouteLandingRoute);

            routeId = $stateParams.routeId;
            divisionId = DivisionService.getDivisionId();

            if (!PortalUtilityService.hasValue(divisionId))
                $state.go('division');

            RouteService
                .getRouteInfo(routeId)
                    .then(function (response) {
                        if (response && response.data) {
                            vm.route = response.data;
                            getMap();
                        }
                    }, function (error) {
                        $state.go(fixedRouteLandingRoute);
                    })
            .then(getStopArrivalsForRoute);
        }       
        function getPinUrl() {
            return PortalUtilityService.isIE() ?
                'images/pin-my-location.png'
                : 'images/pin-my-location.svg';
        }

        function getMap() {
            uiGmapIsReady
                .promise()
                    .then(getMapInfo)
                        .then(getShapeForRoute)
                            .then(getVehiclesForRoute)
                                .then(pollVehiclesForRoute);
        }

        function getMapInfo(maps) {
            GeoLocationService
                .getCurrentPosition()
                    .then(currentPositionSuccessHandler, currentPositionFailureHandler)
        }

        function currentPositionSuccessHandler(position, maps) {
            vm.position = {
                coords: {
                    latitude: position.coords.latitude,
                    longitude: position.coords.longitude
                },
                icon: getLocationIcon()
            };
            vm.center.latitude = position.coords.latitude;
            vm.center.longitude = position.coords.longitude;

            google.maps.event.trigger(vm.mapControl.getGMap(), "resize");
        }

        function getLocationIcon() {
            return {
                url: getPinUrl(),
                size: new google.maps.Size(42, 42),
                origin: new google.maps.Point(0, 0),
                anchor: new google.maps.Point(20, 20)
            }
        }


        function currentPositionFailureHandler(err) {
            ScheduleService.getServiceAreaLocation(divisionId).then(function (response) {
                if (response.data.status == 1) {
                    vm.center.latitude = response.data.result.Latitude;
                    vm.center.longitude = response.data.result.Longitude;
                }
            });
        }

        function getVehiclesForRoute() {
            RouteService
                .getVehiclesForRoute(routeId)
                    .then(vehiclesSuccessHandler, vehiclesFailureHandler);
        }


        function vehiclesSuccessHandler(response) {
            if (response && response.data && response.data.length > 0)
                mapActiveVehicles(response);
        }

        function mapActiveVehicles(response) {

            for (var i = 0; i < response.data.length; i++) {
                var vehicleInfo = response.data[i];                                                

                if (contains(vm.vehicleMarkers, vehicleInfo.id) > -1) {
                    var position = new google.maps.LatLng(vehicleInfo.latitude, vehicleInfo.longitude);

                    updateMarkers(vehicleInfo);
                }
                else {
                    var headingMarker = getHeadingMarker(vehicleInfo);
                    var vehicleMarker = getVehicleMarker(vehicleInfo);

                    vm.vehicleMarkers.push(headingMarker);
                    vm.vehicleMarkers.push(vehicleMarker);
                }
            }
        }


        function updateMarkers(vehicleInfo) {
            var markers = findAll(vm.vehicleMarkers, vehicleInfo.id);
            var map = vm.mapControl.getGMap();
            var position = new google.maps.LatLng(vehicleInfo.latitude, vehicleInfo.longitude);

            for (var i = 0; i < markers.length; i++) {

                var marker = markers[i];
                if (marker.markerType === 'heading') {
                    var icon = marker.getIcon();
                    icon.rotation = vehicleInfo.heading;
                    icon.anchor = new google.maps.Point(vehicleInfo.anchorX, vehicleInfo.anchorY)//getAnchor(heading);
                    icon.origin = new google.maps.Point(0, 0);
                    marker.setIcon(icon);
                }
                 

                marker.setDuration(vehiclePollInterval);
                marker.setPosition(position);

                google.maps.event.trigger(map, "resize");
            }
        }

        function getHeadingMarker(vehicleInfo) {            
            var map = vm.mapControl.getGMap();
            var position = new google.maps.LatLng(vehicleInfo.latitude, vehicleInfo.longitude);

            return new google.maps.Marker({
                id: vehicleInfo.id,
                markerType: 'heading',
                position: position,
                map: map,
                flat:true,
                icon: {
                    path: 'M15.2413122,21.1527861 L11,26 L6.75861856,21.1527069 C2.78910959,19.4927506 0,15.5728475 0,11 C0,4.92486775 4.923532,0 11,0 C17.0751322,0 22,4.923532 22,11 C22,15.5720845 19.2113515,19.4926684 15.2413122,21.1527861 Z',//google.maps.SymbolPath.FORWARD_CLOSED_ARROW,
                    scale: 1.1,
                    fillOpacity: 1,
                    fillColor: '#fff',
                    strokeWeight: 1,
                    strokeOpacity: .3,
                    rotation: vehicleInfo.heading,
                    origin: new google.maps.Point(0, 0),
                    anchor: new google.maps.Point(vehicleInfo.anchorX, vehicleInfo.anchorY)//getAnchor(vehicleInfo.heading)
                },
                zIndex: 1
            });
        }       

        function getVehicleMarker(vehicleInfo) {
            var map = vm.mapControl.getGMap();
            var position = new google.maps.LatLng(vehicleInfo.latitude, vehicleInfo.longitude);

            var marker = new google.maps.Marker({
                id: vehicleInfo.id,
                markerType: 'vehicle',
                position: position,
                flat: true,
                map: map,
                icon: {
                    path: 'M0,10 C0,4.4771525 4.47593818,0 10,0 C15.5228475,0 20,4.47593818 20,10 C20,15.5228475 15.5240618,20 10,20 C4.4771525,20 0,15.5240618 0,10 Z M5,5 L5,13.8 L5.81904762,13.8 L5.81904762,15 L7,15 L7,13.8 L13,13.8 L13,15 L14.1809524,15 L14.1809524,13.8 L15,13.8 L15,5 L5,5 Z M14.6336996,9.71610209 C14.6336996,9.99255627 14.405522,10.2166667 14.1374134,10.2166667 L5.89921665,10.2166667 C5.62512532,10.2166667 5.4029304,10.0022513 5.4029304,9.71610209 L5.4029304,7.11723124 C5.4029304,6.84077706 5.63110799,6.61666667 5.89921665,6.61666667 L14.1374134,6.61666667 C14.4115047,6.61666667 14.6336996,6.83108203 14.6336996,7.11723124 L14.6336996,9.71610209 Z M5.38461538,5.8 C5.38461538,5.5790861 5.56076967,5.4 5.78125,5.4 L14.21875,5.4 C14.4378052,5.4 14.6153846,5.58554688 14.6153846,5.8 C14.6153846,6.0209139 14.4392303,6.2 14.21875,6.2 L5.78125,6.2 C5.56219475,6.2 5.38461538,6.01445313 5.38461538,5.8 Z M5.38461538,11.6 C5.38461538,11.2686292 5.65201099,11 5.99308894,11 L6.69921875,11 C7.03526942,11 7.30769231,11.2783203 7.30769231,11.6 C7.30769231,11.9313708 7.0402967,12.2 6.69921875,12.2 L5.99308894,12.2 C5.65703828,12.2 5.38461538,11.9216797 5.38461538,11.6 Z M12.6923077,11.6 C12.6923077,11.2686292 12.9597033,11 13.3007812,11 L14.0069111,11 C14.3429617,11 14.6153846,11.2783203 14.6153846,11.6 C14.6153846,11.9313708 14.347989,12.2 14.0069111,12.2 L13.3007812,12.2 C12.9647306,12.2 12.6923077,11.9216797 12.6923077,11.6 Z',
                    fillOpacity: 1,
                    strokeOpacity: 0,
                    fillColor: vm.route.color,
                    scale: 1,
                },
                zIndex: 2
            });
            google.maps.event.addListener(marker, 'click', showVehicleNumber(map, marker, vehicleInfo.name));

            return marker;
        }

        function showVehicleNumber(map, marker, number) {

            var infoWindow = new google.maps.InfoWindow({ content: '' });
            return function () {
                var content = '<span style="font-weight: bold;">' + '#'+number + '</span><br />';
                infoWindow.setContent(content);
                infoWindow.open(map, marker);
            }
        }        

        function removeMarker(collection, marker) {
            
            var index = contains(collection, marker.id);
            collection[index].setMap(null);
            collection.splice(index, 1);
        }

        function contains(list, id) {
            for (var i = 0; i < list.length; i++) {
                if (list[i].id === id) return i;
            }
            return -1;
        }

        function findAll(list, id) {
            var markers = [];

            for (var i = 0; i < list.length; i++) {
                if (list[i].id === id)
                    markers.push(list[i]);
            }
            return markers;
        }


        function vehiclesFailureHandler() {

        }

        function pollVehiclesForRoute() {
            vehiclePoll = $interval(function () {
                getVehiclesForRoute();
            }, vehiclePollInterval);
        }


        function getStopArrivalsForRoute() {
            RouteService
                .getArrivalsForRoute(routeId, divisionId)
                       .then(handleArrivalSuccess, handleArrivalFailure)
                            .then(pollArrivalsForRoute);
        }

        function handleArrivalSuccess(response) {
            vm.routeArrivals = response.data.arrivals;
            vm.loading = false;

            if (!stopsLoaded)
                mapStopsForDisplay();;
        }


        function getShapeForRoute() {
            var map = vm.mapControl.getGMap();
            RouteService
                .getShapesByRoute(routeId)
                    .then(function (result) {
                        var shapes = result.data;

                        var line = new google.maps.Polyline({
                            path: google.maps.geometry.encoding.decodePath(shapes[0].line),
                            strokeColor: vm.route.color,
                            strokeOpacity: 4.0,
                            strokeWeight: 4,
                            map : map,
                            icons: [{
                                icon: {
                                    path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW,
                                    scale: 3
                                },
                                offset: '25px',
                                repeat: '200px'
                            }]

                        });

                        map.fitBounds(getLineBounds(line));
                    }, function (error) {

                    });
        }


        function getLineBounds(line) {
            var bound = new google.maps.LatLngBounds();
            line.getPath().forEach(function (item, index) {
                bound.extend(new google.maps.LatLng(item.lat(), item.lng()));
            });
            return bound;
        };

        function handleArrivalFailure(error) {
            vm.loading = false;
        }

        function mapStopsForDisplay() {
            var map = vm.mapControl.getGMap();

            for (var i = 0; i < vm.routeArrivals.length; i++) {

                var stopInfo = vm.routeArrivals[i].stop;
                var position = new google.maps.LatLng(stopInfo.Latitude, stopInfo.Longitude);

                var stop = new google.maps.Marker({
                    id: stopInfo.Id,
                    position: position,
                    map: map,
                    optimized: false,
                    icon: {
                        path: 'M0,2.99420208 C0,1.34054993 1.34331197,0 2.99420208,0 L17.0057979,0 C18.6594501,0 20,1.34331197 20,2.99420208 L20,17.0057979 C20,18.6594501 18.656688,20 17.0057979,20 L2.99420208,20 C1.34054993,20 0,18.656688 0,17.0057979 L0,2.99420208 Z M6,20 L13.7690812,20 L9.75999999,22.76 L6,20 Z',
                        fillColor: vm.route.color,
                        fillOpacity: 1,
                        strokeWeight: 0,
                        anchor: new google.maps.Point(9, 21),
                        size: new google.maps.Size(20, 23)
                    },
                    zIndex: 5,
                    animation: google.maps.Animation.DROP
                });

                var icon = new google.maps.Marker({
                    id: stopInfo.Id,
                    position: position,
                    map: map,
                    optimized: false,
                    icon: {
                        path: 'M0,0 L0,13.0899217 C0,13.6367269 0.443667457,14.08 1.00653274,14.08 L1.31047619,14.08 L1.31047619,16 L3.2,16 L3.2,14.08 L12.8,14.08 L12.8,16 L14.6895238,16 L14.6895238,14.08 L14.9934673,14.08 C15.5493599,14.08 16,13.6274801 16,13.0899217 L16,0.990078259 C16,0.443273135 15.5553691,0 14.9991283,0 L0,0 Z M15.4139194,7.85557231 C15.4139194,8.12679623 15.1819301,8.34666667 14.9225207,8.34666667 L1.13608738,8.34666667 C0.864695354,8.34666667 0.644688645,8.12790141 0.644688645,7.85557231 L0.644688645,3.07776103 C0.644688645,2.8065371 0.876677992,2.58666667 1.13608738,2.58666667 L14.9225207,2.58666667 C15.1939127,2.58666667 15.4139194,2.80543193 15.4139194,3.07776103 L15.4139194,7.85557231 Z M0.615384615,1.1312207 C0.615384615,0.859927 0.847373962,0.64 1.10678335,0.64 L14.8932166,0.64 C15.1646087,0.64 15.3846154,0.862958984 15.3846154,1.1312207 L15.3846154,1.4287793 C15.3846154,1.700073 15.152626,1.92 14.8932166,1.92 L1.10678335,1.92 C0.835391324,1.92 0.615384615,1.69704102 0.615384615,1.4287793 L0.615384615,1.1312207 Z M0.615384615,10.56 C0.615384615,10.0298066 1.04321759,9.6 1.57207584,9.6 L2.73561646,9.6 C3.26398244,9.6 3.69230769,10.0261102 3.69230769,10.56 C3.69230769,11.0901934 3.26447472,11.52 2.73561646,11.52 L1.57207584,11.52 C1.04370987,11.52 0.615384615,11.0938898 0.615384615,10.56 Z M12.3076923,10.56 C12.3076923,10.0298066 12.7355253,9.6 13.2643835,9.6 L14.4279242,9.6 C14.9562901,9.6 15.3846154,10.0261102 15.3846154,10.56 C15.3846154,11.0901934 14.9567824,11.52 14.4279242,11.52 L13.2643835,11.52 C12.7360176,11.52 12.3076923,11.0938898 12.3076923,10.56 Z M11.423955,11.1999507 C11.6340659,11.3767363 11.5848839,11.5200493 11.3051605,11.5200493 L4.69483948,11.5200493 C4.41912022,11.5200493 4.36801543,11.3749851 4.57604503,11.1999507 L4.19560559,11.5200493 C4.40571649,11.3432637 4.80388725,11.1999507 5.06852983,11.1999507 L10.9314702,11.1999507 C11.203462,11.1999507 11.5963648,11.3450149 11.8043944,11.5200493 L11.423955,11.1999507 Z M11.423955,11.8399507 C11.6340659,12.0167363 11.5848839,12.1600493 11.3051605,12.1600493 L4.69483948,12.1600493 C4.41912022,12.1600493 4.36801543,12.0149851 4.57604503,11.8399507 L4.19560559,12.1600493 C4.40571649,11.9832637 4.80388725,11.8399507 5.06852983,11.8399507 L10.9314702,11.8399507 C11.203462,11.8399507 11.5963648,11.9850149 11.8043944,12.1600493 L11.423955,11.8399507 Z',
                        fillColor: '#fff',
                        fillOpacity: 1,
                        strokeWeight: 0,
                        anchor: new google.maps.Point(7, 19),
                        size: new google.maps.Size(16, 16)
                    },
                    zIndex: 6,
                    animation: google.maps.Animation.DROP
                });

                var shadow = new google.maps.Marker({
                    id: stopInfo.Id,
                    position: position,
                    map: map,
                    optimized: false,
                    icon: {
                        path: 'M-5.83252597,14.3155545 C-6.35350295,13.5889938 -5.4359106,13 -3.78917972,13 L10.1871155,13 C11.8366015,13 13.5969795,13.5902074 14.1170863,14.3155545 L18.5313877,20.4717917 C19.0523647,21.1983524 18.1347724,21.7873462 16.4880415,21.7873462 L2.51174624,21.7873462 C0.862260281,21.7873462 -0.898117751,21.1971389 -1.41822457,20.4717917 L-5.83252597,14.3155545 Z M5.5099714,21.7873462 L13.2594793,21.7873462 L10.1300263,23 L5.5099714,21.7873462 Z',
                        fillColor: '#000',
                        fillOpacity: .10,
                        strokeWeight: 0,
                        anchor: new google.maps.Point(9, 21),
                        size: new google.maps.Size(21, 10)

                    },
                    zIndex: 4,
                    animation: google.maps.Animation.DROP
                });

                google.maps.event.addListener(icon, 'click', showStopInfo(map, icon, stopInfo.Name));
            }

            stopsLoaded = true;
        }


        function showStopInfo(map, marker, name) {

            var infoWindow = new google.maps.InfoWindow({ content: '' });
            return function () {
                var content = '<span style="font-weight: bold;">'  + name + '</span><br />';
                infoWindow.setContent(content);
                infoWindow.open(map, marker);
            }
        }


        function onStopClick(marker, eventName, model) {
           
        }

        function pollArrivalsForRoute() {
            if (!PortalUtilityService.hasValue(arrivalPoll)) {
                arrivalPoll = $interval(function () {
                    getStopArrivalsForRoute()
                }, arrivalPollInterval);
            }
        }

        activate();

        $scope.$on('$destroy', function (event) {
            stopPolling();
        });

        function stopPolling() {
            if (angular.isDefined(vehiclePoll)) {
                $interval.cancel(vehiclePoll);
                vehiclePoll = undefined;
            }

            if (angular.isDefined(arrivalPoll)) {
                $interval.cancel(arrivalPoll);
                arrivalPoll = undefined;
            }
        }
        // Start of code for Ionic
        vm.ionicInclude = 'app/modules/fixed-route/stops-for-route/stops-for-route.html';
        vm.ionicCustomClassName = 'ionic-fixed-route-stops-for-route';
        vm.ionicUseFixedRouteNav = true;
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = false;
        // End of code for Ionic
    }
})();

(function () {
    'use strict';

    angular.module('oneMVApp')
        .controller('ActiveTripController', activeTripController);

    activeTripController.$inject = ['$scope', '$location', '$interval', '$window', '$uibModal',
                'ConfigFactory', 'ScheduleService', 'uiGmapIsReady', 'DivisionService', 'authService',
                'UtilityFactory', 'RedirectionService', 'CommunicationsService', 'SettingsService',  'PageService','OneMvServices'];

    function activeTripController($scope, $location, $interval, $window, $uibModal,
        ConfigFactory, ScheduleService, uiGmapIsReady, DivisionService, authService,
        UtilityFactory, RedirectionService, CommunicationsService, SettingsService,  PageService,OneMvServices) {

        var vm = this;

        PageService.setTitle('Active Trip');
        PageService.setHeadline(OneMvServices.getDrtInfo().alias);

        var options = undefined;
        var autoRefresh = undefined;
        vm.passengerId = authService.authentication.passengerId;
        vm.cancelTrip = cancelTrip;
        vm.getActiveTrip = getActiveTrip;
        vm.tryContactDriver = tryContactDriver;
        vm.isCancelling = false;
        vm.activeTrip;
        vm.contactingDriver = false;
        var divisionId = '';
        var operatorId = null;
        var directionsDisplay = new google.maps.DirectionsRenderer({ suppressMarkers: true, draggable: false });
        var directionsService = new google.maps.DirectionsService();
        vm.isLoading = false;
        vm.vehicleInfo = null;
        vm.drawerState = 1;

        var closestPin, otherPin, locationPin, myLocationPin, hubIcon;
        if ($window.navigator.userAgent.indexOf("Trident") > 0 || $window.navigator.userAgent.indexOf("MSIE") > 0) {
            closestPin = 'images/default/i-drt-pin-b.png';
            otherPin = 'images/default/i-drt-pin-g.png';
            locationPin = 'images/pin-location.png';
            myLocationPin = 'images/pin-my-location.png';
            hubIcon = 'images/pin-hub.png';
        }
        else {
            closestPin = 'images/default/i-pin-drt-b.svg';
            otherPin = 'images/default/i-drt-pin-g.svg';
            locationPin = 'images/pin-location.svg';
            myLocationPin = 'images/pin-my-location.svg';
            hubIcon = 'images/pin-hub.svg';
        }

        function setAutoRefresh() {
            autoRefresh = $interval(function () {
                getActiveTrip();
            }, 30000);
        }

        function tryContactDriver(type) {
            vm.contactingDriver = true;
            vm.type = type;
            SettingsService
               .getSettings(authService.authentication.passengerId)
           .then(function (response) {
               if (response.length >= 10) {
                   contactDriver();
               } else {
                   CollectPassengerMobile();
               }
           }, function (error) {
              
           });
            
        }
        
        $scope.swipeUp = function ($event) {
          if (vm.drawerState < 2) {
            vm.drawerState += 1;
          }
        };

        $scope.swipeDown = function ($event) {
          if (vm.drawerState > 0) {
            vm.drawerState -= 1;
          }
        };

        function showSupportPopUp() {
            // get help phone number
            var helpPhone = DivisionService.getSupportPhoneNumber();
            var message = "Could not contact driver. Please call Help desk at <a href='tel:" + helpPhone + "'>" + helpPhone + "</a>";
            
            $uibModal.open({
                template: '<div class="modal-header" >' +
                                '<h3 class="modal-title">Support</h3>' +
                              ' </div>' +
                              '<div class="modal-body">' +
                                '<p>' + message + '</p>' +
                              '</div>' +
                              '<div class="modal-footer">' +
                              '<button class="btn btn-warning" type="button" ng-click="close()">OK</button>' +
                                  ' </div>',
                replace: true,
                controller: function ($scope, $uibModalInstance) {
                    $scope.close = function () {
                        $uibModalInstance.close();
                        //$location.replace().path('dashboard/');
                    };
                },
                backdrop: 'static',
                keyboard: false
            });
        }

        function contactDriver() {
            CommunicationsService.contactDriver(vm.activeTrip.TripID).then(function (response) {
                if (response.status == 1 && response.result) {
                    if (vm.type == "call")
                        document.location.href = "tel:" + response.result;
                    else if (vm.type == "sms")
                        document.location.href = "sms:" + response.result;
                } else if (response.status == 2) {
                    //Handle Validation 100001 = Driver phone missing
                    //Handle Validation 100002 = Passenger phone missing
                    showSupportPopUp();
                } else {
                    showSupportPopUp();
                }
                vm.contactingDriver = false;
            }, function (error) {
                vm.contactingDriver = false;
                showSupportPopUp();
            });
        }

        function CollectPassengerMobile() {

            var passengerMobileModal = $uibModal.open({
                animation: true,
                templateUrl: 'app/modules/on-demand/activeTrip/passenger-mobile-modal.html',
                controller: 'PassengerMobileController as vm',
                size: 'sm',
                resolve: {
                    settings: function () {
                        return {
                            passengerId: authService.authentication.passengerId,
                        };
                    }
                }
            });
            passengerMobileModal.result.then(function (response) {
                if (response == true) {
                    contactDriver();
                } else if(response == false){
                    UtilityFactory.toastError('Error', 'Could not update your mobile number.');
                }
            });
        }

        function getActiveTrip() {
            // vm.isLoading = false;
            ScheduleService.getlastripdetails(vm.passengerId).then(function (response) {
                if (response.data.status == 1) {
                    vm.activeTrip = response.data.result;

                    //var promiseWindow = options.promiseWindow;
                    var startPickupWindowTime = new moment(vm.activeTrip.StartPickupWindowTime);
                    var endPickupWindowTime = new moment(vm.activeTrip.EndPickupWindowTime);
                    vm.activeTrip.promiseWindowStartTime = startPickupWindowTime.format('h:mm A');
                    vm.activeTrip.promiseWindowEndTime = endPickupWindowTime.format('h:mm A');

                    mapTrip();
                }
                else {
                    vm.activeTrip = null;
                    vm.scheduleMarkers = [];
                    directionsDisplay.setMap(null);
                    $location.path('on-demand/reservations');
                }
                //getMap();

            }, function (err) {
                vm.activeTrip = null;
                vm.isLoading = false;
                // getMap();
            });
        }

        vm.zoom = 15;
        vm.center = {
            latitude: 39.809860,
            longitude: -98.555183
        };
        vm.myStyles = [
  {
      "elementType": "geometry",
      "stylers": [
        {
            "color": "#ebe3cd"
        }
      ]
  },
  {
      "elementType": "labels.text.fill",
      "stylers": [
        {
            "color": "#523735"
        }
      ]
  },
  {
      "elementType": "labels.text.stroke",
      "stylers": [
        {
            "color": "#f5f1e6"
        }
      ]
  },
  {
      "featureType": "administrative",
      "elementType": "geometry.stroke",
      "stylers": [
        {
            "color": "#c9b2a6"
        }
      ]
  },
  {
      "featureType": "administrative.land_parcel",
      "elementType": "geometry.stroke",
      "stylers": [
        {
            "color": "#dcd2be"
        }
      ]
  },
  {
      "featureType": "administrative.land_parcel",
      "elementType": "labels",
      "stylers": [
        {
            "visibility": "off"
        }
      ]
  },
  {
      "featureType": "administrative.land_parcel",
      "elementType": "labels.text.fill",
      "stylers": [
        {
            "color": "#ae9e90"
        }
      ]
  },
  {
      "featureType": "landscape.natural",
      "elementType": "geometry",
      "stylers": [
        {
            "color": "#dfd2ae"
        }
      ]
  },
  {
      "featureType": "poi",
      "elementType": "geometry",
      "stylers": [
        {
            "color": "#dfd2ae"
        }
      ]
  },
  {
      "featureType": "poi",
      "elementType": "labels.text.fill",
      "stylers": [
        {
            "color": "#93817c"
        }
      ]
  },
  {
      "featureType": "poi.business",
      "stylers": [
        {
            "visibility": "off"
        }
      ]
  },
  {
      "featureType": "poi.park",
      "elementType": "geometry.fill",
      "stylers": [
        {
            "color": "#a5b076"
        }
      ]
  },
  {
      "featureType": "poi.park",
      "elementType": "labels.text",
      "stylers": [
        {
            "visibility": "off"
        }
      ]
  },
  {
      "featureType": "poi.park",
      "elementType": "labels.text.fill",
      "stylers": [
        {
            "color": "#447530"
        }
      ]
  },
  {
      "featureType": "road",
      "elementType": "geometry",
      "stylers": [
        {
            "color": "#f5f1e6"
        }
      ]
  },
  {
      "featureType": "road.arterial",
      "elementType": "geometry",
      "stylers": [
        {
            "color": "#fdfcf8"
        }
      ]
  },
  {
      "featureType": "road.highway",
      "elementType": "geometry",
      "stylers": [
        {
            "color": "#f8c967"
        }
      ]
  },
  {
      "featureType": "road.highway",
      "elementType": "geometry.stroke",
      "stylers": [
        {
            "color": "#e9bc62"
        }
      ]
  },
  {
      "featureType": "road.highway.controlled_access",
      "elementType": "geometry",
      "stylers": [
        {
            "color": "#e98d58"
        }
      ]
  },
  {
      "featureType": "road.highway.controlled_access",
      "elementType": "geometry.stroke",
      "stylers": [
        {
            "color": "#db8555"
        }
      ]
  },
  {
      "featureType": "road.local",
      "elementType": "labels",
      "stylers": [
        {
            "visibility": "off"
        }
      ]
  },
  {
      "featureType": "road.local",
      "elementType": "labels.text.fill",
      "stylers": [
        {
            "color": "#806b63"
        }
      ]
  },
  {
      "featureType": "transit.line",
      "elementType": "geometry",
      "stylers": [
        {
            "color": "#dfd2ae"
        }
      ]
  },
  {
      "featureType": "transit.line",
      "elementType": "labels.text.fill",
      "stylers": [
        {
            "color": "#8f7d77"
        }
      ]
  },
  {
      "featureType": "transit.line",
      "elementType": "labels.text.stroke",
      "stylers": [
        {
            "color": "#ebe3cd"
        }
      ]
  },
  {
      "featureType": "transit.station",
      "elementType": "geometry",
      "stylers": [
        {
            "color": "#dfd2ae"
        }
      ]
  },
  {
      "featureType": "water",
      "elementType": "geometry.fill",
      "stylers": [
        {
            "color": "#b9d3c2"
        }
      ]
  },
  {
      "featureType": "water",
      "elementType": "labels.text.fill",
      "stylers": [
        {
            "color": "#92998d"
        }
      ]
  }
        ];
        vm.mapOptions = {
            mapTypeControl: false,
            zoomControl: false,
            streetViewControl: false,
            styles: vm.myStyles

        };
        vm.mapControl = {};

        function cancelTrip(trip) {

            var tripToCancel = {
                'tripId': trip.TripID,
                'passengerId': trip.PassengerID,
                'from': trip.StartAddressViewModel.Name,
                'to': trip.EndAddressViewModel.Name,
                'scheduledTime': trip.ScheduledPickupTime
            };

            var modalCancelTrip = $uibModal.open({
                animation: true,
                templateUrl: 'app/modules/on-demand/activeTrip/trip-cancellation-prompt.html',
                controller: 'TripCancellationController as vm',
                size: '',
                resolve: {
                    tripToCancel: function () {
                        return tripToCancel;
                    },
                    showCancelOptions: vm.reservationFormOptions.showCancelOptions
                }
            });
            modalCancelTrip.result.then(function (result) {
                if (result.isCancel) {
                    UtilityFactory.toastSuccess("Success!", "Trip cancelled");
                    $location.path('on-demand/reservations');
                }
                else
                    UtilityFactory.toastError("Error!", "Unable to cancel the trip.");
            });

        }

        function getMap() {
            uiGmapIsReady.promise().then(function (maps) {
                ScheduleService.getServiceAreaLocation(vm.divisionId).then(function (response) {
                    if (response.data.status == 1) {
                        vm.center.latitude = response.data.result.Latitude;
                        vm.center.longitude = response.data.result.Longitude;
                    }

                    getActiveTrip();
                    setAutoRefresh();
                    /*if(vm.activeTrip != null)
                        mapTrip();*/
                });
            });

        }

        function mapTrip() {
            vm.scheduleMarkers = [];

            directionsDisplay.setMap(vm.mapControl.getGMap());

            vm.scheduleMarkers.push({
                'latitude': vm.activeTrip.StartAddressViewModel.Latitude, 'longitude': vm.activeTrip.StartAddressViewModel.Longitude,
                'icon': 'images/default/i-drt-pin-b.png', 'tripId': vm.activeTrip.TripID
            });
            vm.scheduleMarkers.push({
                'latitude': vm.activeTrip.EndAddressViewModel.Latitude, 'longitude': vm.activeTrip.EndAddressViewModel.Longitude,
                'icon': 'images/default/i-drt-pin-g.png', 'tripId': vm.activeTrip.TripID
            });

            var request = {
                origin: new google.maps.LatLng(vm.activeTrip.StartAddressViewModel.Latitude, vm.activeTrip.StartAddressViewModel.Longitude),
                destination: new google.maps.LatLng(vm.activeTrip.EndAddressViewModel.Latitude, vm.activeTrip.EndAddressViewModel.Longitude),
                travelMode: google.maps.DirectionsTravelMode.DRIVING
            };

            vm.vehicleInfo = {
                coords: {
                    'latitude': vm.activeTrip.VehicleLatitude,
                    'longitude': vm.activeTrip.VehicleLongitude,
                },
                icon: 'images/i-car-green.svg'
            };

            google.maps.event.trigger(vm.mapControl.getGMap(), "resize");
            directionsService.route(request, function (response, status) {
                if (status === google.maps.DirectionsStatus.OK) {
                    directionsDisplay.setDirections(response);
                } else {
                    //window.alert('Directions request failed due to ' + status);
                }
            });
            vm.isLoading = false;
        };



        function activate(callback) {
            if (!authService.isLoggedIn()) {
                RedirectionService, save('/on-demand/active-trip');
                $location.path('login');
            }
            else {

                divisionId = DivisionService.getDivisionId();
                if (divisionId != null && divisionId != undefined && divisionId != '') {
                    if (callback && typeof callback === "function")
                        callback();
                }
            }
            }

        function populateDivisionParameters() {
            options = {
                DivisionId: divisionId,
                OperatorId: operatorId
            };
            ConfigFactory.getDivisionParameters(divisionId)
                     .then(function (params) {
                         if (params) {
                             options.passengersLimit = params.PassengersLimit ? eval(params.PassengersLimit) : 5;
                             options.allowWillCall = params.AllowWillCall ? eval(params.AllowWillCall.toLowerCase()): false;
                             options.allowEquipment = params.AllowEquipment ? eval(params.AllowEquipment.toLowerCase()) : false;
                             options.isAdvancedReservation = params.AllowAdvancedReservation ? eval(params.AllowAdvancedReservation.toLowerCase()) : false;
                             options.allowMultipleSeatBooking = params.AllowMultipleSeatBooking ? eval(params.AllowMultipleSeatBooking.toLowerCase()) : false;
                             options.isWheelChair = params.HasWheelChair ? eval(params.HasWheelChair.toLowerCase()) : false;
                             options.isPCA = params.HasPersonalCareAssistant ? eval(params.HasPersonalCareAssistant.toLowerCase()) : false;
                             options.isServiceAnimal = params.HasServiceAnimal ? eval(params.HasServiceAnimal.toLowerCase()) : false;
                             options.isCompanion = params.HasCompanions ? eval(params.HasCompanions.toLowerCase()) : false;
							 options.companionsLimit = params.HasCompanions == false ? 0: params.CompanionsLimit ? eval(params.CompanionsLimit): 1;
                             options.allowCustomLocation = params.AllowCustomLocation ? eval(params.AllowCustomLocation.toLowerCase()) : false;
                             options.allowOnlySameDayAdvRes = params.AllowOnlySameDayAdvRes ? eval(params.AllowOnlySameDayAdvRes.toLowerCase()) : false;
                             options.promiseWindow = params.PromiseWindow ? eval(params.PromiseWindow) : 10;
                             options.showCancelOptions = params.CancelReasonRequired ? eval(params.CancelReasonRequired.toLowerCase()) : false;
                             options.reservationType = vm.reservationType;
                             options.allowFaring = params.AllowFaring ? eval(params.AllowFaring.toLowerCase()) : false;
                             options.allowLocationNotes = params.AllowLocationNotes ? eval(params.AllowLocationNotes) : false;
                             options.allowPassengerToCall = params.AllowPCD ? eval(params.AllowPCD.toLowerCase()) : false;
                             options.allowPassengerToSms = params.AllowPSD ? eval(params.AllowPSD.toLowerCase()) : false;
                             options.allowChildren = params.AllowChildren ? eval(params.AllowChildren) : false;
                             vm.reservationFormOptions = options;

                         	//extra options only needed by user reservations directive.
                             options.isPassenger = true;
                             options.isReadOnly = true;
                             options.autoRefresh = true;
                             options.batchDays = params.BatchDays ? eval(params.BatchDays) : 7;
                             options.minFromDays = params.MinFromDays ? eval(params.MinFromDays) : 30;
                             vm.reservationFormOptions = options;
                         }
                     }, function (response) {
                         UtilityFactory.toastError('Error', response.data.ReturnMessage);
                     });
            getMap();
            //getActiveTrip();
        }
        activate(populateDivisionParameters);

        $scope.$on('$destroy', function (event) {
            if (angular.isDefined(autoRefresh)) {
                $interval.cancel(autoRefresh);
                autoRefresh = undefined;
            }
        });

        // Start of code for Ionic
        vm.ionicInclude = 'app/modules/on-demand/activeTrip/active-trip.html';
        vm.ionicCustomClassName = '';
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = false;
        // End of code for Ionic
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('PassengerMobileController', PassengerMobileController);

    PassengerMobileController.$inject = ['$location', '$uibModalInstance', 'settings', 'SettingsService', 'UtilityFactory'];

    function PassengerMobileController($location, $uibModalInstance, settings, SettingsService, UtilityFactory) {
        /* jshint validthis:true */
        var vm = this;
        vm.updateSettings = updateSettings;
        vm.cancel = cancel;
        vm.passengerId = settings.passengerId;
        vm.clientTelephone = '';
        vm.isUpdating = false;

        function cancel() {
            $uibModalInstance.close();
        };

        function updateSettings() {
            vm.isUpdating = true;
            if (vm.clientTelephone != "" && !isNaN(vm.clientTelephone) && vm.clientTelephone > 0) {
                var mobileNumber = "+1" + vm.clientTelephone;
                var settings = {
                    "PassengerId": vm.passengerId,
                    "ClientTelephone": mobileNumber
                }
                SettingsService
                   .updateSettings(settings)
               .then(function (response) {
                   vm.isUpdating = false;
                   closeModal(response);
               }, function (error) {
                   vm.isUpdating = false;
                   closeModal(false);
               });
            } else {
                vm.isUpdating = false; 
                UtilityFactory.toastError('Error', 'Please enter a valid number');
            }
        }

        var closeModal = function (response) {
            $uibModalInstance.close(response);
        }

        activate();

        function activate() { }
    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('TripCancellationController', TripCancellationController);

    TripCancellationController.$inject = ['$uibModalInstance', 'tripToCancel', 'showCancelOptions', 'UtilityFactory', 'ScheduleService'];

    function TripCancellationController($uibModalInstance, tripToCancel, showCancelOptions, UtilityFactory, ScheduleService) {
        var vm = this;
        vm.tripToCancel = tripToCancel;
        vm.showCancelOptions = showCancelOptions;
        vm.cancelError = false;
        vm.disable = false;
        vm.reasonComment = '';

        vm.cancelTrip = function () {
            vm.disable = true;
            var request = {
                    'TripID': tripToCancel.tripId,
                    'PassengerID': tripToCancel.passengerId,
                    'OperationID': null
                };
            if (vm.showCancelOptions)
            {
                if(vm.cancelReason)
                {
                    request.CancelReasonId = vm.cancelReason.ReasonId;
                    request.CancelReasonText = vm.cancelReason.Reason;
                    if(vm.reasonComment.trim() != '')
                    {
                        request.CancelReasonText += ' - ' + vm.reasonComment.trim().replace(/[^a-zA-Z\d,@!\.\(\)\-\* \s]/g, '');
                        if(request.CancelReasonText.length > 250)
                        {
                            UtilityFactory.toastError("Error!", "Comment too long. Please make it shorter");
                            vm.disable = false;
                            return;
                        }
                    }
                    else if (vm.cancelReason.Reason === 'Other' && vm.reasonComment.trim() === '') {
                        UtilityFactory.toastError("Error!", "You selected Other, please type a reason.");
                        vm.disable = false;
                        return;
                    }
                }
                else {
                    UtilityFactory.toastError("Error!", "Please provide a reason for cancellation");
                    vm.disable = false;
                    return;
                }
            }
            
           ScheduleService.cancelpost(request).then(function (response) {
                if (response && response.data && response.data.status == 1) {
                    $uibModalInstance.close({ 'action': 'close', 'isCancel': true });
                } else {
                    vm.cancelError = true;
                }
                vm.disable = false;
            }, function (error) {
                vm.disable = false;
                vm.cancelError = true;
            });
        };

        vm.cancel = function () {
            $uibModalInstance.dismiss('cancel');
        };

        this.MakeDisable = function () {
            if (vm.disable) {
                return true;
            }
            else {
                return false;
            }
        };

        vm.disallowSpecialChar = function()
        {
            if(vm.reasonComment.trim() !== '')
            {
                vm.reasonComment = vm.reasonComment.replace(/[^a-zA-Z\d,@!\.\(\)\-\* \s]/g, '');
            }
        }

        activate();
        function activate() {
            //first get parameter to check if trip cancel status is needed.
            //get trip cancellation statuses
          
            if (vm.showCancelOptions) {
                ScheduleService.getTripCancelStatusList().then(function (response) {
                    if (response.data.status == 1)
                        vm.cancelReasons = response.data.result;
                }, function (error) { });
            }
        }
    }
})();

(function () {
    'use strict';

    var app = angular.module('oneMVApp');
    app.controller('FaringModalController', FaringModalController);

    FaringModalController.$inject = ['$scope', 'UtilityFactory', 'FaringService', '$log', '$uibModalInstance', 'DivisionService', 'ProfileService', 'reservationRequest', 'serviceDate'];

    function FaringModalController($scope, UtilityFactory, FaringService, $log, $uibModalInstance, DivisionService, ProfileService, reservationRequest, serviceDate ) {
        $scope.cancel = cancel;
        $scope.saveCompanions = saveCompanions;
        $scope.resetCompanions = resetCompanions;
        $scope.editCompanions = editCompanions;
        $scope.increaseCount = increaseCount;
        $scope.decreaseCount = decreaseCount;
        $scope.bookTrip = bookTrip;
        $scope.isHidden = true;
        $scope.locationNotes = { 'from': '', 'to': '' }

        $scope.maxCount = $scope.$parent.options.isCompanion ? $scope.$parent.options.companionsLimit : 0;
        $scope.companionCount = 0;
        $scope.reservationRequest = reservationRequest;  
        $scope.serviceDate = serviceDate.format('YYYY-MM-DD');
        $scope.companionFare = 0;
        $scope.baseFare = undefined;
        $scope.maxCompanionCountWarning = false;
        var lastFareTypes = undefined;
        var lastCompanionFare = 0;
        var lastCompanionCount = 0;
        var reservationTime = undefined;
        $scope.fareTypes = [];

        function increaseCount(index)
        {
            // Added check to make sure the user does not add more than $scope.maxCount
            if ($scope.companionCount < $scope.maxCount) {
                $scope.fareTypes[index].NumberOfPassengers++;
                $scope.companionFare = $scope.companionFare + $scope.fareTypes[index].Fare;
                $scope.companionCount++;
                $scope.maxCompanionCountWarning = false;
            } else {
                $scope.maxCompanionCountWarning = true;
            }

        }
        function decreaseCount(index) {
            // Added check to make sure the user does not remove less than 0.
            if ($scope.fareTypes[index].NumberOfPassengers > 0) {
                $scope.fareTypes[index].NumberOfPassengers--;
                $scope.companionFare = $scope.companionFare - $scope.fareTypes[index].Fare;
                $scope.companionCount--;
                $scope.maxCompanionCountWarning = false;
            }

        }
      
       
        var fromLocation = reservationRequest.fromLocation;
        var toLocation = reservationRequest.toLocation;

        function cancel() {
            $scope.reservationRequest.IsWheelChair = false;
            $scope.reservationRequest.IsPCA = false;
            $scope.reservationRequest.IsServiceAnimal = false;
            $scope.reservationRequest.TripFares = [];
            $scope.reservationRequest.BaseFare = undefined;
            $scope.maxCompanionCountWarning = false;
            $uibModalInstance.close($scope.reservationRequest);

            //reset companions and accessibility
        };
        
        
        function saveCompanions()
        {
            $scope.showCompanionSelection = !$scope.showCompanionSelection;
        }
        function resetCompanions()
        {
           
            $scope.fareTypes = angular.copy(lastFareTypes);
            //reset wheelchairs etc.
            $scope.companionFare = lastCompanionFare;
            $scope.companionCount = lastCompanionCount;
            $scope.showCompanionSelection = !$scope.showCompanionSelection;
            $scope.maxCompanionCountWarning = false;
            //companion object should be reset to 0 count
        }
        function editCompanions()
        {
            lastFareTypes = angular.copy($scope.fareTypes);
            lastCompanionFare = $scope.companionFare;
            lastCompanionCount = $scope.companionCount;
            $scope.showCompanionSelection = !$scope.showCompanionSelection;
        }

        function bookTrip()
        {
            if ($scope.baseFare == undefined)
            {
                UtilityFactory.toastError('Error', 'Can not get faring information. Please try again later.');
                return;
            }
            if ($scope.$parent.options.allowLocationNotes) {
               
                $scope.reservationRequest.locationNotes.from = $scope.locationNotes.from;
                $scope.reservationRequest.locationNotes.to = $scope.locationNotes.to;
            }
            $scope.reservationRequest.TripFares = $scope.fareTypes;
            $scope.reservationRequest.TotalTripFare = $scope.baseFare + $scope.companionFare;
            $scope.reservationRequest.CompanionsCount = $scope.companionCount;
            $scope.reservationRequest.BaseFare = $scope.baseFare;
            $scope.$parent.saveReservation($scope.reservationRequest);
            $uibModalInstance.close();
        }
        function getFares() {
            $scope.requestedTime = reservationTime.format('MM/DD/YYYY hh:mm A');
            if ($scope.reservationRequest.TripFares != null && $scope.reservationRequest.TripFares.length > 0) {
                $scope.fareTypes = $scope.reservationRequest.TripFares;
                $scope.baseFare = $scope.reservationRequest.BaseFare;
                angular.forEach($scope.fareTypes, function (value, key) {
                    if (value.NumberOfPassengers > 0) {
                        $scope.companionCount += value.NumberOfPassengers;
                        $scope.companionFare += (value.Fare * value.NumberOfPassengers);
                    }
                });
                if ($scope.reservationRequest.locationNotes && $scope.reservationRequest.locationNotes.from != '')
                {
                    $scope.locationNotes.from = $scope.reservationRequest.locationNotes.from;
                }
                if ($scope.reservationRequest.locationNotes && $scope.reservationRequest.locationNotes.to != '') {
                    $scope.locationNotes.to = $scope.reservationRequest.locationNotes.to;
                }
                return;
            }

            $scope.fareTypes = [];

            FaringService.GetZoneFares($scope.divisionId, $scope.reservationRequest.fromZone, $scope.reservationRequest.toZone, reservationTime.format("YYYY-MM-DD HHmmss"), $scope.serviceDate)
            .then(function (response) {
                if(response.data.status == 1)
                {
                    var fares = response.data.result;
                    angular.forEach(fares, function(value, key)
                    {
                        $scope.fareTypes.push({ PassengerFareTypeId: value.PassengerFareTypeId, NumberOfPassengers: 0, Name: value.FareType, Fare: value.Fare, ZoneFareId: value.ZoneFareId });
                    });
                    setBaseFare(fares);
                }
                else {
                    $scope.baseFare = undefined;
                }
            }, function error(err) {
                UtilityFactory.toastError('Error', 'Can not get faring information. Please try again later.');
                $scope.baseFare = undefined;
            });
        }

        
        activate(getFares);
        function setDefaultFare(fares)
        {
            for(var i = 0; i < fares.length; i++)
            {
                if (fares[i].IsDefault) {
                    $scope.baseFare = fares[i].Fare;
                    return;
                }
            }
            $scope.baseFare = undefined;
        }

        function setBaseFare(fares)
        {
            //default fare is set, if fare is found it will over write it
            setDefaultFare(fares);
            ProfileService.GetPassengerAge($scope.$parent.passenger.Id)
                .then(function (response){
                    if(response.data.status == 1)
                    {
                        var age = response.data.result;
                       
                            for (var i = 0; i < fares.length; i++) {

                                if (fares[i].FromAge == undefined)
                                    continue;
                                if (age >= fares[i].FromAge && (fares[i].ToAge == undefined || age <= fares[i].ToAge)) {
                                    $scope.baseFare = fares[i].Fare;
                                    break;
                                }

                            }
                        
                    }
                    
                }, function (err) {
                   
                });
                
        }

        function activate(callback) {
         
            $scope.divisionId = DivisionService.getDivisionId();
            if ($scope.divisionId != null && $scope.divisionId != undefined && $scope.divisionId != '') {
                
                if ($scope.reservationRequest.reservationType != $scope.$parent.reservationTypeEnum.ASAP)
                    reservationTime = $scope.$parent.getReservationDateTime($scope.reservationRequest);
                else
                    reservationTime = moment.tz(DivisionService.getTimeZone());
                DivisionService.getServiceDateByDivisionTime($scope.divisionId, reservationTime.format("YYYY-MM-DD HHmmss"))
                .then(function (response) {
                    $scope.serviceDate = moment(response.data.result).format("YYYY-MM-DD");
                    if (callback && typeof callback === "function")
                        callback();
                }, function (error) {
                    UtilityFactory.toastError('Error', 'Can not get faring information. Please try again later.');
                    $scope.baseFare = undefined;
                });
                }
                else
                    $location.path('dashboard/');
           
        }
    }
})();
(function () {
    'use strict';

    var app = angular.module('oneMVApp');
    app.controller('DisplayScheduledTripController', DisplayTripModalController);

    DisplayTripModalController.$inject = ['$scope', '$http', 'UtilityFactory', 'DateFactory',
        '$log', '$uibModalInstance', 'trip', 'ConfigFactory','options'];

    function DisplayTripModalController($scope, $http, UtilityFactory, DateFactory,
        $log, $uibModalInstance, trip,ConfigFactory, options) {

        var vm = this;
        vm.trip = trip;

        var systemParams = options;

        vm.allowFaring = systemParams.allowFaring;
        vm.allowChildren = systemParams.allowChildren;
        vm.allowLocationNotes = systemParams.allowLocationNotes; 

        var startTime = new moment(vm.trip.ScheduledPickupTime);
        vm.trip.promiseWindowStartTime = startTime.format('h:mm A');
        if (moment.isMoment(startTime))
            vm.trip.promiseWindowEndTime = startTime.add(parseInt(systemParams.promiseWindow), 'm').format('h:mm A');
        vm.cancel = cancel;
        vm.cancelTrip = cancelTrip;
        function cancel() {
            $uibModalInstance.close();
        };

        function cancelTrip(tripId)
        {

        }
    }
})();
(function () {
    'use strict';

    var app = angular.module('oneMVApp');
    app.factory('FaringService', FaringService);
    FaringService.$inject = ['$http', '$q', 'ConfigFactory', 'authService'];

    function FaringService($http, $q, ConfigFactory, authService) {
        var service = {
            GetZoneIDForLocation: getZoneIDForLocation,
            GetZoneFares: getZoneFares
        };
        return service;

        function getZoneFares(divisionId, fromZone, toZone, reservationTime, serviceDate)
        {
            var defer = $q.defer();
            ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
                if (oneMVURL && oneMVURL != "") {
                    //get the base url from config.
                    var _url = oneMVURL + "faring/" + divisionId + "/" + fromZone + "/" + toZone + "/" + reservationTime + "/" + serviceDate;
                    $http({
                        method: 'GET',
                        url: _url
                    }).then(function successCallback(response) {
                        //if (response.data.status == 1) {
                        defer.resolve(response);
                        //} else {
                        //  defer.reject(response.data.result);
                        //}
                    }, function errorCallback(response) {
                        defer.reject(response);
                    });
                }
            });
            return defer.promise;
            
        }
        function getZoneIDForLocation(latitude, longitude, divisionId)
        {
            //should have method in secured api 
            var defer = $q.defer();
            ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
                if (oneMVURL && oneMVURL != "") {
                    //get the base url from config.
                    var _url = oneMVURL + "faring/getZoneIdForLocation/" + divisionId + "/" + latitude + "/" + longitude + "/";
                    $http({
                        method: 'GET',
                        url: _url
                    }).then(function successCallback(response) {
                        //if (response.data.status == 1) {
                        defer.resolve(response);
                        //} else {
                        //  defer.reject(response.data.result);
                        //}
                    }, function errorCallback(response) {
                        defer.reject(response);
                    });
                }
            });
            return defer.promise;
        }
    }
})();
(function () {
    'use strict';

    var app = angular.module('oneMVApp');
    app.factory('FeedbackService', FeedbackService);
    FeedbackService.$inject = ['$http', '$q', 'ConfigFactory','authService','DivisionService'];

    function FeedbackService($http, $q, ConfigFactory, authService,DivisionService) {
        var service = {
            SaveFeedback: saveFeedback,
            addCommuterFeedback : addCommuterFeedback
        };
        return service;

        function saveFeedback(feedbackRequest) {
            var defer = $q.defer();
            ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
                if (oneMVURL && oneMVURL != "") {
                    //get the base url from config.
                    var _url = oneMVURL + "trip/" + authService.authentication.passengerId + "/feedback/save";
                    $http({
                        method: 'POST',
                        url: _url,
                        data: JSON.stringify(feedbackRequest),
                    }).then(function successCallback(response) {
                        //if (response.data.status == 1) {
                        defer.resolve(response);
                        //} else {
                        //  defer.reject(response.data.result);
                        //}
                    }, function errorCallback(response) {
                        defer.reject(response);
                    });
                }
            });
            return defer.promise;
        }

        function addCommuterFeedback(feedbackRequest, reservationId) {
            var defer = $q.defer();
            ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
                if (oneMVURL && oneMVURL != "") {
                    var _url = oneMVURL + "commuter/" + DivisionService.getDivisionId() +
                        "/reservations/feedback/" + authService.authentication.passengerId + "/" + reservationId;
                    $http({
                        method: 'POST',
                        url: _url,
                        data: feedbackRequest,
                    }).then(function successCallback(response) {
                        defer.resolve(response);
                    }, function errorCallback(response) {
                        defer.reject(response);
                    });
                }
            });
            return defer.promise;
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('FixedRoutesController', FixedRoutesController);

    FixedRoutesController.$inject = [ '$uibModalInstance', 'upcomingSchedules', 'fromStopName','OneMvServices'];

    function FixedRoutesController( $uibModalInstance, upcomingSchedules, fromStopName,OneMvServices) {
        /* jshint validthis:true */
        var vm = this;
        vm.upcomingSchedules = upcomingSchedules;
        vm.fromStopName = fromStopName;
        vm.cancel = cancel;
        vm.frInfo = OneMvServices.getFixedRouteInfo();

        function cancel() {
            $uibModalInstance.close();
        };

        activate();

        function activate() { }
    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .directive('locationSearchDirective', locationSearchDirective);

    locationSearchDirective.$inject = ['LocationFactory', '$rootScope', '$q', 'ScheduleService', 'UtilityFactory', 'authService', 'DivisionService'];

    function locationSearchDirective(LocationFactory, $rootScope, $q, ScheduleService, UtilityFactory, authService, DivisionService) {
        // Usage:
        //     <Location-search-directive></Location-search-directive>
        // Creates:
        // 
        //locationfilter=0 means Show Locations that are Manually added to the oneMV Database(for now)
        //locationfilter=1 means Show Locations both that are Manually added to the oneMV Database and also from the google api(for now)
        //locationfilter is dynamic enough to be expanded in future

        var directive = {
            link: link,
            controller: controller,
            replace: true,
            restrict: 'E',
            scope: {
                onLocationSelected: '&', minlength: '=minlength', locationfilter: '@',
                labelname: '=labelname', selectedlocation: '=selectedlocation', passengerId: '@', googleonly: '@'                
            },
            templateUrl: 'app/modules/on-demand/reservations/locationSearch.html'
        };
        return directive;

        function link(scope, element, attrs) {
            scope.type = attrs.labelname;
		}

        function controller($scope) {
            $scope.data = LocationFactory.getLocations;
            $scope.reservationRequest = {};
            $scope.initialValue = '';
        
            $scope.resultsAPI = function (userInputString, timeoutPromise) {
                //var defer = $q.defer();

            	return $scope.data(userInputString, $scope.locationfilter, $scope.divisionId, $scope.passengerId, $scope.googleonly, { timeout: timeoutPromise })
                //.then(function (result) {
                    //var filteredResult = result.data;
                    //if ($scope.selectedlocation) {
                        //var filteredResult = result.data.filter(function (location) {
                        //    return location.loc.LocationId != $scope.selectedlocation;
                        //});
                    //}
                  //  defer.resolve(filteredResult);
                //});
                //return defer.promise;

            }
            //Set selected location from Google Api
            $scope.selectedGoogleLocationFrom = function (address) {
                if (address != null) {
                    var add = "";
                    for (var i in address.address_components) {
                        if (address.address_components[i].types[0] == "street_number") {
                            add = add + " " + address.address_components[i].short_name;
                        }
                        else if (address.address_components[i].types[0] == "route") {
                            add = add + " " + address.address_components[i].short_name;
                        }
                        else if (address.address_components[i].types[0] == "locality") {
                            $scope.reservationRequest.City = address.address_components[i].short_name;
                        }
                        else if (address.address_components[i].types[0] == "administrative_area_level_1") {
                            $scope.reservationRequest.State = address.address_components[i].short_name;
                        }
                        else if (address.address_components[i].types[0] == "postal_code") {
                            $scope.reservationRequest.ZipCode = address.address_components[i].short_name;
                        }
                        else {
                            //do nothing
                        }
                    }
                    $scope.reservationRequest.Address1 = add;
                    $scope.reservationRequest.From = address.formatted_address;
                    $scope.reservationRequest.Latitude = address.geometry.location.lat;
                    $scope.reservationRequest.Longitude = address.geometry.location.lng;
                    $scope.reservationRequest.GooglePlaceId = address.place_id;
                }
            }
            $scope.onLocationSelectedNotify = function (Location) {
                $scope.reservationRequest = {};
                if (Location != undefined) {
                    var obj = Location.originalObject;
                    if (obj != null) {
                        if (obj.isGoogleLocation) {
                            $scope.selectedGoogleLocationFrom(obj.loc);
                        }
                        else {
                            $scope.reservationRequest = obj.loc;
                        }
                    }
                }
                if (typeof ($scope.onLocationSelected) == 'function') {
                    $scope.onLocationSelected({ location: $scope.reservationRequest });
                }
            };

            function getMapCenter() {
                ScheduleService.getServiceAreaLocation($scope.divisionId).then(function (response) {
                    if (response.data !== null &&  response.data.result != null) {
                        $scope.addressRest = response.data.result.Address;
                        LocationFactory.setadd($scope.addressRest);
                    }
                }, function (errormsg) {
                    UtilityFactory.toastError('Error', '');
                });
            };

            function activate(callback){
                if ($scope.addressRest == undefined || $scope.addressRest == '') {
                        $scope.divisionId = DivisionService.getDivisionId();
                        if ($scope.divisionId != null && $scope.divisionId != undefined && $scope.divisionId != '') {
                            if (callback && typeof callback === "function")
                                callback();
                        }                    
                }           
            }

            $scope.$on('closestLocation', function (event, location) {
                if ($scope.type === 'FROM')
                    $scope.initialValue = location.title;
            });
            
            $scope.$on('initialLocationValue', function (event, value) {
            	$scope.initialValue = value;
            });

            $scope.$on('homeLocationDisable', function (event, value) {
            	if ($scope.type != 'FROM') {
            		$scope.disableInput = value;
            	}
            });

            $scope.$on('homeLocationText', function (event, text) {
            	if ($scope.type != 'FROM') {
            		$scope.initialValue = text;
            	}
            });

            $scope.$on('toggle-from-address', function (event, value) {
                if ($scope.type == 'FROM') {
                    $scope.disableInput = !value;
                }
            });

            activate(getMapCenter);
		}
    }
})();
(function () { 

    'use strict';

    angular
        .module('oneMVApp')
        .factory('locationService', locationService);
    locationService.$inject = ['$http', '$q', 'ConfigFactory'];

function locationService($http, $q, ConfigFactory) {

    var service = {
        saveLocation: saveLocation,
        isAddressInService: isAddressInService,
        getLocationTypes: getLocationTypes,
        getReverseGeoCode: getReverseGeoCode,
        getGeoCode: getGeoCode,
        getLocationData: getLocationData,
        editManualLocation: editManualLocation
    };
    return service;



    function saveLocation(saveLocation) {
        console.log(saveLocation);
        var deferred = $q.defer();
        ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
            if (oneMVURL && oneMVURL != "") {
                //get the base url from config.
                var serviceUrl = oneMVURL + 'Trip/SaveLocation';
                $http({
                    method: 'POST',
                    'url': serviceUrl,
                    data: JSON.stringify(saveLocation),
                    ContentType: "application/json; charset=utf-8"
                }).then(function (response) {
                    deferred.resolve(response);
                }, function (err) {
                    deferred.reject(err)
                });
            }
            else {
                $log.error('Error: - Could not fetch service api url')
                UtilityFactory.toastError("Could not fetch service api url");
            }
        });
        return deferred.promise;
    };

    function isAddressInService(Address) {
        var deferred = $q.defer();
        ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
            if (oneMVURL && oneMVURL != "") {
                //get the base url from config.
                var serviceUrl = oneMVURL + 'Trip/IsAddressInService';
                $http({
                    method: 'POST',
                    'url': serviceUrl,
                    data: JSON.stringify(Address),
                    ContentType: "application/json; charset=utf-8"
                }).then(function (response) {
                    deferred.resolve(response);
                }, function (err) {
                    deferred.reject(err)
                });
            }
            else {
                $log.error('Error: - Could not fetch service api url')
                UtilityFactory.toastError("Could not fetch service api url");
            }
        });
        return deferred.promise;
    };

    function getLocationTypes() {
        var deferred = $q.defer();
        var serviceUrl = '../ServiceArea/GetLocationTypes';
        $http({
            method: 'GET',
            'url': serviceUrl,
            ContentType: "application/json; charset=utf-8"
        }).then(function (response) {
            deferred.resolve(response);
        }, function (err) {
            deferred.reject(err)
        });
        return deferred.promise;
    };

    function getReverseGeoCode(latlng) {
        var deferred = $q.defer();
        var serviceUrl = 'https://maps.googleapis.com/maps/api/geocode/json?latlng=' + latlng;
        $http.get('//maps.googleapis.com/maps/api/geocode/json', {
            params: {
                latlng: latlng,
                sensor: true
            },
            withCredentials: false
            //$http({
            //    method: 'GET',
            //    'url': serviceUrl,
            //    ContentType: "application/json; charset=utf-8"
        }).then(function (response) {
            deferred.resolve(response);
        }, function (err) {
            deferred.reject(err)
        });
        return deferred.promise;
    };

    function getGeoCode(address) {
        var deferred = $q.defer();
        var serviceUrl = 'https://maps.googleapis.com/maps/api/geocode/json?address=' + address;
        $http.get('//maps.googleapis.com/maps/api/geocode/json', {
            params: {
                address: address,
                sensor: true
            },
            withCredentials: false
            //$http({
            //    method: 'GET',
            //    'url': serviceUrl,
            //    ContentType: "application/json; charset=utf-8"
        }).then(function (response) {
            deferred.resolve(response);
        }, function (err) {
            deferred.reject(err)
        });
        return deferred.promise;
    };
    function getLocationData(DivisionId) {
        var deferred = $q.defer();
        var serviceUrl = '';
        // if (Locationid > 0)
        ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
            if (oneMVURL && oneMVURL != "") {
                serviceUrl = oneMVURL + 'Trip/GetManualLocations/?DivisionId=' + DivisionId;
                //else
                //    serviceUrl = '../ServiceArea/GetManualLocations';
                $http({
                    method: 'GET',
                    'url': serviceUrl,
                    ContentType: "application/json; charset=utf-8"
                }).then(function (response) {
                    deferred.resolve(response);
                }, function (err) {
                    deferred.reject(err)
                });
            }
            else {
                $log.error('Error: - Could not fetch service api url')
                UtilityFactory.toastError("Could not fetch service api url");
            }
        });

        return deferred.promise;
    };

    function editManualLocation(locationId) {
        var deferred = $q.defer();
        var serviceUrl = '';
        // if (Locationid > 0)
        ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
            if (oneMVURL && oneMVURL != "") {
                serviceUrl = oneMVURL + 'Trip/EditManualLocation/?locationId=' + locationId;
                //else
                //    serviceUrl = '../ServiceArea/GetManualLocations';
                $http({
                    method: 'GET',
                    'url': serviceUrl,
                    ContentType: "application/json; charset=utf-8"
                }).then(function (response) {
                    deferred.resolve(response);
                }, function (err) {
                    deferred.reject(err)
                });
            }
            else {
                $log.error('Error: - Could not fetch service api url')
                UtilityFactory.toastError("Could not fetch service api url");
            }
        });

        return deferred.promise;
    };


}


})();
(function () {
    //debugger;

    'use strict';
    angular.module('oneMVApp').factory('MobilityAidsService', MobilityAidsService);
    MobilityAidsService.$inject = ['$http', '$q', 'ConfigFactory'];

    function MobilityAidsService($http, $q, ConfigFactory) {

        var service = {
            getDivisionAids: getDivisionAids,
            saveDivisionAids: saveDivisionAids
        }
        return service;

        function getDivisionAids(divisionId) {
            var defer = $q.defer();
            ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
                if (oneMVURL && oneMVURL != "") {
                    var _url = oneMVURL + "MobilityAids/" + divisionId + "?rnd=" + new Date().getTime();
                    $http({
                        method: 'GET',
                        url: _url
                    }).then(function successCallback(response) {
                        if (response.data.status == 1) {
                            defer.resolve(response.data.result);
                        } else {
                            defer.reject(response.data.result);
                        }
                    }, function errorCallback(response) {
                        defer.reject(response);
                    });
                }
            });
            return defer.promise;
        }

        function saveDivisionAids(divisionId, aids) {
            var defer = $q.defer();
            ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
                if (oneMVURL && oneMVURL != "") {
                    var _url = oneMVURL + "MobilityAids/" + divisionId + "?rnd=" + new Date().getTime();
                    $http({
                        method: 'POST',
                        data: aids,
                        url: _url
                    }).then(function successCallback(response) {
                        if (response.data.status == 1) {
                            defer.resolve(response.data.result);
                        } else {
                            defer.reject(response.data.result);
                        }
                    }, function errorCallback(response) {
                        defer.reject(response);
                    });
                }
            });
            return defer.promise;
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('NegotiationController', NegotiationController);

    NegotiationController.$inject = ['$uibModalInstance', '$scope', '$filter','authService','DivisionService',
        'TripNegotiationLogService', 'DateFactory', 'negotiationRequest'];

    function NegotiationController($uibModalInstance, $scope, $filter,authService, DivisionService,
        TripNegotiationLogService, DateFactory, negotiationRequest) {
        var vm = this;

        vm.proposedSlots = negotiationRequest.proposedSlots;
        vm.selectedSlot = '';
        vm.reservation = angular.copy(negotiationRequest.reservationRequest);
        vm.selectedReservationType = '';

        var userId = 0;
        var tripRequestId = 0;
        var serviceDate = negotiationRequest.serviceDate;
        var promiseWindow = 0;

        //forced to use this as pax and ops portal reservation objects are not in sync.        
        var reservationTypeEnum = {
            1: "ASAP",
            2: "ADVANCED",
            3: "APPOINTMENT"
        };

        vm.toPromiseWindow = function (proposedSlot) {

            var startTime = $filter('date')(proposedSlot.ProposedStartWindow, 'h:mm a');
            //var endTime = DateFactory.getPromiseWindowEndTime(input, promiseWindow);
            var endTime = $filter('date')(proposedSlot.ProposedEndWindow, 'h:mm a');

            return startTime + ' - ' + endTime;
        };

        var toThirtyThreeHourClock = function (input) {
            return DateFactory.getCustomTime(input, serviceDate);
        };


        var activate = function () {
            tripRequestId = negotiationRequest.tripRequestId;

            userId = authService.authentication.userId;
            promiseWindow = DivisionService.getSystemParameters().PromiseWindow;

            vm.selectedReservationType = reservationTypeEnum[vm.reservation.reservationType];

        }

        var closeModal = function (response) {
            $uibModalInstance.close(response);
        }

        vm.reject = function () {

            TripNegotiationLogService
                    .addRejectionLog(tripRequestId, userId);

            closeModal({
                canNegotiate: false
            });
        };


        vm.close = function () {
            closeModal({
                canNegotiate: false
            });
        }

        vm.accept = function () {
            if (vm.selectedSlot != '') {
                var negotiationLogId = getNegotiatedLogId();

                TripNegotiationLogService
                    .addApprovalLog(tripRequestId, negotiationLogId, userId);

                closeModal(
                    {
                        canNegotiate: true,
                        selectedTime: vm.selectedSlot,
                        tripRequestId: tripRequestId,
                        negotiationLogId: negotiationLogId
                    });
            }
        }

        function getNegotiatedLogId() {
            if (vm.selectedSlot != '') {
                for (var i = 0; i < vm.proposedSlots.length; i++) {
                    if (vm.proposedSlots[i].ProposedDate == vm.selectedSlot)
                        return vm.proposedSlots[i].id;
                }
            }
            return -1;
        }

        activate();
    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('ReservationErrorModalController', ReservationErrorModalController);

    ReservationErrorModalController.$inject = ['$uibModalInstance', 'message'];

    function ReservationErrorModalController($uibModalInstance, message) {
        var vm = this;

        vm.msg = message.message.ErrorMessage;
        vm.header = message.header || "Information" ;
        vm.cancel = cancel;

        function cancel() {
            $uibModalInstance.close();
        };
    }
})();



(function () {
    'use strict';

    angular.module('oneMVApp')
    .directive('reservationFormDirective', reservationFormDirective);

    reservationFormDirective.$inject = ['$window', 'LocationFactory', 'UtilityFactory', 'ScheduleService',
        'DateFactory','$q', 'DivisionService', 'GeoLocationService', 'StopService', 'FaringService', '$timeout',
        'ProfileService','OneMvServices'];

    function reservationFormDirective($window, LocationFactory,  UtilityFactory, ScheduleService,
        DateFactory, $q, DivisionService, GeoLocationService, StopService, FaringService, $timeout,
        ProfileService,OneMvServices) {
        // Usage:
        //     <reservation-form-directive></reservation-form-directive>
        // Creates:
        //      An instance of the reservation form which can used to book a reservation.
        //      There are three variations of this form controlled by the variable 'reservationType'
        //      1. reservationType = 'past'
        //         This is the form which can be used when the operator wants to reconcile previous reservations
        //      2. reservationType = 'current'
        //         This is the form which can be used for booking a current reservation
        //      3. reservationType = 'future'
        //         This is the form which can be used to book future reservations
        var directive = {
            link: link,
            controller: controller,
            restrict: 'E',
            scope: { passenger: '<', options: '<', mode: '@', notifySucessfullReservation: '=onReservationSuccess' },
            replace: true,
            templateUrl: 'app/modules/on-demand/reservations/passengerReservationForm.html'
        };
        return directive;

        function link(scope, element, attrs) {
            // If scope.$watch('option') loads late, IE in a slow connection, then the watch NEVER fires.
            // This is here to run scope.activate() if on load, scope.options exists.
            if (scope.isLoading && scope.options) {
                scope.activate();
            };
            scope.$watch('options', function (newValue, oldValue) {
                if (newValue != oldValue && newValue) {
                    //if (typeof newValue == "string") {
                    //    scope.options = JSON.parse(newValue);
                    //}
                    //else if (typeof newValue == "object")
                    scope.options = newValue;

                    scope.activate();
                };
            });


            //scope.$watch('passenger', function (newValue, oldValue) {
            //    if (newValue != oldValue && newValue) {
            //        //if (typeof newValue == "string") {
            //        //    scope.passenger = JSON.parse(newValue);
            //        //}
            //        //else if (typeof newValue == "object") {
            //            scope.passenger = newValue;
            //        //}
            //        //if (newValue != oldValue)
            //            scope.resetForm();
            //    };
            //});
        }

        function controller($scope,$uibModal) {
            /*Methods exposed to view*/
        	$scope.reservationRequest = {};
        	$scope.aids = [];
        	$scope.assistants = [];
        	$scope.populateRuns = populateRuns;
        	$scope.populateCount = populateCount;
        	$scope.childrenCount = childrenCount;
            $scope.populateHours = populateHours;
            $scope.populateMinutes = populateMinutes;
            $scope.dataServiceFrom = LocationFactory.dataServiceFrom;
            $scope.dataServiceTo = LocationFactory.dataServiceTo;
            $scope.saveReservation = saveReservation;
            $scope.disableSaveButton = disableSaveButton;
            $scope.setPickupDateTime = setPickupDateTime;
            $scope.activate = activate;
            $scope.resetForm = resetForm;
            $scope.closeDateTimePicker = closeDateTimePicker;
            $scope.timepickerClicked = timepickerClicked;
            $scope.resetDateOptionFields = resetDateOptionFields;
            $scope.resetDates = resetDates;
            $scope.displayFaring = displayFaring;
            $scope.disableFaringButton = disableFaringButton;
            $scope.getReservationDateTime = getReservationDateTime;
            $scope.toggleOptions = toggleOptions;
            $scope.isLoading = true;
            $scope.isHidden = false;
            $scope.showCalendarButton = true;
            $scope.showCalendar = false;
            /*Methods exposed to view*/
            $scope.runs = [];
            $scope.loadingRuns = false;
            $scope.isSaving = false;
            $scope.division;
            $scope.operator;
            $scope.systemParameters;
            $scope.displayDateTimepicker = false;
            $scope.minDate = new Date();
            // $scope.options = undefined;
            $scope.requestDateTime = undefined;
            $scope.isDateSelected = false;
            $scope.isGpsEnabled = true;
            $scope.hasGpsBeenChecked = false;
            $scope.dateOptions = {
                formatYear: 'yy',
                minDate: new Date(),
                startingDay: 1,
                showWeeks: false
            };
            $scope.timepickerObject = {};
            $scope.isFRServiceActive = false;

            $scope.isUserAllowedToMakeAReservation = isUserAllowedToMakeAReservation;

            initializeLocationNotes();

            $scope.isAllowed = true;

            //enum to match enum in Server side code
            var reservationTypeEnum = {
                ASAP: 1,
                ADVANCED: 2,
                APPOINTMENT: 3
            };
            $scope.reservationTypeEnum = reservationTypeEnum;

            var timeFormat = 'h:mm A';


            function toggleOptions() {
                $scope.isHidden = !$scope.isHidden;
            }

            function populateCount(count) {
                return new Array(count);
            }

            function childrenCount(count) {
                var childrenArray = [];
                for (var i = 0; i <= count; i++) {
                    childrenArray.push(i);
                }
                return childrenArray;
            }


            function isCalenderButtonActive()
            {
                if (!$scope.options.isAdvancedReservation)
                    return false;

                if (!$scope.displayDateTimepicker && !$scope.isDateSelected)
                    return true;
                return false;
            }
            function activate() {

                //Find out if FR is active for this division. This will be used later on while reserving
                // DivisionService.getDivisionInfo()
                // .then(function (response) {
                //     var divisionInfo = response.data.result;
                //     for (var i = 0; i < divisionInfo.Services.length; i++) {
                //         if (divisionInfo.Services[i].ServiceId == "fixed") {
                //             $scope.isFRServiceActive = true;
                //         }
                //     }
                // }, function (error) {
                // });

                $scope.isFRServiceActive =!angular.isUndefined(OneMvServices.getFixedRouteInfo());

                getServiceDate()//promise chaining.
                    .then(
                    populateRuns);

                $scope.isStartDp = false;
                var dt = new Date();
                $scope.dateOptions.minDate = new Date(dt.setDate(dt.getDate() + $scope.options.passengerBookingMinDays));
                $scope.dateOptions.maxDate = new Date(dt.setDate(dt.getDate() + $scope.options.passengerBookingMaxDays));
                $scope.reservationRequest.ReservationDateView = $scope.dateOptions.minDate;
                $scope.showCalendar = !$scope.options.isAdvancedReservation;
                $scope.showCalendarButton = isCalenderButtonActive();
                //setReservationType();
                $scope.isLoading = false;
                resetForm();

            };
            //
            // Listen to Geolocationservice to find out if GPS is enabled.
            //
            $scope.$on('GeoLocationService.gpsIsAvailable', function (event, data) {
                $scope.isGpsEnabled = data.gpsIsEnabled;
                if (!data.gpsIsEnabled && $scope.options
                    && $scope.options.allowReservationOnlyWhenGpsIsOn) {
                    if (!$scope.isGpsEnabled) {
                        $scope.$broadcast('toggle-from-address', !$scope.options.allowReservationOnlyWhenGpsIsOn);
                        // Only show toast message once.
                        if (!document.getElementById('toast-container')) {
                            UtilityFactory.toastInfo('Information', 'Enable gps to make a reservation.', 10000);
                        };
                        // Wait 2 seconds, then hide any modals that may have been displayed, 
                        // IE. the 'Please find and select your home address'
                        $timeout(function () {
                            $('[uib-modal-window=modal-window]').remove();
                            $('body').removeClass('modal-open');
                        }, 3000);
                        // Display message for 15 seconds then redirect to dashboard.  Changed to 10 seconds per Jason request.
                        $timeout(function () {
                            if (!isUserAllowedToMakeAReservation()) {
                                $('[uib-modal-window=modal-window]').remove();
                                $('body').removeClass('modal-open');
                                $window.location.replace('#/');
                                $window.location.reload(true);  // I must do a hard refresh to wipe out any modals controllers that may or may not be loaded.
                            };
                        }, 15000);
                    };
                };
                $scope.hasGpsBeenChecked = true;
            })
            //
            // Function to determine if the division only allows reservation when GPS is on
            // AND if gps is on.
            //
            function isUserAllowedToMakeAReservation(){
                if(!$scope.hasGpsBeenChecked){
                    $scope.hasGpsBeenChecked = true;
                    GeoLocationService
                        .getCurrentPosition()
                }
                var r = true;
                if ($scope.options && $scope.options.allowReservationOnlyWhenGpsIsOn && $scope.hasGpsBeenChecked){
                    r = $scope.options.allowReservationOnlyWhenGpsIsOn ?$scope.isGpsEnabled : true;
                }
                return r;
            }

            function setCurrentTime()
            {
                var currentDate = moment.tz(DivisionService.getTimeZone());//new Date(new Date().getTime() + 10 * 60 * 1000);
                var currentHour = parseInt(currentDate.format('HH'));
                var currentMinute = parseInt(currentDate.format('mm'));
                var currentTime12Hr = (currentHour > 12 ? (currentHour - 12) : (currentHour == 0 ? 12 : currentHour));
                var currentTime5mInv = currentMinute == 0 ? 0 : (currentMinute == 5 ? 5 : (Math.ceil(currentMinute/5)*5));
                $scope.timepickerObject.AMPMView = currentDate.format('a').toUpperCase();
                $scope.timepickerObject.schedHrView = currentTime12Hr < 10 ? "0" + currentTime12Hr.toString(): currentTime12Hr.toString();
                $scope.timepickerObject.schedMinView = currentMinute < 5 ? "0" + currentTime5mInv.toString() : currentTime5mInv.toString();
                $scope.reservationRequest.ReservationDateView = $scope.dateOptions.minDate;
                $scope.schedHr =  $scope.timepickerObject.schedHrView;
                $scope.schedMin =  $scope.timepickerObject.schedMinView;
                $scope.AMPM =  $scope.timepickerObject.AMPMView;
                $scope.reservationRequest.ReservationDate = $scope.reservationRequest.ReservationDateView;
                
            } 

            function resetForm() {
                resetDateOptionFields();
                $scope.$broadcast('angucomplete-alt:clearInput');

            }

            $scope.clickMobilityAid = function (aid) {
            	if ($scope.aids && $scope.aids.length > 0) {
            		for (var i = 0; i < $scope.aids.length; i++) {
            			$scope.aids[i].IsSelected = false;
            		}
            		if (aid) {
            			aid.IsSelected = true;
            		}
            	}
            }

            function populateMobilityAids() {
            	$("#rdoNoMobilityAids").prop("checked", true);
            	ProfileService.GetDefaultMobilityAids($scope.options.DivisionId, $scope.passenger.Id)
                .then(function (defaultMobilityAids) {
                	// clear aids lists
                	$scope.aids.length = 0;
                	$scope.assistants.length = 0;

                	// create no aids choice
                	var noAids = {
                		IsSelected: true,
                		KeyName: "no aids",
						Group: 2,
                		DisplayName: "No Mobility Aid Required"
                	};
                	$scope.aids.push(noAids);

                	// append all aids allowed by division
                	var aidCount = 0;
                	for (var i = 0; i < defaultMobilityAids.length; i++) {
                    	var mobilityAid = defaultMobilityAids[i];
                    	if (mobilityAid.Group == 1) {
                    		mobilityAid.selected = mobilityAid.IsSelected;
                    		$scope.assistants.push(mobilityAid);
                    	} else if (mobilityAid.Group == 2) {
                    		if (mobilityAid.IsSelected == true) {
                    			if (aidCount > 0) {
                    				mobilityAid.IsSelected = false;
                    			}
                    			aidCount++;
                    		}
                    		mobilityAid.selected = mobilityAid.IsSelected;
                    		if (mobilityAid.IsSelected)
                    		    noAids.IsSelected = false;
                    		$scope.aids.push(mobilityAid);
                        }
                    }
                }, function (response) {
                    UtilityFactory.toastError('Error', response.Message);
                });
            }
            function resetDateOptionFields()
            {
                $scope.reservationRequest = {};

                $scope.reservationRequest.PassengerCount = "1";
                $scope.reservationRequest.CompanionsCount = "0";
                $scope.reservationRequest.mobilityAid = "none";
                $scope.reservationRequest.IsWheelChair = false;
                $scope.reservationRequest.IsPCA = false;
                $scope.reservationRequest.IsServiceAnimal = false;
                $scope.reservationRequest.TripFares = [];


                //$scope.reservationRequest.IsASAP = true;
                setReservationType();

                resetDates();

                initializeLocationNotes();
            }

            function initializeLocationNotes() {
                if ($scope.options && $scope.options.allowLocationNotes) {
                    $scope.reservationRequest.locationNotes = {
                        'from': '', 'to': ''
                    };
                    //$scope.showLocationNotes = {
                    //    'from': false, 'to': false
                    //};
                }
            }

           


            function resetDates() {
                setCurrentTime();
                if ($scope.options.isAdvancedReservation && ($scope.options.passengerBookingMinDays > 0)) {
                    if ($scope.reservationRequest.ReservationDate) {
                        setPickupDateTime();
                    }
                }
                else {
                    $scope.isDateSelected = false;
                    $scope.displayDateTimepicker = false;
                }
                $scope.showCalendarButton = isCalenderButtonActive();
            }

            function setReservationType() {
                if ($scope.options.isAdvancedReservation && ($scope.options.passengerBookingMinDays > 0)) {
                    $scope.reservationRequest.reservationType = $scope.reservationTypeEnum.ADVANCED;
                }
                else {
                    if ($scope.options.allowASAPReservations)
                        $scope.reservationRequest.reservationType = $scope.reservationTypeEnum.ASAP;
                    else if ($scope.options.isAdvancedReservation)
                        $scope.reservationRequest.reservationType = $scope.reservationTypeEnum.ADVANCED;
                }
            }

            function closeDateTimePicker() {
                if ($scope.options.isAdvancedReservation && ($scope.options.passengerBookingMinDays > 0)) {
                    resetDates();
                }
                else {
                    //get old dates time
                     $scope.timepickerObject.schedHrView = $scope.schedHr;
                     $scope.timepickerObject.schedMinView = $scope.schedMin;
                     $scope.timepickerObject.AMPMView = $scope.AMPM;
                    $scope.displayDateTimepicker = false;
                    $scope.reservationRequest.ReservationDateView = $scope.reservationRequest.ReservationDate;
                    if (!$scope.isDateSelected) {
                        setReservationType();
                    }
                    $scope.showCalendarButton = isCalenderButtonActive();
                }
            }
            function timepickerClicked() {

                $scope.displayDateTimepicker = !$scope.displayDateTimepicker;
                //$scope.reservationRequest.IsASAP = !$scope.displayDateTimepicker;
                if ($scope.options.isAdvancedReservation)
                    $scope.reservationRequest.reservationType = String(reservationTypeEnum.ADVANCED);
                else if($scope.options.allowAppointments)
                    $scope.reservationRequest.reservationType = String(reservationTypeEnum.APPOINTMENT);
                $scope.isDateSelected = false;
                $scope.showCalendarButton = false;
                setCurrentTime();
            }
            function getServiceDate() {
                return ScheduleService.getServiceDateByDivision($scope.options.DivisionId)
                        .then(function (response) {
                            if (response.data.status == 1) {
                                $scope.serviceDate = moment(response.data.result);
                                // $scope.reservationRequest.ReservationDate = new Date($scope.serviceDate;
                                if ($scope.mode == "reconciliation") {
                                    //$scope.reservationRequest.ReservationDate = $scope.serviceDate.subtract(1, 'days').format('MM-DD-YYYY');
                                    $scope.minDate = new Date(1990, 5, 22); //nor sure why this is hard-coded
                                    $scope.maxDateAllowed = $scope.serviceDate
                                } else {

                                };
                            }
                        }, function errorCallback(response) {
                            UtilityFactory.toastError("Error!", "Failed to get service date.");
                        });
            }
            function populateHours() {                
                return  new Array ('01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12');
            }
            function populateMinutes()
            {
                var minutesArray = new Array();
                for (var i = 0; i < 60; i+=5) {
                    minutesArray.push(i < 10 ? ('0' + i.toString()) : i.toString());
                }
                return minutesArray;
            }


            function setPickupDateTime()
            {
                $scope.schedHr =  $scope.timepickerObject.schedHrView;
                $scope.schedMin =  $scope.timepickerObject.schedMinView;
                $scope.AMPM =  $scope.timepickerObject.AMPMView;
                $scope.reservationRequest.ReservationDate = $scope.reservationRequest.ReservationDateView;

                $scope.isDateSelected = true;
                if (angular.isUndefined($scope.reservationRequest) || $scope.reservationRequest === null || $scope.reservationRequest.reservationType == reservationTypeEnum.ASAP)
                    return false;
                var hrs = 0;
                if ($scope.AMPM === "PM" && parseInt($scope.schedHr) != 12)
                    hrs = parseInt($scope.schedHr) + 12;
                else if ($scope.AMPM === "AM" && parseInt($scope.schedHr) == 12)
                    hrs = 0;
                else
                    hrs = parseInt($scope.schedHr);

                $scope.requestDateTime = new Date($scope.reservationRequest.ReservationDate).setHours(hrs, parseInt($scope.schedMin), 0);              

                $scope.displaySelectedDate = true;
                $scope.displayDateTimepicker = false;
            };

            function populateRuns() {
                populateMobilityAids();
                if ($scope.passenger)
                    return;
                $scope.loadingRuns = true;
                // let runDate = moment($scope.reservationRequest.ReservationDate).format('MM-DD-YYYY');
                //let isoFormatRunDate = moment($scope.reservationRequest.ReservationDate, 'MM-DD-YYYY').format();

                if ($scope.mode == "reconciliation")
                {
                    ScheduleService.getPastRuns($scope.options.DivisionId, runDate)
                   .then(function (response) {
                       $scope.loadingRuns = false;
                       if (response.data != null) {
                           $scope.runs = response.data.result
                           for (var i = 0; i < $scope.runs.length; i++) {
                               $scope.runs[i].StartTimeDisplay = DateFactory.getCustomTime($scope.runs[i].StartTime, runDate);
                               $scope.runs[i].EndTimeDisplay = DateFactory.getCustomTime($scope.runs[i].EndTime, runDate);
                           };
                       }
                       else {
                           UtilityFactory.toastError('Error', response.data.ReturnMessage);
                       }
                   }, function (response) {
                       $scope.loadingRuns = false;
                       UtilityFactory.toastError('Error', response.data.ReturnMessage);
                   });
                }
                else
                {
                    ScheduleService.getActiveRuns($scope.options.DivisionId, runDate)
                   .then(function (response) {
                       $scope.loadingRuns = false;
                       if (response.data != null) {
                           $scope.runs = response.data.result
                           for (var i = 0; i < $scope.runs.length; i++) {
                               $scope.runs[i].StartTimeDisplay = DateFactory.getCustomTime($scope.runs[i].StartTime, runDate);
                               $scope.runs[i].EndTimeDisplay = DateFactory.getCustomTime($scope.runs[i].EndTime, runDate);
                           };
                           var reservationRuns = [];

                           angular.forEach($scope.runs, function (value, key) {
                               if (value.logisticStatus != '109' && value.Status != 'Frozen' && !value.IsDeleted) {
                                   reservationRuns.push(value);
                                   //$scope.runs.splice($scope.runs.indexOf(value)+1, 1);
                               }
                           });
                           $scope.runs = reservationRuns;
                       }
                       else {
                           UtilityFactory.toastError('Error', response.data.ReturnMessage);
                       }
                   }, function (response) {
                       $scope.loadingRuns = false;
                       UtilityFactory.toastError('Error', response.data.ReturnMessage);
                   });
                }

            }
            function onSucessfullReservation(trip, isASAP) {
                if (typeof ($scope.notifySucessfullReservation) == 'function') {
                    $scope.notifySucessfullReservation(trip, isASAP);
                }
            }
            function saveReservation(reservationRequest) {
                //
                // Double check to see if GPS is required and if GPS is enabled.
                //
                if($scope.options.allowReservationOnlyWhenGpsIsOn && isUserAllowedToMakeAReservation()){
                    GeoLocationService
                        .getCurrentPosition()
                        .then(function(){
                            if (!isUserAllowedToMakeAReservation()){
                                return;
                            };
                        });
                };
                if (reservationRequest.reservationType == reservationTypeEnum.ADVANCED || reservationRequest.reservationType == reservationTypeEnum.APPOINTMENT) {
                    if (!$scope.isDateSelected)
                    {
                        timepickerClicked();
                        return;
                    }
                }
                //reservationType 1, 2, 3
                if (!$scope.isDateSelected)
                    reservationRequest.IsASAP = true;

                $scope.isSaving = true;

                var hrs = getHours();

                var mins = $scope.schedMin;

                reservationRequest.ReservationTime = hrs.toString().length == 1 ? ("0" + hrs.toString() + mins) : (hrs.toString() + mins);

                if (validateRequest(reservationRequest)) {
                    //Check for FR exclusion
                    if ($scope.isFRServiceActive)//check if FR is active for this division
                    {
                        var checkFixedRoutes = $scope.options.checkFRBeforeDRT; //system parameter which tells whether to check for fixed route before booking a drt
                        var noOfArrivals = $scope.options.noOfFRArrivals; //system parameter which tells how many fixed rote arrivals to show
                        if (checkFixedRoutes) {
                            StopService.getUpcomingArrivalsForStop($scope.options.DivisionId,
                                                                    reservationRequest.FromLocation.LocationId,
                                                                    reservationRequest.ToLocation.LocationId,
                                                                    noOfArrivals)
                            .then(function (response) {
                                var upcomingSchedules = response.data;
                                if (upcomingSchedules.length > 0) {
                                    showFixedRoutes(upcomingSchedules, reservationRequest.FromLocation.Name);
                                    $scope.isSaving = false;
                                } else {
                                    reserveTrip(reservationRequest)
                                }
                            },
                            function (error) {

                            });
                        } else {
                            reserveTrip(reservationRequest)
                        }
                    } else {
                        reserveTrip(reservationRequest)
                    }

                } else {
                    $scope.isSaving = false;
                };
            }

            function getHours() {
                var hrs = 0;
                if ($scope.AMPM === "PM" && parseInt($scope.schedHr) != 12)
                    hrs = parseInt($scope.schedHr) + 12;
                else if ($scope.AMPM === "AM" && parseInt($scope.schedHr) == 12)
                    hrs = 0;
                else
                    hrs = parseInt($scope.schedHr);

                return hrs;
            }


            function getReservationDateTime(reservationRequest)
            {
                var hrs = getHours();

                var d = new Date(reservationRequest.ReservationDate.setHours(hrs, parseInt($scope.schedMin), 0));

                var curr_date = d.getDate();
                var curr_month = d.getMonth() +1;
                var curr_year = d.getFullYear();
                var inputDate = curr_year + "/" +curr_month + "/" + curr_date + " " +hrs.toString() + ":" +$scope.schedMin;

                return moment.tz(inputDate, "YYYY/M/D HH:mm", DivisionService.getTimeZone());
            }
            function reserveTrip(reservationRequest) {
                UtilityFactory.toastInfo("Creating Trip");
                var saveTripReq = {
                };
                var savedTrip = {
                };
                saveTripReq.PassengerID = parseInt($scope.passenger.Id);
                //here figure out from reservationType what ASAP, Advanced, Appointment

                if (reservationRequest && (reservationRequest.reservationType != reservationTypeEnum.ASAP) && reservationRequest.ReservationTime)
                {
                    // request advanced reservation
                    if ($scope.passenger)
                    {


                        var hrs = getHours();

                        var d = new Date(reservationRequest.ReservationDate.setHours(hrs, parseInt($scope.schedMin), 0));

                        var curr_date = d.getDate();
                        var curr_month = d.getMonth() + 1;
                        var curr_year = d.getFullYear();
                        var inputDate = curr_year + "/" + curr_month + "/" + curr_date + " " + hrs.toString() + ":" + $scope.schedMin;

                        saveTripReq.RequestedStartDateTime = moment.tz(inputDate, "YYYY/M/D HH:mm" ,DivisionService.getTimeZone());

                    }
                    else
                    saveTripReq.RequestedStartDateTime = DateFactory.getDateFromCustomTime(reservationRequest.ReservationTime, moment(reservationRequest.ReservationDate));//non asap field
                }
                saveTripReq.OperationID = ($scope.options.OperatorId != null) ? $scope.options.OperatorId : null;

                saveTripReq.NumOfPassengers = reservationRequest.PassengerCount;
                saveTripReq.NumOfWheelChairPassengers = 0;
                saveTripReq.NumOfXLWheelChairPassengers = 0;
                saveTripReq.NumOfScooterPassengers = 0;
                saveTripReq.NumOfWalkerPassengers = 0;
                saveTripReq.NumOfPCAs = 0;
                saveTripReq.NumOfServiceAnimals = 0;
                saveTripReq.NumOfBikePassengers = 0;
                if ($scope.options.allowEquipment) {
                    if ($scope.aids.length > 0) {
                    	for (var i = 0; i < $scope.aids.length; i++) {
                    		var mobilityAid = $scope.aids[i];
                    		if (mobilityAid.IsSelected) {
                    		    saveTripReq.SelectedMobilityAidId = mobilityAid.MVMobilityAidsId;
                    			var keyName = mobilityAid.KeyName.trim().toLowerCase()
                    			if (keyName == "wc") {
                    				saveTripReq.NumOfPassengers = reservationRequest.PassengerCount - 1;
                    				saveTripReq.NumOfWheelChairPassengers = 1;
                    			} else if (keyName == "wcxl") {
                    				saveTripReq.NumOfPassengers = reservationRequest.PassengerCount - 1;
                    				saveTripReq.NumOfXLWheelChairPassengers = 1;
                    			} else if (keyName == "sctr") {
                    				saveTripReq.NumOfPassengers = reservationRequest.PassengerCount - 1;
                    				saveTripReq.NumOfScooterPassengers = 1;
                    			} else if (keyName == "wkr") {
                    				saveTripReq.NumOfPassengers = reservationRequest.PassengerCount - 1;
                    				saveTripReq.NumOfWalkerPassengers = 1;
                    			} else if (keyName == 'birk') {
                    			    saveTripReq.NumOfPassengers = reservationRequest.PassengerCount - 1;
                    			    saveTripReq.NumOfBikePassengers = 1;
                    			}
                    		}
                    	}
                    }

                    if ($scope.assistants.length > 0) {
                    	for (var i = 0; i < $scope.assistants.length; i++) {
                    		var assistant = $scope.assistants[i];
                    		if (assistant.IsSelected) {
                    			var keyName = assistant.KeyName.trim().toLowerCase()
                    			if (keyName == "sa") {
                                    saveTripReq.NumOfServiceAnimals = 1;
                    			} else if (keyName == "pca") {
                                    saveTripReq.NumOfPCAs = 1;
                                }
                            }
                        }
                    }
                }

                saveTripReq.NumOfCompanions = reservationRequest.CompanionsCount;
                saveTripReq.RunId = reservationRequest && reservationRequest.Run && reservationRequest.Run.RunId ? reservationRequest.Run.RunId : null;

                saveTripReq.StartAddressViewModel = reservationRequest.FromLocation;
                saveTripReq.EndAddressViewModel = reservationRequest.ToLocation;
                saveTripReq.ReservationType = reservationRequest.reservationType;
                if (angular.equals(saveTripReq.StartAddressViewModel, {}) || saveTripReq.StartAddressViewModel == undefined) {
                    UtilityFactory.toastError('Error', "Invalid location");
                    $scope.isSaving = false;
                    return false;
                }
                if (angular.equals(saveTripReq.EndAddressViewModel, {}) || saveTripReq.EndAddressViewModel == undefined) {
                    UtilityFactory.toastError('Error', "Invalid location");
                    $scope.isSaving = false;
                    return false;
                }
                if ($scope.options && $scope.options.allowLocationNotes) {
                    saveTripReq.StartAddressViewModel.LocationNote = reservationRequest.locationNotes.from.trim();
                    saveTripReq.EndAddressViewModel.LocationNote = reservationRequest.locationNotes.to.trim(); 
                }

                if (reservationRequest.TripFares != undefined)
                    saveTripReq.TripFares = reservationRequest.TripFares;
                if (reservationRequest.TotalTripFare != undefined)
                    saveTripReq.TotalTripFare = reservationRequest.TotalTripFare;


                saveTripReq.IsDivisionAdvanced = $scope.options.isAdvancedReservation;
                saveTripReq.ServiceDate = $scope.serviceDate;
                saveTripReq.IsWillCall = reservationRequest.IsWillCall;
                if ($scope.mode == "reconciliation") {
                    //Reconciliation Case
                    if (!saveTripReq.RunId)
                        saveTripReq.RunId = -1; //setting it to an int value, else the request object is going as null to the server
                    saveTripReq.RunDate = reservationRequest.ReservationDate;
                    var serviceDate = moment(reservationRequest.ReservationDate);
                    saveTripReq.ArrivePickUpDateTimeUTC = DateFactory.getDateFromCustomTime(reservationRequest.ArrivePickUpTime, serviceDate);
                    saveTripReq.PerformPickUpDateTimeUTC = DateFactory.getDateFromCustomTime(reservationRequest.PerformPickUpTime, serviceDate);
                    saveTripReq.ArriveDropOffDateTimeUTC = DateFactory.getDateFromCustomTime(reservationRequest.ArriveDropOffTime, serviceDate);
                    saveTripReq.PerformDropOffDateTimeUTC = DateFactory.getDateFromCustomTime(reservationRequest.PerformDropOffTime, serviceDate);

                    ScheduleService.savePastTrip(saveTripReq)
                    .then(function (response) {
                        if (response.data.status == 1) {
                            savedTrip = response.data.result;
                            resetForm();
                            UtilityFactory.toastSuccess(response.data.message);
                            onSucessfullReservation(savedTrip);
                        }
                        else {
                            UtilityFactory.toastInfo(response.data.message);
                        }
                        $scope.isSaving = false;
                    },
                    function (errormsg) {
                        UtilityFactory.toastError('Error', errormsg.data);
                        $scope.isSaving = false;
                    });


                } else if ($scope.mode == "reservation") {
                	// request demand reservation
                    ScheduleService.schedulepost(saveTripReq)
                    .then(function (response) {
                        if (response.data.status == 1) {
                            savedTrip = response.data.result;
                            resetForm();
                            UtilityFactory.toastSuccess(response.data.message);
                            onSucessfullReservation(savedTrip, parseInt(reservationRequest.reservationType) == reservationTypeEnum.ASAP);
                        }
                        else if (response.data.errors != null) {
                            var zoneExclIndex = -1;
                            var locExclIndex = -1;
                            var capacityError = false;
                            var negotiatedResponse = false;
                            $.each(response.data.errors, function (index, value) {
                                var errCode = value.ErrorCode;
                                //Show the over-ride pop-up
                                if (errCode == -8) {
                                    zoneExclIndex = index;
                                }
                                else if (errCode == -7) {
                                    locExclIndex = index;
                                }
                                else if (errCode == 9) {
                                    capacityError = true;
                                }
                                else if (errCode == 10) {
                                    negotiatedResponse = true;
                                }
                            });

                            if (zoneExclIndex >= 0) {
                                showReservationErrorModal(response.data.errors[zoneExclIndex])
                                    .then(function (retValue) {
                                        if (locExclIndex >= 0) {
                                            showOverrideModal(response.data.errors[locExclIndex]).then(function (retValue) {
                                            });
                                        }
                                        else {
                                        }
                                    });
                            }
                            else if (locExclIndex >= 0) {
                                showReservationErrorModal(response.data.errors[locExclIndex]).then(function (retValue) {
                                });
                            }
                            else if (negotiatedResponse)
                                manageNegotiation(response, saveTripReq);
                            else if (capacityError) {
                                showReservationErrorModal(response.data.errors[0], "Capacity Unavailable");
                            }
                            else {
                                UtilityFactory.toastError('Creating Reservation', response.data.message);
                            }
                        }
                        else {
                            UtilityFactory.toastError('Creating Reservation', response.data.message);
                        }
                        $scope.isSaving = false;
                    },
                    function (errormsg) {
                        UtilityFactory.toastError('Error', errormsg.data);
                        $scope.isSaving = false;
                    });
                }
            }
            function disableSaveButton() {
                return isSaving;
            }


            function manageNegotiation(response, tripRequest) {
                tripRequest.NegotiationInfo = undefined;

                if (response.data.result) {
                    displayNegotiationModal(response.data, tripRequest)
                    .then(function (negotiatedRequest) {
                        reserveNegotiatedTrip(negotiatedRequest, tripRequest);
                    });
                }
            };


            function reserveNegotiatedTrip(negotiatedRequest, tripRequest) {

                if (negotiatedRequest
                    && negotiatedRequest.NegotiationInfo
                    && negotiatedRequest.NegotiationInfo.IsNegotiated) {

                    tripRequest.NegotiationInfo = negotiatedRequest.NegotiationInfo;
                    tripRequest.RequestedStartDateTime = negotiatedRequest.NegotiationInfo.SelectedTime;

                    scheduleNegotiatedTrip(tripRequest);
                }
            }

            function scheduleNegotiatedTrip(tripRequest) {
                ScheduleService.schedulepost(tripRequest)
                   .then(function (response) {
                       if (response.data.status == 1) {
                           var savedTrip = response.data.result;
                           resetForm();
                           UtilityFactory.toastSuccess(response.data.message);
                           onSucessfullReservation(savedTrip, parseInt(tripRequest.ReservationType) == reservationTypeEnum.ASAP);
                       }
                       else
                           UtilityFactory.toastError('Creating Reservation', response.data.message);

                       $scope.isSaving = false;
                   }, function (errormsg) {
                       UtilityFactory.toastError('Error', errormsg.data);
                       $scope.isSaving = false;
                   });
            }


            function displayNegotiationModal(negotiationResponse) {
                var deferred = $q.defer();

                var negotiationModal = $uibModal.open({
                    animation: true,
                    templateUrl: 'app/modules/on-demand/reservations/negotiation-modal.html',
                    controller: 'NegotiationController as vm',
                    size: '-fs',
                    resolve: {
                        negotiationRequest: function () {
                            return {
                                proposedSlots: negotiationResponse.result.ProposedSlots,
                                reservationRequest: $scope.reservationRequest,
                                tripRequestId: negotiationResponse.result.tripRequestId,
                                serviceDate: $scope.serviceDate
                            };
                        }
                    }
                });

                negotiationModal.result.then(function (response) {
                    if (!response.canNegotiate) {
                        deferred.resolve({
                            NegotiationInfo: {
                                IsNegotiated: false
                            }
                        });
                    }
                    else if (response.selectedTime && response.canNegotiate) {
                        deferred.resolve({
                            NegotiationInfo: {
                                IsNegotiated: true,
                                SelectedTime: response.selectedTime,
                                tripRequestId: response.tripRequestId,
                                NegotiationLogId: response.negotiationLogId
                            }
                        });
                    }
                });

                return deferred.promise;
            }




            function disableFaringButton() {
                if (!$scope.isAllowed || $scope.isSaving)
                    return true;
                if ($scope.reservationRequest.FromLocation == null || angular.equals($scope.reservationRequest.FromLocation, {})
                    || $scope.reservationRequest.ToLocation == null || angular.equals($scope.reservationRequest.ToLocation, {}))
                    return true;
                return false;
            }

            function displayFaring()
            {

                var modalOverride = $uibModal.open({
                    animation: true,

                    templateUrl: 'app/modules/on-demand/faring/faring-modal.html',
                    controller: 'FaringModalController as vm',
                    size: '-fs',
                    windowClass: 'phone-modal--fullscreen',
                    backdrop: 'static',
                    scope: $scope,
                    resolve: {
                        reservationRequest: function () {
                            return $scope.reservationRequest;
                        },
                        serviceDate: function () {
                            return $scope.serviceDate;
                        }
                    }
                });

                modalOverride.result.then(function (result) {
                    if (result)
                        $scope.reservationRequest = result;
                });

                // return deferred.promise;
            }
            function showReservationErrorModal(msg,header) {
                var deferred = $q.defer();

                var modalOverride = $uibModal.open({
                    animation: true,
                    templateUrl: 'app/modules/on-demand/reservations/reservation-modal-message.html',
                    controller: 'ReservationErrorModalController as vm',
                    size: '-fs',
                    backdrop: 'static',
                    resolve: {
                        message: function () { return { message: msg, header:header };}
                    }
                });

                modalOverride.result.then(function (result) {
                    deferred.resolve(result);
                });

                return deferred.promise;

            };

            function showFixedRoutes(_upcomingSchedules, _fromStopName) {
                var deferred = $q.defer();

                var modalFR = $uibModal.open({
                    animation: true,
                    templateUrl: 'app/modules/on-demand/reservations/fixed-routes.html',
                    controller: 'FixedRoutesController as vm',
                    size: '-fs',
                    backdrop: 'static',
                    resolve: {
                        upcomingSchedules: function () { return _upcomingSchedules },
                        fromStopName: function () { return _fromStopName }
                    }
                });

                modalFR.result.then(function (result) {
                    //deferred.resolve(result);
                });

                return deferred.promise;
            }

            function validateRequest(reservationRequest) {
                if (!$scope.passenger || !$scope.passenger.Id) {
                    UtilityFactory.toastInfo("Please select a Passenger");
                    return false;
                }
                if ($scope.passenger.IsDeactivated) {
                    UtilityFactory.toastInfo("Please select an Active Passenger");
                    return false;
                }
                if ($scope.mode == 'reservation') {
                    if (!reservationRequest.IsASAP && $scope.options.isAdvancedReservation) {

                        if (!reservationRequest.ReservationTime || reservationRequest.ReservationTime == undefined) {
                            UtilityFactory.toastInfo("Please enter a valid Reservation Time");
                            return false;
                        } else {
                            var timeZone = DivisionService.getTimeZone();
                            var req_date = reservationRequest.ReservationDate.getDate();
                            var req_month = reservationRequest.ReservationDate.getMonth() + 1;
                            var req_year = reservationRequest.ReservationDate.getFullYear();
                            var req_input = req_year + "/" + req_month + "/" + req_date + " " + reservationRequest.ReservationTime;
                            var requestDateTime = moment.tz(req_input, "YYYY/M/D HHmm", timeZone);


                            //var requestedDateTime = DateFactory.getDateFromCustomTime(reservationRequest.ReservationTime, moment(reservationRequest.ReservationDate));


                            var currentDateTime = moment.tz(timeZone);
                            // currentDateTime = currentDateTime.clone().tz("America/Seattle");//DivisionService.getTimeZone());

                            if (requestDateTime.isBefore(currentDateTime)) {
                                UtilityFactory.toastInfo("Please enter a Reservation Time which is greater than the current time");
                                return false;
                            }
                        }
                    } else {

                    }
                }
                if (!reservationRequest.FromLocation) {
                    UtilityFactory.toastInfo("Please enter a valid From Location");
                    return false;
                }
                if (!reservationRequest.ToLocation) {
                    UtilityFactory.toastInfo("Please enter a valid To Location");
                    return false;
                }
                if (reservationRequest.FromLocation.GooglePlaceId && reservationRequest.ToLocation.GooglePlaceId) {
                    if (reservationRequest.FromLocation.GooglePlaceId == reservationRequest.ToLocation.GooglePlaceId) {
                        UtilityFactory.toastInfo("From and To locations should not be same");
                        return false;
                    }
                } else {
                    if (reservationRequest.FromLocation.LocationId && reservationRequest.ToLocation.LocationId) {
                        if (reservationRequest.FromLocation.LocationId == reservationRequest.ToLocation.LocationId) {
                            UtilityFactory.toastInfo("From and To locations should not be same");
                            return false;
                        }
                    }
                }
                //Validations for reconciliation
                if ($scope.mode == "reconciliation") {
                    if (reservationRequest.ReservationDate == null || reservationRequest.ReservationDate == undefined) {
                        UtilityFactory.toastInfo("Please enter a valid Reservation Date");
                        return false;
                    }
                    if (!reservationRequest.ArrivePickUpTime || reservationRequest.ArrivePickUpTime == undefined) {
                        UtilityFactory.toastInfo("Please enter a valid Arrive PickUpTime");
                        return false;
                    }
                    if (!reservationRequest.PerformDropOffTime || reservationRequest.PerformDropOffTime == undefined) {
                        UtilityFactory.toastInfo("Please enter a valid Perform DropOffTime");
                        return false;
                    }
                    if (reservationRequest.Run == null || !reservationRequest.Run.RunId) {
                        UtilityFactory.toastInfo("Please select a Run");
                        return false;
                    }
                }
                return true;
            }
            function zoneForLocation(location, type)
            {

                FaringService
                    .GetZoneIDForLocation(location.Latitude, location.Longitude, $scope.options.DivisionId)
                    .then(function (response) {
                        if (type === 'from')
                            $scope.reservationRequest.fromZone = response.data.result == null ? 0: response.data.result;
                        else
                            $scope.reservationRequest.toZone = response.data.result == null ? 0 : response.data.result;
                    }, function error(err) {

                    });
            }

            $scope.selectedLocationFrom = function (location) {
                $scope.reservationRequest.FromLocation = location;
                $scope.isAllowed = true;
                if ($scope.options.allowReservationOnlyWhenGpsIsOn)
                    isSelectedLocationInAllowedBookingRange(location);

                zoneForLocation(location, 'from');
            }
            $scope.selectedLocationTo = function (location) {
                $scope.reservationRequest.ToLocation = location;
                zoneForLocation(location, 'to');
            }
            $scope.$on('closestLocation', function (event, location) {
                $scope.reservationRequest.FromLocation = location.loc;
                zoneForLocation(location.loc, 'from');
            });

            $scope.$on('homeLocation', function (event, location) {
                $scope.selectedLocationTo(location);
            });

            function isSelectedLocationInAllowedBookingRange(selectedLocation) {
                GeoLocationService
                        .getCurrentPosition()
                        .then(function (position) {
                            if (position) {
                                var hdistance = getHaversineDistanceInFeet(
                                                {
                                                    latitude: position.coords.latitude, longitude: position.coords.longitude
                                                },
                                                    {
                                                        latitude: selectedLocation.Latitude, longitude: selectedLocation.Longitude
                                                    });
                                var maxAllowedDistance = $scope.options.maxRadiusToAllowBooking;

                                if (hdistance > maxAllowedDistance) {
                                    UtilityFactory.toastError('Cannot book trip!', 'The pickup location must be within ' +
                                                                maxAllowedDistance + ' feet of your current location.', 15000);
                                    $scope.isAllowed = false;
                                }
                            }
                        });
            };

            function getHaversineDistanceInFeet(currentLocation, selectedLocation) {
                var lat1 = currentLocation.latitude;
                var lon1 = currentLocation.longitude;
                var lat2 = selectedLocation.latitude;
                var lon2 = selectedLocation.longitude

                var R = 6371;
                var x1 = lat2 - lat1;
                var dLat = x1 * Math.PI / 180;
                var x2 = lon2 - lon1;
                var dLon = x2 * Math.PI / 180;
                var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                                Math.sin(dLon / 2) * Math.sin(dLon / 2);
                var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
                var p = 2 * Math.asin(Math.sqrt(a));
                var d = R * c * 0.62137 * 5280; //convert to feet
                return Number(d).toFixed(2);
            }

        }
    }
})();

+(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .directive('reservationMapDirective', reservationMapDirective);

    reservationMapDirective.$inject = ['$window', '$http', '$filter', 'ConfigFactory', 'ScheduleService', 'DateFactory', 'uiGmapIsReady', 'UtilityFactory', '$interval'];

    function reservationMapDirective($window, $http, $filter, ConfigFactory, ScheduleService, DateFactory, uiGmapIsReady, UtilityFactory, $interval) {
        
        var directive = {
            link: {
                pre: preLink,
                post: postLink
            },
            controller: controller,
            restrict: 'E',
            scope: { passenger: '@', tripRequest: '@', currentTrip: '@', dispatchSelectedRunId: '@', dispatchSelectedTrip: '@'},
            templateUrl: 'app/modules/on-demand/reservations/reservationMap.html'
        };
        return directive;

        function controller($scope) {
            $scope.minlengthlimit = 3;
            $scope.map = {
                center: {
                    latitude: 40.680638,
                    longitude: -99.228516
                },
                zoom: 10,
                lineStyle: {
                    color: '#333',
                    weight: 5,
                    opacity: 0.7
                }                
            };

            $scope.showTraffic = false;
            if ($scope.dispatchSelectedRunId != null) {
                $scope.showTraffic = true;
            }
            $scope.mapControl = {};
            $scope.mapOptions = {
                mapTypeControl: false,
                zoomControl: false,
                streetViewControl: false
            };
            var currentDivision = "";
            $scope.stopMarker = [];
            $scope.addressRest = null;
            $scope.setMap = setMap;
            $scope.getCurrentActiveTrip = getCurrentActiveTrip;
            $scope.setCurrentTripMap = setCurrentTripMap;
            $scope.setSelectedTripMap = setSelectedTripMap;
            //$scope.setNewDispatchSelectedRunId = setNewDispatchSelectedRunId;
            $scope.clearMarkers = clearMarkers;
            var autoRefreshMarker = undefined;
            $scope.tripid = null;
            $scope.passengerId = null;
            $scope.activeTripRunId = null;
            var isTripActive;
            var isCancelable;
            $scope.passenger = {};
            $scope.tripRequest = {};
            $scope.currentTrip = {};
            $scope.dispatchSelectedRunId = null;
            $scope.dispatchSelectedTrip = [];
            $scope.activeTrip = false;
            $scope.cancelTrip = false;
            $scope.disableCancel = false;
            $scope.vehiclesMarkerDetails = [];
            $scope.selectedTripmarkerDetails = [];
            $scope.centerLatLong;
            //$scope.passengerDetails = $scope.passenger;
            // instantiate google map objects for directions
            var directionsDisplay = new google.maps.DirectionsRenderer({ suppressMarkers: true, draggable: false });
            var directionsService = new google.maps.DirectionsService();

            ConfigFactory.getCurrentDivision().then(function (divisionData) {
                currentDivision = divisionData;
            }, function () {
                //Error handling TBD
            });
            
            function setSelectedTripMap() {
                for (var i = 0; i < $scope.dispatchSelectedTrip.length; i++) {
                    if($scope.dispatchSelectedTrip[i].Type == 'pickup')
                    {
                        icon = '../../images/pickup.png';
                    }
                    else {
                        icon = '../../images/dropoff.png';
                    }
                    $scope.selectedTripmarkerDetails.push({
                        'tripId': $scope.dispatchSelectedTrip[i].TripID, 'scheduleTime': $scope.dispatchSelectedTrip[i].SchedTimeView,
                        'latitude': $scope.dispatchSelectedTrip[i].Latitude, 'longitude': $scope.dispatchSelectedTrip[i].Longitude,
                        'locationName': $scope.dispatchSelectedTrip[i].LoactionName, 'locationAddress': $scope.dispatchSelectedTrip[i].LoactionAddress,
                        'icon': icon
                    });
                }
                var icon = null;
                
                setBounds();
            };

            //marker click function
            $scope.tripMarkerEvent = {
                click: function (gMarker, eventName, model) {
                    if (model.$id) {
                        $scope.tripCoords = model.coords;
                        $scope.showTrip = true;
                    }
                }
            };

            function setCurrentTripMap() {
                $scope.tripRequest.FromLat = $scope.currentTrip.StartAddressViewModel.Latitude;
                $scope.tripRequest.FromLong = $scope.currentTrip.StartAddressViewModel.Longitude;
                $scope.tripRequest.ToLat = $scope.currentTrip.EndAddressViewModel.Latitude;
                $scope.tripRequest.ToLong = $scope.currentTrip.EndAddressViewModel.Longitude;
                $scope.tripRequest.tripId = $scope.currentTrip.TripID;
                $scope.tripId = $scope.currentTrip.TripID;
                scheduleTrip($scope.tripRequest);

            };

            function getCurrentActiveTrip() {
                $scope.passengerId = $scope.passenger.Id
                if ($scope.passenger.Id == null)
                {
                    UtilityFactory.toastError('Error', errormsg.data);
                    return;
                }
                ScheduleService.getlastripdetails($scope.passenger.Id)
                   .then(function (response) {
                       if (response.data.status == 1) {
                           var x = response.data;
                           $scope.activeTripRunId = response.data.result.RunID;
                           $scope.tripRequest.FromLat = (response.data.result.StartAddressViewModel.Latitude);
                           $scope.tripRequest.FromLong = (response.data.result.StartAddressViewModel.Longitude);
                           $scope.tripRequest.ToLat = (response.data.result.EndAddressViewModel.Latitude);
                           $scope.tripRequest.ToLong = (response.data.result.EndAddressViewModel.Longitude);
                           $scope.tripRequest.tripId = response.data.result.TripID;
                           $scope.tripId = response.data.result.TripID;
                           scheduleTrip($scope.tripRequest);
                       }
                       else {
                           //UtilityFactory.toastError('Error', response.data.message);
                           $scope.tripId = null;
                           $scope.tripRequest.From = null;
                           $scope.tripRequest.To = null;
                           $scope.scheduleMarkers = [];
                           directionsDisplay.setMap(null);
                       }
                   }, function (errormsg) {

                       UtilityFactory.toastError('Error', errormsg.data);
                   });
            };

            function setMap() {
                $scope.map = {
                    center: {
                        latitude: $scope.centerLatitude,
                        longitude: $scope.centerLongitude
                    },
                    zoom: 15,
                }
                if ($scope.isFleetMap) {
                    autoRefreshMarker = $interval(function () {
                        setFleetMarkers();
                    }, 5000);
                }
                else {
                    scheduleTrip($scope.tripRequest);
                }
            }           

            function scheduleTrip(tripRequest) {
                $scope.scheduleMarkers = [];

                directionsDisplay.setMap($scope.mapControl.getGMap());

                $scope.scheduleMarkers.push({
                    'latitude': tripRequest.FromLat, 'longitude': tripRequest.FromLong,
                    'icon': '../../images/pickup.png', 'tripId': $scope.tripRequest.tripId
                });
                $scope.scheduleMarkers.push({
                    'latitude': tripRequest.ToLat, 'longitude': tripRequest.ToLong,
                    'icon': '../../images/dropoff.png', 'tripId': $scope.tripRequest.tripId
                });

                var request = {
                    origin: new google.maps.LatLng(tripRequest.FromLat, tripRequest.FromLong),
                    destination: new google.maps.LatLng(tripRequest.ToLat, tripRequest.ToLong),
                    travelMode: google.maps.DirectionsTravelMode.DRIVING
                };
                directionsService.route(request, function (response, status) {
                    if (status === google.maps.DirectionsStatus.OK) {
                        directionsDisplay.setDirections(response);
                        //directionsDisplay.setPanel(document.getElementById('directionsList'));
                        //$scope.directions.showList = true;
                        setBounds();
                    } else {
                        window.alert('Directions request failed due to ' + status);
                    }
                });
            };

            uiGmapIsReady.promise().then(function (maps) {
                google.maps.event.trigger($scope.mapControl.getGMap(), "resize");
                
            });

            function setBounds() {
                var bounds = new google.maps.LatLngBounds();

                angular.forEach($scope.selectedTripmarkerDetails, function (stop) {
                    bounds.extend(new google.maps.LatLng(stop.latitude, stop.longitude));
                });

                $scope.mapControl.getGMap().fitBounds(bounds);
            };

            function clearMarkers() {               
                $scope.vehiclesMarkerDetails = [];
            };

            function setFleetMarkers() {
                clearMarkers();
                var lat = null;
                var long = null;

                if ($scope.tripId != null) {
                    ScheduleService.getDriverGPS($scope.tripId)
                        .then(function (response) {
                            if (response.data != null) {
                                $scope.activeTripRunId = response.data.RunId;
                                isTripActive = response.data.IsTripActive
                                if (!isTripActive) {
                                    var passengerId = $scope.passengerId
                                    ScheduleService.getlastripdetails($scope.passengerId)
                                        .then(function (response) {
                                              if (response.data.status == 1) {
                                                  $scope.tripRequest.From = response.data.result.StartAddressViewModel.Address1 + ', ' + response.data.result.StartAddressViewModel.City + ', ' + response.data.result.StartAddressViewModel.ZipCode;
                                                  $scope.tripRequest.To = response.data.result.EndAddressViewModel.Address1 + ', ' + response.data.result.EndAddressViewModel.City + ', ' + response.data.result.EndAddressViewModel.ZipCode;
                                                  $scope.tripRequest.FromLat = (response.data.result.StartAddressViewModel.Latitude);
                                                  $scope.tripRequest.FromLong = (response.data.result.StartAddressViewModel.Longitude);
                                                  $scope.tripRequest.ToLat = (response.data.result.EndAddressViewModel.Latitude);
                                                  $scope.tripRequest.ToLong = (response.data.result.EndAddressViewModel.Longitude);

                                                  $scope.activeTrip = true;
                                                  $scope.cancelTrip = false;
                                                  $scope.tripId = response.data.result.TripID;
                                                  $scope.tripRequest.Shuttle = response.data.result.VehicleName;
                                                  $scope.tripRequest.RunName = response.data.result.RunName;
                                                  $scope.tripRequest.StartTime = response.data.result.EstimatedPickupTime;
                                                  $scope.tripRequest.EndTime = response.data.result.EstimatedDestinationTime;
                                                  $scope.disableCancel = false;
                                                  scheduleTrip($scope.tripRequest);
                                              }
                                              else {
                                                  $scope.tripId = null;
                                                  $scope.tripRequest.From = null;
                                                  $scope.tripRequest.To = null;
                                                  $scope.activeTrip = false;
                                                  $scope.cancelTrip = true;
                                                  $scope.scheduleMarkers = [];
                                                  directionsDisplay.setMap(null);
                                                  //stopAutoRefreshMarker();
                                                  //window.location.reload();
                                                  return;
                                              }
                                          }, function (errormsg) {

                                              UtilityFactory.toastError('Error', errormsg.data);
                                          });
                                }
                                else {
                                    isCancelable = response.data.IsCancelable
                                    if (!isCancelable) {
                                        $scope.disableCancel = true;
                                    }
                                }
                            }
                            else {
                            }
                        }, function (errormsg) {
                        });
                }

                if ($scope.dispatchSelectedRunId != null)
                {
                    ScheduleService.getActiveRuns(currentDivision.DivisionID, null)
                    .then(function (response) {
                        if (response.data != null) {
                            for (var i = 0; i < response.data.result.length; i++) {
                                $scope.getActiveRuns = response.data.result[i]

                                if ($scope.getActiveRuns.RunId == $scope.dispatchSelectedRunId) {
                                    if ($scope.getActiveRuns.LatestVehicleLatitude != null & $scope.getActiveRuns.LatestVehicleLongitude != null)
                                    {
                                        var icon = '../../images/VehicleCurrentTrip.png'
                                        $scope.vehiclesMarkerDetails.push({
                                            'vehicleName': $scope.getActiveRuns.VehicleName, 'driverName': $scope.getActiveRuns.DriverName,
                                            'latitude': $scope.getActiveRuns.LatestVehicleLatitude, 'longitude': $scope.getActiveRuns.LatestVehicleLongitude,
                                            'runName': $scope.getActiveRuns.RunName, 'runId': $scope.getActiveRuns.RunId, 'icon': icon
                                        });
                                    }
                                }
                            }
                        }
                        else {
                            UtilityFactory.toastError('Error', $scope.returnMsg);
                        }
                    }, function (errormsg) {
                        UtilityFactory.toastError('Error', $scope.returnMsg);
                    });
                }
                else {
                    ScheduleService.getActiveRuns(currentDivision.DivisionID, null)
                    .then(function (response) {
                        if (response.data != null) {
                            for (var i = 0; i < response.data.result.length; i++) {
                                $scope.getActiveRuns = response.data.result[i];

                                if ($scope.getActiveRuns.LatestVehicleLatitude != null & $scope.getActiveRuns.LatestVehicleLongitude != null)
                                {
                                    if ($scope.activeTripRunId != null && $scope.getActiveRuns.RunId == $scope.activeTripRunId && isTripActive) {
                                        var icon = '../../images/VehicleCurrentTrip.png'
                                        $scope.vehiclesMarkerDetails.push({
                                            'vehicleName': $scope.getActiveRuns.VehicleName, 'driverName': $scope.getActiveRuns.DriverName,
                                            'latitude': $scope.getActiveRuns.LatestVehicleLatitude, 'longitude': $scope.getActiveRuns.LatestVehicleLongitude,
                                            'runName': $scope.getActiveRuns.RunName, 'runId': $scope.getActiveRuns.RunId, 'icon': icon
                                        });
                                    }
                                    else if ($scope.getActiveRuns.DriverId != null && $scope.getActiveRuns.VehicleId != null) {

                                        if ($scope.getActiveRuns.NumOfActiveTrips > 0) {
                                            var icon = '../../images/VehicleActiveTrips.png'
                                            $scope.vehiclesMarkerDetails.push({
                                                'vehicleName': $scope.getActiveRuns.VehicleName, 'driverName': $scope.getActiveRuns.DriverName,
                                                'latitude': $scope.getActiveRuns.LatestVehicleLatitude, 'longitude': $scope.getActiveRuns.LatestVehicleLongitude,
                                                'runName': $scope.getActiveRuns.RunName, 'runId': $scope.getActiveRuns.RunId, 'icon': icon
                                            });
                                        }
                                        else {
                                            var icon = '../../images/VehicleNoTrips.png'
                                            $scope.vehiclesMarkerDetails.push({
                                                'vehicleName': $scope.getActiveRuns.VehicleName, 'driverName': $scope.getActiveRuns.DriverName,
                                                'latitude': $scope.getActiveRuns.LatestVehicleLatitude, 'longitude': $scope.getActiveRuns.LatestVehicleLongitude,
                                                'runName': $scope.getActiveRuns.RunName, 'runId': $scope.getActiveRuns.RunId, 'icon': icon
                                            });
                                        }
                                    }
                                    else {
                                        //Do nothing
                                    }
                                }
                                
                            }
                        }
                        else {
                            UtilityFactory.toastError('Error', $scope.returnMsg);
                        }
                    }, function (errormsg) {
                        UtilityFactory.toastError('Error', $scope.returnMsg);
                    });
                }
                
            };

            //marker click function
            $scope.markerEvent = {
                click: function (gMarker, eventName, model) {
                    if (model.$id) {                        
                        $scope.coords = model.coords;
                        $scope.show = true;
                    }
                }
            };

            function stopAutoRefreshMarker() {
                if (angular.isDefined(autoRefreshMarker)) {
                    $interval.cancel(autoRefreshMarker);
                    autoRefreshMarker = undefined;
                }
            };

            $scope.$on('$destroy', function (event) {
                stopAutoRefreshMarker();
            });
            
        }

        function preLink(scope, element, attrs) {
            ScheduleService.getServiceAreaLocation()
                .then(function (response) {
                    if (response.data !== null) {
                        scope.centerLatitude = response.data.Latitude;
                        scope.centerLongitude = response.data.Longitude;
                        scope.addressRest = response.data.Address;
                        //LocationFactory.setadd($scope.addressRest);
                        //scope.mapCenter.latitude = latitude;
                        //scope.mapCenter.longitude = longitude;
                        
                        if (scope.tripRequest.length > 0){
                            if (typeof scope.tripRequest == "string")
                            {
                                scope.tripRequest = JSON.parse(scope.tripRequest);
                            }
                            scope.isFleetMap = false;
                            
                        }
                        else {
                            scope.isFleetMap = true;
                        }
                        scope.setMap();
                    }
                    else {
                        //UtilityFactory.toastError('Error', $scope.returnMsg);
                    }
                }, function (errormsg) {
                    UtilityFactory.toastError('Error', $scope.returnMsg);
                });
            
        };

        function postLink(scope, element, attrs) {
            scope.$watch("currentTrip", function (newValue, oldValue) {
                if (newValue !== oldValue && newValue != '') {
                    if (typeof newValue == "string"){
                        scope.currentTrip = JSON.parse(newValue);
                    }                     
                    else if (typeof newValue == "object") {
                        scope.currentTrip = newValue;
                        scope.setCurrentTripMap();
                    }
                }
            });

            scope.$watch("passenger", function (newValue, oldValue) {
                if (newValue !== oldValue && newValue != '') {
                    if (typeof newValue == "string")
                    {
                        scope.passenger = JSON.parse(newValue);
                    }                        
                    else if (typeof newValue == "object")
                    {
                        scope.passenger = newValue;
                        scope.getCurrentActiveTrip()
                    }
                }

            });

            scope.$watch("dispatchSelectedRunId", function (newValue, oldValue) {
                if (newValue !== oldValue && newValue != '') {
                    if (typeof newValue == "string") {
                        scope.dispatchSelectedRunId = JSON.parse(newValue);
                        scope.clearMarkers();
                        scope.selectedTripmarkerDetails = [];
                    }
                    else if (typeof newValue == "object") {
                        scope.dispatchSelectedRunId = newValue;
                        //scope.setNewDispatchSelectedRunId()
                    }
                }

            });

            scope.$watch("dispatchSelectedTrip", function (newValue, oldValue) {
                if (newValue !== oldValue && newValue != '') {
                    if (typeof newValue == "string") {
                        scope.dispatchSelectedTrip = JSON.parse(newValue);
                        scope.selectedTripmarkerDetails = [];
                    }
                    else if (typeof newValue == "object") {
                        scope.selectedTripmarkerDetails = [];
                        scope.dispatchSelectedTrip = newValue;
                        scope.setSelectedTripMap();
                    }
                }

            });
        }

        
    }

})();


(function () {
    'use strict';

    angular.module('oneMVApp')
        .controller('ReservationsController',
		['$location', '$scope', '$state', '$timeout', '$window', '$uibModal',
         'ConfigFactory', 'ScheduleService', 'uiGmapIsReady', 'DivisionService', 'MessageBox',
         'UtilityFactory', 'authService', 'GeoLocationService', 'LocationFactory', 'RedirectionService', 'ProfileService', 'googleMapsConfig',
         'PageService',
          reservationsController]
        );

    function reservationsController
		($location, $scope, $state, $timeout, $window, $uibModal,
        ConfigFactory, ScheduleService, uiGmapIsReady, DivisionService, MessageBox,
		UtilityFactory, authService, GeoLocationService, LocationFactory, RedirectionService, ProfileService, googleMapsConfig
        ,PageService) {

        var vm = this;
        PageService.setTitle('New Reservation');
        PageService.setHeadline('On Demand');
        vm.reservationRequest = {};
        vm.reservationRequest.ReservationDate = new Date();
        vm.minDate = new Date();
        vm.maxDateAllowed = new Date(2017, 2, 28);

        vm.currentPassenger = { "Id": authService.authentication.passengerId };
        var operatorId = null;
        vm.userReservationOptions = {};
        vm.hasActiveTrip = false;
        vm.hasFutureTrips = false;
        vm.position = null;
        vm.reservationType = 'current';
        var divisionId = '';
        vm.homePassengerId = null;

        var closestPin, otherPin, locationPin, myLocationPin, hubIcon;
        if ($window.navigator.userAgent.indexOf("Trident") > 0 || $window.navigator.userAgent.indexOf("MSIE") > 0) {
            myLocationPin = 'images/pin-my-location.png';
        }
        else {
            myLocationPin = 'images/pin-my-location.svg';
        }

        var getActiveTrip = function () {
            ScheduleService.getlastripdetails(vm.currentPassenger.Id)
                .then(function (response) {
                    if (response.data.status === 1 && response.data.result) {
                        vm.hasActiveTrip = true;
                        
                    }
                    else {
                        ScheduleService.tripsForServiceDate(vm.currentPassenger.Id)
                        .then(function (response) {
                            if(response.data.status === 1 && response.data.result)
                            {
                                if (response.data.result.length > 0)
                                    vm.hasFutureTrips = true;
                            }

                        }, function (err) {
                            vm.hasFutureTrips = false;
                        });
                    }
                    //check current time and see if the window is in the future 
                }, function (err) {
                    vm.hasActiveTrip = false;
                    vm.hasFutureTrips = false;
                });
        }

        function populateDivisionParameters() {
            getActiveTrip();

            vm.userReservationOptions = {
                DivisionId: divisionId,
                OperatorId: operatorId
            };
            ConfigFactory.getDivisionParameters(divisionId)
                     .then(function (params) {
                         if (params) {
                             var options = vm.userReservationOptions;

                             options.passengersLimit = params.PassengersLimit ? eval(params.PassengersLimit) : 5;
                             options.allowWillCall = params.AllowWillCall ? eval(params.AllowWillCall.toLowerCase()) : false;
                             options.allowPassengerWillCall = params.AllowPassengerWillCall ? eval(params.AllowPassengerWillCall.toLowerCase()) : false;
                             options.allowEquipment = params.AllowEquipment ? eval(params.AllowEquipment.toLowerCase()) : false;
                             options.isAdvancedReservation = params.AllowAdvancedReservation ? eval(params.AllowAdvancedReservation.toLowerCase()) : false;
                             options.allowMultipleSeatBooking = params.AllowMultipleSeatBooking ? eval(params.AllowMultipleSeatBooking.toLowerCase()) : false;
                             options.isWheelChair = params.HasWheelChair ? eval(params.HasWheelChair.toLowerCase()) : false;
                             options.isCompanion = params.HasCompanions ? eval(params.HasCompanions.toLowerCase()) : false;
							 options.companionsLimit = params.HasCompanions == false ? 0: params.CompanionsLimit ? eval(params.CompanionsLimit): 1;
                             options.isPCA = params.HasPCA ? eval(params.HasPCA.toLowerCase()) : false;
                             options.isServiceAnimal = params.HasServiceAnimal ? eval(params.HasServiceAnimal.toLowerCase()) : false;
                             options.allowCustomLocation = params.AllowCustomLocation ? eval(params.AllowCustomLocation.toLowerCase()) : false;
                             options.promiseWindow = params.PromiseWindow ? eval(params.PromiseWindow) : 10;
                             options.reservationType = vm.reservationType;
                             options.allowOnlySameDayAdvRes = params.AllowOnlySameDayAdvRes ? eval(params.AllowOnlySameDayAdvRes.toLowerCase()) : false;
                             options.dropoffHomeLocationOnly = params.DropoffHomeLocationOnly ? eval(params.DropoffHomeLocationOnly.toLowerCase()) : false;
                             options.homePassengerId = options.dropoffHomeLocationOnly ? vm.currentPassenger.Id : null;
                             options.checkFRBeforeDRT = params.CheckFRBeforeDRT ? eval(params.CheckFRBeforeDRT.toLowerCase()) : false;
                             options.noOfFRArrivals = params.NoOfFRArrivals ? eval(params.NoOfFRArrivals) : 3;
                             options.allowASAPReservations = params.AllowASAPReservations ? eval(params.AllowASAPReservations) : false;
                             options.allowAppointments = params.AllowAppointments ? eval(params.AllowAppointments) : false;
                             options.allowLocationNotes = params.AllowLocationNotes ? eval(params.AllowLocationNotes) : false;
                             options.allowReservationOnlyWhenGpsIsOn = params.AllowBookingIffGpsIsOn ? eval(params.AllowBookingIffGpsIsOn) : false;
                             options.maxRadiusToAllowBooking = params.MaxRadiusToAllowBooking ? eval(params.MaxRadiusToAllowBooking) : false;
                             options.allowFaring = params.AllowFaring ? eval(params.AllowFaring) : false;

                             options.sameDayResLowerBound = params.SameDayResLowerBound ? params.SameDayResLowerBound : "00:00";
                             options.sameDayResUpperBound = params.SameDayResUpperBound ? params.SameDayResUpperBound : "24:00";
                             options.futureResLowerBound = params.FutureResLowerBound ? params.FutureResLowerBound : "00:00";
                             options.futureResUpperBound = params.FutureResUpperBound ? params.FutureResUpperBound : "24:00";
                             options.allowChildren = params.AllowChildren ? eval(params.AllowChildren) : false;
                             options.childrenLimit = params.ChildrenLimit ? eval(params.ChildrenLimit) : 3;

                             vm.reservationFormOptions = options;

                         	 // use TO home location if present
                             if (options.dropoffHomeLocationOnly) {
                             	$timeout(getDestinationHomeLocation, 0);
                             }

                             //extra options only needed by user reservations directive.
                             options.isPassenger = true;
                             options.isReadOnly = true;
                             options.autoRefresh = true;
                             options.batchDays = params.BatchDays ? eval(params.BatchDays) : 7;
                             options.minFromDays = params.MinFromDays ? eval(params.MinFromDays) : 30;
                             options.passengerBookingMinDays = params.PassengerBookingMinDays ? eval(params.PassengerBookingMinDays) : 0;
                             options.passengerBookingMaxDays = params.PassengerBookingMaxDays ? eval(params.PassengerBookingMaxDays) : 14;
                             vm.reservationFormOptions = options;
                         }
                     }, function (response) {
                         UtilityFactory.toastError('Error', response.data.ReturnMessage);
                     });

            getMap();
		}

        vm.onReservationSuccess = function (trip, isASAP) {
            vm.addedTrip = trip; //here we can display a trip on our existing map
            if (isASAP)
                $location.path('on-demand/active-trip');
            else {
                var scheduleTripDisplay = $uibModal.open({
                    animation: true,
                    templateUrl: 'app/modules/on-demand/reservations/displayTrip-modal.html',
                    controller: 'DisplayScheduledTripController as vm',
                    size: '',
                    resolve: {
                        trip: function () {
                            return trip;
                        },
                        options :function(){
                            return vm.reservationFormOptions;
                        }                        
                    }
                });
                scheduleTripDisplay.result.then(function () {
                    //loadMasterRuns();
                });
                //open modal

            }
        };

        vm.showMap =false;
       vm.zoom = 15;
        vm.center = {
        latitude: 39.809860,
            longitude: -98.555183
            };
       vm.myStyles = googleMapsConfig.mapStyles;
        vm.mapOptions = {
            mapTypeControl: false,
            zoomControl: false,
            streetViewControl: false,
            styles: vm.myStyles

        };
        vm.myLocationIcon = {
            url: myLocationPin,
            size: new google.maps.Size(42, 42),
            origin: new google.maps.Point(0, 0),
            anchor: new google.maps.Point(20, 20)
        };
        vm.mapControl = {};

        function getMap() {
            uiGmapIsReady.promise().then(function (maps) {
                ScheduleService.getServiceAreaLocation(divisionId).then(function (response) {
                    if (response.data.status == 1) {
                        vm.center.latitude = response.data.result.Latitude;
                        vm.center.longitude = response.data.result.Longitude;
                        if (response.data.result.ZoomLevel !== undefined && response.data.result.ZoomLevel !== null
                                && response.data.result.ZoomLevel != '')
                                    vm.zoom = response.data.result.ZoomLevel;
                    }
                    vm.showMap = true;

                });

                GeoLocationService.getCurrentPosition().then(function (position) {
                    vm.position = {
                        "coords": {
                            "Latitude": position.coords.latitude,
                            "Longitude": position.coords.longitude
                        },
                        "icon": vm.myLocationIcon
                    };

                    //here get closest location
                    LocationFactory.getLocations('', 'false', divisionId).then(function (result) {
                    	var filteredResults = angular.copy(result.data);
                    	var filteredResult = LocationFactory.findClosestLocation(vm.position.coords, filteredResults);
                    	//show selected location iff the current gps is within 300 ft of a building
                    	//1 mile ~= 5280 ft
                    	if (filteredResult && parseFloat(filteredResult.distance) * 5280 <= 300)
                    		$scope.$broadcast('closestLocation', filteredResult);

                    	// get destination Home location
                    }, function (err) {
                    });
                }, function (err) {
                    //position error
                });
            });
        }
		
        function getDestinationHomeLocation() {
            
        	ProfileService.GetHomeAddress(vm.currentPassenger.Id)
				.then(function (homeAddress) {
					$scope.$broadcast('homeLocationDisable', true);
					if (homeAddress) {
					    // set TO address to the home address
						vm.reservationRequest.ToLocation = homeAddress;
						var toAddressDisplay = (homeAddress.Name || '') + " " + (homeAddress.Address || '') + " " + (homeAddress.City || '') + " " + (homeAddress.Zip || '');
					    //
					    // On slow cell connections, this gets broadcast before reservationFormDirective.js gets loaded.
                        // So the home address is NEVER DISPLAYED!!!  You can test this by throttling connection at 2000 kbs.
                        // We need to $broadcast after waiting 4 seconds.
					    //
						$scope.$broadcast('homeLocation', homeAddress);
						$scope.$broadcast('homeLocationText', toAddressDisplay);
						$timeout(function () {
						    $scope.$broadcast('homeLocation', homeAddress);
						    $scope.$broadcast('homeLocationText', toAddressDisplay);
						    $scope.$broadcast('homeLocationDisable', true);
						}, 4000)
					} else {
						// ask passenger to create a home address
						var divisionParameters = DivisionService.getSystemParameters();
						if (! divisionParameters.DropoffHomeLocationEdit) {
							// get help phone number
							var helpPhone = DivisionService.getSupportPhoneNumber();
							var message = "Please call Help desk at " + helpPhone + " and ask them to create a Home Address for you.";
							MessageBox.info('Home Address is Required', message).then(function () {
								$window.history.back();
							});
						} else {
							// passenger has not set his home location, and may edit it, so show home address editor as a modal
							$uibModal.open({
								animation: true,
								backdrop: false,
								templateUrl: 'app/modules/shared/profile/home-address-modal.html',
								controller: function () { },
								size: ''
							}).closed.then(function () {
								// home address was changed - reload the page
								$state.reload();
							});
						}
					}
				},
				function (err) {
				    console.log('Error getting home location');
				    console.log(err);
				});
        }

        function activate(callback) {
            if (!authService.isLoggedIn()) {
                RedirectionService.save('/on-demand/reservations');
                $location.path('login');
            }
            else {
                divisionId = DivisionService.getDivisionId();
                if (divisionId != null && divisionId != undefined && divisionId != '') {
                    if (callback && typeof callback === "function")
                        callback();
                }
                else
                    $location.path('dashboard/');
            }
        }

        activate(populateDivisionParameters);

        // Start of code for Ionic
        vm.ionicInclude = 'app/modules/on-demand/reservations/reservations.html';
        vm.ionicCustomClassName = '';
        vm.disableScroll = true;
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = false;
        // End of code for Ionic

    };

})();
(function () {
    //debugger;

    'use strict';

    angular.module('oneMVApp').factory('ScheduleService', ScheduleService);
    ScheduleService.$inject = ['$http', '$q', 'ConfigFactory', 'authService', 'env', 'localStorageService', '$rootScope'];

    function ScheduleService($http, $q, ConfigFactory, authService, env, localStorageService, $rootScope) {
    var service = {
        getCurrentUser: getCurrentUser,
        getPassdatall: getPassdatall,
        getpassenger: getpassenger,
        schedulepost: schedulepost,
        cancelpost: cancelpost,
        getlastripdetails: getlastripdetails,
        updateEmailPhoneandAddress: updateEmailPhoneandAddress,
        getActiveRuns: getActiveRuns,
        getServiceAreaLocation: getServiceAreaLocation,
        getDriverGPS: getDriverGPS,
        getSearchPassanger: getSearchPassanger,
        getPastRuns: getPastRuns,
        savePastTrip: savePastTrip,
        getPassengerTrips: getPassengerTrips,
        getServiceDateByDivision: getServiceDateByDivision,
        getStates: getStates,
        searchPassenger: searchPassenger,
        tripsForServiceDate: tripsForServiceDate,
        getTripCancelStatusList: getTripCancelStatusList
    };
    return service;
    var value;


    function tripsForServiceDate(passengerId) {
        var deferred = $q.defer();

        var url = env.oneMVApiUrl  + 'passenger/' + passengerId + '/tripsForServiceDate';

        $http({
            method: 'GET',
            url: url + '?rnd=' + new Date().getTime(),
        }).then(function (response) {
            deferred.resolve(response);
        }, function (err) {
            deferred.reject(err);
        });

        return deferred.promise;
    };


    function searchPassenger(divisionInfo, passengerId) {
        var deferred = $q.defer();

        ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
            var url = oneMVURL + "passenger/search/" + passengerId;
            $http({
                method: 'GET',
                url: url + '?rnd=' + new Date().getTime(),
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err);
            });
        }, function (error) {
            deferred.reject(error);
        });
        return deferred.promise;
    };


    function getStates() {
        var deferred = $q.defer();
        $http({
            method: 'GET',
            url: '../Passenger/getStates?rnd=' + new Date().getTime(),
        }).then(function (response) {
            deferred.resolve(response);
        }, function (err) {
            deferred.reject(err);
        });
        return deferred.promise;
    };

    function getCurrentUser() {
        var deferred = $q.defer();
        //get the base url from config.
        var serviceUrl = '../Operation/GetCurrentUser';
        $http({
            method: 'GET',
            'url': serviceUrl
        }).then(function (response) {
            deferred.resolve(response);
        }, function (err) {
            deferred.reject(err)
        });
        return deferred.promise;
    };

    function getPassdatall() {
        var deferred = $q.defer();
        //get the base url from config.
        var serviceUrl = '../Passenger/getpassDataauto?rnd=' + new Date().getTime();
        $http({
            method: 'GET',
            'url': serviceUrl
        }).then(function (response) {
            deferred.resolve(response);
        }, function (err) {
            deferred.reject(err)
        });
        return deferred.promise;
    };

    function getpassenger(passengerId) {
        var deferred = $q.defer();
        //get the base url from config.
        var serviceUrl = '../Passenger/GetPassDetailByPassId?rnd=' + new Date().getTime();
        $http({
            method: 'GET',
            'url': serviceUrl,
            params: { PassengerId: passengerId },
            dataType: "json",
            contentType: "application/json; charset=utf-8"
        }).then(function (response) {
            deferred.resolve(response);
        }, function (err) {
            deferred.reject(err)
        });
        return deferred.promise;
    };
    function getPassengerTrips(divisionId, passengerId, fromDate, toDate) {
        var deferred = $q.defer();
        ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
            if (oneMVURL && oneMVURL != "") {
                //get the base url from config.
                var serviceUrl = oneMVURL + 'passenger/' + passengerId +'/trips/' +
                                            fromDate + '/' + toDate + '?rnd=' + new Date().getTime();
                $http({
                    method: 'GET',
                    'url': serviceUrl,
                    //data: JSON.stringify(passengerTripParam),
                    ContentType: "application/json; charset=utf-8"
                }).then(function (response) {
                    deferred.resolve(response);
                }, function (err) {
                    deferred.reject(err)
                });
            }
            else {
                $log.error('Error: - Could not fetch service api url')
                UtilityFactory.toastError("Could not fetch service api url");
            }
        });
        return deferred.promise;
    };

    function schedulepost(scheduleTripReqparam) {
        var deferred = $q.defer();
        ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
            if (oneMVURL && oneMVURL != "") {
                //get the base url from config.
                var serviceUrl = oneMVURL + 'passenger/' + scheduleTripReqparam.PassengerID + '/trip/schedule';
                $http({
                    method: 'POST',
                    'url': serviceUrl,
                    data: JSON.stringify(scheduleTripReqparam),
                    ContentType: "application/json; charset=utf-8"
                }).then(function (response) {
                    deferred.resolve(response);
                }, function (err) {
                    deferred.reject(err)
                });
            }
            else {
                $log.error('Error: - Could not fetch service api url')
                UtilityFactory.toastError("Could not fetch service api url");
            }
        });
        return deferred.promise;
    };

    //call api to cancel trip
    function cancelpost(cancelreq) {
        var deferred = $q.defer();
        ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
            if (oneMVURL && oneMVURL != "") {
                //get the base url from config.
                var serviceUrl = oneMVURL + 'passenger/' + cancelreq.PassengerID + '/trip/cancel';
                $http({
                    method: 'POST',
                    'url': serviceUrl,
                    data: JSON.stringify(cancelreq),
                    ContentType: "application/json; charset=utf-8"
                }).then(function (response) {
                    deferred.resolve(response);
                }, function (err) {
                    deferred.reject(err)
                });
            }
            else {
                $log.error('Error: - Could not fetch service api url')
                UtilityFactory.toastError("Could not fetch service api url");
            }
        });
        return deferred.promise;
    };

    //call api to get the last active trip details
    function getlastripdetails(passengerID) {
    		var deferred = $q.defer();
    		ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
    			if (oneMVURL && oneMVURL != "") {
    				//get the base url from config.
    				var serviceUrl = oneMVURL + 'passenger/' + parseInt(passengerID) + '/activeTrip?rnd=' + new Date().getTime();
    				$http({
    					method: 'GET',
    					'url': serviceUrl,
    					dataType: "json",
    					ContentType: "application/json; charset=utf-8"
    				}).then(function (response) {
    					$rootScope.$broadcast("hasActiveTripChanged", response.data.status == 1);
    					deferred.resolve(response);
    				}, function (err) {
    					deferred.reject(err)
    				});
    			}
    			else {
    				$log.error('Error: - Could not fetch service api url')
    				UtilityFactory.toastError("Could not fetch service api url");
    			}
    		});
    		return deferred.promise;
    };

    function updateEmailPhoneandAddress(newpassenger) {
        var deferred = $q.defer();
        //get the base url from config.
        var serviceUrl = '/Passenger/UpdateEmailPhoneandAddress';
        $http({
            method: 'POST',
            'url': serviceUrl,
            data: JSON.stringify(newpassenger),
            dataType: "json",
            contentType: "application/json; charset=utf-8",
        }).then(function (response) {
            deferred.resolve(response);
        }, function (err) {
            deferred.reject(err)
        });
        return deferred.promise;
    };

    function getServiceAreaLocation(divisionId) {
        var deferred = $q.defer();
        //get the base url from config.
        ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
            if (oneMVURL && oneMVURL != "") {
                var serviceUrl = oneMVURL + "division/" + divisionId + "/serviceArea?rnd=" + new Date().getTime();

                $http({
                    method: 'GET',
                    'url': serviceUrl,
                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                }).then(function (response) {
                    deferred.resolve(response);
                }, function (err) {
                    deferred.reject(err)
                });
            }
        });
        return deferred.promise;
    };

    function getDriverGPS(tripId) {
        var deferred = $q.defer();
        //get the base url from config.
        var serviceUrl = '../Passenger/GetDriverGPS?rnd=' + new Date().getTime();
        $http({
            method: 'GET',
            'url': serviceUrl,
            params: {
                TripId: tripId
            },
            dataType: "json",
            contentType: "application/json; charset=utf-8",
        }).then(function (response) {
            deferred.resolve(response);
        }, function (err) {
            deferred.reject(err)
        });
        return deferred.promise;
    };

    //Search passanger  by clientpassangerid
    function getSearchPassanger(ClientPassangerID) {
        var deferred = $q.defer();
        //get the base url from config.
        var serviceUrl = '../Passenger/GetSearchPassanger?ClientPassangerID=' + ClientPassangerID;
        $http({
            method: 'GET',
            'url': serviceUrl,
            dataType: "json",
            contentType: "application/json; charset=utf-8",
        }).then(function (response) {
            deferred.resolve(response);
        }, function (err) {
            deferred.reject(err)
        });
        return deferred.promise;
    };

    //call api to get the active runs for current service date
    function getActiveRuns(divisionId) {
        var deferred = $q.defer();
        ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
            if (oneMVURL && oneMVURL != "") {
                //get the base url from config.
                var serviceUrl = oneMVURL + 'Dispatch/GetRuns?rnd=' + new Date().getTime();
                $http({
                    method: 'POST',
                    'url': serviceUrl,
                    data: JSON.stringify({ "DivisionId": divisionId, "ServiceDate": null }),
                    dataType: "json",
                    ContentType: "application/json; charset=utf-8"
                }).then(function (response) {
                    deferred.resolve(response);
                }, function (err) {
                    deferred.reject(err)
                });
            }
            else {
                $log.error('Error: - Could not fetch service api url')
                UtilityFactory.toastError("Could not fetch service api url");
            }
        });
        return deferred.promise;
    };

    //call api to get the past runs for the service date
    function getPastRuns(divisionId, serviceDate) {
        var deferred = $q.defer();
        ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
            if (oneMVURL && oneMVURL != "") {
                //get the base url from config.
                var serviceUrl = oneMVURL + 'Dispatch/GetPastRuns?rnd=' + new Date().getTime();
                $http({
                    method: 'POST',
                    'url': serviceUrl,
                    data: JSON.stringify({ "DivisionId": divisionId, "ServiceDate": serviceDate }),
                    dataType: "json",
                    ContentType: "application/json; charset=utf-8"
                }).then(function (response) {
                    deferred.resolve(response);
                }, function (err) {
                    deferred.reject(err)
                });
            }
            else {
                $log.error('Error: - Could not fetch service api url')
                UtilityFactory.toastError("Could not fetch service api url");
            }
        });
        return deferred.promise;
    };

    //call api to the trips in the past
    function savePastTrip(saveTripReqparam) {
        var deferred = $q.defer();
        ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
            if (oneMVURL && oneMVURL != "") {
                //get the base url from config.
                var serviceUrl = oneMVURL + 'Dispatch/InsertPastTrip';
                $http({
                    method: 'POST',
                    'url': serviceUrl,
                    data: JSON.stringify(saveTripReqparam),
                    ContentType: "application/json; charset=utf-8"
                }).then(function (response) {
                    deferred.resolve(response);
                }, function (err) {
                    deferred.reject(err)
                });
            }
            else {
                $log.error('Error: - Could not fetch service api url')
                UtilityFactory.toastError("Could not fetch service api url");
            }
        });
        return deferred.promise;
    };

    //call api to get the service date for the division
    function getServiceDateByDivision(divisionId) {
        var deferred = $q.defer();
        ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
            if (oneMVURL && oneMVURL != "") {
                //get the base url from config.
                var serviceUrl = oneMVURL + 'division/' + divisionId + '/serviceDate?rnd=' + new Date().getTime();
                $http({
                    method: 'GET',
                    'url': serviceUrl,
                    ContentType: "application/json; charset=utf-8"
                }).then(function (response) {
                    deferred.resolve(response);
                }, function (err) {
                    deferred.reject(err)
                });
            }
            else {
                $log.error('Error: - Could not fetch service api url')
                UtilityFactory.toastError("Could not fetch service api url");
            }
        });
        return deferred.promise;
    };

    function getTripCancelStatusList()
    {
        var deferred = $q.defer();
        ConfigFactory.getOneMVApiURLPromise().then(function (oneMVURL) {
            if (oneMVURL && oneMVURL != "") {
                //get the base url from config.
                var serviceUrl = oneMVURL + 'passenger/getCancellationReasons?rnd=' + new Date().getTime();
                $http({
                    method: 'GET',
                    'url': serviceUrl,
                    ContentType: "application/json; charset=utf-8"
                }).then(function (response) {
                    deferred.resolve(response);
                }, function (err) {
                    deferred.reject(err)
                });
            }
            else {
                $log.error('Error: - Could not fetch service api url')
                UtilityFactory.toastError("Could not fetch service api url");
            }
        });
        return deferred.promise;

    }
}
})();


(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('TripNegotiationLogService', TripNegotiationLogService);

    TripNegotiationLogService.$inject = ['$http', '$q', 'env'];

    function TripNegotiationLogService($http, $q, env) {
        var service = {
            addApprovalLog: addApprovalLog,
            addRejectionLog:addRejectionLog
        };
        return service;

        function addApprovalLog(tripRequestId, negotiationLogId, modifiedBy) {
            var defer = $q.defer();
            var _url = env.oneMVApiUrl + "tripNegotiationLog/accept/" + tripRequestId + '/' + negotiationLogId + '/' + modifiedBy;
            $http({
                method: 'PUT',
                url: _url
            }).then(function successCallback(response) {
                if (response.data.status == 1) {
                    defer.resolve(response.data.result);
                } else {
                    defer.reject(response.data.result);
                }
            });
            return defer.promise;
        }

        function addRejectionLog(tripRequestId, modifiedBy) {
            var defer = $q.defer();
            var _url = env.oneMVApiUrl + "tripNegotiationLog/reject/" + tripRequestId + '/' + modifiedBy;
            $http({
                method: 'PUT',
                url: _url
            }).then(function successCallback(response) {
                if (response.data.status == 1) {
                    defer.resolve(response.data.result);
                } else {
                    defer.reject(response.data.result);
                }
            });
            return defer.promise;
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('DashboardController', DashboardController);

    DashboardController.$inject = [
        '$scope',
        '$stateParams',
        '$location',
        '$uibModal',
        '$rootScope',        
        '$interval',
        'DivisionService',
        'ReservationService',
        'ScheduleService',
        'authService',
        'UtilityFactory',        
        'ConfigFactory',
        'env',
        'PageService',
        'OneMvServices'
    ];

    function DashboardController($scope, $stateParams, $location, $uibModal, $rootScope, $interval, DivisionService,
        ReservationService, ScheduleService, authService, UtilityFactory,ConfigFactory, env, PageService,OneMvServices) {


        var vm = this;
        vm.userId = '';
        vm.PageService = PageService;
        vm.PageService.setTitle('Dashboard');
        vm.isUserLoggedIn = authService.isLoggedIn();
        vm.passengerReservations = [];
        vm.todaysTrips = [];
        vm.allowedServices = [];
        vm.loadingServices = false;
        vm.allowFaring = false;
        vm.passengerId = '';
        var autoRefresh = undefined;
        vm.currentYear = new Date().getFullYear();
        vm.showDrt = false;
        vm.showCommuter = false;        
        vm.commuterInfo = OneMvServices.getCommuterInfo();   
        vm.drtInfo = OneMvServices.getDrtInfo();

        var options = {};

        vm.login = function () {
            $location.path('/login');
        }

        vm.menuClass = function () {
            if (vm.allowedServices
                && vm.allowedServices.length > 0) {
                var elCount = vm.allowedServices.length;
                return 'col-sm-' + 12 / elCount;
            }
            return 'col-sm-12';
        }

        function populateDivisionParameters(callback) {
            var divisionId = DivisionService.getDivisionId();
            ConfigFactory.getDivisionParameters(divisionId)
                        .then(function (params) {
                            if (params) {
                                options.promiseWindow = params.PromiseWindow ? eval(params.PromiseWindow) : 10;
                                options.showCancelOptions = params.CancelReasonRequired ? eval(params.CancelReasonRequired.toLowerCase()) : false;
                                options.allowLocationNotes = params.AllowLocationNotes ? eval(params.AllowLocationNotes.toLowerCase()) : false;
                                vm.allowFaring = params.AllowFaring ? eval(params.AllowFaring.toLowerCase()) : false;
                                options.allowChildren = params.AllowChildren ? eval(params.AllowChildren) : false;
                                options.allowMultipleSeatBooking = params.AllowMultipleSeatBooking ? eval(params.AllowMultipleSeatBooking.toLowerCase()) : false;
                                fetchTripsAndReservations(callback);
                            }
                        }, function (response) {
                            UtilityFactory.toastError('Error', response.data.ReturnMessage);
                        });
        }

        var getPassengerTrips = function (callback) {
            ScheduleService.tripsForServiceDate(vm.passengerId)
             .then(function (response) {
                 if (response.data.status == 1 && response.data.result != null) {
                     vm.todaysTrips = response.data.result;
                     var promiseWindow = options.promiseWindow;
                     vm.todaysTrips.sort(function (a, b) {
                         return new Date(a.schedPickupTime).getTime() - new Date(b.schedPickupTime).getTime();
                     });
                     for (var i = 0; i < vm.todaysTrips.length; i++) {
                         vm.serviceDate = vm.todaysTrips[i].serviceDate;
                         if (vm.todaysTrips[i].estimatedPickupTime) {
                             //var pickupTime = vm.todaysTrips[i].schedPickupTime;
                             //var promiseWindowsEndTime = DateFactory.getPromiseWindowEndTime(pickupTime, promiseWindow);
                             //vm.todaysTrips[i].promiseWindowStartTime = $filter('date')(pickupTime, 'h:mm a');
                             //vm.todaysTrips[i].promiseWindowEndTime = $filter('date')(promiseWindowsEndTime, 'h:mm a');

                             var startPickupWindowTime = new moment(vm.todaysTrips[i].startPickupWindowTime);
                             var endPickupWindowTime = new moment(vm.todaysTrips[i].endPickupWindowTime);
                             vm.todaysTrips[i].promiseWindowStartTime = startPickupWindowTime.format('h:mm A');
                             vm.todaysTrips[i].promiseWindowEndTime = endPickupWindowTime.format('h:mm A');
                         }
                     }

                 }
                 if (!angular.isUndefined(callback) && callback != null)
                     callback();
             }, function (error) {
             });
        };
       
        //vm.allowCancel = function (trip) {
        //    return trip.Status !== 'Reserved';
        //}     

        var getPassengerReservationsForToday = function () {
            ReservationService.getPassengerReservationsForToday(vm.passengerId)
            .then(function (response) {
                if (response && response.data && response.data.status == 1 && response.data.result.reservations) {
                    vm.passengerReservations = response.data.result.reservations;                    
                }
                else {
                    vm.passengerReservations = [];
                }
            }, function (err) {
                if (err.status !== 401) {
                    UtilityFactory.toastError("Error!", "'Sorry! Could not load your Reservation!'");
                }
            });

        };
       
        function setAutoRefresh() {
            if (authService.isLoggedIn()) {
                autoRefresh = $interval(function () {
                    fetchTripsAndReservations();
                }, 30000);
            }
        }

        var activate = function () {
            vm.loadingServices = true;

            var alias = aliasNotFoundInRoute()
                ? DivisionService.getDivisionAlias()
                : $stateParams.division;

            DivisionService
                .setDivision(alias)
                .then(handleSuccess, handleFailure);     
        };

        function aliasNotFoundInRoute() {
            return angular.isUndefined($stateParams.division) 
                        || $stateParams.division === null 
                        || $stateParams.division.trim() === '';
        }

        function handleSuccess(response) {
            if (response.data.status == 1) {
                vm.allowedServices = sort(response.data.result.DivisionServices);
                vm.showCommuter = !angular.isUndefined(vm.commuterInfo);
                vm.showDrt = !angular.isUndefined(vm.drtInfo);
                if (vm.isUserLoggedIn)
                    fetchUserDetails();
                $rootScope.divisionName = (response.data.result.DivisionName ? response.data.result.DivisionName : 'One Portal');
                $rootScope.supportPhoneNumber = (response.data.result.SupportPhoneNumber ? response.data.result.SupportPhoneNumber : '');
                vm.loadingServices = false;

                //Sets the page name and headline from the database.
                
                vm.PageService.setHeadline($rootScope.divisionName);   
            }
            else {
                $location.path('division');
            }
        }

        function handleFailure(error) {
            vm.loadingServices = false;
            $location.path('division');
        }

        var sort = function (services) {
            return services.sort(function (a, b) {
                return parseInt(a.DisplayOrder) - parseInt(b.DisplayOrder);
            });
        }

        var fetchUserDetails = function () {
            vm.userId = authService.authentication.userId;
            vm.passengerId = authService.authentication.passengerId;
            populateDivisionParameters(setAutoRefresh);
        }


        vm.showStopsMap = function (inc) {
            var modalGetMap = $uibModal.open({
                animation: true,
                windowClass: 'map-modal',
                templateUrl: 'app/modules/commuter/modals/reservation-map-modal/reservation-map.html',
                controller: 'ReservationMapController as vm',
                backdrop: 'static',
                resolve: {
                    reservation_stops: function () {
                        return inc;
                    }
                }
            });

            modalGetMap.result.then(function (isDone) {
                if (isDone) {
                }

            }, function () {

            });
        };



        var fetchTripsAndReservations = function () {

            if (vm.showCommuter) getPassengerReservationsForToday();
            if (vm.showDrt) {
				// get all DRT trips of interest to the passenger
            	getPassengerTrips();
            	// get current trip
            	ScheduleService.getlastripdetails(vm.passengerId);
            }
        };


        $scope.$on('$destroy', function (event) {
            stopAutoRefresh();
        });


        var stopAutoRefresh = function () {
            if (angular.isDefined(autoRefresh)) {
                $interval.cancel(autoRefresh);
                autoRefresh = undefined;
            }            
        }

        $scope.$on('divisionChanged', stopAutoRefresh);

        vm.navigate = function (path, serviceType, serviceId) {
            //$rootScope.$broadcast(serviceId);
            if (serviceType === 'external')
                if ($('body').hasClass('platform-cordova')) {
                    // This is here for Ionic framework.
                    window.open(path, '_system', '');
                } else {
                    window.location = path;
                }
                
            else if (serviceType === 'internal')
                $location.path(path);
        }
      

        vm.showCommuterTrip = function (trip) {
            var commuterTripModal = $uibModal.open({
                animation: true,
                templateUrl: 'app/modules/shared/trips/commuter-trip-modal.html',
                controller: 'CommuterTripModalController as vm',
                size: '-fs',
                backdrop: 'static',
                keyboard: false,
                resolve: {
                    tripId: trip.id
                }
            });

            commuterTripModal.result.then(function (response) {
                if (response.cancelled || response.isModified) {
                    getPassengerReservationsForToday();
                }
            });

        }

        vm.showDrtTrip = function (trip) {
            var _tripModalRequest = {
                passengerTrip: trip,
                options: options,
                serviceDate: vm.serviceDate
            }
            var drtTripModal = $uibModal.open({
                templateUrl: 'app/modules/shared/trips/drt-trip-modal.html',
                controller: 'TripDetailsModalController as vm',
                size: '-fs',
                resolve: {
                    tripModalRequest: _tripModalRequest
                }
            });

            drtTripModal.result.then(function (result) {
                if (result && result.action === 'cancel') {
                    cancelTrip(trip);
                }
            });

        }


        function cancelTrip(trip) {
            var tripToCancel = {
                'tripId': trip.TripId,
                'passengerId': trip.PassengerId,
                'from': trip.startName,
                'to': trip.endName,
                'scheduledTime': trip.schedPickupTime
            };

            var modalCancelTrip = $uibModal.open({
                animation: true,
                templateUrl: 'app/modules/on-demand/activeTrip/trip-cancellation-prompt.html',
                controller: 'TripCancellationController as vm',
                size: '-fs',
                resolve: {
                    tripToCancel: function () {
                        return tripToCancel;
                    },
                    showCancelOptions: options.showCancelOptions

                }
            });

            modalCancelTrip.result.then(function (result) {
                if (result.isCancel) {
                    UtilityFactory.toastSuccess("Success!", "Trip cancelled");
                    getPassengerTrips();
                }
                else
                    UtilityFactory.toastError("Error!", "Unable to cancel the trip.");
            });
        };


        activate();

        // Ionic parameters
        if (env.ionic) {
            vm.appVersion = env.ionic.appVersion;
            vm.appVersion += env.ionic.softwareVersion == null ? '' : ' ' + env.ionic.softwareVersion;
            vm.appVersion += env.ionic.environment == null ? '' : '.' + env.ionic.environment;
            vm.appVersion += env.ionic.localEnvironment == null ? '' : '.' + env.ionic.localEnvironment;

        } else {
            vm.appVersion = '';
        }
        vm.refresh = function (refresher) {
            activate();
            $rootScope.$broadcast('scroll.refreshComplete');
        }        

    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('DivisionsController', DivisionsController);

    DivisionsController.$inject = ['$window', '$scope', '$rootScope', '$location', 'DivisionService', 'GeoLocationService',
        'CommonService', 'env','UtilityFactory'];

    function DivisionsController($window, $scope, $rootScope, $location, DivisionService, GeoLocationService, CommonService, env,UtilityFactory) {
        //figure out gps is on or off. If on then find divisions in same state and state drop down
        var vm = this;
        vm.divisions = [];
        vm.selectedDivision = '';
        vm.isDivisionLoaded = false;
        vm.showDivisionDropdown = true;
        vm.states = [];
        var noDivision = { 'Alias': '--', 'DivisionName': '--' };
        var noState = { 'Name': '--', 'Id': '--' };
        vm.setDivision = setDivision;
        vm.fetchDivisionsForSelectedState = fetchDivisionsForSelectedState;

        activate();
        function populateDivisions(response) {

            if (response.data.result != null && response.data.result.length > 0) {
                vm.divisions = response.data.result;
                vm.divisions.splice(0, 0, noDivision);
                if (env.isIonic && env.isIonicDevice) {
                    // In passenger app, lets select Amazon, or remove amazon from
                    // the drop down based on env.ionic.divisionName
                    if (env.ionic.divisionName == 'amazon') {
                        // Its Amazon, select Amazon and GO
                        vm.selectedDivision = 'amazon';
                        vm.setDivision();
                    } else {
                        // Not Amazon, remove Amazon from the list.
                        var exclusions = [206]; // add any divisions that have their own app to this array.
                        angular.forEach(vm.divisions, function (value, key) {
                            if (exclusions.indexOf(parseInt(value.DivisionID)) != -1) {
                                var index = vm.divisions.indexOf(value);
                                if (index > -1) {
                                    vm.divisions.splice(index, 1);
                                }
                            }
                        })
                    }
                }


                vm.selectedDivision = vm.divisions[0].Alias;
                vm.isDivisionLoaded = true;
            }
        }

        function activate() {
            if (env.isIonic && env.isIonicDevice && env.ionic.divisionName == 'amazon') {
                // Its Amazon, select Amazon and GO
                vm.selectedDivision = 'amazon';
                vm.setDivision();
            }
            GeoLocationService.getCurrentPosition().then(function (position) {
                var latitude = position.coords.latitude
                var longitude = position.coords.longitude
                DivisionService.getDivisionsByLocation(latitude, longitude).then(populateDivisions, function (error) {
                    vm.isDivisionLoaded = true;
                    vm.showDivisionDropdown = false;
                });
            });
            CommonService.GetStatesWithDivisions().then(
                function (result) {
                    vm.states = result;
                    vm.states.splice(0, 0, noState);
                    vm.selectedState = vm.states[0].Id;
                },
                function (err) {
                    UtilityFactory.toastError('', "Could not load states list. Please try again later.")
                });
            //DivisionService.getDivisions()
            //    .then(populateDivisions, function (error) {
            //        vm.isDivisionLoaded = true;
            //        vm.showDivisionDropdown = false;
            //    })
        };

        $scope.reloadPage = function () { $window.location.reload(); };

        function setDivision() {
            if (vm.selectedDivision != noDivision.Alias) {
                var alias = vm.selectedDivision;
                $location.path('dashboard/' + alias);
            }
        }
        function fetchDivisionsForSelectedState() {
            if (vm.selectedState != noState.Id) {
                vm.divisions = [];
                vm.divisions.splice(0, 0, noDivision);
                DivisionService.getDivisionByState(vm.selectedState)
                    .then(populateDivisions, function (error) {
                        vm.isDivisionLoaded = true;
                        vm.showDivisionDropdown = false;
                    });
            }
        }
        // Start of code for Ionic
        if (env.isIonic) {
            vm.env = env.ionic.env;
        } else {
            vm.env = '';
        }
        vm.refresh = function (refresher) {
            activate();
            $rootScope.$broadcast('scroll.refreshComplete');
        }
        // End of code for Ionic

    }
    
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('ForgotPasswordController', ForgotPasswordController);

    ForgotPasswordController.$inject = ['$scope', '$state', 'env', 'PasswordService', 'authService', 'vcRecaptchaService', 'DivisionService', 'PortalUtilityService', 'MessageService'];

    function ForgotPasswordController($scope, $state, env, PasswordService, authService, vcRecaptchaService, DivisionService, PortalUtilityService, MessageService) {
        var vm = this;
        vm.captchaPublicKey = env.captchaPublicKey;
        vm.WidgetCreate = widgetCreate;
        vm.setCaptchaResponse = setCaptchaResponse;
        
        vm.verifyEmail = verifyEmail;
        vm.cancel = cancel;
        
        var widgetId = -1;

        function setCaptchaResponse(response) {
            authService.verifyCaptcha(response).then(function (result) {
                if (!result.success)
                    vcRecaptchaService.reload(widgetId);
            },
                function (error) {
                });
        }

        function widgetCreate(_widgetId) {
            widgetId = _widgetId;
        }
        function cancel() {
            $state.go('loginOneMV');
        }
        function verifyEmail() {

            PasswordService.SendPasscode(vm.Email).then(function (response) {
                if (response.data && response.data.result) {
                    if (response.data.result.ChangeStatus)
                        $state.go('verify-update-password', { obj: { email: vm.Email } });
                    else {
                        vm.isClicked = !vm.isClicked;
                        MessageService.showError(response.data.result.ChangeStatusDescription);
                        
                    }
                }
            }, function (err) {
                vm.isClicked = !vm.isClicked;
                MessageService.showError(err);
                
            });

        };

        // Start of code for Ionic
        vm.ionicInclude = 'app/shared/login/forgot-password.html';
        vm.ionicCustomClassName = 'ionic-onemv-login';
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = false;
        vm.showRecaptcha = !env.isIonic;
        // End of code for Ionic

        activate();

        function activate() {
            var divisionId = DivisionService.getDivisionId();
            if (!PortalUtilityService.hasValue(divisionId))
                $state.go("division");
        }
    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('LoginController', LoginController);

    LoginController.$inject = ['$location', '$scope', '$rootScope', 
        'authService', 'env', 'MessageService', 'DivisionService', 'ConfigFactory',
        'GeoLocationService', 'ServiceAreaService', '$timeout', '$window','PageService'];

    function LoginController($location, $scope, $rootScope, 
                            authService, env, MessageService, DivisionService, ConfigFactory, GeoLocationService, ServiceAreaService,
                            $timeout, $window, PageService) {
        var vm = this;        
        var division = {};
        var divisionSupportsFeed = false;
        vm.message = "";
        //vm.alias = '';
        vm.providers = [];
        $scope.hideHeader = $location.path() === '/login';
        vm.isAmazonProvider = false;

        vm.navigateToHome = function () {
            window.history.back();
        };

        vm.allowedToLoginOrRegister = false;
        vm.loginOrRegisterMessage = '';
        vm.hasGpsBeenChecked = false;
        vm.PageService = PageService;
        vm.PageService.setTitle('Whats New');
        vm.PageService.setHeadline('Latest Service Updates');
        var activate = function () {

            DivisionService
                .getDivisionInfo()
                .then(onDivisionSuccess, onDivisionFailure);
        };

        function getSystemParams() {
            ConfigFactory
                .getDivisionParameters(division.DivisionID)
                .then(function (params) {
                    if (params) {
                        divisionSupportsFeed = params.DivisionSupportsFeed
                                                ? eval(params.DivisionSupportsFeed.toLowerCase())
                                                : true;

                        var allowRegisterIffGpsIsOn = params.AllowRegisterIffGpsIsOn
                                                        ? eval(params.AllowRegisterIffGpsIsOn)
                                                        : false;
                        if (allowRegisterIffGpsIsOn)
                        {
                            isGpsEnabled();
                        } else {
                            vm.allowedToLoginOrRegister = true;
                            vm.hasGpsBeenChecked = true;
                        }

                    }
                });
        }

        function isGpsEnabled() {
            GeoLocationService
                   .getCurrentPosition()
                   .then(function (position) {
                       if (position) {
                           isInServiceArea(position);
                       }
                       else
                           disableLogin('Your device is unable to determine your GPS location.');
                   }, function (err) {
                       disableLogin('GPS must be enabled to use this application.');
                   });
        }


        function isInServiceArea(position) {
            vm.hasGpsBeenChecked = true;
            ServiceAreaService
                .isInServiceArea(division.DivisionID, position.coords.latitude, position.coords.longitude)
                .then(function (response) {
                    if (response && !response.data.result) {
                        disableLogin('You must be within the service area to login or register.');
                    } else{
                        vm.allowedToLoginOrRegister = true;
                    }
                }, function (error) {
                    disableLogin('We are unable to verify your GPS location. Please try again later.');
                })
        }


        function disableLogin(message) {
            vm.hasGpsBeenChecked = true;
            vm.allowedToLoginOrRegister = false;
            vm.loginOrRegisterMessage = message;
            // navigate to dashboard after 10 seconds.
            vm.redirectTimeout = $timeout(function () {
                $window.location.replace('#/');
            }, 10000);
        }
        // kill the timeout if the user navigates away before 10 seconds.
        $scope.$on("$destroy", function () {
            if (vm.redirectTimeout) {
                $timeout.cancel(vm.redirectTimeout);
            }
        });
        function onDivisionSuccess(response) {
            if (response.data.status === 1) {
                division = response.data.result;
                vm.alias = division.Alias;
                var logins = response.data.result.AllowedLogins;
                var providers = logins.split(',');
                for (var i = 0; i < providers.length; i++) {
                    vm.isAmazonProvider = providers[i].toLowerCase() == "amazon";
                    vm.providers.push({ 'name': providers[i] });
                }

                getSystemParams();
            }            
        };

        function onDivisionFailure(error) {
            $location.path("dashboard/");
        }        

        activate();

        vm.ionicUseExternalLink = env.ionic == null ? false :  env.ionic.appVersion == 'v9.6.52';

        vm.authExternalProvider = function (provider) {
            if (provider == 'OneMV' || provider == 'One MV')
            {

                $location.path('loginOneMV');
                return;
            } else if (provider == 'Google' && $('body').hasClass('platform-cordova')) {
                $location.path('loginGoogleIonic');
                return;
            }
            var redirectUri = location.protocol + '//' + location.host + '';
            // for IONIC
            if ($('body').hasClass('platform-ios') || $('body').hasClass('platform-android')) {
                // for the mobile IONIC app iOS and Android version, 
                // this is a dummy URL that will work in the InAppBrowser plugin
                redirectUri = 'http://localhost/callback/';
            }
            if ($('body').hasClass('platform-browser')) {
                // for running IONIC version locally.
                redirectUri += '/index.ionic.html#';
            }

           var externalProviderUrl = env.authServerUrl  + "Account/ExternalLogin?provider=" + provider
                                                                        + "&response_type=token&client_id=" + env.audience
                                                                        + "&redirect_uri=" + redirectUri
                                                                        + "&divisionSupportsFeed=" + divisionSupportsFeed
                                                                        + "&divisionId=" + DivisionService.getDivisionId();
            // If body has class 'platform-cordova', then we are on a mobile device.
            // When on a mobile device, we need to use the cordova inappbrowser
            if ($('body').hasClass('platform-cordova')) {
                var target = '_blank';
                var options = 'location=no,toolbar=yes,clearcache=yes,clearsessioncache=yes,closebuttoncaption=Back to Passenger App,toolbar=yes,transitionstyle=coververtical';
                var ref = window.open(externalProviderUrl, target, options);
                ref.addEventListener('loadstart', function (event) {
                    if (event.url.indexOf('http://localhost/callback/#') == 0 || event.url.indexOf('file:///#/') == 0) {
                        var newLocation = event.url.substring(event.url.indexOf('#'), event.url.length);
                        ref.close();
                        window.location = newLocation;
                    }
                });
                ref.addEventListener('loaderror', function (event) {
                    console.log('loaderror:' + JSON.stringify(event));
                });
            } else {
                window.location = externalProviderUrl;
            }
        };

        // Start of code for Ionic
        vm.ionicInclude = 'app/shared/login/login.html';
        vm.ionicCustomClassName = 'ionic-login-class';
        vm.ionicHideNavBar = true;
        vm.ionicUseRefresher = false;
        // End of code for Ionic
      
    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('OneMVLoginController', OneMVLoginController);

    OneMVLoginController.$inject = ['$location', '$scope', '$rootScope', 
        'authService', 'env', 'MessageService', 'DivisionService', 'PageService'];

    function OneMVLoginController($location, $scope, $rootScope,
                            authService, env, MessageService, DivisionService, PageService) {
        var vm = this;
        vm.login = login;
        vm.cancel = cancel
        vm.divisionId = DivisionService.getDivisionId();
        vm.PageService = PageService;
        vm.PageService.setTitle('Login');
        vm.PageService.setHeadline('With your ONEMV account');
        function cancel()
        {
            $location.path('dashboard/');
        }
        function login() {
            //call one mv login
            var request = {
                UserName: vm.username,
                Password: vm.password,
                DivisionId: vm.divisionId,
                Provider: 'MvLogin'
            }
                     //will call a service
            authService.loginOneMV(request).then(function (response) {
                $rootScope.$broadcast('loggedIn', null);
                $location.path('dashboard/');
            }, function errorCallback(error) {
                //call message service
                vm.isClicked = !vm.isClicked
                if(error)
                    MessageService.showError(error.Message);
            });
        }

        // Start of code for Ionic
        vm.ionicInclude = 'app/shared/login/onemv-login.html';
        vm.ionicCustomClassName = 'ionic-onemv-login';
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = false;
        // End of code for Ionic

        function activate() {
            
        }

    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('VerifyUpdatePasswordController', VerifyUpdatePasswordController);

    VerifyUpdatePasswordController.$inject = ['$scope', '$state', '$stateParams', '$location','env', 'PasswordService', 'MessageService', 'authService'];

    function VerifyUpdatePasswordController($scope, $state, $stateParams, $location, env, PasswordService, MessageService, authService) {
        var vm = this;
        vm.submit = submit;
        
        vm.captchaPublicKey = env.captchaPublicKey;
        vm.WidgetCreate = widgetCreate;
        vm.setCaptchaResponse = setCaptchaResponse;
        vm.email = ($stateParams.obj) ? $stateParams.obj.email : "";
        var queryString = $location.search();
        if (queryString)
        {
            if (queryString.email)
                vm.email = queryString.email;
            if (queryString.division)
                vm.division = queryString.division;
            
        }
      

        var widgetId = -1;

        function setCaptchaResponse(response) {
            authService.verifyCaptcha(response).then(function (result) {
                if (!result.success)
                    vcRecaptchaService.reload(widgetId);
            },
                function (error) {
                });
        }

        function widgetCreate(_widgetId) {
            widgetId = _widgetId;
        }



       
        function submit()
        {
            if (vm.newPassword != vm.repeatNewPassword)
            {
                MessageService.showError("New and Repeat Passwords don't match.")
                vm.isClicked = !vm.isClicked;
                return;
            }
            var passwordData = {
                TemporaryCode: vm.temporaryCode,
                Email: vm.email,
                NewPassword: vm.newPassword
            }
            PasswordService.VerifyAndUpdatePassword(passwordData).then(function (response) {
                if (response.data && response.data.result && response.data.result) {
                    if (response.data.result.ChangeStatus) {
                        $state.go("loginOneMV");
                    }
                    else {
                        vm.isClicked = !vm.isClicked;
                        MessageService.showError(response.data.result.ChangeStatusDescription);
                    }
                }
                else {
                    MessageService.showError("Could not update password");
                    vm.isClicked = !vm.isClicked;
                }
              
            }, function (err) {
                MessageService.showError(err);
                vm.isClicked = !vm.isClicked;
            });
          
        }

        // Start of code for Ionic
        vm.ionicInclude = 'app/shared/login/verify-update-password.html';
        vm.ionicCustomClassName = 'ionic-onemv-login';
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = false;
        vm.showRecaptcha = !env.isIonic;
        // End of code for Ionic

        activate();

        function activate() {
        }
    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('LogoutController', LogoutController);

    LogoutController.$inject = ['$location', '$rootScope', 'authService'];

    function LogoutController($location, $rootScope,authService) {
           var vm = this;
           authService.logOut().then(function () {
               $rootScope.$broadcast('loggedout', null);
               $location.path('dashboard/');
           }, function () {
               console.log('Unable to sign-out user.');
           })
           
    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('MinAppSupportController', MinAppSupportController);

    MinAppSupportController.$inject = ['$rootScope', '$location', 'DynamicContentService', 'PageService', 'DivisionService'];

    function MinAppSupportController($rootScope, $location, DynamicContentService, PageService, DivisionService) {
        var vm = this;
        vm.PageService = PageService;
        var _error = 'This version is no longer supported. Please download the latest version from app store';
        vm.PageService.setTitle('App Error');
        vm.PageService.setHeadline('This version is no longer supported');

        function activate() {
            if (DivisionService.getDivisionId())
                DivisionService
                     .getDivisionInfo()
                 .then(handleSuccess, handleFailure);
            else
                handleFailure();
        }

        function handleSuccess(response) {
            if (response.data.status === 1) {
                var division = response.data.result;
                vm.ErrorMessage = division.MinAppError
            }
        }

        function handleFailure() {
            vm.ErrorMessage = _error;
        }

        activate();

        // Start of code for Ionic
        //vm.ionicInclude = 'app/shared/whats-new/whats-new.html';
        //vm.ionicCustomClassName = 'ionic-whats-new card';
        //vm.ionicHideNavBar = false;
        //vm.ionicUseRefresher = true;
        //vm.ionicPullingText = 'Refresh';
        //vm.ionicRefreshingText = 'Loading';
        //vm.ionicSpinner = 'spiral'; // none to disable.
        //vm.refresh = function (refresher) {
        //    getData();
        //    $rootScope.$broadcast('scroll.refreshComplete');

        //}
        // End of code for Ionic
    }
})();

(function () {
    angular.module('oneMVApp').controller('nav', nav);


    nav.$inject = [ '$scope', '$location', '$rootScope', '$uibModal', '$timeout', '$interval',
                    'authService', 'ScheduleService', 'DivisionService','OneMvServices'];

    function nav($scope,$location, $rootScope, $uibModal, $timeout, $interval,
                    authService, ScheduleService, DivisionService,OneMvServices) {

        $scope.title = 'MOBI';
        $scope.hasActiveTrip = false;
        var autoRefresh = undefined;
        var modalVehicleArriving = false;
        var modalVehicleArrived = false;
        $scope.parentState = undefined;
        var allowedServices =  DivisionService.getAllowedServices();       

        var menus = [
            {
                "name": "commuter",
                "service": "commuter",
                "url": "commuter/home-commuter",
                "order": 6,
                "class": "link--commuter",
                "level": 1,
                "isServiceMenu" :true,
                "subPages": [
                  {
                      "name": "Advanced Reservations",
                      "url": "commuter/adv-schedule-setup",
                      "service": "commuter",
                      "showOffline": false,
                      "order": 7
                  },
                  {
                      "name": "Bus Stops",
                      "url": "commuter/all-stops",
                      "service": "commuter",
                      "order": 8
                  },
                  {
                      "name": "Published Schedule",
                      "url": "commuter/published-schedule",
                      "service": "commuter",
                      "order": 9
                  },
                ]
            },
          {
              "name": "drt",
              "isServiceMenu" :true,
              "order": 10,
              "url": "on-demand/reservations",
              "service": "drt",
              "class": "link--demand",
              "showOffline": false,
              "level": 1,
              "subPages": [
                {
                    "name": "Active Trip",
                    "url": "on-demand/active-trip",
                    "service": "drt",
                    "showOffline": false,
                    "showActive": false,
                    "order": 11
                }
              ]

          },
          {
              "name": "fixed",
              "isServiceMenu" :true,
              "url": "fixed-route/landing",
              "service": "fixed",
              "class": "link--fixed",
              "order": 12,
              "level": 1,
              subPages: [
                {
                    "name": "Routes",
                    "url": "fixed-route/allRoutes",
                    "service": "fixed",
                    "order": 13
                },
                {
                    "name": "Stops",
                    "url": "fixed-route/stops",
                    "service": "fixed",
                    "order": 14
                },
                {
                    "name": "Schedule",
                    "url": "fixed-route/schedule",
                    "service": "fixed",
                    "order": 15
                },
                {
                    "name": "Published Schedule",
                    "url": "http://thebus.mobi/content/documents/amz-published-schedule.pdf",
                    "service": "fixed",
                    "isExternal": true,
                    "order": 16
                }
              ]
          },
          {
              "name": "My Trips",
              "url": "passenger-trips",
              "service": "drt,commuter",
              "class": "link--trips",
              "order": 17,
              "showOffline": false,
              "level": 1           
          },

          //shared Pages
          {
              "name": "User Profile",
              "id": "menuProfile",
              "url": "shared/profile",
              "service": "commuter,fr,drt",
              "showOffline": false,
              "isProfileMenu": true,
              "order": 20,
              "level": 2
          },
          {
              "name": "Change Password",
              "id": "changePassword",
              "url": "change-password",
              "service": "commuter,fr,drt",
              "showOffline": false,
              "isOneMV": true,
              "order": 21,
              "level": 2
          },
          {
              "name": "Manage Vehicles",
              "url": "commuter/my-vehicles",
              "service": "commuter",
              "showOffline": false,
              "order": 22,
              "level": 2
          },
          {
              "name": "What's New",
              "url": "news",
              "service": "commuter,fr,drt",
              "order": 23,
              "level": 2
          },
          {
              "name": "Policies",
              "url": "commuter/policy",
              "service": "commuter",
              "order": 24,
              "level": 2
          },
          {
              "name": "Support",
              "url": "support",
              "service": "commuter",
              "order": 25,
              "level": 2
          },
          {
              "name": "Notifications",
              "url": "notifications",
              "service": "commuter,fr,drt",
              "order": 26,
              "level": 2
          },
          {
              "name": "Settings",
              "url": "settings",
              "service": "commuter,drt,fr",
              "showOffline": false,
              "order": 27,
              "level": 2
          },
          {
              "name": "Sign in",
              "url": "login",
              "service": "commuter,drt",
              "order": 28,
              "showOffline": true,
              "level": 2
          },
          {
              "name": "Sign out",
              "url": "logout",
              "service": "commuter,drt",
              "order": 29,
              "showOffline": false,
              "level": 2
          }

        ];

        $scope.pagelink = function (url, app, showAsModal, event, isExternal) {
            if (app != null) {
                $scope.ionicToggleMenu()
            }            

            //if we have multiple modals needed on menu clicks tomorrow, we need to pass controller and markup as menu properties.
            if (showAsModal) {
                showNotificationModal();
            } else if (!angular.isUndefined(isExternal) && isExternal) {
                window.open(url, '_system', '');
            } else {
                if (url)
                    $location.path(url);
                else $location.path('#');
            }
        }

        function showNotificationModal() {

            $uibModal.open({
                animation: true,
                templateUrl: 'app/shared/notification/notification.html',
                controller: 'NotificationController as vm',
                size: ''
            });
        }


        // returns true if the current router url matches the passed in url
        // so views can set 'active' on links easily
        $scope.isActive = function (name) {
            return isCommuterLink(name) || isMyTripsLink(name) || isDrtLink(name) || isFixedRouteLink(name);            
        };

        function isMyTripsLink(name){
            return name == 'My Trips' 
                    && ($location.path() == '/passenger-trips');
        }    

        function isDrtLink(name){
            return $location.path().indexOf('on-demand') > -1 && name === 'drt';
        }

        function isCommuterLink(name){
            return $location.path().indexOf('commuter') > -1 && name === 'commuter';
        }

        function isFixedRouteLink(name){
            return $location.path().indexOf('fixed-route') > -1 && name === 'fixed';
        }


        $scope.closeDropDown = function () {
            $scope.isopen = false;
        };

        $scope.goBack = function (event) {
            angular.element('#page-wrapper').addClass('back');
            $timeout(function () {
                angular.element('#page-wrapper').removeClass('back');
            }, 1000);
            window.history.back();
        };
       
        function onlineMenus(menu) {
            var result = angular.isUndefined(menu.showOffline) || !menu.showOffline;
            if (result && menu.isProfileMenu) {
                // show profile menu only if dropoff Home location only is true
                // note: remove this limitation when non home location items are added to Profile
                var param = DivisionService.getSystemParameters();
                result = param.DropoffHomeLocationOnly;
            }
            if (result && menu.isOneMV) {
                result = authService.authentication.loginProvider === "MvLogin";
            }
            return result;
        };


        function offlineMenus(menu) {
            return angular.isUndefined(menu.showOffline) || menu.showOffline;
        };

        function allowedForDivision(menu) {            
            if (allowedServices) {
                var menuServices = menu.service.split(',');

                for (var i = 0; i < menuServices.length; i++) {
                    for(var j = 0;j<allowedServices.length;j++){
                        if(allowedServices[j].name.toLowerCase() == menuServices[i].toLowerCase())
                        return true;
                    }                        
                }
                return false;
            }

            return false;
        }

        function sortByOrder(a, b) {
            return a.order > b.order;
        };

        function copy(o) {
            return Object.assign({}, o)
        };

        function toggleMenu() {
            var loginPredicate = authService.isLoggedIn() ? onlineMenus : offlineMenus;
            var divisionPredicate = allowedForDivision;

            var processedMenus = menus
              .map(copy)
              .filter(divisionPredicate)
              .filter(loginPredicate)
              .sort(sortByOrder);

            for (var i = 0; i < processedMenus.length; i++) {
                if (processedMenus[i].subPages)
                    processedMenus[i].subPages = processedMenus[i]
                    .subPages
                    .map(copy)
                    .filter(divisionPredicate)
                    .filter(loginPredicate)
                    .sort(sortByOrder);
            }

            $scope.pages = setPages(processedMenus);            
        }


        function setPages(pages) {

            if (!pages) return undefined;

            var menus = [];
            
            for (var i = 0; i < pages.length; i++) {
                var page = {
                    'alias': getMenuName(pages[i]),
                    'name' : pages[i].name,
                    'order': pages[i].order,
                    'service': pages[i].service,
                    'showAsModal': pages[i].showAsModal,
                    'class': pages[i].class,
                    'showActive': pages[i].showActive,
                    'level': pages[i].level
                };
                if (pages[i].url)
                    page.url = pages[i].url;
                if (pages[i].subPages)
                    page.subPages = setPages(pages[i].subPages);
                page.isExternal = pages[i].isExternal;
                menus.push(page);
            }
            return menus;
        }

        function getMenuName(menu){

            if(!menu.isServiceMenu) return menu.name;

            for(var i = 0;i <allowedServices.length;i++){
                if(menu.service.toLowerCase().includes(allowedServices[i].name.toLowerCase()))
                    return allowedServices[i].alias;
            }    
            return undefined;
        }

        function setActiveTripMenuItem(flag) {
            outer: for (var m in $scope.pages) {
                if ($scope.pages[m].name == "drt") {
                    inner: for (var subM in $scope.pages[m].subPages) {
                        if ($scope.pages[m].subPages[subM].name == "Active Trip") {
                            $scope.pages[m].subPages[subM].showActive = flag;
                            break outer;
                        }
                    }
                }
            }
        }

        function CheckVehicleStatusForTrip(passengerId) {
            if (!angular.isUndefined(OneMvServices.getDrtInfo()) && authService.isLoggedIn()) {
                var divisionId = '';
                ScheduleService.getlastripdetails(passengerId, divisionId).then(function (response) {
                    if (response.data.status === 1 && response.data.result) {
                        setActiveTripMenuItem(true);

                    } else {
                        setActiveTripMenuItem(false);
                    }
                    if (response.data.status == 1) {
                        var currentTripDetails = response.data.result;



                        if (!modalVehicleArriving && currentTripDetails.TripID != null && currentTripDetails.PickUpGeofenceTime != null && currentTripDetails.StartTime == null && currentTripDetails.OriginDepartTime == null) {
                            event.preventDefault();
                            $scope.modelinstance = $uibModal.open({
                                template: '<div class="modal__header" >' +
                                  '<h4 class="modal-title">Info</h4>' +
                                  ' </div>' +
                                  '<div class="modal__-body">' +
                                  '<p>Your vehicle will be arriving soon</p>' +
                                  '</div>' +
                                  '<div class="modal__footer">' +
                                  '<button class="btn btn-warning" type="button" ng-click="close()">OK</button>' +
                                  ' </div>',
                                scope: $scope,
                                replace: true,
                                backdrop: 'static',
                                keyboard: false
                            });
                            modalVehicleArriving = true;
                        } else if (!modalVehicleArrived && currentTripDetails.TripID != null && currentTripDetails.StartTime != null && currentTripDetails.OriginDepartTime == null) {
                            if (modalVehicleArriving) {
                                modalVehicleArriving = false;
                                $scope.close();
                            };
                            event.preventDefault();
                            $scope.modelinstance = $uibModal.open({
                                template: '<div class="modal-header" >' +
                                  '<h3 class="modal-title">Info</h3>' +
                                  ' </div>' +
                                  '<div class="modal-body">' +
                                  '<p>Your vehicle has just arrived</p>' +
                                  '</div>' +
                                  '<div class="modal-footer">' +
                                  '<button class="btn btn-warning" type="button" ng-click="close()">OK</button>' +
                                  ' </div>',
                                scope: $scope,
                                replace: true,
                                backdrop: 'static',
                                keyboard: false
                            });
                            modalVehicleArrived = true;
                            stopAutoRefresh();
                        }
                    }
                }, function (err) {
                    console.log('CheckVehicleStatusForTrip', err);
                });
            }


        };

        $scope.close = function () {
            $scope.modelinstance.close();
            modalVehicleArrived = false;
            modalVehicleArriving = false;

        }

        function refresh() {
            $scope.pages = [];
            allowedServices =  DivisionService.getAllowedServices();
            toggleMenu();

            if (angular.isUndefined(autoRefresh) && !$rootScope.navAutoRefreshIsRunning) {
                autoRefresh = $interval(function () {
                    CheckVehicleStatusForTrip(authService.authentication.passengerId);
                }, 15000);
                $rootScope.navAutoRefreshIsRunning = !angular.isUndefined(autoRefresh);
            };
        };

        $scope.$on('$destroy', function (event) {
            stopAutoRefresh()
        });

        function stopAutoRefresh() {
            if (angular.isDefined(autoRefresh)) {

                $interval.cancel(autoRefresh);
                autoRefresh = undefined;
                $rootScope.navAutoRefreshIsRunning = false;
            };
        };

        $scope.$on('loggedIn', function () {
            refresh();
        });
        $scope.$on('loggedout', function () {
            refresh();
            stopAutoRefresh();
        });
      
        $scope.$on('divisionChanged', function () {
            refresh();
        });

        // show active trip menu item only if user has an active trip
        $scope.$on('hasActiveTripChanged', function (event, hasActiveTrip) {
            if ($scope.hasActiveTrip != hasActiveTrip) {
                $scope.hasActiveTrip = hasActiveTrip;
                setActiveTripMenuItem(hasActiveTrip);
                refresh();
            }
        });       

        refresh();



        $scope.toggleGroupIonic = function (group, isParent) {
            if (!$scope.isGroupShownIonic(group)) {
                $scope.shownGroupIonic = group;
            } else if (isParent) {
                $scope.shownGroupIonic = null;
            }
        };
        $scope.wipeLocalStorageInfo = function () {
            console.log('go 1');
            $rootScope.$broadcast('ionicShowSplashScreen');
            $scope.ionicToggleMenu();
            var ionicCHCPOn = window.localStorage['ionicCHCPOn'] ? window.localStorage['ionicCHCPOn'] : 'true';
            var localEnv = window.localStorage['env'] ? window.localStorage['env'] : '-dev';
            window.localStorage.clear();
            window.localStorage['ionicCHCPOn'] = ionicCHCPOn;
            window.localStorage['env'] = localEnv;
            window.location.replace('#/nav/division');
            $timeout(function () {
                window.location.reload(true);
            }, 500)
        };
        $scope.isGroupShownIonic = function (group) {
            return $scope.shownGroupIonic === group;
        };

        $scope.ionicToggleMenu = function () {
            $rootScope.$broadcast('ionicToggleLeftMenu');
        };

    }

})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('NotificationController', NotificationController);

    NotificationController.$inject = ['$uibModal','NotificationService', 'PageService', 'authService','OneMvServices'];

    function NotificationController($uibModal, NotificationService, PageService, authService, OneMvServices) {

        var vm = this;
        vm.title = 'Notifications';
        vm.PageService = PageService;
        vm.PageService.setTitle('Notifications');
        vm.PageService.setHeadline('Service updates');
        vm.commuterAlerts = [];
        vm.frNotifications = [];

        vm.isFrNotificationLoading = true;
        vm.isCommuterAlertLoading = false;
        vm.isCommuterNotificationLoading = false;
        vm.isDRTNotificationLoading = false;           
        vm.hasCommuter = false;
        vm.hasFixedRoute = false;
        vm.hasDRT = false;

        vm.commuterInfo = OneMvServices.getCommuterInfo();
        vm.fixedRouteInfo = OneMvServices.getFixedRouteInfo();
        vm.drtInfo = OneMvServices.getDrtInfo();

        vm.cancel = function () {
          //  $uibModalInstance.dismiss('cancel');
        };

        activate();

        vm.showTripInfo = showTripInfo;


        function showTripInfo(notification) {
            showCommuterTripInfo(notification.LinkedId);
        }

        function showCommuterTripInfo(tripId) {
            var commuterTripModal = $uibModal.open({
                animation: true,
                templateUrl: 'app/shared/trips/commuter-trip-modal.html',
                controller: 'CommuterTripModalController as vm',
                size: '-fs',
                backdrop: 'static',
                keyboard: false,
                resolve: {
                    tripId: tripId
                }
            });

            commuterTripModal.result.then(function (response) {
                if (response.cancelled || response.isModified) {
                    getCommuterNotifications();
                }
            });

        }

        function activate() {

        vm.isloggedIn = authService.isLoggedIn();
        
            if(!angular.isUndefined(vm.commuterInfo)){
                vm.hasCommuter = true;
                getCommuterNotifications();
            }
            if(!angular.isUndefined(vm.fixedRouteInfo)){
                vm.hasFixedRoute = true;
                getFixedRouteNotifications();
            }
            if(!angular.isUndefined(vm.drtInfo)){
                vm.hasDRT = true;
                getDRTNotifications();
            }
        }
        
        function getFixedRouteNotifications() {
            vm.isFrNotificationLoading = true;
            NotificationService
                .getFixedRouteNotification()
            .then(function (response) {
                vm.frNotifications = response.data.notifications;
                angular.forEach(vm.frNotifications, function (notification) {
                    notification.Title = notification.linkTitle;
                    notification.Message = notification.text;
                });
                vm.isFrNotificationLoading = false;
            }, function (error) {
                vm.isFrNotificationLoading = false;
            });
        }

        function getCommuterNotifications() {
            vm.isCommuterNotificationLoading = true;
            NotificationService
                .getCommuterNotifications()
             .then(function (response) {
                 vm.CommuterNotifications = response.data.result;
                 vm.isCommuterNotificationLoading = false;
             }, function (error) {
                 vm.isCommuterNotificationLoading = false;
             });
        };

        function getDRTNotifications() {
            vm.isDRTNotificationLoading = true;
            NotificationService
                .getDRTNotifications()
             .then(function (response) {
                 vm.DRTNotifications = response.data.result;
                 vm.isDRTNotificationLoading = false;
             }, function (error) {
                 vm.isDRTNotificationLoading = false;
             });
        };

    }
})();

(function () {
	"use strict";

	angular
        .module("oneMVApp")
        .directive("notificationItem", notificationItem);

	function notificationItem() {
		return {
			restrict: "E",
			scope: {
				data: "="
			},
			templateUrl: "app/modules/shared/notification/notification-item.component.html"
		};

	}
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('NotificationService', NotificationService);

    NotificationService.$inject = ['$http', '$q', 'env', 'authService', 'DivisionService'];

    function NotificationService($http, $q, env, authService, DivisionService) {

        var service = {
            getServiceAlerts: getServiceAlerts,
            getFixedRouteNotification: getFixedRouteNotification,
            getCommuterNotifications: getCommuterNotifications,
            getDRTNotifications: getDRTNotifications
        };
        return service;

        function getServiceAlerts() {
            var deferred = $q.defer();

            var route = authService.isLoggedIn() ? '/serviceAlertsForUser/' + authService.authentication.userId : '/serviceAlerts';

            var serviceUrl = env.commuterApiUrl + 'common/' + DivisionService.getDivisionId() + route + "?rnd=" + Date.parse(new Date());
            $http({
                method: 'GET',
                'url': serviceUrl
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;
        };
       
        function getFixedRouteNotification() {
            var deferred = $q.defer();
            $http({
                method: 'GET',
                'url': env.oneMVFixedRouteApiUrl + "notifications/" + DivisionService.getDivisionId()
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject();
            });
            return deferred.promise;
        }

        function getCommuterNotifications() {
            var deferred = $q.defer();
            var passengerId = authService.isLoggedIn() ? authService.authentication.passengerId : 0;
            var url = passengerId == 0
                ? env.oneMVApiUrl + "notifications/commuter/" + DivisionService.getDivisionId()
                : env.oneMVApiUrl + "notifications/commuter/" + DivisionService.getDivisionId() + '/' + passengerId;
            $http({
                method: 'GET',
                'url': url
            }).then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject();
            });
            return deferred.promise;
        }
        function getDRTNotifications() {
            var deferred = $q.defer();
            if (!authService.isLoggedIn())
                deferred.reject();
            else {
                var passengerId = authService.authentication.passengerId;
                var url = env.oneMVApiUrl + "notifications/DRT/" + DivisionService.getDivisionId() + '/' + passengerId;
                $http({
                    method: 'GET',
                    'url': url
                }).then(function (response) {
                    deferred.resolve(response);
                }, function (err) {
                    deferred.reject();
                });
            }
            return deferred.promise;
           
        }
    }
})();
(function () {
    'use strict';
    angular.module('oneMVApp')
        .controller('DisplayPushMessageController', DisplayPushMessageController);

    DisplayPushMessageController.$inject = ['$uibModalInstance','messageTitle','messageBody','messageType'];

    function DisplayPushMessageController($uibModalInstance, messageTitle, messageBody, messageType) {
        var vm = this;
        vm.messageType = messageType;
        vm.messageTitle = messageTitle;
        vm.messageBody = messageBody;
        console.log('modal', vm);
        vm.close = function () {
            $uibModalInstance.close({ 'result': 'ok' });
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('ChangePasswordController', ChangePasswordController);

    ChangePasswordController.$inject = ['$location',
        'authService', 'env', 'MessageService', 'DivisionService', 'PageService', 'PasswordService'];

    function ChangePasswordController($location,
                            authService, env, MessageService, DivisionService, PageService, PasswordService) {
        var vm = this;
        vm.changePassword = changePassword;
        vm.cancel = cancel;
        vm.divisionId = DivisionService.getDivisionId();
        vm.PageService = PageService;
        vm.PageService.setTitle('Change Password');
        vm.PageService.setHeadline('Update your password');
        function cancel() {
            $location.path('dashboard/');
        }
        function changePassword() {
            if (vm.newPassword !== vm.newPasswordRetype) {
                MessageService.showError("New Password and Retype Password do not match");
                vm.isClicked = !vm.isClicked;
                return;
            }
                //call one mv login
            var request = {
                UserName: vm.username,
                OldPassword: vm.oldPassword,
                NewPassword: vm.newPassword,
                DivisionId: vm.divisionId,
                PassengerId: authService.authentication.passengerId,
                Provider: 'MvLogin'
            }
            //will call a service
            PasswordService.ChangePassword(request).then(function (response) {
                vm.isClicked = !vm.isClicked
                if (response.data && response.data.result) {
                    if (response.data.result.ChangeStatus) {
                        MessageService.showSuccess("Password Changed successfully");
                        vm.oldPassword = "";
                        vm.newPassword = "";
                        vm.newPasswordRetype = "";
                    } else {
                        MessageService.showError(response.data.result.ChangeStatusDescription);
                    }
                }
            }, function errorCallback(error) {
                //call message service
                vm.isClicked = !vm.isClicked
                if (error)
                    MessageService.showError(error.Message);
            });
        }

        // Start of code for Ionic
        vm.ionicInclude = 'app/shared/profile/change-password.html';
        vm.ionicCustomClassName = 'ionic-onemv-login';
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = false;
        // End of code for Ionic

        function activate() {

        }

    }
})();
(function () {
	'use strict';

	angular
        .module('oneMVApp')
        .directive('homeAddressDirective', homeAddressDirective);

	homeAddressDirective.$inject = ['$window', 'DivisionService', 'LocationFactory', 'authService', 'ProfileService', 'CommonService', 'UtilityFactory', '$uibModalStack'];

	function homeAddressDirective($window, DivisionService, LocationFactory, authService, ProfileService, CommonService, UtilityFactory, $uibModalStack) {
		return {
			controller: homeAddressController,
			replace: true,
			restrict: 'E',
			scope: {
				HomeAddress: '=?data',
				invalid: '=?invalid'
			},
			templateUrl: 'app/modules/shared/profile/homeAddress.html'
		};
		
		function homeAddressController($scope, $uibModalStack) {
			// initialize bindings
			$scope.hasModalParent = $uibModalStack.getTop() !== undefined;
			$scope.loading = true;
			$scope.invalid = true;
			$scope.hasHomeAddress = false;
			$scope.isContainerManagingData = $scope.HomeAddress !== undefined;
            // If HomeAddress is passed from the caller, use it.
			$scope.HomeAddress = $scope.HomeAddress == null ? {} : $scope.HomeAddress;
			$scope.HomeAddressSearch = {};
			$scope.googleLocations = [];
			$scope.states = [];
			$scope.countries = [{ name: 'United States', code: 'USA' }];

			// initialize globals
			$scope.divisionId = DivisionService.getDivisionId();
			$scope.passengerId = authService.authentication.passengerId;
			$scope.submitted = false;
			$scope.AddEdit = true;
			$scope.zipcode = "";
			$scope.stateabbr = "";
			$scope.isValidZip = false;
			$scope.allowEditHomeAddress = false;
			$scope.showHomeAddress = false;
			$scope.dataServiceTo = LocationFactory.dataServiceTo;

			// populate States list
			CommonService.GetAllStates().then(
				function (result) {
					$scope.states = result;
				},
				function (err) {
					UtilityFactory.toastError('', "Could not load states list. Please try again later.")
				});

			// return user to previous screen
			$scope.Cancel = function () {
				$uibModalStack.dismissAll();
				$window.history.back();
			};

			// user selected a home location
			$scope.SelectedHomeAddress = function (location) {
				// remember suite
				var suite = $scope.HomeAddressSearch.Suite;

				// set home location
				$scope.HomeAddressSearch = angular.copy(location);
				$scope.HomeAddressSearch.Suite = suite;

				// get the state Id
				$scope.HomeAddressSearch.StateId = $scope.states.filter(function (s) { return s.Abbr == location.State })[0].Id;
				$scope.HomeAddress = angular.copy($scope.HomeAddressSearch);

				// click the list radio button for this address
				$scope.HomeAddressGooglePlaceId = location.GooglePlaceId;

				$scope.invalid = false;
			}

			// search for home locations based on user input to search fields
			$scope.GoogleSearch = function () {
				$scope.invalid = true;
				$scope.googleLocations = [];
				UtilityFactory.toastInfo("Home Address - Search", "Searching for matching addresses. Please wait.");
				var state = $scope.states.filter(function (s) { return s.Id == $scope.HomeAddressSearch.StateId; })[0];
				var searchString = ($scope.HomeAddressSearch.Address || "") + ', ' + ($scope.HomeAddressSearch.City || "") + ', ' + ((state && state.Abbr) || "") + ', ' + ($scope.HomeAddressSearch.Zip || "");
				LocationFactory.getLocations(searchString, true, $scope.divisionId, $scope.passengerId, true).then(function (locations) {
					// convert Google location search to OneMV Location object
					for (var l = 0; l < locations.data.length; l++) {
						var address = locations.data[l].loc;
						var location = {};
						var add = "", streetNumber = "", streetName = "";
						for (var i in address.address_components) {
							var addressComponent = address.address_components[i];
							if (addressComponent.types[0] == "street_number") {
								streetNumber = addressComponent.short_name;
							}
							else if (addressComponent.types[0] == "route") {
								streetName = addressComponent.short_name;
							}
							else if (addressComponent.types[0] == "locality") {
								location.City = addressComponent.short_name;
							}
							else if (addressComponent.types[0] == "administrative_area_level_1") {
								location.State = addressComponent.short_name;
							}
							else if (addressComponent.types[0] == "postal_code") {
								location.Zip = addressComponent.short_name;
							}
							else {
								//do nothing
								var t = addressComponent;
							}
						}
						location.Address = streetNumber + ' ' + streetName
						location.Name = address.formatted_address;
						location.Latitude = address.geometry.location.lat;
						location.Longitude = address.geometry.location.lng;
						location.GooglePlaceId = address.place_id;

						$scope.googleLocations.push(location);
					}

					if ($scope.googleLocations.length == 0) {
						AddressNotFound();
					} else {
						$scope.hasHomeAddress = true; //assume user will choose a home address
					}
				}, function (err) {
					AddressNotFound();
				});
			};

			// user message if no addresses are found
			function AddressNotFound() {
				UtilityFactory.toastError('Find Home Address', "Home location not found. Please change address and try again.")
			}

			// update home address
			$scope.UpdateHomeAddress = function () {
				ProfileService.UpdateHomeAddress($scope.passengerId, $scope.HomeAddress)
					.then(
					function (response) {
						var message = response.data.result;
						if (response.data.status == 1) {
							$scope.submitted = true;
							UtilityFactory.toastSuccess('Success', message);
							setTimeout(function () {
								if ($scope.hasModalParent) {
									$uibModalStack.dismissAll();
								} else {
									$window.history.back();
								}
							}, 0);
						} else {
							UtilityFactory.toastError('Error', message);
						}
					},
					function (err) {
						var message = err.data.Result;
						UtilityFactory.toastError('Error', message);
					});
			};

			var activate = function () {
				// determine if home location should be displayed
			    $scope.showHomeAddress = ProfileService.ShowHomeAddress();
			    if ($scope.showHomeAddress) {
					// determine if passenger may edit home location
					$scope.allowEditHomeAddress = ProfileService.AllowEditHomeAddress();
				}

			    // read current passenger home address if not in the Profile page
				if (!$scope.isContainerManagingData) {
				    ProfileService.GetHomeAddress($scope.passengerId)
					.then(function (response) {
					    $scope.HomeAddress = response == null ? {} : response;
					    $scope.invalid = false;
					},
					function (err) {
					    $scope.error = err.error_description;
					});
				} 
			};

			// update the Suite separately
			$scope.isUpdatingSuite = false;
			$scope.$watch(
			"HomeAddressSearch.Suite",
			function () {
				$scope.isUpdatingSuite = true;
				$scope.HomeAddress.Suite = $scope.HomeAddressSearch.Suite;
			}, true);

			// HomeAddress is loaded either from the containing page, or from this control
			$scope.$watch(
			"HomeAddress", 
            
			function (source, data) {
			    if ($scope.isUpdatingSuite == true) {
			        $scope.isUpdatingSuite = false;
			    }
			    $scope.hasHomeAddress = false;
			    $scope.HomeAddressSearch = {};
			    if ($scope.HomeAddress) {
			        $scope.hasHomeAddress = $scope.HomeAddress.GooglePlaceId;
			        $scope.HomeAddressSearch = angular.copy($scope.HomeAddress);
			        if ($scope.HomeAddress && $scope.HomeAddress.GooglePlaceId) {
			            // initialize globals
			            $scope.googleLocations = [];

			            // load and select the current home address, if any
			            if ($scope.HomeAddress && $scope.HomeAddress.GooglePlaceId && $scope.HomeAddress.GooglePlaceId != "") {
			                $scope.googleLocations.push($scope.HomeAddress);
			                $scope.invalid = false;
			            }

			            $scope.loading = false;
			        }
			    }
				
			}, true);

			
		    //
		    // $onInit does not work in Ionic world.
		    // must execute activate() otherwise, add function to $onInit.
		    //
			if ($('body').hasClass('is-ionic')) {
			    $(document).ready(function () {
			        activate();
			    })
			} else {
			    this.$onInit = activate;
			}
		}
	}
})();

(function () {
	'use strict';

	angular
        .module('oneMVApp')
        .controller('ProfileController', ProfileController);

	ProfileController.$inject = ['$scope', '$rootScope', '$location', '$window', 'DivisionService', 'LocationFactory', 'authService', 'ProfileService', 'CommonService', 'UtilityFactory', 'LocationService', 'MessageService', 'RedirectionService','PageService'];

	function ProfileController($scope, $rootScope, $location, $window, DivisionService, LocationFactory, authService, ProfileService, CommonService, UtilityFactory, LocationService, MessageService, RedirectionService, PageService) {
		// initialize globals
		var vm = this;
		vm.PageService = PageService;
        vm.PageService.setTitle('Profile');
        vm.PageService.setHeadline('Latest Service Updates');
		vm.loading = true;
		vm.invalid = true;
		vm.passenger = {};
		vm.passenger.HomeAddress = {};
		vm.passengerId = authService.authentication.passengerId;
		vm.divisionId = DivisionService.getDivisionId();
		vm.submitted = false;

		// update profile
		vm.Cancel = function () {
			$window.history.back();
		};

		vm.UpdateProfile = function () {
			// update home address
			ProfileService.UpdateProfile(vm.passenger)
                .then(
                function (response) {
                	var message = response.data.result;
                	if (response.data.status == 1) {
                		vm.submitted = true;
                		UtilityFactory.toastSuccess('Success', message);
                		setTimeout(function () {
                			$window.history.back();
                		}, 0);
                	} else {
                		UtilityFactory.toastError('Error', message);
                	}
                },
                function (err) {
                	var message = err.data.Result;
                	UtilityFactory.toastError('Error', message);
                });
		};

		var activate = function () {
			if (!authService.isLoggedIn()) {
				RedirectionService.save('/shared/profile');
				$location.path('login');
			} else {
				vm.showHomeAddress = ProfileService.ShowHomeAddress();
				if (vm.showHomeAddress) {
					// determine if passenger may edit home location
				    vm.allowEditHomeAddress = ProfileService.AllowEditHomeAddress();
				}

				// read current passenger profile info
				ProfileService.GetProfile(vm.passengerId).then(function (response) {
				    vm.passenger = response;
				    vm.loading = false;

				},
				function (err) {
					vm.error = err.error_description;
					vm.loading = false;
				});
			}
		};
	    //
	    // $onInit does not work in Ionic world.
	    // must execute activate() otherwise, add function to $onInit.
	    //
		if ($('body').hasClass('is-ionic')) {
		    $(document).ready(function () {
		        activate();
		    })
		} else {
		    vm.$onInit = activate;
		}

		// Start of code for Ionic
		vm.ionicInclude = 'app/shared/profile/profile.html';
		vm.ionicCustomClassName = 'ionic-profile card';
		vm.ionicHideNavBar = false;
		vm.ionicUseRefresher = false;
		// End of code for Ionic
	}
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('SettingsController', SettingsController);

    SettingsController.$inject = ['$rootScope', 'SettingsService', 'authService', 'UtilityFactory', 'PageService'];

    function SettingsController($rootScope, SettingsService, authService, UtilityFactory, PageService) {
        var vm = this;
        vm.isSettingsLoading = false;
        vm.isSettingsLoaded = false;
        vm.isSettingsUpdating = false;
        vm.settings = null;
        vm.updateSettings = updateSettings;
        vm.PageService = PageService;
        vm.PageService.setTitle('Settings');
        vm.PageService.setHeadline('Manage App Settings');
        
        function activate() {
            getSettings();
        }
        
        function getSettings() {
            vm.isSettingsLoading = true;
            vm.isSettingsLoaded = false;
            SettingsService
               .getSettings(authService.authentication.passengerId)
           .then(function (response) {
               if (response && response.length > 10)
                   response = response.substring((response.length-10));
               vm.clientTelephone = response;
               vm.isSettingsLoading = false;
               vm.isSettingsLoaded = true;
           }, function (error) {
               vm.isSettingsLoading = false;
           });
        }

        function updateSettings() {
            vm.isSettingsUpdating = true;
            var mobileNo = vm.clientTelephone;
            if (mobileNo != "" && !isNaN(mobileNo) && mobileNo > 0) {
                mobileNo = "+1" + mobileNo;
                var settings = {
                    "PassengerId": authService.authentication.passengerId,
                    "ClientTelephone": mobileNo
                }
                SettingsService
                   .updateSettings(settings)
               .then(function (response) {
                   if (response) {
                       UtilityFactory.toastSuccess('Success', 'Settings updates sucessfully');
                   } else {
                       UtilityFactory.toastError('Error', 'Could not update settings');
                   }
                   vm.isSettingsUpdating = false;
                   getSettings();
               }, function (error) {
                   UtilityFactory.toastError('Error', 'Could not update settings');
                   vm.isSettingsUpdating = false;
                   getSettings();
               });
            } else {
                UtilityFactory.toastError('Error', 'Please enter a valid number');
                vm.isSettingsUpdating = false;
            }
        }

        activate();
        // Start of code for Ionic
        vm.ionicInclude = 'app/shared/settings/settings.html';
        vm.ionicCustomClassName = 'ionic-settings';
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = true;
        vm.ionicPullingText = 'Refresh Settings';
        vm.ionicRefreshingText = 'Loading Settings';
        vm.ionicSpinner = 'spiral'; // none to disable.
        vm.refresh = function (refresher) {
            activate();
            $rootScope.$broadcast('scroll.refreshComplete');
        }
        // End of code for Ionic
    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('SettingsService', SettingsService);

    SettingsService.$inject = ['$http', '$q', 'env'];

    function SettingsService($http, $q, env) {
        var service = {
            getSettings: getSettings,
            updateSettings: updateSettings
        };

        return service;

        function getSettings(passengerId) {
            var deferred = $q.defer();
            //get the base url from config.
            var serviceUrl = env.oneMVApiUrl + "passenger/" + passengerId + '/settings' + "?rnd=" + Date.parse(new Date());
            $http.get(serviceUrl)
            .then(function (response) {
                if (response && response.data && response.data.status == 1)
                    deferred.resolve(response.data.result);
                else
                    deferred.reject(response.data.errors);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;
        }


        
        function updateSettings(settings) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiUrl + 'passenger/settings';
            $http.post(serviceUrl, settings)
            .then(function (response) {
                if (response && response.data && response.data.status == 1)
                    deferred.resolve(response.data.result);
                else
                    deferred.reject(response.data.errors);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('SupportController', SupportController);

    SupportController.$inject = ['$rootScope', '$location', 'DynamicContentService', 'PageService'];

    function SupportController($rootScope,$location, DynamicContentService, PageService) {
        var vm = this;
        vm.PageService = PageService;
        vm.PageService.setTitle('Support');
        vm.PageService.setHeadline('FAQ');
        
        function getData() {
            DynamicContentService.getSupportFAQ().then(function (response) {
                if(response.data.status == 1)
                    vm.data = response.data.result.FAQContent;
            }, function (err) { 
                console.log('something is wrong');
            });
        }

        getData();
        // // Start of code for Ionic
        // vm.ionicInclude = 'app/shared/support/support.html';
        // vm.ionicCustomClassName = 'ionic-support card';
        // vm.ionicHideNavBar = false;
        // vm.ionicUseRefresher = true;
        // vm.ionicPullingText = 'Refresh Support';
        // vm.ionicRefreshingText = 'Loading Support';
        // vm.ionicSpinner = 'spiral'; // none to disable.
        // vm.refresh = function (refresher) {
        //     getData();
        //     $rootScope.$broadcast('scroll.refreshComplete');
        // }
        // // End of code for Ionic
    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('ExternalRegistrationController', ExternalRegistrationController);

    ExternalRegistrationController.$inject = ['$location', '$timeout', '$rootScope', 'vcRecaptchaService',
        'authService', 'VerificationService', 'env', 'DivisionService', 'ConfigFactory', 'RedirectionService', 'PageService'];

    function ExternalRegistrationController($location, $timeout, $rootScope, vcRecaptchaService, authService,
        VerificationService, env, DivisionService, ConfigFactory, RedirectionService, PageService) {

        var vm = this;

        var widgetId = -1;
        vm.captchaPublicKey = env.captchaPublicKey;
        vm.WidgetCreate = widgetCreate;
        vm.setCaptchaResponse = setCaptchaResponse;

        vm.isClicked = false;
        vm.savedSuccessfully = false;

        vm.organisationIdLabel = '';
        vm.showOrganisationId = false;
        vm.showAllowSms = false;
        vm.showFirstName = false;
        vm.showLastName = false;
        vm.showClientTelephone = false;
        vm.allowSms = false;
        vm.telNum = '';
        vm.clientPassengerId = '';
        vm.PageService = PageService;
        vm.PageService.setTitle('New Account');
        vm.PageService.setHeadline('Create a ONEMV Login');

        var feedType = '';
        var registrationFailedMsg = "Failed to register. Please try again later.";

        function setCaptchaResponse(response) {
            authService.verifyCaptcha(response).then(function (result) {
                if (!result.success)
                    vcRecaptchaService.reload(widgetId);
            },
                function (error) {
                });
        }

        function widgetCreate(_widgetId) {
            widgetId = _widgetId;
        }

        var activate = function () {
            var divisionId = DivisionService.getDivisionId();

            DivisionService.getDivisionInfo()
                   .then(function (response) {
                       feedType = response.data.result.DivisionFeedType.FeedType;
                   });

            vm.registerData = {
                userName: authService.externalAuthData.userName,
                provider: authService.externalAuthData.provider,
                externalAccessToken: authService.externalAuthData.externalAccessToken,                
                divisionId: divisionId,
                firstName: authService.externalAuthData.firstName,
                lastName: authService.externalAuthData.lastName
            };

            vm.firstName = vm.registerData.firstName;
            vm.lastName = vm.registerData.lastName;
            vm.provider = vm.registerData.provider;

            vm.PageService.setHeadline(vm.provider +' Sign Up');

            ConfigFactory
                .getDivisionParameters(divisionId)
                .then(function (params) {
                    if (params) {
                        vm.organisationIdLabel = params.OrganisationIdLabel ? params.OrganisationIdLabel : 'Client Passenger Id';
                        vm.showOrganisationId = params.ShowOrganisationId ? eval(params.ShowOrganisationId.toLowerCase()): false;
                        vm.showAllowSms = params.ShowAllowSms ? eval(params.ShowAllowSms.toLowerCase()): false;
                        vm.showFirstName = params.ShowFirstName ? eval(params.ShowFirstName.toLowerCase()) : false;
                        vm.showLastName = params.ShowLastName ? eval(params.ShowLastName.toLowerCase()) : true;
                        vm.showClientTelephone = params.ShowClientTelephone ? eval(params.ShowClientTelephone.toLowerCase()) : false;
                }
            });

        };

        activate();

        vm.cancel = function () {
            RedirectionService.redirectTo('dashboard/');
        }

        vm.registerExternal = function () {

            vm.message = '';
            vm.isClicked = true;            

            VerificationService
               .passengerExists(vm.clientPassengerId)
               .then(function (response) {

                   if (response.data.status != 1) {
                       vm.message = registrationFailedMsg;
                       vm.isClicked = false;
                       return;
                   }

                   if (feedType == 'FeedOnly' && !response.data.result) {
                       //can't register as passenger not found for division that is feed only/
                       vm.message = "Passenger not found.";
                       vm.isClicked = false;
                       return;
                   }

                   register(response.data.result);
               });
        };


        function register(divisionSupportsFeed) {

            var mobileNo = vm.telNum;
            if (mobileNo && mobileNo != '')
                mobileNo = "+1" + mobileNo;
          
            vm.registerData.telephoneNumber = mobileNo;
            vm.registerData.allowSms = vm.allowSms;
            vm.registerData.divisionSupportsFeed = divisionSupportsFeed;
            vm.registerData.clientPassengerId = vm.clientPassengerId;
            vm.registerData.firstName = vm.firstName;
            vm.registerData.lastName = vm.lastName;

            authService.registerExternal(vm.registerData).then(function (response) {
                vm.savedSuccessfully = true;
                startTimer();
            }, function (error) {
                vm.message = error.Message;
                vm.isClicked = false;
                vcRecaptchaService.reload(widgetId);
            });
        }



        var startTimer = function () {
            var timer = $timeout(function () {
                $timeout.cancel(timer);
                $rootScope.$broadcast('loggedIn', null);
                RedirectionService.redirect();
            }, 2000);
        }

        // Start of code for Ionic
        vm.ionicInclude = 'app/shared/registration/external-registration.html';
        //TODO Kevin. Please add correct custom class name.
        vm.ionicCustomClassName = 'ionic-template-external-registration';
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = false;
        vm.showRecaptcha = !env.isIonic;
        // End of code for Ionic
    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('OneMVRegistrationController', OneMVRegistrationController);

    OneMVRegistrationController.$inject = ['$location', '$scope', '$rootScope',
        'authService', 'env', 'MessageService', 'DivisionService', 'ConfigFactory', 'vcRecaptchaService','VerificationService', 'PageService'];

    function OneMVRegistrationController($location, $scope, $rootScope,
                            authService, env, MessageService, DivisionService, ConfigFactory, vcRecaptchaService, VerificationService, PageService) {
        var vm = this;
        vm.cancel = cancel;
        vm.register = register;        
        vm.captchaPublicKey = env.captchaPublicKey;
        vm.WidgetCreate = widgetCreate;
        vm.setCaptchaResponse = setCaptchaResponse;
        vm.message = '';        
        vm.organisationIdLabel = '';
        vm.showOrganisationId = false;
        vm.showAllowSms = false;
        vm.showFirstName = false;
        vm.showLastName = false;
        vm.showClientTelephone = false;
        var widgetId = -1;
        var divisionId = -1;
        var feedType = '';
        vm.clientPassengerId = '';
        vm.PageService = PageService;
        vm.PageService.setTitle('New Account');
        vm.PageService.setHeadline('Create a ONEMV Login');


        function cancel(){
            $location.path('dashboard/');
        }
        
        function setCaptchaResponse(response){
            authService.verifyCaptcha(response).then(function (result) {
                if(!result.success)
                    vcRecaptchaService.reload(widgetId);
            },
                function (error) {
            });
        }

        function widgetCreate(_widgetId){
            widgetId = _widgetId;
        }

        function register() {
            vm.message = '';
            vm.isClicked = true;
            VerificationService
               .passengerExists(vm.clientPassengerId)
               .then(function (response) {
                   if (response.data.status != 1) {
                       vm.message = "Failed to register. Please try again later.";
                       vm.isClicked = false;
                       return;
                   }

                   if (feedType == 'FeedOnly' && !response.data.result) {
                       //can't register as passenger not found for division that is feed only/
                       vm.message = "Passenger not found."
                       vm.isClicked = false;
                       return;
                   }

                   registerUser(response.data.result);
               });            
        }


        function registerUser(divisionSupportsFeed) {

            var mobileNo = vm.phoneNumber;
            if (mobileNo && mobileNo != '')
                mobileNo = "+1" + mobileNo;

            var registrationObject = {
                TelephoneNumber: mobileNo,
                AllowSMS: vm.sendSMS,
                UserName: vm.email,
                Password: vm.password,
                ConfirmPassword: vm.confirmPassword,
                ClientPassengerId: vm.clientPassengerId,
                DivisionId: divisionId,
                FirstName: vm.firstName,
                LastName: vm.lastName,
                Provider: 'MvLogin',
                DivisionSupportsFeed: divisionSupportsFeed
            };
            authService.registerOneMV(registrationObject).then(function (result) {
                $rootScope.$broadcast('loggedIn', null);
                $location.path('dashboard/');                
            }, function (error) {
                vm.message = error.Message;
                vm.isClicked = false;
                if (widgetId != -1) {
                    vcRecaptchaService.reload(widgetId);
                }                
            });
        }

        function activate() {

            divisionId = DivisionService.getDivisionId();


            DivisionService.getDivisionInfo()
         .then(function (response) {
             feedType = response.data.result.DivisionFeedType.FeedType;
         });


            ConfigFactory.getDivisionParameters(divisionId).then(function (params) {
                vm.organisationIdLabel = params.OrganisationIdLabel ? params.OrganisationIdLabel : 'Passenger Id';
                vm.showOrganisationId = params.ShowOrganisationId ? eval(params.ShowOrganisationId.toLowerCase()) : false;
                vm.showAllowSms = params.ShowAllowSms ? eval(params.ShowAllowSms.toLowerCase()) : false;
                vm.showFirstName = params.ShowFirstName ? eval(params.ShowFirstName.toLowerCase()) : false;
                vm.showLastName = params.ShowLastName ? eval(params.ShowLastName.toLowerCase()) : true;
                vm.showClientTelephone = params.ShowClientTelephone ? eval(params.ShowClientTelephone.toLowerCase()) : false;
            }, function (error) {
                vm.divisionHasFeed = false;
            });
        }

        activate();

        // Start of code for Ionic
        vm.ionicInclude = 'app/shared/registration/onemv-registration.html';
        vm.ionicCustomClassName = '';
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = false;
        vm.showRecaptcha = !env.isIonic;
        // End of code for Ionic


    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('VerificationController', VerificationController);

    VerificationController.$inject = ['$timeout', '$rootScope','authService', 'VerificationService', 'DivisionService', 'RedirectionService', 'PageService'];

    function VerificationController($timeout, $rootScope, authService, VerificationService,  DivisionService, RedirectionService, PageService) {

        var vm = this;

        vm.isClicked = false;
        vm.savedSuccessfully = false;
        vm.message = '';
        vm.code = '';
        vm.PageService = PageService;
        vm.PageService.setTitle('Verification');

        var activate = function () {
            vm.registerData = {
                userName: authService.externalAuthData.userName,
                provider: authService.externalAuthData.provider,
                externalAccessToken: authService.externalAuthData.externalAccessToken,
                divisionId: DivisionService.getDivisionId(),
                divisionSupportsFeed: false
            };
            vm.PageService.setHeadline('Verify your ' + authService.externalAuthData.provider +' account');
        };

        activate();

        vm.cancel = function () {
            RedirectionService.redirectTo('dashboard/');
        }

        vm.registerExternal = function () {
            vm.message = '';
            vm.isClicked = true;
            if (vm.code.trim() !== '')
                validate();
            else {
                vm.message = 'Validation code missing.';
                vm.isClicked = false;
            }
        };



        var validate = function () {
            VerificationService
                .validate(vm.code.trim())
                .then(function (res) {
                    if (res.data.status == 1)
                        register();
                    else {
                        vm.message = "Invalid code.";
                        vm.isClicked = false;
                    }
                }, function (response) {
                    vm.message = response.data.Message;
                    vm.isClicked = false;
                });
        }

        function register() {           
            authService.registerExternal(vm.registerData).then(function (response) {
                vm.savedSuccessfully = true;
                startTimer();
            }, function (error) {
                vm.message = "An error occured. Please try again later."
                vm.isClicked = false;
            });
        }



        var startTimer = function () {
            var timer = $timeout(function () {
                $timeout.cancel(timer);
                $rootScope.$broadcast('loggedIn', null);
                RedirectionService.redirect();
            }, 2000);
        }

        // Start of code for Ionic
        vm.ionicInclude = 'app/shared/verification/verification.html';
        vm.ionicCustomClassName = 'ionic-template-verification';
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = false;
        // End of code for Ionic
    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .factory('VerificationService', VerificationService);

    VerificationService.$inject = ['$http','$q','env','DivisionService'];

    function VerificationService($http, $q, env, DivisionService) {
        var service = {
            validate: validate,
            passengerExists: passengerExists
        };

        return service;

        function validate(key) {
            var deferred = $q.defer();
            //get the base url from config.
            var serviceUrl = env.oneMVApiUrl  + 'division/' + DivisionService.getDivisionId()
                                + '/Validate?key=' + key;
            $http.get(serviceUrl)
            .then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;
        }

        function passengerExists(clientPassengerId) {
            var deferred = $q.defer();
            var serviceUrl = env.oneMVApiOrgUrl + 'passenger/exists/' + DivisionService.getDivisionId() + '/' + clientPassengerId;
            $http.get(serviceUrl)
            .then(function (response) {
                deferred.resolve(response);
            }, function (err) {
                deferred.reject(err)
            });

            return deferred.promise;
        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('WhatsNewController', WhatsNewController);

    WhatsNewController.$inject = ['$rootScope','$location', 'DynamicContentService', 'PageService'];

    function WhatsNewController($rootScope, $location, DynamicContentService, PageService) {
        var vm = this;
        vm.PageService = PageService;
        vm.PageService.setTitle('Whats New');
        vm.PageService.setHeadline('Latest Service Updates');

        function getData() {
            DynamicContentService.getWhatsNewData().then(function (response) {
                vm.data = response.data.result;                
            });
        }

        getData();

        // Start of code for Ionic
        vm.ionicInclude = 'app/shared/whats-new/whats-new.html';
        vm.ionicCustomClassName = 'ionic-whats-new card';
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = true;
        vm.ionicPullingText = 'Refresh';
        vm.ionicRefreshingText = 'Loading';
        vm.ionicSpinner = 'spiral'; // none to disable.
        vm.refresh = function (refresher) {
            getData();
            $rootScope.$broadcast('scroll.refreshComplete');

        }
        // End of code for Ionic
    }
})();

(
    function () {
        'use strict';

        angular.module('oneMVApp')
        .controller('CommuterTripModalController', CommuterTripModalController);

        CommuterTripModalController.$inject = ['$uibModalInstance', '$uibModal', '$rootScope', 'tripId', 'authService',
            'MapService', 'ReservationService', 'MapIconService', 'vehicleService'];

        function CommuterTripModalController($uibModalInstance, $uibModal, $rootScope, tripId, authService,
             MapService, ReservationService, MapIconService, vehicleService) {

            var vm = this;
            var passengerId = authService.authentication.passengerId;
            var isModified = false;
            var markerEvents = [{ event: 'click', callback: iconClickHandler }];
            var noVehicle = { id: null, licenceplate: '--' };

            vm.show = false;
            vm.reservationInfo = {};
            vm.details = true;
            vm.markers = [];
            vm.cancel = cancelCommuterTrip;
            vm.modifyReservation = modifyReservation;            
            vm.close = close;
            vm.loading = true;
            vm.passengerVehicles = [];
            var existingVehicleId = undefined;
            vm.vehicleForReservation = undefined;
            vm.isWaitlisted = true;
            vm.selectedRating = 0;
            vm.canRateTrip = canRateTrip;
            vm.showRatingModal = showRatingModal;



            function showRatingModal() {
                if (!canRateTrip()) {
                    return false;
                }

                var modalInstance = $uibModal.open({
                    templateUrl: 'app/modules/commuter/modals/feedback-modal/commuter-feedback-modal.html',
                    controller: 'CommuterFeedbackModalController as vm',
                    resolve: {
                        feedbackInfo: function () {
                            return {
                                reservationId: vm.reservationInfo.id,
                                rating: vm.selectedRating,
                                comment: ''
                            }
                        }
                    }
                });

                modalInstance.result.then(function (result) {
                    if (!angular.isUndefined(result) && result.isSaved) {
                        getReservation(vm.reservationInfo.id);
                    }

                }, function () {
                    // dismiss
                });
            }

            function initializeMap() {
                vm.map = MapService.initializeMap();
            }

            function activate() {
                getReservation(tripId);
                initializeMap();
            }

            function setMapData() {
                buildQrCode();
                setMarkers();

                vm.loading = false;
            }

            function getReservation(reservationId) {

                ReservationService.getReservationById(passengerId, reservationId)
                .then(function (response) {
                    if (response.data.status === 1) {
                        vm.reservationInfo = response.data.result;
                        setWaitlistedStatus();
                        existingVehicleId = vm.reservationInfo.vehicleId;
                        vm.selectedRating = vm.reservationInfo.feedbackRating;
                        getPassengerVehicles();
                        setMapData();
                        canRateTrip();
                    }
                });
            }


            function canRateTrip() {                
                return vm.reservationInfo.feedbackRating == null || vm.reservationInfo.feedbackRating == undefined;
            }

            function setWaitlistedStatus() {
                vm.isWaitlisted = vm.reservationInfo.status == 'Waitlisted';
            }

            function getPassengerVehicles() {
                vehicleService.getVehiclesForPassenger(passengerId)
                .then(function (response) {
                    if (response.data.status === 1 && response.data.result.passengerVehicles != null)
                        vm.passengerVehicles = response.data.result.passengerVehicles;

                    if (vm.passengerVehicles.length > 0)
                        vm.passengerVehicles.splice(0, 0, noVehicle);
                    else
                        vm.passengerVehicles.push(noVehicle);

                    for (var i = 0; i < vm.passengerVehicles.length; i++) {
                        if (vm.passengerVehicles[i].id == existingVehicleId) {
                            vm.vehicleForReservation = vm.passengerVehicles;
                            break;
                        }
                    }


                }, function (error) {
                });
            }




            function buildQrCode() {
                var el = document.getElementById('ticketQRcode');

                var lqrcode = new QRCode(el, {
                    width: 100,
                    height: 100,
                    text: vm.reservationInfo.encryptedId,
                    correctLevel: 1,
                    useSVG: true
                });

            }

            activate();

            function cancelCommuterTrip() {
                var reservation =
               {
                   reservationId: vm.reservationInfo.id,
                   routeName: vm.reservationInfo.routeName,
                   passengerId: passengerId,
                   startTime: vm.reservationInfo.pickupTime,
                   reservationDate: vm.reservationInfo.reservationDate
               };

                var modalCancelReservation = $uibModal.open({
                    templateUrl: 'app/modules/commuter/modals/cancel-reservation-modal/cancel-reservation.html',
                    controller: 'CancelReservationController as vm',
                    size: '-fs',
                    backdrop: true,
                    ariaLabelledBy: 'Cancel reservation',
                    resolve: {
                        reservationInfo: function () {
                            return reservation;
                        }
                    }
                });
                modalCancelReservation.result.then(function (result) {
                    if (result.isCancel) {
                        $rootScope.$broadcast('reservationChanged');
                        $uibModalInstance.close({
                            'cancelled': true
                        });
                    }
                });
            }

            function modifyReservation() {
                var modifyReservationModal = $uibModal.open({
                    templateUrl: 'app/modules/commuter/modals/modify-reservation-modal/modify-reservation-pickup.html',
                    controller: 'ModifyReservationPickup as vm',
                    ariaLabelledBy: 'Modify reservation time',
                    backdrop: false,
                    size: '-fs',
                    resolve: {
                        reservation: function () {
                            return vm.reservationInfo;
                        }
                    }
                });

                modifyReservationModal.result.then(function (response) {
                    if (response.refresh) {
                        isModified = true;
                        getReservation(response.reservationId);
                    }

                }, function () {

                });
            }

            function iconClickHandler(model) {
                vm.show = true;
                vm.coords = model.coords;
            }

            function setMarkers() {
                vm.show = false;
                populateMarkers();
                MapService.setMapBounds(vm.markers, markerEvents);
            }


            function populateMarkers() {
                vm.markers.push({
                    latitude: vm.reservationInfo.pickupLatitude,
                    longitude: vm.reservationInfo.pickupLongitude,
                    icon: getMapIcon('pickup', vm.reservationInfo.scheduleType),
                    name: vm.reservationInfo.pickupStopName,
                    address: vm.reservationInfo.pickupAddress
                });

                vm.markers.push(
                    {
                        latitude: vm.reservationInfo.dropoffLatitude,
                        longitude: vm.reservationInfo.dropoffLongitude,
                        icon: getMapIcon('dropoff', vm.reservationInfo.scheduleType),
                        name: vm.reservationInfo.dropoffStopName,
                        address: vm.reservationInfo.dropoffAddress
                    });
            }

            function close() {
                $uibModalInstance.close({
                    'isModified': isModified
                });
            }

            function getMapIcon(stoptype, schedule) {
                if (stoptype === 'pickup') {
                    if (schedule === 'AM')
                        return MapIconService.getCommuterStopIcon();
                    else
                        return MapIconService.getCommuterHubIcon();
                }
                else {
                    if (schedule === 'PM')
                        return MapIconService.getCommuterStopIcon();
                    else
                        return MapIconService.getCommuterHubIcon();
                }

            }

        }
    })();

(function () {
    'use strict';

    angular
    .module('oneMVApp')
    .controller('TripDetailsModalController', TripDetailsModalController);

    TripDetailsModalController.$inject = ['$uibModalInstance', '$timeout', 'tripModalRequest', 'uiGmapIsReady', 'MapService', 'MapIconService'];

    function TripDetailsModalController($uibModalInstance, $timeout, tripModalRequest, uiGmapIsReady, MapService, MapIconService) {

        var vm = this;
        var markerEvents = [{ event: 'click', callback: iconClickHandler }];


        vm.show = false;
        vm.passengerTrip = tripModalRequest.passengerTrip;
        vm.options = typeof tripModalRequest.options == 'string' ? JSON.parse(tripModalRequest.options) : tripModalRequest.options;
        vm.serviceDate = tripModalRequest.serviceDate;
        
        vm.map = MapService.initializeMap();
       

        $timeout(function () {
            vm.markers = [];
            vm.markers.push({
                latitude: vm.passengerTrip.startLatitude,
                longitude: vm.passengerTrip.startLongitude,
                icon: MapIconService.getDrtPickupIcon(),
                name: vm.passengerTrip.startName,
                address : vm.passengerTrip.startAddress
            });
            vm.markers.push({
                latitude: vm.passengerTrip.endLatitude,
                longitude: vm.passengerTrip.endLongitude,
                icon: MapIconService.getDrtDropoffIcon(),
                name: vm.passengerTrip.endName,
                address: vm.passengerTrip.endAddress
            });

            MapService.setMapBounds(vm.markers,markerEvents);
        }, 1000);

        function iconClickHandler(model) {
            vm.show = true;
            vm.coords = model.coords;
        }
        vm.cancel = function cancelTrip() {
            $uibModalInstance.close({
                'action': 'cancel'
            });

        };
        vm.closeModal = function () {
            $uibModalInstance.close({
                'action': 'close'
            });
        };

        vm.displayRatingOption = function () {
            return vm.passengerTrip.Status === 'End' ||
                (vm.passengerTrip.Status === 'Reserved' && (vm.serviceDate > vm.passengerTrip.serviceDate));
        };
    }
})();
(function () {

    'use strict';

    angular.module('oneMVApp')
    .controller('PassengerTripsCtrl', PassengerTripsCtrl);

    PassengerTripsCtrl.$inject = ['$state', '$uibModal', 'authService', 'ReservationService', 'PageService',
     'LuumLinkedService','OneMvServices','ConfigFactory','DivisionService'];

    function PassengerTripsCtrl($state, $uibModal, authService, ReservationService, PageService,
         LuumLinkedService,OneMvServices,ConfigFactory,DivisionService) {
        var vm = this;
        vm.pastTrips = [];
        vm.futureTrips = [];
        vm.todaysTrips = [];
        
        vm.PageService = PageService;
        PageService.setTitle('Passenger Trips');
        PageService.setHeadline('My Trips');

        vm.addressRest = null;
        vm.centerLatLong;
        vm.onTripCancelled = onTripCancelled;
        vm.showTripDetails = showTripDetails;

        var options = {};
        options.reservationType = 'current';
        options.OperatorId = '';
        options.isPassenger = true;
        options.reloadTrips = false;

        var divisionId = DivisionService.getDivisionId();
        var passengerId = authService.authentication.passengerId;
        vm.currentPassenger = { "Id": passengerId }; 
        
        
        if (!authService.isLoggedIn())
            $state.go('login');

        vm.commuterInfo = OneMvServices.getCommuterInfo();
        vm.drtInfo = OneMvServices.getDrtInfo();    

        vm.hasCommuter = !angular.isUndefined(vm.commuterInfo);
        vm.hasDrt = !angular.isUndefined(vm.drtInfo);
        
        vm.loading = true;        
        vm.totalTripsCount = 0;
    
        activate();

        function activate() {
            LuumLinkedService.verify(authService.authentication.passengerId);
            populateDivisionParameters();
            getUpcomingTrips();
        }

        function getUpcomingTrips() {
            ReservationService.getAllReservationsForPassenger(passengerId)
                .then(function (response) {
                    if (response.data.status === 1) {
                        populateTrips(response.data.result.reservations);
                    }
                    vm.loading = false;
                },
                    function () {
                        vm.loading = false;
                    });
        }

        function populateTrips(trips) {
            vm.pastTrips = [];
            vm.futureTrips = [];
            vm.todaysTrips = [];
            vm.totalTripsCount = 0;

            if (!trips) return;            

            vm.totalTripsCount = trips.length;

            for (var i = 0; i < trips.length; i++) {
                var trip = trips[i];                    
                var compare = moment().dayOfYear() - moment(trips[i].reservationDate).dayOfYear();

                if (compare > 0)
                    vm.pastTrips.push(trip);
                else if (compare < 0)
                    vm.futureTrips.push(trip);
                else
                    vm.todaysTrips.push(trips[i]);
            }
        }

        function showTripDetails(trip) {
            var commuterTripModal = $uibModal.open({
                animation: true,
                templateUrl: 'app/modules/shared/trips/commuter-trip-modal.html',
                controller: 'CommuterTripModalController as vm',
                size: '-fs',
                backdrop: false,
                keyboard :true,
                resolve: {
                    tripId: trip.id
                }
            });

            commuterTripModal.result.then(function (response) {
                if (response.cancelled || response.isModified) {
                    getUpcomingTrips();
                }
            });
        }     

        function populateDivisionParameters() {
            ConfigFactory.getDivisionParameters(divisionId)
            .then(function (params) {
            
                options.promiseWindow = params.PromiseWindow;
                options.DivisionId = divisionId;
                options.batchDays = params.BatchDays ? eval(params.BatchDays) : 7;
                options.minFromDays = params.MinFromDays ? eval(params.MinFromDays) : 30;
                options.isAdvancedReservation = params.AllowAdvancedReservation ? eval(params.AllowAdvancedReservation.toLowerCase()) : false;
                options.showCancelOptions = params.CancelReasonRequired ? eval(params.CancelReasonRequired.toLowerCase()) : false;
                options.allowFaring = params.AllowFaring ? eval(params.AllowFaring.toLowerCase()) : false;
                options.allowLocationNotes = params.AllowLocationNotes ? eval(params.AllowLocationNotes) : false;
                options.allowChildren = params.AllowChildren ? eval(params.AllowChildren) : false;
                options.allowMultipleSeatBooking = params.AllowMultipleSeatBooking ? eval(params.AllowMultipleSeatBooking.toLowerCase()) : false;

        });
            vm.userReservationOptions = options;
        }

        function onTripCancelled() {}

        // Start of code for Ionic
        vm.ionicOnTouch = function () {
            // Need to resize the screen if one of the trip cards is clicked.
            $rootScope.$broadcast('ionicScrollResize', { action: 'resize' })
        }
        vm.ionicInclude = 'app/modules/on-demand/trips/my-trips.html';
        vm.ionicCustomClassName = 'ionic.my-trips';
        vm.ionicHideNavBar = false;
        vm.ionicUseRefresher = true;
        vm.ionicPullingText = 'Refresh Trips';
        vm.ionicRefreshingText = 'Loading Trips';
        vm.ionicSpinner = 'spiral'; // none to disable.
        vm.refresh = function (refresher) {
            //
            // change this flag to trigger the my-trips directive to reload.
            //
            options.reloadTrips = !options.reloadTrips;
            $rootScope.$broadcast('scroll.refreshComplete');
        }

    }

})();
(function () {
    'use strict';

    angular.module("oneMVApp").directive('tripCardDirective', tripCardDirective);
    tripCardDirective.$inject = ['$uibModal', 'UtilityFactory'];
    function tripCardDirective($uibModal, UtilityFactory) {
        var directive = {
            controller: controller,
            restrict: 'E',
            link: link,
            replace: true,
            scope: {
                trip: '@',
                options: '@',
                tripType: '@',
                divisionServiceDate: '=',
                allowTripRating: "=",
                notifyOnCancel: "=onTripCancel"
            },
            templateUrl: 'app/modules/shared/trips/tripCard.html'
        };
        return directive;

        function link(scope, element, attrs) {
            
           scope.$watch('trip', function (newValue, oldValue) {
                if (newValue != oldValue) {
                    if (typeof newValue == "string")
                        scope.passengerTrip = JSON.parse(newValue);
                    else if (typeof newValue == "object")
                        scope.passengerTrip = newValue;
                   
                }
            });

        }
        
        function controller($scope) {
            $scope.passengerTrip = JSON.parse($scope.trip);
            $scope.opts = JSON.parse($scope.options);
            $scope.serviceDate = $scope.divisionServiceDate;

            $scope.detailsModal = function () {
               var tripDetail =  $uibModal.open({
                    templateUrl: 'app/modules/shared/trips/drt-trip-modal.html',
                    controller: 'TripDetailsModalController as vm',
                    size: '-fs',
                    backdrop: false,
                    resolve: {
                        tripModalRequest : function()
                        {
                            return {
                                passengerTrip: $scope.passengerTrip,
                                options: $scope.options,
                                serviceDate: $scope.serviceDate
                            }
                        }
                    }
               });

               tripDetail.result.then(function (result) {
                   if(result && result.action === 'cancel')
                   {
                       $scope.cancel($scope.passengerTrip);
                   }
               });
            };
           
       
            $scope.getDisplayStatus = function (status) {
                var result = status;

                switch (status) {
                    case 'Cancel':
                        result = 'Cancelled';
                        break;
                    case 'No-show':
                        result = 'No show';
                        break;
                    case 'Un-scheduled':
                        result = 'Reserved';
                        break;
                }

                return result;
            };

            $scope.cancel = function (trip) {
                var tripToCancel = {
                    'tripId': trip.TripId,
                    'passengerId': trip.PassengerId,
                    'from': trip.startName,
                    'to': trip.endName,
                    'scheduledTime': trip.schedPickupTime
                };

                var modalCancelTrip = $uibModal.open({
                    animation: true,
                    templateUrl: 'app/modules/on-demand/activeTrip/trip-cancellation-prompt.html',
                    controller: 'TripCancellationController as vm',
                    size: '-fs',
                    resolve: {
                        tripToCancel: function () {
                            return tripToCancel;
                        },
                        showCancelOptions: $scope.opts.showCancelOptions

                    }
                });
                modalCancelTrip.result.then(function (result) {
                    if (result.isCancel) {
                        UtilityFactory.toastSuccess("Success!", "Trip cancelled");
                        if (typeof ($scope.notifyOnCancel) == 'function') {
                            $scope.notifyOnCancel();
                        }

                    }
                    else
                        UtilityFactory.toastError("Error!", "Unable to cancel the trip.");
                });
            };
        }
    }
})();
(function () {
    'use strict';

    angular.module('oneMVApp')
    .directive('mvPassengerTrips', userReservationsDirective);

    userReservationsDirective.$inject = ['$filter', '$interval', '$uibModal',
        'UtilityFactory', 'ScheduleService', 'DivisionService', 'PageService'];

    function userReservationsDirective( $filter,  $interval, $uibModal, 
        UtilityFactory, ScheduleService,  DivisionService) {
        var directive = {
            controller: controller,
            link: link,
            restrict: 'E',
            replace: false,
            scope: {
                passenger: '@',
                newTrip: '@',
                options: '@',
                divisionId: '@',
                notifyTripCancelled: '=onTripCancelled',
                allowTripRating: "="
            },
            templateUrl: 'app/modules/shared/trips/userReservations.html'
        };
        return directive;

        function link(scope, element, attrs) {
            // This is here to trigger scope.init() when this event first occurs.
            // In the Mobile App, 'options' gets loaded so fast that by the time
            // the $watch('options') occurs, the value is the same.
            var initialRun = true; 
            scope.$watch('options', function (newValue, oldValue) {
                if (newValue != oldValue || initialRun) {
                    if (typeof newValue == "string")
                        scope.opts = JSON.parse(newValue);
                    else if (typeof newValue == "object")
                        scope.opts = newValue;
                    initialRun = false;
                    scope.init();
                }
            });
         
        }

        function controller($scope, OneMvServices) {
            var divisionId = undefined;
            var operatorId = undefined;
            var batchDays = 7; //get from system params
            var minFromDays = 30;
            var dateFormat = 'MM-DD-YYYY';
            $scope.isCancelling = false;
            $scope.loading = true;
            var autoRefresh = undefined;
            var autoRefreshActiveTrip = undefined;
            $scope.showTabs = false;

            $scope.commuterInfo = OneMvServices.getCommuterInfo();
            $scope.drtInfo = OneMvServices.getDrtInfo();    

            $scope.opts = undefined;

            $scope.activeTrip = {
                TripId: null
            };

            $scope.passengerFutureTrips = [];
            $scope.passengerPastTrips = [];
            $scope.passengerActiveTrips = [];

            if ($scope.passenger != '') {
                var pass = JSON.parse($scope.passenger);
                $scope.passengerId = pass ? pass.Id : undefined;
            }            
            $scope.showTabs = !angular.isUndefined($scope.commuterInfo) && !angular.isUndefined($scope.drtInfo);            
            $scope.getDisplayStatus = function (status) {
                var result = status;

                switch (status) {
                    case 'Cancel':
                        result = 'Canceled'
                        break;
                    case 'No-show':
                        result = 'No Show'
                        break;
                }

                return result;
            };

            $scope.activate = function (passenger) {
                $scope.passengerId = passenger.Id;
                $scope.loading = true;
                
                getServiceDateByDivision();
            };

            $scope.displayRatingOption = function (passengerTrip) {
                return passengerTrip.Status === 'End' ||
                    (passengerTrip.Status === 'Reserved'
                    && ($scope.serviceDate > passengerTrip.serviceDate));
            };

            $scope.cancel = function (trip) {
              
                var tripToCancel = {
                    'tripId': trip.TripId,
                    'passengerId': trip.PassengerId,
                    'from': trip.startName,
                    'to': trip.endName,
                    'scheduledTime': trip.schedPickupTime
                };

                var modalCancelTrip = $uibModal.open({
                    animation: true,
                    templateUrl: 'app/modules/on-demand/activeTrip/trip-cancellation-prompt.html',
                    controller: 'TripCancellationController as vm',
                    size: '-fs',
                    backdrop: false,
                    resolve: {
                        tripToCancel: function () {
                            return tripToCancel;
                        },
                        showCancelOptions: $scope.opts.showCancelOptions

                    }
                });
                modalCancelTrip.result.then(function (result) {
                    if (result.isCancel) {
                        UtilityFactory.toastSuccess("Success!", "Trip cancelled");
                        getTripsForPassenger(null, true);
                    }
                    else
                        UtilityFactory.toastError("Error!", "Unable to cancel the trip.");
                });
            };


            $scope.init = function () {
                $scope.loading = true;
                $scope.isPassenger = $scope.opts.isPassenger;
                $scope.reservationType = $scope.opts.reservationType;
                divisionId = $scope.opts.DivisionId;
                operatorId = $scope.opts.OperatorId;
                batchDays = $scope.opts.batchDays;
                $scope.opts.autoRefresh = true;
                minFromDays = $scope.opts.minFromDays;
                
                $scope.isStartDp = false;
                $scope.isEndtDp = false;
                $scope.date = { 'from': undefined, 'to': undefined };
                $scope.minFromDateAllowed = undefined;
                $scope.maxFromDateAllowed = undefined;
                $scope.minToDateAllowed = undefined;
                $scope.maxToDateAllowed = undefined;
                $scope.showMap = [];
                if ($scope.isPassenger)
                    $scope.activate($scope.passenger);
            };

            function getServiceDateByDivision() {
                $scope.loading = true;
                ScheduleService.getServiceDateByDivision(divisionId)
                .then(function (response) {
                    if (response.data.status == 1) {
                        var serviceDate = response.data.result;
                        $scope.serviceDate = serviceDate;
                        setCalendarDates(serviceDate);
                        $scope.loading = false;
                        var callback = $scope.opts.autoRefresh ? setAutoRefresh : null;
                        getTripsForPassenger(callback);
                    }
                }, function errorCallback(response) {
                    $scope.loading = false;
                    UtilityFactory.toastError("Error!", "Failed to get Service Date.");
                });
            };


            function setAutoRefresh() {
                autoRefreshActiveTrip = $interval(function () {
                    getActiveTrip();
                }, 30000);
                autoRefresh = $interval(function () {
                    getTripsForPassenger();
                }, 60000);
            }

            function getActiveTrip(callback) {
                var pass = JSON.parse($scope.passenger);
                $scope.passengerId = pass ? pass.Id : undefined;
                
                ScheduleService.getlastripdetails($scope.passengerId, divisionId).then(function (response) {
                    if (response.data.status == 1) {
                       
                        if (!angular.isUndefined($scope.passengerFutureTrips)) {
                            var activeTrip = $filter('filter')($scope.passengerFutureTrips,
                                { TripId: response.data.result.TripID });
                            if (activeTrip.length > 0)
                                $scope.activeTrip = activeTrip[0];
                        }
                    }
                    else
                        $scope.activeTrip = {
                            TripId: null
                        };
                    if (callback)
                        callback();
                }, function () {
                });
            };


            function setCalendarDates(serviceDate) {

                if ($scope.isPassenger) {
                    if (!$scope.opts.isAdvancedReservation) {
                        $scope.date.to = moment(serviceDate).format(dateFormat);
                    }
                    else
                        $scope.date.to = moment(serviceDate).add(batchDays, 'd').format(dateFormat);

                    $scope.date.from = moment(serviceDate).add(-minFromDays, 'd').format(dateFormat);
                }
                else {
                    var selectedMomentDate = moment(serviceDate).format(dateFormat);

                    $scope.date.from = selectedMomentDate;
                    $scope.date.to = selectedMomentDate;

                    var maxToDate = moment(selectedMomentDate, dateFormat).add(batchDays, 'd');
                    $scope.minToDateAllowed = selectedMomentDate;
                    $scope.maxToDateAllowed = new Date(maxToDate);

                    var minFromDate = moment(selectedMomentDate, dateFormat).add(-minFromDays, 'd');
                    $scope.minFromDateAllowed = new Date(minFromDate);
                    $scope.maxFromDateAllowed = selectedMomentDate;
                }
            };

            $scope.onTripCancel = function () {
                getTripsForPassenger(null, true);
            }
            $scope.dateChanged = function () {
                var fromDate = $scope.date.from;
                $scope.minToDateAllowed = fromDate;
                if (isBefore($scope.date.to, $scope.date.from))
                    $scope.date.to = angular.copy($scope.date.from);

                getTripsForPassenger();
            };

            function isBefore(from, to) {
                var diff = new Date(from).getTime() <= new Date(to).getTime();
                return diff;
            };


            function getTripsForPassenger(callback, isFromCancel) {

                $scope.loading = true;
                var fromDate = $filter('date')($scope.date.from, 'yyyy-MM-dd');
                var toDate = $filter('date')($scope.date.to, 'yyyy-MM-dd');

                var pass = JSON.parse($scope.passenger);
                $scope.passengerId = pass ? pass.Id : undefined;
                ScheduleService.getPassengerTrips(divisionId, $scope.passengerId, fromDate, toDate)
                    .then(function (response) {

                        if (response.data.status == 1) {
                            mapTrips(response.data.result);

                        }
                        $scope.loading = false;
                        if (callback) {
                            getActiveTrip(callback)


                        }
                        else if (isFromCancel)
                            getActiveTrip();
                    }, function (errormsg) {
                        $scope.loading = false;
                        UtilityFactory.toastError('Error', errormsg.data);
                    });
            };

            function mapTrips(trips) {
                addPromiseWindowAndEpochToTrip(trips);

                $scope.passengerPastTrips = getTrips(trips, filterPastTrips, sortPastTrips);
                $scope.passengerFutureTrips = getFutureTrips(trips);//, filterFutureTrips, sortFutureTrips);
                
            };

            function getFutureTrips(trips) {
                var futureTrips = angular.copy(trips);

                for (var i = 0; i < $scope.passengerPastTrips.length; i++) {
                    var tripId = $scope.passengerPastTrips[i].TripId;
                    futureTrips = $filter('filter')(futureTrips, { TripId: '!' + tripId });
                }
                return futureTrips;

            }


            function sortFutureTrips(a, b) {
                return a.schedEpoch - b.schedEpoch;
            };

            function filterPastTrips(trip) {
                var currentDivisionEpoch = moment.tz(DivisionService.getTimeZone()).format('x');

                return trip.Status === 'Cancel'
                    || trip.Status === 'No-show'
                    || trip.Status === 'End'
                    || //trip.Status === 'Reserved' && 
                       trip.serviceDate < $scope.serviceDate;
            };

            function sortPastTrips(a, b) {
                return b.schedEpoch - a.schedEpoch;
            };



            function getTrips(trips, filter, sort) {

                var filtered = trips.filter(filter);

                if (filtered) {
                    filtered.sort(sort);
                }
                return filtered;
            }

            function mapPromiseWindowAndEpoch(trip) {
                var promiseWindow = $scope.opts.promiseWindow;
                trip.schedEpoch = moment.tz(trip.schedPickupTime, DivisionService.getTimeZone()).format('x');
                trip.estEpoch = moment.tz(trip.estimatedPickupTime, DivisionService.getTimeZone()).format('x');

                if (trip.estimatedPickupTime) {
                    //var pickupTime = trip.schedPickupTime;
                    //var promiseWindowsEndTime = DateFactory.getPromiseWindowEndTime(pickupTime, promiseWindow);
                    //trip.promiseWindowStartTime = $filter('date')(pickupTime, 'h:mm a');
                    //trip.promiseWindowEndTime = $filter('date')(promiseWindowsEndTime, 'h:mm a');

                    var startPickupWindowTime = new moment(trip.startPickupWindowTime);
                    var endPickupWindowTime = new moment(trip.endPickupWindowTime);
                    trip.promiseWindowStartTime = startPickupWindowTime.format('h:mm A');
                    trip.promiseWindowEndTime = endPickupWindowTime.format('h:mm A');

                    if (trip.vehicleLicense == null)
                        trip.vehicleLicense = "N/A";
                }
            };

            function addPromiseWindowAndEpochToTrip(trips) {


                for (var i = 0; i < trips.length; i++)
                    mapPromiseWindowAndEpoch(trips[i]);
            }


            function getMapInfo(trip) {
                var mapInfo =
                    {
                        'activeTripRunId': trip.RunId,
                        'FromLat': trip.startLatitude,
                        'FromLong': trip.startLongitude,
                        'ToLat': trip.endLatitude,
                        'ToLong': trip.endLongitude,
                        'tripId': trip.TripId
                    };

                return mapInfo;
            };


            $scope.addNewTrip = function (trip) {
                var tripDate = moment(trip.ScheduledPickupTime).format(dateFormat);
                //if new trip falls between existing selected dates 
                if (isBefore($scope.date.from, tripDate) && isBefore(tripDate, $scope.date.to))
                    getTripsForPassenger();
            };

            $scope.$on('$destroy', function (event) {
                if (angular.isDefined(autoRefresh)) {
                    $interval.cancel(autoRefresh);
                    autoRefresh = undefined;
                }




                if (angular.isDefined(autoRefreshActiveTrip)) {
                    $interval.cancel(autoRefreshActiveTrip);
                    autoRefreshActiveTrip = undefined;
                }

            });

        }
    }

})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('AddVehicleController', AddVehicleController);

    AddVehicleController.$inject = ['authService', 'vehicleService', '$uibModalInstance', 'atleastOneVehicleExist','$timeout'];

    function AddVehicleController(authService, vehicleService, $uibModalInstance, atleastOneVehicleExist,$timeout) {
        var vm = this;
        vm.vehicleInfo = undefined;
        vm.atleastOneVehicleExist = atleastOneVehicleExist;
        vm.message = '';
        vm.isSaving = false;
        vm.errorMessage = 'Add failed';
        vm.showMessage = false;
        var passengerId = authService.authentication.passengerId;        
        var isAdded = false;
        vm.maxYear = new Date().getFullYear() + 1;
        vm.isYearValid = isYearValid;

        function getDefaultVehicleInfo() {
            return {
                year: '',
                make: '',
                model: '',
                color: '',
                licencePlate: '',                
                isDefault: !vm.atleastOneVehicleExist,
                isActive: true
            };
        }

        function isYearValid() {
            if (vm.vehicleInfo.year !== '') {
                return vm.vehicleInfo.year >= '1930' && vm.vehicleInfo.year <= vm.maxYear;
            }
            return true;
        };

        function showMessage(msg) {
            vm.message = msg;
            vm.showMessage = true;
            $timeout(function () {
                vm.showMessage = false;
            }, 5000);
        };

        vm.save = function () {
            vm.isSaving = true;
            isAdded = false;
            if (isValid()) {
                vehicleService.save(vm.vehicleInfo, passengerId)
                .then(function (response) {
                    if (response.data && response.data.status == 1 && response.data.result > -1) {
                        vm.vehicleInfo.id = response.data.result;
                        //reset
                        vm.vehicleInfo = getDefaultVehicleInfo();
                        isAdded = true;
                        $uibModalInstance.close({ 'isAdded': isAdded });
                    }
                    else
                        showMessage(response.data.result);
                    vm.isSaving = false;
                }, function (error) {
                    showMessage(response.data.message);
                    vm.isSaving = false;
                });
            }
            else {
                showMessage("Invalid Input!");
                vm.isSaving = false;
            }
        }        

        function isValid() {
            return !(vm.vehicleInfo.color === '' || vm.vehicleInfo.color.trim() == ''
            || vm.vehicleInfo.licencePlate === '' || vm.vehicleInfo.licencePlate.trim() == ''
                || vm.vehicleInfo.make === '' || vm.vehicleInfo.make.trim() == ''
                || vm.vehicleInfo.model === '' || vm.vehicleInfo.model.trim() == ''
                || vm.vehicleInfo.year === '');
        };

        
        vm.cancel = function() {
            $uibModalInstance.close({'isAdded' : isAdded});
        };


        activate();

        function activate() {
            vm.vehicleInfo = getDefaultVehicleInfo();
        }

        
    }
})();

(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('CancelReservationController', CancelReservationController);

    CancelReservationController.$inject = ['$location', '$uibModalInstance', 'reservationInfo', 'ReservationService', 'StopDataService', 'MessageService'];

    function CancelReservationController($location, $uibModalInstance, reservationInfo, ReservationService, StopDataService, MessageService) {
        /* jshint validthis:true */
        var vm = this;
        vm.reservationInfo = reservationInfo;
        vm.routeName = vm.reservationInfo.routeName;
        vm.startTime = vm.reservationInfo.startTime;
        vm.reservationDate = moment(vm.reservationInfo.reservationDate).format('MM/DD/YYYY');
        vm.cancelError = false;
        vm.disable = false;
        vm.errorMessage = 'Sorry, we were unable to cancel this reservation.';    

        vm.cancelReservation = function () {
            vm.disable = true;
            if (vm.reservationInfo.reservationId) {
                ReservationService.cancelReservation(vm.reservationInfo.passengerId, vm.reservationInfo.reservationId)
                .then(function (response) {
                    if (response && response.data && response.data.status == 1) {
                        $uibModalInstance.close({ 'action': 'close', 'isCancel': true });
                    } else {
                        vm.cancelError = true;
                        if (response.data.result && response.data.message == 'Failure')
                            vm.errorMessage = response.data.result;
                    }
                    vm.disable = false;
                });
            } else {
                vm.cancelError = true;
            }
        };
        
        vm.cancel = function () {
            $uibModalInstance.dismiss('cancel');
        };

        this.MakeDisable = function () {
            if (vm.disable) {
                return true;
            }
            else {
                return false;
            }
        };
    }
})();



(function () {
    'use strict';

    var app = angular.module('oneMVApp');
    app.controller('CommuterFeedbackModalController', CommuterFeedbackModalController);

    CommuterFeedbackModalController.$inject = ['$uibModalInstance', 'UtilityFactory', 'ConfigFactory', 'FeedbackService', 'feedbackInfo'];

    function CommuterFeedbackModalController($uibModalInstance,UtilityFactory, ConfigFactory, FeedbackService, feedbackInfo) {
        var vm = this;
        vm.feedbackInfo = angular.copy(feedbackInfo);

        vm.cancel = cancel;
        vm.saveFeedback = saveFeedback;


        vm.disableSubmit = function () {
            return vm.feedbackInfo.rating <= 0 || vm.feedbackInfo.rating == null;
        };

        function cancel() {
            $uibModalInstance.close({isSaved:false});
        };

        function saveFeedback() {            

            FeedbackService
                .addCommuterFeedback(
                {
                    Comment: vm.feedbackInfo.comment.trim(),
                    Rating: vm.feedbackInfo.rating
                },
                                        vm.feedbackInfo.reservationId)
              .then(function (response) {
                if (response.data.status == 1) {
                    vm.isSaving = false;
                    UtilityFactory.toastSuccess("Success!", "Feedback saved successfully");
                    $uibModalInstance.close({isSaved :true});
                } else {
                    vm.isSaving = false;
                    UtilityFactory.toastError("Error!", "Could not save feedback");
                    console.log('Error: - ' + response.data.message);
                }
            }, function errorCallback(response) {
                vm.isSaving = false;
                UtilityFactory.toastError("Error!", "Could not save feedback");
                console.log('Error: - ' + response.data.message);
            });

        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('ModifyReservationPickup', ModifyReservationPickup);

    ModifyReservationPickup.$inject = ['$location', '$uibModalInstance', 'ReservationService',
        'vehicleService', 'DivisionService', 'authService', 'reservation'];

    function ModifyReservationPickup($location, $uibModalInstance, ReservationService,
        vehicleService, DivisionService,authService, reservation) {

        var vm = this;

        var passengerId = authService.authentication.passengerId;
        var newReservationInfo = undefined;
        var noVehicle = { id: null, licenceplate: '--' };

        vm.reservationInfo = reservation;
        vm.message = "";
        vm.isSaving = false;
        vm.currentTripId = vm.reservationInfo.tripId;
        vm.selectedTripId = vm.reservationInfo.tripId;
        vm.availableParking = 0;
        vm.selectedVehicleId = angular.copy(vm.reservationInfo.vehicleId);
        vm.divisionAllowsWaitlist = true;

        vm.manageVehicle = manageVehicle;
        vm.modifyTrip = modifyTrip;
        vm.cancel = cancel;

        function init() {

            DivisionService
               .isWaitlistAllowedByDivision()
           .then(function (response) {
               vm.divisionAllowsWaitlist = response;
           });

            getAlternateTrips();
            getPassengerVehicles();
        }

        function cancel() {
            $uibModalInstance.close({
                'action': 'close'
            });
        };

        function manageVehicle() {
            vm.message = "";

            ReservationService
                .manageParkingForReservation(passengerId, vm.reservationInfo.id, vm.selectedVehicleId)
            .then(function (response) {
                if (response.data.status == 0) {
                    var msg = response.data.result.message;
                    vm.message = msg;
                }
                else {
                    $uibModalInstance.close({
                        'action': 'close',
                        'refresh': true,
                        'reservationId': response.data.result.id
                    });
                }
            }, function (error) {

            });
        }

        function getAlternateTrips() {
            ReservationService
             .getAllTripsForCurrentReservation(vm.reservationInfo.id, passengerId)
                 .then(function (response) {
                     vm.trips = response.data.result.altTrips;
                     vm.availableParking = vm.trips[0].availableParking;
                 }, function (error) {

                 })
        }

        function getPassengerVehicles() {
            vehicleService.getVehiclesForPassenger(passengerId)
            .then(function (response) {
                if (response.data.status === 1 && response.data.result.passengerVehicles != null)
                    vm.passengerVehicles = response.data.result.passengerVehicles;

                if (vm.passengerVehicles.length > 0)
                    vm.passengerVehicles.splice(0, 0, noVehicle);
                else
                    vm.passengerVehicles.push(noVehicle);             

            }, function (error) {
            });
        }


        function modifyTrip() {
            vm.isSaving = true;
            vm.message = '';

            ReservationService
            .modifyReservation(vm.reservationInfo.id, vm.selectedTripId, passengerId)
            .then(function (response) {
                if (response.data.status == 0) {
                    vm.message = response.data.result.message;
                    vm.isSaving = false;
                }
                else {
                    vm.isSaving = false;
                    $uibModalInstance.close({
                        'action': 'close',
                        'refresh': true,
                        'reservationId': response.data.result.id
                    });
                }

            }, function (error) {
                vm.message = error;
                vm.isSaving = false;
            });
        }

        init();
    }
})();



(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('RemoveVehicleConfirmationController', RemoveVehicleConfirmationController);

    RemoveVehicleConfirmationController.$inject = ['$location','$uibModalInstance','vehicleService','id','authService'];

    function RemoveVehicleConfirmationController($location, $uibModalInstance, vehicleService, id, authService) {

        var vm = this;
        vm.isRemoving = false;

        vm.removeVehicle = function () {
            vm.isRemoving = true;
            vehicleService.removeVehicle(id, authService.authentication.passengerId)
                .then(function (response) {
                    if (response.data && response.data.status == 1)
                        $uibModalInstance.close({ removed: true });                    
                    else 
                        if (response.data.result && response.data.result !== '')
                            $uibModalInstance.close({ removed: false, errorMessage: response.data.result });
                }, function (err) {
                });
        };

        vm.cancel = function () {
            $uibModalInstance.dismiss({removed:false});
        };
    }
})();

(function () {
    'use strict';
    angular
        .module('oneMVApp')
        .controller('ReservationMapController', ReservationMapController);

    ReservationMapController.$inject = ['$scope', '$location', '$timeout', '$http', '$uibModalInstance','$interval',
        'GeoLocationService',  'StopDataService', 'uiGmapIsReady', 'LocationService', 'reservation_stops'];

    function ReservationMapController($scope, $location, $timeout, $http, $uibModalInstance, $interval,
        GeoLocationService, StopDataService,uiGmapIsReady, LocationService, reservation_stops) {
        var vm = this;
        vm.title = 'Schedule Stops';
        vm.mapControl = {};
        vm.stopMarker = [];
        var autoRefreshMarker = undefined;
        vm.map = {
            // http://angular-google-maps.org/use
            center: {
                latitude: 43.75514221191406,
                longitude: -116.57597351074219
            },
            zoom: 10,
            lineStyle: {
                color: '#333',
                weight: 5,
                opacity: 0.7
            }
        };
        vm.mapOptions = {
            mapTypeControl: false,
            zoomControl: false,
            streetViewControl: false

        };
        var myLocationPin = 'images/pin-my-location.png';
        vm.myLocationIcon = {
            url: myLocationPin,
            size: new google.maps.Size(42, 42),
            origin: new google.maps.Point(0, 0),
            anchor: new google.maps.Point(20, 20)
        };

        vm.reservationStops = reservation_stops;
        if (vm.reservationStops.id != null || vm.reservationStops.id != '')
        {
            if (vm.reservationStops.scheduleType == 'AM') {
                vm.icon = 'images/pin-busstop-green.svg'
                vm.hubIcon = 'images/pin-hub.svg'

                vm.stopMarker.push({
                    'stopId': vm.reservationStops.pickupStopId, 'stopName': vm.reservationStops.pickupStopName,
                    'latitude': vm.reservationStops.pickupLatitude, 'longitude': vm.reservationStops.pickupLongitude,
                    'icon': vm.icon, 'address': vm.reservationStops.pickupAddress
                });
                vm.stopMarker.push({
                    'stopId': vm.reservationStops.dropoffStopId, 'stopName': vm.reservationStops.dropoffStopName,
                    'latitude': vm.reservationStops.dropoffLatitude, 'longitude': vm.reservationStops.dropoffLongitude,
                    'icon': vm.hubIcon, 'address': vm.reservationStops.dropoffAddress
                });
            }
            else {
                vm.icon = 'images/pin-busstop-grey.svg'
                vm.hubIcon = 'images/pin-hub.svg'

                vm.stopMarker.push({
                    'stopId': vm.reservationStops.pickupStopId, 'stopName': vm.reservationStops.pickupStopName,
                    'latitude': vm.reservationStops.pickupLatitude, 'longitude': vm.reservationStops.pickupLongitude,
                    'icon': vm.hubIcon, 'address': vm.reservationStops.pickupAddress
                });
                vm.stopMarker.push({
                    'stopId': vm.reservationStops.dropoffStopId, 'stopName': vm.reservationStops.dropoffStopName,
                    'latitude': vm.reservationStops.dropoffLatitude, 'longitude': vm.reservationStops.dropoffLongitude,
                    'icon': vm.icon, 'address': vm.reservationStops.dropoffAddress
                });
            }            
        }
        else
        {
            return;
        }
        
        autoRefreshMarker = $interval(function () {
            getMyLocation();
        }, 10000);

        function getMyLocation()
        {            
          GeoLocationService.getCurrentPosition()            
            .then(function (position) {
                if (position == undefined || position == null)
                {
                    stopAutoRefreshMarker()
                    return;
                }
                vm.myLocation = {
                    "coords": {
                        "latitude": position.coords.latitude,
                        "longitude": position.coords.longitude
                    },
                    "icon": vm.myLocationIcon
                };
                
            }, function (err) {

            });
        }

        uiGmapIsReady.promise().then(function (maps) {
            google.maps.event.trigger(vm.mapControl.getGMap(), "resize");
            
            var bounds = new google.maps.LatLngBounds();

            angular.forEach(vm.stopMarker, function (stop) {
                bounds.extend(new google.maps.LatLng(stop.latitude, stop.longitude));
            });

            vm.mapControl.getGMap().fitBounds(bounds);
        });

        //marker click function
        vm.markerEvent = {
            click: function (gMarker, eventName, model) {
                if (model.$id) {
                    //navigateToSelectedStop(model.coords);
                    if (vm.selectedLocation)
                        StopDataService.setGeoLocation(vm.selectedLocation);
                    StopDataService.setStop(model.coords);
                    vm.coords = model.coords;
                    vm.show = true;
                }
            }
        };

        vm.cancel = function () {
            stopAutoRefreshMarker();
           $uibModalInstance.dismiss('cancel');
           vm.isDone = true;
       };

       function stopAutoRefreshMarker() {
           if (angular.isDefined(autoRefreshMarker)) {
               $interval.cancel(autoRefreshMarker);
               autoRefreshMarker = undefined;
           }
       };

       $scope.$on('$locationChangeStart', function (event) {
           stopAutoRefreshMarker();
       });
    }

})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('ReservationController', ReservationController);

    ReservationController.$inject = ['$location', '$uibModalInstance', 'reservationInfo', '$interval', '$rootScope',
        'isAdd', 'ReservationService', 'MessageService', 'vehicleService', 'StopDataService', 'DivisionService'];

    function ReservationController($location, $uibModalInstance, reservationInfo, $interval, $rootScope,
        isAdd, ReservationService, MessageService, vehicleService, StopDataService, DivisionService) {
        /* jshint validthis:true */
        var vm = this;
        vm.isAdd = isAdd;
        vm.disable = false;
        vm.isReserved = false;
        vm.hasVehicles = false;
        vm.needsParking = false;
        vm.vehicles = [];
        vm.selectedVehicle = undefined;
        vm.loadingVehicles = true;
        vm.isAMReservation = reservationInfo.scheduleType === "AM";
        vm.parkingNotAvailable = false;
        vm.noParkingMessage = "Parking not available.";
        vm.availableParkingSlots = 0;
        vm.isParkingAttachedToReservation = true;
        vm.reservationData = reservationInfo;
        vm.updateLabels = updateLabels;
        var availableSeats = 0;
        vm.divisionAllowsWaitlist = true;
        vm.numCompanions = [];
        vm.selectedCompanions = 0;


        var noVehicle = { 'licenceplate': '--', 'id': undefined };

        vm.reserve = reserve;

        var init = function () {

            DivisionService
               .isWaitlistAllowedByDivision()
           .then(function (response) {
               vm.divisionAllowsWaitlist = response;
               getAvailableSeats();
           }, function () {
               getAvailableSeats();
           });
        };


        function updateLabels() {

            if (!vm.divisionAllowsWaitlist)
                setReservationLabels();
            else {
                if (isParkingSelectedAndUnAvailable() || availableSeats < 1 + vm.selectedCompanions)
                    setWaitlistLabels();
                else
                    setReservationLabels();
            }
        }

        function isParkingSelectedAndUnAvailable() {
            if (!vm.isAMReservation) return false;

            return vm.selectedVehicle !== noVehicle
                    && vm.availableParkingSlots <= 0;
        }

        function getAvailableSeats() {
            ReservationService.getAvailableSeatsForTrip(reservationInfo.trip.tripId, Date.parse(reservationInfo.reservationDate))
                .then(function (response) {
                    getVehicles();
                    if (response.data.status === 1) {
                        availableSeats = response.data.result.availableCapacity;
                        if (response.data.result.allowedCompanions > 0){
                            for (var i = 0; i <= response.data.result.allowedCompanions; i++) {
                                vm.numCompanions.push(i);
                            }
                        }
                    }


                },
                    function error(response) {
                    });
        };

        function setReservationLabels() {
            vm.btnText = 'Reserve Seat';
            vm.modalText = 'Reserve a seat';
            vm.modalSuccessText = 'Reservation Created';
        }

        function setWaitlistLabels() {
            vm.btnText = 'Add To Waitlist';
            vm.modalText = 'Add to waitlist';
            vm.modalSuccessText = 'Added To Waitlist';
        }

        function getParkingInfo() {

            if (!vm.isAMReservation) {
                updateLabels();
                return;
            }

            StopDataService
                    .getAvailableParkingsForStop(reservationInfo.pickupStop.id, reservationTimespan())
                    .then(
                        function (response) {
                            if (response.data.status === 1) {
                                vm.availableParkingSlots = response.data.result;
                            }
                            if (vm.availableParkingSlots <= 0)
                                vm.parkingNotAvailable = true;

                            updateLabels();
                        },
                        function (error) {
                            MessageService.showInformation(error);
                        });
        };

        function getVehicles() {
            vehicleService.getVehiclesForPassenger(reservationInfo.passengerId)
            .then(function (response) {

                getParkingInfo();

                if (response.data.status === 1 && response.data.result.passengerVehicles != null) {
                    vm.vehicles = response.data.result.passengerVehicles;
                    vm.vehicles.splice(0, 0, noVehicle);
                    vm.selectedVehicle = findDefault(vm.vehicles);
                    vm.hasVehicles = true;

                    if (vm.isAMReservation)
                        vm.needsParking = true;
                }

                if (!vm.vehicles || vm.vehicles.length === 0)
                    vm.selectedVehicle = noVehicle;

                vm.loadingVehicles = false;
            }, function (error) {
                vm.hasVehicles = false;
                vm.loadingVehicles = false;
            });
        }





        function findDefault(vehicles) {
            for (var i = 0; i < vehicles.length; i++) {
                if (vehicles[i].isDefault) return vehicles[i];
            }
            return noVehicle;
        };

        function reservationTimespan() {
            return Date.parse(reservationInfo.reservationDate);
        }



        function reserve() {
            vm.disable = true;
            var reservation = {
                'pickupStopId': reservationInfo.pickupStop.id,
                'dropoffStopId': reservationInfo.dropoffStop.id,
                'tripId': reservationInfo.trip.tripId,
                'reservationDate': reservationInfo.reservationDate,
                'passengerId': reservationInfo.passengerId,
                'divisionId': reservationInfo.divisionId,
                'routeId': reservationInfo.trip.routeId,
                'schedule': reservationInfo.scheduleType,
                'companions' :vm.selectedCompanions

            };

            if (vm.needsParking && !angular.isUndefined(vm.selectedVehicle.id)) {
                reservation.vehicleId = vm.selectedVehicle.id;
            }

            ReservationService.addReservations(reservationInfo.passengerId, [reservation]).then(handleReservationSuccess);
        };

        function handleReservationSuccess(response) {
            if (response.data && response.data.status == 1) {

                if (response.data.result.errors && response.data.result.errors.length > 0)
                    MessageService.showInformation(response.data.result.errors[0]);
                else
                    getReservation(reservationInfo.passengerId, response.data.result.id[0]);
            } else
                MessageService.showInformation("Error processing reservation.");

            vm.disable = false;
        }


        function getReservation(passengerId, rId) {
            ReservationService.getReservationById(passengerId, rId)
            .then(function (response) {
                vm.isReserved = true;
                vm.confirmationNumber = response.data.result.confirmationNumber;
                //hide parking section if not selected.
                if (!vm.needsParking)
                    vm.isParkingAttachedToReservation = false;

                StopDataService.getAvailableParkingsForStop(reservationInfo.pickupStop.id, reservationTimespan())
               .then(function (response) {
                   if (response.data.status === 1 && response.data.result) {
                       vm.availableParkingSlots = response.data.result;
                   }
               });
            });
        }

        vm.cancel = function () {
            $uibModalInstance.close({
                'action': 'close', 'isReserved': vm.isReserved
            });
        };

        vm.navigateToReservationPage = function () {
            $uibModalInstance.close({
                'action': 'reservation'
            });
        };

        vm.navigateToAddVehicles = function () {
            $uibModalInstance.close({
                'action': 'vehicle'
            });
        };

        this.MakeDisable = function () {
            if (vm.disable) {
                return true;
            }
            else {
                return false;
            }
        };

        init();
    }
})();



(function () {
    'use strict';
    angular
        .module('oneMVApp')
        .controller('StopsMapController', StopsMapController);

    StopsMapController.$inject = ['$location', 'GeoLocationService',
        'StopDataService', 'uiGmapIsReady', 'LocationService', '$http', '$timeout',
        'schedule_stops', 'routeData', '$uibModalInstance', '$window'];

    function StopsMapController($location, GeoLocationService,
        StopDataService, uiGmapIsReady, LocationService, $http, $timeout,
        schedule_stops, routeData, $uibModalInstance, $window) {

        var vm = this;
        vm.title = 'Schedule Stops'
        vm.mapControl = {};
        vm.stopMarker = [];
        vm.map = {
            // http://angular-google-maps.org/use
            center: {
                latitude: 43.75514221191406,
                longitude: -116.57597351074219
            },
            zoom: 10,
            lineStyle: {
                color: '#333',
                weight: 5,
                opacity: 0.7
            }
        };
        var myStyles = [
           {
               featureType: "poi",
               elementType: "labels",
               stylers: [
                     { visibility: "off" }
               ]
           },
           {
               "featureType": "transit",
               "elementType": "labels.icon",
               "stylers": [
                   {
                       "visibility": "off"
                   }
               ]
           }
        ];
        vm.mapOptions = {
            mapTypeControl: false,
            zoomControl: false,
            streetViewControl: false,
            styles: myStyles

        };

        var busStopGreen, busStopGrey, hubIcon, pickupIcon;
        if ($window.navigator.userAgent.indexOf("Trident") > 0 || $window.navigator.userAgent.indexOf("MSIE") > 0) {
            busStopGreen = 'images/pin-busstop-green.png';
            busStopGrey = 'images/pin-busstop-grey.png';
            hubIcon = 'images/pin-hub.png';
            pickupIcon = 'images/pin_pickup.png';
        }
        else {
            busStopGreen = 'images/pin-busstop-green.svg';
            busStopGrey = 'images/pin-busstop-grey.svg';
            hubIcon = 'images/pin-hub.svg';
            pickupIcon = 'images/pin_pickup.svg';
        }

        vm.scheduleStops = schedule_stops;

        if (vm.scheduleStops.IsAM) {// TBD add this field
            angular.forEach(vm.scheduleStops.stops, function (stop) {
                vm.icon = { url: busStopGreen };
                if (stop.isHub) {
                    vm.icon = { url: hubIcon }
                }
                vm.stopMarker.push({
                    'stopId': stop.stopId, 'stopName': stop.name,
                    'latitude': stop.latitude, 'longitude': stop.longitude,
                    'icon': vm.icon,
                    'address': stop.address
                });
            });
        }
        else {
            angular.forEach(vm.scheduleStops.stops, function (stop) {
                vm.icon = { url: busStopGrey };
                if (stop.isHub) {
                    vm.icon = { url: hubIcon }
                }
                vm.stopMarker.push({
                    'stopId': stop.stopId, 'stopName': stop.name,
                    'latitude': stop.latitude, 'longitude': stop.longitude,
                    'icon': vm.icon,
                    'address': stop.address
                });
            });
        }

        vm.icon = 'images/pin_pickup.svg';
        vm.icon = { url: pickupIcon };
        uiGmapIsReady.promise().then(function (maps) {

            google.maps.event.trigger(vm.mapControl.getGMap(), "resize");

            if (routeData != null && routeData.length > 0) {

                var decodedPath = google.maps.geometry.encoding.decodePath(routeData[0].line);

                var line = new google.maps.Polyline({
                    path: decodedPath,
                    strokeOpacity: 0.5,
                    strokeWeight: 5,
                    icons: [{
                        icon: {
                            path: google.maps.SymbolPath.FORWARD_OPEN_ARROW,
                            strokeOpacity: 0,
                            fillOpacity: 1,
                            scale: 2.5
                        },
                        offset: '25px',
                        repeat: '200px',

                    }],
                    zIndex: 1
                });
                var lineStroke = new google.maps.Polyline({
                    path: decodedPath,
                    strokeColor: '#fff',
                    strokeOpacity: 1.0,
                    strokeWeight: 8,
                    zindex: 0
                });
                line.setMap(vm.mapControl.getGMap());
                lineStroke.setMap(vm.mapControl.getGMap());


            }
            var bounds = new google.maps.LatLngBounds();

            if (decodedPath && decodedPath.length > 0)
                angular.forEach(decodedPath, function (l) {
                    bounds.extend(new google.maps.LatLng(l.lat(), l.lng()));
                });
            else {
                angular.forEach(vm.stopMarker, function (m) {
                    bounds.extend(new google.maps.LatLng(m.latitude, m.longitude));
                });

            }
            vm.mapControl.getGMap().fitBounds(bounds);

        });

        vm.polylines = [{
            id: 1,
            path: vm.path,
            stroke: {
                color: '#6060FB',
                weight: 5
            },
            editable: false,
            draggable: false,
            geodesic: true,
            visible: true,
        }];

        //marker click function
        vm.markerEvent = {
            click: function (gMarker, eventName, model) {
                if (model.$id) {
                    //navigateToSelectedStop(model.coords);
                    if (vm.selectedLocation)
                        StopDataService.setGeoLocation(vm.selectedLocation);
                    StopDataService.setStop(model.coords);
                    vm.coords = model.coords;
                    vm.show = true;
                }
            }
        };

        vm.cancel = function () {
            $uibModalInstance.dismiss('cancel');
            vm.isDone = true;
        };
    }

})();

(function () {
    'use strict';
    angular
        .module('oneMVApp')
        .directive('backControl', backControl);

    backControl.$inject = ['$window'];

    function backControl($window) {

        var directive = {
            restrict: 'E',
            controller: controller,
            replace:true,
            template: '<button class="go-back" ng-click="goBack()">Back</button>'
        };
        return directive;

        function controller($scope,$window) {
            $scope.goBack = function () {
                $window.history.back();
            }
        }
    }

})();
(function() {
    'use strict';

    angular
        .module('oneMVApp')
        .filter('routeStopsName', function () {
            return function (routeLongName) {
                if (routeLongName && routeLongName.length > 0) {
                    var startIndex = routeLongName.indexOf("-") + 1;
                    var endIndex = routeLongName.length;
                    return routeLongName.substring(startIndex, endIndex);
                }
            }
        });

    angular
        .module('oneMVApp')
        .filter('routeShortName', function () {
            return function (routeLongName) {
                if (routeLongName && routeLongName.length > 0) {
                    var startIndex = 0;
                    var endIndex = routeLongName.indexOf("-") - 1;
                    return routeLongName.substring(startIndex, endIndex);
                }
            }
        });

    angular
        .module('oneMVApp')
        .directive('routeCard', routeCard);

    routeCard.$inject = ['$window'];
    
    function routeCard($window) {
        // Usage:
        //     <route-card></route-card>
        // Creates:
        // 
        var directive = {
            link: link,
            restrict: 'EA',
            controller: controller,
            scope: { routeInfo: '=', onSelect: '&', pinnable: '='},
            templateUrl: 'app/modules/fixed-route/directives/route-card/route-card.html'
        };
        return directive;

        function link(scope, element, attrs) {
            scope.$watch("routeInfo", function (newValue, oldValue) {
                //This gets called when data changes.
                if (newValue !== oldValue && newValue != '') {
                    if (typeof newValue == "string")
                        scope.routeInfo = JSON.parse(newValue);
                    else if (typeof newValue == "object")
                        scope.routeInfo = newValue;
                    scope.activate();
                }

            });
        }

        

        function controller($scope, $location) {
            
           
            $scope.activateTrip = activateTrip;
            $scope.activateRoute = activateRoute;
            $scope.gotoRouteWithStops = gotoRouteWithStops;
            $scope.activate = activate;
            //$scope.isRouteSelected = false;
            $scope.activeTrip = null;

            activate();

            function activate() {
                var isAnyTripActive = false;
                for (var i = 0; i < $scope.routeInfo.trips.length; i++) {
                    if ($scope.routeInfo.trips[i].isActive) {
                        $scope.activeTrip = $scope.routeInfo.trips[i];
                        isAnyTripActive = true;
                        break;
                    } 
                };
                if (!isAnyTripActive) {
                    if ($scope.routeInfo && $scope.routeInfo.trips && !$scope.activeTrip) {
                        $scope.activeTrip = $scope.routeInfo.trips[0];
                        $scope.routeInfo.trips[0].isActive = true;
                    }
                }

            }

            function activateTrip(trip) {
                $scope.activeTrip = trip;
                for (var i = 0; i < $scope.routeInfo.trips.length; i++) {

                    if ($scope.routeInfo.trips[i] === trip) {
                        $scope.routeInfo.trips[i].isActive = true;
                    } else {
                        $scope.routeInfo.trips[i].isActive = false;
                    }
                };
            }

            function activateRoute() {
                $scope.routeInfo.isSelected = !$scope.routeInfo.isSelected
                //Send back the selected route to parent controller
                if ($scope.onSelect && typeof $scope.onSelect === "function")
                    $scope.onSelect({ schedule: $scope.routeInfo });
            };

            function gotoRouteWithStops() {
                $location.path("fixed-route/routes/" + $scope.routeInfo.route.id);
            }
        }
    }

})();
(function () {
    'use strict';  
    angular
        .module('oneMVApp')
        .directive('stopArrivalInfo', stopArrivalInfo);

    stopArrivalInfo.$inject = [];

    function stopArrivalInfo() {

        var directive = {
            link: link,
            restrict: 'E',
            controller: controller,            
            scope: { routeArrival: '=', selectedStopId:'=' },
            templateUrl: 'app/modules/fixed-route/directives/stop-arrival-info/stop-arrival-info.html'
        };
        return directive;

        function link(scope, element, attrs) {

        }

        function controller($scope) {

            $scope.selectedArrivalIndex = 0;

            $scope.showArrivals = function (index) {
                $scope.selectedArrivalIndex = index;
            }

            var x = $scope.selectedStopId;

        }
    }

})();
(function () {
    'use strict';

    angular.module('oneMVApp')
    .controller('RatingModalController', RatingModalController);

    RatingModalController.$inject = ['$scope', '$http', 'UtilityFactory',
        'ConfigFactory', '$uibModalInstance', 'trip', 'selectedRating', 'FeedbackService', 'authService'];

    function RatingModalController($scope, $http, UtilityFactory, ConfigFactory,
        $uibModalInstance, trip, selectedRating, FeedbackService, authService) {
        var vm = this;
        vm.trip = trip;

        vm.cancel = cancel;
        vm.saveFeedback = saveFeedback;

        vm.feedback = {
            rating: selectedRating,
            comment: ''
        };

        vm.disableSubmit = function () {
            var result = true;
            if (vm.feedback.rating > 0) {
                result = false;
            }

            return result;
        };

        function cancel() {
            $uibModalInstance.close();
        };

        function saveFeedback() {
            var feedbackRequest = {
                PassengerRating: vm.feedback.rating,
                Comment: vm.feedback.comment,
                TripId: vm.trip.TripId,
                CreatedBy: authService.authentication.passengerId
            };

            FeedbackService.SaveFeedback(feedbackRequest).then(function (response) {
                if (response.data.status == 1) {
                    vm.isSaving = false;
                    UtilityFactory.toastSuccess("Success!", "Feedback saved successfully");
                    $uibModalInstance.close(feedbackRequest);
                } else {
                    vm.isSaving = false;
                    UtilityFactory.toastError("Error!", "Could not save feedback");
                    $log.error('Error: - ' + response.data.message);
                }
            }, function errorCallback(response) {
                vm.isSaving = false;
                UtilityFactory.toastError("Error!", "Could not save feedback");
                $log.error('Error: - ' + response.data.message);
            });

        }
    }
})();
(function () {
    'use strict';
    angular.module("oneMVApp").directive('starRatingDirective', starRatingDirective);

    function starRatingDirective() {

        return {
            restrict: 'E',
            scope: {
                tripInfo: '=',
                options: '@',
                allowTripRating: '@'
            },
            templateUrl: 'app/modules/on-demand/reservations/rating-component/starRating.html',
            controller : controllerFunction
        };

        function controllerFunction($scope, $uibModal) {
            $scope.jsTripInfo = $scope.tripInfo; //JSON.parse($scope.tripInfo);
            $scope.jsOptions = JSON.parse($scope.options);
            $scope.rating = $scope.jsTripInfo.rating;
            $scope.ratingComment = $scope.jsTripInfo.ratingComment;
            $scope.mvReadOnly = false;

            var setRating = function () {
                //let today = new Date($scope.serviceDate);
                var serviceDate = new Date($scope.jsTripInfo.serviceDate);
                var arrRestrictedValues = ["No-show", "Cancel"];

                if ($scope.allowTripRating == false && $scope.jsTripInfo.rating <= 0) {
                    $scope.mvReadOnly = false;
                }
                else {
                    if (arrRestrictedValues.indexOf($scope.jsTripInfo.Status) >= 0) {
                        $scope.mvReadOnly = false;
                    }
                    else {

                        if ($scope.jsTripInfo.rating > 0) {
                            $scope.mvReadOnly = true;
                        };
                    }
                }
            };




            $scope.showRatingModal = function () {
                if ($scope.mvReadOnly) {
                    return false;
                }

                var modalInstance = $uibModal.open({
                    templateUrl: 'app/modules/on-demand/reservations/rating-component/ratingModal.html',
                    controller: 'RatingModalController as vm',
                    resolve: {
                        trip: $scope.jsTripInfo,
                        selectedRating: $scope.rating
                    }
                });

                modalInstance.result.then(function (item) {
                    if (!angular.isUndefined(item)) {
                        $scope.rating = item.PassengerRating;
                        $scope.ratingComment = item.Comment;
                        $scope.jsTripInfo.ratingComment = item.Comment;
                        $scope.jsTripInfo.rating = item.PassengerRating;
                        $scope.mvReadOnly = true;
                    }
                    else {
                        $scope.rating = 0;
                    }

                }, function () {
                    // dismiss
                });
            }

            setRating();

        }
    }
})();
(function () {
    'use strict';

    angular
        .module('oneMVApp')
        .controller('MenuController', MenuController);

    MenuController.$inject = ['$scope'];

    function MenuController($scope) {
        //var vm = this;
        $scope.onHammer = function onHammer (event) {
            $scope.eventType = event.type;
            console.log(event.type);
          };

        $scope.carouselOptions = {
            navText: ["", ""],
            responsiveClass: false,
            nav: true,
            onDrag:noscroll,
            onDragged:goscroll, 

            responsive: {
                0: {
                    items: 1,
                    stagePadding: 34,
                    startPosition: 1,
                    center: true,
                },
                375:{
                    items: 1,
                    stagePadding: 34,
                    startPosition: 1,
                    center: true,
                },
                768: {
                    items: 2,
                    stagePadding: 16,
                    startPosition: 1,
                    center: true,
                },
                992: {
                    items: 3,
                    stagePadding: 0,
                    center: false,
                    mergeFit:true
                }

            }
        };

        function noscroll(event) {
            angular.element('html').addClass('no-scroll');

        }
        function goscroll(event) {
            angular.element('html').removeClass('no-scroll');
        }
    }
})();

(function () {
    'use strict';

    angular.module('oneMVApp')
    .directive('owlCarousel', MVOwlCarousel);

    MVOwlCarousel.$inject = [];

    function MVOwlCarousel() {
        return {
            restrict: 'E',
            transclude: false,
            link: function (scope) {
                scope.initCarousel = function (element) {
                    // provide any default options you want
                    var defaultOptions = {
                    };
                    var customOptions = scope.$eval($(element).attr('data-options'));
                    // combine the two options objects
                    for (var key in customOptions) {
                        defaultOptions[key] = customOptions[key];
                    }
                    // init carousel
                    $(element).owlCarousel(defaultOptions);
                };
            }
        };
    }
})();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm9uZW12LWNvbnRyb2xsZXIuanMiLCJjb3JlL2RpcmVjdGl2ZXMvaHRtbC1kaXJlY3RpdmUuanMiLCJjb3JlL2RpcmVjdGl2ZXMva2V5ZG93bi5qcyIsImNvcmUvZGlyZWN0aXZlcy9uZ0xvYWRTY3JpcHQuanMiLCJjb3JlL2RpcmVjdGl2ZXMvcGhvbmVudW1iZXJEaXJlY3RpdmUuanMiLCJjb3JlL3NlcnZpY2VzL0NvbmZpZ0ZhY3RvcnkuanMiLCJjb3JlL3NlcnZpY2VzL0RhdGFWYWxpZGF0aW9uRmFjdG9yeS5qcyIsImNvcmUvc2VydmljZXMvRGF0ZUZhY3RvcnkuanMiLCJjb3JlL3NlcnZpY2VzL0xvY2F0aW9uRmFjdG9yeS5qcyIsImNvcmUvc2VydmljZXMvU2VjdXJpdHlGYWN0b3J5LmpzIiwiY29yZS9zZXJ2aWNlcy9VdGlsaXR5RmFjdG9yeS5qcyIsImNvcmUvc2VydmljZXMvYXV0aEludGVyY2VwdG9yU2VydmljZS5qcyIsImNvcmUvc2VydmljZXMvYXV0aFNlcnZpY2UuanMiLCJjb3JlL3NlcnZpY2VzL2NvbW1vblNlcnZpY2UuanMiLCJjb3JlL3NlcnZpY2VzL2NvbW11bmljYXRpb25zLXNlcnZpY2UuanMiLCJjb3JlL3NlcnZpY2VzL2RhdGUtdXRpbGl0eS1zZXJ2aWNlLmpzIiwiY29yZS9zZXJ2aWNlcy9kaXZpc2lvblNlcnZpY2UuanMiLCJjb3JlL3NlcnZpY2VzL2R5bmFtaWMtY29udGVudC1zZXJ2aWNlLmpzIiwiY29yZS9zZXJ2aWNlcy9nZW8tbG9jYXRpb24tc2VydmljZS5qcyIsImNvcmUvc2VydmljZXMvbG9naW4tc2VydmljZS5qcyIsImNvcmUvc2VydmljZXMvbHV1bUxpbmtlZFNlcnZpY2UuanMiLCJjb3JlL3NlcnZpY2VzL21hcC1pY29uLXNlcnZpY2UuanMiLCJjb3JlL3NlcnZpY2VzL21hcFNlcnZpY2UuanMiLCJjb3JlL3NlcnZpY2VzL21lc3NhZ2UtYm94LmpzIiwiY29yZS9zZXJ2aWNlcy9vbmUtbXYtc2VydmljZXMtZmFjdG9yeS5qcyIsImNvcmUvc2VydmljZXMvcGFnZVNlcnZpY2UuanMiLCJjb3JlL3NlcnZpY2VzL3Bhc3N3b3JkLXNlcnZpY2UuanMiLCJjb3JlL3NlcnZpY2VzL3BvcnRhbC11dGlsaXR5LXNlcnZpY2UuanMiLCJjb3JlL3NlcnZpY2VzL3Byb2ZpbGVTZXJ2aWNlLmpzIiwiY29yZS9zZXJ2aWNlcy9yZWRpcmVjdGlvbi1zZXJ2aWNlLmpzIiwiY29yZS9zZXJ2aWNlcy9yZXNlcnZhdGlvbi1zZXJ2aWNlLmpzIiwiY29yZS9zZXJ2aWNlcy9zZXJ2aWNlLWFyZWEtc2VydmljZS5qcyIsIm1vZHVsZXMvY29tbXV0ZXIvYWxsLXN0b3BzL2FsbC1zdG9wcy1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9jb21tdXRlci9hZHYtc2NoZWR1bGUvYWR2LXNjaGVkdWxlLWNvbmZpcm1hdGlvbi1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9jb21tdXRlci9hZHYtc2NoZWR1bGUvYWR2LXNjaGVkdWxlLWNvbnRyb2xsZXIuanMiLCJtb2R1bGVzL2NvbW11dGVyL2Fkdi1zY2hlZHVsZS9hZHYtc2NoZWR1bGUtc2V0dXAtY29udHJvbGxlci5qcyIsIm1vZHVsZXMvY29tbXV0ZXIvYWR2LXNjaGVkdWxlL3Jlc2VydmF0aW9uLW1vZGFsLmpzIiwibW9kdWxlcy9jb21tdXRlci9kaXJlY3Rpb25zL2RpcmVjdGlvbnMtY29udHJvbGxlci5qcyIsIm1vZHVsZXMvY29tbXV0ZXIvaG9tZS9ob21lLWNvbnRyb2xsZXIuanMiLCJtb2R1bGVzL2NvbW11dGVyL2xvY2F0aW9uL2xhc3QtbG9jYXRpb24tY29udHJvbGxlci5qcyIsIm1vZHVsZXMvY29tbXV0ZXIvbG9jYXRpb24vbG9jYXRpb24tc2VydmljZS5qcyIsIm1vZHVsZXMvY29tbXV0ZXIvbWVzc2FnZS9tZXNzYWdlLWNvbnRyb2xsZXIuanMiLCJtb2R1bGVzL2NvbW11dGVyL21lc3NhZ2UvbWVzc2FnZS1zZXJ2aWNlLmpzIiwibW9kdWxlcy9jb21tdXRlci9teS12ZWhpY2xlcy9teS12ZWhpY2xlcy1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9jb21tdXRlci9teS12ZWhpY2xlcy92ZWhpY2xlLXNlcnZpY2UuanMiLCJtb2R1bGVzL2NvbW11dGVyL3B1Ymxpc2hlZC1zY2hlZHVsZS9wdWJsaXNoZWQtc2NoZWR1bGUtY29udHJvbGxlci5qcyIsIm1vZHVsZXMvY29tbXV0ZXIvcHVibGlzaGVkLXNjaGVkdWxlL3B1Ymxpc2hlZC1zY2hlZHVsZS1zZXJ2aWNlLmpzIiwibW9kdWxlcy9jb21tdXRlci9zY2hlZHVsZS9zY2hlZHVsZS1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9jb21tdXRlci9zZWxlY3RlZC10cmlwL3NlbGVjdGVkLXRyaXAtY29udHJvbGxlci5qcyIsIm1vZHVsZXMvY29tbXV0ZXIvc2VsZWN0ZWQtdHJpcC9zZWxlY3RlZC10cmlwLXNlcnZpY2UuanMiLCJtb2R1bGVzL2NvbW11dGVyL3N0b3Avc2VhdC1hdmFpbGFiaWxpdHkuY29tcG9uZW50LmpzIiwibW9kdWxlcy9jb21tdXRlci9zdG9wL3NlbGVjdGVkLXN0b3AtY29udHJvbGxlci5qcyIsIm1vZHVsZXMvY29tbXV0ZXIvc3RvcC9zZWxlY3RlZFN0b3AtbnB0LmNvbXBvbmVudC5qcyIsIm1vZHVsZXMvY29tbXV0ZXIvc3RvcC9zdG9wLWRhdGEtc2VydmljZS5qcyIsIm1vZHVsZXMvY29tbXV0ZXIvc3RvcC92ZWhpY2xlLWRhdGEtc2VydmljZS5qcyIsIm1vZHVsZXMvZml4ZWQtcm91dGUvTGFuZGluZy9sYW5kaW5nLWNvbnRyb2xsZXIuanMiLCJtb2R1bGVzL2ZpeGVkLXJvdXRlL3JvdXRlcy9hbGwtcm91dGVzLWNvbnRyb2xsZXIuanMiLCJtb2R1bGVzL2ZpeGVkLXJvdXRlL3NjaGVkdWxlL2ZyLXNjaGVkdWxlLWNvbnRyb2xsZXIuanMiLCJtb2R1bGVzL2ZpeGVkLXJvdXRlL3NlcnZpY2VzL2ZyLW5vdGlmaWNhdGlvbnMtc2VydmljZS5qcyIsIm1vZHVsZXMvZml4ZWQtcm91dGUvc2VydmljZXMvZnItc2NoZWR1bGUtc2VydmljZS5qcyIsIm1vZHVsZXMvZml4ZWQtcm91dGUvc2VydmljZXMvcm91dGUtc2VydmljZS5qcyIsIm1vZHVsZXMvZml4ZWQtcm91dGUvc2VydmljZXMvc3RvcC1zZXJ2aWNlLmpzIiwibW9kdWxlcy9maXhlZC1yb3V0ZS9zZXJ2aWNlcy92ZWhpY2xlLXNlcnZpY2UuanMiLCJtb2R1bGVzL2ZpeGVkLXJvdXRlL3N0b3BzL2ZyLXN0b3BzLWNvbnRyb2xsZXIuanMiLCJtb2R1bGVzL2ZpeGVkLXJvdXRlL3N0b3BzLWZvci1yb3V0ZS9zdG9wcy1mb3Itcm91dGUtY29udHJvbGxlci5qcyIsIm1vZHVsZXMvb24tZGVtYW5kL2FjdGl2ZVRyaXAvYWN0aXZlLXRyaXAtY29udHJvbGxlci5qcyIsIm1vZHVsZXMvb24tZGVtYW5kL2FjdGl2ZVRyaXAvcGFzc2VuZ2VyLW1vYmlsZS1tb2RhbC1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9vbi1kZW1hbmQvYWN0aXZlVHJpcC90cmlwLWNhbmNlbGxhdGlvbi1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9vbi1kZW1hbmQvZmFyaW5nL2ZhcmluZy1tb2RhbC1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9vbi1kZW1hbmQvcmVzZXJ2YXRpb25zL2Rpc3BsYXlUcmlwLW1vZGFsLWNvbnRyb2xsZXIuanMiLCJtb2R1bGVzL29uLWRlbWFuZC9yZXNlcnZhdGlvbnMvZmFyaW5nLXNlcnZpY2UuanMiLCJtb2R1bGVzL29uLWRlbWFuZC9yZXNlcnZhdGlvbnMvZmVlZGJhY2stc2VydmljZS5qcyIsIm1vZHVsZXMvb24tZGVtYW5kL3Jlc2VydmF0aW9ucy9maXhlZC1yb3V0ZXMtY29udHJvbGxlci5qcyIsIm1vZHVsZXMvb24tZGVtYW5kL3Jlc2VydmF0aW9ucy9sb2NhdGlvblNlYXJjaERpcmVjdGl2ZS5qcyIsIm1vZHVsZXMvb24tZGVtYW5kL3Jlc2VydmF0aW9ucy9sb2NhdGlvblNlcnZpY2UuanMiLCJtb2R1bGVzL29uLWRlbWFuZC9yZXNlcnZhdGlvbnMvbW9iaWxpdHktYWlkcy1zZXJ2aWNlLmpzIiwibW9kdWxlcy9vbi1kZW1hbmQvcmVzZXJ2YXRpb25zL25lZ290aWF0aW9uLW1vZGFsLWNvbnRyb2xsZXIuanMiLCJtb2R1bGVzL29uLWRlbWFuZC9yZXNlcnZhdGlvbnMvcmVzZXJ2YXRpb24tbW9kYWwtY29udHJvbGxlci5qcyIsIm1vZHVsZXMvb24tZGVtYW5kL3Jlc2VydmF0aW9ucy9yZXNlcnZhdGlvbkZvcm1EaXJlY3RpdmUuanMiLCJtb2R1bGVzL29uLWRlbWFuZC9yZXNlcnZhdGlvbnMvcmVzZXJ2YXRpb25NYXBEaXJlY3RpdmUuanMiLCJtb2R1bGVzL29uLWRlbWFuZC9yZXNlcnZhdGlvbnMvcmVzZXJ2YXRpb25zLWNvbnRyb2xsZXIuanMiLCJtb2R1bGVzL29uLWRlbWFuZC9yZXNlcnZhdGlvbnMvc2NoZWR1bGUtc2VydmljZS5qcyIsIm1vZHVsZXMvb24tZGVtYW5kL3Jlc2VydmF0aW9ucy90cmlwLW5lZ290aWF0aW9uLWxvZy1zZXJ2aWNlLmpzIiwibW9kdWxlcy9zaGFyZWQvZGFzaGJvYXJkL2Rhc2hib2FyZC1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9zaGFyZWQvZGl2aXNpb24vZGl2aXNpb25zLWNvbnRyb2xsZXIuanMiLCJtb2R1bGVzL3NoYXJlZC9sb2dpbi9mb3Jnb3QtcGFzc3dvcmQtY29udHJvbGxlci5qcyIsIm1vZHVsZXMvc2hhcmVkL2xvZ2luL2xvZ2luLWNvbnRyb2xsZXIuanMiLCJtb2R1bGVzL3NoYXJlZC9sb2dpbi9vbmVtdi1sb2dpbi1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9zaGFyZWQvbG9naW4vdmVyaWZ5LXVwZGF0ZS1wYXNzd29yZC1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9zaGFyZWQvbG9nb3V0L2xvZ291dC1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9zaGFyZWQvbWluLWFwcC1zdXBwb3J0L21pbi1hcHAtc3VwcG9ydC1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9zaGFyZWQvbmF2L25hdi1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9zaGFyZWQvbm90aWZpY2F0aW9uL25vdGlmaWNhdGlvbi1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9zaGFyZWQvbm90aWZpY2F0aW9uL25vdGlmaWNhdGlvbi1pdGVtLmNvbXBvbmVudC5qcyIsIm1vZHVsZXMvc2hhcmVkL25vdGlmaWNhdGlvbi9ub3RpZmljYXRpb24tc2VydmljZS5qcyIsIm1vZHVsZXMvc2hhcmVkL3B1c2hOb3RpZmljYXRpb25zL2Rpc3BsYXktcHVzaC1tZXNzYWdlLWNvbnRyb2xsZXIuanMiLCJtb2R1bGVzL3NoYXJlZC9wcm9maWxlL2NoYW5nZS1wYXNzd29yZC1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9zaGFyZWQvcHJvZmlsZS9ob21lQWRkcmVzc0RpcmVjdGl2ZS5qcyIsIm1vZHVsZXMvc2hhcmVkL3Byb2ZpbGUvcHJvZmlsZS1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9zaGFyZWQvc2V0dGluZ3Mvc2V0dGluZ3MtY29udHJvbGxlci5qcyIsIm1vZHVsZXMvc2hhcmVkL3NldHRpbmdzL3NldHRpbmdzLXNlcnZpY2UuanMiLCJtb2R1bGVzL3NoYXJlZC9zdXBwb3J0L3N1cHBvcnQtY29udHJvbGxlci5qcyIsIm1vZHVsZXMvc2hhcmVkL3JlZ2lzdHJhdGlvbi9leHRlcm5hbC1yZWdpc3RyYXRpb24tY29udHJvbGxlci5qcyIsIm1vZHVsZXMvc2hhcmVkL3JlZ2lzdHJhdGlvbi9vbmVtdi1yZWdpc3RyYXRpb24tY29udHJvbGxlci5qcyIsIm1vZHVsZXMvc2hhcmVkL3ZlcmlmaWNhdGlvbi92ZXJpZmljYXRpb24tY29udHJvbGxlci5qcyIsIm1vZHVsZXMvc2hhcmVkL3ZlcmlmaWNhdGlvbi92ZXJpZmljYXRpb24tc2VydmljZS5qcyIsIm1vZHVsZXMvc2hhcmVkL3doYXRzLW5ldy93aGF0cy1uZXctY29udHJvbGxlci5qcyIsIm1vZHVsZXMvc2hhcmVkL3RyaXBzL2NvbW11dGVyLXRyaXAtbW9kYWwuanMiLCJtb2R1bGVzL3NoYXJlZC90cmlwcy9jb21tdXRlci10cmlwcy5qcyIsIm1vZHVsZXMvc2hhcmVkL3RyaXBzL2RydC10cmlwLW1vZGFsLmpzIiwibW9kdWxlcy9zaGFyZWQvdHJpcHMvcGFzc2VuZ2VyLXRyaXBzLmpzIiwibW9kdWxlcy9zaGFyZWQvdHJpcHMvdHJpcENhcmREaXJlY3RpdmUuanMiLCJtb2R1bGVzL3NoYXJlZC90cmlwcy91c2VyUmVzZXJ2YXRpb25zRGlyZWN0aXZlLmpzIiwibW9kdWxlcy9jb21tdXRlci9tb2RhbHMvYWRkLXZlaGljbGUtbW9kYWwvYWRkLXZlaGljbGUtY29udHJvbGxlci5qcyIsIm1vZHVsZXMvY29tbXV0ZXIvbW9kYWxzL2NhbmNlbC1yZXNlcnZhdGlvbi1tb2RhbC9jYW5jZWwtcmVzZXJ2YXRpb24tY29udHJvbGxlci5qcyIsIm1vZHVsZXMvY29tbXV0ZXIvbW9kYWxzL2ZlZWRiYWNrLW1vZGFsL2NvbW11dGVyLWZlZWRiYWNrLW1vZGFsLmpzIiwibW9kdWxlcy9jb21tdXRlci9tb2RhbHMvbW9kaWZ5LXJlc2VydmF0aW9uLW1vZGFsL21vZGlmeS1yZXNlcnZhdGlvbi1waWNrdXAtY29udHJvbGxlci5qcyIsIm1vZHVsZXMvY29tbXV0ZXIvbW9kYWxzL3JlbW92ZS12ZWhpY2xlLW1vZGFsL3JlbW92ZS12ZWhpY2xlLWNvbmZpcm1hdGlvbi1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9jb21tdXRlci9tb2RhbHMvcmVzZXJ2YXRpb24tbWFwLW1vZGFsL3Jlc2VydmF0aW9uLW1hcC1jb250cm9sbGVyLmpzIiwibW9kdWxlcy9jb21tdXRlci9tb2RhbHMvcmVzZXJ2YXRpb24tbW9kYWwvcmVzZXJ2YXRpb24tY29udHJvbGxlci5qcyIsIm1vZHVsZXMvY29tbXV0ZXIvbW9kYWxzL3N0b3BzLW1hcC1tb2RhbC9zdG9wcy1tYXAtY29udHJvbGxlci5qcyIsIm1vZHVsZXMvZml4ZWQtcm91dGUvZGlyZWN0aXZlcy9iYWNrL2JhY2suanMiLCJtb2R1bGVzL2ZpeGVkLXJvdXRlL2RpcmVjdGl2ZXMvcm91dGUtY2FyZC9yb3V0ZS1jYXJkLmpzIiwibW9kdWxlcy9maXhlZC1yb3V0ZS9kaXJlY3RpdmVzL3N0b3AtYXJyaXZhbC1pbmZvL3N0b3AtYXJyaXZhbC1pbmZvLmpzIiwibW9kdWxlcy9vbi1kZW1hbmQvcmVzZXJ2YXRpb25zL3JhdGluZy1jb21wb25lbnQvUmF0aW5nTW9kYWxDb250cm9sbGVyLmpzIiwibW9kdWxlcy9vbi1kZW1hbmQvcmVzZXJ2YXRpb25zL3JhdGluZy1jb21wb25lbnQvc3RhclJhdGluZ0RpcmVjdGl2ZS5qcyIsIm1vZHVsZXMvc2hhcmVkL2Rhc2hib2FyZC9tZW51L21lbnUtY29udHJvbGxlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1S0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbFpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaFhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuVEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaEZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9UQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1ZkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5UUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxYUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5aUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1T0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeEhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcmtCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMVNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25mQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbExBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hlQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaGNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMW1CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3REQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0xBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNURBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNycENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzllQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdFRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL2JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeFdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeEhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5TEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxaEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdEZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaFBBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuUUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNUpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeFpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeEpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL1BBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9MQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6Im1vZHVsZXMuYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdPbmVNVkNvbnRyb2xsZXInLCBPbmVNVkNvbnRyb2xsZXIpO1xyXG5cclxuICAgIE9uZU1WQ29udHJvbGxlci4kaW5qZWN0ID0gWyckbG9jYXRpb24nLCAnJHNjb3BlJywgJ0RpdmlzaW9uU2VydmljZScsICckcm9vdFNjb3BlJywgJyRpbnRlcnZhbCcsICdlbnYnLCAnUGFnZVNlcnZpY2UnLCAnUmVkaXJlY3Rpb25TZXJ2aWNlJywgJyRsb2cnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBPbmVNVkNvbnRyb2xsZXIoJGxvY2F0aW9uLCAkc2NvcGUsIERpdmlzaW9uU2VydmljZSwgJHJvb3RTY29wZSwgJGludGVydmFsLCBlbnYsIFBhZ2VTZXJ2aWNlLCBSZWRpcmVjdGlvblNlcnZpY2UsICRsb2cpIHtcclxuXHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS5kaXZpc2lvbiA9IFwiZGVmYXVsdFwiO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlID0gUGFnZVNlcnZpY2U7XHJcbiAgICAgICAgdm0uYnJhbmQgPSAnYmFzZSc7XHJcbiAgICAgICAgaWYgKGVudi5pb25pYykge1xyXG4gICAgICAgICAgICB2bS5pb25pYyA9IGVudi5pb25pYztcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB2bS5pb25pYyA9IHt9O1xyXG4gICAgICAgICAgICB2bS5pb25pYy5zaG93TWVudSA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xyXG4gICAgICAgICAgICBpZiAoRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKSlcclxuICAgICAgICAgICAgICAgIERpdmlzaW9uU2VydmljZVxyXG4gICAgICAgICAgICAgICAgICAgICAuZ2V0RGl2aXNpb25JbmZvKClcclxuICAgICAgICAgICAgICAgICAudGhlbihoYW5kbGVTdWNjZXNzLCBoYW5kbGVGYWlsdXJlKTtcclxuICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgaGFuZGxlRmFpbHVyZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaGFuZGxlU3VjY2VzcyhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT09IDEpIHtcclxuICAgICAgICAgICAgICAgIHNldERpdmlzaW9uVmFsdWVzKHJlc3BvbnNlLmRhdGEucmVzdWx0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaGFuZGxlRmFpbHVyZShlcnJvcikge1xyXG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2RpdmlzaW9uJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRNYWpvckFwcFZlcnNpb24obWFqb3JObykge1xyXG4gICAgICAgICAgICB2YXIgX21ham9yQXBwTm8gPSBudWxsO1xyXG4gICAgICAgICAgICBpZiAobWFqb3JObykge1xyXG4gICAgICAgICAgICAgICAgdmFyIF9hcnIgPSBtYWpvck5vLnNwbGl0KCd2Jyk7XHJcbiAgICAgICAgICAgICAgICBpZiAoX2FyciAmJiBfYXJyLmxlbmd0aCA+IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICBfbWFqb3JBcHBObyA9IF9hcnJbMV07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkbG9nLmVycm9yKFwiQXBwIFZlcnNpb24gbm90IHNldHVwIGNvcnJlY3RseSBpbiBEQi5cIik7XHJcbiAgICAgICAgfTtcclxuICAgICAgICAgICAgcmV0dXJuIF9tYWpvckFwcE5vO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0TWFqb3JTd1ZlcnNpb24obWFqb3JObykge1xyXG4gICAgICAgICAgICB2YXIgX21ham9yU3dObyA9IG51bGw7XHJcbiAgICAgICAgICAgIGlmIChtYWpvck5vKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgX2FyciA9IG1ham9yTm8uc3BsaXQoJ3N3Jyk7XHJcbiAgICAgICAgICAgICAgICBpZiAoX2FyciAmJiBfYXJyLmxlbmd0aCA+IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICBfbWFqb3JTd05vID0gX2FyclsxXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gX21ham9yU3dObztcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBpc0FOdW1iZXIobm8pIHtcclxuICAgICAgICAgICAgcmV0dXJuICFpc05hTihubyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBpc01pblZlcnNpb24oZGl2aXNpb24pIHtcclxuICAgICAgICAgICAgdmFyIGlzTWluVmVyc2lvbiA9IHRydWU7XHJcbiAgICAgICAgICAgIGlmIChkaXZpc2lvbi5NaW5BcHBWZXJzaW9uKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGJBcHBWZXJzaW9ucyA9IGRpdmlzaW9uLk1pbkFwcFZlcnNpb24uc3BsaXQoJy4nKTtcclxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50VmVyc2lvbnMgPSBlbnYuaW9uaWMuYXBwVmVyc2lvbi5zcGxpdCgnLicpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB2YXIgZGJObyA9IChnZXRNYWpvckFwcFZlcnNpb24oZGJBcHBWZXJzaW9uc1swXSkgKiAxMDAwMCkgKyBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIChldmFsKGRiQXBwVmVyc2lvbnNbMV0pICogMTAwKSArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZGJBcHBWZXJzaW9uc1syXSA/IGV2YWwoZGJBcHBWZXJzaW9uc1syXSkgOiAwKVxyXG5cclxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50QXBwTm8gPSAoZ2V0TWFqb3JBcHBWZXJzaW9uKGN1cnJlbnRWZXJzaW9uc1swXSkgKiAxMDAwMCkgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZXZhbChjdXJyZW50VmVyc2lvbnNbMV0pICogMTAwKSArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjdXJyZW50VmVyc2lvbnNbMl0gPyBldmFsKGN1cnJlbnRWZXJzaW9uc1syXSkgOiAwKVxyXG5cclxuICAgICAgICAgICAgICAgIGlzTWluVmVyc2lvbiA9IGN1cnJlbnRBcHBObyA+PSBkYk5vO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGlzTWluVmVyc2lvbjtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBzZXREaXZpc2lvblZhbHVlcyhkaXZpc2lvbikge1xyXG4gICAgICAgICAgICB2YXIgbXNnID0ge3R5cGU6XCJjaGVja01pbkFwcFZlcnNpb25cIiwgZGF0YTogZGl2aXNpb259O1xyXG4gICAgICAgICAgICAgdHJ5e1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5kaXIobXNnKTtcclxuICAgICAgICAgICAgICAgIHdpbmRvdy5wb3N0TWVzc2FnZShKU09OLnN0cmluZ2lmeShtc2cpKTtcclxuICAgICAgICAgICAgIH1jYXRjaChlKXtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpO1xyXG4gICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmIChlbnYuaW9uaWMgJiYgIWlzTWluVmVyc2lvbihkaXZpc2lvbikpIHtcclxuICAgICAgICAgICAgICAgIFJlZGlyZWN0aW9uU2VydmljZS5yZWRpcmVjdFRvKCcvbWluLWFwcC1zdXBwb3J0Jyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGRpdmlzaW9uLkhhc0N1c3RvbVNldHVwKXtcclxuICAgICAgICAgICAgICAgIHZtLmJyYW5kID0gZGl2aXNpb24uRGl2aXNpb25JRDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZtLmJyYW5kID0gJ2Jhc2UnO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2bS5kaXZpc2lvbiA9IGRpdmlzaW9uLkRpdmlzaW9uSUQ7XHJcblxyXG5cclxuICAgICAgICAgICAgLy8gZG9jdW1lbnQudGl0bGUgPSBkaXZpc2lvbi5NZXRhVGl0bGU7XHJcbiAgICAgICAgICAgIC8vIHZtLnRpdGxlID0gZGl2aXNpb24uTWV0YVRpdGxlOztcclxuICAgICAgICAgICAgLy8gdm0uZGVzY3JpcHRpb24gPSBkaXZpc2lvbi5NZXRhRGVzY3JpcHRpb247XHJcbiAgICAgICAgICAgICRyb290U2NvcGUuc3VwcG9ydFBob25lTnVtYmVyID0gZGl2aXNpb24uU3VwcG9ydFBob25lTnVtYmVyO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICAgICAgaWYgKERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCkpXHJcbiAgICAgICAgICAgIGFjdGl2YXRlKCk7XHJcblxyXG4gICAgICAgICRyb290U2NvcGUuJG9uKCdkaXZpc2lvbkNoYW5nZWQnLCBhY3RpdmF0ZSk7XHJcbiAgICAgICAgXHJcbiAgICB9XHJcblxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24oKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuZGlyZWN0aXZlKCdkeW5hbWljJywgSHRtbERpcmVjdGl2ZSk7XHJcblxyXG4gICAgSHRtbERpcmVjdGl2ZS4kaW5qZWN0ID0gWyckY29tcGlsZSddO1xyXG4gICAgXHJcbiAgICBmdW5jdGlvbiBIdG1sRGlyZWN0aXZlKCRjb21waWxlKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGUsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goYXR0cnMuZHluYW1pYywgZnVuY3Rpb24gKGh0bWwpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGUuaHRtbChodG1sKTtcclxuICAgICAgICAgICAgICAgICAgICAkY29tcGlsZShlbGUuY29udGVudHMoKSkoc2NvcGUpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxufSkoKTsiLCIvL3ZhciBtb2QgPSBhbmd1bGFyLm1vZHVsZSgnb25lTVZBcHAnKTtcclxuLy9tb2QuZGlyZWN0aXZlKCdvbktleWRvd24nLCBmdW5jdGlvbiAoKSB7XHJcbi8vICAgIHJldHVybiB7XHJcbi8vICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4vLyAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtLCBhdHRycykge1xyXG4vLyAgICAgICAgICAgIC8vIHRoaXMgbmV4dCBsaW5lIHdpbGwgY29udmVydCB0aGUgc3RyaW5nXHJcbi8vICAgICAgICAgICAgLy8gZnVuY3Rpb24gbmFtZSBpbnRvIGFuIGFjdHVhbCBmdW5jdGlvblxyXG4vLyAgICAgICAgICAgIHZhciBmdW5jdGlvblRvQ2FsbCA9IHNjb3BlLiRldmFsKGF0dHJzLm9uS2V5ZG93bik7XHJcbi8vICAgICAgICAgICAgZWxlbS5vbigna2V5ZG93bicsIGZ1bmN0aW9uIChlKSB7XHJcbi8vICAgICAgICAgICAgICAgIC8vIG9uIHRoZSBrZXlkb3duIGV2ZW50LCBjYWxsIG15IGZ1bmN0aW9uXHJcbi8vICAgICAgICAgICAgICAgIC8vIGFuZCBwYXNzIGl0IHRoZSBrZXljb2RlIG9mIHRoZSBrZXlcclxuLy8gICAgICAgICAgICAgICAgLy8gdGhhdCB3YXMgcHJlc3NlZFxyXG4vLyAgICAgICAgICAgICAgICAvLyBleDogaWYgRU5URVIgd2FzIHByZXNzZWQsIGUud2hpY2ggPT0gMTNcclxuLy8gICAgICAgICAgICAgICAgZnVuY3Rpb25Ub0NhbGwoZSk7XHJcbi8vICAgICAgICAgICAgfSk7XHJcbi8vICAgICAgICB9XHJcbi8vICAgIH07XHJcbi8vfSk7IiwiLypnbG9iYWwgYW5ndWxhciAqL1xyXG4oZnVuY3Rpb24gKG5nKSB7XHJcbiAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICB2YXIgYXBwID0gbmcubW9kdWxlKCduZ0xvYWRTY3JpcHQnLCBbXSk7XHJcblxyXG4gIGFwcC5kaXJlY3RpdmUoJ3NjcmlwdCcsIGZ1bmN0aW9uICgkcGFyc2UsICRyb290U2NvcGUsICRjb21waWxlKSB7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgICAgdGVybWluYWw6IHRydWUsXHJcbiAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHIpIHtcclxuICAgICAgICAgICAgICBpZiAoYXR0ci5uZ1NyYykge1xyXG4gICAgICAgICAgICAgICAgICB2YXIgZG9tRWxlbSA9ICc8c2NyaXB0IHNyYz1cIicgKyBhdHRyLm5nU3JjICsgJ1wiIGFzeW5jIGRlZmVyPjwvc2NyaXB0Pic7XHJcbiAgICAgICAgICAgICAgICAgICQoZWxlbWVudCkuYXBwZW5kKCRjb21waWxlKGRvbUVsZW0pKHNjb3BlKSk7XHJcblxyXG5cclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgIH07XHJcbiAgfSk7XHJcblxyXG59KGFuZ3VsYXIpKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmRpcmVjdGl2ZSgncGhvbmVudW1iZXJEaXJlY3RpdmUnLCBwaG9uZW51bWJlckRpcmVjdGl2ZSlcclxuICAgICAgICAuZmlsdGVyKCdwaG9uZW51bWJlcicsIHBob25lbnVtYmVyKTtcclxuICAgIHBob25lbnVtYmVyRGlyZWN0aXZlLiRpbmplY3QgPSBbJyRmaWx0ZXInLCAnJGJyb3dzZXInXTtcclxuXHJcbiAgICBmdW5jdGlvbiBwaG9uZW51bWJlckRpcmVjdGl2ZSgkZmlsdGVyLCAkYnJvd3Nlcikge1xyXG4gICAgICAgIC8qXHJcblx0XHRJbnRlbmRlZCB1c2U6XHJcblx0XHRcdDxwaG9uZW51bWJlci1kaXJlY3RpdmUgcGxhY2Vob2xkZXI9J3Byb21wdCcgbW9kZWw9J3NvbWVNb2RlbC5waG9uZW51bWJlcic+PC9waG9uZW51bWJlci1kaXJlY3RpdmU+XHJcblx0XHRXaGVyZTpcclxuXHRcdFx0c29tZU1vZGVsLnBob25lbnVtYmVyOiB7U3RyaW5nfSB2YWx1ZSB3aGljaCB0byBiaW5kIG9ubHkgdGhlIG51bWVyaWMgY2hhcmFjdGVycyBbMC05XSBlbnRlcmVkXHJcblx0XHRcdFx0aWUsIGlmIHVzZXIgZW50ZXJzIDYxNy0yMjIzMzMzLCB2YWx1ZSBvZiA2MTcyMjIzMzMzIHdpbGwgYmUgYm91bmQgdG8gbW9kZWxcclxuXHRcdFx0cHJvbXB0OiB7U3RyaW5nfSB0ZXh0IHRvIGtlZXAgaW4gcGxhY2Vob2xkZXIgd2hlbiBubyBudW1lcmljIGlucHV0IGVudGVyZWRcclxuXHRcdCovXHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlcXVpcmU6ICduZ01vZGVsJyxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKCRzY29wZSwgJGVsZW1lbnQsICRhdHRycywgbmdNb2RlbEN0cmwpIHtcclxuICAgICAgICAgICAgICAgIHZhciBsaXN0ZW5lciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSAkZWxlbWVudC52YWwoKS5yZXBsYWNlKC9bXjAtOV0vZywgJycpO1xyXG4gICAgICAgICAgICAgICAgICAgICRlbGVtZW50LnZhbCgkZmlsdGVyKCdwaG9uZW51bWJlcicpKHZhbHVlLCBmYWxzZSkpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBUaGlzIHJ1bnMgd2hlbiB3ZSB1cGRhdGUgdGhlIHRleHQgZmllbGRcclxuICAgICAgICAgICAgICAgIG5nTW9kZWxDdHJsLiRwYXJzZXJzLnB1c2goZnVuY3Rpb24gKCR2aWV3VmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHZpZXdWYWx1ZS5yZXBsYWNlKC9bXjAtOV0vZywgJycpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gVGhpcyBydW5zIHdoZW4gdGhlIG1vZGVsIGdldHMgdXBkYXRlZCBvbiB0aGUgc2NvcGUgZGlyZWN0bHkgYW5kIGtlZXBzIG91ciB2aWV3IGluIHN5bmNcclxuICAgICAgICAgICAgICAgIG5nTW9kZWxDdHJsLiRyZW5kZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJGVsZW1lbnQudmFsKCRmaWx0ZXIoJ3Bob25lbnVtYmVyJykobmdNb2RlbEN0cmwuJHZpZXdWYWx1ZSwgZmFsc2UpKTtcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgJGVsZW1lbnQuYmluZCgnY2hhbmdlJywgbGlzdGVuZXIpO1xyXG4gICAgICAgICAgICAgICAgJGVsZW1lbnQuYmluZCgna2V5ZG93bicsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBrZXkgPSBldmVudC5rZXlDb2RlO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSBrZXlzIGluY2x1ZGUgdGhlIENUUkwsIFNISUZULCBBTFQsIG9yIE1FVEEga2V5cywgb3IgdGhlIGFycm93IGtleXMsIGRvIG5vdGhpbmcuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBsZXRzIHVzIHN1cHBvcnQgY29weSBhbmQgcGFzdGUgdG9vXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PSA5MSB8fCAoMTUgPCBrZXkgJiYga2V5IDwgMTkpIHx8ICgzNyA8PSBrZXkgJiYga2V5IDw9IDQwKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICRicm93c2VyLmRlZmVyKGxpc3RlbmVyKTsgLy8gSGF2ZSB0byBkbyB0aGlzIG9yIGNoYW5nZXMgZG9uJ3QgZ2V0IHBpY2tlZCB1cCBwcm9wZXJseVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgJGVsZW1lbnQuYmluZCgncGFzdGUgY3V0JywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRicm93c2VyLmRlZmVyKGxpc3RlbmVyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gcGhvbmVudW1iZXIoKSB7XHJcbiAgICAgICAgLyogXHJcblx0ICAgIEZvcm1hdCBwaG9uZW51bWJlciBhczogYyAoeHh4KSB4eHgteHh4eFxyXG5cdCAgICBcdG9yIGFzIGNsb3NlIGFzIHBvc3NpYmxlIGlmIHBob25lbnVtYmVyIGxlbmd0aCBpcyBub3QgMTBcclxuXHQgICAgXHRpZiBjIGlzIG5vdCAnMScgKGNvdW50cnkgY29kZSBub3QgVVNBKSwgZG9lcyBub3QgdXNlIGNvdW50cnkgY29kZVxyXG5cdCAgICAqL1xyXG5cclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKG51bWJlcikge1xyXG4gICAgICAgICAgICAvKiBcclxuXHRcdCAgICBAcGFyYW0ge051bWJlciB8IFN0cmluZ30gbnVtYmVyIC0gTnVtYmVyIHRoYXQgd2lsbCBiZSBmb3JtYXR0ZWQgYXMgdGVsZXBob25lIG51bWJlclxyXG5cdFx0ICAgIFJldHVybnMgZm9ybWF0dGVkIG51bWJlcjogKCMjIykgIyMjLSMjIyNcclxuXHRcdCAgICBcdGlmIG51bWJlci5sZW5ndGggPCA0OiAjIyNcclxuXHRcdCAgICBcdGVsc2UgaWYgbnVtYmVyLmxlbmd0aCA8IDc6ICgjIyMpICMjI1xyXG4gXHJcblx0XHQgICAgRG9lcyBub3QgaGFuZGxlIGNvdW50cnkgY29kZXMgdGhhdCBhcmUgbm90ICcxJyAoVVNBKVxyXG5cdFx0ICAgICovXHJcbiAgICAgICAgICAgIGlmICghbnVtYmVyKSB7IHJldHVybiAnJzsgfVxyXG5cclxuICAgICAgICAgICAgbnVtYmVyID0gU3RyaW5nKG51bWJlcik7XHJcblxyXG4gICAgICAgICAgICAvLyBXaWxsIHJldHVybiBmb3JtYXR0ZWROdW1iZXIuIFxyXG4gICAgICAgICAgICAvLyBJZiBwaG9uZW51bWJlciBpc24ndCBsb25nZXIgdGhhbiBhbiBhcmVhIGNvZGUsIGp1c3Qgc2hvdyBudW1iZXJcclxuICAgICAgICAgICAgdmFyIGZvcm1hdHRlZE51bWJlciA9IG51bWJlcjtcclxuXHJcbiAgICAgICAgICAgIC8vIGlmIHRoZSBmaXJzdCBjaGFyYWN0ZXIgaXMgJzEnLCBzdHJpcCBpdCBvdXQgYW5kIGFkZCBpdCBiYWNrXHJcbiAgICAgICAgICAgIHZhciBjID0gKG51bWJlclswXSA9PSAnMScpID8gJzEgJyA6ICcnO1xyXG4gICAgICAgICAgICBudW1iZXIgPSBudW1iZXJbMF0gPT0gJzEnID8gbnVtYmVyLnNsaWNlKDEpIDogbnVtYmVyO1xyXG5cclxuICAgICAgICAgICAgLy8gIyAoIyMjKSAjIyMtIyMjIyBhcyBjIChhcmVhKSBmcm9udC1lbmRcclxuICAgICAgICAgICAgdmFyIGFyZWEgPSBudW1iZXIuc3Vic3RyaW5nKDAsIDMpO1xyXG4gICAgICAgICAgICB2YXIgZnJvbnQgPSBudW1iZXIuc3Vic3RyaW5nKDMsIDYpO1xyXG4gICAgICAgICAgICB2YXIgZW5kID0gbnVtYmVyLnN1YnN0cmluZyg2LCAxMCk7XHJcblxyXG4gICAgICAgICAgICBpZiAoZnJvbnQpIHtcclxuICAgICAgICAgICAgICAgIGZvcm1hdHRlZE51bWJlciA9IChjICsgXCIoXCIgKyBhcmVhICsgXCIpIFwiICsgZnJvbnQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChlbmQpIHtcclxuICAgICAgICAgICAgICAgIGZvcm1hdHRlZE51bWJlciArPSAoXCItXCIgKyBlbmQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBmb3JtYXR0ZWROdW1iZXI7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcblxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAvL2RlYnVnZ2VyO1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdvbmVNVkFwcCcpLmZhY3RvcnkoJ0NvbmZpZ0ZhY3RvcnknLCBDb25maWdGYWN0b3J5KTtcclxuICAgIENvbmZpZ0ZhY3RvcnkuJGluamVjdCA9IFsnJGh0dHAnLCAnJHEnLCAnZW52J107XHJcblxyXG5cclxuXHJcbmZ1bmN0aW9uIENvbmZpZ0ZhY3RvcnkoJGh0dHAsICRxLCBlbnYpIHtcclxuICAgIHZhciBGYWN0b3J5ID0ge1xyXG4gICAgICAgIGdldE9uZU1WQXBpVVJMOiBnZXRPbmVNVkFwaVVSTCxcclxuICAgICAgICBnZXRPbmVNVkFwaVVSTFByb21pc2U6IGdldE9uZU1WQXBpVVJMUHJvbWlzZSxcclxuICAgICAgICByZXNldFVzZXJBbmREaXZpc2lvbjogcmVzZXRVc2VyQW5kRGl2aXNpb24sXHJcbiAgICAgICAgZ2V0Q3VycmVudFVzZXI6IGdldEN1cnJlbnRVc2VyLFxyXG4gICAgICAgIGdldEN1cnJlbnREaXZpc2lvbjogZ2V0Q3VycmVudERpdmlzaW9uLFxyXG4gICAgICAgIGdldEN1cnJlbnREaXZpc2lvblRpbWU6IGdldEN1cnJlbnREaXZpc2lvblRpbWUsXHJcbiAgICAgICAgZ2V0RGl2aXNpb25QYXJhbWV0ZXJzOiBnZXREaXZpc2lvblBhcmFtZXRlcnNcclxuICAgIH07XHJcblxyXG4gICAgdmFyIGNvbmZpZ0RhdGE7XHJcbiAgICB2YXIgY3VycmVudFVzZXI7XHJcbiAgICB2YXIgY3VycmVudERpdmlzaW9uO1xyXG4gICAgdmFyIGN1cnJlbnREaXZpc2lvbkRhdGU7XHJcbiAgICB2YXIgY3VycmVudERpdmlzaW9uU3lzUGFyYW1zO1xyXG4gICAgdmFyIHZhbHVlO1xyXG5cclxuICAgIGZ1bmN0aW9uIGdldERpdmlzaW9uUGFyYW1ldGVycyhkaXZpc2lvbklkKSB7XHJcbiAgICAgICAgdmFyIGRlZmVyID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgZ2V0T25lTVZBcGlVUkxQcm9taXNlKCkudGhlbihmdW5jdGlvbiAob25lTVZVUkwpIHtcclxuICAgICAgICAgICAgaWYgKG9uZU1WVVJMICYmIG9uZU1WVVJMICE9IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgIC8vZ2V0IHRoZSBiYXNlIHVybCBmcm9tIGNvbmZpZy5cclxuICAgICAgICAgICAgICAgIHZhciBfdXJsID0gb25lTVZVUkwgKyAnZGl2aXNpb24vJyArIGRpdmlzaW9uSWQgKyAnL3N5c3RlbVBhcmFtZXRlcnM/YXBwVHlwZT1kZXNrdG9wJnJuZD0nICsgbmV3IERhdGUoKS5nZXRUaW1lKCk7XHJcbiAgICAgICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICAgICB1cmw6IF91cmxcclxuICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXIucmVzb2x2ZShyZXNwb25zZS5kYXRhLnJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXIucmVqZWN0KHJlc3BvbnNlLmRhdGEucmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXIucmVqZWN0KHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGRlZmVyLnByb21pc2U7XHJcbiAgICB9XHJcbiAgIFxyXG4gICAgLy9mdW5jdGlvbiBnZXRPbmVNVkFwaVVSTFByb21pc2UoKSB7XHJcbiAgICAvLyAgICB2YXIgX3VybCA9ICcuLi9jbGllbnRhcHBzZXR0aW5ncy5qc29uJztcclxuICAgIC8vICAgIHZhciBkZWZlciA9ICRxLmRlZmVyKCk7XHJcbiAgICAvLyAgICBpZiAoIWNvbmZpZ0RhdGEpIHtcclxuICAgIC8vICAgICAgICAkaHR0cCh7XHJcbiAgICAvLyAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAvLyAgICAgICAgICAgIHVybDogX3VybFxyXG4gICAgLy8gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XHJcbiAgICAvLyAgICAgICAgICAgIC8vVEJEXHJcbiAgICAvLyAgICAgICAgICAgIGNvbmZpZ0RhdGEgPSByZXNwb25zZS5kYXRhXHJcbiAgICAvLyAgICAgICAgICAgIGRlZmVyLnJlc29sdmUoY29uZmlnRGF0YS5BcGlVUkxzLk9uZU1WQXBpVVJMKTtcclxuICAgIC8vICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKHJlc3BvbnNlKSB7XHJcbiAgICAvLyAgICAgICAgICAgIC8vRXJyb3IgaGFuZGxpbmcgVEJEXHJcbiAgICAvLyAgICAgICAgICAgIGRlZmVyLnJlamVjdChyZXNwb25zZSk7XHJcbiAgICAvLyAgICAgICAgfSk7XHJcbiAgICAvLyAgICB9IGVsc2Uge1xyXG4gICAgLy8gICAgICAgIGRlZmVyLnJlc29sdmUoY29uZmlnRGF0YS5BcGlVUkxzLk9uZU1WQXBpVVJMKTtcclxuICAgIC8vICAgIH1cclxuICAgIC8vICAgIHJldHVybiBkZWZlci5wcm9taXNlO1xyXG4gICAgLy99XHJcbiAgICBmdW5jdGlvbiBnZXRPbmVNVkFwaVVSTFByb21pc2UoKSB7XHJcbiAgICAgICBcclxuICAgICAgICB2YXIgZGVmZXIgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgXHJcbiAgICAgICAgZGVmZXIucmVzb2x2ZShlbnYub25lTVZBcGlVcmwpO1xyXG4gICAgICAgXHJcbiAgICAgICAgcmV0dXJuIGRlZmVyLnByb21pc2U7XHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiBnZXRPbmVNVkFwaVVSTCgpIHtcclxuICAgICAgICByZXR1cm4gY29uZmlnRGF0YS5BcGlVUkxzLk9uZU1WQXBpVVJMO1xyXG4gICAgfVxyXG4gICAgZnVuY3Rpb24gcmVzZXRVc2VyQW5kRGl2aXNpb24oKSB7XHJcbiAgICAgICAgY3VycmVudFVzZXIgPSBudWxsO1xyXG4gICAgICAgIGN1cnJlbnREaXZpc2lvbiA9IG51bGw7XHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiBnZXRDdXJyZW50VXNlcigpIHtcclxuICAgICAgICBfdXJsID0gJy4uL09wZXJhdGlvbi9HZXRDdXJyZW50VXNlckRldGFpbHM/cm5kPScgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcclxuICAgICAgICB2YXIgZGVmZXIgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgIGlmICghY3VycmVudFVzZXIpIHtcclxuICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgIHVybDogX3VybFxyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudFVzZXIgPSByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFjdXJyZW50RGl2aXNpb24pXHJcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudERpdmlzaW9uID0ge307XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50RGl2aXNpb24gPSBjdXJyZW50VXNlci5EaXZpc2lvbnNbMF07XHJcbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudFVzZXIuQ3VycmVudExvZ2luICYmIGN1cnJlbnRVc2VyLkN1cnJlbnRMb2dpbi5EaXZpc2lvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnREaXZpc2lvbiA9IGN1cnJlbnRVc2VyLkN1cnJlbnRMb2dpbi5EaXZpc2lvbjtcclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgZGVmZXIucmVzb2x2ZShjdXJyZW50VXNlcik7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2socmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIC8vRXJyb3IgaGFuZGxpbmcgVEJEXHJcbiAgICAgICAgICAgICAgICBkZWZlci5yZWplY3QocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBkZWZlci5yZXNvbHZlKGN1cnJlbnRVc2VyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGRlZmVyLnByb21pc2U7XHJcblxyXG4gICAgfVxyXG4gICAgZnVuY3Rpb24gZ2V0Q3VycmVudERpdmlzaW9uKCkge1xyXG4gICAgICAgIHZhciBfdXJsID0gJy4uL09wZXJhdGlvbi9HZXRDdXJyZW50VXNlckRldGFpbHM/cm5kPScgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcclxuICAgICAgICB2YXIgZGVmZXIgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgIGlmICghY3VycmVudERpdmlzaW9uKSB7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICB1cmw6IF91cmxcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRVc2VyID0gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgICAgICAgIGlmICghY3VycmVudERpdmlzaW9uKVxyXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnREaXZpc2lvbiA9IHt9O1xyXG4gICAgICAgICAgICAgICAgY3VycmVudERpdmlzaW9uID0gY3VycmVudFVzZXIuRGl2aXNpb25zWzBdO1xyXG4gICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRVc2VyLkN1cnJlbnRMb2dpbiAmJiBjdXJyZW50VXNlci5DdXJyZW50TG9naW4uRGl2aXNpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50RGl2aXNpb24gPSBjdXJyZW50VXNlci5DdXJyZW50TG9naW4uRGl2aXNpb247XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBkZWZlci5yZXNvbHZlKGN1cnJlbnREaXZpc2lvbik7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2socmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIC8vRXJyb3IgaGFuZGxpbmcgVEJEXHJcbiAgICAgICAgICAgICAgICBkZWZlci5yZWplY3QocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBkZWZlci5yZXNvbHZlKGN1cnJlbnREaXZpc2lvbik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBkZWZlci5wcm9taXNlO1xyXG4gICAgfVxyXG4gICAgZnVuY3Rpb24gZ2V0Q3VycmVudERpdmlzaW9uVGltZSgpIHtcclxuICAgICAgICB2YXIgZGVmZXIgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgIHZhciBfdXJsID0gJy4uL09wZXJhdGlvbi9HZXRDdXJyZW50RGl2aXNpb25UaW1lP3JuZD0nICsgbmV3IERhdGUoKS5nZXRUaW1lKCk7XHJcbiAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICB1cmw6IF91cmxcclxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICBjdXJyZW50RGl2aXNpb25EYXRlID0gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgICAgZGVmZXIucmVzb2x2ZShjdXJyZW50RGl2aXNpb25EYXRlKTtcclxuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIGRlZmVyLnJlamVjdChjdXJyZW50RGl2aXNpb25EYXRlKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGRlZmVyLnByb21pc2U7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0T25lTVZBcGlVUkxQcm9taXNlKCk7IC8vT25lIG1hbnVhbCBjYWxsIHRvIHNldCB0aGUgVVJMLiBUbyBnZXQgdGhlIGd1YXJhbnRlZWQgdXJsIHdlIG5lZWQgdG8gdXNlIHRoZSBwcm9taXNlIG1ldGhvZC5cclxuICAgIHJldHVybiBGYWN0b3J5O1xyXG59XHJcblxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgLy9kZWJ1Z2dlcjtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnb25lTVZBcHAnKS5mYWN0b3J5KCdEYXRhVmFsaWRhdGlvbkZhY3RvcnknLCBEYXRhVmFsaWRhdGlvbkZhY3RvcnkpO1xyXG4gICAgRGF0YVZhbGlkYXRpb25GYWN0b3J5LiRpbmplY3QgPSBbJyRsb2cnLCAnJHdpbmRvdycsICckaHR0cCddO1xyXG5cclxuXHJcbiAgICBmdW5jdGlvbiBEYXRhVmFsaWRhdGlvbkZhY3RvcnkoJGxvZywgJHdpbmRvdywgJGh0dHApIHtcclxuICAgICAgICB2YXIgZmFjdG9yeSA9IHtcclxuICAgICAgICAgICAgdmFsaWRhdGVaaXBDb2RlOiB2YWxpZGF0ZVppcENvZGUsXHJcbiAgICAgICAgICAgIHZhbGlkYXRlWmlwQ29kZU5ldzogdmFsaWRhdGVaaXBDb2RlTmV3XHJcblxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiBmYWN0b3J5O1xyXG5cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGRvUG9zdEh0dHBSZXF1ZXN0KHVybCkge1xyXG4gICAgICAgICAgICB2YXIgZ29vZ2xlVXJsID0gdXJsO1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgdXJsOiBnb29nbGVVcmwsXHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgd2l0aENyZWRlbnRpYWxzOiBmYWxzZVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdmFsaWRhdGVaaXBDb2RlTmV3KHppcCkge1xyXG4gICAgICAgICAgICB2YXIgZ29vZ2xlVXJsID0gXCIvL21hcHMuZ29vZ2xlYXBpcy5jb20vbWFwcy9hcGkvZ2VvY29kZS9qc29uP2FkZHJlc3M9XCIgKyB6aXAgKyBcIiZzZW5zb3I9dHJ1ZVwiO1xyXG4gICAgICAgICAgICByZXR1cm4gZG9Qb3N0SHR0cFJlcXVlc3QoZ29vZ2xlVXJsKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHZhbGlkYXRlWmlwQ29kZSh6aXAsIHZtKSB7XHJcbiAgICAgICAgICAgIHZhciBzdGF0ZUNvZGU7XHJcbiAgICAgICAgICAgIHZhciBzdGF0ZTtcclxuICAgICAgICAgICAgdmFyIGdvb2dsZVVybCA9IFwiLy9tYXBzLmdvb2dsZWFwaXMuY29tL21hcHMvYXBpL2dlb2NvZGUvanNvbj9hZGRyZXNzPVwiICsgemlwICsgXCImc2Vuc29yPXRydWVcIjtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICB1cmw6IGdvb2dsZVVybCxcclxuICAgICAgICAgICAgICAgIHdpdGhDcmVkZW50aWFsczogZmFsc2VcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIC8vIHRoaXMgY2FsbGJhY2sgd2lsbCBiZSBjYWxsZWQgYXN5bmNocm9ub3VzbHlcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFkZHJlc3NDb21wb25lbnRzID0gcmVzcG9uc2UuZGF0YS5yZXN1bHRzWzBdLmFkZHJlc3NfY29tcG9uZW50cztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc3RhdGVDb2RlID0gYWRkcmVzc0NvbXBvbmVudHNbYWRkcmVzc0NvbXBvbmVudHMubGVuZ3RoIC0gMl0uc2hvcnRfbmFtZTtcclxuICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IGFkZHJlc3NDb21wb25lbnRzW2FkZHJlc3NDb21wb25lbnRzLmxlbmd0aCAtIDJdLmxvbmdfbmFtZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChzdGF0ZUNvZGUgIT0gJycpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5zdGF0ZWFiYnIgPSBzdGF0ZUNvZGU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzdGF0ZUNvZGU7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2VcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJyc7XHJcblxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJOL0FcIjtcclxuICAgICAgICAgICAgICAgIC8vICRzY29wZS5lcnIgPSByZXNwb25zZTtcclxuICAgICAgICAgICAgICAgIC8vIGNhbGxlZCBhc3luY2hyb25vdXNseSBpZiBhbiBlcnJvciBvY2N1cnNcclxuICAgICAgICAgICAgICAgIC8vIG9yIHNlcnZlciByZXR1cm5zIHJlc3BvbnNlIHdpdGggYW4gZXJyb3Igc3RhdHVzLlxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59KSgpO1xyXG5cclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuICAgIC8vZGVidWdnZXJcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5mYWN0b3J5KCdEYXRlRmFjdG9yeScsIERhdGVGYWN0b3J5KTtcclxuXHJcbiAgICBEYXRlRmFjdG9yeS4kaW5qZWN0ID0gWyckbG9nJywgJ1V0aWxpdHlGYWN0b3J5JywgJyRyb290U2NvcGUnXTtcclxuXHJcbmZ1bmN0aW9uIERhdGVGYWN0b3J5KCRsb2csIFV0aWxpdHlGYWN0b3J5LCAkcm9vdFNjb3BlKSB7XHJcbiAgICB2YXIgZmFjdG9yeSA9IHtcclxuICAgICAgICBnZXRDdXN0b21UaW1lOiBnZXRDdXN0b21UaW1lLFxyXG4gICAgICAgIGdldERhdGVGcm9tQ3VzdG9tVGltZTogZ2V0RGF0ZUZyb21DdXN0b21UaW1lLFxyXG4gICAgICAgIGdldFByZXZpb3VzRGF0ZTogZ2V0UHJldmlvdXNEYXRlLFxyXG4gICAgICAgIGdldFRpbWVEaWZmZXJlbmNlOiBnZXRUaW1lRGlmZmVyZW5jZSxcclxuICAgICAgICBpc0RheUxpZ2h0c2F2aW5nT246IGlzRGF5TGlnaHRzYXZpbmdPbixcclxuICAgICAgICBnZXRNaW51dGVzRnJvbVRpbWVTdHJpbmc6IGdldE1pbnV0ZXNGcm9tVGltZVN0cmluZyxcclxuICAgICAgICBnZXRQcm9taXNlV2luZG93VGltZURpc3BsYXk6IGdldFByb21pc2VXaW5kb3dUaW1lRGlzcGxheSxcclxuICAgICAgICBnZXRQcm9taXNlV2luZG93RW5kVGltZTogZ2V0UHJvbWlzZVdpbmRvd0VuZFRpbWVcclxuICAgICAgICBcclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIGZhY3Rvcnk7XHJcblxyXG4gICAgLy9nZXQgZGlmZmVyZW5jZSBpbiBtaW51dGVzIGZyb20gZ2l2ZW4gZGF0ZVRpbWUgYW5kIGN1cnJlbnQgYnJvd3NlciBkYXRldGltZVxyXG4gICAgZnVuY3Rpb24gZ2V0VGltZURpZmZlcmVuY2UoZGl2aXNpb25EYXRlKSB7XHJcbiAgICAgICAgdmFyIHRvZGF5ID0gbmV3IERhdGUoKTtcclxuICAgICAgICB2YXIgc2VydmVyRGF0ZSA9IG5ldyBEYXRlKERhdGUucGFyc2UoZGl2aXNpb25EYXRlKSk7ICAvL2dldCB0aGUgZGF0ZSBpbiBjb3JyZWN0IGZvcm1hdCBmb3IgRGF0ZSBmdW5jdGlvblxyXG5cclxuICAgICAgICB2YXIgZGlmZmVyZW5jZSA9IHRvZGF5IC0gc2VydmVyRGF0ZTtcclxuXHJcbiAgICAgICAgLy9jb252ZXJ0IGRpZmZlcmVuY2UgZnJvbSBtaWxsaXNlY29uZHMgdG8gbWludXRlc1xyXG4gICAgICAgIGlmIChNYXRoLmFicyhkaWZmZXJlbmNlIC8gMTAwMCAvIDYwKSA8IDEpXHJcbiAgICAgICAgICAgIGRpZmZlcmVuY2UgPSAwXHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGlmIChkaWZmZXJlbmNlIDwgMClcclxuICAgICAgICAgICAgICAgIGRpZmZlcmVuY2UgPSBNYXRoLmZsb29yKGRpZmZlcmVuY2UgLyAxMDAwIC8gNjApO1xyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICBkaWZmZXJlbmNlID0gTWF0aC5jZWlsKChkaWZmZXJlbmNlIC8gMTAwMCkgLyA2MClcclxuICAgICAgICB9XHJcbiAgICAgICAgLy93ZSBvbmx5IGNhcmUgaWYgdGhlIHRpbWUgaXMgMSBtaW51dGUgbGVzcyBvciAxIG1pbnV0ZSBtb3JlIHRoYW4gc2hvdWxkIGJlIGJlY2F1c2Ugb2Ygcm91bmRpbmdcclxuICAgICAgICBpZiAoTWF0aC5hYnMoZGlmZmVyZW5jZSkgJSAxMCA+IDApIHtcclxuICAgICAgICAgICAgaWYgKGRpZmZlcmVuY2UgPCAwKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoTWF0aC5hYnMoZGlmZmVyZW5jZSkgJSAxMCA9PSAxKVxyXG4gICAgICAgICAgICAgICAgICAgIGRpZmZlcmVuY2UgPSBkaWZmZXJlbmNlICsgMTtcclxuICAgICAgICAgICAgICAgIGlmIChNYXRoLmFicyhkaWZmZXJlbmNlKSAlIDEwID09IDkpXHJcbiAgICAgICAgICAgICAgICAgICAgZGlmZmVyZW5jZSA9IGRpZmZlcmVuY2UgLSAxO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChNYXRoLmFicyhkaWZmZXJlbmNlKSAlIDEwID09IDEpXHJcbiAgICAgICAgICAgICAgICAgICAgZGlmZmVyZW5jZSA9IGRpZmZlcmVuY2UgLSAxO1xyXG4gICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKGRpZmZlcmVuY2UpICUgMTAgPT0gOSlcclxuICAgICAgICAgICAgICAgICAgICBkaWZmZXJlbmNlID0gZGlmZmVyZW5jZSArIDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGRpZmZlcmVuY2U7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gMzMgaHIgZGlzcGxheSBsb2dpY1xyXG4gICAgZnVuY3Rpb24gZ2V0Q3VzdG9tVGltZShkYXRlVG9SZW5kZXIsIHNlcnZpY2VEYXRlKSB7XHJcbiAgICAgICAgdmFyIF9jdXN0b21UaW1lID0gXCJcIjtcclxuXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgaWYgKGRhdGVUb1JlbmRlciAmJiBzZXJ2aWNlRGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIF9ocnNUb0FkZCA9IG1vbWVudChkYXRlVG9SZW5kZXIpLmhvdXJzKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAobW9tZW50KGRhdGVUb1JlbmRlcikuZGF0ZSgpICE9IG1vbWVudChzZXJ2aWNlRGF0ZSkuZGF0ZSgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9BZGQgdGhlIGRpZmZlcmVuY2UgZGF5cyAqIDI0LiBHZW5lcmljIHNvbHV0aW9uIHRvIGhhbmRsZSBtb3JlIHRoYW4gMzMgaHJzLlxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBfZGlmZiA9IG1vbWVudChkYXRlVG9SZW5kZXIpLmRpZmYobW9tZW50KHNlcnZpY2VEYXRlKSwgJ2RheXMnKTtcclxuICAgICAgICAgICAgICAgICAgICBfaHJzVG9BZGQgPSBfaHJzVG9BZGQgKyAoX2RpZmYgKiAyNCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoX2hyc1RvQWRkIDwgMCAmJiBfaHJzVG9BZGQgPiAtMTApXHJcbiAgICAgICAgICAgICAgICAgICAgX2hyc1RvQWRkID0gXCItMFwiICsgKF9ocnNUb0FkZCAqIC0xKS8vV2hlbiBzZXJ2aWNlIGRhdGUgaXMgbGVzcyB0aGFuIGRhdGV0b1JlbmRlclxyXG4gICAgICAgICAgICAgICAgaWYgKF9ocnNUb0FkZCA8IDEwKVxyXG4gICAgICAgICAgICAgICAgICAgIF9ocnNUb0FkZCA9IFwiMFwiICsgX2hyc1RvQWRkO1xyXG5cclxuICAgICAgICAgICAgICAgIF9jdXN0b21UaW1lID0gX2hyc1RvQWRkICsgXCI6XCIgKyBtb21lbnQoZGF0ZVRvUmVuZGVyKS5mb3JtYXQoJ21tJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2ggKGVycikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gX2N1c3RvbVRpbWVcclxuICAgIH07XHJcblxyXG4gICAgLy8gUmV2ZXJzZSBvZiBnZXRDdXN0b21UaW1lIGZ1bmN0aW9uXHJcbiAgICAvLyBVc2luZyBjdXN0b20gdGltZSBhbmQgc2VydmljZSBkYXRlIGNhbGN1bGF0ZSB0aGUgYWN0dWFsIGRhdGVcclxuICAgIC8vIFdlIG5lZWQgdG8gZmlndXJlIG91dCBiYXNlZCBvbiBkaXZpc2lvbiBzbyBnZXQgZGlmZmVyZW5jZSBmcm9tIGRpdmlzaW9uIHRpbWUgYW5kIGFkanVzdCB0aW1lIGFjY29yZGluZ2x5XHJcbiAgICBmdW5jdGlvbiBnZXREYXRlRnJvbUN1c3RvbVRpbWUoY3VzdG9tVGltZSwgc2VydmljZURhdGUpIHtcclxuICAgICAgICB2YXIgZGF0ZTtcclxuICAgICAgICB2YXIgZGlmZl9NaW51dGVzO1xyXG4gICAgICAgIHZhciBfc2VydmljZURhdGU7XHJcbiAgICAgICAgdmFyIGRpZmZlcmVuY2UgPSAkcm9vdFNjb3BlLnRpbWVEaWZmZXJlbmNlO1xyXG5cclxuXHJcbiAgICAgICAgLy9IYW5kbGluZyBib3RoIG1vbWVudCBkYXRlIGFuZCBuYXRpdmUgSlMgZGF0ZSBmb3JtYXRcclxuICAgICAgICBpZiAoc2VydmljZURhdGUuX2lzQU1vbWVudE9iamVjdClcclxuICAgICAgICAgICAgX3NlcnZpY2VEYXRlID0gc2VydmljZURhdGUuc3RhcnRPZignZGF5JylcclxuICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIF9zZXJ2aWNlRGF0ZSA9IHNlcnZpY2VEYXRlLnNldEhvdXJzKDAsIDAsIDApO1xyXG4gICAgICAgIGlmICh0eXBlb2YgY3VzdG9tVGltZSA9PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgIGlmIChjdXN0b21UaW1lLmluZGV4T2YoJzonKSA9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgZGlmZl9NaW51dGVzID0gKHBhcnNlSW50KGN1c3RvbVRpbWVbMF0gKyBjdXN0b21UaW1lWzFdKSkgKiA2MCArIHBhcnNlSW50KGN1c3RvbVRpbWVbMl0gKyBjdXN0b21UaW1lWzNdKTtcclxuICAgICAgICAgICAgICAgIGlmIChkaWZmZXJlbmNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGlmZl9NaW51dGVzID0gZGlmZl9NaW51dGVzICsgZGlmZmVyZW5jZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChjdXN0b21UaW1lLmluZGV4T2YoJzonKSA9PSAyKSB7XHJcbiAgICAgICAgICAgICAgICBkaWZmX01pbnV0ZXMgPSAocGFyc2VJbnQoY3VzdG9tVGltZVswXSArIGN1c3RvbVRpbWVbMV0pKSAqIDYwICsgcGFyc2VJbnQoY3VzdG9tVGltZVszXSArIGN1c3RvbVRpbWVbNF0pO1xyXG4gICAgICAgICAgICAgICAgaWYgKGRpZmZlcmVuY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBkaWZmX01pbnV0ZXMgPSBkaWZmX01pbnV0ZXMgKyBkaWZmZXJlbmNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgY3VzdG9tVGltZSA9PSBcImRhdGVcIikge1xyXG4gICAgICAgICAgICAvL2hhbmRsZSBkYXRlIHRpbWVcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBpZiAoZGlmZl9NaW51dGVzKSB7XHJcbiAgICAgICAgICAgIGRhdGUgPSBtb21lbnQoX3NlcnZpY2VEYXRlKS5hZGQoZGlmZl9NaW51dGVzLCAnbScpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgJGxvZy5lcnJvcihcImdldERhdGVGcm9tQ3VzdG9tVGltZTogVGltZSBpcyBpbnZhbGlkISwgQ2Fubm90IGNhbHVsYXRlIGFjdHVhbCB0aW1lXCIpO1xyXG4gICAgICAgICAgICAkbG9nLmxvZyhcImVycm9yIGRldGFpbHNcIiwgXCJnZXREYXRlRnJvbUN1c3RvbVRpbWUgY3VzdG9tVGltZTogXCIgKyBjdXN0b21UaW1lKTtcclxuICAgICAgICAgICAgJGxvZy5sb2coXCJlcnJvciBkZXRhaWxzXCIsIFwiZ2V0RGF0ZUZyb21DdXN0b21UaW1lIHNlcnZpY2VEYXRlOiBcIiArIF9zZXJ2aWNlRGF0ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBkYXRlO1xyXG5cclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIGdldFByZXZpb3VzRGF0ZShkYXRlKSB7XHJcbiAgICAgICAgaWYgKGRhdGUgPT0gbnVsbCkgZGF0ZSA9IG5ldyBEYXRlKCk7XHJcbiAgICAgICAgZGF0ZS5zZXREYXRlKGRhdGUuZ2V0RGF0ZSgpIC0gMSk7XHJcbiAgICAgICAgcmV0dXJuIGRhdGU7XHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiBpc0RheUxpZ2h0c2F2aW5nT24oKSB7XHJcbiAgICAgICAgdmFyIHRvZGF5ID0gbmV3IERhdGUoKTtcclxuICAgICAgICB2YXIgamFudWFyeSA9IG5ldyBEYXRlKHRvZGF5LmdldEZ1bGxZZWFyKCksIDAsIDEpO1xyXG4gICAgICAgIHZhciBqdWx5ID0gbmV3IERhdGUodG9kYXkuZ2V0RnVsbFllYXIoKSwgNiwgMSk7XHJcbiAgICAgICAgdmFyIHRpbWV6b25lRGlmZiA9IE1hdGgubWF4KGphbnVhcnkuZ2V0VGltZXpvbmVPZmZzZXQoKSwganVseS5nZXRUaW1lem9uZU9mZnNldCgpKTtcclxuICAgICAgICByZXR1cm4gdG9kYXkuZ2V0VGltZXpvbmVPZmZzZXQoKSA8IHRpbWV6b25lRGlmZjtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBnZXRNaW51dGVzRnJvbVRpbWVTdHJpbmcodGltZVN0cmluZykge1xyXG4gICAgICAgIHZhciBkaWZmX01pbnV0ZXMgPSAwO1xyXG4gICAgICAgIGlmICh0eXBlb2YgdGltZVN0cmluZyA9PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgIGlmICh0aW1lU3RyaW5nLmluZGV4T2YoJzonKSA9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgZGlmZl9NaW51dGVzID0gKHBhcnNlSW50KHRpbWVTdHJpbmdbMF0gKyB0aW1lU3RyaW5nWzFdKSkgKiA2MCArIHBhcnNlSW50KHRpbWVTdHJpbmdbMl0gKyB0aW1lU3RyaW5nWzNdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmICh0aW1lU3RyaW5nLmluZGV4T2YoJzonKSA9PSAyKSB7XHJcbiAgICAgICAgICAgICAgICBkaWZmX01pbnV0ZXMgPSAocGFyc2VJbnQodGltZVN0cmluZ1swXSArIHRpbWVTdHJpbmdbMV0pKSAqIDYwICsgcGFyc2VJbnQodGltZVN0cmluZ1szXSArIHRpbWVTdHJpbmdbNF0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBkaWZmX01pbnV0ZXM7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gIFxyXG4gICAgZnVuY3Rpb24gZ2V0UHJvbWlzZVdpbmRvd1RpbWVEaXNwbGF5KHNjaGVkdWxlVGltZSwgcHJvbWlzZVdpbmRvdywgc2VydmljZURhdGUpIHtcclxuICAgICAgICB2YXIgc2NoZWR1bGVUaW1lVmlldyA9IGdldEN1c3RvbVRpbWUoc2NoZWR1bGVUaW1lLCBzZXJ2aWNlRGF0ZSk7XHJcbiAgICAgICAgdmFyIGZvcm1hdERhdGUgPSBtb21lbnQoc2NoZWR1bGVUaW1lKS5hZGQocHJvbWlzZVdpbmRvdywgJ21pbnV0ZXMnKTtcclxuICAgICAgICB2YXIgcHJvbWlzZVdpbmRvd1RpbWUgPSBzY2hlZHVsZVRpbWVWaWV3ICsgXCItXCIgKyBnZXRDdXN0b21UaW1lKGZvcm1hdERhdGUsIHNlcnZpY2VEYXRlKTtcclxuICAgICAgICByZXR1cm4gcHJvbWlzZVdpbmRvd1RpbWU7XHJcbiAgICB9XHJcblxyXG4gICAgLy93aW5kb3dTdGFydFRpbWUgaXMgZXhwZWN0ZWQgdG8gYmUgaW4gSVNPIHN0cmluZyBmb3JtYXRcclxuICAgIC8vcHJvbWlzZVdpbmRvdyBpbiBtaW51dGVzXHJcbiAgICBmdW5jdGlvbiBnZXRQcm9taXNlV2luZG93RW5kVGltZSh3aW5kb3dTdGFydFRpbWUsIHByb21pc2VXaW5kb3cpIHtcclxuICAgICAgICB2YXIgb2xkRGF0ZU9iaiA9IG1vbWVudCh3aW5kb3dTdGFydFRpbWUpO1xyXG4gICAgICAgIHZhciBuZXdEYXRlT2JqID0gb2xkRGF0ZU9iai5hZGQoJ20nLCBwcm9taXNlV2luZG93KTtcclxuICAgICAgICByZXR1cm4gbmV3RGF0ZU9iai5mb3JtYXQoKTtcclxuICAgIH1cclxufTtcclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnb25lTVZBcHAnKS5mYWN0b3J5KCdMb2NhdGlvbkZhY3RvcnknLCBMb2NhdGlvbkZhY3RvcnkpO1xyXG5cclxuICAgIExvY2F0aW9uRmFjdG9yeS4kaW5qZWN0ID0gWyckaHR0cCcsICckcScsICdDb25maWdGYWN0b3J5JywgJ2F1dGhTZXJ2aWNlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gTG9jYXRpb25GYWN0b3J5KCRodHRwLCAkcSwgQ29uZmlnRmFjdG9yeSwgYXV0aFNlcnZpY2UpIHtcclxuXHJcbiAgICB2YXIgbG9jYXRpb25Gcm9tID0gW107XHJcbiAgICB2YXIgbG9jYXRpb25UbyA9IFtdO1xyXG4gICAgdmFyIEFkTG9jYXRpb25Gcm9tID0gW107XHJcbiAgICB2YXIgQWRMb2NhdGlvblRvID0gW107XHJcbiAgICB2YXIgR29vZ2xlTG9jYXRpb25Gcm9tID0gW107XHJcbiAgICB2YXIgR29vZ2xlTG9jYXRpb25UbyA9IFtdO1xyXG4gICAgdmFyIGFkZHJlc3NSZXN0ID0gJyc7XHJcbiAgICB2YXIgbG9jYXRpb25GaWx0ZXIgPSAnJztcclxuICAgIHZhciBmYWN0b3J5ID0ge1xyXG4gICAgICAgIHNldGFkZDogc3R0LFxyXG4gICAgICAgIGdldExvY2F0aW9uczogZ2V0TG9jYXRpb25zLFxyXG4gICAgICAgIGZpbmRDbG9zZXN0TG9jYXRpb246IGZpbmRDbG9zZXN0TG9jYXRpb25cclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIGZhY3Rvcnk7XHJcblxyXG4gICAgZnVuY3Rpb24gc3R0KG5ld05hbWUpIHtcclxuICAgICAgICBhZGRyZXNzUmVzdCA9IG5ld05hbWU7XHJcblxyXG4gICAgfVxyXG4gICAgZnVuY3Rpb24gc2V0TG9jYXRpb25GaWx0ZXIoZmlsdGVyU3RhdHVzKSB7XHJcbiAgICAgICAgbG9jYXRpb25GaWx0ZXIgPSBmaWx0ZXJTdGF0dXM7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZ2V0QWRkcmVzcyhBZExvY2F0aW9uRnJvbSwgbG9jKSB7XHJcbiAgICAgICAgdmFyIGFkZHJlc3NEZXRhaWxzID0gXCJcIjtcclxuICAgICAgICBpZiAobG9jKSB7XHJcbiAgICAgICAgXHQvL3ZhciBhZGRyZXNzRGV0YWlscyA9IEFkTG9jYXRpb25Gcm9tW2xvY10uSXNNYW51YWxseUFkZGVkID8gKEFkTG9jYXRpb25Gcm9tW2xvY10uTmFtZSkudG9VcHBlckNhc2UoKSA6ICcnO1xyXG4gICAgICAgIFx0aWYgKEFkTG9jYXRpb25Gcm9tW2xvY10uTmFtZSlcclxuICAgICAgICBcdFx0YWRkcmVzc0RldGFpbHMgPSBBZExvY2F0aW9uRnJvbVtsb2NdLk5hbWUudG9VcHBlckNhc2UoKTtcclxuICAgICAgICBcdGlmIChBZExvY2F0aW9uRnJvbVtsb2NdLkFsaWFzTmFtZXMpXHJcbiAgICAgICAgXHRcdGFkZHJlc3NEZXRhaWxzID0gYWRkcmVzc0RldGFpbHMgKyBcIiAoXCIgKyBBZExvY2F0aW9uRnJvbVtsb2NdLkFsaWFzTmFtZXMgKyBcIilcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGFkZHJlc3NEZXRhaWxzO1xyXG4gICAgfVxyXG5cclxuICAgIC8vbW92ZSB0byBVdGlsaXR5RmFjdG9yeSAobWF5IGJlKVxyXG4gICAgZnVuY3Rpb24gaXNOdWxsT3JFbXB0eShpbnB1dCkge1xyXG4gICAgICAgIGlmIChhbmd1bGFyLmlzVW5kZWZpbmVkKGlucHV0KSB8fCBpbnB1dCA9PT0gbnVsbCB8fCBpbnB1dCA9PSAnJykgICAvL2FuZ3VsYXIuZXF1YWxzKGlucHV0LCB7fSk7Ly9lbXB0eSBvYmplY3QgY29tcGFyaXNvblxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBmaW5kQ2xvc2VzdExvY2F0aW9uKG15cG9zaXRpb24sIGxvY2F0aW9ucykge1xyXG5cclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxvY2F0aW9ucy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBsb2NhdGlvbnNbaV0uZGlzdGFuY2UgPSByZWN0aWxpbmVhckhhdmVyc2luZShteXBvc2l0aW9uLCBsb2NhdGlvbnNbaV0ubG9jKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbG9jYXRpb25zLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGEuZGlzdGFuY2UgLSBiLmRpc3RhbmNlO1xyXG5cclxuICAgICAgICB9KVxyXG4gICAgICAgIHJldHVybiBsb2NhdGlvbnNbMF07XHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiBoYXZlcnNpbmVGb3JtdWxhKGdwc0xvYywgYmxkZykge1xyXG4gICAgICAgIC8vcG9zaXRpb24xID0gIHZtLnBvc2l0aW9uXHJcbiAgICAgICAgLy9wb3NpdGlvbjIgPSBzdG9wXHJcbiAgICAgICAgdmFyIGxhdDEgPSBncHNMb2MuTGF0aXR1ZGU7XHJcbiAgICAgICAgdmFyIGxvbjEgPSBncHNMb2MuTG9uZ2l0dWRlO1xyXG4gICAgICAgIHZhciBsYXQyID0gYmxkZy5MYXRpdHVkZTtcclxuICAgICAgICB2YXIgbG9uMiA9IGJsZGcuTG9uZ2l0dWRlXHJcblxyXG4gICAgICAgIHZhciBSID0gNjM3MTsgLy8ga20gXHJcbiAgICAgICAgdmFyIHgxID0gbGF0MiAtIGxhdDE7XHJcbiAgICAgICAgdmFyIGRMYXQgPSB4MSAqIE1hdGguUEkgLyAxODA7XHJcbiAgICAgICAgdmFyIHgyID0gbG9uMiAtIGxvbjE7XHJcbiAgICAgICAgdmFyIGRMb24gPSB4MiAqIE1hdGguUEkgLyAxODA7XHJcbiAgICAgICAgdmFyIGEgPSBNYXRoLnNpbihkTGF0IC8gMikgKiBNYXRoLnNpbihkTGF0IC8gMikgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBNYXRoLmNvcyhsYXQxICogTWF0aC5QSSAvIDE4MCkgKiBNYXRoLmNvcyhsYXQyICogTWF0aC5QSSAvIDE4MCkgKlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBNYXRoLnNpbihkTG9uIC8gMikgKiBNYXRoLnNpbihkTG9uIC8gMik7XHJcbiAgICAgICAgdmFyIGMgPSAyICogTWF0aC5hdGFuMihNYXRoLnNxcnQoYSksIE1hdGguc3FydCgxIC0gYSkpO1xyXG4gICAgICAgIHZhciBkID0gUiAqIGMgKiAwLjYyMTM3OyAvL2NvbnZlcnQgdG8gbWlsZXNcclxuICAgICAgICByZXR1cm4gZC50b0ZpeGVkKDIpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHJlY3RpbGluZWFySGF2ZXJzaW5lKGxvYzEsIGxvYzIpIHtcclxuICAgICAgICB2YXIgdGVtcFBvaW50ID0ge1xyXG4gICAgICAgICAgICBcIkxhdGl0dWRlXCI6IGxvYzEuTGF0aXR1ZGUsXHJcbiAgICAgICAgICAgIFwiTG9uZ2l0dWRlXCI6IGxvYzIuTG9uZ2l0dWRlXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgZDEgPSBwYXJzZUZsb2F0KGhhdmVyc2luZUZvcm11bGEobG9jMSwgdGVtcFBvaW50KSk7XHJcbiAgICAgICAgdmFyIGQyID0gcGFyc2VGbG9hdChoYXZlcnNpbmVGb3JtdWxhKHRlbXBQb2ludCwgbG9jMikpO1xyXG4gICAgICAgIHJldHVybiAoZDEgKyBkMikudG9GaXhlZCgyKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgZnVuY3Rpb24gY2hlY2tJZlZhbGlkKGFkZHJlc3MpIHtcclxuICAgICAgICBmb3IgKHZhciBpIGluIGFkZHJlc3MuYWRkcmVzc19jb21wb25lbnRzKSB7XHJcbiAgICAgICAgICAgIGlmIChhZGRyZXNzLmFkZHJlc3NfY29tcG9uZW50c1tpXS50eXBlc1swXSA9PSBcInN0cmVldF9udW1iZXJcIikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgLy8gdGhpcyBpcyB0aGUgb25seSBmdW5jdGlvbiB0aGF0IHdpbGwgYmUgaW4gdXNlIGZvciBib3RoIGZyb20gYW5kIHRvIGxvY2F0aW9ucywgd2hlbiB0aGUgZGlyZWN0aXZlIGlzIGluIHBsYWNlLlxyXG4gICAgLy9UaGUgYWJvdmUgMiBmdW5jdGlvbnMgYXJlIG9ubHkgZm9yIHRoZSBleGlzdGluZyBmdW5jdGlvbmFsaXR5LCB0aGV5IGNhbiBiZSBjbGVhbmVkIHVwIG9uY2UgdGhlIG5ldyBhZHZhbmNlZCByZXNlcnZhdGlvbiBpcyByZWFkeVxyXG5cclxuICAgIGZ1bmN0aW9uIGdldExvY2F0aW9ucyhTZWFyY2hUZXJtLCBsb2NhdGlvbmZpbHRlciwgZGl2aXNpb25JZCwgcGFzc2VuZ2VySWQsIGdvb2dsZU9ubHkpIHtcclxuICAgICAgICB2YXIgZGVmZXIgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgIHZhciBsb2NhdGlvbkRhdGEgPSBbXTtcclxuICAgICAgICBpZiAoZ29vZ2xlT25seSA9PSB0cnVlIHx8IGdvb2dsZU9ubHkgPT0gXCJ0cnVlXCIpIHtcclxuICAgICAgICBcdCRodHRwLmdldCgnaHR0cHM6Ly9tYXBzLmdvb2dsZWFwaXMuY29tL21hcHMvYXBpL2dlb2NvZGUvanNvbicsIHtcclxuICAgICAgICBcdFx0cGFyYW1zOiB7XHJcbiAgICAgICAgXHRcdFx0YWRkcmVzczogU2VhcmNoVGVybSArICcgJyArIGFkZHJlc3NSZXN0LFxyXG4gICAgICAgIFx0XHRcdHNlbnNvcjogdHJ1ZSxcclxuICAgICAgICBcdFx0XHRrZXk6ICdBSXphU3lDenRxUlRhUXpnQnh1MERNVjljREtxMEljaXFNYVFJNUUnXHJcbiAgICAgICAgXHRcdH0sXHJcbiAgICAgICAgXHRcdHdpdGhDcmVkZW50aWFsczogZmFsc2UsXHJcbiAgICAgICAgXHRcdHNraXBBdXRob3JpemF0aW9uOiB0cnVlXHJcbiAgICAgICAgXHR9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xyXG4gICAgICAgIFx0XHRHb29nbGVMb2NhdGlvbkZyb20gPSByZXNwb25zZS5kYXRhLnJlc3VsdHM7XHJcbiAgICAgICAgXHRcdGZvciAodmFyIGxvYyBpbiBHb29nbGVMb2NhdGlvbkZyb20pIHtcclxuICAgICAgICBcdFx0ICAgIGlmIChjaGVja0lmVmFsaWQoR29vZ2xlTG9jYXRpb25Gcm9tW2xvY10pKSB7XHJcbiAgICAgICAgXHRcdCAgICAgICAgbG9jYXRpb25EYXRhLnB1c2goXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZHJlc3M6IEdvb2dsZUxvY2F0aW9uRnJvbVtsb2NdLmZvcm1hdHRlZF9hZGRyZXNzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNHb29nbGVMb2NhdGlvbjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYzogR29vZ2xlTG9jYXRpb25Gcm9tW2xvY10sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogR29vZ2xlTG9jYXRpb25Gcm9tW2xvY10uTmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBHb29nbGVMb2NhdGlvbkZyb21bbG9jXS5mb3JtYXR0ZWRfYWRkcmVzc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICBcdFx0ICAgIH1cclxuICAgICAgICBcdFx0fVxyXG4gICAgICAgIFx0XHRkZWZlci5yZXNvbHZlKHsgXCJkYXRhXCI6IGxvY2F0aW9uRGF0YSB9KTtcclxuICAgICAgICBcdH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgXHRDb25maWdGYWN0b3J5LmdldE9uZU1WQXBpVVJMUHJvbWlzZSgpLnRoZW4oZnVuY3Rpb24gKG9uZU1WVVJMKSB7XHJcbiAgICAgICAgXHRcdGlmIChvbmVNVlVSTCAmJiBvbmVNVlVSTCAhPSBcIlwiKSB7XHJcbiAgICAgICAgXHRcdFx0dmFyIHNlcnZpY2VVcmwgPSBvbmVNVlVSTCArIFwibG9jYXRpb24vXCIgKyBkaXZpc2lvbklkICsgXCIvP1NlYXJjaFRlcm09XCIgKyBTZWFyY2hUZXJtO1xyXG5cclxuICAgICAgICBcdFx0XHQkaHR0cC5nZXQoc2VydmljZVVybClcclxuXHRcdFx0ICAgLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XHJcblx0XHRcdCAgIFx0QWRMb2NhdGlvbkZyb20gPSByZXNwb25zZS5kYXRhLnJlc3VsdDtcclxuXHRcdFx0ICAgXHRmb3IgKHZhciBsb2MgaW4gQWRMb2NhdGlvbkZyb20pIHtcclxuXHRcdFx0ICAgXHRcdGxvY2F0aW9uRGF0YS5wdXNoKFxyXG5cdFx0XHRcdFx0XHQge1xyXG5cdFx0XHRcdFx0XHQgXHRuYW1lOiBBZExvY2F0aW9uRnJvbVtsb2NdLk5hbWUsXHJcblx0XHRcdFx0XHRcdCBcdGFkZHJlc3M6IEFkTG9jYXRpb25Gcm9tW2xvY10uQWRkcmVzcyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICghaXNOdWxsT3JFbXB0eShBZExvY2F0aW9uRnJvbVtsb2NdLkNpdHkpID8gXCIsIFwiICsgQWRMb2NhdGlvbkZyb21bbG9jXS5DaXR5IDogXCIgXCIpICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCFpc051bGxPckVtcHR5KEFkTG9jYXRpb25Gcm9tW2xvY10uWmlwKSA/IFwiLCBcIiArIEFkTG9jYXRpb25Gcm9tW2xvY10uWmlwIDogXCJcIiksXHJcblx0XHRcdFx0XHRcdCBcdGlzR29vZ2xlTG9jYXRpb246IGZhbHNlLFxyXG5cdFx0XHRcdFx0XHQgXHRsb2M6IEFkTG9jYXRpb25Gcm9tW2xvY10sXHJcblx0XHRcdFx0XHRcdCBcdHRpdGxlOiBnZXRBZGRyZXNzKEFkTG9jYXRpb25Gcm9tLCBsb2MpLFxyXG5cdFx0XHRcdFx0XHQgXHRkZXNjcmlwdGlvbjogQWRMb2NhdGlvbkZyb21bbG9jXS5BZGRyZXNzICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCFpc051bGxPckVtcHR5KEFkTG9jYXRpb25Gcm9tW2xvY10uQ2l0eSkgPyBcIiwgXCIgKyBBZExvY2F0aW9uRnJvbVtsb2NdLkNpdHkgOiBcIiBcIikgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoIWlzTnVsbE9yRW1wdHkoQWRMb2NhdGlvbkZyb21bbG9jXS5aaXApID8gXCIsIFwiICsgQWRMb2NhdGlvbkZyb21bbG9jXS5aaXAgOiBcIlwiKVxyXG5cdFx0XHRcdFx0XHQgfSk7XHJcblx0XHRcdCAgIFx0fVxyXG5cdFx0XHQgICBcdGlmIChsb2NhdGlvbkZpbHRlciA9PSBmYWxzZSB8fCBsb2NhdGlvbkZpbHRlciA9PSBcImZhbHNlXCIpIHtcclxuXHRcdFx0ICAgXHRcdGRlZmVyLnJlc29sdmUoeyBcImRhdGFcIjogbG9jYXRpb25EYXRhIH0pO1xyXG5cdFx0XHQgICBcdFx0cmV0dXJuIGRlZmVyLnByb21pc2U7XHJcblx0XHRcdCAgIFx0fVxyXG5cdFx0XHQgICBcdGVsc2UgaWYgKGxvY2F0aW9uRmlsdGVyID09IHRydWUgfHwgbG9jYXRpb25GaWx0ZXIgPT0gXCJ0cnVlXCIpIHtcclxuXHJcblx0XHRcdCAgIFx0XHQkaHR0cC5nZXQoJ2h0dHBzOi8vbWFwcy5nb29nbGVhcGlzLmNvbS9tYXBzL2FwaS9nZW9jb2RlL2pzb24nLCB7XHJcblx0XHRcdCAgIFx0XHRcdHBhcmFtczoge1xyXG5cdFx0XHQgICBcdFx0XHRcdGFkZHJlc3M6IFNlYXJjaFRlcm0gKyAnICcgKyBhZGRyZXNzUmVzdCxcclxuXHRcdFx0ICAgXHRcdFx0XHRzZW5zb3I6IHRydWUsXHJcblx0XHRcdCAgIFx0XHRcdFx0a2V5OiAnQUl6YVN5Q3p0cVJUYVF6Z0J4dTBETVY5Y0RLcTBJY2lxTWFRSTVFJ1xyXG5cdFx0XHQgICBcdFx0XHR9LFxyXG5cdFx0XHQgICBcdFx0XHR3aXRoQ3JlZGVudGlhbHM6IGZhbHNlLFxyXG5cdFx0XHQgICBcdFx0XHRza2lwQXV0aG9yaXphdGlvbjogdHJ1ZVxyXG5cdFx0XHQgICBcdFx0fSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcclxuXHRcdFx0ICAgXHRcdFx0R29vZ2xlTG9jYXRpb25Gcm9tID0gcmVzcG9uc2UuZGF0YS5yZXN1bHRzO1xyXG5cdFx0XHQgICBcdFx0XHRmb3IgKHZhciBsb2MgaW4gR29vZ2xlTG9jYXRpb25Gcm9tKSB7XHJcblx0XHRcdCAgIFx0XHRcdCAgICBpZiAoY2hlY2tJZlZhbGlkKEdvb2dsZUxvY2F0aW9uRnJvbVtsb2NdKSkge1xyXG5cdFx0XHQgICBcdFx0XHQgICAgICAgIGxvY2F0aW9uRGF0YS5wdXNoKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZHJlc3M6IEdvb2dsZUxvY2F0aW9uRnJvbVtsb2NdLmZvcm1hdHRlZF9hZGRyZXNzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzR29vZ2xlTG9jYXRpb246IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jOiBHb29nbGVMb2NhdGlvbkZyb21bbG9jXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogR29vZ2xlTG9jYXRpb25Gcm9tW2xvY10uTmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogR29vZ2xlTG9jYXRpb25Gcm9tW2xvY10uZm9ybWF0dGVkX2FkZHJlc3NcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cdFx0XHQgICBcdFx0XHQgICAgfVxyXG5cdFx0XHQgICBcdFx0XHR9XHJcblx0XHRcdCAgIFx0XHRcdGRlZmVyLnJlc29sdmUoeyBcImRhdGFcIjogbG9jYXRpb25EYXRhIH0pO1xyXG5cdFx0XHQgICBcdFx0fSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjayhlcnIpIHtcclxuXHRcdFx0ICAgXHRcdFx0ZGVmZXIucmVqZWN0KGVycik7XHJcblx0XHRcdCAgIFx0XHR9KTtcclxuXHRcdFx0ICAgXHR9XHJcblx0XHRcdCAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2soZXJyKSB7XHJcblx0XHRcdCAgIFx0ZGVmZXIucmVqZWN0KGVycik7XHJcblx0XHRcdCAgIH0pO1xyXG5cclxuXHJcbiAgICAgICAgXHRcdH1cclxuICAgICAgICBcdH0sIGZ1bmN0aW9uIGVycm9yaGFuZGxlcihlcnIpIHtcclxuICAgICAgICBcdH0pO1xyXG4gICAgICAgIFx0c2V0TG9jYXRpb25GaWx0ZXIobG9jYXRpb25maWx0ZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZGVmZXIucHJvbWlzZTtcclxuICAgIH07XHJcbn1cclxuXHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnb25lTVZBcHAnKS5mYWN0b3J5KCdTZWN1cml0eUZhY3RvcnknLCBTZWN1cml0eUZhY3RvcnkpO1xyXG4gICAgU2VjdXJpdHlGYWN0b3J5LiRpbmplY3QgPSBbJyRodHRwJywgJyRxJywgJyRjYWNoZUZhY3RvcnknLCAnc2VjdXJpdHlTZXJ2aWNlJ107XHJcblxyXG5cclxuICAgIGZ1bmN0aW9uIFNlY3VyaXR5RmFjdG9yeSgkaHR0cCwgJHEsICRjYWNoZUZhY3RvcnksIHNlY3VyaXR5U2VydmljZSkge1xyXG4gICAgICAgIHZhciBfcGVybWlzc2lvbnMgPSB7fTtcclxuICAgICAgICB2YXIgY2FjaGUgPSAkY2FjaGVGYWN0b3J5KFwiUGVybWlzc2lvbnNDYWNoZVwiKTtcclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgZ2V0UGVybWlzc2lvbnM6IGdldFBlcm1pc3Npb25zLFxyXG4gICAgICAgICAgICBnZXRMb2FkZWRQZXJtaXNzaW9uczogZ2V0TG9hZGVkUGVybWlzc2lvbnMsXHJcbiAgICAgICAgICAgIHNldHVwU2Vzc2lvbjogc2V0dXBTZXNzaW9uXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0UGVybWlzc2lvbnModXNlcklkLCBkaXZpc2lvbmlkKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlciA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIF9wZXJtaXNzaW9ucyA9IGNhY2hlLmdldChcInBlcm1pc3Npb25zXCIpO1xyXG4gICAgICAgICAgICBpZiAoX3Blcm1pc3Npb25zKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlci5yZXNvbHZlKF9wZXJtaXNzaW9ucyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzZWN1cml0eVNlcnZpY2UuZ2V0UGVybWlzc2lvbnModXNlcklkLCBkaXZpc2lvbmlkKS50aGVuKGZ1bmN0aW9uIChwZXJtaXNzaW9ucykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhY2hlLnB1dChcInBlcm1pc3Npb25zXCIsIHBlcm1pc3Npb25zKTtcclxuICAgICAgICAgICAgICAgICAgICBkZWZlci5yZXNvbHZlKHBlcm1pc3Npb25zKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlci5wcm9taXNlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNldHVwU2Vzc2lvbih1c2VySWQsIGRpdmlzaW9uaWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHNlY3VyaXR5U2VydmljZS5zZXR1cFNlc3Npb24odXNlcklkLCBkaXZpc2lvbmlkKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRMb2FkZWRQZXJtaXNzaW9ucygpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGNhY2hlLmdldChcInBlcm1pc3Npb25zXCIpO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG5cclxufSkoKTtcclxuXHJcblxyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnb25lTVZBcHAnKS5mYWN0b3J5KCdVdGlsaXR5RmFjdG9yeScsIFV0aWxpdHlGYWN0b3J5KTtcclxuICAgIFV0aWxpdHlGYWN0b3J5LiRpbmplY3QgPSBbJyRsb2cnLCAnJHdpbmRvdyddO1xyXG4gICAgZnVuY3Rpb24gVXRpbGl0eUZhY3RvcnkoJGxvZywgJHdpbmRvdykge1xyXG5cclxuXHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XHJcblxyXG4gICAgICAgICAgICBnZXREYXRhOiBnZXREYXRhLFxyXG4gICAgICAgICAgICBzZXREYXRhOiBzZXREYXRhLFxyXG4gICAgICAgICAgICBnZXRBUElCYXNlVXJsOiBnZXRBUElCYXNlVXJsLFxyXG5cclxuICAgICAgICAgICAgdG9hc3RFcnJvcjogdG9hc3RFcnJvcixcclxuICAgICAgICAgICAgdG9hc3RJbmZvOiB0b2FzdEluZm8sXHJcbiAgICAgICAgICAgIHRvYXN0U3VjY2VzczogdG9hc3RTdWNjZXNzLFxyXG4gICAgICAgICAgICB0b2FzdFdhcm5pbmc6IHRvYXN0V2FybmluZyxcclxuXHJcbiAgICAgICAgICAgIGxvZ0Vycm9yOiBsb2dFcnJvcixcclxuICAgICAgICAgICAgbG9nSW5mbzogbG9nSW5mbyxcclxuICAgICAgICAgICAgbG9nU3VjY2VzczogbG9nU3VjY2VzcyxcclxuICAgICAgICAgICAgbG9nV2FybmluZzogbG9nV2FybmluZyxcclxuXHJcbiAgICAgICAgICAgIGxvZzogJGxvZy5sb2csXHJcblxyXG4gICAgICAgICAgICBnZXRVc1N0YXRlczogZ2V0VXNTdGF0ZXMsXHJcbiAgICAgICAgICAgIGdldEJyb3dzZXJJbmZvOiBnZXRCcm93c2VySW5mbyxcclxuXHJcbiAgICAgICAgICAgIGlzQ2hyb21lOiBpc0Nocm9tZSxcclxuICAgICAgICAgICAgaXNJRTogaXNJRSxcclxuICAgICAgICAgICAgaXNGaXJlZm94OiBpc0ZpcmVmb3gsXHJcbiAgICAgICAgICAgIGlzU2FmYXJpOiBpc1NhZmFyaSxcclxuXHJcbiAgICAgICAgICAgIHVzU3RhdGVzOiBbXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJBbGFiYW1hXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiQUxcIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJBbGFza2FcIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJBS1wiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIkFtZXJpY2FuIFNhbW9hXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiQVNcIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJBcml6b25hXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiQVpcIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJBcmthbnNhc1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICBcImFiYnJldmlhdGlvblwiOiBcIkFSXCJcclxuICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiQ2FsaWZvcm5pYVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICBcImFiYnJldmlhdGlvblwiOiBcIkNBXCJcclxuICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiQ29sb3JhZG9cIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJDT1wiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIkNvbm5lY3RpY3V0XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiQ1RcIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJEZWxhd2FyZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICBcImFiYnJldmlhdGlvblwiOiBcIkRFXCJcclxuICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiRGlzdHJpY3QgT2YgQ29sdW1iaWFcIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJEQ1wiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIkZlZGVyYXRlZCBTdGF0ZXMgT2YgTWljcm9uZXNpYVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICBcImFiYnJldmlhdGlvblwiOiBcIkZNXCJcclxuICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiRmxvcmlkYVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICBcImFiYnJldmlhdGlvblwiOiBcIkZMXCJcclxuICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiR2VvcmdpYVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICBcImFiYnJldmlhdGlvblwiOiBcIkdBXCJcclxuICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiR3VhbVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICBcImFiYnJldmlhdGlvblwiOiBcIkdVXCJcclxuICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiSGF3YWlpXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiSElcIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJJZGFob1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICBcImFiYnJldmlhdGlvblwiOiBcIklEXCJcclxuICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiSWxsaW5vaXNcIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJJTFwiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIkluZGlhbmFcIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJJTlwiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIklvd2FcIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJJQVwiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIkthbnNhc1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICBcImFiYnJldmlhdGlvblwiOiBcIktTXCJcclxuICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiS2VudHVja3lcIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJLWVwiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIkxvdWlzaWFuYVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICBcImFiYnJldmlhdGlvblwiOiBcIkxBXCJcclxuICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiTWFpbmVcIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJNRVwiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIk1hcnNoYWxsIElzbGFuZHNcIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJNSFwiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIk1hcnlsYW5kXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiTURcIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJNYXNzYWNodXNldHRzXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiTUFcIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJNaWNoaWdhblwiLFxyXG4gICAgICAgICAgICAgICAgICAgICBcImFiYnJldmlhdGlvblwiOiBcIk1JXCJcclxuICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiTWlubmVzb3RhXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiTU5cIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJNaXNzaXNzaXBwaVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICBcImFiYnJldmlhdGlvblwiOiBcIk1TXCJcclxuICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiTWlzc291cmlcIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJNT1wiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIk1vbnRhbmFcIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJNVFwiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIk5lYnJhc2thXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiTkVcIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJOZXZhZGFcIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJOVlwiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIk5ldyBIYW1wc2hpcmVcIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJOSFwiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIk5ldyBKZXJzZXlcIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJOSlwiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIk5ldyBNZXhpY29cIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJOTVwiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIk5ldyBZb3JrXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiTllcIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJOb3J0aCBDYXJvbGluYVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICBcImFiYnJldmlhdGlvblwiOiBcIk5DXCJcclxuICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiTm9ydGggRGFrb3RhXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiTkRcIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJOb3J0aGVybiBNYXJpYW5hIElzbGFuZHNcIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJNUFwiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIk9oaW9cIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJPSFwiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIk9rbGFob21hXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiT0tcIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJPcmVnb25cIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJPUlwiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIlBhbGF1XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiUFdcIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJQZW5uc3lsdmFuaWFcIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJQQVwiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIlB1ZXJ0byBSaWNvXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiUFJcIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJSaG9kZSBJc2xhbmRcIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJSSVwiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIlNvdXRoIENhcm9saW5hXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiU0NcIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJTb3V0aCBEYWtvdGFcIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJTRFwiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIlRlbm5lc3NlZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICBcImFiYnJldmlhdGlvblwiOiBcIlROXCJcclxuICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiVGV4YXNcIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJUWFwiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIlV0YWhcIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJVVFwiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIlZlcm1vbnRcIixcclxuICAgICAgICAgICAgICAgICAgICAgXCJhYmJyZXZpYXRpb25cIjogXCJWVFwiXHJcbiAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIlZpcmdpbiBJc2xhbmRzXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiVklcIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJWaXJnaW5pYVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICBcImFiYnJldmlhdGlvblwiOiBcIlZBXCJcclxuICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiV2FzaGluZ3RvblwiLFxyXG4gICAgICAgICAgICAgICAgICAgICBcImFiYnJldmlhdGlvblwiOiBcIldBXCJcclxuICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiV2VzdCBWaXJnaW5pYVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICBcImFiYnJldmlhdGlvblwiOiBcIldWXCJcclxuICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiV2lzY29uc2luXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiV0lcIlxyXG4gICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJXeW9taW5nXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgIFwiYWJicmV2aWF0aW9uXCI6IFwiV1lcIlxyXG4gICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXVxyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcblxyXG4gICAgICAgIC8vICAqKioqKioqKioqKioqICBiYXNlIGFwaSBVUkwgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuICAgICAgICAvLyBUaGlzIHdpbGwgYmUgcmVtb3ZlZCBhbmQgbW92ZWQgdG8gYSBDb25maWdGYWN0b3J5IGFuZCB0byBVU0UgYSBKU09OIGRhdGEgXHJcbiAgICAgICAgdmFyIGFwaUJhc2VVcmwgPSAnaHR0cHM6Ly9vbmVtdmFwaS1kZXYubXZ0cmFuc2l0LmNvbS9hcGkvJztcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0QVBJQmFzZVVybCgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGFwaUJhc2VVcmw7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgLy8gKioqKioqKioqICAgc2Vzc2lvbiAgICAqKioqKioqKioqKioqKioqKioqXHJcblxyXG4gICAgICAgIC8vc2V0IGRlZmF1bHQgdmFsdWVzIDFzdCAgLS0tIG5vdCB1c2luZyB0byByZW1vdmUgXHJcbiAgICAgICAgLy9kYXRhWydpc0Rpc3BhdGNoJ10gPSBmYWxzZTtcclxuICAgICAgICAvL2RhdGFbJ2lzUmVwb3J0aW5nJ10gPSBmYWxzZTtcclxuICAgICAgICAvL2RhdGFbJ2lzVXNlck1hbmFnZW1lbnQnXSA9IGZhbHNlO1xyXG5cclxuICAgICAgICB2YXIgZGF0YSA9IHt9O1xyXG5cclxuXHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXREYXRhKGtleSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZGF0YVtrZXldO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNldERhdGEoa2V5LCB2YWx1ZSkge1xyXG4gICAgICAgICAgICBkYXRhW2tleV0gPSB2YWx1ZTtcclxuICAgICAgICB9O1xyXG5cclxuXHJcblxyXG4gICAgICAgIC8vICoqKioqKioqKioqKiogICAtLS0gICAgZ2V0IGJyb3dzZXIgaW5mb3JtYXRpb24gXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldEJyb3dzZXJJbmZvKCkge1xyXG5cclxuICAgICAgICAgICAgdmFyIHVzZXJBZ2VudCA9ICR3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudDtcclxuXHJcbiAgICAgICAgICAgIHZhciBicm93c2VycyA9IHsgY2hyb21lOiAvY2hyb21lL2ksIHNhZmFyaTogL3NhZmFyaS9pLCBmaXJlZm94OiAvZmlyZWZveC9pLCBpZTogL2ludGVybmV0IGV4cGxvcmVyL2kgfTtcclxuXHJcbiAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBicm93c2Vycykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGJyb3dzZXJzW2tleV0udGVzdCh1c2VyQWdlbnQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGtleTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiAndW5rbm93bic7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gKioqKioqKioqKioqKiAgIC0tLSAgICBkZXRlY3QgYnJvd3NlcnMgaW5mb3JtYXRpb24gXHJcbiAgICAgICAgZnVuY3Rpb24gaXNDaHJvbWUoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAhIXdpbmRvdy5jaHJvbWUgJiYgISF3aW5kb3cuY2hyb21lLndlYnN0b3JlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBpc0lFKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2UgfHwgISFkb2N1bWVudC5kb2N1bWVudE1vZGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIGlzRmlyZWZveCgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiBJbnN0YWxsVHJpZ2dlciAhPT0gJ3VuZGVmaW5lZCc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIGlzU2FmYXJpKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHdpbmRvdy5IVE1MRWxlbWVudCkuaW5kZXhPZignQ29uc3RydWN0b3InKSA+IDA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyAgKioqKioqKioqICAgVG9hc3RlciAgICAqKioqKioqKioqKioqKioqKioqXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHRvYXN0RXJyb3IodGl0bGUsIG1lc3NhZ2UsIHRpbWVvdXQpIHtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB0aW1lb3V0ID0gdGltZW91dCB8fCAxMDAwO1xyXG4gICAgICAgICAgICB0b2FzdHIuZXJyb3IobWVzc2FnZSwgdGl0bGUsIHsgdGltZU91dDogdGltZW91dCB9KTtcclxuXHJcbiAgICAgICAgICAgICRsb2cuZXJyb3IoJ0Vycm9yOiAtICcgKyB0aXRsZSArICcgIC0gJyArIG1lc3NhZ2UsICcnKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdG9hc3RJbmZvKHRpdGxlLCBtZXNzYWdlLCB0aW1lb3V0KSB7XHJcblxyXG4gICAgICAgICAgICB0aW1lb3V0ID0gdGltZW91dCB8fCAxMDAwO1xyXG5cclxuICAgICAgICAgICAgdG9hc3RyLmluZm8obWVzc2FnZSwgdGl0bGUsIHtcclxuICAgICAgICAgICAgICAgIHRpbWVPdXQ6IHRpbWVvdXRcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiB0b2FzdFN1Y2Nlc3ModGl0bGUsIG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MobWVzc2FnZSwgdGl0bGUpO1xyXG4gICAgICAgICAgICAkbG9nLmRlYnVnKCdTdWNjZXNzOiAtICcgKyB0aXRsZSArICcgIC0gJyArIG1lc3NhZ2UsICcnKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdG9hc3RXYXJuaW5nKHRpdGxlLCBtZXNzYWdlKSB7XHJcbiAgICAgICAgICAgIHRvYXN0ci53YXJuaW5nKG1lc3NhZ2UsIHRpdGxlKTtcclxuICAgICAgICAgICAgJGxvZy53YXJuKCdXYXJuaW5nOiAtICcgKyB0aXRsZSArICcgIC0gJyArIG1lc3NhZ2UsICcnKVxyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIC8vICAqKioqKioqKiogICBMb2dnaW5nICAgICoqKioqKioqKioqKioqKioqKipcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbG9nRXJyb3IobWVzc2FnZSwgZGF0YSkge1xyXG4gICAgICAgICAgICAkbG9nLmVycm9yKCdFcnJvcjonICsgbWVzc2FnZSwgZGF0YSlcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGxvZ0luZm8obWVzc2FnZSwgZGF0YSkge1xyXG4gICAgICAgICAgICAkbG9nLmluZm8oJ0luZm86JyArIG1lc3NhZ2UsIGRhdGEpXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBsb2dTdWNjZXNzKG1lc3NhZ2UsIGRhdGEpIHtcclxuICAgICAgICAgICAgJGxvZy5kZWJ1ZygnU3VjY2VzczonICsgbWVzc2FnZSwgZGF0YSlcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGxvZ1dhcm5pbmcobWVzc2FnZSwgZGF0YSkge1xyXG4gICAgICAgICAgICAkbG9nLndhcm4oJ1dhcm5pbmc6JyArIG1lc3NhZ2UsIGRhdGEpXHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgLy8gICoqKioqKioqKiAgIFVTIFN0YXRlICAgICoqKioqKioqKioqKioqKioqKipcclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFVzU3RhdGVzKCkge1xyXG4gICAgICAgICAgICAvL2RlYnVnZ2VyO1xyXG4gICAgICAgICAgICByZXR1cm4gc2VydmljZS51c1N0YXRlcztcclxuICAgICAgICB9XHJcblxyXG4gICAgfTtcclxuXHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuZmFjdG9yeSgnYXV0aEludGVyY2VwdG9yU2VydmljZScsIGF1dGhJbnRlcmNlcHRvclNlcnZpY2UpO1xyXG5cclxuICAgIGF1dGhJbnRlcmNlcHRvclNlcnZpY2UuJGluamVjdCA9IFsnJHEnLCAnJGluamVjdG9yJywgJyRsb2NhdGlvbicsICckcm9vdFNjb3BlJywgJ2xvY2FsU3RvcmFnZVNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBhdXRoSW50ZXJjZXB0b3JTZXJ2aWNlKCRxLCAkaW5qZWN0b3IsJGxvY2F0aW9uLCRyb290U2NvcGUsIGxvY2FsU3RvcmFnZVNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgYXV0aEludGVyY2VwdG9yU2VydmljZUZhY3RvcnkgPSB7fTtcclxuXHJcbiAgICAgICAgdmFyIF9yZXF1ZXN0ID0gZnVuY3Rpb24gKGNvbmZpZykge1xyXG5cclxuICAgICAgICAgICAgY29uZmlnLmhlYWRlcnMgPSBjb25maWcuaGVhZGVycyB8fCB7fTtcclxuXHJcblxyXG4gICAgICAgICAgICBpZiAoIWNvbmZpZy51cmwuaW5jbHVkZXMoJ2h0dHBzOi8vbWFwcy5nb29nbGVhcGlzLmNvbScpKSB7XHJcbiAgICAgICAgICAgIFx0dmFyIGF1dGhEYXRhID0gbG9jYWxTdG9yYWdlU2VydmljZS5nZXQoJ2F1dGhvcml6YXRpb25EYXRhJyk7XHJcbiAgICAgICAgICAgIFx0aWYgKGF1dGhEYXRhKSB7XHJcbiAgICAgICAgICAgIFx0XHRjb25maWcuaGVhZGVycy5BdXRob3JpemF0aW9uID0gJ0JlYXJlciAnICsgYXV0aERhdGEudG9rZW47XHJcbiAgICAgICAgICAgIFx0fVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gY29uZmlnO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIF9yZXNwb25zZUVycm9yID0gZnVuY3Rpb24gKHJlamVjdGlvbikge1xyXG4gICAgICAgICAgICBpZiAocmVqZWN0aW9uLnN0YXR1cyA9PT0gNDAxKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYXV0aFNlcnZpY2UgPSAkaW5qZWN0b3IuZ2V0KCdhdXRoU2VydmljZScpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGF1dGhEYXRhID0gbG9jYWxTdG9yYWdlU2VydmljZS5nZXQoJ2F1dGhvcml6YXRpb25EYXRhJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgYXV0aFNlcnZpY2UubG9nT3V0KCkudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdsb2dnZWRvdXQnLCBudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2xvZ2luJyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiAkcS5yZWplY3QocmVqZWN0aW9uKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGF1dGhJbnRlcmNlcHRvclNlcnZpY2VGYWN0b3J5LnJlcXVlc3QgPSBfcmVxdWVzdDtcclxuICAgICAgICBhdXRoSW50ZXJjZXB0b3JTZXJ2aWNlRmFjdG9yeS5yZXNwb25zZUVycm9yID0gX3Jlc3BvbnNlRXJyb3I7XHJcblxyXG4gICAgICAgIHJldHVybiBhdXRoSW50ZXJjZXB0b3JTZXJ2aWNlRmFjdG9yeTtcclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIC8vdmFyIGF1dGhBcHAgPSBhbmd1bGFyLm1vZHVsZSgnYXV0aEFwcCcsIFtdKTtcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuZmFjdG9yeSgnYXV0aFNlcnZpY2UnLCBhdXRoU2VydmljZSk7XHJcblxyXG4gICAgYXV0aFNlcnZpY2UuJGluamVjdCA9IFsnJHJvb3RTY29wZScsJyRodHRwJywgJyRxJyAsJ2xvY2FsU3RvcmFnZVNlcnZpY2UnLCAnZW52J107XHJcblxyXG4gICAgZnVuY3Rpb24gYXV0aFNlcnZpY2UoJHJvb3RTY29wZSwgJGh0dHAsICRxLCBsb2NhbFN0b3JhZ2VTZXJ2aWNlLCBlbnYpIHtcclxuICAgICAgICB2YXIgc2VydmljZUJhc2UgPSBlbnYuYXV0aFNlcnZlclVybDtcclxuICAgICAgICB2YXIgYXV0aFNlcnZpY2VGYWN0b3J5ID0ge307XHJcblxyXG4gICAgICAgIHZhciBfYXV0aGVudGljYXRpb24gPSB7XHJcbiAgICAgICAgICAgIGlzQXV0aDogZmFsc2UsXHJcbiAgICAgICAgICAgIHBhc3NlbmdlcklkOiBcIlwiLFxyXG4gICAgICAgICAgICB1c2VySWQ6IFwiXCIsXHJcbiAgICAgICAgICAgIHVzZVJlZnJlc2hUb2tlbnM6IGZhbHNlXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIF9leHRlcm5hbEF1dGhEYXRhID0ge1xyXG4gICAgICAgICAgICBwcm92aWRlcjogXCJcIixcclxuICAgICAgICAgICAgdXNlck5hbWU6IFwiXCIsXHJcbiAgICAgICAgICAgIGV4dGVybmFsQWNjZXNzVG9rZW46IFwiXCIsXHJcbiAgICAgICAgICAgIGZpcnN0TmFtZTogXCJcIixcclxuICAgICAgICAgICAgbGFzdE5hbWU6IFwiXCJcclxuICAgICAgICB9O1xyXG4gICAgICAgXHJcbiAgICAgICAgJHJvb3RTY29wZS4kb24oJ2xvZ2dlZEluJywgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgZGVidWdnZXI7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdsb2dnZWRJbicsIGRhdGEpO1xyXG4gICAgICAgICAgICB2YXIgbXNnID0ge307XHJcbiAgICAgICAgICAgIG1zZy50eXBlID0gXCJyZWdpc3Rlcl9wdXNoXCI7XHJcbiAgICAgICAgICAgIG1zZy5hbGlhcyA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwibHMuYWxpYXNcIik7XHJcbiAgICAgICAgICAgIG1zZy5kaXZpc2lvbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwibHMuZGl2aXNpb25cIik7XHJcbiAgICAgICAgICAgIHZhciBhdXRoRGF0YSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwibHMuYXV0aG9yaXphdGlvbkRhdGFcIik7XHJcbiAgICAgICAgICAgIHRyeXtcclxuICAgICAgICAgICAgICAgIHZhciBhdXRoRGF0YU9iaiA9IEpTT04ucGFyc2UoYXV0aERhdGEpO1xyXG4gICAgICAgICAgICAgICAgbXNnLnBhc3NlbmdlcklkID0gYXV0aERhdGFPYmoucGFzc2VuZ2VySWQ7XHJcbiAgICAgICAgICAgICAgICB3aW5kb3cucG9zdE1lc3NhZ2UoSlNPTi5zdHJpbmdpZnkobXNnKSk7XHJcbiAgICAgICAgICAgIH1jYXRjaChlKXtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZXJyb3IgY2FsbGluZyBwdXNoIHJlZ2lzdHJhdGlvblwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgXHJcbiAgICAgICAgdmFyIF9zYXZlUmVnaXN0cmF0aW9uID0gZnVuY3Rpb24gKHJlZ2lzdHJhdGlvbikge1xyXG5cclxuICAgICAgICAgICAgX2xvZ091dCgpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3Qoc2VydmljZUJhc2UgKyAnYWNjb3VudC9yZWdpc3RlcicsIHJlZ2lzdHJhdGlvbikudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBfbG9naW4gPSBmdW5jdGlvbiAobG9naW5EYXRhKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgZGF0YSA9IFwiZ3JhbnRfdHlwZT1wYXNzd29yZCZ1c2VybmFtZT1cIiArIGxvZ2luRGF0YS51c2VyTmFtZSArIFwiJnBhc3N3b3JkPVwiICsgbG9naW5EYXRhLnBhc3N3b3JkO1xyXG5cclxuICAgICAgICAgICAgaWYgKGxvZ2luRGF0YS51c2VSZWZyZXNoVG9rZW5zKSB7XHJcbiAgICAgICAgICAgICAgICBkYXRhID0gZGF0YSArIFwiJmNsaWVudF9pZD1cIiArIFwibW9iaVdlYlwiO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG5cclxuICAgICAgICAgICAgJGh0dHAucG9zdChzZXJ2aWNlQmFzZSArICd0b2tlbicsIGRhdGEsIHsgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcgfSB9KS5zdWNjZXNzKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChsb2dpbkRhdGEudXNlUmVmcmVzaFRva2Vucykge1xyXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZVNlcnZpY2Uuc2V0KCdhdXRob3JpemF0aW9uRGF0YScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuOiByZXNwb25zZS5hY2Nlc3NfdG9rZW4sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyTmFtZTogbG9naW5EYXRhLnVzZXJOYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmcmVzaFRva2VuOiByZXNwb25zZS5yZWZyZXNoX3Rva2VuLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlUmVmcmVzaFRva2VuczogdHJ1ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZVNlcnZpY2Uuc2V0KCdhdXRob3JpemF0aW9uRGF0YScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuOiByZXNwb25zZS5hY2Nlc3NfdG9rZW4sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyTmFtZTogbG9naW5EYXRhLnVzZXJOYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmcmVzaFRva2VuOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlUmVmcmVzaFRva2VuczogZmFsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBfYXV0aGVudGljYXRpb24uaXNBdXRoID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIF9hdXRoZW50aWNhdGlvbi51c2VyTmFtZSA9IGxvZ2luRGF0YS51c2VyTmFtZTtcclxuICAgICAgICAgICAgICAgIF9hdXRoZW50aWNhdGlvbi51c2VSZWZyZXNoVG9rZW5zID0gbG9naW5EYXRhLnVzZVJlZnJlc2hUb2tlbnM7XHJcblxyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcblxyXG4gICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyLCBzdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgIF9sb2dPdXQoKTtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG5cclxuICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgdmFyIF9jbGVhclVwU2Vzc2lvbiA9IGZ1bmN0aW9uICgpIHsgICAgICAgICAgICBcclxuXHJcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZVNlcnZpY2UucmVtb3ZlKCdhdXRob3JpemF0aW9uRGF0YScpO1xyXG5cclxuICAgICAgICAgICAgX2F1dGhlbnRpY2F0aW9uLmlzQXV0aCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBfYXV0aGVudGljYXRpb24ucGFzc2VuZ2VySWQgPSBcIlwiO1xyXG4gICAgICAgICAgICBfYXV0aGVudGljYXRpb24udXNlUmVmcmVzaFRva2VucyA9IGZhbHNlO1xyXG4gICAgICAgICAgICBfYXV0aGVudGljYXRpb24udXNlcklkID0gXCJcIjtcclxuICAgICAgICAgICAgX2F1dGhlbnRpY2F0aW9uLmxvZ2luUHJvdmlkZXIgPSBcIlwiO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIF9sb2dPdXQgPSBmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG5cclxuICAgICAgICAgICAgJGh0dHAucG9zdChlbnYuYXV0aFNlcnZlclVybCArICdhY2NvdW50L3NpZ25vdXQnLCB7fSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBfY2xlYXJVcFNlc3Npb24oKTtcclxuXHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1VuYWJsZSB0byBsb2dvdXQgdXNlci4nKTtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgdmFyIF9maWxsQXV0aERhdGEgPSBmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgYXV0aERhdGEgPSBsb2NhbFN0b3JhZ2VTZXJ2aWNlLmdldCgnYXV0aG9yaXphdGlvbkRhdGEnKTtcclxuICAgICAgICAgICAgaWYgKGF1dGhEYXRhKSB7XHJcbiAgICAgICAgICAgICAgICBfYXV0aGVudGljYXRpb24uaXNBdXRoID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIF9hdXRoZW50aWNhdGlvbi51c2VSZWZyZXNoVG9rZW5zID0gYXV0aERhdGEudXNlUmVmcmVzaFRva2VucztcclxuICAgICAgICAgICAgICAgIF9hdXRoZW50aWNhdGlvbi51c2VySWQgPSBhdXRoRGF0YS51c2VySWQ7XHJcbiAgICAgICAgICAgICAgICBfYXV0aGVudGljYXRpb24ucGFzc2VuZ2VySWQgPSBhdXRoRGF0YS5wYXNzZW5nZXJJZDtcclxuICAgICAgICAgICAgICAgIF9hdXRoZW50aWNhdGlvbi5sb2dpblByb3ZpZGVyID0gYXV0aERhdGEubG9naW5Qcm92aWRlcjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBfaXNMb2dnZWRJbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIGF1dGhEYXRhID0gbG9jYWxTdG9yYWdlU2VydmljZS5nZXQoJ2F1dGhvcml6YXRpb25EYXRhJyk7XHJcbiAgICAgICAgICAgIGlmIChhdXRoRGF0YSAmJiBhdXRoRGF0YS51c2VySWQgIT09IFwiXCIpIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgdmFyIF9yZWZyZXNoVG9rZW4gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcblxyXG4gICAgICAgICAgICB2YXIgYXV0aERhdGEgPSBsb2NhbFN0b3JhZ2VTZXJ2aWNlLmdldCgnYXV0aG9yaXphdGlvbkRhdGEnKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChhdXRoRGF0YSkge1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChhdXRoRGF0YS51c2VSZWZyZXNoVG9rZW5zKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBkYXRhID0gXCJncmFudF90eXBlPXJlZnJlc2hfdG9rZW4mcmVmcmVzaF90b2tlbj1cIiArYXV0aERhdGEucmVmcmVzaFRva2VuICsgXCImY2xpZW50X2lkPVwiICtuZ0F1dGhTZXR0aW5ncy5jbGllbnRJZDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlU2VydmljZS5yZW1vdmUoJ2F1dGhvcml6YXRpb25EYXRhJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICRodHRwLnBvc3Qoc2VydmljZUJhc2UgKyAndG9rZW4nLCBkYXRhLCB7IGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnIH0gfSkuc3VjY2VzcyhmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZVNlcnZpY2Uuc2V0KCdhdXRob3JpemF0aW9uRGF0YScsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuOiByZXNwb25zZS5hY2Nlc3NfdG9rZW4sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZyZXNoVG9rZW46IHJlc3BvbnNlLnJlZnJlc2hfdG9rZW4sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VSZWZyZXNoVG9rZW5zOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9naW5Qcm92aWRlcjogcmVzcG9uc2UubG9naW5Qcm92aWRlclxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnIsIHN0YXR1cykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfbG9nT3V0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHZhciBfY2hlY2tVc2VySGFzUmVnaXN0ZXJlZCA9IGZ1bmN0aW9uIChleHRlcm5hbERhdGEpIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgJGh0dHAuZ2V0KHNlcnZpY2VCYXNlICsgJ2FjY291bnQvQ2hlY2tVc2VySGFzUmVnaXN0ZXJlZCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm92aWRlcjogZXh0ZXJuYWxEYXRhLnByb3ZpZGVyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvdmlkZXJLZXk6IGV4dGVybmFsRGF0YS5wcm92aWRlcktleSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpdmlzaW9uSWQ6IGV4dGVybmFsRGF0YS5kaXZpc2lvbklkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlck5hbWU6IGV4dGVybmFsRGF0YS51c2VyTmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpdmlzaW9uU3VwcG9ydHNGZWVkOiBleHRlcm5hbERhdGEuZGl2aXNpb25TdXBwb3J0c0ZlZWRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbiAoc3VjY2Vzcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoc3VjY2Vzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyLCBzdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIF9vYnRhaW5BY2Nlc3NUb2tlbiA9IGZ1bmN0aW9uIChleHRlcm5hbERhdGEpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcblxyXG4gICAgICAgICAgICAkaHR0cC5nZXQoc2VydmljZUJhc2UgKyAnYWNjb3VudC9PYnRhaW5Mb2NhbEFjY2Vzc1Rva2VuJyxcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBwYXJhbXM6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3ZpZGVyOiBleHRlcm5hbERhdGEucHJvdmlkZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHRlcm5hbEFjY2Vzc1Rva2VuOiBleHRlcm5hbERhdGEuZXh0ZXJuYWxBY2Nlc3NUb2tlbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpdmlzaW9uSWQ6IGV4dGVybmFsRGF0YS5kaXZpc2lvbklkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlck5hbWU6ZXh0ZXJuYWxEYXRhLnVzZXJOYW1lXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAocmVzcG9uc2UpIHsgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZVNlcnZpY2Uuc2V0KCdhdXRob3JpemF0aW9uRGF0YScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuOiByZXNwb25zZS5hY2Nlc3NfdG9rZW4sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZyZXNoVG9rZW46IFwiXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VSZWZyZXNoVG9rZW5zOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJJZDogcmVzcG9uc2UudXNlcklkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzc2VuZ2VySWQ6IHJlc3BvbnNlLnBhc3NlbmdlcklkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9naW5Qcm92aWRlcjogcmVzcG9uc2UubG9naW5Qcm92aWRlclxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBfYXV0aGVudGljYXRpb24uaXNBdXRoID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIF9hdXRoZW50aWNhdGlvbi51c2VSZWZyZXNoVG9rZW5zID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBfYXV0aGVudGljYXRpb24udXNlcklkID0gcmVzcG9uc2UudXNlcklkO1xyXG4gICAgICAgICAgICAgICAgX2F1dGhlbnRpY2F0aW9uLnBhc3NlbmdlcklkID0gcmVzcG9uc2UucGFzc2VuZ2VySWQ7XHJcbiAgICAgICAgICAgICAgICBfYXV0aGVudGljYXRpb24ubG9naW5Qcm92aWRlciA9IHJlc3BvbnNlLmxvZ2luUHJvdmlkZXI7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuXHJcbiAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnIsIHN0YXR1cykge1xyXG4gICAgICAgICAgICAgICAgX2xvZ091dCgpO1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIF9yZWdpc3RlckV4dGVybmFsID0gZnVuY3Rpb24gKHJlZ2lzdGVyRXh0ZXJuYWxEYXRhKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG5cclxuICAgICAgICAgICAgJGh0dHAucG9zdChzZXJ2aWNlQmFzZSArICdhY2NvdW50L3JlZ2lzdGVyZXh0ZXJuYWwnLCByZWdpc3RlckV4dGVybmFsRGF0YSkuc3VjY2VzcyhmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2VTZXJ2aWNlLnNldCgnYXV0aG9yaXphdGlvbkRhdGEnLFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW46IHJlc3BvbnNlLmFjY2Vzc190b2tlbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVmcmVzaFRva2VuOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VSZWZyZXNoVG9rZW5zOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXNlcklkOiByZXNwb25zZS51c2VySWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhc3NlbmdlcklkOiByZXNwb25zZS5wYXNzZW5nZXJJZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9naW5Qcm92aWRlcjogcmVzcG9uc2UubG9naW5Qcm92aWRlclxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIF9hdXRoZW50aWNhdGlvbi5pc0F1dGggPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgX2F1dGhlbnRpY2F0aW9uLnVzZXJJZCA9IHJlc3BvbnNlLnVzZXJJZDtcclxuICAgICAgICAgICAgICAgIF9hdXRoZW50aWNhdGlvbi51c2VSZWZyZXNoVG9rZW5zID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBfYXV0aGVudGljYXRpb24ucGFzc2VuZ2VySWQgPSByZXNwb25zZS5wYXNzZW5nZXJJZDtcclxuICAgICAgICAgICAgICAgIF9hdXRoZW50aWNhdGlvbi5sb2dpblByb3ZpZGVyID0gcmVzcG9uc2UubG9naW5Qcm92aWRlcjtcclxuXHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuXHJcbiAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnIsIHN0YXR1cykge1xyXG4gICAgICAgICAgICAgICAgX2xvZ091dCgpO1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBfcmVnaXN0ZXJPbmVNdihyZWdpc3RyYXRpb25PYmplY3QpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAkaHR0cC5wb3N0KHNlcnZpY2VCYXNlICsgJ2FjY291bnQvUmVnaXN0ZXInLCByZWdpc3RyYXRpb25PYmplY3QpLnN1Y2Nlc3MoZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlU2VydmljZS5zZXQoJ2F1dGhvcml6YXRpb25EYXRhJyxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRva2VuOiByZXNwb25zZS5hY2Nlc3NfdG9rZW4sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZnJlc2hUb2tlbjogXCJcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXNlUmVmcmVzaFRva2VuczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJJZDogcmVzcG9uc2UudXNlcklkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXNzZW5nZXJJZDogcmVzcG9uc2UucGFzc2VuZ2VySWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2luUHJvdmlkZXI6IHJlc3BvbnNlLmxvZ2luUHJvdmlkZXJcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBfYXV0aGVudGljYXRpb24uaXNBdXRoID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIF9hdXRoZW50aWNhdGlvbi51c2VySWQgPSByZXNwb25zZS51c2VySWQ7XHJcbiAgICAgICAgICAgICAgICBfYXV0aGVudGljYXRpb24udXNlUmVmcmVzaFRva2VucyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgX2F1dGhlbnRpY2F0aW9uLnBhc3NlbmdlcklkID0gcmVzcG9uc2UucGFzc2VuZ2VySWQ7XHJcbiAgICAgICAgICAgICAgICBfYXV0aGVudGljYXRpb24ubG9naW5Qcm92aWRlciA9IHJlc3BvbnNlLmxvZ2luUHJvdmlkZXI7XHJcblxyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcblxyXG4gICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZXJyLCBzdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgIF9sb2dPdXQoKTtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBfbG9naW5PbmVNdihsb2dpbkRhdGEpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAkaHR0cC5wb3N0KHNlcnZpY2VCYXNlICsgJ2FjY291bnQvTG9naW5PbmVNdicsIGxvZ2luRGF0YSkuc3VjY2VzcyhmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2VTZXJ2aWNlLnNldCgnYXV0aG9yaXphdGlvbkRhdGEnLFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW46IHJlc3BvbnNlLmFjY2Vzc190b2tlbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVmcmVzaFRva2VuOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VSZWZyZXNoVG9rZW5zOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXNlcklkOiByZXNwb25zZS51c2VySWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhc3NlbmdlcklkOiByZXNwb25zZS5wYXNzZW5nZXJJZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9naW5Qcm92aWRlcjogcmVzcG9uc2UubG9naW5Qcm92aWRlclxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIF9hdXRoZW50aWNhdGlvbi5pc0F1dGggPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgX2F1dGhlbnRpY2F0aW9uLnVzZXJJZCA9IHJlc3BvbnNlLnVzZXJJZDtcclxuICAgICAgICAgICAgICAgIF9hdXRoZW50aWNhdGlvbi51c2VSZWZyZXNoVG9rZW5zID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBfYXV0aGVudGljYXRpb24ucGFzc2VuZ2VySWQgPSByZXNwb25zZS5wYXNzZW5nZXJJZDtcclxuICAgICAgICAgICAgICAgIF9hdXRoZW50aWNhdGlvbi5sb2dpblByb3ZpZGVyID0gcmVzcG9uc2UubG9naW5Qcm92aWRlcjtcclxuXHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuXHJcbiAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChlcnIsIHN0YXR1cykge1xyXG4gICAgICAgICAgICAgICAgX2xvZ091dCgpO1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBfdmVyaWZ5Q2FwdGNoYShjYXB0Y2hhKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICRodHRwLnBvc3Qoc2VydmljZUJhc2UgKyAnYWNjb3VudC9WZXJpZnlDYXB0Y2hhJywgJ1wiJyArIGNhcHRjaGEgKyAnXCInKS5zdWNjZXNzKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG5cclxuICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGVyciwgc3RhdHVzKSB7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBhdXRoU2VydmljZUZhY3Rvcnkuc2F2ZVJlZ2lzdHJhdGlvbiA9IF9zYXZlUmVnaXN0cmF0aW9uO1xyXG4gICAgICAgIGF1dGhTZXJ2aWNlRmFjdG9yeS5sb2dpbiA9IF9sb2dpbjtcclxuICAgICAgICBhdXRoU2VydmljZUZhY3RvcnkubG9nT3V0ID0gX2xvZ091dDtcclxuICAgICAgICBhdXRoU2VydmljZUZhY3RvcnkuZmlsbEF1dGhEYXRhID0gX2ZpbGxBdXRoRGF0YTtcclxuICAgICAgICBhdXRoU2VydmljZUZhY3RvcnkuYXV0aGVudGljYXRpb24gPSBfYXV0aGVudGljYXRpb247XHJcbiAgICAgICAgYXV0aFNlcnZpY2VGYWN0b3J5LnJlZnJlc2hUb2tlbiA9IF9yZWZyZXNoVG9rZW47XHJcblxyXG4gICAgICAgIGF1dGhTZXJ2aWNlRmFjdG9yeS5vYnRhaW5BY2Nlc3NUb2tlbiA9IF9vYnRhaW5BY2Nlc3NUb2tlbjtcclxuICAgICAgICBhdXRoU2VydmljZUZhY3RvcnkuZXh0ZXJuYWxBdXRoRGF0YSA9IF9leHRlcm5hbEF1dGhEYXRhO1xyXG4gICAgICAgIGF1dGhTZXJ2aWNlRmFjdG9yeS5yZWdpc3RlckV4dGVybmFsID0gX3JlZ2lzdGVyRXh0ZXJuYWw7XHJcbiAgICAgICAgYXV0aFNlcnZpY2VGYWN0b3J5LmlzTG9nZ2VkSW4gPSBfaXNMb2dnZWRJbjtcclxuICAgICAgICBhdXRoU2VydmljZUZhY3RvcnkubG9naW5PbmVNViA9IF9sb2dpbk9uZU12O1xyXG4gICAgICAgIGF1dGhTZXJ2aWNlRmFjdG9yeS5yZWdpc3Rlck9uZU1WID0gX3JlZ2lzdGVyT25lTXY7XHJcbiAgICAgICAgYXV0aFNlcnZpY2VGYWN0b3J5LnZlcmlmeUNhcHRjaGEgPSBfdmVyaWZ5Q2FwdGNoYTtcclxuICAgICAgICBhdXRoU2VydmljZUZhY3RvcnkuY2hlY2tVc2VySGFzUmVnaXN0ZXJlZCA9IF9jaGVja1VzZXJIYXNSZWdpc3RlcmVkO1xyXG5cclxuICAgICAgICByZXR1cm4gYXV0aFNlcnZpY2VGYWN0b3J5O1xyXG4gICAgfVxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcblx0J3VzZSBzdHJpY3QnO1xyXG5cclxuXHRhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5mYWN0b3J5KCdDb21tb25TZXJ2aWNlJywgQ29tbW9uU2VydmljZSk7XHJcblxyXG5cdENvbW1vblNlcnZpY2UuJGluamVjdCA9IFsnJGh0dHAnLCAnJHEnLCAnZW52J107XHJcblxyXG5cdGZ1bmN0aW9uIENvbW1vblNlcnZpY2UoJGh0dHAsICRxLCBlbnYpIHtcclxuXHRcdHZhciBzZXJ2aWNlQmFzZSA9IGVudi5vbmVNVkFwaVVybDtcclxuXHJcblx0XHR2YXIgc2VydmljZSA9IHtcclxuXHRcdCAgICBHZXRBbGxTdGF0ZXM6IEdldEFsbFN0YXRlcyxcclxuXHRcdCAgICBHZXRTdGF0ZXNXaXRoRGl2aXNpb25zOiBHZXRTdGF0ZXNXaXRoRGl2aXNpb25zLFxyXG5cdFx0ICAgIFNjaGVkdWxlVHlwZTogR2V0U2NoZWR1bGVUeXBlcygpXHJcblx0XHR9O1xyXG5cclxuXHRcdHJldHVybiBzZXJ2aWNlO1xyXG5cclxuXHRcdGZ1bmN0aW9uIEdldEFsbFN0YXRlcygpIHtcclxuXHRcdFx0dmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuXHRcdFx0dmFyIHVybCA9IHNlcnZpY2VCYXNlICsgJ2NvbW1vbi9HZXRBbGxTdGF0ZXMnO1xyXG5cclxuXHRcdFx0JGh0dHAoe1xyXG5cdFx0XHRcdG1ldGhvZDogJ0dFVCcsXHJcblx0XHRcdFx0dXJsOiB1cmwgKyAnP3JuZD0nICsgbmV3IERhdGUoKS5nZXRUaW1lKCksXHJcblx0XHRcdH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcblx0XHRcdFx0aWYgKHJlc3BvbnNlLnN0YXR1cyA9PSAyMDApIHtcclxuXHRcdFx0XHRcdGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UuZGF0YS5yZXN1bHQpO1xyXG5cdFx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0XHRkZWZlcnJlZC5yZWplY3QocmVzcG9uc2UpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSwgZnVuY3Rpb24gKGVycikge1xyXG5cdFx0XHRcdGRlZmVycmVkLnJlamVjdChlcnIpO1xyXG5cdFx0XHR9KTtcclxuXHJcblx0XHRcdHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gR2V0U3RhdGVzV2l0aERpdmlzaW9ucygpXHJcblx0XHR7XHJcblx0XHQgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuXHRcdCAgICB2YXIgdXJsID0gc2VydmljZUJhc2UgKyAnY29tbW9uL0dldFN0YXRlc1dpdGhEaXZpc2lvbnMnO1xyXG5cclxuXHRcdCAgICAkaHR0cCh7XHJcblx0XHQgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcblx0XHQgICAgICAgIHVybDogdXJsICsgJz9ybmQ9JyArIG5ldyBEYXRlKCkuZ2V0VGltZSgpLFxyXG5cdFx0ICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcblx0XHQgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT0gMjAwKSB7XHJcblx0XHQgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlLmRhdGEucmVzdWx0KTtcclxuXHRcdCAgICAgICAgfSBlbHNlIHtcclxuXHRcdCAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChyZXNwb25zZSk7XHJcblx0XHQgICAgICAgIH1cclxuXHRcdCAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcblx0XHQgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpO1xyXG5cdFx0ICAgIH0pO1xyXG5cclxuXHRcdCAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuXHRcdH1cclxuXHJcblx0XHRmdW5jdGlvbiBHZXRTY2hlZHVsZVR5cGVzKCkge1xyXG5cdFx0ICAgIHJldHVybiBPYmplY3QuZnJlZXplKHsgJ01vcm5pbmcnOiAnQU0nLCAnRXZlbmluZyc6ICdQTScgfSk7XHJcblx0XHR9XHJcblxyXG5cdH1cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ29uZU1WQXBwJyk7XHJcbiAgICBhcHAuZmFjdG9yeSgnQ29tbXVuaWNhdGlvbnNTZXJ2aWNlJywgQ29tbXVuaWNhdGlvbnNTZXJ2aWNlKTtcclxuICAgIENvbW11bmljYXRpb25zU2VydmljZS4kaW5qZWN0ID0gWyckaHR0cCcsICckcScsICdDb25maWdGYWN0b3J5J107XHJcblxyXG4gICAgZnVuY3Rpb24gQ29tbXVuaWNhdGlvbnNTZXJ2aWNlKCRodHRwLCAkcSwgQ29uZmlnRmFjdG9yeSkge1xyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgICAgICBjb250YWN0RHJpdmVyOiBjb250YWN0RHJpdmVyXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY29udGFjdERyaXZlcih0cmlwSWQpIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVyID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgQ29uZmlnRmFjdG9yeS5nZXRPbmVNVkFwaVVSTFByb21pc2UoKS50aGVuKGZ1bmN0aW9uIChvbmVNVlVSTCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG9uZU1WVVJMICYmIG9uZU1WVVJMICE9IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAvL2dldCB0aGUgYmFzZSB1cmwgZnJvbSBjb25maWcuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIF91cmwgPSBvbmVNVlVSTCArIFwiY29tbXVuaWNhdGlvbnMvY29udGFjdGRyaXZlci9cIiArIHRyaXBJZCArIFwiP3JuZD1cIiArIG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBfdXJsXHJcbiAgICAgICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLmRhdGEgJiYgcmVzcG9uc2UuZGF0YS5zdGF0dXMgJiYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEgfHwgcmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVyLnJlc29sdmUocmVzcG9uc2UuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXIucmVqZWN0KHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2socmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXIucmVqZWN0KHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlci5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTsiLCIvLyhmdW5jdGlvbiAoKSB7XHJcbi8vICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbi8vICAgIGFuZ3VsYXJcclxuLy8gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuLy8gICAgICAgIC5mYWN0b3J5KCdEYXRlVXRpbGl0eVNlcnZpY2UnLCBEYXRlVXRpbGl0eVNlcnZpY2UpO1xyXG5cclxuLy8gICAgRGF0ZVV0aWxpdHlTZXJ2aWNlLiRpbmplY3QgPSBbXTtcclxuXHJcbi8vICAgIGZ1bmN0aW9uIERhdGVVdGlsaXR5U2VydmljZSgpIHtcclxuLy8gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG4vLyAgICAgICAgICAgIGFkZERheXM6IGFkZERheXMsXHJcbi8vICAgICAgICAgICAgZ2V0V2VlazogZ2V0V2VlayxcclxuLy8gICAgICAgICAgICBnZXREYXlPZlllYXI6IGdldERheU9mWWVhclxyXG4vLyAgICAgICAgfTtcclxuXHJcbi8vICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbi8vICAgICAgICBmdW5jdGlvbiBhZGREYXlzKGlucHV0LCBudW1PZkRheXMpIHtcclxuLy8gICAgICAgICAgICB2YXIgZGF0ID0gbmV3IERhdGUoaW5wdXQpO1xyXG4vLyAgICAgICAgICAgIGRhdC5zZXREYXRlKGRhdC5nZXREYXRlKCkgKyBudW1PZkRheXMpO1xyXG4vLyAgICAgICAgICAgIHJldHVybiBkYXQ7XHJcbi8vICAgICAgICB9XHJcblxyXG4vLyAgICAgICAgZnVuY3Rpb24gZ2V0V2VlayhpbnB1dCkge1xyXG4vLyAgICAgICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoaW5wdXQuZ2V0VGltZSgpKTtcclxuLy8gICAgICAgICAgICBkYXRlLnNldEhvdXJzKDAsIDAsIDAsIDApO1xyXG4vLyAgICAgICAgICAgIC8vIFRodXJzZGF5IGluIGN1cnJlbnQgd2VlayBkZWNpZGVzIHRoZSB5ZWFyLlxyXG4vLyAgICAgICAgICAgIGRhdGUuc2V0RGF0ZShkYXRlLmdldERhdGUoKSArIDMgLSAoZGF0ZS5nZXREYXkoKSArIDYpICUgNyk7XHJcbi8vICAgICAgICAgICAgLy8gSmFudWFyeSA0IGlzIGFsd2F5cyBpbiB3ZWVrIDEuXHJcbi8vICAgICAgICAgICAgdmFyIHdlZWsxID0gbmV3IERhdGUoZGF0ZS5nZXRGdWxsWWVhcigpLCAwLCA0KTtcclxuLy8gICAgICAgICAgICAvLyBBZGp1c3QgdG8gVGh1cnNkYXkgaW4gd2VlayAxIGFuZCBjb3VudCBudW1iZXIgb2Ygd2Vla3MgZnJvbSBkYXRlIHRvIHdlZWsxLlxyXG4vLyAgICAgICAgICAgIHJldHVybiAxICsgTWF0aC5yb3VuZCgoKGRhdGUuZ2V0VGltZSgpIC0gd2VlazEuZ2V0VGltZSgpKSAvIDg2NDAwMDAwXHJcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0gMyArICh3ZWVrMS5nZXREYXkoKSArIDYpICUgNykgLyA3KTtcclxuLy8gICAgICAgIH1cclxuXHJcbi8vICAgICAgICBmdW5jdGlvbiBnZXREYXlPZlllYXIoaW5wdXQpIHtcclxuLy8gICAgICAgICAgICB2YXIgbm93ID0gbmV3IERhdGUoaW5wdXQpO1xyXG4vLyAgICAgICAgICAgIHZhciBzdGFydCA9IG5ldyBEYXRlKG5vdy5nZXRGdWxsWWVhcigpLCAwLCAwKTtcclxuLy8gICAgICAgICAgICB2YXIgZGlmZiA9IChub3cgLSBzdGFydCkgKyAoKHN0YXJ0LmdldFRpbWV6b25lT2Zmc2V0KCkgLSBub3cuZ2V0VGltZXpvbmVPZmZzZXQoKSkgKiA2MCAqIDEwMDApO1xyXG4vLyAgICAgICAgICAgIHZhciBvbmVEYXkgPSAxMDAwICogNjAgKiA2MCAqIDI0O1xyXG4vLyAgICAgICAgICAgIHZhciBkYXkgPSBNYXRoLmZsb29yKGRpZmYgLyBvbmVEYXkpO1xyXG4vLyAgICAgICAgICAgIHJldHVybiBkYXk7XHJcbi8vICAgICAgICB9XHJcbi8vICAgIH1cclxuLy99KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuZmFjdG9yeSgnRGl2aXNpb25TZXJ2aWNlJywgRGl2aXNpb25TZXJ2aWNlKTtcclxuXHJcbiAgICBEaXZpc2lvblNlcnZpY2UuJGluamVjdCA9IFsgJyRodHRwJywgJyRxJywgJyRyb290U2NvcGUnLCAnbG9jYWxTdG9yYWdlU2VydmljZScsICdlbnYnLCAnYXV0aFNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBEaXZpc2lvblNlcnZpY2UoJGh0dHAsICRxLCAkcm9vdFNjb3BlLCAgbG9jYWxTdG9yYWdlU2VydmljZSwgZW52LCBhdXRoU2VydmljZSkge1xyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgICAgICBzZXREaXZpc2lvbjogX3NldERpdmlzaW9uLFxyXG4gICAgICAgICAgICBnZXREaXZpc2lvbkluZm86IF9nZXREaXZpc2lvbkluZm8sICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGdldERpdmlzaW9uczogX2dldEFsbERpdmlzaW9ucyxcclxuICAgICAgICAgICAgZ2V0RGl2aXNpb25JZDogX2dldERpdmlzaW9uSWRGcm9tTG9jYWxTdG9yYWdlLFxyXG4gICAgICAgICAgICBnZXRUaW1lWm9uZTogX2dldFRpbWVab25lRnJvbUxvY2FsU3RvcmFnZSwgICAgICAgICAgICBcclxuICAgICAgICAgICAgZ2V0QWxsb3dlZFNlcnZpY2VzOiBfZ2V0QWxsb3dlZFNlcnZpY2VzRnJvbUxvY2FsU3RvcmFnZSxcclxuICAgICAgICAgICAgZ2V0RGl2aXNpb25BbGlhczogX2dldERpdmlzaW9uQWxpYXNGcm9tTG9jYWxTdG9yYWdlLFxyXG4gICAgICAgICAgICBnZXRTdXBwb3J0UGhvbmVOdW1iZXI6IF9nZXRTdXBwb3J0UGhvbmVOdW1iZXJGcm9tTG9jYWxTdG9yYWdlLFxyXG4gICAgICAgICAgICBnZXRTeXN0ZW1QYXJhbWV0ZXJzOiBfZ2V0U3lzdGVtUGFyYW1ldGVyc0Zyb21Mb2NhbFN0b3JhZ2UsXHJcbiAgICAgICAgICAgIGdldFNlcnZpY2VEYXRlQnlEaXZpc2lvblRpbWU6IF9nZXRTZXJ2aWNlRGF0ZUJ5RGl2aXNpb25UaW1lLFxyXG4gICAgICAgICAgICBnZXRDdXJyZW50RGl2aXNpb25UaW1lOiBfZ2V0Q3VycmVudERpdmlzaW9uVGltZSxcclxuICAgICAgICAgICAgZ2V0RGl2aXNpb25CeVN0YXRlOiBfZ2V0RGl2aXNpb25CeVN0YXRlLFxyXG4gICAgICAgICAgICBnZXREaXZpc2lvbnNCeUxvY2F0aW9uOiBfZ2V0RGl2aXNpb25zQnlMb2NhdGlvbixcclxuICAgICAgICAgICAgaXNXYWl0bGlzdEFsbG93ZWRCeURpdmlzaW9uOiBfaXNXYWl0bGlzdEFsbG93ZWRCeURpdmlzaW9uXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIF9nZXRDdXJyZW50RGl2aXNpb25UaW1lKCkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgJ3VybCc6IGVudi5vbmVNVkFwaU9yZ1VybCArICdkaXZpc2lvbi8nICsgX2dldERpdmlzaW9uSWRGcm9tTG9jYWxTdG9yYWdlKCkgKyAnL2N1cnJlbnRUaW1lP3JuZD0nICsgbmV3IERhdGUoKS5nZXRUaW1lKClcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0KSB7ICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgZGVmZXJyZWQucmVqZWN0KCk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdCgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIF9zZXREaXZpc2lvbihpbnB1dEFsaWFzKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcblxyXG5cdFx0XHQvLyBnZXQgZGl2aXNpb24gaW5mb1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgJ3VybCc6IGVudi5vbmVNVkFwaVVybCArICdkaXZpc2lvbi92MT9hbGlhcz0nICsgaW5wdXRBbGlhc1xyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEgJiYgcmVzcG9uc2UuZGF0YS5yZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaGFzRGl2aXNpb25DaGFuZ2VkID0gX2hhc0RpdmlzaW9uQ2hhbmdlZChpbnB1dEFsaWFzKTtcclxuICAgICAgICAgICAgICAgIFx0dmFyIGRpdmlzaW9uID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgXHQvLyBnZXQgZGl2aXNpb24gc3lzdGVtIHBhcmFtZXRlcnNcclxuICAgICAgICAgICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgICAgXHRtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgICAgIFx0J3VybCc6IGVudi5vbmVNVkFwaVVybCArICcvZGl2aXNpb24vJyArIGRpdmlzaW9uLkRpdmlzaW9uSUQgKycvc3lzdGVtUGFyYW1ldGVycz9hcHBUeXBlPURlc2t0b3AnXHJcbiAgICAgICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocGFyYW1SZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIFx0aWYgKHBhcmFtUmVzcG9uc2Uuc3RhdHVzID09IDIwMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIFx0XHRkaXZpc2lvbi5TeXN0ZW1QYXJhbWV0ZXJzID0gcGFyYW1SZXNwb25zZS5kYXRhLnJlc3VsdDtcclxuXHRcdFx0XHRcdFx0XHQvLyBjb252ZXJ0IGJvb2xlYW4gdGV4dCB0byBib29sZWFuXHJcbiAgICAgICAgICAgICAgICAgICAgXHRcdGZvciAodmFyIHBhcmFtIGluIGRpdmlzaW9uLlN5c3RlbVBhcmFtZXRlcnMpIHtcclxuICAgICAgICAgICAgICAgICAgICBcdFx0XHR2YXIgdmFsdWUgPSBkaXZpc2lvbi5TeXN0ZW1QYXJhbWV0ZXJzW3BhcmFtXTtcclxuICAgICAgICAgICAgICAgICAgICBcdFx0XHRpZiAodmFsdWUgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIFx0XHRcdFx0dmFsdWUgPSB2YWx1ZS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIFx0XHRcdFx0aWYgKHZhbHVlID09IFwidHJ1ZVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgXHRcdFx0XHRcdGRpdmlzaW9uLlN5c3RlbVBhcmFtZXRlcnNbcGFyYW1dID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBcdFx0XHRcdH0gZWxzZSBpZiAodmFsdWUgPT0gXCJmYWxzZVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgXHRcdFx0XHRcdGRpdmlzaW9uLlN5c3RlbVBhcmFtZXRlcnNbcGFyYW1dID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgXHRcdFx0XHR9XHJcbiAgICAgICAgICAgICAgICAgICAgXHRcdFx0fVxyXG4gICAgICAgICAgICAgICAgICAgIFx0XHR9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIFx0ICAgIC8vIHJlbWVtYmVyIGRpdmlzaW9uIHByb3BlcnRpZXMgZm9yIGZ1dHVyZSBhY2Nlc3NcclxuICAgICAgICAgICAgICAgICAgICBcdFx0X3NldERpdmlzaW9uUHJvcGVydGllcyhkaXZpc2lvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgXHRcdF9zZXRTZXJ2aWNlcyhyZXNwb25zZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIFx0XHRfYnJvYWRjYXN0RGl2aXNpb25DaGFuZ2VkKGhhc0RpdmlzaW9uQ2hhbmdlZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgXHRcdGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIFx0fVxyXG4gICAgICAgICAgICAgICAgICAgIFx0ZWxzZSBkZWZlcnJlZC5yZWplY3QoJ2RpdmlzaW9uIG5vdCBmb3VuZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBcdGRlZmVycmVkLnJlamVjdCgnZGl2aXNpb24gbm90IGZvdW5kJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGRlZmVycmVkLnJlamVjdCgnZGl2aXNpb24gbm90IGZvdW5kJyk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdCgnZGl2aXNpb24gbm90IGZvdW5kJyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGZ1bmN0aW9uIF9oYXNEaXZpc2lvbkNoYW5nZWQoaW5wdXRBbGlhcykge1xyXG4gICAgICAgICAgICB2YXIgbG9jYWxTdG9yYWdlQWxpYXMgPSBfZ2V0RGl2aXNpb25BbGlhc0Zyb21Mb2NhbFN0b3JhZ2UoKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmKGFuZ3VsYXIuaXNVbmRlZmluZWQobG9jYWxTdG9yYWdlQWxpYXMpIFxyXG4gICAgICAgICAgICAgICAgfHwgIGxvY2FsU3RvcmFnZUFsaWFzID09PSBudWxsIFxyXG4gICAgICAgICAgICAgICAgfHwgbG9jYWxTdG9yYWdlQWxpYXMudHJpbSgpID09PSAnJykgXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBpbnB1dEFsaWFzLnRvTG93ZXJDYXNlKCkgIT09IGxvY2FsU3RvcmFnZUFsaWFzLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBfZ2V0RGl2aXNpb25JbmZvKCkgeyAgICAgICAgICAgIFxyXG5cclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICd1cmwnOiBlbnYub25lTVZBcGlVcmwgKyAnZGl2aXNpb24vJyArIF9nZXREaXZpc2lvbklkRnJvbUxvY2FsU3RvcmFnZSgpXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSAmJiByZXNwb25zZS5kYXRhLnJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIF9zZXRTZXJ2aWNlcyhyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGRlZmVycmVkLnJlamVjdCgpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gX2dldEFsbERpdmlzaW9ucygpIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICd1cmwnOiBlbnYub25lTVZBcGlVcmwgKyAnZGl2aXNpb24vYWxsL3YxJ1xyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEgJiYgcmVzcG9uc2UuZGF0YS5yZXN1bHQpIHsgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGRlZmVycmVkLnJlamVjdCgpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlOyAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gX2dldFNlcnZpY2VEYXRlQnlEaXZpc2lvblRpbWUoZGl2aXNpb25JZCwgZGl2aXNpb25UaW1lKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICAndXJsJzogZW52Lm9uZU1WQXBpVXJsICsgJ2RpdmlzaW9uLycgKyBkaXZpc2lvbklkICsgJy8nICsgZGl2aXNpb25UaW1lICsgJy9zZXJ2aWNlRGF0ZUJ5RGl2aXNpb25UaW1lP3JuZD0nICsgbmV3IERhdGUoKS5nZXRUaW1lKClcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGRlZmVycmVkLnJlamVjdCgpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBfZ2V0RGl2aXNpb25CeVN0YXRlKHN0YXRlQ29kZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICAndXJsJzogZW52Lm9uZU1WQXBpVXJsICsgJ2RpdmlzaW9uL0dldERpdmlzaW9uc0J5U3RhdGUvJyArIHN0YXRlQ29kZSArICc/cm5kPScgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKVxyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEgJiYgcmVzcG9uc2UuZGF0YS5yZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgZGVmZXJyZWQucmVqZWN0KCk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdCgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBfZ2V0RGl2aXNpb25zQnlMb2NhdGlvbihsYXRpdHVkZSwgbG9uZ2l0dWRlKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICd1cmwnOiBlbnYub25lTVZBcGlVcmwgKyAnZGl2aXNpb24vJyArIGxhdGl0dWRlICsgJy8nICsgbG9uZ2l0dWRlICsgJy9HZXRDbG9zZXN0RGl2aXNpb25zP3JuZD0nICsgbmV3IERhdGUoKS5nZXRUaW1lKClcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGRlZmVycmVkLnJlamVjdCgpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBfc2V0RGl2aXNpb25Qcm9wZXJ0aWVzKGRpdmlzaW9uKSB7XHJcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZVNlcnZpY2Uuc2V0KCdkaXZpc2lvbicsIGRpdmlzaW9uLkRpdmlzaW9uSUQpO1xyXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2VTZXJ2aWNlLnNldCgndGltZVpvbmUnLCBkaXZpc2lvbi5UaW1lWm9uZSk7XHJcbiAgICAgICAgICAgIC8vbG9jYWxTdG9yYWdlU2VydmljZS5zZXQoJ2FsbG93ZWRTZXJ2aWNlcycsIGRpdmlzaW9uLkFsbG93ZWRTZXJ2aWNlcy50b0xvd2VyQ2FzZSgpKTtcclxuICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgLy8gVGVzdCBzdHVmIGJlY2F1c2UgaXQgaXMgYnJva2VuLiBcclxuICAgICAgICAgICAgLy8gRG8gbm90IHB1Ymxpc2ggdGhpcy5cclxuICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgaWYgKGRpdmlzaW9uLkNvbW11dGVyRGl2aXNpb25JZCA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbWFwQ29tbXV0ZXJEaXZpc2lvbklkID0gJyc7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGl2aXNpb25JRCA9IGRpdmlzaW9uLkRpdmlzaW9uSUQ7XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGRpdmlzaW9uSUQpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICcyMDYnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXBDb21tdXRlckRpdmlzaW9uSWQgPSAnMjA2J1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICcxMDAxJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWFwQ29tbXV0ZXJEaXZpc2lvbklkID0gJzEwMDEuMSdcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnMTAwMic6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hcENvbW11dGVyRGl2aXNpb25JZCA9ICcxMDAyLjEnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJzEwMDMnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXBDb21tdXRlckRpdmlzaW9uSWQgPSAnMTAwMy4xJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICcxMDA0JzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWFwQ29tbXV0ZXJEaXZpc2lvbklkID0gJzEwMDQuMSdcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnMTAwNSc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hcENvbW11dGVyRGl2aXNpb25JZCA9ICcxMDA1LjEnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hcENvbW11dGVyRGl2aXNpb25JZCA9ICctOTk5J1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH07IGRpdmlzaW9uLkNvbW11dGVyRGl2aXNpb25JZCA9IG1hcENvbW11dGVyRGl2aXNpb25JZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2VTZXJ2aWNlLnNldCgnY2lkJywgZGl2aXNpb24uQ29tbXV0ZXJEaXZpc2lvbklkKTtcclxuICAgICAgICAgICAgbG9jYWxTdG9yYWdlU2VydmljZS5zZXQoJ3N1cHBvcnRQaG9uZU51bWJlcicsIGRpdmlzaW9uLlN1cHBvcnRQaG9uZU51bWJlcik7XHJcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZVNlcnZpY2Uuc2V0KCdhbGlhcycsIGRpdmlzaW9uLkFsaWFzKTtcclxuICAgICAgICAgICAgbG9jYWxTdG9yYWdlU2VydmljZS5zZXQoJ3N5c3RlbVBhcmFtZXRlcnMnLCBkaXZpc2lvbi5TeXN0ZW1QYXJhbWV0ZXJzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIF9zZXRTZXJ2aWNlcyhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICB2YXIgc2VydmljZUluZm8gPSBbXTsgICAgXHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVzcG9uc2UuZGF0YS5yZXN1bHQuRGl2aXNpb25TZXJ2aWNlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHN2Y0luZm8gPSAgIHJlc3BvbnNlLmRhdGEucmVzdWx0LkRpdmlzaW9uU2VydmljZXNbaV0uU2VydmljZTsgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgc2VydmljZUluZm8ucHVzaChcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBzdmNJbmZvLklkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOnN2Y0luZm8uTmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWxpYXM6IHJlc3BvbnNlLmRhdGEucmVzdWx0LkRpdmlzaW9uU2VydmljZXNbaV0uQWxpYXMgfHwgc3ZjSW5mby5OYW1lXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZVNlcnZpY2Uuc2V0KFwic2VydmljZUluZm9cIixzZXJ2aWNlSW5mbyk7ICAgICAgICAgICAgXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBfYnJvYWRjYXN0RGl2aXNpb25DaGFuZ2VkKGhhc0RpdmlzaW9uQ2hhbmdlZCkge1xyXG4gICAgICAgICAgICBpZiAoYXV0aFNlcnZpY2UuaXNMb2dnZWRJbigpICYmIGhhc0RpdmlzaW9uQ2hhbmdlZCkge1xyXG4gICAgICAgICAgICAgICAgYXV0aFNlcnZpY2VcclxuICAgICAgICAgICAgICAgICAgICAubG9nT3V0KClcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnZGl2aXNpb25DaGFuZ2VkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoaGFzRGl2aXNpb25DaGFuZ2VkKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAvLyBvbmx5IGJyb2FkY2FzdCBpZiB0aGUgZGl2aXNpb24gaGFzIGFjdHVhbGx5IGNoYW5nZWQuXHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2RpdmlzaW9uQ2hhbmdlZCcpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBfZ2V0VGltZVpvbmVGcm9tTG9jYWxTdG9yYWdlKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbG9jYWxTdG9yYWdlU2VydmljZS5nZXQoJ3RpbWVab25lJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBfZ2V0RGl2aXNpb25JZEZyb21Mb2NhbFN0b3JhZ2UoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBsb2NhbFN0b3JhZ2VTZXJ2aWNlLmdldCgnZGl2aXNpb24nKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIF9nZXRBbGxvd2VkU2VydmljZXNGcm9tTG9jYWxTdG9yYWdlKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbG9jYWxTdG9yYWdlU2VydmljZS5nZXQoJ3NlcnZpY2VJbmZvJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBfZ2V0RGl2aXNpb25BbGlhc0Zyb21Mb2NhbFN0b3JhZ2UoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBsb2NhbFN0b3JhZ2VTZXJ2aWNlLmdldCgnYWxpYXMnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIF9nZXRTdXBwb3J0UGhvbmVOdW1iZXJGcm9tTG9jYWxTdG9yYWdlKCkge1xyXG4gICAgICAgIFx0cmV0dXJuIGxvY2FsU3RvcmFnZVNlcnZpY2UuZ2V0KCdzdXBwb3J0UGhvbmVOdW1iZXInKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIF9nZXRTeXN0ZW1QYXJhbWV0ZXJzRnJvbUxvY2FsU3RvcmFnZSgpIHtcclxuICAgICAgICBcdHJldHVybiBsb2NhbFN0b3JhZ2VTZXJ2aWNlLmdldCgnc3lzdGVtUGFyYW1ldGVycycpO1xyXG4gICAgICAgIH0gICAgXHJcbiAgICAgICAgICAgICBcclxuICAgICAgICBmdW5jdGlvbiBfaXNXYWl0bGlzdEFsbG93ZWRCeURpdmlzaW9uKCkge1xyXG5cclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICd1cmwnOiBlbnYub25lTVZBcGlPcmdVcmwgKyAnZGl2aXNpb24vJyArIF9nZXREaXZpc2lvbklkRnJvbUxvY2FsU3RvcmFnZSgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICsgJy9zeXN0ZW1QYXJhbWV0ZXJzL2FsbG93Y29tbXV0ZXJ3YWl0bGlzdCcgKyAnP3JuZD0nICsgbmV3IERhdGUoKS5nZXRUaW1lKClcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZS5kYXRhLnJlc3VsdCA9PSAndHJ1ZScpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBkZWZlcnJlZC5yZWplY3QoZmFsc2UpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZmFsc2UpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmZhY3RvcnkoJ0R5bmFtaWNDb250ZW50U2VydmljZScsIER5bmFtaWNDb250ZW50U2VydmljZSk7XHJcblxyXG4gICAgRHluYW1pY0NvbnRlbnRTZXJ2aWNlLiRpbmplY3QgPSBbJyRodHRwJywgJyRxJywgJ2VudicsICdEaXZpc2lvblNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBEeW5hbWljQ29udGVudFNlcnZpY2UoJGh0dHAsICRxLCBlbnYsIERpdmlzaW9uU2VydmljZSkge1xyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgICAgICBnZXRXaGF0c05ld0RhdGE6IGdldFdoYXRzTmV3RGF0YSxcclxuICAgICAgICAgICAgZ2V0RGF0YTogZ2V0RGF0YSxcclxuICAgICAgICAgICAgZ2V0U3VwcG9ydEZBUTogZ2V0U3VwcG9ydEZBUVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRTdXBwb3J0RkFRKCkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5vbmVNVkFwaVVybCArICdjb21tb24vJyArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCkgKyAnL3N1cHBvcnRGQVEnO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgJ3VybCc6IHNlcnZpY2VVcmxcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0V2hhdHNOZXdEYXRhKCkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5vbmVNVkFwaU9yZ1VybCArICd3aGF0c05ldy9HZXRDdXJyZW50V2hhdHNOZXdMaXN0LycgKyBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgJ3VybCc6IHNlcnZpY2VVcmxcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0RGF0YShwYWdlKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gZW52LmNvbW11dGVyQXBpVXJsICsgJ2NvbW1vbi8nICsgRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKSArICcvZHluYW1pYy8nICsgcGFnZTtcclxuICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICd1cmwnOiBzZXJ2aWNlVXJsXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycilcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5mYWN0b3J5KCdHZW9Mb2NhdGlvblNlcnZpY2UnLCBHZW9Mb2NhdGlvblNlcnZpY2UpO1xyXG5cclxuICAgIEdlb0xvY2F0aW9uU2VydmljZS4kaW5qZWN0ID0gWyckcm9vdFNjb3BlJywnJHEnLCAnJHdpbmRvdycsICckdGltZW91dCddO1xyXG5cclxuICAgIGZ1bmN0aW9uIEdlb0xvY2F0aW9uU2VydmljZSgkcm9vdFNjb3BlLCAkcSwgJHdpbmRvdywgJHRpbWVvdXQpIHtcclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgZ2V0Q3VycmVudFBvc2l0aW9uOiBnZXRDdXJyZW50UG9zaXRpb25cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0Q3VycmVudFBvc2l0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAvL1xyXG4gICAgICAgICAgICAvLyBXZSBoYXZlIG11bHRpcGxlIHBlb3BsZSBjYWxsaW5nIHRoaXMgZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIGlmIEdQUyBpcyB0dXJuZWQgb24uXHJcbiAgICAgICAgICAgIC8vIFRoaXMgaXMgYW4gaXNzdWUgaW4gQW5kcm9pZCBlbnZpcm9ubWVudC4gIEkgYWRkZWQgYSBCcm9hZGNhc3Qgc28gdGhhdCBhbnlvbmUgY2FuXHJcbiAgICAgICAgICAgIC8vIGxpc3RlbiB0byBmaW5kIG91dCBpZiBHUFMgaXMgdHVybmVkIG9uLCBvciBvZmYuXHJcbiAgICAgICAgICAgIC8vXHJcbiAgICAgICAgICAgIGlmICghJHdpbmRvdy5uYXZpZ2F0b3IuZ2VvbG9jYXRpb24pIHtcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnR2VvTG9jYXRpb25TZXJ2aWNlLmdwc0lzQXZhaWxhYmxlJywgeyBncHNJc0VuYWJsZWQ6IGZhbHNlLCBsYXN0UG9zaXRpb246IHt9LCB0aW1lc3RhbXA6IG5ldyBEYXRlKCkgfSk7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoJ0dlb2xvY2F0aW9uIG5vdCBzdXBwb3J0ZWQnKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgdmFyIHRpbWVvdXRQcm9taXNlID0gICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdCgnVXNlciBjYW5jZWxsZWQnKTsgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB9LCAxMDAwMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgJHdpbmRvdy5uYXZpZ2F0b3IuZ2VvbG9jYXRpb24uZ2V0Q3VycmVudFBvc2l0aW9uKGZ1bmN0aW9uIChwb3NpdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ0dlb0xvY2F0aW9uU2VydmljZS5ncHNJc0F2YWlsYWJsZScsIHsgZ3BzSXNFbmFibGVkOiB0cnVlLCBsYXN0UG9zaXRpb246IHBvc2l0aW9uLCB0aW1lc3RhbXA6IG5ldyBEYXRlKCkgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aW1lb3V0LmNhbmNlbCh0aW1lb3V0UHJvbWlzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocG9zaXRpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdHZW9Mb2NhdGlvblNlcnZpY2UuZ3BzSXNBdmFpbGFibGUnLCB7IGdwc0lzRW5hYmxlZDogZmFsc2UsIGxhc3RQb3NpdGlvbjoge30sIHRpbWVzdGFtcDogbmV3IERhdGUoKSB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQuY2FuY2VsKHRpbWVvdXRQcm9taXNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSx7bWF4aW11bUFnZTogMCwgZW5hYmxlSGlnaEFjY3VyYWN5OiB0cnVlIH0pO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuZmFjdG9yeSgnTG9naW5TZXJ2aWNlJywgTG9naW5TZXJ2aWNlKTtcclxuXHJcbiAgICBMb2dpblNlcnZpY2UuJGluamVjdCA9IFsnJGh0dHAnLCckcScsJ2VudiddO1xyXG5cclxuICAgIGZ1bmN0aW9uIExvZ2luU2VydmljZSgkaHR0cCwgJHEsZW52KSB7XHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XHJcbiAgICAgICAgICAgIGF1dGhlbnRpY2F0ZTogYXV0aGVudGljYXRlXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGF1dGhlbnRpY2F0ZShwcm92aWRlciwgcmV0dXJuVXJsKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gZW52LmNvbW11dGVyQXBpVXJsICsgJ2FjY291bnQvRXh0ZXJuYWxMb2dpbj9wcm92aWRlcj0nICsgcHJvdmlkZXIgKyAnJnJldHVyblVybD0nICsgcmV0dXJuVXJsO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgICAgICd1cmwnOiBzZXJ2aWNlVXJsLFxyXG4gICAgICAgICAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAndGV4dC9wbGFpbidcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBkYXRhOiB7fVxyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmZhY3RvcnkoJ0x1dW1MaW5rZWRTZXJ2aWNlJywgTHV1bUxpbmtlZFNlcnZpY2UpO1xyXG5cclxuICAgIEx1dW1MaW5rZWRTZXJ2aWNlLiRpbmplY3QgPSBbJyRodHRwJywgJyRxJywgJ2VudicsJyRyb290U2NvcGUnLCckdWliTW9kYWwnLCckbG9jYXRpb24nXTtcclxuXHJcbiAgICBmdW5jdGlvbiBMdXVtTGlua2VkU2VydmljZSgkaHR0cCwgJHEsIGVudiwgJHJvb3RTY29wZSwgJHVpYk1vZGFsLCAkbG9jYXRpb24pIHtcclxuXHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XHJcbiAgICAgICAgICAgIHZlcmlmeTogdmVyaWZ5LFxyXG4gICAgICAgICAgICBnZXROZXdQYXNzZW5nZXJMdXVtTGlua2FnZUluZm86IGdldE5ld1Bhc3Nlbmdlckx1dW1MaW5rYWdlSW5mbyxcclxuICAgICAgICAgICAgZGlzcGxheU5ld1Bhc3Nlbmdlck1lc3NhZ2UgOiBkaXNwbGF5TmV3UGFzc2VuZ2VyTWVzc2FnZVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZGlzcGxheU5ld1Bhc3Nlbmdlck1lc3NhZ2UobWVzc2FnZSkge1xyXG4gICAgICAgICAgICAgJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJtb2RhbC1oZWFkZXJcIiA+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGgzIGNsYXNzPVwibW9kYWwtdGl0bGVcIj5PbmVNVi1MVVVNIEludGVncmF0aW9uIEluZm88L2gzPicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICcgPC9kaXY+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJtb2RhbC1ib2R5XCI+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHA+JyArbWVzc2FnZSArICc8L3A+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvZGl2PicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwibW9kYWwtZm9vdGVyXCI+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJzxidXR0b24gY2xhc3M9XCJidG4gYnRuLXdhcm5pbmdcIiB0eXBlPVwiYnV0dG9uXCIgbmctY2xpY2s9XCJjbG9zZSgpXCI+T0s8L2J1dHRvbj4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyA8L2Rpdj4nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZSA6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IGZ1bmN0aW9uICgkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucmVwbGFjZSgpLnBhdGgoJ2Rhc2hib2FyZC8nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tkcm9wOiAnc3RhdGljJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5Ym9hcmQ6IGZhbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXROZXdQYXNzZW5nZXJMdXVtTGlua2FnZUluZm8oZGl2aXNpb25JZCkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5vbmVNVkFwaU9yZ1VybCArICdkaXZpc2lvbi8nICsgZGl2aXNpb25JZCArICcvbmV3UGFzc2VuZ2VyTWVzc2FnZSc7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICAndXJsJzogc2VydmljZVVybFxyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdmVyaWZ5KHBhc3NlbmdlcklkKSB7XHJcbiAgICAgICAgICAgIHZhciB1cmwgPSBlbnYub25lTVZBcGlPcmdVcmwgKyAncGFzc2VuZ2VyL2x1dW1MaW5rYWdlLycgKyBwYXNzZW5nZXJJZDtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICB1cmw6IHVybCArICc/cm5kPScgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKVxyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9leGVjdXRlIGlmZiwgZGl2aXNpb24gbmVlZCBvciBjdXJyZW50IGRhdGUgaGFzIHBhc3NlZCBzdGFydCBkYXRlIGZvciBhcHBsaWNhYmxlIGRpdmlzaW9uLlxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnJlc3VsdCAmJiByZXNwb25zZS5kYXRhLnJlc3VsdC52ZXJpZnkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5kYXRhLnJlc3VsdC5pc0xpbmtlZFRvTHV1bSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQubWVzc2FnZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwibW9kYWwtaGVhZGVyXCIgPicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8aDMgY2xhc3M9XCJtb2RhbC10aXRsZVwiPk9uZU1WLUxVVU0gSW50ZWdyYXRpb24gSW5mbzwvaDM+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgPC9kaXY+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwibW9kYWwtYm9keVwiPicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8cD4nICsgbWVzc2FnZSArICc8L3A+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJtb2RhbC1mb290ZXJcIj4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxidXR0b24gY2xhc3M9XCJidG4gYnRuLXdhcm5pbmdcIiB0eXBlPVwiYnV0dG9uXCIgbmctY2xpY2s9XCJjbG9zZSgpXCI+T0s8L2J1dHRvbj4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgPC9kaXY+JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBsYWNlOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IGZ1bmN0aW9uICgkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEucmVzdWx0LmRpc2FibGVDb21tdXRlck5hdmlnYXRpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGF0aCA9ICRsb2NhdGlvbi5wYXRoKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhdGguaW5kZXhPZignL2NvbW11dGVyL3NlbGVjdGVkLXN0b3AnKSA+IC0xXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHx8IHBhdGguaW5kZXhPZignL3Bhc3Nlbmdlci10cmlwcycpID4gLTFcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfHwgcGF0aC5pbmRleE9mKCcvY29tbXV0ZXIvYWR2LXNjaGVkdWxlLXNldHVwJykgPiAtMVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8fCBwYXRoLmluZGV4T2YoJy9jb21tdXRlci9teS12ZWhpY2xlcycpID4gLTEpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUucGFzc2VuZ2VyTm90aWZpZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucmVwbGFjZSgpLnBhdGgoJ2Rhc2hib2FyZC8nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYWNrZHJvcDogJ3N0YXRpYycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5Ym9hcmQ6IGZhbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAuZmFjdG9yeSgnTWFwSWNvblNlcnZpY2UnLCBNYXBJY29uU2VydmljZSk7XHJcblxyXG4gICAgTWFwSWNvblNlcnZpY2UuJGluamVjdCA9IFsnUG9ydGFsVXRpbGl0eVNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBNYXBJY29uU2VydmljZShQb3J0YWxVdGlsaXR5U2VydmljZSkgeyAgICAgICAgICAgICAgICAgICAgICAgIFxyXG5cclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgZ2V0Q29tbXV0ZXJTdG9wSWNvbiA6IF9nZXRDb21tdXRlclN0b3BJY29uLFxyXG4gICAgICAgICAgICBnZXRDb21tdXRlckh1Ykljb246IF9nZXRDb21tdXRlckh1Ykljb24sXHJcbiAgICAgICAgICAgIGdldERydFBpY2t1cEljb246IF9nZXREcnRQaWNrdXBJY29uLFxyXG4gICAgICAgICAgICBnZXREcnREcm9wb2ZmSWNvbjogX2dldERydERyb3BvZmZJY29uXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gX2dldENvbW11dGVySHViSWNvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFBvcnRhbFV0aWxpdHlTZXJ2aWNlLmlzSUUoKSA/ICdpbWFnZXMvcGluLWh1Yi5wbmcnIDogJ2ltYWdlcy9waW4taHViLnN2Zyc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBfZ2V0Q29tbXV0ZXJTdG9wSWNvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFBvcnRhbFV0aWxpdHlTZXJ2aWNlLmlzSUUoKSA/ICdpbWFnZXMvcGluLWJ1c3N0b3AtZ3JlZW4ucG5nJyA6ICdpbWFnZXMvcGluLWJ1c3N0b3AtZ3JlZW4uc3ZnJztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIF9nZXREcnRQaWNrdXBJY29uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJ2ltYWdlcy9kZWZhdWx0L2ktZHJ0LXBpbi1iLnBuZyc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBfZ2V0RHJ0RHJvcG9mZkljb24oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnaW1hZ2VzL2RlZmF1bHQvaS1kcnQtcGluLWcucG5nJztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG4gICAgfVxyXG5cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmZhY3RvcnkoJ01hcFNlcnZpY2UnLCBNYXBTZXJ2aWNlKTtcclxuXHJcbiAgICBNYXBTZXJ2aWNlLiRpbmplY3QgPSBbJyR0aW1lb3V0JywgJ3VpR21hcElzUmVhZHknLCAnZ29vZ2xlTWFwc0NvbmZpZyddO1xyXG5cclxuICAgIGZ1bmN0aW9uIE1hcFNlcnZpY2UoJHRpbWVvdXQsIHVpR21hcElzUmVhZHksIGdvb2dsZU1hcHNDb25maWcpIHtcclxuXHJcblxyXG4gICAgICAgIHZhciBfbWFwID0gdW5kZWZpbmVkO1xyXG5cclxuXHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XHJcbiAgICAgICAgICAgIHNldE1hcEJvdW5kczogc2V0TWFwQm91bmRzLFxyXG4gICAgICAgICAgICBpbml0aWFsaXplTWFwOiBfc2V0TWFwLFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBzZXRNYXBCb3VuZHMobWFya2VycywgZXZlbnRzKSB7XHJcblxyXG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc1VuZGVmaW5lZChfbWFwKSB8fCBhbmd1bGFyLmlzVW5kZWZpbmVkKG1hcmtlcnMpIHx8IG1hcmtlcnMubGVuZ3RoID09IDApXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcblxyXG4gICAgICAgICAgICB2YXIgYm91bmRzID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZ0JvdW5kcygpO1xyXG4gICAgICAgICAgICBhbmd1bGFyLmZvckVhY2gobWFya2VycywgZnVuY3Rpb24gKG1hcmtlcikge1xyXG4gICAgICAgICAgICAgICAgYm91bmRzLmV4dGVuZCh7XHJcbiAgICAgICAgICAgICAgICAgICAgJ2xhdCc6IG1hcmtlci5sYXRpdHVkZSxcclxuICAgICAgICAgICAgICAgICAgICAnbG5nJzogbWFya2VyLmxvbmdpdHVkZVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICAgICAgICAgIGlmIChldmVudHMpIFxyXG4gICAgICAgICAgICAgICAgX21hcC5tYXJrZXJFdmVudCA9IHNldE1hcmtlckV2ZW50cyhldmVudHMpO1xyXG5cclxuICAgICAgICAgICAgX21hcC5jb250cm9sLmdldEdNYXAoKS5maXRCb3VuZHMoYm91bmRzKTtcclxuICAgICAgICAgICAgX21hcC5jb250cm9sLmdldEdNYXAoKS5zZXRab29tKF9tYXAuY29udHJvbC5nZXRHTWFwKCkuZ2V0Wm9vbSgpIC0gMSk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gX3NldE1hcCgpIHtcclxuXHJcbiAgICAgICAgICAgIF9tYXAgPSB7XHJcbiAgICAgICAgICAgICAgICBjZW50ZXI6XHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYXRpdHVkZTogNDcuNjIxNjAyNixcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9uZ2l0dWRlOiAtMTIyLjM0Mjg2MlxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB6b29tOiAxNSxcclxuICAgICAgICAgICAgICAgIG1hcE9wdGlvbnM6IHtcclxuICAgICAgICAgICAgICAgICAgICBtYXBUeXBlQ29udHJvbDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgem9vbUNvbnRyb2w6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIHN0cmVldFZpZXdDb250cm9sOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICBzdHlsZXM6IGdvb2dsZU1hcHNDb25maWcubWFwU3R5bGVzXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgY29udHJvbDoge30sXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIF9tYXA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzZXRNYXJrZXJFdmVudHMoZXZlbnRzKSB7XHJcbiAgICAgICAgICAgIHZhciBldm50T2JqID0ge307XHJcblxyXG4gICAgICAgICAgICBhbmd1bGFyLmZvckVhY2goZXZlbnRzLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGUuZXZlbnQgJiYgdHlwZW9mIGUuY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpXHJcbiAgICAgICAgICAgICAgICAgICAgZXZudE9ialtlLmV2ZW50XSA9IGZ1bmN0aW9uIChnTWFya2VyLCBldmVudE5hbWUsIG1vZGVsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtb2RlbC4kaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUuY2FsbGJhY2sobW9kZWwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZXZudE9iajtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG5cdCd1c2Ugc3RyaWN0JztcclxuXHJcblx0YW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuZmFjdG9yeSgnTWVzc2FnZUJveCcsIE1lc3NhZ2VCb3gpO1xyXG5cclxuXHRNZXNzYWdlQm94LiRpbmplY3QgPSBbJyRxJywgJyR1aWJNb2RhbCcsICckdWliTW9kYWxTdGFjayddO1xyXG5cclxuXHRmdW5jdGlvbiBNZXNzYWdlQm94KCRxLCAkdWliTW9kYWwsICR1aWJNb2RhbFN0YWNrKSB7XHJcblx0XHR2YXIgc2VydmljZSA9IHtcclxuXHRcdFx0aW5mbzogaW5mb1xyXG5cdFx0fTtcclxuXHJcblx0XHRyZXR1cm4gc2VydmljZTtcclxuXHJcblx0XHRmdW5jdGlvbiBpbmZvKHRpdGxlLCBtZXNzYWdlKSB7XHJcblx0XHRcdHZhciB0ZW1wbGF0ZSA9XHJcblx0XHRcdCc8ZGl2IGNsYXNzPVwibW9kYWxfX2NvbnRlbnRcIj5cXFxyXG5cdFx0XHRcdDxkaXYgY2xhc3M9XCJtb2RhbF9faGVhZGVyXCI+XFxcclxuXHRcdFx0XHRcdDxoNCBjbGFzcz1cIm1vZGFsLXRpdGxlXCI+JyArIHRpdGxlICsgJzwvaDQ+XFxcclxuXHRcdFx0XHQ8L2Rpdj5cXFxyXG5cdFx0XHRcdDxkaXYgY2xhc3M9XCJtb2RhbF9fYm9keVwiPlxcXHJcblx0XHRcdFx0XHQ8cD4nICsgbWVzc2FnZSArICc8L3A+XFxcclxuXHRcdFx0XHRcdDxidXR0b24gdHlwZT1cImJ1dHRvblwiIG5nLWNsaWNrPVwib2soKVwiIGNsYXNzPVwiYnRuIGJ0bi0tcHJpbWFyeVwiPk9rPC9idXR0b24+XFxcclxuXHRcdFx0XHQ8L2Rpdj5cXFxyXG5cdFx0XHQ8L2Rpdj4nO1xyXG5cclxuXHRcdFx0dmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuXHJcblx0XHRcdHZhciBtZXNzYWdlQm94ID0gJHVpYk1vZGFsLm9wZW4oe1xyXG5cdFx0XHRcdGJhY2tkcm9wOiBmYWxzZSwgLy8gcHJldmVudCB1c2VyIGZyb20gZGlzbWlzc2luZyBtZXNzYWdlYm94IGJ5IGNsaWNraW5nIGJhY2tncm91bmRcclxuXHRcdFx0XHR0ZW1wbGF0ZTogdGVtcGxhdGUsXHJcblx0XHRcdFx0c2l6ZTonLWZzJyxcclxuXHRcdFx0XHRjb250cm9sbGVyOiBmdW5jdGlvbiAoJHNjb3BlKSB7XHJcblx0XHRcdFx0XHQkc2NvcGUub2sgPSBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHRcdCR1aWJNb2RhbFN0YWNrLmRpc21pc3NBbGwoKTtcclxuXHRcdFx0XHRcdH07XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9KS5jbG9zZWQudGhlbihmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0ZGVmZXJyZWQucmVzb2x2ZSgpO1xyXG5cdFx0XHR9KTtcclxuXHJcblx0XHRcdHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG5cdFx0fVxyXG5cdH1cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uKCl7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuZmFjdG9yeSgnT25lTXZTZXJ2aWNlcycsT25lTXZTZXJ2aWNlcyk7XHJcblxyXG4gICAgT25lTXZTZXJ2aWNlcy4kaW5qZWN0ID0gWydEaXZpc2lvblNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBPbmVNdlNlcnZpY2VzKERpdmlzaW9uU2VydmljZSl7XHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XHJcbiAgICAgICAgICAgIGdldENvbW11dGVySW5mbyA6X2dldENvbW11dGVyU2VydmljZUluZm8sXHJcbiAgICAgICAgICAgIGdldEZpeGVkUm91dGVJbmZvIDpfZ2V0Rml4ZWRSb3V0ZVNlcnZpY2VJbmZvLFxyXG4gICAgICAgICAgICBnZXREcnRJbmZvIDpfZ2V0RHJ0U2VydmljZUluZm8gICAgICAgXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIF9nZXRDb21tdXRlclNlcnZpY2VJbmZvKCl7ICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHJldHVybiBmaW5kKCdjb21tdXRlcicpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gX2dldEZpeGVkUm91dGVTZXJ2aWNlSW5mbygpeyAgICAgICAgICAgIFxyXG4gICAgICAgICAgICByZXR1cm4gZmluZCgnZml4ZWQnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIF9nZXREcnRTZXJ2aWNlSW5mbygpe1xyXG4gICAgICAgICAgICByZXR1cm4gZmluZCgnZHJ0Jyk7ICAgIFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZmluZChzZXJ2aWNlTmFtZSl7XHJcbiAgICAgICAgICAgIHZhciBzZXJ2aWNlcyA9IERpdmlzaW9uU2VydmljZS5nZXRBbGxvd2VkU2VydmljZXMoKSB8fCBbXSA7XHJcblxyXG4gICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpPHNlcnZpY2VzLmxlbmd0aDtpKyspe1xyXG4gICAgICAgICAgICAgICAgaWYoc2VydmljZXNbaV0ubmFtZS50b0xvd2VyQ2FzZSgpID09IHNlcnZpY2VOYW1lLnRvTG93ZXJDYXNlKCkpXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlcnZpY2VzW2ldO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmZhY3RvcnkoJ1BhZ2VTZXJ2aWNlJywgUGFnZVNlcnZpY2UpO1xyXG5cclxuICAgIFBhZ2VTZXJ2aWNlLiRpbmplY3QgPSBbXTtcclxuXHJcbiAgICBmdW5jdGlvbiBQYWdlU2VydmljZSgpIHtcclxuICAgICAgICB2YXIgdGl0bGUgPSAnJztcclxuICAgICAgICB2YXIgaGVhZGxpbmUgPSAnJztcclxuICAgICAgICB2YXIgcHJvZHVjdCA9ICcnO1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHRpdGxlOiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aXRsZTsgfSxcclxuICAgICAgICAgICAgc2V0VGl0bGU6IGZ1bmN0aW9uIChuZXdUaXRsZSkgeyB0aXRsZSA9IG5ld1RpdGxlOyB9LFxyXG5cclxuICAgICAgICAgICAgaGVhZGxpbmU6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGhlYWRsaW5lOyB9LFxyXG4gICAgICAgICAgICBzZXRIZWFkbGluZTogZnVuY3Rpb24gKG5ld0hlYWRsaW5lKSB7IGhlYWRsaW5lID0gbmV3SGVhZGxpbmU7IH0sXHJcblxyXG4gICAgICAgICAgICBwcm9kdWN0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBwcm9kdWN0OyB9LFxyXG4gICAgICAgICAgICBzZXRQcm9kdWN0OiBmdW5jdGlvbiAobmV3UHJvZHVjdCkgeyBwcm9kdWN0ID0gbmV3UHJvZHVjdDsgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuZmFjdG9yeSgnUGFzc3dvcmRTZXJ2aWNlJywgUGFzc3dvcmRTZXJ2aWNlKTtcclxuXHJcbiAgICBQYXNzd29yZFNlcnZpY2UuJGluamVjdCA9IFsnJGh0dHAnLCAnJHEnLCAnZW52JywgJ0RpdmlzaW9uU2VydmljZScsICdhdXRoU2VydmljZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIFBhc3N3b3JkU2VydmljZSgkaHR0cCwgJHEsIGVudiwgRGl2aXNpb25TZXJ2aWNlLCBhdXRoU2VydmljZSkge1xyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgICAgICBDaGFuZ2VQYXNzd29yZDogY2hhbmdlUGFzc3dvcmQsXHJcbiAgICAgICAgICAgIFZlcmlmeUFuZFVwZGF0ZVBhc3N3b3JkOiB1cGRhdGVBbmRWZXJpZnlQYXNzd29yZCxcclxuICAgICAgICAgICAgU2VuZFBhc3Njb2RlOiBzZW5kUGFzc2NvZGVcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlQW5kVmVyaWZ5UGFzc3dvcmQodmVyaWZ5QW5kVXBkYXRlVk0pIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgdmFyIGRpdmlzaW9uSWQgPSBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpO1xyXG4gICAgICAgICAgICB2YXIgdXJsID0gZW52Lm9uZU1WQXBpVXJsICsgJ3Bhc3N3b3JkLycgKyBkaXZpc2lvbklkICsgJy91cGRhdGVQYXNzd29yZFdpdGhUZW1wQ29kZSc7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgICAgICAgICAgdXJsOiB1cmwgKyAnP3JuZD0nICsgbmV3IERhdGUoKS5nZXRUaW1lKCksXHJcbiAgICAgICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeSh2ZXJpZnlBbmRVcGRhdGVWTSlcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpOyAgLy9wdXQgYWxsIGh0ZSBpZiBzdGF0bWVudHMgaGVyZSBhbHNvIHdoYXQgdG8gcmVzb2x2ZS5cclxuXHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY2hhbmdlUGFzc3dvcmQoY2hhbmdlUHdkVk0pIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBlbnYub25lTVZBcGlVcmwgKyBcIi9wYXNzZW5nZXIvXCIgKyBhdXRoU2VydmljZS5hdXRoZW50aWNhdGlvbi5wYXNzZW5nZXJJZCArIFwiL2NoYW5nZVBhc3N3b3JkXCI7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgICAgICAgICAgJ3VybCc6IHNlcnZpY2VVcmwgKyAnP3JuZD0nICsgbmV3IERhdGUoKS5nZXRUaW1lKCksXHJcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICd0ZXh0L2pzb24nXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoY2hhbmdlUHdkVk0pXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2VuZFBhc3Njb2RlKGVtYWlsKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgdmFyIGRpdmlzaW9uSWQgPSBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpO1xyXG4gICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5vbmVNVkFwaVVybCArIFwicGFzc3dvcmQvXCIgICsgZGl2aXNpb25JZCArIFwiL3NlbmRUZW1wb3JhcnlDb2RlXCI7XHJcbiAgICAgICAgICAgIC8vJGh0dHAoe1xyXG4gICAgICAgICAgICAvLyAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgLy8gICAgJ3VybCc6IHNlcnZpY2VVcmwgKyAnP3JuZD0nICsgbmV3IERhdGUoKS5nZXRUaW1lKCksXHJcbiAgICAgICAgICAgIC8vICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHsgZW1haWwgfSlcclxuICAgICAgICAgICAgLy99KVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgJGh0dHAucG9zdChzZXJ2aWNlVXJsLCAnXCInICsgZW1haWwgKyAnXCInKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG5cclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcbiAgICBcclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmZhY3RvcnkoJ1BvcnRhbFV0aWxpdHlTZXJ2aWNlJywgUG9ydGFsVXRpbGl0eVNlcnZpY2UpO1xyXG5cclxuICAgIFBvcnRhbFV0aWxpdHlTZXJ2aWNlLiRpbmplY3QgPSBbJyR3aW5kb3cnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBQb3J0YWxVdGlsaXR5U2VydmljZSgkd2luZG93KSB7XHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XHJcbiAgICAgICAgICAgIGhhc1ZhbHVlOiBoYXNWYWx1ZSxcclxuICAgICAgICAgICAgaXNJRSA6aXNJRVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBoYXNWYWx1ZShpbnB1dCkge1xyXG4gICAgICAgICAgICByZXR1cm4gaW5wdXQgIT0gbnVsbCAmJiBpbnB1dCAhPSB1bmRlZmluZWQgJiYgaW5wdXQgIT0gJyc7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaXNJRSgpIHtcclxuICAgICAgICAgICAgcmV0dXJuICR3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiVHJpZGVudFwiKSA+IDBcclxuICAgICAgICAgICAgICAgICAgICB8fCAkd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcIk1TSUVcIikgPiAwO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG5cdCd1c2Ugc3RyaWN0JztcclxuXHJcblx0YW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuZmFjdG9yeSgnUHJvZmlsZVNlcnZpY2UnLCBQcm9maWxlU2VydmljZSk7XHJcblxyXG5cdFByb2ZpbGVTZXJ2aWNlLiRpbmplY3QgPSBbJyRodHRwJywgJyRxJywgJ2VudicsICdEaXZpc2lvblNlcnZpY2UnLCAnQ29uZmlnRmFjdG9yeScsICdhdXRoU2VydmljZSddO1xyXG5cclxuXHRmdW5jdGlvbiBQcm9maWxlU2VydmljZSgkaHR0cCwgJHEsIGVudiwgRGl2aXNpb25TZXJ2aWNlLCBDb25maWdGYWN0b3J5LCBhdXRoU2VydmljZSkge1xyXG5cdFx0dmFyIHNlcnZpY2VCYXNlID0gZW52Lm9uZU1WQXBpVXJsO1xyXG5cclxuXHRcdHZhciBzZXJ2aWNlID0ge1xyXG5cdFx0XHQvLyBwYXNzZW5nZXIgcHJvZmlsZSwgaW5jbHVkaW5nIGhvbWUgYWRkcmVzc1xyXG5cdFx0XHRHZXRQcm9maWxlOiBHZXRQcm9maWxlLFxyXG5cdFx0XHRVcGRhdGVQcm9maWxlOiBVcGRhdGVQcm9maWxlLFxyXG4gICAgICAgICAgICBHZXRQYXNzZW5nZXJBZ2U6IGdldFBhc3NlbmdlckFnZSxcclxuXHJcblx0XHRcdC8vIGhvbWUgYWRkcmVzcyBvbmx5XHJcblx0XHRcdEdldEhvbWVBZGRyZXNzOiBHZXRIb21lQWRkcmVzcyxcclxuXHRcdFx0VXBkYXRlSG9tZUFkZHJlc3M6IFVwZGF0ZUhvbWVBZGRyZXNzLFxyXG5cclxuXHRcdFx0QWxsb3dFZGl0SG9tZUFkZHJlc3M6IEFsbG93RWRpdEhvbWVBZGRyZXNzLFxyXG5cdFx0XHRTaG93SG9tZUFkZHJlc3M6IFNob3dIb21lQWRkcmVzcyxcclxuXHRcdFx0R2V0RGVmYXVsdE1vYmlsaXR5QWlkczogR2V0RGVmYXVsdE1vYmlsaXR5QWlkc1xyXG5cdFx0fTtcclxuXHJcblx0XHRyZXR1cm4gc2VydmljZTtcclxuXHJcblx0XHQvLyBkZXRlcm1pbmUgaWYgaG9tZSBsb2NhdGlvbiBzaG91bGQgYmUgZGlzcGxheWVkXHJcblx0XHRmdW5jdGlvbiBTaG93SG9tZUFkZHJlc3MoKSB7XHJcblx0XHRcdHZhciBkaXZpc2lvblBhcmFtZXRlcnMgPSBEaXZpc2lvblNlcnZpY2UuZ2V0U3lzdGVtUGFyYW1ldGVycygpO1xyXG5cdFx0XHRyZXR1cm4gZGl2aXNpb25QYXJhbWV0ZXJzLkRyb3BvZmZIb21lTG9jYXRpb25Pbmx5O1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIGRldGVybWluZSBpZiB0aGUgZ2l2ZW4gcGFzc2VuZ2VyIG1heSBjaGFuZ2UgaGlzIGhvbWUgbG9jYXRpb25cclxuXHRcdGZ1bmN0aW9uIEFsbG93RWRpdEhvbWVBZGRyZXNzKCkge1xyXG5cdFx0XHR2YXIgZGl2aXNpb25QYXJhbWV0ZXJzID0gRGl2aXNpb25TZXJ2aWNlLmdldFN5c3RlbVBhcmFtZXRlcnMoKTtcclxuXHRcdFx0dmFyIGFsbG93RWRpdFByb2ZpbGUgPSBkaXZpc2lvblBhcmFtZXRlcnMuRHJvcG9mZkhvbWVMb2NhdGlvbk9ubHlcclxuXHRcdFx0XHQmJiBkaXZpc2lvblBhcmFtZXRlcnMuRHJvcG9mZkhvbWVMb2NhdGlvbkVkaXQ7XHJcblx0XHRcdHJldHVybiBhbGxvd0VkaXRQcm9maWxlO1xyXG5cdFx0fVxyXG5cclxuXHRcdGZ1bmN0aW9uIGdldFBhc3NlbmdlckFnZShwYXNzZW5nZXJJZClcclxuXHRcdHtcclxuXHRcdCAgICB2YXIgdXJsID0gc2VydmljZUJhc2UgKyAncGFzc2VuZ2VyLycgKyBwYXNzZW5nZXJJZCArICcvYWdlJztcclxuXHJcblx0XHQgICAgcmV0dXJuICRodHRwKHtcclxuXHRcdCAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuXHRcdCAgICAgICAgdXJsOiB1cmwgKyAnP3JuZD0nICsgbmV3IERhdGUoKS5nZXRUaW1lKClcclxuXHRcdCAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG5cdFx0ICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09IDIwMCkge1xyXG5cdFx0ICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xyXG5cdFx0ICAgICAgICB9XHJcblx0XHQgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG5cdFx0ICAgICAgICB0aHJvdyBlcnI7XHJcblx0XHQgICAgfSk7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBHZXRIb21lQWRkcmVzcyhwYXNzZW5nZXJJZCkge1xyXG5cdFx0XHR2YXIgdXJsID0gc2VydmljZUJhc2UgKyAncGFzc2VuZ2VyL0dldEhvbWVBZGRyZXNzLycgKyBwYXNzZW5nZXJJZDtcclxuXHJcblx0XHRcdHJldHVybiAkaHR0cCh7XHJcblx0XHRcdFx0bWV0aG9kOiAnR0VUJyxcclxuXHRcdFx0XHR1cmw6IHVybCArICc/cm5kPScgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKVxyXG5cdFx0XHR9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG5cdFx0XHRcdGlmIChyZXNwb25zZS5zdGF0dXMgPT0gMjAwKSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gcmVzcG9uc2UuZGF0YS5yZXN1bHQ7XHJcblx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdHJldHVybiByZXNwb25zZTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuXHRcdFx0XHR0aHJvdyBlcnI7XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cclxuXHRcdGZ1bmN0aW9uIEdldFByb2ZpbGUocGFzc2VuZ2VySWQpIHtcclxuXHRcdFx0dmFyIHVybCA9IHNlcnZpY2VCYXNlICsgJ3Bhc3Nlbmdlci9HZXRQcm9maWxlLycgKyBwYXNzZW5nZXJJZDtcclxuXHJcblx0XHRcdHJldHVybiAkaHR0cCh7XHJcblx0XHRcdFx0bWV0aG9kOiAnR0VUJyxcclxuXHRcdFx0XHR1cmw6IHVybCArICc/cm5kPScgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKVxyXG5cdFx0XHR9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG5cdFx0XHRcdGlmIChyZXNwb25zZS5zdGF0dXMgPT0gMjAwKSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gcmVzcG9uc2UuZGF0YS5yZXN1bHQ7XHJcblx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdHJldHVybiByZXNwb25zZTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblxyXG5cdFx0ZnVuY3Rpb24gVXBkYXRlSG9tZUFkZHJlc3MocGFzc2VuZ2VySWQsIGhvbWVBZGRyZXNzKSB7XHJcblx0XHRcdHJldHVybiAkaHR0cC5wb3N0KHNlcnZpY2VCYXNlICsgJ3Bhc3Nlbmdlci9VcGRhdGVIb21lQWRkcmVzcy8nICsgcGFzc2VuZ2VySWQsIGhvbWVBZGRyZXNzKVxyXG5cdFx0XHRcdC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG5cdFx0XHRcdFx0aWYgKHJlc3BvbnNlLnN0YXR1cyA9PSAyMDApIHtcclxuXHRcdFx0XHRcdFx0cmV0dXJuIHJlc3BvbnNlO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cclxuXHRcdGZ1bmN0aW9uIFVwZGF0ZVByb2ZpbGUocHJvZmlsZSkge1xyXG5cdFx0XHRyZXR1cm4gJGh0dHAucG9zdChzZXJ2aWNlQmFzZSArICdwYXNzZW5nZXIvVXBkYXRlUHJvZmlsZScsIHByb2ZpbGUpXHJcblx0XHRcdFx0LnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcblx0XHRcdFx0XHRpZiAocmVzcG9uc2Uuc3RhdHVzID09IDIwMCkge1xyXG5cdFx0XHRcdFx0XHRyZXR1cm4gcmVzcG9uc2U7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fSk7XHJcblx0XHR9XHJcblxyXG5cdFx0ZnVuY3Rpb24gR2V0RGVmYXVsdE1vYmlsaXR5QWlkcyhkaXZpc2lvbklkLCBwYXNzZW5nZXJJZCkge1xyXG5cdFx0XHR2YXIgdXJsID0gc2VydmljZUJhc2UgKyAncGFzc2VuZ2VyL0dldERlZmF1bHRNb2JpbGl0eUFpZHMvJyArIGRpdmlzaW9uSWQgKyAnLycgKyBwYXNzZW5nZXJJZDtcclxuXHRcdFx0cmV0dXJuICRodHRwKHtcclxuXHRcdFx0XHRtZXRob2Q6ICdHRVQnLFxyXG5cdFx0XHRcdHVybDogdXJsICsgJz9ybmQ9JyArIG5ldyBEYXRlKCkuZ2V0VGltZSgpXHJcblx0XHRcdH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcblx0XHRcdFx0aWYgKHJlc3BvbnNlLnN0YXR1cyA9PSAyMDApIHtcclxuXHRcdFx0XHRcdHJldHVybiByZXNwb25zZS5kYXRhLnJlc3VsdDtcclxuXHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0cmV0dXJuIHJlc3BvbnNlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSwgZnVuY3Rpb24gKGVycikge1xyXG5cdFx0XHRcdHJldHVybiBudWxsO1xyXG5cdFx0XHR9KTtcclxuXHRcdH1cclxuXHR9XHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuZmFjdG9yeSgnUmVkaXJlY3Rpb25TZXJ2aWNlJywgUmVkaXJlY3Rpb25TZXJ2aWNlKTtcclxuXHJcbiAgICBSZWRpcmVjdGlvblNlcnZpY2UuJGluamVjdCA9IFsnJGxvY2F0aW9uJywnbG9jYWxTdG9yYWdlU2VydmljZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIFJlZGlyZWN0aW9uU2VydmljZSgkbG9jYXRpb24sbG9jYWxTdG9yYWdlU2VydmljZSkge1xyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgICAgICBzYXZlOiBzYXZlLFxyXG4gICAgICAgICAgICByZWRpcmVjdDogcmVkaXJlY3QsXHJcbiAgICAgICAgICAgIHJlZGlyZWN0VG86IHJlZGlyZWN0VG9cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2F2ZShwYXRoKSB7XHJcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZVNlcnZpY2Uuc2V0KCdjb21pbmctZnJvbScsIHBhdGgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVkaXJlY3QoKSB7XHJcbiAgICAgICAgICAgIHZhciBjb21pbmdGcm9tID0gbG9jYWxTdG9yYWdlU2VydmljZS5nZXQoJ2NvbWluZy1mcm9tJyk7XHJcbiAgICAgICAgICAgIGlmIChjb21pbmdGcm9tKVxyXG4gICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlU2VydmljZS5yZW1vdmUoJ2NvbWluZy1mcm9tJyk7XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIGNvbWluZ0Zyb20gPSAnZGFzaGJvYXJkLyc7XHJcblxyXG4gICAgICAgICAgICByZWRpcmVjdFRvKGNvbWluZ0Zyb20pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVkaXJlY3RUbyh1cmwpIHtcclxuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgodXJsKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5mYWN0b3J5KCdSZXNlcnZhdGlvblNlcnZpY2UnLCBSZXNlcnZhdGlvblNlcnZpY2UpO1xyXG5cclxuICAgIFJlc2VydmF0aW9uU2VydmljZS4kaW5qZWN0ID0gWyckaHR0cCcsICckcScsICdlbnYnLCdEaXZpc2lvblNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBSZXNlcnZhdGlvblNlcnZpY2UoJGh0dHAsICRxLCBlbnYsIERpdmlzaW9uU2VydmljZSkge1xyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgICAgICBjYW5jZWxSZXNlcnZhdGlvbjogY2FuY2VsUmVzZXJ2YXRpb24sXHJcbiAgICAgICAgICAgIGdldEFsbFJlc2VydmF0aW9uc0ZvclBhc3NlbmdlcjogZ2V0QWxsUmVzZXJ2YXRpb25zRm9yUGFzc2VuZ2VyLFxyXG4gICAgICAgICAgICBnZXRTdG9wSW5mb2ZvclJlc2VydmF0aW9uczogZ2V0U3RvcEluZm9mb3JSZXNlcnZhdGlvbnMsXHJcbiAgICAgICAgICAgIGdldFBhc3NlbmdlclJlc2VydmF0aW9uc0ZvclRvZGF5OiBnZXRQYXNzZW5nZXJSZXNlcnZhdGlvbnNGb3JUb2RheSxcclxuICAgICAgICAgICAgZ2V0VXNlclJlc2VydmF0aW9uRm9yOiBnZXRVc2VyUmVzZXJ2YXRpb25Gb3IsXHJcbiAgICAgICAgICAgIGdldFVzZXJSZXNlcnZhdGlvbnNCeUR1cmF0aW9uOiBnZXRVc2VyUmVzZXJ2YXRpb25zQnlEdXJhdGlvbixcclxuICAgICAgICAgICAgZ2V0VHJpcFRpbWluZ3NCeUR1cmF0aW9uOiBnZXRUcmlwVGltaW5nc0J5RHVyYXRpb24sXHJcbiAgICAgICAgICAgIGFkZFJlc2VydmF0aW9uczogYWRkUmVzZXJ2YXRpb25zLFxyXG4gICAgICAgICAgICBtYW5hZ2VQYXJraW5nRm9yUmVzZXJ2YXRpb246IG1hbmFnZVBhcmtpbmdGb3JSZXNlcnZhdGlvbiwgICAgICAgICAgICBcclxuICAgICAgICAgICAgZ2V0QWxsVHJpcHNGb3JDdXJyZW50UmVzZXJ2YXRpb246IGdldEFsbFRyaXBzRm9yQ3VycmVudFJlc2VydmF0aW9uLFxyXG4gICAgICAgICAgICBtb2RpZnlSZXNlcnZhdGlvbjogbW9kaWZ5UmVzZXJ2YXRpb24sXHJcbiAgICAgICAgICAgIGdldEFkdlJlc2VydmF0aW9uQWxsb3dlZFdlZWtzOiBnZXRBZHZSZXNlcnZhdGlvbkFsbG93ZWRXZWVrcyxcclxuICAgICAgICAgICAgZ2V0UmVzZXJ2YXRpb25CeUlkOiBnZXRSZXNlcnZhdGlvbkJ5SWQsXHJcbiAgICAgICAgICAgIGFkZFdhaXRsaXN0ZWRSZXNlcnZhdGlvbnM6IGFkZFdhaXRsaXN0ZWRSZXNlcnZhdGlvbnMsXHJcbiAgICAgICAgICAgIGdldEF2YWlsYWJsZVNlYXRzRm9yVHJpcDogZ2V0QXZhaWxhYmxlU2VhdHNGb3JUcmlwLFxyXG4gICAgICAgICAgICBnZXRQYXNzZW5nZXJUZW1wbGF0ZXM6IGdldFBhc3NlbmdlclRlbXBsYXRlcyxcclxuICAgICAgICAgICAgYWRkUGFzc2VuZ2VyVGVtcGxhdGU6YWRkUGFzc2VuZ2VyVGVtcGxhdGVcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldEFkdlJlc2VydmF0aW9uQWxsb3dlZFdlZWtzKCkge1xyXG4gICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5vbmVNVkFwaVVybCArICdjb21tdXRlci8nICsgRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKSArICcvcmVzZXJ2YXRpb25zL2FkdlJlc2VydmF0aW9uV2luZG93P3JuZD0nICsgbmV3IERhdGUoKS5nZXRNaWxsaXNlY29uZHMoKTtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICd1cmwnOiBzZXJ2aWNlVXJsXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBtb2RpZnlSZXNlcnZhdGlvbihyZXNlcnZhdGlvbklkLG5ld1RyaXBJZCwgcGFzc2VuZ2VySWQpIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBlbnYub25lTVZBcGlVcmwgKyAnY29tbXV0ZXIvJyArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCkgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcvcmVzZXJ2YXRpb25zLycgKyByZXNlcnZhdGlvbklkICsgJy9jaGFuZ2VQaWNrdXAvJyArIG5ld1RyaXBJZCArICcvJyArcGFzc2VuZ2VySWQ7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICB1cmw6IHNlcnZpY2VVcmwsXHJcbiAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldEFsbFRyaXBzRm9yQ3VycmVudFJlc2VydmF0aW9uKHJlc2VydmF0aW9uSWQsIHBhc3NlbmdlcklkKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gZW52Lm9uZU1WQXBpVXJsICsgJ2NvbW11dGVyLycgKyBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpICsgJy9yZXNlcnZhdGlvbnMvJyArIHJlc2VydmF0aW9uSWQgKyAnL2FsdFRyaXBzLycgKyBwYXNzZW5nZXJJZCArXHJcbiAgICAgICAgICAgICAgICAnP3JuZCcgKyBuZXcgRGF0ZSgpLmdldE1pbGxpc2Vjb25kcygpO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgdXJsOiBzZXJ2aWNlVXJsLFxyXG4gICAgICAgICAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJ1xyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0VXNlclJlc2VydmF0aW9uRm9yKHBhc3NlbmdlcklkLCBzY2hlZHVsZVR5cGUsIHJlc2VydmF0aW9uRGF0ZSkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5vbmVNVkFwaVVybCArICdjb21tdXRlci8nICsgRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKSArICcvcmVzZXJ2YXRpb25zL2Zvci8nICsgcGFzc2VuZ2VySWQgKyAnLycgKyBzY2hlZHVsZVR5cGUgK1xyXG4gICAgICAgICAgICAgICAgJy8nICsgcmVzZXJ2YXRpb25EYXRlICsgJy8nICsgJz9ybmQnICsgbmV3IERhdGUoKS5nZXRNaWxsaXNlY29uZHMoKTtcclxuICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgIHVybDogc2VydmljZVVybCxcclxuICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbidcclxuICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgXHJcbiAgICAgICAgZnVuY3Rpb24gYWRkUmVzZXJ2YXRpb25zKHBhc3NlbmdlcklkLCByZXNlcnZhdGlvbnMpIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBlbnYub25lTVZBcGlVcmwgKyAnY29tbXV0ZXIvJyArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCkgKyAnL3Jlc2VydmF0aW9ucy9hZGQvJyArIHBhc3NlbmdlcklkO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgICAgIHVybDogc2VydmljZVVybCxcclxuICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShyZXNlcnZhdGlvbnMpLFxyXG4gICAgICAgICAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgICAgICAgICAgICdBY2NlcHQnOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFkZFdhaXRsaXN0ZWRSZXNlcnZhdGlvbnMocGFzc2VuZ2VySWQsIHJlc2VydmF0aW9ucykge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5vbmVNVkFwaVVybCArICdjb21tdXRlci8nICsgRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKSArICcvcmVzZXJ2YXRpb25zL3dhaXRsaXN0L2FkZC8nICsgcGFzc2VuZ2VySWQ7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgICAgICAgICAgdXJsOiBzZXJ2aWNlVXJsLFxyXG4gICAgICAgICAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHJlc2VydmF0aW9ucyksXHJcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgJ0FjY2VwdCc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY2FuY2VsUmVzZXJ2YXRpb24ocGFzc2VuZ2VySWQscmVzZXJ2YXRpb25JZCkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5vbmVNVkFwaVVybCArICdjb21tdXRlci8nICsgRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKSAgKyAnLycgKyBwYXNzZW5nZXJJZCArICcvcmVzZXJ2YXRpb25zLycgKyByZXNlcnZhdGlvbklkICsgJy9jYW5jZWwnO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdERUxFVEUnLFxyXG4gICAgICAgICAgICAgICAgdXJsOiBzZXJ2aWNlVXJsLFxyXG4gICAgICAgICAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICAgICAgICAgICAnQWNjZXB0JzogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldEFsbFJlc2VydmF0aW9uc0ZvclBhc3NlbmdlcihwYXNzZW5nZXJJZCkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5vbmVNVkFwaVVybCArICdjb21tdXRlci8nICsgRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKSArICcvcmVzZXJ2YXRpb25zL2FsbC8nICsgcGFzc2VuZ2VySWQ7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICB1cmw6IHNlcnZpY2VVcmwsXHJcbiAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFN0b3BJbmZvZm9yUmVzZXJ2YXRpb25zKGluY2lkZW50SWQsc3RvcElkKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gZW52LmNvbW11dGVyQXBpVXJsICsgJ3Jlc2VydmF0aW9uLycgKyBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpICsgJy9zdG9wSW5mby8nICsgaW5jaWRlbnRJZCArICcvJyArIHN0b3BJZDtcclxuICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgIHVybDogc2VydmljZVVybCxcclxuICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbidcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRQYXNzZW5nZXJSZXNlcnZhdGlvbnNGb3JUb2RheSggcGFzc2VuZ2VySWQpIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBlbnYub25lTVZBcGlVcmwgKyAnY29tbXV0ZXIvJyArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCkgKyAnL3Jlc2VydmF0aW9ucy90b2RheS8nICsgcGFzc2VuZ2VySWQ7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICB1cmw6IHNlcnZpY2VVcmwsXHJcbiAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFVzZXJSZXNlcnZhdGlvbnNCeUR1cmF0aW9uKHVzZXJJZCwgc2NoZWR1bGVUeXBlLCBkdXJhdGlvbikge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5jb21tdXRlckFwaVVybCArICdyZXNlcnZhdGlvbi8nICsgRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKSArICcvdXNlci8nICsgdXNlcklkICsgJy8nICsgc2NoZWR1bGVUeXBlICsgJz9kdXJhdGlvbj0nICsgZHVyYXRpb247XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICB1cmw6IHNlcnZpY2VVcmwsXHJcbiAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFRyaXBUaW1pbmdzQnlEdXJhdGlvbihmcm9tU3RvcElkLCB0b1N0b3BJZCwgc2NoZWR1bGVUeXBlLCBkdXJhdGlvbikge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5jb21tdXRlckFwaVVybCArICdyZXNlcnZhdGlvbi8nICsgRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKSArICcvdHJpcFRpbWluZ3MvJyArIGZyb21TdG9wSWQgKyAnLycgKyB0b1N0b3BJZCArICcvJyArIHNjaGVkdWxlVHlwZSArICc/ZHVyYXRpb249JyArIGR1cmF0aW9uO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgdXJsOiBzZXJ2aWNlVXJsLFxyXG4gICAgICAgICAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJ1xyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIG1hbmFnZVBhcmtpbmdGb3JSZXNlcnZhdGlvbihwYXNzZW5nZXJJZCwgcmVzZXJ2YXRpb25JZCwgdmVoaWNsZUlkKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gZW52Lm9uZU1WQXBpVXJsICsgJ2NvbW11dGVyLycgKyBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpICsgJy8nICsgcGFzc2VuZ2VySWQgKyAnLycgKyByZXNlcnZhdGlvbklkICsgJy9tYW5hZ2VQYXJraW5nUmVzZXJ2YXRpb24vJyArIHZlaGljbGVJZDtcclxuICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnUFVUJyxcclxuICAgICAgICAgICAgICAgIHVybDogc2VydmljZVVybCxcclxuICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbidcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIFxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFJlc2VydmF0aW9uQnlJZChwYXNzZW5nZXJJZCwgaWQpIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBlbnYub25lTVZBcGlVcmwgKyAnY29tbXV0ZXIvJyArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCkgKyAnLycgKyBwYXNzZW5nZXJJZCArICcvcmVzZXJ2YXRpb25zLycgKyBpZDtcclxuICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgIHVybDogc2VydmljZVVybCxcclxuICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbidcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0QXZhaWxhYmxlU2VhdHNGb3JUcmlwKHRyaXBJZCwgcmVzZXJ2YXRpb25EYXRlKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gZW52Lm9uZU1WQXBpVXJsICsgJ2NvbW11dGVyLycgKyBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpICsgJy9hdmFpbGFibGVTZWF0cy8nICsgdHJpcElkICsgJy8nICsgcmVzZXJ2YXRpb25EYXRlO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgdXJsOiBzZXJ2aWNlVXJsLFxyXG4gICAgICAgICAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJ1xyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0UGFzc2VuZ2VyVGVtcGxhdGVzKHBhc3NlbmdlcklkKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gZW52Lm9uZU1WQXBpVXJsICsgJ2NvbW11dGVyLycgKyBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpICsgJy9yZXNlcnZhdGlvblRlbXBsYXRlcy8nICsgcGFzc2VuZ2VySWQ7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICB1cmw6IHNlcnZpY2VVcmwsXHJcbiAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFkZFBhc3NlbmdlclRlbXBsYXRlKHBhc3NlbmdlcklkLCB0ZW1wbGF0ZSkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5vbmVNVkFwaVVybCArICdjb21tdXRlci8nICsgRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKSArICcvcmVzZXJ2YXRpb25UZW1wbGF0ZXMvJyArIHBhc3NlbmdlcklkO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgICAgIHVybDogc2VydmljZVVybCxcclxuICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICAgICAgICAgICAgICBkYXRhOiB0ZW1wbGF0ZSxcclxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICAgICAgICAgICAnQWNjZXB0JzogJ2FwcGxpY2F0aW9uL2pzb24nLFxyXG4gICAgICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9OyAgICAgICAgXHJcbiAgICB9XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5mYWN0b3J5KCdTZXJ2aWNlQXJlYVNlcnZpY2UnLCBTZXJ2aWNlQXJlYVNlcnZpY2UpO1xyXG5cclxuICAgIFNlcnZpY2VBcmVhU2VydmljZS4kaW5qZWN0ID0gWyckaHR0cCcsJyRxJywnZW52J107XHJcblxyXG4gICAgZnVuY3Rpb24gU2VydmljZUFyZWFTZXJ2aWNlKCRodHRwLCRxLGVudikge1xyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgICAgICBpc0luU2VydmljZUFyZWE6IGlzSW5TZXJ2aWNlQXJlYVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBpc0luU2VydmljZUFyZWEoZGl2aXNpb25JZCwgbGF0LCBsb24pIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBlbnYub25lTVZBcGlPcmdVcmwgKyAnc2VydmljZWFyZWEvY2FuUmVnaXN0ZXJPckxvZ2luLycgKyBkaXZpc2lvbklkICsgJy8nICsgbGF0ICsgJy8nICsgbG9uO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgJ3VybCc6IHNlcnZpY2VVcmxcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignQWxsU3RvcHNDb250cm9sbGVyJywgQWxsU3RvcHNDb250cm9sbGVyKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdpbmZvV2luZG93Q29udHJvbGxlcicsIGluZm9XaW5kb3dDb250cm9sbGVyKTtcclxuXHJcbiAgICBpbmZvV2luZG93Q29udHJvbGxlci4kaW5qZWN0ID0gWyckbG9jYXRpb24nLCAnJHNjb3BlJywgJ1N0b3BEYXRhU2VydmljZSddO1xyXG4gICAgZnVuY3Rpb24gaW5mb1dpbmRvd0NvbnRyb2xsZXIoJGxvY2F0aW9uLCAkc2NvcGUsIFN0b3BEYXRhU2VydmljZSkge1xyXG4gICAgICAgXHJcbiAgICAgICAgJHNjb3BlLm5hdmlnYXRlVG9TZWxlY3RlZFN0b3AgPSBmdW5jdGlvbiAoc3RvcCkge1xyXG4gICAgICAgICAgICBTdG9wRGF0YVNlcnZpY2Uuc2V0U3RvcChzdG9wKTtcclxuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9jb21tdXRlci9zZWxlY3RlZC1zdG9wJyk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICAkc2NvcGUuZ2V0RGlyZWN0aW9uc1RvU2VsZWN0ZWRTdG9wID0gZnVuY3Rpb24gKHN0b3ApIHtcclxuICAgICAgICAgICAgU3RvcERhdGFTZXJ2aWNlLnNldFN0b3Aoc3RvcCk7XHJcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvY29tbXV0ZXIvZGlyZWN0aW9ucycpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgJHNjb3BlLm9wZW5NYXBBcHAgPSBmdW5jdGlvbiAoc3RvcCkge1xyXG4gICAgICAgICAgICB2YXIgdXJsID0gXCJcIjtcclxuICAgICAgICAgICAgaWYgKChuYXZpZ2F0b3IucGxhdGZvcm0uaW5kZXhPZihcImlQaG9uZVwiKSAhPSAtMSlcclxuICAgICAgICAgICAgICAgIHx8IChuYXZpZ2F0b3IucGxhdGZvcm0uaW5kZXhPZihcImlQb2RcIikgIT0gLTEpXHJcbiAgICAgICAgICAgICAgICB8fCAobmF2aWdhdG9yLnBsYXRmb3JtLmluZGV4T2YoXCJpUGFkXCIpICE9IC0xKSkge1xyXG4gICAgICAgICAgICAgICAgdXJsID0gXCJodHRwOi8vbWFwcy5hcHBsZS5jb20vP3E9XCIgKyBzdG9wLmxhdGl0dWRlICsgXCIsXCIgKyBzdG9wLmxvbmdpdHVkZTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHVybCA9IFwiaHR0cDovL21hcHMuZ29vZ2xlLmNvbS8/cT1cIiArIHN0b3AubGF0aXR1ZGUgKyBcIixcIiArIHN0b3AubG9uZ2l0dWRlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYgKHVybC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBGb3IgSW9uaWNcclxuICAgICAgICAgICAgICAgIGlmICgkKCdib2R5JykuaGFzQ2xhc3MoJ3BsYXRmb3JtLWNvcmRvdmEnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5vcGVuKHVybCwgJ19zeXN0ZW0nLCAnJyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5vcGVuKHVybCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9OyAgICBcclxuICAgIH1cclxuICAgIC8vYWRkcmVzcyBub3QgaW4gc2VydmljZSBhcmVhXHJcbiAgICBBbGxTdG9wc0NvbnRyb2xsZXIuJGluamVjdCA9IFsnJGxvY2F0aW9uJywgJ0dlb0xvY2F0aW9uU2VydmljZScsICdTdG9wRGF0YVNlcnZpY2UnLFxyXG4gICAgICAgICd1aUdtYXBJc1JlYWR5JywgJ0xvY2F0aW9uU2VydmljZScsICckaHR0cCcsICckdGltZW91dCcsICckd2luZG93JywgJ01lc3NhZ2VTZXJ2aWNlJywgJyRmaWx0ZXInLCAnUGFnZVNlcnZpY2UnLCdPbmVNdlNlcnZpY2VzJ107XHJcblxyXG4gICAgZnVuY3Rpb24gQWxsU3RvcHNDb250cm9sbGVyKCRsb2NhdGlvbiwgR2VvTG9jYXRpb25TZXJ2aWNlLCBTdG9wRGF0YVNlcnZpY2UsXHJcbiAgICAgICAgdWlHbWFwSXNSZWFkeSwgTG9jYXRpb25TZXJ2aWNlLCAkaHR0cCwgJHRpbWVvdXQsICR3aW5kb3csIE1lc3NhZ2VTZXJ2aWNlLCAkZmlsdGVyLCBQYWdlU2VydmljZSxPbmVNdlNlcnZpY2VzKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS5QYWdlU2VydmljZSA9IFBhZ2VTZXJ2aWNlO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlLnNldFRpdGxlKCdGaW5kIGEgYnVzIHN0b3AnKTtcclxuICAgICAgICB2bS5QYWdlU2VydmljZS5zZXRIZWFkbGluZShPbmVNdlNlcnZpY2VzLmdldENvbW11dGVySW5mbygpLmFsaWFzKTtcclxuICAgICAgICB2bS5zdG9wcyA9IFtdO1xyXG4gICAgICAgIHZtLmNsb3Nlc3RCdXNTdG9wID0gW107XHJcbiAgICAgICAvLyB2bS5vdGhlckJ1c1N0b3BzID0gW107XHJcbiAgICAgICAgdm0uYWxsT3RoZXJTdG9wcyA9IFtdO1xyXG4gICAgICAgIHZtLnNlYXJjaCA9ICcnO1xyXG4gICAgICAgIHZtLmlzTG9hZGluZyA9IHRydWU7XHJcbiAgICAgICAgdm0uY2VudGVyID0ge1xyXG4gICAgICAgICAgICBsYXRpdHVkZTogNDcuNjA0MzU2LFxyXG4gICAgICAgICAgICBsb25naXR1ZGU6IC0xMjIuMzM2MDgxN1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgdm0ucG9zaXRpb24gPSBudWxsO1xyXG4gICAgICAgIHZtLmxvY2F0aW9uID0gbnVsbDtcclxuICAgICAgICB2bS5zZWxlY3RlZExvY2F0aW9uID0gbnVsbDtcclxuICAgICAgICB2bS5zaG93TGlzdCA9IHRydWU7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdmFyIGNsb3Nlc3RQaW4sIG90aGVyUGluLCBsb2NhdGlvblBpbiwgbXlMb2NhdGlvblBpbiwgaHViSWNvbjtcclxuICAgICAgICBpZiAoJHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXCJUcmlkZW50XCIpID4gMCB8fCAkd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcIk1TSUVcIikgPiAwKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgY2xvc2VzdFBpbiA9ICdpbWFnZXMvcGluLWJ1c3N0b3AtZ3JlZW4ucG5nJztcclxuICAgICAgICAgICAgb3RoZXJQaW4gPSAnaW1hZ2VzL3Bpbi1idXNzdG9wLWdyZXkucG5nJztcclxuICAgICAgICAgICAgbG9jYXRpb25QaW4gPSAnaW1hZ2VzL3Bpbi1sb2NhdGlvbi5wbmcnO1xyXG4gICAgICAgICAgICBteUxvY2F0aW9uUGluID0gJ2ltYWdlcy9waW4tbXktbG9jYXRpb24ucG5nJztcclxuICAgICAgICAgICAgaHViSWNvbiA9ICdpbWFnZXMvcGluLWh1Yi5wbmcnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBjbG9zZXN0UGluID0gJ2ltYWdlcy9waW4tYnVzc3RvcC1ncmVlbi5zdmcnO1xyXG4gICAgICAgICAgICBvdGhlclBpbiA9ICdpbWFnZXMvcGluLWJ1c3N0b3AtZ3JleS5zdmcnO1xyXG4gICAgICAgICAgICBsb2NhdGlvblBpbiA9ICdpbWFnZXMvcGluLWxvY2F0aW9uLnN2Zyc7XHJcbiAgICAgICAgICAgIG15TG9jYXRpb25QaW4gPSAnaW1hZ2VzL3Bpbi1teS1sb2NhdGlvbi5zdmcnO1xyXG4gICAgICAgICAgICBodWJJY29uID0gJ2ltYWdlcy9waW4taHViLnN2Zyc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vaWYgY2xvc2UgdG8gYW1hem9uIGN1cnJlbnQgbG9jYXRpb24gZG9lcyBub3QgYXBwbHlcclxuICAgICAgICAvLyBpZiB5b3UgYXJlIHdheSBvdXQgY3VycmVudCBMb2NhdGlvbiBkb2VzIG5vdCBhcHBseVxyXG4gICAgICAgIC8vaGF2ZXJzaGluZSBmb3JtdWxhIHRvIGdldCBkaXN0YW5jZVxyXG4gICAgICAgIHZtLnpvb20gPSAxNTtcclxuICAgICAgICB2bS5teVN0eWxlcyA9IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGZlYXR1cmVUeXBlOiBcInBvaVwiLFxyXG4gICAgICAgICAgICBlbGVtZW50VHlwZTogXCJsYWJlbHNcIixcclxuICAgICAgICAgICAgc3R5bGVyczogW1xyXG4gICAgICAgICAgICAgICAgICB7IHZpc2liaWxpdHk6IFwib2ZmXCIgfVxyXG4gICAgICAgICAgICBdXHJcbiAgICAgICAgfSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFwiZmVhdHVyZVR5cGVcIjogXCJ0cmFuc2l0XCIsXHJcbiAgICAgICAgICAgIFwiZWxlbWVudFR5cGVcIjogXCJsYWJlbHMuaWNvblwiLFxyXG4gICAgICAgICAgICBcInN0eWxlcnNcIjogW1xyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFwidmlzaWJpbGl0eVwiOiBcIm9mZlwiXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIF1cclxuICAgICAgICB9XHJcbiAgICAgICAgXTtcclxuXHJcbiAgICAgICAgdm0ubWFwT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgbWFwVHlwZUNvbnRyb2w6IGZhbHNlLFxyXG4gICAgICAgICAgICB6b29tQ29udHJvbDogdHJ1ZSxcclxuICAgICAgICAgICAgc3RyZWV0Vmlld0NvbnRyb2w6IGZhbHNlLFxyXG4gICAgICAgICAgICBzdHlsZXM6IHZtLm15U3R5bGVzXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdm0ubWFwQ29udHJvbCA9IHt9OyAvL3RoaXMgb2JqZWN0IGdldHMgdGhlIG1hcCBjb250cm9sIGluc3RhbmNlIHNvIHRoYXQgd2UgY2FuIG1hbmlwdWxhdGUgaXRcclxuICAgICAgICB2bS5teUxvY2F0aW9uSWNvbiA9IHtcclxuICAgICAgICAgICAgdXJsOiBteUxvY2F0aW9uUGluLFxyXG4gICAgICAgICAgICBzaXplOiBuZXcgZ29vZ2xlLm1hcHMuU2l6ZSg0MiwgNDIpLFxyXG4gICAgICAgICAgICBvcmlnaW46IG5ldyBnb29nbGUubWFwcy5Qb2ludCgwLCAwKSxcclxuICAgICAgICAgICAgYW5jaG9yOiBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQoMjAsIDIwKVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgXHJcbiAgICAgICAgYWN0aXZhdGUoKTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0TWFwKCkge1xyXG4gICAgICAgICAgICB1aUdtYXBJc1JlYWR5LnByb21pc2UoKS50aGVuKGZ1bmN0aW9uIChtYXBzKSB7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEdlb0xvY2F0aW9uU2VydmljZS5nZXRDdXJyZW50UG9zaXRpb24oKTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBNZXNzYWdlU2VydmljZS5zaG93RXJyb3IoJ01hcCBjYW5ub3QgYmUgbG9hZGVkLicpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHBvc2l0aW9uKSB7XHJcbiAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgaWYgKHBvc2l0aW9uID09IHVuZGVmaW5lZCB8fCBwb3NpdGlvbiA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBTdG9wRGF0YVNlcnZpY2UuZ2V0QWxsQnVzU3RvcHMoKTtcclxuICAgICAgICAgICAgICAgIHZtLnBvc2l0aW9uID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImNvb3Jkc1wiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImxhdGl0dWRlXCI6IHBvc2l0aW9uLmNvb3Jkcy5sYXRpdHVkZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibG9uZ2l0dWRlXCI6IHBvc2l0aW9uLmNvb3Jkcy5sb25naXR1ZGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJpY29uXCI6IHZtLm15TG9jYXRpb25JY29uXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNlbGVjdGVkUG9zID0gU3RvcERhdGFTZXJ2aWNlLmdldEdlb0xvY2F0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkUG9zID09IHVuZGVmaW5lZCB8fCBzZWxlY3RlZFBvcyA9PSBudWxsIHx8IHNlbGVjdGVkUG9zLmlzQWRkcmVzcyA9PSB1bmRlZmluZWQgfHwgc2VsZWN0ZWRQb3MuaXNBZGRyZXNzID09IGZhbHNlKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRMb2NhdGlvbiA9IHZtLnBvc2l0aW9uO1xyXG4gICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0ubG9jYXRpb24gPSBzZWxlY3RlZFBvcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRMb2NhdGlvbiA9IHZtLmxvY2F0aW9uO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zZWFyY2ggPSBzZWxlY3RlZFBvcy5mb3JtYXR0ZWRfYWRkcmVzc1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgLy8gdm0uY2VudGVyID0gdm0ucG9zaXRpb247XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFN0b3BEYXRhU2VydmljZS5nZXRBbGxCdXNTdG9wcygpXHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkTG9jYXRpb24gPSBTdG9wRGF0YVNlcnZpY2UuZ2V0R2VvTG9jYXRpb24oKSB8fCBudWxsO1xyXG4gICAgICAgICAgICAgICAgaWYgKHZtLnNlbGVjdGVkTG9jYXRpb24gIT0gbnVsbCAmJiB2bS5zZWxlY3RlZExvY2F0aW9uLmlzQWRkcmVzcylcclxuICAgICAgICAgICAgICAgICAgICB2bS5zZWFyY2ggPSB2bS5zZWxlY3RlZExvY2F0aW9uLmZvcm1hdHRlZF9hZGRyZXNzO1xyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRMb2NhdGlvbiA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgU3RvcERhdGFTZXJ2aWNlLmNsZWFySXRlbSgnY3VyckxvY2F0aW9uJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBcclxuXHJcbiAgICAgICAgICAgICAgICBTdG9wRGF0YVNlcnZpY2VcclxuICAgICAgICAgICAgICAgICAgIC5nZXRBbGxCdXNTdG9wcygpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGxTdG9wcyhyZXNwb25zZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uaXNMb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2VTZXJ2aWNlLnNob3dFcnJvcignRXJyb3IgbG9hZGluZyBzdG9wcy4gUGxlYXNlIHRyeSBhZ2FpbiBsYXRlcicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAvL2FsZXJ0KGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UpXHJcbiAgICAgICAgICAgICAgICAgICAgZmlsbFN0b3BzKHJlc3BvbnNlKTtcclxuXHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIHZtLmlzTG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgTWVzc2FnZVNlcnZpY2Uuc2hvd0Vycm9yKCdFcnJvciBsb2FkaW5nIHN0b3BzLiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLicpO1xyXG4gICAgICAgICAgICAgICAgLy9hbGVydChlcnIpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy9tYXJrZXIgY2xpY2sgZnVuY3Rpb25cclxuICAgICAgICB2bS5tYXJrZXJFdmVudCA9IHtcclxuICAgICAgICAgICAgICAgIGNsaWNrOiBmdW5jdGlvbiAoZ01hcmtlciwgZXZlbnROYW1lLCBtb2RlbCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG1vZGVsLiRpZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vbmF2aWdhdGVUb1NlbGVjdGVkU3RvcChtb2RlbC5jb29yZHMpO1xyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGlmKHZtLnNlbGVjdGVkTG9jYXRpb24pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFN0b3BEYXRhU2VydmljZS5zZXRHZW9Mb2NhdGlvbih2bS5zZWxlY3RlZExvY2F0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICBTdG9wRGF0YVNlcnZpY2Uuc2V0U3RvcChtb2RlbC5jb29yZHMpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmNvb3JkcyA9IG1vZGVsLmNvb3JkcztcclxuICAgICAgICAgICAgICAgICAgICB2bS5zaG93ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLm5hdmlnYXRlVG9DbG9zZXN0U3RvcCA9IGZ1bmN0aW9uIChpbmRleCkge1xyXG4gICAgICAgICAgICB2bS5uYXZpZ2F0ZVRvU2VsZWN0ZWRTdG9wKHZtLmNsb3Nlc3RCdXNTdG9wW2luZGV4XSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZtLmdldERpcmVjdGlvbnNUb0Nsb3Nlc3RTdG9wID0gZnVuY3Rpb24gKGluZGV4KSB7XHJcbiAgICAgICAgICAgIHZtLmdldERpcmVjdGlvbnNUb1NlbGVjdGVkU3RvcCh2bS5jbG9zZXN0QnVzU3RvcFtpbmRleF0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2bS5nZXREaXJlY3Rpb25zVG9PdGhlclN0b3AgPSBmdW5jdGlvbiAoaW5kZXgpIHtcclxuICAgICAgICAgICAgdm0uZ2V0RGlyZWN0aW9uc1RvU2VsZWN0ZWRTdG9wKHZtLmFsbE90aGVyU3RvcHNbaW5kZXhdKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy92bS5nZXREaXJlY3Rpb25zVG9TZWxlY3RlZFN0b3AgPSBmdW5jdGlvbiAoc3RvcCkge1xyXG4gICAgICAgIC8vICAgIFN0b3BEYXRhU2VydmljZS5zZXRTdG9wKHN0b3ApO1xyXG4gICAgICAgIC8vICAgIFN0b3BEYXRhU2VydmljZS5zZXRHZW9Mb2NhdGlvbih2bS5zZWxlY3RlZExvY2F0aW9uKTtcclxuICAgICAgICAvLyAgICAkbG9jYXRpb24ucGF0aCgnL2NvbW11dGVyL2RpcmVjdGlvbnMnKTtcclxuICAgICAgICAvL307XHJcbiAgICAgICAgdm0uZGlzcGxheU1hcCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHZtLnNob3dMaXN0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnRyaWdnZXIodm0ubWFwQ29udHJvbC5nZXRHTWFwKCksICdyZXNpemUnKTtcclxuICAgICAgICAgICAgICAgIHJlc2V0TWFwKCk7XHJcbiAgICAgICAgICAgIH0sIDUwKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH07XHJcbiAgICAgIFxyXG4gICAgICAgIHZtLm5hdmlnYXRlVG9PdGhlclN0b3AgPSBmdW5jdGlvbiAoaW5kZXgpIHtcclxuICAgICAgICAgICAgdm0ubmF2aWdhdGVUb1NlbGVjdGVkU3RvcCh2bS5hbGxPdGhlclN0b3BzW2luZGV4XSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBcclxuICAgICAgICB2bS5sb2NhdGlvblNlYXJjaCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdm0uc2VsZWN0ZWRMb2NhdGlvbiA9IG51bGw7XHJcbiAgICAgICAgICAgIHZtLnNob3cgPSBmYWxzZTtcclxuICAgICAgICAgICAgaWYgKHZtLnNlYXJjaC50cmltKCkgPT0gJycpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFN0b3BEYXRhU2VydmljZS5jbGVhckl0ZW0oJ2N1cnJMb2NhdGlvbicpXHJcbiAgICAgICAgICAgICAgICBpZih2bS5wb3NpdGlvbiAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkTG9jYXRpb24gPSB2bS5wb3NpdGlvbjtcclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkTG9jYXRpb24gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdm0ubG9jYXRpb24gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgcG9wdWxhdGVTdG9wcygpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIExvY2F0aW9uU2VydmljZS5nZXRMb2NhdGlvbih2bS5zZWFyY2gpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBpZihyZXNwb25zZS5sZW5ndGggPiAwKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNlYXJjaCA9IHJlc3BvbnNlWzBdLmZvcm1hdHRlZF9hZGRyZXNzO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBsb2NhdGlvbkljb24gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogbG9jYXRpb25QaW5cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5sb2NhdGlvbiA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJjb29yZHNcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJsYXRpdHVkZVwiOiByZXNwb25zZVswXS5nZW9tZXRyeS5sb2NhdGlvbi5sYXQoKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibG9uZ2l0dWRlXCI6IHJlc3BvbnNlWzBdLmdlb21ldHJ5LmxvY2F0aW9uLmxuZygpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiaXNBZGRyZXNzXCI6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiZm9ybWF0dGVkX2FkZHJlc3NcIjogcmVzcG9uc2VbMF0uZm9ybWF0dGVkX2FkZHJlc3MsIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImljb25cIjogbG9jYXRpb25JY29uXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZExvY2F0aW9uID0gdm0ubG9jYXRpb247XHJcbiAgICAgICAgICAgICAgICAgICAgU3RvcERhdGFTZXJ2aWNlLnNldEdlb0xvY2F0aW9uKHZtLnNlbGVjdGVkTG9jYXRpb24pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcG9wdWxhdGVTdG9wcygpO1xyXG5cclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgTWVzc2FnZVNlcnZpY2Uuc2hvd0Vycm9yKCdDYW5ub3QgZmluZCB0aGUgbG9jYXRpb24nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9hbGVydChlcnIpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBcclxuXHJcbiAgICAgICB2bS5uYXZpZ2F0ZVRvU2VsZWN0ZWRTdG9wID0gZnVuY3Rpb24gKHN0b3ApIHtcclxuICAgICAgICAgICAgU3RvcERhdGFTZXJ2aWNlLnNldFN0b3Aoc3RvcCk7XHJcbiAgICAgICAgICAgICAgICAvL2lmICh2bS5wb3NpdGlvbiAhPSB1bmRlZmluZWQgJiYgdm0ucG9zaXRpb24gIT0gbnVsbClcclxuICAgICAgICAgICAgU3RvcERhdGFTZXJ2aWNlLnNldEdlb0xvY2F0aW9uKHZtLnNlbGVjdGVkTG9jYXRpb24pXHJcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvY29tbXV0ZXIvc2VsZWN0ZWQtc3RvcCcpO1xyXG4gICAgICAgIH1cclxuICAgICAgIC8vdm0ub3Blbk1hcEFwcCA9IGZ1bmN0aW9uIChzdG9wKSB7XHJcbiAgICAgICAvLyAgICB2YXIgdXJsID0gXCJcIjtcclxuICAgICAgIC8vICAgIGlmICgobmF2aWdhdG9yLnBsYXRmb3JtLmluZGV4T2YoXCJpUGhvbmVcIikgIT0gLTEpXHJcbiAgICAgICAvLyB8fCAobmF2aWdhdG9yLnBsYXRmb3JtLmluZGV4T2YoXCJpUG9kXCIpICE9IC0xKVxyXG4gICAgICAgLy8gICAgICAgIHx8IChuYXZpZ2F0b3IucGxhdGZvcm0uaW5kZXhPZihcImlQYWRcIikgIT0gLTEpKSB7XHJcbiAgICAgICAvLyAgICAgICAgdXJsID0gXCJodHRwOi8vbWFwcy5hcHBsZS5jb20vP3E9XCIgKyBzdG9wLmxhdGl0dWRlICsgXCIsXCIgKyBzdG9wLmxvbmdpdHVkZTtcclxuICAgICAgIC8vICAgIH1cclxuICAgICAgIC8vICAgIGVsc2Uge1xyXG4gICAgICAgLy8gICAgICAgIHVybCA9IFwiaHR0cDovL21hcHMuZ29vZ2xlLmNvbS8/cT1cIiArIHN0b3AubGF0aXR1ZGUgKyBcIixcIiArIHN0b3AubG9uZ2l0dWRlO1xyXG4gICAgICAgLy8gICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgLy8gICAgaWYgKHVybC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAvLyAgICAgICAgLy8gRm9yIElvbmljXHJcbiAgICAgICAvLyAgICAgICAgaWYgKCQoJ2JvZHknKS5oYXNDbGFzcygncGxhdGZvcm0tY29yZG92YScpKSB7XHJcbiAgICAgICAvLyAgICAgICAgICAgIHdpbmRvdy5vcGVuKHVybCwgJ19zeXN0ZW0nLCAnJyk7XHJcbiAgICAgICAvLyAgICAgICAgfSBlbHNlIHtcclxuICAgICAgIC8vICAgICAgICAgICAgd2luZG93Lm9wZW4odXJsKTtcclxuICAgICAgIC8vICAgICAgICB9XHJcbiAgICAgICAvLyAgICB9XHJcbiAgICAgICAvL31cclxuICAgICAgXHJcbiAgICAgICAgZnVuY3Rpb24gZmlsbFN0b3BzKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB2YXIgc3RvcHMgPSByZXNwb25zZS5kYXRhLnJlc3VsdC5zdG9wcztcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdG9wcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHN0b3BzICYmIHN0b3BzW2ldLmlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3AgPSBzdG9wc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICBzdG9wLmRpc3RhbmNlID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICBzdG9wLmljb24gPSAnaW1hZ2VzL3Bpbl9waWNrdXBAMXgucG5nJztcclxuICAgICAgICAgICAgICAgICAgICB2bS5zdG9wcy5wdXNoKHN0b3ApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHBvcHVsYXRlU3RvcHMoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICBmdW5jdGlvbiBwb3B1bGF0ZVN0b3BzKCkge1xyXG4gICAgICAgICAgICBpZiAodm0uc3RvcHMubGVuZ3RoID09IDApXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB2bS5tYXBDb250cm9sLmdldEdNYXAoKS5tYXJrZXJzID1bXTtcclxuICAgICAgICAgICAgdm0uY2xvc2VzdEJ1c1N0b3AgPSBbXTtcclxuICAgICAgICAgICAgdm0uYWxsT3RoZXJTdG9wcyA9IFtdO1xyXG4gICAgICAgICAgICB2YXIgc3RvcHNUb0NoZWNrID0gW107XHJcbiAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZtLnN0b3BzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodm0uc2VsZWN0ZWRMb2NhdGlvbiAhPSB1bmRlZmluZWQgJiYgdm0uc2VsZWN0ZWRMb2NhdGlvbiAhPSBudWxsKSB7Ly9oZXJlIGN1bGwgdGhlIG9uZXMgd2l0aCBsb25nIGRpc3RhbmNlc1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBkID0gcmVjdGlsaW5lYXJIYXZlcnNpbmUodm0uc2VsZWN0ZWRMb2NhdGlvbi5jb29yZHMsIHZtLnN0b3BzW2ldKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZCA8PSB2bS5kaXN0YW5jZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zdG9wc1tpXS5kaXN0YW5jZSA9IGQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0b3BzVG9DaGVjay5wdXNoKHZtLnN0b3BzW2ldKVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnN0b3BzW2ldLmRpc3RhbmNlID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uYWxsT3RoZXJTdG9wcy5wdXNoKHZtLnN0b3BzW2ldKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uc3RvcHNbaV0uZGlzdGFuY2UgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmFsbE90aGVyU3RvcHMucHVzaCh2bS5zdG9wc1tpXSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmICh2bS5zZWxlY3RlZExvY2F0aW9uICE9IG51bGwgJiYgc3RvcHNUb0NoZWNrLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIExvY2F0aW9uU2VydmljZS5nZXREcml2aW5nRGlzdGFuY2VzKHZtLnNlbGVjdGVkTG9jYXRpb24uY29vcmRzLCBzdG9wc1RvQ2hlY2spXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVzcG9uc2Uucm93c1swXS5lbGVtZW50cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcHNUb0NoZWNrW2ldLmRpc3RhbmNlID0gKHBhcnNlRmxvYXQocmVzcG9uc2Uucm93c1swXS5lbGVtZW50c1tpXS5kaXN0YW5jZS52YWx1ZSkgLyAxMDAwICogMC42MjEzNzEpLnRvRml4ZWQoMik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RvcHNUb0NoZWNrW2ldLmRpc3RhbmNlID4gdm0uZGlzdGFuY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdG9wc1RvQ2hlY2tbaV0uZGlzdGFuY2UgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHZtLmFsbE90aGVyU3RvcHMuaW5kZXhPZihzdG9wc1RvQ2hlY2tbaV0pIDwgMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uYWxsT3RoZXJTdG9wcy5wdXNoKHN0b3BzVG9DaGVja1tpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5jbG9zZXN0QnVzU3RvcC5wdXNoKHN0b3BzVG9DaGVja1tpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZVN0b3BzKCk7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vd2hlbiBsb2NhdGlvbiBzZXJ2aWNlcyBlcnIuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHZtLmFsbE90aGVyU3RvcHMsIHZtLnN0b3BzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvdGhlclN0b3BJY29uID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogb3RoZXJQaW4sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogbmV3IGdvb2dsZS5tYXBzLlNpemUoMzQsIDYwKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW46IG5ldyBnb29nbGUubWFwcy5Qb2ludCgwLCAwKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmNob3I6IG5ldyBnb29nbGUubWFwcy5Qb2ludCgyNCwgNTcpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5hbGxPdGhlclN0b3BzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGEuZGlzdGFuY2UgPT0gbnVsbCB8fCBiLmRpc3RhbmNlID09IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDEwMDAwXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGEuZGlzdGFuY2UgLWIuZGlzdGFuY2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh2bS5hbGxPdGhlclN0b3BzLCBmdW5jdGlvbiAoc3RvcCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0b3AuaWNvbiA9IG90aGVyU3RvcEljb247XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcC5kaXN0YW5jZSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC50cmlnZ2VyKHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpLCAncmVzaXplJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc2V0TWFwKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdXBkYXRlU3RvcHMoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgIFxyXG4gICAgICBmdW5jdGlvbiB1cGRhdGVTdG9wcygpXHJcbiAgICAgIHtcclxuICAgICAgICAgIHZtLmNsb3Nlc3RCdXNTdG9wLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcclxuICAgICAgICAgICAgICBpZihhLmRpc3RhbmNlID09IG51bGwgfHwgYi5kaXN0YW5jZSA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICByZXR1cm4gMTAwMDAgICAgICBcclxuICAgICAgICAgICAgICByZXR1cm4gYS5kaXN0YW5jZSAtIGIuZGlzdGFuY2VcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICB2bS5hbGxPdGhlclN0b3BzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcclxuICAgICAgICAgICAgICByZXR1cm4gKGEubmFtZSA8IGIubmFtZSkgPyAtMSA6IChhLm5hbWUgPiBiLm5hbWUpID8gMSA6IDA7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgdmFyIG90aGVyU3RvcEljb24gPSB7XHJcbiAgICAgICAgICAgICAgdXJsOiBvdGhlclBpbixcclxuICAgICAgICAgICAgICBzaXplOiBuZXcgZ29vZ2xlLm1hcHMuU2l6ZSgzNCwgNjApLFxyXG4gICAgICAgICAgICAgIG9yaWdpbjogbmV3IGdvb2dsZS5tYXBzLlBvaW50KDAsIDApLFxyXG4gICAgICAgICAgICAgIGFuY2hvcjogbmV3IGdvb2dsZS5tYXBzLlBvaW50KDIzLCA1NylcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgICB2YXIgY2xvc2VzdFN0b3BJY29uID0ge1xyXG4gICAgICAgICAgICAgIHVybDogY2xvc2VzdFBpbixcclxuICAgICAgICAgICAgICBzaXplOiBuZXcgZ29vZ2xlLm1hcHMuU2l6ZSgzNCwgNjApLFxyXG4gICAgICAgICAgICAgIG9yaWdpbjogbmV3IGdvb2dsZS5tYXBzLlBvaW50KDAsIDApLFxyXG4gICAgICAgICAgICAgIGFuY2hvcjogbmV3IGdvb2dsZS5tYXBzLlBvaW50KDIzLCA1NylcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgICBhbmd1bGFyLmZvckVhY2godm0uY2xvc2VzdEJ1c1N0b3AsIGZ1bmN0aW9uIChzdG9wKSB7XHJcbiAgICAgICAgICAgICAgaWYgKHN0b3AuaXNIdWIpXHJcbiAgICAgICAgICAgICAgICAgIHN0b3AuaWNvbiA9IGh1Ykljb247XHJcbiAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICBzdG9wLmljb24gPSBjbG9zZXN0U3RvcEljb247XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh2bS5hbGxPdGhlclN0b3BzLCBmdW5jdGlvbiAoc3RvcCkge1xyXG4gICAgICAgICAgICAgIGlmIChzdG9wLmlzSHViKVxyXG4gICAgICAgICAgICAgICAgICBzdG9wLmljb24gPSBodWJJY29uO1xyXG4gICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgc3RvcC5pY29uID0gb3RoZXJTdG9wSWNvbjtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgdm0uY2xvc2VzdENvdW50ID0gJGZpbHRlcignZmlsdGVyJykodm0uY2xvc2VzdEJ1c1N0b3AsIHsgaXNIdWI6IGZhbHNlIH0pLmxlbmd0aDtcclxuICAgICAgICAgIHZtLm90aGVyQ291bnQgPSAkZmlsdGVyKCdmaWx0ZXInKSh2bS5hbGxPdGhlclN0b3BzLCB7IGlzSHViOiBmYWxzZSB9KS5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQudHJpZ2dlcih2bS5tYXBDb250cm9sLmdldEdNYXAoKSwgJ3Jlc2l6ZScpO1xyXG4gICAgICAgICAgcmVzZXRNYXAoKTtcclxuICAgICAgICAgXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGZ1bmN0aW9uIHJlc2V0TWFwKClcclxuICAgICAge1xyXG4gICAgICAgICAgdmFyIGJvdW5kcyA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmdCb3VuZHMoKTtcclxuXHJcbiAgICAgICAgICBhbmd1bGFyLmZvckVhY2godm0uc3RvcHMsIGZ1bmN0aW9uIChzdG9wKSB7XHJcbiAgICAgICAgICAgICAgYm91bmRzLmV4dGVuZChuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKHN0b3AubGF0aXR1ZGUsIHN0b3AubG9uZ2l0dWRlKSk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgXHJcbiAgICAgICAgICBpZiAodm0uc2VsZWN0ZWRMb2NhdGlvbiAhPSB1bmRlZmluZWQgJiYgdm0uc2VsZWN0ZWRMb2NhdGlvbiAhPSBudWxsICYmIHZtLnN0b3BzWzBdLmRpc3RhbmNlICE9IG51bGwgJiYgdm0uc3RvcHNbMF0uZGlzdGFuY2UgPCB2bS5kaXN0YW5jZSkge1xyXG4gICAgICAgICAgICAgIGJvdW5kcy5leHRlbmQobmV3IGdvb2dsZS5tYXBzLkxhdExuZyh2bS5zZWxlY3RlZExvY2F0aW9uLmNvb3Jkcy5sYXRpdHVkZSwgdm0uc2VsZWN0ZWRMb2NhdGlvbi5jb29yZHMubG9uZ2l0dWRlKSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICB2bS5tYXBDb250cm9sLmdldEdNYXAoKS5maXRCb3VuZHMoYm91bmRzKTtcclxuICAgICAgICAgIHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpLnNldFpvb20odm0ubWFwQ29udHJvbC5nZXRHTWFwKCkuZ2V0Wm9vbSgpIC0gMSk7IFxyXG4gICAgICAgICAgdm0uaXNMb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICBmdW5jdGlvbiBoYXZlcnNpbmVGb3JtdWxhKG9yaWdpbiwgc3RvcCkge1xyXG4gICAgICAgICAgLy9wb3NpdGlvbjEgPSAgdm0ucG9zaXRpb25cclxuICAgICAgICAgIC8vcG9zaXRpb24yID0gc3RvcFxyXG4gICAgICAgICAgdmFyIGxhdDEgPSBvcmlnaW4ubGF0aXR1ZGU7XHJcbiAgICAgICAgICB2YXIgbG9uMSA9IG9yaWdpbi5sb25naXR1ZGU7XHJcbiAgICAgICAgICB2YXIgbGF0MiA9IHN0b3AubGF0aXR1ZGU7XHJcbiAgICAgICAgICB2YXIgbG9uMiA9IHN0b3AubG9uZ2l0dWRlXHJcblxyXG4gICAgICAgICAgdmFyIFIgPSA2MzcxOyAvLyBrbSBcclxuICAgICAgICAgIHZhciB4MSA9IGxhdDIgLSBsYXQxO1xyXG4gICAgICAgICAgdmFyIGRMYXQgPSB4MSAqIE1hdGguUEkgLyAxODA7XHJcbiAgICAgICAgICB2YXIgeDIgPSBsb24yIC0gbG9uMTtcclxuICAgICAgICAgIHZhciBkTG9uID0geDIgKiBNYXRoLlBJIC8gMTgwO1xyXG4gICAgICAgICAgdmFyIGEgPSBNYXRoLnNpbihkTGF0IC8gMikgKiBNYXRoLnNpbihkTGF0IC8gMikgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGguY29zKGxhdDEgKiBNYXRoLlBJIC8gMTgwKSAqIE1hdGguY29zKGxhdDIgKiBNYXRoLlBJIC8gMTgwKSAqXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5zaW4oZExvbiAvIDIpICogTWF0aC5zaW4oZExvbiAvIDIpO1xyXG4gICAgICAgICAgdmFyIGMgPSAyICogTWF0aC5hdGFuMihNYXRoLnNxcnQoYSksIE1hdGguc3FydCgxIC0gYSkpO1xyXG4gICAgICAgICAgdmFyIGQgPSBSICogYyAqIDAuNjIxMzc7IC8vY29udmVydCB0byBtaWxlc1xyXG4gICAgICAgICAgcmV0dXJuIGQudG9GaXhlZCgyKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgZnVuY3Rpb24gcmVjdGlsaW5lYXJIYXZlcnNpbmUobG9jMSwgbG9jMikge1xyXG4gICAgICAgICAgdmFyIHRlbXBQb2ludCA9IHtcclxuICAgICAgICAgICAgICBcImxhdGl0dWRlXCI6IGxvYzEubGF0aXR1ZGUsXHJcbiAgICAgICAgICAgICAgIFwibG9uZ2l0dWRlXCI6IGxvYzIubG9uZ2l0dWRlXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgdmFyIGQxID0gcGFyc2VGbG9hdChoYXZlcnNpbmVGb3JtdWxhKGxvYzEsIHRlbXBQb2ludCkpO1xyXG4gICAgICAgICAgdmFyIGQyID0gcGFyc2VGbG9hdChoYXZlcnNpbmVGb3JtdWxhKHRlbXBQb2ludCwgbG9jMikpO1xyXG4gICAgICAgICAgcmV0dXJuIChkMSArIGQyKS50b0ZpeGVkKDIpO1xyXG4gICAgICAgfVxyXG5cclxuIGZ1bmN0aW9uIGFjdGl2YXRlKClcclxuICAgIHtcclxuICAgICAkaHR0cC5nZXQoJ2NsaWVudGFwcHNldHRpbmdzLmpzb24nKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICB2bS5kaXN0YW5jZSA9IHJlc3BvbnNlLmRhdGEuc3RvcERpc3RhbmNlO1xyXG4gICAgICAgICB2bS5teVN0eWxlcyA9IHJlc3BvbnNlLmRhdGEuZ29vZ2xlTWFwT3B0b25zO1xyXG4gICAgICAgICBnZXRNYXAoKTtcclxuICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgIE1lc3NhZ2VTZXJ2aWNlLnNob3dFcnJvcignRXJyb3IgTG9hZGluZyBTdG9wcy4nKVxyXG4gICAgICAgICAvL2FsZXJ0KGVycik7XHJcbiAgICAgfSk7XHJcbiB9XHJcblxyXG4gICAgICAgIC8vIFN0YXJ0IG9mIGNvZGUgZm9yIElvbmljXHJcbiAgICAgICAgIHZtLmlvbmljSW5jbHVkZSA9ICdhcHAvbW9kdWxlcy9jb21tdXRlci9hbGwtc3RvcHMvYWxsLXN0b3BzLmh0bWwnO1xyXG4gICAgICAgICB2bS5pb25pY0N1c3RvbUNsYXNzTmFtZSA9ICcnO1xyXG4gICAgICAgICB2bS5pb25pY0hpZGVOYXZCYXIgPSBmYWxzZTtcclxuICAgICAgICAgdm0uaW9uaWNVc2VSZWZyZXNoZXIgPSBmYWxzZTtcclxuICAgICAgICAvLyBFbmQgb2YgY29kZSBmb3IgSW9uaWNcclxuXHJcbiBcclxuICAgIH1cclxuICAgXHJcbiAgIFxyXG5cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAuY29udHJvbGxlcignQWR2U2NoZWR1bGVDb25maXJtYXRpb25Db250cm9sbGVyJywgQWR2U2NoZWR1bGVDb25maXJtYXRpb25Db250cm9sbGVyKTtcclxuXHJcbiAgICBBZHZTY2hlZHVsZUNvbmZpcm1hdGlvbkNvbnRyb2xsZXIuJGluamVjdCA9IFsnJHN0YXRlJywgJyRzdGF0ZVBhcmFtcycsICckZmlsdGVyJywgJyR1aWJNb2RhbCcsXHJcbiAgICAgICAgJ1Jlc2VydmF0aW9uU2VydmljZScsICdEaXZpc2lvblNlcnZpY2UnLCAnYXV0aFNlcnZpY2UnLCAnU3RvcERhdGFTZXJ2aWNlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gQWR2U2NoZWR1bGVDb25maXJtYXRpb25Db250cm9sbGVyKCRzdGF0ZSwgJHN0YXRlUGFyYW1zLCAkZmlsdGVyLCAkdWliTW9kYWwsXHJcbiAgICAgICAgUmVzZXJ2YXRpb25TZXJ2aWNlLCBEaXZpc2lvblNlcnZpY2UsIGF1dGhTZXJ2aWNlLCBTdG9wRGF0YVNlcnZpY2UpIHtcclxuXHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS50aXRsZSA9ICdBZHZhbmNlIFJlc2VydmF0aW9ucyBDb25maXJtYXRpb24nO1xyXG4gICAgICAgIGlmIChpc05vdEZyb21BZHZTY2hlZHVsZSgpKSB7XHJcbiAgICAgICAgICAgICRzdGF0ZS5nbygnYWR2LXNjaGVkdWxlLXNldHVwJyk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBzZWxlY3RlZENvbmZpZyA9ICRzdGF0ZVBhcmFtcy5vYmouY29uZmlnO1xyXG4gICAgICAgIHZhciB3ZWVrcyA9ICRzdGF0ZVBhcmFtcy5vYmoucmVzZXJ2YXRpb25JbmZvO1xyXG4gICAgICAgIHZhciByZXNlcnZhdGlvbnMgPSBbXTtcclxuICAgICAgICB2YXIgcGFzc2VuZ2VySWQgPSBhdXRoU2VydmljZS5hdXRoZW50aWNhdGlvbi5wYXNzZW5nZXJJZDtcclxuICAgICAgICB2bS5kaXZpc2lvbkFsbG93c1dhaXRsaXN0ID0gdHJ1ZTtcclxuICAgICAgIFxyXG4gICAgICAgIHZtLnN1Y2Nlc3NBbmltZSA9IHN1Y2Nlc3NBbmltZTtcclxuICAgICAgICB2bS5zY2hlZHVsZSA9IHNlbGVjdGVkQ29uZmlnLnNjaGVkdWxlO1xyXG4gICAgICAgIHZtLnJlc2VydmUgPSByZXNlcnZlO1xyXG5cclxuICAgICAgICB2bS5zaG93UmVzZXJ2YXRpb24gPSBzaG93UmVzZXJ2YXRpb247XHJcbiAgICAgICAgdm0uYm9va1JldHVyblRyaXAgPSBib29rUmV0dXJuVHJpcDtcclxuICAgICAgICB2bS5iYWNrID0gYmFjaztcclxuICAgICAgICB2bS5waWNrdXAgPSBzZWxlY3RlZENvbmZpZy5waWNrdXA7XHJcbiAgICAgICAgdm0uZHJvcG9mZiA9IHNlbGVjdGVkQ29uZmlnLmRyb3BvZmY7XHJcbiAgICAgICAgdm0ud2Vla3NUb0Rpc3BsYXkgPSBmaWx0ZXJTZWxlY3RlZFRyaXBzKCk7XHJcbiAgICAgICAgdm0ucmVzZXJ2aW5nID0gZmFsc2U7XHJcblxyXG4gICAgICAgIC8vU3VjY2VzcyBBbmltYXRpb25cclxuICAgICAgICBmdW5jdGlvbiBzdWNjZXNzQW5pbWUoKXtcclxuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICBhbmltZSh7XHJcbiAgICAgICAgICAgICAgICB0YXJnZXRzOiAnLmFuaW0tLXN1Y2Nlc3MgLmxpbmVzIHBhdGgnLFxyXG4gICAgICAgICAgICAgICAgc3Ryb2tlRGFzaG9mZnNldDogW2FuaW1lLnNldERhc2hvZmZzZXQsIDBdLFxyXG4gICAgICAgICAgICAgICAgZWFzaW5nOiAnZWFzZUluT3V0U2luZScsXHJcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogMTUwMCxcclxuICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogJ2FsdGVybmF0ZScsXHJcbiAgICAgICAgICAgICAgICBsb29wOiBmYWxzZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9LCAwKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBEaXZpc2lvblNlcnZpY2VcclxuICAgICAgICAgICAgICAgLmlzV2FpdGxpc3RBbGxvd2VkQnlEaXZpc2lvbigpXHJcbiAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgIHZtLmRpdmlzaW9uQWxsb3dzV2FpdGxpc3QgPSByZXNwb25zZTtcclxuICAgICAgICAgICB9KTtcclxuICAgICAgICBcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYm9va1JldHVyblRyaXAoKSB7XHJcblxyXG4gICAgICAgICAgICBTdG9wRGF0YVNlcnZpY2UuZ2V0UGlja3VwRm9yUmV0dXJuVHJpcChzZWxlY3RlZENvbmZpZy5waWNrdXAuaWQsIHNlbGVjdGVkQ29uZmlnLmRyb3BvZmYuaWQpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG5cclxuICAgICAgICAgICAgICAgIHNlbGVjdGVkQ29uZmlnLnNjaGVkdWxlID0gXCJQTVwiO1xyXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRDb25maWcuZHJvcG9mZiA9IGFuZ3VsYXIuY29weSh2bS5waWNrdXApO1xyXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRDb25maWcucGlja3VwID0gbWFwUGlja3VwKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgIHNlbGVjdGVkQ29uZmlnLnZlaGljbGUgPSB7ICdsaWNlbmNlcGxhdGUnOiAnLS0nLCAndmVoaWNsZUlkJzogdW5kZWZpbmVkIH07XHJcblxyXG4gICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdhZHYtc2NoZWR1bGUtc2V0dXAnLCB7IG9iajogeyBjb25maWc6IHNlbGVjdGVkQ29uZmlnIH0gfSk7XHJcblxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZXJyb3IgZmV0Y2hpbmcgcGlja3VwIGZvciByZXR1cm4gdHJpcC5cIik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbWFwUGlja3VwKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0KVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGEucmVzdWx0O1xyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYW5ndWxhci5jb3B5KHZtLmRyb3BvZmYpO1xyXG5cclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBmaWx0ZXJTZWxlY3RlZFRyaXBzKCkge1xyXG5cclxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IFtdO1xyXG5cclxuICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHdlZWtzLCBmdW5jdGlvbiAod2Vlaykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHNlbGVjdGVkUmVjb3JkcyA9IHsgZnJvbTogJycsIHRvOiAnJywgZGF5czogW10gfTtcclxuICAgICAgICAgICAgICAgIHNlbGVjdGVkUmVjb3Jkcy5mcm9tID0gJGZpbHRlcignZGF0ZScpKHdlZWtbMF0uZGF0ZSwgJ01NL2RkL3l5eXknKTtcclxuICAgICAgICAgICAgICAgIHNlbGVjdGVkUmVjb3Jkcy50byA9ICRmaWx0ZXIoJ2RhdGUnKSh3ZWVrW3dlZWsubGVuZ3RoIC0gMV0uZGF0ZSwgJ01NL2RkL3l5eXknKTtcclxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh3ZWVrLCBmdW5jdGlvbiAoZGF5KSB7ICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2FuUmVzZXJ2ZShkYXkpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZFJlY29yZHMuZGF5cy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGU6IGRheS5kYXRlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVoaWNsZTogZGF5LnZlaGljbGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmlwOiBnZXRUcmlwKGRheSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1Jlc2VydmVkOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzV2FpdGxpc3Q6IGlzV2FpdGxpc3RSZXF1ZXN0KGRheSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YWl0bGlzdENvdW50OiBnZXRXYWl0bGlzdENvdW50KGRheSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaChzZWxlY3RlZFJlY29yZHMpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaXNXYWl0bGlzdFJlcXVlc3QoZGF5KSB7XHJcbiAgICAgICAgICAgIHZhciB3YWl0bGlzdENvdW50ID0gZ2V0V2FpdGxpc3RDb3VudChkYXkpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIChkYXkudmVoaWNsZS5pZCAmJiBkYXkuYXZhaWxhYmxlUGFya2luZyA8PSAwKSB8fCAod2FpdGxpc3RDb3VudCAhPSB1bmRlZmluZWQgJiYgd2FpdGxpc3RDb3VudCA+PSAwKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFdhaXRsaXN0Q291bnQoZGF5KSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgdHJpcCA9IGdldFRyaXAoZGF5KTtcclxuICAgICAgICAgICAgaWYgKHRyaXAuYXZhaWxhYmxlQ2FwYWNpdHkgPD0gMCkgcmV0dXJuIHRyaXAubnVtYmVyT2ZXYWl0bGlzdHM7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFRyaXAoZGF5KSB7XHJcbiAgICAgICAgICAgIGlmIChkYXkudHJpcHMgJiYgZGF5LnNlbGVjdGVkVHJpcCkge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkYXkudHJpcHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZGF5LnRyaXBzW2ldLnRyaXBJZCA9PSBkYXkuc2VsZWN0ZWRUcmlwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF5LnRyaXBzW2ldO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYmFjaygpIHtcclxuICAgICAgICAgICAgJHN0YXRlLmdvKCdhZHYtc2NoZWR1bGUnLCB7IG9iajogJHN0YXRlUGFyYW1zLm9iaiB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGlzTm90RnJvbUFkdlNjaGVkdWxlKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJHN0YXRlUGFyYW1zLm9iaiA9PSB1bmRlZmluZWQgfHwgJHN0YXRlUGFyYW1zLm9iaiA9PSBudWxsIHx8XHJcbiAgICAgICAgICAgICAgICAkc3RhdGVQYXJhbXMub2JqLnJlc2VydmF0aW9uSW5mbyA9PSBudWxsIHx8ICRzdGF0ZVBhcmFtcy5vYmoucmVzZXJ2YXRpb25JbmZvID09IHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNhblJlc2VydmUoZGF5KSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgc2VsZWN0ZWRUcmlwID0gZ2V0VHJpcChkYXkpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGRheS5pc09wZW4gJiYgc2VsZWN0ZWRUcmlwICE9IG51bGwgJiYgc2VsZWN0ZWRUcmlwLnRvdGFsUGFzc2VuZ2VycyA+IDA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBjcmVhdGVSZXNlcnZhdGlvblJlcXVlc3QoKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgcmVzZXJ2YXRpb25zID0gW107XHJcblxyXG4gICAgICAgICAgICB2YXIgd2Vla0luZGV4ID0gMDtcclxuICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHdlZWtzLCBmdW5jdGlvbiAod2Vlaykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRheUluZGV4ID0gMDtcclxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh3ZWVrLCBmdW5jdGlvbiAoZGF5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhblJlc2VydmUoZGF5KSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRyaXAgPSBnZXRUcmlwKGRheSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzZXJ2YXRpb24gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNlcnZhdGlvbkRhdGU6IGRheS5kYXRlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJpcElkOiB0cmlwLnRyaXBJZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBpY2t1cFN0b3BJZDogdm0ucGlja3VwLmlkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZHJvcG9mZlN0b3BJZDogdm0uZHJvcG9mZi5pZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3NlbmdlcklkOiBwYXNzZW5nZXJJZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvdXRlSWQ6IHRyaXAucm91dGVJZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVkdWxlIDp2bS5zY2hlZHVsZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpdmlzaW9uSWQ6IERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2ZWhpY2xlSWQ6IGRheS52ZWhpY2xlICE9IG51bGwgPyBkYXkudmVoaWNsZS5pZCA6IG51bGwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0FkdmFuY2U6IHRydWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzZXJ2YXRpb25zLnB1c2goXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3Jlc2VydmF0aW9uJzogcmVzZXJ2YXRpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2lkJzogd2Vla0luZGV4ICsgJ18nICsgZGF5SW5kZXhcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXlJbmRleCsrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgd2Vla0luZGV4Kys7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzZXJ2YXRpb25zO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVzZXRSZXNlcnZhdGlvblZhcmlhYmxlcyhpZCkge1xyXG4gICAgICAgICAgICB2YXIgZGF5ID0gZ2V0RGF5SWRlbnRpZmllcihpZCk7XHJcbiAgICAgICAgICAgIGRheS5yZXNlcnZhdGlvbkZhaWxlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBkYXkucmVzZXJ2YXRpb25FcnJvciA9ICcnO1xyXG4gICAgICAgICAgICBkYXkuaXNSZXNlcnZlZCA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVzZXJ2ZSgpIHtcclxuICAgICAgICAgICAgdmFyIHJlc2VydmF0aW9ucyA9IGNyZWF0ZVJlc2VydmF0aW9uUmVxdWVzdCgpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHJlc2VydmF0aW9ucyAmJiByZXNlcnZhdGlvbnMubGVuZ3RoID4gMClcclxuICAgICAgICAgICAgICAgIHZtLnJlc2VydmluZyA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJlc2VydmF0aW9ucy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgKGNyZWF0ZVJlc2VydmF0aW9uKShyZXNlcnZhdGlvbnNbaV0ucmVzZXJ2YXRpb24sIHJlc2VydmF0aW9uc1tpXS5pZCk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBjcmVhdGVSZXNlcnZhdGlvbihyZXF1ZXN0LCBpZCkge1xyXG5cclxuICAgICAgICAgICAgcmVzZXRSZXNlcnZhdGlvblZhcmlhYmxlcyhpZCk7XHJcblxyXG4gICAgICAgICAgICBSZXNlcnZhdGlvblNlcnZpY2UuYWRkUmVzZXJ2YXRpb25zKHBhc3NlbmdlcklkLCBbcmVxdWVzdF0pXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDFcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0LmVycm9ycy5sZW5ndGggPT0gMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXJrUmVzZXJ2ZWQoaWQsIHJlc3BvbnNlLmRhdGEucmVzdWx0LmlkWzBdKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NBbmltZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRSZXNlcnZhdGlvbkZhaWx1cmVNZXNzYWdlKGlkLCByZXNwb25zZS5kYXRhLnJlc3VsdC5lcnJvcnMgPyByZXNwb25zZS5kYXRhLnJlc3VsdC5lcnJvcnNbMF0gOiByZXNwb25zZS5kYXRhLnJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0UmVzZXJ2YXRpb25GYWlsdXJlTWVzc2FnZShpZCwgZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0RGF5SWRlbnRpZmllcihkYXlJZGVudGlmaWVyKSB7XHJcbiAgICAgICAgICAgIHZhciBpZFBhcnRzID0gZGF5SWRlbnRpZmllci5zcGxpdCgnXycpO1xyXG4gICAgICAgICAgICB2YXIgd2VlayA9IGlkUGFydHNbMF07XHJcbiAgICAgICAgICAgIHZhciBkYXkgPSBpZFBhcnRzWzFdO1xyXG4gICAgICAgICAgICByZXR1cm4gdm0ud2Vla3NUb0Rpc3BsYXlbd2Vla10uZGF5c1tkYXldO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2V0UmVzZXJ2YXRpb25GYWlsdXJlTWVzc2FnZShkYXlJZGVudGlmaWVyLCBlcnJvck1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgdmFyIGRheSA9IGdldERheUlkZW50aWZpZXIoZGF5SWRlbnRpZmllcik7XHJcbiAgICAgICAgICAgIGRheS5yZXNlcnZhdGlvbkZhaWxlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIGRheS5yZXNlcnZhdGlvbkVycm9yID0gZXJyb3JNZXNzYWdlOyBcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIG1hcmtSZXNlcnZlZChkYXlJZGVudGlmaWVyLCByZXNlcnZhdGlvbklkKSB7XHJcbiAgICAgICAgICAgIHZhciBkYXkgPSBnZXREYXlJZGVudGlmaWVyKGRheUlkZW50aWZpZXIpO1xyXG4gICAgICAgICAgICBkYXkuaXNSZXNlcnZlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIGRheS5yZXNlcnZhdGlvbiA9IHJlc2VydmF0aW9uSWQ7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2hvd1Jlc2VydmF0aW9uKGlkKSB7XHJcblxyXG4gICAgICAgICAgICBSZXNlcnZhdGlvblNlcnZpY2UuZ2V0UmVzZXJ2YXRpb25CeUlkKHBhc3NlbmdlcklkLCBpZClcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEpXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1vZGFsUmVzZXJ2ZSA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzaXplOiAnLWZzJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmFja2Ryb3A6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9tb2R1bGVzL2NvbW11dGVyL2Fkdi1zY2hlZHVsZS9yZXNlcnZhdGlvbi1tb2RhbC5odG1sJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1Jlc2VydmF0aW9uTW9kYWxDb250cm9sbGVyIGFzIHZtJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzZXJ2YXRpb246IHJlc3BvbnNlLmRhdGEucmVzdWx0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICd1c2Ugc3RyaWN0JztcclxuICAgIGFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgIC5jb250cm9sbGVyKCdBZHZTY2hlZHVsZUNvbnRyb2xsZXInLCBBZHZTY2hlZHVsZUNvbnRyb2xsZXIpO1xyXG4gICAgQWR2U2NoZWR1bGVDb250cm9sbGVyLiRpbmplY3QgPSBbJyRzY29wZScsICckc3RhdGUnLCAnJHN0YXRlUGFyYW1zJywgJyRxJywgJyRsb2NhdGlvbicsICckYW5jaG9yU2Nyb2xsJywgJyR0aW1lb3V0JywgJyR1aWJNb2RhbCcsXHJcbiAgICAgICAgJ2F1dGhTZXJ2aWNlJywgJ1N0b3BEYXRhU2VydmljZScsICd2ZWhpY2xlU2VydmljZScsICdQYWdlU2VydmljZScsXHJcbiAgICAgICAgJ1Jlc2VydmF0aW9uU2VydmljZScsICdEaXZpc2lvblNlcnZpY2UnLCAnTWVzc2FnZVNlcnZpY2UnLCAnQ29tbW9uU2VydmljZScsICdTY2hlZHVsZVNlcnZpY2UnLCAnc21vb3RoU2Nyb2xsJ107XHJcblxyXG4gICAgZnVuY3Rpb24gQWR2U2NoZWR1bGVDb250cm9sbGVyKCRzY29wZSwgJHN0YXRlLCAkc3RhdGVQYXJhbXMsICRxLCAkbG9jYXRpb24sICRhbmNob3JTY3JvbGwsICR0aW1lb3V0LCAkdWliTW9kYWwsXHJcbiAgICAgICAgYXV0aFNlcnZpY2UsIFN0b3BEYXRhU2VydmljZSwgdmVoaWNsZVNlcnZpY2UsIFBhZ2VTZXJ2aWNlLFxyXG4gICAgICAgIFJlc2VydmF0aW9uU2VydmljZSwgRGl2aXNpb25TZXJ2aWNlLCBNZXNzYWdlU2VydmljZSwgQ29tbW9uU2VydmljZSwgU2NoZWR1bGVTZXJ2aWNlLCBzbW9vdGhTY3JvbGwpIHtcclxuXHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS5QYWdlU2VydmljZSA9IFBhZ2VTZXJ2aWNlO1xyXG5cclxuICAgICAgICBpZiAoaXNOb3RGcm9tQWR2U2V0dXAoKSAmJiAhaXNGcm9tQWR2Q29uZmlybSgpKSB7XHJcbiAgICAgICAgICAgICRzdGF0ZS5nbygnYWR2LXNjaGVkdWxlLXNldHVwJyk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBwYXNzZW5nZXJJZCA9IHVuZGVmaW5lZDtcclxuICAgICAgICB2YXIgcGFzc2VuZ2VyUmVzZXJ2YXRpb25zID0gW107XHJcbiAgICAgICAgdmFyIHBpY2t1cCA9IHVuZGVmaW5lZDtcclxuICAgICAgICB2YXIgZHJvcG9mZiA9IHVuZGVmaW5lZDtcclxuICAgICAgICB2YXIgYWR2V2Vla3MgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgdmFyIGRpdmlzaW9uRGF0ZSA9IG1vbWVudCgpO1xyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHtcclxuXHJcbiAgICAgICAgICAgIC8vZXZlbnQgYmluZGluZ3NcclxuICAgICAgICAgICAgdm0ucmVzZXJ2ZSA9IHJlc2VydmU7XHJcbiAgICAgICAgICAgIHZtLmZpbHRlcldlZWtlbmQgPSBmaWx0ZXJXZWVrZW5kO1xyXG4gICAgICAgICAgICB2bS5zaG93U2NoZWR1bGUgPSBzaG93U2NoZWR1bGU7XHJcbiAgICAgICAgICAgIHZtLmRheUNsYXNzID0gYXBwbHlDbGFzcztcclxuICAgICAgICAgICAgdm0ucmVzZXRQYXNzZW5nZXJWZWhpY2xlID0gcmVzZXRQYXNzZW5nZXJWZWhpY2xlO1xyXG4gICAgICAgICAgICB2bS5iYWNrID0gYmFjaztcclxuICAgICAgICAgICAgdm0uc2hvd1Jlc2VydmF0aW9uSW5mbyA9IHNob3dSZXNlcnZhdGlvbkluZm87XHJcblxyXG4gICAgICAgICAgICAvL2dsb2JhbCB2YXJpYWJsZXNcclxuICAgICAgICAgICAgdm0ubm9WZWhpY2xlID0geyAnbGljZW5jZXBsYXRlJzogJy0tJywgJ2lkJzogdW5kZWZpbmVkIH07XHJcbiAgICAgICAgICAgIHZtLmNhcm91c2VsT3B0aW9ucyA9IHNldENhcm91c2VsT3B0aW9ucygpO1xyXG4gICAgICAgICAgICB2bS5zZWxlY3RlZENvbmZpZyA9ICRzdGF0ZVBhcmFtcy5vYmouY29uZmlnO1xyXG4gICAgICAgICAgICB2bS5wYXNzZW5nZXJWZWhpY2xlcyA9ICRzdGF0ZVBhcmFtcy5vYmoudmVoaWNsZXM7XHJcbiAgICAgICAgICAgIHZtLndlZWtzID0gW107XHJcbiAgICAgICAgICAgIHZtLmRpdmlzaW9uQWxsb3dzV2FpdGxpc3QgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgLy9sb2NhbCB2YXJpYWJsZXNcclxuICAgICAgICAgICAgcGFzc2VuZ2VySWQgPSBhdXRoU2VydmljZS5hdXRoZW50aWNhdGlvbi5wYXNzZW5nZXJJZDtcclxuICAgICAgICAgICAgcGFzc2VuZ2VyUmVzZXJ2YXRpb25zID0gW107XHJcbiAgICAgICAgICAgIHBpY2t1cCA9IHZtLnNlbGVjdGVkQ29uZmlnLnBpY2t1cDtcclxuICAgICAgICAgICAgZHJvcG9mZiA9IHZtLnNlbGVjdGVkQ29uZmlnLmRyb3BvZmY7XHJcbiAgICAgICAgICAgIGFkdldlZWtzID0gdm0uc2VsZWN0ZWRDb25maWcubnVtT2ZXZWVrcy5uYW1lO1xyXG5cclxuICAgICAgICAgICAgdm0uUGFnZVNlcnZpY2Uuc2V0VGl0bGUocGlja3VwLm5hbWUgKyAnLScgKyBkcm9wb2ZmLm5hbWUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2V0Q2Fyb3VzZWxPcHRpb25zKCkge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgbmF2VGV4dDogW1wiXCIsIFwiXCJdLFxyXG4gICAgICAgICAgICAgICAgcmVzcG9uc2l2ZUNsYXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIG5hdjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIGxvb3A6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgaXRlbUVsZW1lbnQ6ICdjYWxfX3dlZWsnLFxyXG4gICAgICAgICAgICAgICAgb25EcmFnZ2VkOiBjYXJvdXNlbEl0ZW1DaGFuZ2VkRXZlbnQsXHJcbiAgICAgICAgICAgICAgICBpdGVtczogMVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY2Fyb3VzZWxJdGVtQ2hhbmdlZEV2ZW50KGV2ZW50KSB7XHJcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZXZlbnQucGFnZS5pbmRleCk7XHJcbiAgICAgICAgICAgIHZhciBvcHRpb25zID0ge1xyXG4gICAgICAgICAgICAgICAgZHVyYXRpb246IDcwMCxcclxuICAgICAgICAgICAgICAgIGVhc2luZzogJ2Vhc2VJblF1YWQnLFxyXG4gICAgICAgICAgICAgICAgb2Zmc2V0OiAxMjBcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgc21vb3RoU2Nyb2xsKGVsZW1lbnQsIG9wdGlvbnMpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFN0YXJ0RGF0ZShpbnB1dCkge1xyXG4gICAgICAgICAgICB2YXIgbW9tZW50SW5wdXQgPSBtb21lbnQoaW5wdXQpO1xyXG4gICAgICAgICAgICB2YXIgZGF5ID0gbW9tZW50SW5wdXQuZGF5KCk7XHJcbiAgICAgICAgICAgIGlmIChkYXkgPT0gNikgcmV0dXJuIG1vbWVudElucHV0LmFkZCgxLCAnZGF5cycpLnRvRGF0ZSgpO1xyXG4gICAgICAgICAgICBpZiAoZGF5ID09IDApIHJldHVybiBtb21lbnRJbnB1dC50b0RhdGUoKTtcclxuICAgICAgICAgICAgcmV0dXJuIG1vbWVudElucHV0LnN1YnRyYWN0KGRheSwgJ2RheXMnKS50b0RhdGUoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xyXG5cclxuICAgICAgICAgICAgaW5pdCgpO1xyXG5cclxuICAgICAgICAgICAgRGl2aXNpb25TZXJ2aWNlXHJcbiAgICAgICAgICAgICAuaXNXYWl0bGlzdEFsbG93ZWRCeURpdmlzaW9uKClcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uZGl2aXNpb25BbGxvd3NXYWl0bGlzdCA9IHJlc3BvbnNlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBnZXRQYXNzZW5nZXJSZXNlcnZhdGlvbnMoKVxyXG4gICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgcG9wdWxhdGVXZWVrcygpO1xyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0UGFzc2VuZ2VyUmVzZXJ2YXRpb25zKCkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG5cclxuICAgICAgICAgICAgUmVzZXJ2YXRpb25TZXJ2aWNlXHJcbiAgICAgICAgICAgIC5nZXRBbGxSZXNlcnZhdGlvbnNGb3JQYXNzZW5nZXIocGFzc2VuZ2VySWQpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEgJiYgcmVzcG9uc2UuZGF0YS5yZXN1bHQucmVzZXJ2YXRpb25zKVxyXG4gICAgICAgICAgICAgICAgICAgIHBhc3NlbmdlclJlc2VydmF0aW9ucyA9IHJlc3BvbnNlLmRhdGEucmVzdWx0LnJlc2VydmF0aW9ucy5maWx0ZXIocmVzZXJ2YXRpb25zRm9yU2NoZWR1bGUpO1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiByZXNlcnZhdGlvbnNGb3JTY2hlZHVsZShyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByLnNjaGVkdWxlVHlwZS50b0xvd2VyQ2FzZSgpID09IHZtLnNlbGVjdGVkQ29uZmlnLnNjaGVkdWxlLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiByZXNlcnZhdGlvbkZvckRheShkYXRlKSB7XHJcbiAgICAgICAgICAgIHZhciByZXNlcnZhdGlvbnMgPSBwYXNzZW5nZXJSZXNlcnZhdGlvbnMuZmlsdGVyKGZ1bmN0aW9uIChyKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbW9tZW50KHIucmVzZXJ2YXRpb25EYXRlKS5kYXlPZlllYXIoKSA9PSBkYXRlLmRheU9mWWVhcigpICYmIHIuc3RhdHVzICE9ICdDYW5jZWxlZCc7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzZXJ2YXRpb25zID09IG51bGwgfHwgcmVzZXJ2YXRpb25zLmxlbmd0aCA9PSAwID8gdW5kZWZpbmVkIDogcmVzZXJ2YXRpb25zWzBdO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcG9wdWxhdGVXZWVrcygpIHtcclxuICAgICAgICAgICAgU2NoZWR1bGVTZXJ2aWNlLmdldFNlcnZpY2VEYXRlQnlEaXZpc2lvbihEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGl2aXNpb25EYXRlID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0YXJ0V2VlayA9IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVuZFdlZWsgPSBhZHZXZWVrcztcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RhcnREYXRlID0gZ2V0U3RhcnREYXRlKGRpdmlzaW9uRGF0ZSk7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICBwb3B1bGF0ZUNhbGVuZGFyKHN0YXJ0V2VlaywgZW5kV2Vlaywgc3RhcnREYXRlLCBpc0luUGFzdCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpc1dlZWtkYXkoZGl2aXNpb25EYXRlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydFdlZWsgPSBhZHZXZWVrcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgZW5kV2VlayA9IHN0YXJ0V2VlayArIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0RGF0ZSA9IChtb21lbnQoc3RhcnREYXRlKS5hZGQoNyAqIGFkdldlZWtzLCAnZGF5cycpKS50b0RhdGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcG9wdWxhdGVDYWxlbmRhcihzdGFydFdlZWssIGVuZFdlZWssIHN0YXJ0RGF0ZSwgaXNPdXRzaWRlQWxsb3dlZFJhbmdlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0VHJpcHMoKTtcclxuICAgICAgICAgICAgICAgICAgICB2bS53ZWVrc1ggPSB2bS53ZWVrcztcclxuICAgICAgICAgICAgICAgICAgICBpZiAodm0uc2VsZWN0ZWRDb25maWcuc2NoZWR1bGUgPT0gQ29tbW9uU2VydmljZS5TY2hlZHVsZVR5cGUuTW9ybmluZylcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2V0UGFya2luZygpO1xyXG5cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaXNXZWVrZGF5KGRhdGUpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciBpbnB1dCA9IG1vbWVudChkYXRlKTtcclxuICAgICAgICAgICAgcmV0dXJuIGlucHV0LmRheSgpICE9IDYgfHwgaW5wdXQuZGF5KCkgIT0gMDtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBwb3B1bGF0ZUNhbGVuZGFyKGZyb20sIHRvLCBzdGFydERhdGUsIHByZWRpY2F0ZSkge1xyXG4gICAgICAgICAgICB2YXIgY3VycmVudERhdGUgPSBtb21lbnQoc3RhcnREYXRlKTtcclxuXHJcbiAgICAgICAgICAgIGZvciAodmFyIHdlZWsgPSBmcm9tOyB3ZWVrIDwgdG87IHdlZWsrKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNhbGVuZGFyRGF5cyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgZGF5ID0gMDsgZGF5IDwgNzsgZGF5KyspIHtcclxuICAgICAgICAgICAgICAgICAgICBjYWxlbmRhckRheXMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdkYXlJZCc6IGRheSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ3dlZWsnOiB3ZWVrLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnZGF5T2ZXZWVrJzogZ2V0V2Vla0RheShjdXJyZW50RGF0ZSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdkYXRlJzogY3VycmVudERhdGUudG9EYXRlKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdpc09wZW4nOiBzZXRPcGVuKGN1cnJlbnREYXRlLCBwcmVkaWNhdGUpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnZGlzYWJsZSc6IGRpc2FibGUoY3VycmVudERhdGUsIHByZWRpY2F0ZSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdzZWxlY3RlZFRyaXAnOiB1bmRlZmluZWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICd0cmlwcyc6IHVuZGVmaW5lZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ3ZlaGljbGUnOiB2bS5zZWxlY3RlZENvbmZpZy52ZWhpY2xlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAncmVzZXJ2YXRpb24nOiByZXNlcnZhdGlvbkZvckRheShjdXJyZW50RGF0ZSlcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50RGF0ZSA9IGN1cnJlbnREYXRlLmFkZCgxLCAnZGF5cycpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdm0ud2Vla3Nbd2Vla10gPSBjYWxlbmRhckRheXM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGRpc2FibGUoY3VycmVudERhdGUsIHByZWRpY2F0ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gcHJlZGljYXRlKGN1cnJlbnREYXRlKSB8fCByZXNlcnZhdGlvbkZvckRheShjdXJyZW50RGF0ZSkgIT0gdW5kZWZpbmVkO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2V0T3BlbihjdXJyZW50RGF0ZSwgcHJlZGljYXRlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAhcHJlZGljYXRlKGN1cnJlbnREYXRlKSAmJiB3YXNTZWxlY3RlZChjdXJyZW50RGF0ZSkgJiYgcmVzZXJ2YXRpb25Gb3JEYXkoY3VycmVudERhdGUpID09PSB1bmRlZmluZWQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBpc0luUGFzdChkYXRlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBkYXRlLmRheU9mWWVhcigpIDwgbW9tZW50KGRpdmlzaW9uRGF0ZSkuZGF5T2ZZZWFyKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBpc091dHNpZGVBbGxvd2VkUmFuZ2UoZGF0ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZGF0ZS5kYXlPZlllYXIoKSA+IG1vbWVudChkaXZpc2lvbkRhdGUpLmRheU9mWWVhcigpICsgYWR2V2Vla3MgKiA3O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0V2Vla0RheShkYXRlKSB7XHJcbiAgICAgICAgICAgIHZhciB3ZWVrRGF5cyA9IFsnU3VuJywgJ01vbicsICdUdWUnLCAnV2VkJywgJ1RodScsICdGcmknLCAnU2F0J107XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gd2Vla0RheXNbZGF0ZS53ZWVrZGF5KCldO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gd2FzU2VsZWN0ZWQoZGF0ZSkge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZtLnNlbGVjdGVkQ29uZmlnLndlZWtEYXlzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodm0uc2VsZWN0ZWRDb25maWcud2Vla0RheXNbaV0uaWQgPT0gZGF0ZS5kYXkoKSlcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFRyaXBzKCkge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHZtLndlZWtzLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZtLndlZWtzW2pdLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZtLndlZWtzW2pdW2ldLmlzT3BlbiAmJiAhdm0ud2Vla3Nbal1baV0uZGlzYWJsZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgKGdldFRyaXBJbmZvKShqLCBpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0UGFya2luZygpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB2bS53ZWVrcy5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2bS53ZWVrc1tqXS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2bS53ZWVrc1tqXVtpXS5pc09wZW4gJiYgIXZtLndlZWtzW2pdW2ldLmRpc2FibGUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIChnZXRBdmFpbGFibGVQYXJraW5nKShqLCBpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0QXZhaWxhYmxlUGFya2luZyh3ZWVrLCBkYXkpIHtcclxuICAgICAgICAgICAgU3RvcERhdGFTZXJ2aWNlXHJcbiAgICAgICAgICAgICAgLmdldEF2YWlsYWJsZVBhcmtpbmdzRm9yU3RvcChwaWNrdXAuaWQsIERhdGUucGFyc2Uodm0ud2Vla3Nbd2Vla11bZGF5XS5kYXRlKSlcclxuICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgIHZtLndlZWtzW3dlZWtdW2RheV0uYXZhaWxhYmxlUGFya2luZyA9IHJlc3BvbnNlLmRhdGEucmVzdWx0O1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0VHJpcEluZm8od2VlaywgZGF5KSB7XHJcbiAgICAgICAgICAgIFN0b3BEYXRhU2VydmljZVxyXG4gICAgICAgICAgICAgIC5nZXROb25QZXJmb3JtZWRUcmlwcyhwaWNrdXAuaWQsIGRyb3BvZmYuaWQsIHZtLnNlbGVjdGVkQ29uZmlnLnNjaGVkdWxlLCBEYXRlLnBhcnNlKHZtLndlZWtzW3dlZWtdW2RheV0uZGF0ZSkpXHJcbiAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSAmJiByZXNwb25zZS5kYXRhLnJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICB2bS53ZWVrc1t3ZWVrXVtkYXldLnRyaXBzID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQuTm9uUGVyZm9ybWVkVHJpcHM7XHJcbiAgICAgICAgICAgICAgICAgIG1hcFNlbGVjdGVkVHJpcCh3ZWVrLCBkYXkpO1xyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgaWYgKHZtLndlZWtzW3dlZWtdW2RheV0udHJpcHMgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICB2bS53ZWVrc1t3ZWVrXVtkYXldLmlzT3BlbiA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICB2bS53ZWVrc1t3ZWVrXVtkYXldLmRpc2FibGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbWFwU2VsZWN0ZWRUcmlwKHdlZWssIGRheSkge1xyXG4gICAgICAgICAgICBpZiAodm0ud2Vla3Nbd2Vla11bZGF5XSA9PSB1bmRlZmluZWQgfHwgdm0ud2Vla3Nbd2Vla11bZGF5XS50cmlwcyA9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcblxyXG4gICAgICAgICAgICB2YXIgdHJpcHMgPSB2bS53ZWVrc1t3ZWVrXVtkYXldLnRyaXBzO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRyaXBzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodm0uc2VsZWN0ZWRDb25maWcudHJpcFRpbWUudHJpcElkID09IHRyaXBzW2ldLnRyaXBJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLndlZWtzW3dlZWtdW2RheV0uc2VsZWN0ZWRUcmlwID0gdHJpcHNbaV0udHJpcElkO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYXBwbHlDbGFzcyhkYXkpIHtcclxuICAgICAgICAgICAgaWYgKGlzV2Vla2VuZChkYXkpKSByZXR1cm4gJ2NhbF9fZGF5LS1kaXNhYmxlZCc7XHJcblxyXG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc1VuZGVmaW5lZChkYXkudHJpcHMpIHx8ICFkYXkuaXNPcGVuKSByZXR1cm4gJ2NhbF9fZGF5LS1pbmFjdGl2ZSc7XHJcbiAgICAgICAgICAgIHJldHVybiAnY2FsX19kYXktLWFjdGl2ZSc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzaG93U2NoZWR1bGUoZGF5KSB7XHJcblxyXG4gICAgICAgICAgICBpZiAoaXNXZWVrZW5kKGRheSkgfHwgZGF5LmRpc2FibGUpIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgIGRheS5pc09wZW4gPSAhZGF5LmlzT3BlbjtcclxuXHJcbiAgICAgICAgICAgIGlmICghZGF5LmlzT3BlbilcclxuICAgICAgICAgICAgICAgIGRheS50cmlwcyA9IHVuZGVmaW5lZDtcclxuXHJcbiAgICAgICAgICAgIGdldFRyaXBJbmZvKGRheS53ZWVrLCBkYXkuZGF5SWQpO1xyXG4gICAgICAgICAgICBnZXRBdmFpbGFibGVQYXJraW5nKGRheS53ZWVrLCBkYXkuZGF5SWQpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGhhc2ggPSBkYXkuZGF5SWQgKyAnXycgKyBkYXkud2VlaztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGZpbHRlcldlZWtlbmQoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoZGF5KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF5LmRheU9mV2VlayAhPSAnU2F0JyAmJiBkYXkuZGF5T2ZXZWVrICE9ICdTdW4nO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGlzV2Vla2VuZChkYXkpIHtcclxuICAgICAgICAgICAgZGF5LmRheU9mV2VlayA9PSAnU2F0JyB8fCBkYXkuZGF5T2ZXZWVrID09ICdTdW4nXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiByZXNldFBhc3NlbmdlclZlaGljbGUoZGF5KSB7XHJcbiAgICAgICAgICAgIGlmICh2bS5wYXNzZW5nZXJWZWhpY2xlcyAmJiB2bS5wYXNzZW5nZXJWZWhpY2xlcy5sZW5ndGggPiAwKVxyXG4gICAgICAgICAgICAgICAgZGF5LnZlaGljbGUgPSB2bS5wYXNzZW5nZXJWZWhpY2xlc1swXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGlzTm90RnJvbUFkdlNldHVwKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJHN0YXRlUGFyYW1zLm9iaiA9PSBudWxsXHJcbiAgICAgICAgICAgICAgICB8fCAkc3RhdGVQYXJhbXMub2JqID09IHVuZGVmaW5lZFxyXG4gICAgICAgICAgICAgICAgfHwgJHN0YXRlUGFyYW1zLm9iai5jb25maWcgPT0gbnVsbFxyXG4gICAgICAgICAgICAgICAgfHwgJHN0YXRlUGFyYW1zLm9iai5jb25maWcgPT0gdW5kZWZpbmVkO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaXNGcm9tQWR2Q29uZmlybSgpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRzdGF0ZVBhcmFtcy5vYmogIT0gbnVsbFxyXG4gICAgICAgICAgICAgICAgJiYgJHN0YXRlUGFyYW1zLm9iaiAhPSB1bmRlZmluZWRcclxuICAgICAgICAgICAgICAgICYmICRzdGF0ZVBhcmFtcy5vYmoucmVzZXJ2YXRpb25JbmZvICE9IG51bGxcclxuICAgICAgICAgICAgICAgICYmICRzdGF0ZVBhcmFtcy5vYmoucmVzZXJ2YXRpb25JbmZvICE9IHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGJhY2soKSB7XHJcbiAgICAgICAgICAgICRzdGF0ZS5nbygnYWR2LXNjaGVkdWxlLXNldHVwJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzaG93UmVzZXJ2YXRpb25JbmZvKHJlc2VydmF0aW9uKSB7XHJcbiAgICAgICAgICAgICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL21vZHVsZXMvY29tbXV0ZXIvYWR2LXNjaGVkdWxlL3Jlc2VydmF0aW9uLW1vZGFsLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1Jlc2VydmF0aW9uTW9kYWxDb250cm9sbGVyIGFzIHZtJyxcclxuICAgICAgICAgICAgICAgIGJhY2tkcm9wOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIHNpemU6ICctZnMnLFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc2VydmF0aW9uOiByZXNlcnZhdGlvblxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHJlc2VydmUoKSB7XHJcbiAgICAgICAgICAgIHZhciBhbGxvd1Jlc2VydmF0aW9uID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh2bS53ZWVrcywgZnVuY3Rpb24gKHdlZWspIHtcclxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh3ZWVrLCBmdW5jdGlvbiAoZGF5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRheS5pc09wZW4gJiYgZGF5LnNlbGVjdGVkVHJpcCAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsbG93UmVzZXJ2YXRpb24gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGlmIChhbGxvd1Jlc2VydmF0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ2Fkdi1zY2hlZHVsZS1jb25maXJtYXRpb24nLFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIG9iajpcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZzogdm0uc2VsZWN0ZWRDb25maWcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZlaGljbGVzOiB2bS5wYXNzZW5nZXJWZWhpY2xlcyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzZXJ2YXRpb25JbmZvOiB2bS53ZWVrc1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICBhY3RpdmF0ZSgpO1xyXG4gICAgfVxyXG59KSgpO1xyXG5cclxuXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAuZGlyZWN0aXZlKCdvd2xDYXJvdXNlbCcsIE1WT3dsQ2Fyb3VzZWwpO1xyXG5cclxuICAgIE1WT3dsQ2Fyb3VzZWwuJGluamVjdCA9IFtdO1xyXG5cclxuICAgIGZ1bmN0aW9uIE1WT3dsQ2Fyb3VzZWwoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgICAgdHJhbnNjbHVkZTogZmFsc2UsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSkge1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuaW5pdENhcm91c2VsID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBwcm92aWRlIGFueSBkZWZhdWx0IG9wdGlvbnMgeW91IHdhbnRcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZGVmYXVsdE9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY3VzdG9tT3B0aW9ucyA9IHNjb3BlLiRldmFsKCQoZWxlbWVudCkuYXR0cignZGF0YS1vcHRpb25zJykpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbWJpbmUgdGhlIHR3byBvcHRpb25zIG9iamVjdHNcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gY3VzdG9tT3B0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0T3B0aW9uc1trZXldID0gY3VzdG9tT3B0aW9uc1trZXldO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAvLyBpbml0IGNhcm91c2VsXHJcbiAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KGVsZW1lbnQpLm93bENhcm91c2VsKGRlZmF1bHRPcHRpb25zKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxufSkoKTtcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgIC5kaXJlY3RpdmUoJ293bENhcm91c2VsSXRlbScsIE1WT3dsQ2Fyb3VzZWxJdGVtKTtcclxuXHJcbiAgICBNVk93bENhcm91c2VsSXRlbS4kaW5qZWN0ID0gW107XHJcblxyXG4gICAgZnVuY3Rpb24gTVZPd2xDYXJvdXNlbEl0ZW0oKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgdHJhbnNjbHVkZTogZmFsc2UsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgLy8gd2FpdCBmb3IgdGhlIGxhc3QgaXRlbSBpbiB0aGUgbmctcmVwZWF0IHRoZW4gY2FsbCBpbml0XHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuJGxhc3QpIHtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5pbml0Q2Fyb3VzZWwoZWxlbWVudC5wYXJlbnQoKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfVxyXG59KSgpO1xyXG5cclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdBZHZTY2hlZHVsZVNldHVwQ29udHJvbGxlcicsIEFkdlNjaGVkdWxlU2V0dXBDb250cm9sbGVyKTtcclxuXHJcbiAgICBBZHZTY2hlZHVsZVNldHVwQ29udHJvbGxlci4kaW5qZWN0ID0gWyckc2NvcGUnLCAnJHN0YXRlJywgJyR1aWJNb2RhbCcsICckc3RhdGVQYXJhbXMnLFxyXG4gICAgICAgICdhdXRoU2VydmljZScsICdTdG9wRGF0YVNlcnZpY2UnLCAndmVoaWNsZVNlcnZpY2UnLCAnQ29tbW9uU2VydmljZScsXHJcbiAgICAgICAgJ1Jlc2VydmF0aW9uU2VydmljZScsICdNYXBTZXJ2aWNlJywgJ01hcEljb25TZXJ2aWNlJywgJ1BhZ2VTZXJ2aWNlJywnTHV1bUxpbmtlZFNlcnZpY2UnLCdPbmVNdlNlcnZpY2VzJ107XHJcblxyXG4gICAgZnVuY3Rpb24gQWR2U2NoZWR1bGVTZXR1cENvbnRyb2xsZXIoJHNjb3BlLCAkc3RhdGUsICR1aWJNb2RhbCwgJHN0YXRlUGFyYW1zLFxyXG4gICAgICAgIGF1dGhTZXJ2aWNlLCBTdG9wRGF0YVNlcnZpY2UsIHZlaGljbGVTZXJ2aWNlLCBDb21tb25TZXJ2aWNlLFxyXG4gICAgICAgIFJlc2VydmF0aW9uU2VydmljZSwgTWFwU2VydmljZSwgTWFwSWNvblNlcnZpY2UsIFBhZ2VTZXJ2aWNlLCBMdXVtTGlua2VkU2VydmljZSxPbmVNdlNlcnZpY2VzKSB7XHJcblxyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2UgPSBQYWdlU2VydmljZTsgICAgICAgICAgICAgXHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2Uuc2V0VGl0bGUoJ0FkdmFuY2VkIFJlc2VydmF0aW9ucycpO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlLnNldEhlYWRsaW5lKE9uZU12U2VydmljZXMuZ2V0Q29tbXV0ZXJJbmZvKCkuYWxpYXMpO1xyXG4gICAgICAgIHZhciBwYXNzZW5nZXJJZCA9IGF1dGhTZXJ2aWNlLmF1dGhlbnRpY2F0aW9uLnBhc3NlbmdlcklkO1xyXG4gICAgICAgIHZhciBhbGxTdG9wcyA9IFtdO1xyXG4gICAgICAgIHZhciBub1RyaXBUaW1lID0geyAncGlja3VwVGltZSc6ICdPcHRpb25hbCcsICd0cmlwSWQnOiB1bmRlZmluZWQgfTtcclxuICAgICAgICB2YXIgbm9WZWhpY2xlID0geyAnbGljZW5jZXBsYXRlJzogJy0tJywgJ3ZlaGljbGVJZCc6IHVuZGVmaW5lZCB9O1xyXG4gICAgICAgIHZhciBub1N0b3AgPSB7ICdpZCc6IHVuZGVmaW5lZCwgJ25hbWUnOiAnLS0nLCAnbGF0aXR1ZGUnOiBudWxsLCAnbG9uZ2l0dWRlJzogbnVsbCB9O1xyXG4gICAgICAgIHZhciBtYXJrZXJFdmVudHMgPSBbeyBldmVudDogJ2NsaWNrJywgY2FsbGJhY2s6IGljb25DbGlja0hhbmRsZXIgfV07XHJcblxyXG4gICAgICAgIHZtLm1hcCA9IE1hcFNlcnZpY2UuaW5pdGlhbGl6ZU1hcCgpO1xyXG4gICAgICAgIHZtLnRpdGxlID0gJ0FkdmFuY2UgUmVzZXJ2YXRpb25zIFNldHVwJztcclxuICAgICAgICB2bS5pc0xvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICB2bS5pc1Bhc3NlbmdlckxvZ2dlZEluID0gYXV0aFNlcnZpY2UuaXNMb2dnZWRJbigpO1xyXG4gICAgICAgIHZtLm1hcmtlcnMgPSBbXTtcclxuICAgICAgICB2bS5zZWxlY3RlZENvbmZpZyA9IGdldERlZmF1bHRDb25maWcoKTtcclxuXHJcbiAgICAgICAgdmFyIHJldHVyblRyaXBDb25maWcgPSBnZXRSZXR1cm5UcmlwQ29uZmlnKCk7XHJcblxyXG4gICAgICAgIHZtLnBpY2t1cFN0b3BzID0gW107XHJcbiAgICAgICAgdm0uZHJvcG9mZlN0b3BzID0gW107XHJcbiAgICAgICAgdm0udHJpcFRpbWVzID0gW107XHJcbiAgICAgICAgdm0ucGFzc2VuZ2VyVmVoaWNsZXMgPSBbXTtcclxuICAgICAgICB2bS5jb29yZHMgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgdm0ubnVtT2ZXZWVrcyA9IFtdO1xyXG4gICAgICAgIHZtLmRheXNPZldlZWsgPVxyXG4gICAgICAgICAgICAgICAgICAgIFtcclxuICAgICAgICAgICAgICAgICAgICB7ICduYW1lJzogJ1MnLCAnc2VsZWN0ZWQnOiBmYWxzZSwgJ2lkJzogMCB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHsgJ25hbWUnOiAnTScsICdzZWxlY3RlZCc6IGZhbHNlLCAnaWQnOiAxIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgeyAnbmFtZSc6ICdUJywgJ3NlbGVjdGVkJzogZmFsc2UsICdpZCc6IDIgfSxcclxuICAgICAgICAgICAgICAgICAgICB7ICduYW1lJzogJ1cnLCAnc2VsZWN0ZWQnOiBmYWxzZSwgJ2lkJzogMyB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHsgJ25hbWUnOiAnVEgnLCAnc2VsZWN0ZWQnOiBmYWxzZSwgJ2lkJzogNCB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHsgJ25hbWUnOiAnRicsICdzZWxlY3RlZCc6IGZhbHNlLCAnaWQnOiA1IH0sXHJcbiAgICAgICAgICAgICAgICAgICAgeyAnbmFtZSc6ICdTJywgJ3NlbGVjdGVkJzogZmFsc2UsICdpZCc6IDYgfVxyXG4gICAgICAgICAgICAgICAgICAgIF07XHJcblxyXG4gICAgICAgIHZtLmhhc1RlbXBsYXRlcyA9IGZhbHNlO1xyXG4gICAgICAgIHZtLnRlbXBsYXRlcyA9IFtdO1xyXG4gICAgICAgIHZtLnVzZURlZmF1bHRUZW1wbGF0ZSA9IGZhbHNlO1xyXG4gICAgICAgIHZtLm92ZXJyaWRlVGVtcGxhdGUgPSBmYWxzZTtcclxuICAgICAgICB2bS5hZGRUZW1wbGF0ZSA9IGZhbHNlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBpc1JldHVyblRyaXBSZXF1ZXN0KCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJHN0YXRlUGFyYW1zLm9iaiAhPSBudWxsXHJcbiAgICAgICAgICAgICAgICAmJiAkc3RhdGVQYXJhbXMub2JqICE9IHVuZGVmaW5lZFxyXG4gICAgICAgICAgICAgICAgJiYgJHN0YXRlUGFyYW1zLm9iai5jb25maWcgIT0gbnVsbFxyXG4gICAgICAgICAgICAgICAgJiYgJHN0YXRlUGFyYW1zLm9iai5jb25maWcgIT0gdW5kZWZpbmVkO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0UmV0dXJuVHJpcENvbmZpZygpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGlzUmV0dXJuVHJpcFJlcXVlc3QoKSA/ICRzdGF0ZVBhcmFtcy5vYmouY29uZmlnIDogdW5kZWZpbmVkO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0RGVmYXVsdENvbmZpZygpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIHNjaGVkdWxlOiBDb21tb25TZXJ2aWNlLlNjaGVkdWxlVHlwZS5Nb3JuaW5nLFxyXG4gICAgICAgICAgICAgICAgcGlja3VwOiB1bmRlZmluZWQsXHJcbiAgICAgICAgICAgICAgICBkcm9wb2ZmOiB1bmRlZmluZWQsXHJcbiAgICAgICAgICAgICAgICB3ZWVrRGF5czogW10sXHJcbiAgICAgICAgICAgICAgICB0cmlwVGltZTogdW5kZWZpbmVkLFxyXG4gICAgICAgICAgICAgICAgbnVtT2ZXZWVrczogdW5kZWZpbmVkLFxyXG4gICAgICAgICAgICAgICAgdmVoaWNsZTogdW5kZWZpbmVkXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgdm0ucGlja3VwQ2hhbmdlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKCF2bS5zZWxlY3RlZENvbmZpZy5waWNrdXAgfHwgIXZtLnNlbGVjdGVkQ29uZmlnLnBpY2t1cC5pZCkge1xyXG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRDb25maWcuZHJvcG9mZiA9IHZtLnBpY2t1cFN0b3BzWzBdO1xyXG4gICAgICAgICAgICAgICAgdm0ubWFya2VycyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgdm0uYWRkVGVtcGxhdGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHZtLnNlbGVjdGVkQ29uZmlnLmRyb3BvZmYgPSBub1N0b3A7XHJcbiAgICAgICAgICAgIHZtLnNob3cgPSBmYWxzZTtcclxuICAgICAgICAgICAgc2V0TWFya2VycygpO1xyXG4gICAgICAgICAgICBNYXBTZXJ2aWNlLnNldE1hcEJvdW5kcyh2bS5tYXJrZXJzLCBtYXJrZXJFdmVudHMpO1xyXG4gICAgICAgICAgICBnZXREcm9wb2ZmcygpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0uZHJvcG9mZkNoYW5nZWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICghdm0uc2VsZWN0ZWRDb25maWcucGlja3VwIHx8ICF2bS5zZWxlY3RlZENvbmZpZy5waWNrdXAuaWQpIHsgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICByZXR1cm5cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHZtLnNob3cgPSBmYWxzZTtcclxuICAgICAgICAgICAgaWYgKHZtLnNlbGVjdGVkQ29uZmlnLmRyb3BvZmYgJiYgdm0uc2VsZWN0ZWRDb25maWcuZHJvcG9mZi5pZClcclxuICAgICAgICAgICAgICAgIGdldFRyaXBUaW1lcygpO1xyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICB2bS5hZGRUZW1wbGF0ZSA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgc2V0TWFya2VycygpO1xyXG4gICAgICAgICAgICBNYXBTZXJ2aWNlLnNldE1hcEJvdW5kcyh2bS5tYXJrZXJzLCBtYXJrZXJFdmVudHMpO1xyXG4gICAgICAgIH0gICAgIFxyXG5cclxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5kYXlzT2ZXZWVrfGZpbHRlcjp7c2VsZWN0ZWQ6dHJ1ZX0nLCBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICAgICAgdm0uc2VsZWN0ZWRDb25maWcud2Vla0RheXMgPSB2YWx1ZS5tYXAoZnVuY3Rpb24gKGRheSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRheTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSwgdHJ1ZSk7XHJcblxyXG4gICAgICAgICRzY29wZS4kd2F0Y2goJ3ZtLnBhcmtpbmdTZWxlY3RlZCcsIGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgICAgICBpZiAoIXZhbHVlKVxyXG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRDb25maWcudmVoaWNsZSA9IG5vVmVoaWNsZTtcclxuICAgICAgICB9KTtcclxuXHJcblxyXG5cclxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS51c2VEZWZhdWx0VGVtcGxhdGUnLCBmdW5jdGlvbiAodmFsdWUpIHtcclxuXHJcbiAgICAgICAgICAgIGlmICghdmFsdWUpXHJcbiAgICAgICAgICAgICAgICB2bS5wYXJraW5nU2VsZWN0ZWQgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgIHNldFNlbGVjdGVkVHJpcCgpO1xyXG4gICAgICAgICAgICBmaWx0ZXJQaWNrdXBzKCk7XHJcbiAgICAgICAgICAgIHJlc2V0V2Vla0RheXMoKTtcclxuICAgICAgICAgICAgc2V0U2VsZWN0ZWRWZWhpY2xlKCk7XHJcbiAgICAgICAgICAgIFxyXG5cclxuICAgICAgICAgICAgaWYgKHZtLnRlbXBsYXRlcy5sZW5ndGggPiAwICYmIHZtLnVzZURlZmF1bHRUZW1wbGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHRlbXBsYXRlID0gZ2V0VGVtcGxhdGUoKTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdm0uZGF5c09mV2Vlay5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmRheXNPZldlZWtbaV0uc2VsZWN0ZWQgPSBpc1dlZWtkYXlTZWxlY3RlZCh2bS5kYXlzT2ZXZWVrW2ldLCB0ZW1wbGF0ZS5kYXlzT2ZXZWVrKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0VGVtcGxhdGUoKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdm0udGVtcGxhdGVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodm0udGVtcGxhdGVzW2ldLnNjaGVkdWxlID09IHZtLnNlbGVjdGVkQ29uZmlnLnNjaGVkdWxlKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB2bS50ZW1wbGF0ZXNbaV07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5zY2hlZHVsZUNoYW5nZWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZtLmRyb3BvZmZTdG9wcyA9IFtdO1xyXG4gICAgICAgICAgICB2bS5tYXJrZXJzID0gW107XHJcbiAgICAgICAgICAgIHZtLnNob3cgPSBmYWxzZTtcclxuICAgICAgICAgICAgdm0udXNlRGVmYXVsdFRlbXBsYXRlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGZpbHRlclBpY2t1cHMoKTtcclxuICAgICAgICAgICAgcmVzZXRXZWVrRGF5cygpO1xyXG4gICAgICAgICAgICByZXNldFRyaXBUaW1lcygpO1xyXG4gICAgICAgICAgICBzZXRIYXNUZW1wbGF0ZSgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0uY2xlYXJXZWVrU2VsZWN0aW9uID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXNldFdlZWtEYXlzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgdm0ubmV4dCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKHZtLmFkZFRlbXBsYXRlIHx8IHZtLm92ZXJyaWRlVGVtcGxhdGUpIHtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgdGVtcGxhdGUgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgUGlja3VwU3RvcElkOiB2bS5zZWxlY3RlZENvbmZpZy5waWNrdXAuaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgRHJvcG9mZlN0b3BJZDogdm0uc2VsZWN0ZWRDb25maWcuZHJvcG9mZi5pZCxcclxuICAgICAgICAgICAgICAgICAgICBUcmlwSWQ6IHZtLnNlbGVjdGVkQ29uZmlnLnRyaXBUaW1lLnRyaXBJZCxcclxuICAgICAgICAgICAgICAgICAgICBTY2hlZHVsZTogdm0uc2VsZWN0ZWRDb25maWcuc2NoZWR1bGUsXHJcbiAgICAgICAgICAgICAgICAgICAgVmVoaWNsZUlkIDogdm0uc2VsZWN0ZWRDb25maWcudmVoaWNsZS5pZCxcclxuICAgICAgICAgICAgICAgICAgICBTZWxlY3RlZERheXMgOiBnZXRTZWxlY3RlZERheXMoKVxyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBSZXNlcnZhdGlvblNlcnZpY2UuYWRkUGFzc2VuZ2VyVGVtcGxhdGUocGFzc2VuZ2VySWQsIHRlbXBsYXRlKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5leHQoKTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBuZXh0KCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgbmV4dCgpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFNlbGVjdGVkRGF5cygpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciB3ZWVrZGF5cyA9IFtcIlN1bmRheVwiLCBcIk1vbmRheVwiLCBcIlR1ZXNkYXlcIiwgXCJXZWRuZXNkYXlcIiwgXCJUaHVyc2RheVwiLCBcIkZyaWRheVwiLCBcIlNhdHVyZGF5XCJdO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgdmFyIHNlbGVjdGVkRGF5cyA9IHt9O1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZtLnNlbGVjdGVkQ29uZmlnLndlZWtEYXlzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIga2V5ID0gd2Vla2RheXNbdm0uc2VsZWN0ZWRDb25maWcud2Vla0RheXNbaV0uaWRdO1xyXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWREYXlzW2tleV0gPSB2bS5zZWxlY3RlZENvbmZpZy53ZWVrRGF5c1tpXS5zZWxlY3RlZDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHNlbGVjdGVkRGF5cztcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBuZXh0KCkge1xyXG4gICAgICAgICAgICAkc3RhdGUuZ28oJ2Fkdi1zY2hlZHVsZScsIHtcclxuICAgICAgICAgICAgICAgIG9iajoge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZzogdm0uc2VsZWN0ZWRDb25maWcsIHZlaGljbGVzOiB2bS5wYXNzZW5nZXJWZWhpY2xlc1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICB2bS5sb2dpbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmVkaXJlY3RUb0xvZ2luKCk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgdm0uc2hvd0FkZFZlaGljbGVEaWFsb2cgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBtb2RhbFJlc2VydmUgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9tb2R1bGVzL2NvbW11dGVyL21vZGFscy9hZGQtdmVoaWNsZS1tb2RhbC9hZGQtdmVoaWNsZS5odG1sJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdBZGRWZWhpY2xlQ29udHJvbGxlciBhcyB2bScsXHJcbiAgICAgICAgICAgICAgICBzaXplOiBcIi1mc1wiLFxyXG4gICAgICAgICAgICAgICAgYmFja2Ryb3A6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGF0bGVhc3RPbmVWZWhpY2xlRXhpc3Q6IHZtLnBhc3NlbmdlclZlaGljbGVzLmxlbmd0aCA+IDBcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIG1vZGFsUmVzZXJ2ZS5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmlzQWRkZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0UGFzc2VuZ2VyVmVoaWNsZXMoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzZXRNYXJrZXJzKCkge1xyXG4gICAgICAgICAgICB2bS5tYXJrZXJzID0gW107XHJcblxyXG4gICAgICAgICAgICBpZiAodm0uc2VsZWN0ZWRDb25maWcucGlja3VwICYmIHZtLnNlbGVjdGVkQ29uZmlnLnBpY2t1cC5pZCAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgdm0ubWFya2Vycy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICBsYXRpdHVkZTogdm0uc2VsZWN0ZWRDb25maWcucGlja3VwLmxhdGl0dWRlLFxyXG4gICAgICAgICAgICAgICAgICAgIGxvbmdpdHVkZTogdm0uc2VsZWN0ZWRDb25maWcucGlja3VwLmxvbmdpdHVkZSxcclxuICAgICAgICAgICAgICAgICAgICBpY29uOiBnZXRNYXBJY29uKHZtLnNlbGVjdGVkQ29uZmlnLnBpY2t1cC5pc0h1YiksXHJcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogdm0uc2VsZWN0ZWRDb25maWcucGlja3VwLm5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgYWRkcmVzczogdm0uc2VsZWN0ZWRDb25maWcucGlja3VwLmFkZHJlc3NcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgaWYgKHZtLnNlbGVjdGVkQ29uZmlnLmRyb3BvZmYgJiYgdm0uc2VsZWN0ZWRDb25maWcuZHJvcG9mZi5pZCAhPT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAgICAgdm0ubWFya2Vycy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICBsYXRpdHVkZTogdm0uc2VsZWN0ZWRDb25maWcuZHJvcG9mZi5sYXRpdHVkZSxcclxuICAgICAgICAgICAgICAgICAgICBsb25naXR1ZGU6IHZtLnNlbGVjdGVkQ29uZmlnLmRyb3BvZmYubG9uZ2l0dWRlLFxyXG4gICAgICAgICAgICAgICAgICAgIGljb246IGdldE1hcEljb24odm0uc2VsZWN0ZWRDb25maWcuZHJvcG9mZi5pc0h1YiksXHJcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogdm0uc2VsZWN0ZWRDb25maWcuZHJvcG9mZi5uYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgIGFkZHJlc3M6IHZtLnNlbGVjdGVkQ29uZmlnLmRyb3BvZmYuYWRkcmVzc1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0TWFwSWNvbihpc0h1Yikge1xyXG4gICAgICAgICAgICByZXR1cm4gaXNIdWIgPyBNYXBJY29uU2VydmljZS5nZXRDb21tdXRlckh1Ykljb24oKSA6XHJcbiAgICAgICAgICAgICAgICBNYXBJY29uU2VydmljZS5nZXRDb21tdXRlclN0b3BJY29uKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiByZXNldFdlZWtEYXlzKCkge1xyXG4gICAgICAgICAgICB2bS5zZWxlY3RlZENvbmZpZy53ZWVrRGF5cyA9IFtdO1xyXG4gICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHZtLmRheXNPZldlZWssIGZ1bmN0aW9uIChkYXlPZldlZWssIGtleSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRheU9mV2Vlay5zZWxlY3RlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiByZXNldFRyaXBUaW1lcygpIHtcclxuICAgICAgICAgICAgdm0uc2VsZWN0ZWRDb25maWcudHJpcFRpbWUgPSB7fTtcclxuICAgICAgICAgICAgdm0udHJpcFRpbWVzID0gW107XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZmlsdGVyUGlja3VwcygpIHtcclxuICAgICAgICAgICAgdm0ucGlja3VwU3RvcHMgPSBhbGxTdG9wcy5maWx0ZXIoZnVuY3Rpb24gKHN0b3ApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBzdG9wLmlzSHViICE9ICh2bS5zZWxlY3RlZENvbmZpZy5zY2hlZHVsZSA9PSBDb21tb25TZXJ2aWNlLlNjaGVkdWxlVHlwZS5Nb3JuaW5nKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHZtLnBpY2t1cFN0b3BzLnNwbGljZSgwLCAwLCBub1N0b3ApO1xyXG5cclxuICAgICAgICAgICAgc2V0UGlja3VwU3RvcCgpOyAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2V0UGlja3VwU3RvcCgpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciBwaWNrdXBJZCA9IHVuZGVmaW5lZDsgICAgICAgICAgICBcclxuXHJcbiAgICAgICAgICAgIGlmIChpc1JldHVyblRyaXBSZXF1ZXN0KCkgJiYgcmV0dXJuVHJpcENvbmZpZylcclxuICAgICAgICAgICAgICAgIHBpY2t1cElkID0gcmV0dXJuVHJpcENvbmZpZy5waWNrdXAuaWQ7XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHZtLnRlbXBsYXRlcy5sZW5ndGggPiAwICYmIHZtLnVzZURlZmF1bHRUZW1wbGF0ZSlcclxuICAgICAgICAgICAgICAgIHBpY2t1cElkID0gZ2V0VGVtcGxhdGUoKS5waWNrdXBJZDtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHZhciBtYXRjaEZvdW5kID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdm0ucGlja3VwU3RvcHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGlmICh2bS5waWNrdXBTdG9wc1tpXS5pZCA9PSBwaWNrdXBJZCl7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRDb25maWcucGlja3VwID0gdm0ucGlja3VwU3RvcHNbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgbWF0Y2hGb3VuZCA9dHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCFtYXRjaEZvdW5kKVxyXG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRDb25maWcucGlja3VwID0gdm0ucGlja3VwU3RvcHNbMF07XHJcblxyXG4gICAgICAgICAgICB2bS5waWNrdXBDaGFuZ2VkKCk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2V0RHJvcG9mZlN0b3AoKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgZHJvcG9mZklkID0gdW5kZWZpbmVkO1xyXG5cclxuICAgICAgICAgICAgaWYgKGlzUmV0dXJuVHJpcFJlcXVlc3QoKSAmJiByZXR1cm5UcmlwQ29uZmlnKSBcclxuICAgICAgICAgICAgICAgIGRyb3BvZmZJZCA9IHJldHVyblRyaXBDb25maWcuZHJvcG9mZi5pZDsgICAgICAgICAgICBcclxuICAgICAgICAgICAgZWxzZSBpZiAodm0udGVtcGxhdGVzLmxlbmd0aCA+IDAgJiYgdm0udXNlRGVmYXVsdFRlbXBsYXRlKVxyXG4gICAgICAgICAgICAgICAgZHJvcG9mZklkID0gZ2V0VGVtcGxhdGUoKS5kcm9wb2ZmSWQ7XHJcblxyXG4gICAgICAgICAgICB2YXIgbWF0Y2hGb3VuZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZtLmRyb3BvZmZTdG9wcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHZtLmRyb3BvZmZTdG9wc1tpXS5pZCA9PSBkcm9wb2ZmSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZENvbmZpZy5kcm9wb2ZmID0gdm0uZHJvcG9mZlN0b3BzW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIG1hdGNoRm91bmQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZighbWF0Y2hGb3VuZClcclxuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkQ29uZmlnLmRyb3BvZmYgPSB2bS5kcm9wb2ZmU3RvcHNbMF07XHJcblxyXG4gICAgICAgICAgICB2bS5kcm9wb2ZmQ2hhbmdlZCgpO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xyXG4gICAgICAgICAgICBpZiAoIXZtLmlzUGFzc2VuZ2VyTG9nZ2VkSW4pXHJcbiAgICAgICAgICAgICAgICByZWRpcmVjdFRvTG9naW4oKTtcclxuICAgICAgICAgICAgTHV1bUxpbmtlZFNlcnZpY2UudmVyaWZ5KGF1dGhTZXJ2aWNlLmF1dGhlbnRpY2F0aW9uLnBhc3NlbmdlcklkKTtcclxuICAgICAgICAgICAgZ2V0UGFzc2VuZ2VyVGVtcGxhdGVzKCk7ICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGdldFBhc3NlbmdlclZlaGljbGVzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0UGFzc2VuZ2VyVGVtcGxhdGVzKCkge1xyXG4gICAgICAgICAgICBSZXNlcnZhdGlvblNlcnZpY2UuZ2V0UGFzc2VuZ2VyVGVtcGxhdGVzKHBhc3NlbmdlcklkKVxyXG4gICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2UuZGF0YS5zdGF0dXMgJiYgcmVzcG9uc2UuZGF0YS5yZXN1bHQgJiYgcmVzcG9uc2UuZGF0YS5yZXN1bHQubGVuZ3RoID4gMCkgeyAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgIG1hcFRlbXBsYXRlcyhyZXNwb25zZS5kYXRhLnJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgIGdldEFkdlJlc2VydmF0aW9uV2luZG93KCk7XHJcbiAgICAgICAgICAgICAgIGdldEFsbFN0b3BzKCk7XHJcblxyXG4gICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIG1hcFRlbXBsYXRlcyh0ZW1wbGF0ZXMpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0ZW1wbGF0ZXMubGVuZ3RoOyBpKyspXHJcbiAgICAgICAgICAgICAgICB2bS50ZW1wbGF0ZXMucHVzaCh0ZW1wbGF0ZXNbaV0pO1xyXG5cclxuICAgICAgICAgICAgc2V0SGFzVGVtcGxhdGUoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNldEhhc1RlbXBsYXRlKCkge1xyXG4gICAgICAgICAgICB2YXIgZm91bmQgPSBmYWxzZTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2bS50ZW1wbGF0ZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGlmICh2bS5zZWxlY3RlZENvbmZpZy5zY2hlZHVsZSA9PSB2bS50ZW1wbGF0ZXNbaV0uc2NoZWR1bGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdm0uaGFzVGVtcGxhdGVzID0gZm91bmQ7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaWNvbkNsaWNrSGFuZGxlcihtb2RlbCkge1xyXG4gICAgICAgICAgICB2bS5zaG93ID0gdHJ1ZTtcclxuICAgICAgICAgICAgdm0uY29vcmRzID0gbW9kZWwuY29vcmRzO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldEFkdlJlc2VydmF0aW9uV2luZG93KCkge1xyXG4gICAgICAgICAgICB2bS5udW1PZldlZWtzID0gW107XHJcbiAgICAgICAgICAgIFJlc2VydmF0aW9uU2VydmljZS5nZXRBZHZSZXNlcnZhdGlvbkFsbG93ZWRXZWVrcygpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbnVtV2Vla3MgPSByZXNwb25zZS5kYXRhLnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8PSBudW1XZWVrczsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLm51bU9mV2Vla3MucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbmFtZSc6IGlcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgIHdlZWtUb1NlbGVjdCA9IHZtLm51bU9mV2Vla3Nbdm0ubnVtT2ZXZWVrcy5sZW5ndGggLSAxXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzUmV0dXJuVHJpcFJlcXVlc3QoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZtLm51bU9mV2Vla3MubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2bS5udW1PZldlZWtzW2ldLm5hbWUgPT09IHJldHVyblRyaXBDb25maWcubnVtT2ZXZWVrcy5uYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2Vla1RvU2VsZWN0ID0gdm0ubnVtT2ZXZWVrc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRDb25maWcubnVtT2ZXZWVrcyA9IHdlZWtUb1NlbGVjdDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRBbGxTdG9wcygpIHtcclxuICAgICAgICAgICAgU3RvcERhdGFTZXJ2aWNlLmdldEFsbEJ1c1N0b3BzKClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsbFN0b3BzID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQuc3RvcHM7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNSZXR1cm5UcmlwUmVxdWVzdCgpICYmIHJldHVyblRyaXBDb25maWcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkQ29uZmlnID0gYW5ndWxhci5jb3B5KHJldHVyblRyaXBDb25maWcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0SGFzVGVtcGxhdGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdm0uZGF5c09mV2Vlay5sZW5ndGg7IGkrKykgeyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5kYXlzT2ZXZWVrW2ldLnNlbGVjdGVkID0gaXNXZWVrZGF5U2VsZWN0ZWQodm0uZGF5c09mV2Vla1tpXSwgcmV0dXJuVHJpcENvbmZpZy53ZWVrRGF5cyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgICAgICAgICBcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlclBpY2t1cHMoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBpc1dlZWtkYXlTZWxlY3RlZChpbnB1dCwgY29uZmlndXJhdGlvbldlZWtEYXlzKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY29uZmlndXJhdGlvbldlZWtEYXlzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaW5wdXQubmFtZSA9PSBjb25maWd1cmF0aW9uV2Vla0RheXNbaV0ubmFtZVxyXG4gICAgICAgICAgICAgICAgICAgICYmIGNvbmZpZ3VyYXRpb25XZWVrRGF5c1tpXS5zZWxlY3RlZClcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRQYXNzZW5nZXJWZWhpY2xlcygpIHtcclxuICAgICAgICAgICAgdmVoaWNsZVNlcnZpY2VcclxuICAgICAgICAgICAgICAgIC5nZXRWZWhpY2xlc0ZvclBhc3NlbmdlcihwYXNzZW5nZXJJZClcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSAmJiByZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0LnBhc3NlbmdlclZlaGljbGVzKVxyXG4gICAgICAgICAgICAgICAgICAgIHZtLnBhc3NlbmdlclZlaGljbGVzID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQucGFzc2VuZ2VyVmVoaWNsZXM7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHZtLnBhc3NlbmdlclZlaGljbGVzLmxlbmd0aCA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAgdm0ucGFzc2VuZ2VyVmVoaWNsZXMuc3BsaWNlKDAsIDAsIG5vVmVoaWNsZSk7XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgdm0ucGFzc2VuZ2VyVmVoaWNsZXMgPSBbbm9WZWhpY2xlXTtcclxuXHJcbiAgICAgICAgICAgICAgICBzZXRTZWxlY3RlZFZlaGljbGUoKTsgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2V0U2VsZWN0ZWRWZWhpY2xlKCkge1xyXG5cclxuICAgICAgICAgICAgdmFyIHRlbXBsYXRlID0gZ2V0VGVtcGxhdGUoKTtcclxuXHJcbiAgICAgICAgICAgIGlmICh2bS51c2VEZWZhdWx0VGVtcGxhdGUgJiYgdGVtcGxhdGUgIT0gdW5kZWZpbmVkXHJcbiAgICAgICAgICAgICAgICAgICAgJiYgdm0uc2VsZWN0ZWRDb25maWcuc2NoZWR1bGUgPT0gXCJBTVwiICYmIHRlbXBsYXRlLnZlaGljbGVJZCkge1xyXG5cclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdm0ucGFzc2VuZ2VyVmVoaWNsZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodm0ucGFzc2VuZ2VyVmVoaWNsZXNbaV0uaWQgPT0gdGVtcGxhdGUudmVoaWNsZUlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnBhcmtpbmdTZWxlY3RlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkQ29uZmlnLnZlaGljbGUgPSB2bS5wYXNzZW5nZXJWZWhpY2xlc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZENvbmZpZy52ZWhpY2xlID0gdm0ucGFzc2VuZ2VyVmVoaWNsZXNbMF07XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0RHJvcG9mZnMoKSB7XHJcbiAgICAgICAgICAgIGlmICghdm0uc2VsZWN0ZWRDb25maWcucGlja3VwIHx8ICEodm0uc2VsZWN0ZWRDb25maWcucGlja3VwLmlkKSlcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgIFN0b3BEYXRhU2VydmljZVxyXG4gICAgICAgICAgICAgICAgLmdldERyb3BvZmZzRm9yU2VsZWN0ZWRQaWNrdXAodm0uc2VsZWN0ZWRDb25maWcucGlja3VwLmlkKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uZHJvcG9mZlN0b3BzID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQuZHJvcG9mZnM7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uZHJvcG9mZlN0b3BzLnNwbGljZSgwLCAwLCBub1N0b3ApO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzZXREcm9wb2ZmU3RvcCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFRyaXBUaW1lcygpIHtcclxuICAgICAgICAgICAgaWYgKCF2bS5zZWxlY3RlZENvbmZpZy5waWNrdXAuaWQgfHwgIXZtLnNlbGVjdGVkQ29uZmlnLmRyb3BvZmYuaWQpXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcblxyXG4gICAgICAgICAgICBTdG9wRGF0YVNlcnZpY2VcclxuICAgICAgICAgICAgICAgIC5nZXRUcmlwVGltZXNGb3JBZHZhbmNlZFJlc2VydmF0aW9uXHJcbiAgICAgICAgICAgICAgICAodm0uc2VsZWN0ZWRDb25maWcucGlja3VwLmlkLCB2bS5zZWxlY3RlZENvbmZpZy5kcm9wb2ZmLmlkLCB2bS5zZWxlY3RlZENvbmZpZy5zY2hlZHVsZSlcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0LmFsbFRyaXBzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnRyaXBUaW1lcyA9IHJlc3BvbnNlLmRhdGEucmVzdWx0LmFsbFRyaXBzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS50cmlwVGltZXMuc3BsaWNlKDAsIDAsIG5vVHJpcFRpbWUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0U2VsZWN0ZWRUcmlwKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2V0U2VsZWN0ZWRUcmlwKCkge1xyXG4gICAgICAgICAgICBpZiAodm0udGVtcGxhdGVzLmxlbmd0aCA+IDAgJiYgdm0udXNlRGVmYXVsdFRlbXBsYXRlKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdGVtcGxhdGUgPSBnZXRUZW1wbGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCF0ZW1wbGF0ZSlcclxuICAgICAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZENvbmZpZy50cmlwVGltZSA9IHZtLnRyaXBUaW1lc1swXTtcclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdm0udHJpcFRpbWVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2bS50cmlwVGltZXNbaV0udHJpcElkID09IHRlbXBsYXRlLnRyaXBJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRDb25maWcudHJpcFRpbWUgPSB2bS50cmlwVGltZXNbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZENvbmZpZy50cmlwVGltZSA9IHZtLnRyaXBUaW1lc1swXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHJlZGlyZWN0VG9Mb2dpbigpIHtcclxuICAgICAgICAgICAgJHN0YXRlLmdvKCdsb2dpbicpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgYWN0aXZhdGUoKTtcclxuXHJcbiAgICAgICAgLy8gU3RhcnQgb2YgY29kZSBmb3IgSW9uaWNcclxuICAgICAgICB2bS5pb25pY0luY2x1ZGUgPSAnYXBwL21vZHVsZXMvY29tbXV0ZXIvYWR2LXNjaGVkdWxlL2Fkdi1zY2hlZHVsZS1zZXR1cC5odG1sJztcclxuICAgICAgICB2bS5pb25pY0N1c3RvbUNsYXNzTmFtZSA9ICcnO1xyXG4gICAgICAgIHZtLmlvbmljSGlkZU5hdkJhciA9IGZhbHNlO1xyXG4gICAgICAgIHZtLmlvbmljVXNlUmVmcmVzaGVyID0gdHJ1ZTtcclxuICAgICAgICB2bS5pb25pY1B1bGxpbmdUZXh0ID0gJ1JlZnJlc2ggUmVzZXJ2YXRpb25zJztcclxuICAgICAgICB2bS5pb25pY1JlZnJlc2hpbmdUZXh0ID0gJ0xvYWRpbmcgUmVzZXJ2YXRpb25zJztcclxuICAgICAgICB2bS5pb25pY1NwaW5uZXIgPSAnc3BpcmFsJzsgLy8gbm9uZSB0byBkaXNhYmxlLlxyXG4gICAgICAgIHZtLnJlZnJlc2ggPSBmdW5jdGlvbiAocmVmcmVzaGVyKSB7XHJcbiAgICAgICAgICAgIHZtLmlzTG9hZGluZyA9IHRydWU7XHJcbiAgICAgICAgICAgIGFjdGl2YXRlKCk7XHJcbiAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnc2Nyb2xsLnJlZnJlc2hDb21wbGV0ZScpO1xyXG4gICAgICAgICAgICB2bS5pc0xvYWRpbmcgPSBmYWxzZVxyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBFbmQgb2YgY29kZSBmb3IgSW9uaWNcclxuICAgIH1cclxuXHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignUmVzZXJ2YXRpb25Nb2RhbENvbnRyb2xsZXInLCBSZXNlcnZhdGlvbk1vZGFsQ29udHJvbGxlcik7XHJcblxyXG4gICAgUmVzZXJ2YXRpb25Nb2RhbENvbnRyb2xsZXIuJGluamVjdCA9IFsnJHVpYk1vZGFsSW5zdGFuY2UnLCdyZXNlcnZhdGlvbiddO1xyXG5cclxuICAgIGZ1bmN0aW9uIFJlc2VydmF0aW9uTW9kYWxDb250cm9sbGVyKCR1aWJNb2RhbEluc3RhbmNlLCByZXNlcnZhdGlvbikge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcblxyXG5cclxuICAgICAgICB2bS5wYXNzZW5nZXJSZXNlcnZhdGlvbnMgPSBbcmVzZXJ2YXRpb25dO1xyXG5cclxuICAgICAgICB2bS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoKTtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0RpcmVjdGlvbnNDb250cm9sbGVyJywgRGlyZWN0aW9uc0NvbnRyb2xsZXIpO1xyXG5cclxuICAgIERpcmVjdGlvbnNDb250cm9sbGVyLiRpbmplY3QgPSBbJyRyb290U2NvcGUnLCckbG9jYXRpb24nLCAnJHN0YXRlUGFyYW1zJywgJ1NjaGVkdWxlU2VydmljZScsICdTdG9wRGF0YVNlcnZpY2UnLCAndWlHbWFwSXNSZWFkeSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIERpcmVjdGlvbnNDb250cm9sbGVyKCRyb290U2NvcGUsJGxvY2F0aW9uLCAkc3RhdGVQYXJhbXMsIFNjaGVkdWxlU2VydmljZSwgU3RvcERhdGFTZXJ2aWNlLCB1aUdtYXBJc1JlYWR5KSB7XHJcblxyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdm0uc2VsZWN0ZWRTdG9wID0gU3RvcERhdGFTZXJ2aWNlLmdldFN0b3AoKTtcclxuICAgICAgICB2bS5oYXNTdG9wRGVzY3JpcHRpb24gPSBmYWxzZTtcclxuXHJcbiAgICAgICAgLy9pZiAodm0uc2VsZWN0ZWRTdG9wID09IHVuZGVmaW5lZCB8fCB2bS5zZWxlY3RlZFN0b3AgPT0gbnVsbCB8fCB2bS5zZWxlY3RlZFN0b3AubGF0aXR1ZGUgPT0gdW5kZWZpbmVkIHx8IHZtLnNlbGVjdGVkU3RvcC5sYXRpdHVkZSA9PSBudWxsKVxyXG4gICAgICAgIC8vICAgIHZtLnNlbGVjdGVkU3RvcCA9IHtcclxuICAgICAgICAvLyAgICAgICAgbGF0aXR1ZGU6IDQwLjY1MTczOSxcclxuICAgICAgICAvLyAgICAgICAgbG9uZ2l0dWRlOiAtNzMuOTUzMTQ4XHJcbiAgICAgICAgLy8gICAgfVxyXG4gICAgICAgIHZhciBjdXJyZW50TG9jYXRpb24gPSBTdG9wRGF0YVNlcnZpY2UuZ2V0R2VvTG9jYXRpb24oKTtcclxuICAgICAgICAvL2N1cnJlbnRMb2NhdGlvbiA9IHtcclxuICAgICAgICAvLyAgICBjb29yZHM6IHtcclxuICAgICAgICAvLyAgICAgICAgbGF0aXR1ZGU6IDMyLjYwNDc3NyxcclxuICAgICAgICAvLyAgICAgICAgbG9uZ2l0dWRlOiAtOTkuNDM0MzEyN1xyXG4gICAgICAgIC8vICAgIH1cclxuICAgICAgICAvL31cclxuXHJcbiAgICAgICAgdm0uZnJvbUxvY2F0aW9uID0gY3VycmVudExvY2F0aW9uICE9IG51bGwgPyBjdXJyZW50TG9jYXRpb24uY29vcmRzLmxhdGl0dWRlICsgJywnICsgY3VycmVudExvY2F0aW9uLmNvb3Jkcy5sb25naXR1ZGUgOiAnJztcclxuICAgICAgICBcclxuICAgICAgICB2bS5jZW50ZXIgPSB7XHJcbiAgICAgICAgICAgIGxhdGl0dWRlOiA0MC42NTE3MzksXHJcbiAgICAgICAgICAgIGxvbmdpdHVkZTogLTczLjk1MzE0OFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLnpvb20gPSAxNDtcclxuICAgICAgICB2bS5tYXBDb250cm9sID0ge307XHJcbiAgICAgICAgdmFyIG15U3R5bGVzID0gW1xyXG4gICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgZmVhdHVyZVR5cGU6IFwicG9pXCIsXHJcbiAgICAgICAgICAgICAgIGVsZW1lbnRUeXBlOiBcImxhYmVsc1wiLFxyXG4gICAgICAgICAgICAgICBzdHlsZXJzOiBbXHJcbiAgICAgICAgICAgICAgICAgICAgIHsgdmlzaWJpbGl0eTogXCJvZmZcIiB9XHJcbiAgICAgICAgICAgICAgIF1cclxuICAgICAgICAgICB9LFxyXG4gICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgXCJmZWF0dXJlVHlwZVwiOiBcInRyYW5zaXRcIixcclxuICAgICAgICAgICAgICAgXCJlbGVtZW50VHlwZVwiOiBcImxhYmVscy5pY29uXCIsXHJcbiAgICAgICAgICAgICAgIFwic3R5bGVyc1wiOiBbXHJcbiAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgXCJ2aXNpYmlsaXR5XCI6IFwib2ZmXCJcclxuICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgXVxyXG4gICAgICAgICAgIH1cclxuICAgICAgICBdO1xyXG4gICAgICAgIHZtLm1hcE9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIG1hcFR5cGVDb250cm9sOiBmYWxzZSxcclxuICAgICAgICAgICAgem9vbUNvbnRyb2w6IGZhbHNlLFxyXG4gICAgICAgICAgICBzdHJlZXRWaWV3Q29udHJvbDogZmFsc2UsXHJcbiAgICAgICAgICAgIHN0eWxlczogbXlTdHlsZXNcclxuXHJcbiAgICAgICAgfTtcclxuICAgICAgICB2bS5vcHRpb25zID0ge307XHJcbiAgICAgICAgdm0ubWFya2VyRXZlbnRzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAvL2ZvciBmdXR1cmU/XHJcbiAgICAgICAgfTtcclxuICAgICAgICB2bS5zaG93RGlyZWN0aW9ucyA9IGN1cnJlbnRMb2NhdGlvbiA9PSBudWxsO1xyXG5cclxuICAgICAgICB2YXIgYm91bmRzID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZ0JvdW5kcygpO1xyXG4gICAgICAgIHZhciBkaXJlY3Rpb25zRGlzcGxheTtcclxuICAgICAgICB2YXIgZGlyZWN0aW9uc1NlcnZpY2U7XHJcbiAgICAgICAgdWlHbWFwSXNSZWFkeS5wcm9taXNlKCkudGhlbihmdW5jdGlvbiAobWFwcykge1xyXG5cclxuICAgICAgICAgICAgZGlyZWN0aW9uc0Rpc3BsYXkgPSBuZXcgZ29vZ2xlLm1hcHMuRGlyZWN0aW9uc1JlbmRlcmVyO1xyXG4gICAgICAgICAgICBkaXJlY3Rpb25zU2VydmljZSA9IG5ldyBnb29nbGUubWFwcy5EaXJlY3Rpb25zU2VydmljZTtcclxuICAgICAgICAgICAgdmFyIGRpcmVjdGlvbnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlyZWN0aW9ucycpO1xyXG5cclxuICAgICAgICAgICAgZGlyZWN0aW9uc0Rpc3BsYXkuc2V0TWFwKHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpKTtcclxuICAgICAgICAgICAgZGlyZWN0aW9uc0Rpc3BsYXkuc2V0UGFuZWwoZGlyZWN0aW9ucyk7XHJcblxyXG4gICAgICAgICAgICBpZiAodm0uc2hvd0RpcmVjdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgIGJvdW5kcy5leHRlbmQobmV3IGdvb2dsZS5tYXBzLkxhdExuZyh2bS5zZWxlY3RlZFN0b3AubGF0aXR1ZGUsIHZtLnNlbGVjdGVkU3RvcC5sb25naXR1ZGUpKTtcclxuICAgICAgICAgICAgICAgIHZtLmNlbnRlci5sYXRpdHVkZSA9IHZtLnNlbGVjdGVkU3RvcC5sYXRpdHVkZTtcclxuICAgICAgICAgICAgICAgIHZtLmNlbnRlci5sb25naXR1ZGUgPSB2bS5zZWxlY3RlZFN0b3AubG9uZ2l0dWRlO1xyXG4gICAgICAgICAgICAgIC8vICB2bS5tYXBDb250cm9sLmdldEdNYXAoKS5maXRCb3VuZHMoYm91bmRzKTtcclxuICAgICAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnRyaWdnZXIodm0ubWFwQ29udHJvbC5nZXRHTWFwKCksIFwicmVzaXplXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbWFwRGlyZWN0aW9uKHZtLmZyb21Mb2NhdGlvbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdm0uZ2V0RGlyZWN0aW9uID0gZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICAgICAgdmFyIGdlb2NvZGVyID0gbmV3IGdvb2dsZS5tYXBzLkdlb2NvZGVyO1xyXG4gICAgICAgICAgICBnZW9jb2Rlci5nZW9jb2RlKHsgJ2FkZHJlc3MnOiB2bS5mcm9tTG9jYXRpb24gfSxcclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChyZXNwb25zZSwgc3RhdHVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gZ29vZ2xlLm1hcHMuR2VvY29kZXJTdGF0dXMuT0spIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWFwRGlyZWN0aW9uKHJlc3BvbnNlWzBdLmdlb21ldHJ5LmxvY2F0aW9uLmxhdCgpICsgJywnICsgcmVzcG9uc2VbMF0uZ2VvbWV0cnkubG9jYXRpb24ubG5nKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBtYXBEaXJlY3Rpb24gPSBmdW5jdGlvbiAoc3RhcnQpIHtcclxuXHJcbiAgICAgICAgICAgIFxyXG5cclxuICAgICAgICAgICAgZGlyZWN0aW9uc1NlcnZpY2Uucm91dGUoe1xyXG4gICAgICAgICAgICAgICAgb3JpZ2luOiBzdGFydCxcclxuICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uOiB2bS5zZWxlY3RlZFN0b3AubGF0aXR1ZGUgKyAnLCcgKyB2bS5zZWxlY3RlZFN0b3AubG9uZ2l0dWRlLFxyXG4gICAgICAgICAgICAgICAgdHJhdmVsTW9kZTogZ29vZ2xlLm1hcHMuRGlyZWN0aW9uc1RyYXZlbE1vZGUuRFJJVklOR1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVzcG9uc2UsIHN0YXR1cykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gJ09LJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbnNEaXNwbGF5LnNldERpcmVjdGlvbnMocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnN0b3BEZXNjcmlwdGlvbiA9IHZtLnNlbGVjdGVkU3RvcC5kZXNjcmlwdGlvbjtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodm0uc3RvcERlc2NyaXB0aW9uICE9PSBcIlwiICYmICFhbmd1bGFyLmlzVW5kZWZpbmVkKHZtLnN0b3BEZXNjcmlwdGlvbikpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmhhc1N0b3BEZXNjcmlwdGlvbiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5hbGVydCgnRGlyZWN0aW9ucyByZXF1ZXN0IGZhaWxlZCBkdWUgdG8gJyArIHN0YXR1cyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICAvL3ZtLm5hdmlnYXRlVG9UcmlwUGFnZSA9IGZ1bmN0aW9uIChpbmRleCkge1xyXG4gICAgICAgIC8vICAgIHZhciBpbmNpZGVudCA9IHZtLm5vblBlcmZvcm1lZEluY2lkZW50c1tpbmRleF07XHJcbiAgICAgICAgLy8gICAgJGxvY2F0aW9uLnBhdGgoJy9zZWxlY3RlZC10cmlwLycgKyAyNDkuMSArICcvJyArIGluY2lkZW50LkJsb2NrSWQgKyAnLycgKyBpbmNpZGVudC5JbmNpZGVudElkKTtcclxuICAgICAgICAvL31cclxuXHJcbiAgICAgICAgLy8gU3RhcnQgb2YgY29kZSBmb3IgSW9uaWNcclxuICAgICAgICB2bS5pb25pY0luY2x1ZGUgPSAnYXBwL21vZHVsZXMvY29tbXV0ZXIvZGlyZWN0aW9ucy9kaXJlY3Rpb25zLmh0bWwnO1xyXG4gICAgICAgIHZtLmlvbmljQ3VzdG9tQ2xhc3NOYW1lID0gJyc7XHJcbiAgICAgICAgdm0uaW9uaWNIaWRlTmF2QmFyID0gZmFsc2U7XHJcbiAgICAgICAgdm0uaW9uaWNVc2VSZWZyZXNoZXIgPSBmYWxzZTtcclxuICAgICAgICAvLyBFbmQgb2YgY29kZSBmb3IgSW9uaWNcclxuICAgIH1cclxufSkoKTtcclxuIiwiLy8vIDxyZWZlcmVuY2UgcGF0aD1cImhvbWUuaHRtbFwiIC8+XHJcblxyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdDb21tdXRlckhvbWVDb250cm9sbGVyJywgQ29tbXV0ZXJIb21lQ29udHJvbGxlcik7XHJcblxyXG4gICAgQ29tbXV0ZXJIb21lQ29udHJvbGxlci4kaW5qZWN0ID1cclxuICAgICAgICBbJyRzY29wZScsICckcm9vdFNjb3BlJywgJyRsb2NhdGlvbicsICdSZXNlcnZhdGlvblNlcnZpY2UnLCAnYXV0aFNlcnZpY2UnLFxyXG4gICAgICAgICAgICAgJyR1aWJNb2RhbCcsICdNZXNzYWdlU2VydmljZScsICdlbnYnLCAndmVoaWNsZVNlcnZpY2UnLCAnUGFnZVNlcnZpY2UnLCdPbmVNdlNlcnZpY2VzJ107XHJcblxyXG4gICAgZnVuY3Rpb24gQ29tbXV0ZXJIb21lQ29udHJvbGxlcigkc2NvcGUsICRyb290U2NvcGUsICRsb2NhdGlvbiwgUmVzZXJ2YXRpb25TZXJ2aWNlLFxyXG4gICAgICAgIGF1dGhTZXJ2aWNlLCBcclxuICAgICAgICAkdWliTW9kYWwsIE1lc3NhZ2VTZXJ2aWNlLCBlbnYsIHZlaGljbGVTZXJ2aWNlLCBQYWdlU2VydmljZSxPbmVNdlNlcnZpY2VzKSB7XHJcblxyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2UgPSBQYWdlU2VydmljZTtcclxuICAgICAgICB2bS5QYWdlU2VydmljZS5zZXRUaXRsZSgnRGFzaGJvYXJkJyk7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2Uuc2V0SGVhZGxpbmUoT25lTXZTZXJ2aWNlcy5nZXRDb21tdXRlckluZm8oKS5hbGlhcyk7XHJcbiAgICAgICAgdm0uaXNVc2VyTG9nZ2VkSW4gPSBhdXRoU2VydmljZS5pc0xvZ2dlZEluKCk7XHJcbiAgICAgICAgdm0ucmVzZXJ2YXRpb25zQWxsb3dlZCA9IGVudi5yZXNlcnZhdGlvbnNBbGxvd2VkO1xyXG4gICAgICAgIHZtLnBhc3NlbmdlcklkID0gJyc7XHJcbiAgICAgICAgdm0ucGFzc2VuZ2VyUmVzZXJ2YXRpb25zID0gW107XHJcbiAgICAgICAgdm0uaXNMb2FkaW5nID0gdHJ1ZTtcclxuICAgICAgICB2bS52ZWhpY2xlcyA9IFtdO1xyXG4gICAgICAgIHZtLnVwZGF0aW5nVmVoaWNsZUluZm8gPSBbXTtcclxuICAgICAgICB2bS5jb21tdXRlckZlYXR1cmVzID0gW1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiY2xhc3NcIjogXCJjYXJvdXNlbF9faXRlbS0tYWxsLXN0b3BzXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaGVhZGxpbmVcIjogXCJFeHBsb3JlXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidGl0bGVcIjogXCJCdXMgU3RvcHNcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJkZXNjcmlwdGlvblwiOiBcIkZpbmQgYSBidXMgc3RvcCBuZWFyIHlvdS5cIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJsaW5rXCI6IFwiY29tbXV0ZXIvYWxsLXN0b3BzXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiY3RhXCIgOiBcIlZpZXcgU3RvcHNcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImNsYXNzXCI6IFwiY2Fyb3VzZWxfX2l0ZW0tLWFkdmFuY2VkLXJlc2VydmF0aW9uc1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImhlYWRsaW5lXCI6IFwiQm9va1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInRpdGxlXCI6IFwiUmVzZXJ2YXRpb25zXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZGVzY3JpcHRpb25cIjogXCJVcCB0byB0d28gd2Vla3MgaW4gYWR2YW5jZS5cIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJsaW5rXCI6IFwiY29tbXV0ZXIvYWR2LXNjaGVkdWxlLXNldHVwXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiY3RhXCI6IFwiR2V0IFN0YXJ0ZWRcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImNsYXNzXCI6IFwiY2Fyb3VzZWxfX2l0ZW0tLWNvbW11dGVyLXNjaGVkdWxlXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiaGVhZGxpbmVcIjogXCJWaWV3XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwidGl0bGVcIjogXCJQdWJsaXNoZWQgU2NoZWR1bGVzXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZGVzY3JpcHRpb25cIjogXCJTZWUgYWxsIG9mIHRoZSBwdWJsaXNoZWQgc2NoZWR1bGUgdGltZXMgYXQgYSBnbGFuY2UuXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibGlua1wiOiBcImNvbW11dGVyL3B1Ymxpc2hlZC1zY2hlZHVsZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImN0YVwiOiBcIlNob3cgU2NoZWR1bGVcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF07XHJcblxyXG5cclxuICAgICAgICBcclxuICAgICAgICAvL21ldGhvZCBleHBvc2VkIHRvIHZpZXdcclxuICAgICAgICB2bS5zaG93Q29tbXV0ZXJUcmlwID0gc2hvd0NvbW11dGVyVHJpcDtcclxuXHJcbiAgICAgICAgLy92YXIgdm0gPSB0aGlzO1xyXG5cclxuICAgICAgICAkc2NvcGUuY2Fyb3VzZWxPcHRpb25zID0ge1xyXG4gICAgICAgICAgICBuYXZUZXh0OiBbXCJcIiwgXCJcIl0sXHJcbiAgICAgICAgICAgIHJlc3BvbnNpdmVDbGFzczogZmFsc2UsXHJcbiAgICAgICAgICAgIG5hdjogdHJ1ZSxcclxuXHJcbiAgICAgICAgICAgIHJlc3BvbnNpdmU6IHtcclxuICAgICAgICAgICAgICAgIDA6IHtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtczogMSxcclxuICAgICAgICAgICAgICAgICAgICBzdGFnZVBhZGRpbmc6IDM0LFxyXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0UG9zaXRpb246IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgY2VudGVyOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIDM3NToge1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgIHN0YWdlUGFkZGluZzogMzQsXHJcbiAgICAgICAgICAgICAgICAgICAgc3RhcnRQb3NpdGlvbjogMSxcclxuICAgICAgICAgICAgICAgICAgICBjZW50ZXI6IHRydWUsXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgNzY4OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbXM6IDIsXHJcbiAgICAgICAgICAgICAgICAgICAgc3RhZ2VQYWRkaW5nOiAxNixcclxuICAgICAgICAgICAgICAgICAgICBzdGFydFBvc2l0aW9uOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgIGNlbnRlcjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICA5OTI6IHtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtczogMyxcclxuICAgICAgICAgICAgICAgICAgICBzdGFnZVBhZGRpbmc6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgY2VudGVyOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0VXNlclJlc2VydmF0aW9ucyhjYWxsYmFjaykge1xyXG4gICAgICAgICAgICBSZXNlcnZhdGlvblNlcnZpY2UuZ2V0UGFzc2VuZ2VyUmVzZXJ2YXRpb25zRm9yVG9kYXkodm0ucGFzc2VuZ2VySWQpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLmRhdGEgJiYgcmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSAmJiByZXNwb25zZS5kYXRhLnJlc3VsdC5yZXNlcnZhdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5wYXNzZW5nZXJSZXNlcnZhdGlvbnMgPSByZXNwb25zZS5kYXRhLnJlc3VsdC5yZXNlcnZhdGlvbnM7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uaXNMb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnBhc3NlbmdlclJlc2VydmF0aW9ucyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZXJyLnN0YXR1cyAhPT0gNDAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZVNlcnZpY2Uuc2hvd0Vycm9yKCdTb3JyeSEgQ291bGQgbm90IGxvYWQgeW91ciBSZXNlcnZhdGlvbiEnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZtLmlzTG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFZlaGljbGVzKCkge1xyXG4gICAgICAgICAgICB2ZWhpY2xlU2VydmljZS5nZXRWZWhpY2xlc0ZvclBhc3Nlbmdlcih2bS5wYXNzZW5nZXJJZClcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSAmJiByZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0ICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgdm0udmVoaWNsZXMgPSByZXNwb25zZS5kYXRhLnJlc3VsdDtcclxuICAgICAgICAgICAgICAgIHZtLmlzTG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHZtLmlzTG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBzaG93Q29tbXV0ZXJUcmlwKHRyaXApIHtcclxuICAgICAgICAgICAgdmFyIGNvbW11dGVyVHJpcE1vZGFsID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvbW9kdWxlcy9zaGFyZWQvdHJpcHMvY29tbXV0ZXItdHJpcC1tb2RhbC5odG1sJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDb21tdXRlclRyaXBNb2RhbENvbnRyb2xsZXIgYXMgdm0nLFxyXG4gICAgICAgICAgICAgICAgc2l6ZTogJy1mcycsXHJcbiAgICAgICAgICAgICAgICBiYWNrZHJvcDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBrZXlib2FyZDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHJpcElkOiB0cmlwLmlkXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgY29tbXV0ZXJUcmlwTW9kYWwucmVzdWx0LnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuY2FuY2VsbGVkIHx8IHJlc3BvbnNlLmlzTW9kaWZpZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBnZXRVc2VyUmVzZXJ2YXRpb25zKGdldFZlaGljbGVzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xyXG4gICAgICAgICAgICBpZiAodm0uaXNVc2VyTG9nZ2VkSW4pIHtcclxuICAgICAgICAgICAgICAgIHZtLnBhc3NlbmdlcklkID0gYXV0aFNlcnZpY2UuYXV0aGVudGljYXRpb24ucGFzc2VuZ2VySWQ7XHJcbiAgICAgICAgICAgICAgICBnZXRVc2VyUmVzZXJ2YXRpb25zKGdldFZlaGljbGVzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIHZtLnVwZGF0ZVBhcmtpbmdWZWhpY2xlID0gZnVuY3Rpb24gKHJlc2VydmF0aW9uLCBpbmRleCkge1xyXG4gICAgICAgICAgICB2bS51cGRhdGluZ1ZlaGljbGVJbmZvW2luZGV4XSA9IHRydWU7XHJcbiAgICAgICAgICAgIFJlc2VydmF0aW9uU2VydmljZVxyXG4gICAgICAgICAgICAgICAgLnVwZGF0ZVZlaGljbGVGb3JSZXNlcnZhdGlvbihyZXNlcnZhdGlvbi5SZXNlcnZhdGlvbklkLCByZXNlcnZhdGlvbi5WZWhpY2xlSWQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS51cGRhdGluZ1ZlaGljbGVJbmZvW2luZGV4XSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0udXBkYXRpbmdWZWhpY2xlSW5mb1tpbmRleF0gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLnNob3dTdG9wc01hcCA9IGZ1bmN0aW9uIChpbmMpIHtcclxuICAgICAgICAgICAgdmFyIG1vZGFsR2V0TWFwID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgd2luZG93Q2xhc3M6ICdtYXAtbW9kYWwnLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvbW9kdWxlcy9jb21tdXRlci9tb2RhbHMvcmVzZXJ2YXRpb24tbWFwLW1vZGFsL3Jlc2VydmF0aW9uLW1hcC5odG1sJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdSZXNlcnZhdGlvbk1hcENvbnRyb2xsZXIgYXMgdm0nLFxyXG4gICAgICAgICAgICAgICAgYmFja2Ryb3A6ICdzdGF0aWMnLFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc2VydmF0aW9uX3N0b3BzOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpbmM7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIG1vZGFsR2V0TWFwLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChpc0RvbmUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChpc0RvbmUpIHtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLmxvZ2luID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2xvZ2luJyk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICB2bS5jdGFBY3Rpb24gPSBmdW5jdGlvbihsaW5rKXtcclxuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgobGluayk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBhY3RpdmF0ZSgpO1xyXG5cclxuICAgICAgICAvLyBTdGFydCBvZiBjb2RlIGZvciBJb25pY1xyXG4gICAgICAgIHZtLmlvbmljSW5jbHVkZSA9ICdhcHAvbW9kdWxlcy9jb21tdXRlci9ob21lL2hvbWUuaHRtbCc7XHJcbiAgICAgICAgdm0uaW9uaWNDdXN0b21DbGFzc05hbWUgPSAnaW9uaWMtdG9wLXBhZGRpbmcnO1xyXG4gICAgICAgIHZtLmlvbmljSGlkZU5hdkJhciA9IGZhbHNlO1xyXG4gICAgICAgIHZtLmlvbmljVXNlUmVmcmVzaGVyID0gdHJ1ZTtcclxuICAgICAgICB2bS5pb25pY1B1bGxpbmdUZXh0ID0gJ1JlZnJlc2gnO1xyXG4gICAgICAgIHZtLmlvbmljUmVmcmVzaGluZ1RleHQgPSAnTG9hZGluZyc7XHJcbiAgICAgICAgdm0uaW9uaWNTcGlubmVyID0gJ3NwaXJhbCc7IC8vIG5vbmUgdG8gZGlzYWJsZS5cclxuICAgICAgICB2bS5yZWZyZXNoID0gZnVuY3Rpb24gKHJlZnJlc2hlcikge1xyXG4gICAgICAgICAgICB2bS5pc0xvYWRpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICB2bS50aXRsZSA9ICdIb21lJztcclxuICAgICAgICAgICAgdm0uaXNVc2VyTG9nZ2VkSW4gPSBhdXRoU2VydmljZS5pc0xvZ2dlZEluKCk7XHJcbiAgICAgICAgICAgIHZtLnJlc2VydmF0aW9uc0FsbG93ZWQgPSBlbnYucmVzZXJ2YXRpb25zQWxsb3dlZDtcclxuICAgICAgICAgICAgdm0ucGFzc2VuZ2VySWQgPSAnJztcclxuICAgICAgICAgICAgdm0udXNlclJlc2VydmF0aW9ucyA9IHt9O1xyXG4gICAgICAgICAgICB2bS52ZWhpY2xlcyA9IFtdO1xyXG4gICAgICAgICAgICB2bS51cGRhdGluZ1ZlaGljbGVJbmZvID0gW107XHJcbiAgICAgICAgICAgIGFjdGl2YXRlKCk7XHJcbiAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnc2Nyb2xsLnJlZnJlc2hDb21wbGV0ZScpO1xyXG4gICAgICAgICAgICB2bS5pc0xvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gRW5kIG9mIGNvZGUgZm9yIElvbmljXHJcbiAgICB9XHJcbn0pKCk7XHJcblxyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0xhc3RMb2NhdGlvbkNvbnRyb2xsZXInLCBMYXN0TG9jYXRpb25Db250cm9sbGVyKTtcclxuXHJcbiAgICBMYXN0TG9jYXRpb25Db250cm9sbGVyLiRpbmplY3QgPSBbJyRyb290U2NvcGUnLCdTdG9wRGF0YVNlcnZpY2UnLCAnJHEnLCAnJGh0dHAnLCAnZW52JywgJ3VpR21hcElzUmVhZHknLCAnJHN0YXRlUGFyYW1zJywgJyRpbnRlcnZhbCcsICckd2luZG93JywgJ0dlb0xvY2F0aW9uU2VydmljZScsICckdGltZW91dCcsICckc3RhdGUnLCAnTWVzc2FnZVNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBMYXN0TG9jYXRpb25Db250cm9sbGVyKCRyb290U2NvcGUsU3RvcERhdGFTZXJ2aWNlLCAkcSwgJGh0dHAsIGVudiwgdWlHbWFwSXNSZWFkeSwgJHN0YXRlUGFyYW1zLCAkaW50ZXJ2YWwsICR3aW5kb3csIEdlb0xvY2F0aW9uU2VydmljZSwgJHRpbWVvdXQsICRzdGF0ZSwgTWVzc2FnZVNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLm1hcENvbnRyb2wgPSB7fTtcclxuICAgICAgICB2YXIgbXlTdHlsZXMgPSBbXHJcbiAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICBmZWF0dXJlVHlwZTogXCJwb2lcIixcclxuICAgICAgICAgICAgICAgZWxlbWVudFR5cGU6IFwibGFiZWxzXCIsXHJcbiAgICAgICAgICAgICAgIHN0eWxlcnM6IFtcclxuICAgICAgICAgICAgICAgICAgICAgeyB2aXNpYmlsaXR5OiBcIm9mZlwiIH1cclxuICAgICAgICAgICAgICAgXVxyXG4gICAgICAgICAgIH0sXHJcbiAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICBcImZlYXR1cmVUeXBlXCI6IFwidHJhbnNpdFwiLFxyXG4gICAgICAgICAgICAgICBcImVsZW1lbnRUeXBlXCI6IFwibGFiZWxzLmljb25cIixcclxuICAgICAgICAgICAgICAgXCJzdHlsZXJzXCI6IFtcclxuICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICBcInZpc2liaWxpdHlcIjogXCJvZmZcIlxyXG4gICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgfVxyXG4gICAgICAgIF07XHJcbiAgICAgICAgdm0ubWFwT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgbWFwVHlwZUNvbnRyb2w6IGZhbHNlLFxyXG4gICAgICAgICAgICB6b29tQ29udHJvbDogdHJ1ZSxcclxuICAgICAgICAgICAgc3RyZWV0Vmlld0NvbnRyb2w6IGZhbHNlLFxyXG4gICAgICAgICAgICBzdHlsZXM6IG15U3R5bGVzXHJcblxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdmFyIGJ1c1Bpbiwgc3RvcFBpbiwgbG9jYXRpb25QaW4sIG15TG9jYXRpb25QaW4sIHBpbkh1YjtcclxuICAgICAgICB2YXIgayA9IDAuMDAxO1xyXG4gICAgICAgIGlmKCR3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiVHJpZGVudFwiKSA+IDAgfHwgJHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXCJNU0lFXCIpID4gMCkge1xyXG4gICAgICAgICAgICBidXNQaW4gPSAnaW1hZ2VzL3Bpbi12ZWhpY2xlLWJsdWUucG5nJztcclxuICAgICAgICAgICAgc3RvcFBpbiA9ICdpbWFnZXMvcGluLWJ1c3N0b3AtZ3JleS5wbmcnO1xyXG4gICAgICAgICAgICBsb2NhdGlvblBpbiA9ICdpbWFnZXMvcGluLWxvY2F0aW9uLnBuZyc7XHJcbiAgICAgICAgICAgIG15TG9jYXRpb25QaW4gPSAnaW1hZ2VzL3Bpbi1teS1sb2NhdGlvbi5wbmcnO1xyXG4gICAgICAgICAgICBwaW5IdWIgPSAnaW1hZ2VzL3Bpbi1odWIucG5nJztcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGJ1c1BpbiA9ICdpbWFnZXMvcGluLXZlaGljbGUtYmx1ZS5zdmcnO1xyXG4gICAgICAgICAgICBzdG9wUGluID0gJ2ltYWdlcy9waW4tYnVzc3RvcC1ncmV5LnN2Zyc7XHJcbiAgICAgICAgICAgIGxvY2F0aW9uUGluID0gJ2ltYWdlcy9waW4tbG9jYXRpb24uc3ZnJztcclxuICAgICAgICAgICAgbXlMb2NhdGlvblBpbiA9ICdpbWFnZXMvcGluLW15LWxvY2F0aW9uLnN2Zyc7XHJcbiAgICAgICAgICAgIHBpbkh1YiA9ICdpbWFnZXMvcGluLWh1Yi5zdmcnO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0uaHViSWNvbiA9IHsgdXJsOiBwaW5IdWIgfTtcclxuICAgICAgICB2bS5teUxvY2F0aW9uSWNvbiA9IHtcclxuICAgICAgICAgICAgdXJsOiBteUxvY2F0aW9uUGluLFxyXG4gICAgICAgICAgICBzaXplOiBuZXcgZ29vZ2xlLm1hcHMuU2l6ZSg0MiwgNDIpLFxyXG4gICAgICAgICAgICBvcmlnaW46IG5ldyBnb29nbGUubWFwcy5Qb2ludCgwLCAwKSxcclxuICAgICAgICAgICAgYW5jaG9yOiBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQoMjAsIDIwKVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdm0udHJpcERldGFpbHMgPSB7XHJcbiAgICAgICAgICAgIGJ1c05hbWU6ICcnLFxyXG4gICAgICAgICAgICBFVEE6ICcnXHJcbiAgICAgICAgICAgIFxyXG5cclxuICAgICAgICB9O1xyXG4gICAgICAgIHZtLnNob3cgPSB0cnVlO1xyXG4gICAgICAgIHZtLm1hcmtlckV2ZW50ID0ge1xyXG4gICAgICAgICAgICBjbGljazogZnVuY3Rpb24gKGdNYXJrZXIsIGV2ZW50TmFtZSwgbW9kZWwpIHtcclxuICAgICAgICAgICAgICAgdm0uc2hvdyA9ICF2bS5zaG93XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uY2VudGVyID0ge1xyXG4gICAgICAgICAgICBsYXRpdHVkZTogNDcuNjA0MzU2LFxyXG4gICAgICAgICAgICBsb25naXR1ZGU6IC0xMjIuMzM2MDgxN1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgdm0uem9vbSA9IDQ7XHJcbiAgICAgICAgdm0uaW5jaWRlbnQgPSBTdG9wRGF0YVNlcnZpY2UuZ2V0SW5jaWRlbnQoKTtcclxuICAgICAgICB2bS52ZWhpY2xlSWQgPSBTdG9wRGF0YVNlcnZpY2UuZ2V0VmVoaWNsZUlkKCk7XHJcbiAgICAgIC8vICB2bS52ZWhpY2xlSWQgPSAnMTAzJztcclxuICAgICAgICBpZiAoYW5ndWxhci5pc1VuZGVmaW5lZCh2bS52ZWhpY2xlSWQpIHx8IHZtLnZlaGljbGVJZCA9PSBudWxsKVxyXG4gICAgICAgICAgICB2bS5zaG93ID0gZmFsc2U7XHJcbiAgICAgICAgdm0uc3RvcCA9IFN0b3BEYXRhU2VydmljZS5nZXRTdG9wKCkgfHwgbnVsbDtcclxuICAgICAgICBpZiAodm0uc3RvcCAhPSBudWxsICYmIHZtLnN0b3AubGF0aXR1ZGUgIT0gdW5kZWZpbmVkICYmIHZtLnN0b3AubGF0aXR1ZGUgIT0gbnVsbClcclxuICAgICAgICAgICAgdm0uc3RvcC5pY29uID0geyB1cmw6IHN0b3BQaW4gfTtcclxuICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIHZtLnN0b3AgPSBudWxsO1xyXG4gICAgICAgIHZtLnZlaGljbGUgPSB7fTtcclxuICAgICAgICB2bS5teUxvY2F0aW9uID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHZtLmJ1c0xvY2F0aW9uID0gdW5kZWZpbmVkO1xyXG4gICAgICAgXHJcbiAgICAgICAgdm0uaHVicyA9IFtdO1xyXG4gICAgICAgIFxyXG5cclxuICAgICAgICBpZiAodm0uaW5jaWRlbnQpIHtcclxuICAgICAgICAgICAgLy9jaGVjayBmb3IgLXZlIGluIHN0cmluZyBhbmQgc2F5IGFnbyBvciBpblxyXG4gICAgICAgICAgICB2bS50cmlwRGV0YWlscy5FVEEgPSAodm0uaW5jaWRlbnQuRXN0aW1hdGVkVGltZVN0cmluZy5pbmRleE9mKCctJykgPiAtMSA/ICdEZXBhcnRlZCAnIDogJycpICsgdm0uaW5jaWRlbnQuRXN0aW1hdGVkVGltZVN0cmluZy5yZXBsYWNlKCctJywgJycpICsgJyBtaW4nICsgKHZtLmluY2lkZW50LkVzdGltYXRlZFRpbWVTdHJpbmcuaW5kZXhPZignLScpID4gLTEgPyAnIGFnbycgOiAnJyk7XHJcbiAgICAgICAgICAgIHZtLnRyaXBEZXRhaWxzLmJ1c05hbWUgPSAoIWFuZ3VsYXIuaXNVbmRlZmluZWQodm0uaW5jaWRlbnQuVGhlVmVoaWNsZSkgJiYgdm0uaW5jaWRlbnQuVGhlVmVoaWNsZSAhPSBudWxsKSA/IHZtLmluY2lkZW50LlRoZVZlaGljbGUuVmVoaWNsZU5hbWUgOiAnJztcclxuICAgICAgICAgICAgdm0uc2NoZWRUeXBlID0gdm0uaW5jaWRlbnQuQU1QTTtcclxuICAgICAgICAgICAgaWYgKHZtLmluY2lkZW50LkluY2lkZW50SHVicyAmJiB2bS5pbmNpZGVudC5JbmNpZGVudEh1YnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHZtLmluY2lkZW50LkluY2lkZW50SHVicywgZnVuY3Rpb24gKGh1Yikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChodWIubGF0aXR1ZGUgIT0gMCAmJiBodWIubG9uZ2l0dWRlICE9IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmh1YnMucHVzaChodWIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdm0uc2hvdyA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0TWFwKCkge1xyXG4gICAgICAgICAgICB1aUdtYXBJc1JlYWR5LnByb21pc2UoKS50aGVuKGZ1bmN0aW9uIChtYXBzKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gU3RvcERhdGFTZXJ2aWNlLmdldFZlaGljbGUodm0udmVoaWNsZUlkKVxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBNZXNzYWdlU2VydmljZS5zaG93RXJyb3IoJ1NvcnJyeSEgTWFwIGNvdWxkIG5vdCBiZSBsb2FkZWQuJylcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHZlaGljbGUpIHtcclxuICAgICAgICAgICAgICAgIHZtLmJ1c0xvY2F0aW9uID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIGxhdGl0dWRlOiBwYXJzZUZsb2F0KHZlaGljbGUuZGF0YS5NREMuTGFzdExhdGl0dWRlKSxcclxuICAgICAgICAgICAgICAgICAgICBsb25naXR1ZGU6IHBhcnNlRmxvYXQodmVoaWNsZS5kYXRhLk1EQy5MYXN0TG9uZ2l0dWRlKSxcclxuICAgICAgICAgICAgICAgICAgICBpY29uOiB7IHVybDogYnVzUGluIH1cclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQudHJpZ2dlcih2bS5tYXBDb250cm9sLmdldEdNYXAoKSwgJ3Jlc2l6ZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc2V0TWFwKClcclxuICAgICAgICAgICAgICAgIH0sIDUwKTtcclxuXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC50cmlnZ2VyKHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpLCAncmVzaXplJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc2V0TWFwKClcclxuICAgICAgICAgICAgICAgICAgICB9LCA1MCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgLy8udGhlbihmdW5jdGlvbiAocG9zaXRpb24pIHtcclxuICAgICAgICAgICAgLy8gICAgIHZtLm15TG9jYXRpb24gPSB7XHJcbiAgICAgICAgICAgIC8vICAgICAgICBjb29yZHM6IHtcclxuICAgICAgICAgICAgLy8gICAgICAgICAgICBsYXRpdHVkZTpwb3NpdGlvbi5jb29yZHMubGF0aXR1ZGUsXHJcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgbG9uZ2l0dWRlOiBwb3NpdGlvbi5jb29yZHMubG9uZ2l0dWRlXHJcbiAgICAgICAgICAgIC8vICAgICAgICB9LFxyXG4gICAgICAgICAgICAvLyAgICAgICAgaWNvbjogdm0ubXlMb2NhdGlvbkljb25cclxuICAgICAgICAgICAgLy8gICAgIH07XHJcbiAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyAgICAgJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAvLyAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnRyaWdnZXIodm0ubWFwQ29udHJvbC5nZXRHTWFwKCksICdyZXNpemUnKTtcclxuICAgICAgICAgICAgLy8gICAgICAgICByZXNldE1hcCgpXHJcbiAgICAgICAgICAgIC8vICAgICB9LCA1MCk7XHJcbiAgICAgICAgICAgIC8vfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAvLyAgICAkdGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIC8vICAgICAgICBnb29nbGUubWFwcy5ldmVudC50cmlnZ2VyKHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpLCAncmVzaXplJyk7XHJcbiAgICAgICAgICAgIC8vICAgICAgICByZXNldE1hcCgpO1xyXG4gICAgICAgICAgICAvLyAgICB9LCA1MCk7XHJcbiAgICAgICAgICAgIC8vfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBhY3RpdmF0ZSgpO1xyXG5cclxuICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xyXG4gICAgICAgICAgIGdldE1hcCgpO1xyXG5cclxuICAgICAgICAgICAgdm0ucHJvbWlzZSA9ICRpbnRlcnZhbCh1cGRhdGVWZWhpY2xlUG9zaXRpb24sIDE1MDAwKTtcclxuICAgICAgIH1cclxuXHJcbiAgICAgICB2bS4kb25EZXN0cm95ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICRpbnRlcnZhbC5jYW5jZWwodm0ucHJvbWlzZSk7XHJcbiAgICAgICB9O1xyXG4gICAgICAgZnVuY3Rpb24gcmVzZXRNYXAoKSB7XHJcbiAgICAgICAgICAgdmFyIGJvdW5kcyA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmdCb3VuZHMoKTtcclxuICAgICAgICAgICBcclxuICAgICAgICAgICBpZiAodm0uc2NoZWRUeXBlID09ICdBTScpIHtcclxuICAgICAgICAgICAgICAgaWYgKCFhbmd1bGFyLmlzVW5kZWZpbmVkKHZtLnN0b3ApICYmIHZtLnN0b3AgIT0gbnVsbCAmJiB2bS5zdG9wLmxhdGl0dWRlICE9IG51bGwgJiYgdm0uc3RvcC5sYXRpdHVkZSAhPSAwKVxyXG4gICAgICAgICAgICAgICAgICAgYm91bmRzLmV4dGVuZChuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKHZtLnN0b3AubGF0aXR1ZGUsIHZtLnN0b3AubG9uZ2l0dWRlKSk7XHJcbiAgICAgICAgICAgfVxyXG4gICAgICAgICAgIGlmICh2bS5idXNMb2NhdGlvbiAhPSBudWxsICYmIHZtLmJ1c0xvY2F0aW9uLmxhdGl0dWRlICE9IG51bGwgJiYgdm0uYnVzTG9jYXRpb24ubGF0aXR1ZGUgIT0gMClcclxuICAgICAgICAgICAgICAgYm91bmRzLmV4dGVuZChuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKHZtLmJ1c0xvY2F0aW9uLmxhdGl0dWRlLCB2bS5idXNMb2NhdGlvbi5sb25naXR1ZGUpKTtcclxuICAgICAgICAgICBpZiAodm0uc2NoZWRUeXBlID09ICdQTScpIHtcclxuICAgICAgICAgICAgICAgaWYgKHZtLmh1YnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHZtLmh1YnMsIGZ1bmN0aW9uIChodWIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICBib3VuZHMuZXh0ZW5kKG5ldyBnb29nbGUubWFwcy5MYXRMbmcoaHViLmxhdGl0dWRlLCBodWIubG9uZ2l0dWRlKSk7XHJcbiAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgIH1cclxuICAgICAgICAgICBpZiAoIWJvdW5kcy5pc0VtcHR5KCkpIHtcclxuICAgICAgICAgICAgICAgdm0ubWFwQ29udHJvbC5nZXRHTWFwKCkuZml0Qm91bmRzKGJvdW5kcyk7XHJcbiAgICAgICAgICAgICAgIHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpLnNldFpvb20odm0ubWFwQ29udHJvbC5nZXRHTWFwKCkuZ2V0Wm9vbSgpIC0gMSk7XHJcbiAgICAgICAgICAgfVxyXG4gICAgICAgICAgIC8vaWYgKHZtLmJ1c0xvY2F0aW9uICE9IG51bGwgJiYgdm0uYnVzTG9jYXRpb24ubGF0aXR1ZGUgIT0gbnVsbCAmJiB2bS5idXNMb2NhdGlvbi5sYXRpdHVkZSAhPSAwKSB7XHJcbiAgICAgICAgICAgLy8gICAgdm0uY2VudGVyID0ge1xyXG4gICAgICAgICAgIC8vICAgICAgICBsYXRpdHVkZTogdm0uYnVzTG9jYXRpb24ubGF0aXR1ZGUsXHJcbiAgICAgICAgICAgLy8gICAgICAgIGxvbmdpdHVkZTogdm0uYnVzTG9jYXRpb24ubG9uZ2l0dWRlXHJcbiAgICAgICAgICAgLy8gICAgfTtcclxuICAgICAgICAgICAvL31cclxuXHJcbiAgICAgICB9XHJcblxyXG4gICAgICAgZnVuY3Rpb24gdXBkYXRlVmVoaWNsZVBvc2l0aW9uKCkge1xyXG4gICAgICAgICAgIGlmKCRzdGF0ZS5jdXJyZW50Lm5hbWUgIT0gJ2xhc3QtbG9jYXRpb24nKVxyXG4gICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgJGludGVydmFsLmNhbmNlbCh2bS5wcm9taXNlKTtcclxuICAgICAgICAgICB9XHJcbiAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgIFN0b3BEYXRhU2VydmljZS5nZXRWZWhpY2xlKHZtLnZlaGljbGVJZCkudGhlbihmdW5jdGlvbiAodmVoaWNsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgaWYgKCFhbmd1bGFyLmlzVW5kZWZpbmVkKHZlaGljbGUuZGF0YS5NREMpICYmIHZlaGljbGUuZGF0YS5NREMgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIHZtLmJ1c0xvY2F0aW9uID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBsYXRpdHVkZTogcGFyc2VGbG9hdCh2ZWhpY2xlLmRhdGEuTURDLkxhc3RMYXRpdHVkZSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvbmdpdHVkZTogcGFyc2VGbG9hdCh2ZWhpY2xlLmRhdGEuTURDLkxhc3RMb25naXR1ZGUpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uOiB7IHVybDogYnVzUGluIH1cclxuICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgLy92bS5jZW50ZXIgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAvLyAgICBsYXRpdHVkZTogcGFyc2VGbG9hdCh2ZWhpY2xlLmRhdGEuTURDLkxhc3RMYXRpdHVkZSksXHJcbiAgICAgICAgICAgICAgICAgICAvLyAgICBsb25naXR1ZGU6IHBhcnNlRmxvYXQodmVoaWNsZS5kYXRhLk1EQy5MYXN0TG9uZ2l0dWRlKSxcclxuICAgICAgICAgICAgICAgICAgIC8vfTtcclxuICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgJGludGVydmFsLmNhbmNlbCh2bS5wcm9taXNlKTtcclxuICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgfVxyXG4gICAgICAgfVxyXG5cclxuICAgICAgICAvLyBTdGFydCBvZiBjb2RlIGZvciBJb25pY1xyXG4gICAgICAgdm0uaW9uaWNJbmNsdWRlID0gJ2FwcC9tb2R1bGVzL2NvbW11dGVyL2xvY2F0aW9uL2xhc3QtbG9jYXRpb24uaHRtbCc7XHJcbiAgICAgICB2bS5pb25pY0N1c3RvbUNsYXNzTmFtZSA9ICcnO1xyXG4gICAgICAgdm0uaW9uaWNIaWRlTmF2QmFyID0gZmFsc2U7XHJcbiAgICAgICB2bS5pb25pY1VzZVJlZnJlc2hlciA9IGZhbHNlO1xyXG4gICAgICAgIC8vIEVuZCBvZiBjb2RlIGZvciBJb25pY1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBcclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuXHQndXNlIHN0cmljdCc7XHJcblxyXG5cdGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmZhY3RvcnkoJ0xvY2F0aW9uU2VydmljZScsIExvY2F0aW9uU2VydmljZSk7XHJcblxyXG5cdExvY2F0aW9uU2VydmljZS4kaW5qZWN0ID0gWyckaHR0cCcsICckcSddO1xyXG5cclxuXHRmdW5jdGlvbiBMb2NhdGlvblNlcnZpY2UoJGh0dHAsICRxKSB7XHJcblxyXG5cdFx0dmFyIHNlcnZpY2UgPSB7XHJcblx0XHRcdGdldExvY2F0aW9uOiBnZXRMb2NhdGlvbkZyb21Hb29nbGUsXHJcblx0XHRcdGdldERyaXZpbmdEaXN0YW5jZXM6IGdldERyaXZpbmdEaXN0YW5jZXNcclxuXHJcblx0XHR9O1xyXG5cclxuXHRcdGZ1bmN0aW9uIGdldERyaXZpbmdEaXN0YW5jZXMocG9zaXRpb24sIGRlc3RpbmF0aW9ucykge1xyXG5cdFx0XHR2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG5cdFx0XHR2YXIgZGVzdHMgPSBbXTtcclxuXHRcdFx0YW5ndWxhci5mb3JFYWNoKGRlc3RpbmF0aW9ucywgZnVuY3Rpb24gKHZhbHVlLCBrZXkpIHtcclxuXHRcdFx0XHRkZXN0cy5wdXNoKHsgJ2xhdCc6IHZhbHVlLmxhdGl0dWRlLCAnbG5nJzogdmFsdWUubG9uZ2l0dWRlIH0pO1xyXG5cdFx0XHR9KTtcclxuXHJcblx0XHRcdHZhciBzZXJ2aWNlID0gbmV3IGdvb2dsZS5tYXBzLkRpc3RhbmNlTWF0cml4U2VydmljZTtcclxuXHRcdFx0c2VydmljZS5nZXREaXN0YW5jZU1hdHJpeCh7XHJcblx0XHRcdFx0b3JpZ2luczogW3sgJ2xhdCc6IHBvc2l0aW9uLmxhdGl0dWRlLCAnbG5nJzogcG9zaXRpb24ubG9uZ2l0dWRlIH1dLFxyXG5cdFx0XHRcdGRlc3RpbmF0aW9uczogZGVzdHMsXHJcblx0XHRcdFx0dHJhdmVsTW9kZTogJ0RSSVZJTkcnLFxyXG5cdFx0XHRcdHVuaXRTeXN0ZW06IGdvb2dsZS5tYXBzLlVuaXRTeXN0ZW0uTUVUUklDLFxyXG5cdFx0XHRcdGF2b2lkSGlnaHdheXM6IGZhbHNlLFxyXG5cdFx0XHRcdGF2b2lkVG9sbHM6IGZhbHNlXHJcblx0XHRcdH0sIGZ1bmN0aW9uIChyZXNwb25zZSwgc3RhdHVzKSB7XHJcblx0XHRcdFx0aWYgKHN0YXR1cyAhPT0gJ09LJykge1xyXG5cdFx0XHRcdFx0ZGVmZXJyZWQucmVqZWN0KCdDYW5ub3QgY2FsY3VsYXRlIGRpc3RhbmNlJyk7XHJcblx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSk7XHJcblx0XHRcdHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG5cclxuXHRcdH1cclxuXHJcblxyXG5cdFx0ZnVuY3Rpb24gZ2V0TG9jYXRpb25Gcm9tR29vZ2xlKHNlYXJjaFRlcm0pIHtcclxuXHRcdFx0dmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuXHRcdFx0Ly8kaHR0cC5nZXQoJ2h0dHBzOi8vbWFwcy5nb29nbGVhcGlzLmNvbS9tYXBzL2FwaS9nZW9jb2RlL2pzb24nLCB7XHJcblx0XHRcdC8vICAgIHBhcmFtczoge1xyXG5cdFx0XHQvLyAgICAgICAgYWRkcmVzczogc2VhcmNoVGVybSxcclxuXHRcdFx0Ly8gICAgICAgIHNlbnNvcjogdHJ1ZSxcclxuXHRcdFx0Ly8gICAgICAgIGtleTogJ0FJemFTeUNBNWpWZmE3c0prN09ZUl9kVWJUc1pyR0pBN0UxQWR1SSdcclxuXHRcdFx0Ly8gICAgfVxyXG5cdFx0XHQvL30pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XHJcblx0XHRcdC8vICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG5cdFx0XHQvL30sIGZ1bmN0aW9uIChlcnIpIHtcclxuXHRcdFx0Ly8gICAgZGVmZXJyZWQucmVqZWN0KGVycik7XHJcblx0XHRcdC8vfSk7XHJcblx0XHRcdC8vcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcblxyXG5cclxuXHJcblx0XHRcdHZhciBnZW9jb2RlciA9IG5ldyBnb29nbGUubWFwcy5HZW9jb2RlcjtcclxuXHRcdFx0dmFyIGFkZHJlc3MgPSBzZWFyY2hUZXJtO1xyXG5cclxuXHRcdFx0aWYgKGdlb2NvZGVyKSB7XHJcblx0XHRcdFx0Z2VvY29kZXIuZ2VvY29kZSh7ICdhZGRyZXNzJzogYWRkcmVzcyB9LCBmdW5jdGlvbiAocmVzdWx0cywgc3RhdHVzKSB7XHJcblx0XHRcdFx0XHRpZiAoc3RhdHVzID09IGdvb2dsZS5tYXBzLkdlb2NvZGVyU3RhdHVzLk9LKSB7XHJcblx0XHRcdFx0XHRcdGRlZmVycmVkLnJlc29sdmUocmVzdWx0cyk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0ZGVmZXJyZWQucmVqZWN0KHN0YXR1cyk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fSk7XHJcblxyXG5cclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlXHJcblx0XHRcdFx0ZGVmZXJyZWQucmVqZWN0KCdHZW9jb2RlciBzZXJ2aWNlIG5vdCBhdmFpbGFibGUnKTtcclxuXHRcdFx0cmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcblxyXG5cclxuXHRcdH1cclxuXHJcblxyXG5cclxuXHRcdHJldHVybiBzZXJ2aWNlO1xyXG5cclxuXHR9XHJcblxyXG5cclxuXHJcblxyXG59KSgpO1xyXG5cclxuXHJcblxyXG5cclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdNZXNzYWdlQ29udHJvbGxlcicsIE1lc3NhZ2VDb250cm9sbGVyKTtcclxuXHJcbiAgICBNZXNzYWdlQ29udHJvbGxlci4kaW5qZWN0ID0gWyckbG9jYXRpb24nLCAnJHVpYk1vZGFsSW5zdGFuY2UnLCAnbWVzc2FnZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIE1lc3NhZ2VDb250cm9sbGVyKCRsb2NhdGlvbiwgJHVpYk1vZGFsSW5zdGFuY2UsIG1lc3NhZ2UpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLnRpdGxlID0gbWVzc2FnZS50eXBlO1xyXG4gICAgICAgIHZtLmNvbnRlbnQgPSBtZXNzYWdlLm1lc3NhZ2U7XHJcblxyXG4gICAgICAgIHZtLmlzRXJyb3IgPSBmYWxzZTtcclxuICAgICAgICB2bS5pc0luZm8gPSBmYWxzZTtcclxuICAgICAgICB2bS5pc1N1Y2Nlc3MgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgdm0uY2FuY2VsID0gY2FuY2VsO1xyXG4gICAgICAgIGZ1bmN0aW9uIGNhbmNlbCgpIHtcclxuICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBzd2l0Y2ggKG1lc3NhZ2UudHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlICdFcnJvcic6XHJcbiAgICAgICAgICAgICAgICB2bS5pc0Vycm9yID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdJbmZvcm1hdGlvbic6XHJcbiAgICAgICAgICAgICAgICB2bS5pc0luZm8gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ1N1Y2Nlc3MnOlxyXG4gICAgICAgICAgICAgICAgdm0uaXNTdWNjZXNzID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5mYWN0b3J5KCdNZXNzYWdlU2VydmljZScsIE1lc3NhZ2VTZXJ2aWNlKTtcclxuXHJcbiAgICBNZXNzYWdlU2VydmljZS4kaW5qZWN0ID0gWyckaHR0cCcsICckdWliTW9kYWwnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBNZXNzYWdlU2VydmljZSgkaHR0cCwgJHVpYk1vZGFsKSB7XHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XHJcbiAgICAgICAgICAgIHNob3dFcnJvcjogc2hvd0Vycm9yLFxyXG4gICAgICAgICAgICBzaG93SW5mb3JtYXRpb246IHNob3dJbmZvcm1hdGlvbixcclxuICAgICAgICAgICAgc2hvd1N1Y2Nlc3M6IHNob3dTdWNjZXNzXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNob3dFcnJvcihtZXNzYWdlKSB7XHJcbiAgICAgICAgICAgIHNob3dNZXNzYWdlKG1lc3NhZ2UsICdFcnJvcicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBzaG93SW5mb3JtYXRpb24obWVzc2FnZSkge1xyXG4gICAgICAgICAgICBzaG93TWVzc2FnZShtZXNzYWdlLCAnSW5mb3JtYXRpb24nKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZnVuY3Rpb24gc2hvd1N1Y2Nlc3MobWVzc2FnZSkge1xyXG4gICAgICAgICAgICBzaG93TWVzc2FnZShtZXNzYWdlLCAnU3VjY2VzcycpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2hvd01lc3NhZ2UobWVzc2FnZVRvRGlzcGxheSwgdHlwZSkge1xyXG4gICAgICAgICAgICB2YXIgbWVzc2FnZU9iaiA9IHtcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2VUb0Rpc3BsYXksXHJcbiAgICAgICAgICAgICAgICB0eXBlOiB0eXBlXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHZhciBtb2RhbFJlc2VydmUgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9tb2R1bGVzL2NvbW11dGVyL21lc3NhZ2UvbWVzc2FnZS5odG1sJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdNZXNzYWdlQ29udHJvbGxlciBhcyB2bScsXHJcbiAgICAgICAgICAgICAgICBzaXplOiAnLWZzJyxcclxuICAgICAgICAgICAgICAgIGJhY2tkcm9wOiAnc3RhdGljJyxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBtZXNzYWdlT2JqXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBtb2RhbFJlc2VydmUucmVzdWx0LnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdNeVZlaGljbGVzQ29udHJvbGxlcicsIE15VmVoaWNsZXNDb250cm9sbGVyKTtcclxuXHJcbiAgICBNeVZlaGljbGVzQ29udHJvbGxlci4kaW5qZWN0ID0gWyckcm9vdFNjb3BlJywnJGxvY2F0aW9uJywgJyR1aWJNb2RhbCcsICdhdXRoU2VydmljZScsICd2ZWhpY2xlU2VydmljZScsICdNZXNzYWdlU2VydmljZScsJ0x1dW1MaW5rZWRTZXJ2aWNlJywgJ1BhZ2VTZXJ2aWNlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gTXlWZWhpY2xlc0NvbnRyb2xsZXIoJHJvb3RTY29wZSwgJGxvY2F0aW9uLCAkdWliTW9kYWwsIGF1dGhTZXJ2aWNlLCB2ZWhpY2xlU2VydmljZSwgTWVzc2FnZVNlcnZpY2UsIEx1dW1MaW5rZWRTZXJ2aWNlLCBQYWdlU2VydmljZSkge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdmFyIHBhc3NlbmdlcklkID0gYXV0aFNlcnZpY2UuYXV0aGVudGljYXRpb24ucGFzc2VuZ2VySWQ7XHJcblxyXG4gICAgICAgIHZtLnZlaGljbGVzID0gW107XHJcbiAgICAgICAgdm0udmVoaWNsZUluZm8gPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgdm0uaXNMb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgdm0uaXNSZW1vdmluZyA9IGZhbHNlO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlID0gUGFnZVNlcnZpY2U7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2Uuc2V0VGl0bGUoJ015IFZlaGljbGVzJyk7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2Uuc2V0SGVhZGxpbmUoJ01hbmFnZSBWZWhpY2xlcycpO1xyXG5cclxuICAgICAgICB2bS5hZGROZXcgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBtb2RhbFJlc2VydmUgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9tb2R1bGVzL2NvbW11dGVyL21vZGFscy9hZGQtdmVoaWNsZS1tb2RhbC9hZGQtdmVoaWNsZS5odG1sJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdBZGRWZWhpY2xlQ29udHJvbGxlciBhcyB2bScsXHJcbiAgICAgICAgICAgICAgICBiYWNrZHJvcDogJ3N0YXRpYycsXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXRsZWFzdE9uZVZlaGljbGVFeGlzdDogdm0udmVoaWNsZXMubGVuZ3RoID4gMFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgbW9kYWxSZXNlcnZlLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIGlmKHJlc3VsdC5pc0FkZGVkKVxyXG4gICAgICAgICAgICAgICAgICAgIGdldFZlaGljbGVzKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgXHJcbiAgICAgICAgXHJcbiAgICAgICAgdm0ucmVtb3ZlID0gZnVuY3Rpb24gKGlkLCBpbmRleCkge1xyXG4gICAgICAgICAgICBpZiAoaWQpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZW1vdmVWZWhpY2xlQ29uZmlybWF0aW9uID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9tb2R1bGVzL2NvbW11dGVyL21vZGFscy9yZW1vdmUtdmVoaWNsZS1tb2RhbC9yZW1vdmUtdmVoaWNsZS1jb25maXJtYXRpb24uaHRtbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1JlbW92ZVZlaGljbGVDb25maXJtYXRpb25Db250cm9sbGVyIGFzIHZtJyxcclxuICAgICAgICAgICAgICAgICAgICBzaXplOiAnLWZzJyxcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHJlbW92ZVZlaGljbGVDb25maXJtYXRpb24ucmVzdWx0LnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQucmVtb3ZlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS52ZWhpY2xlcy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5lcnJvck1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgTWVzc2FnZVNlcnZpY2Uuc2hvd0Vycm9yKHJlc3VsdC5lcnJvck1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgYWN0aXZhdGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIEx1dW1MaW5rZWRTZXJ2aWNlLnZlcmlmeShhdXRoU2VydmljZS5hdXRoZW50aWNhdGlvbi5wYXNzZW5nZXJJZCk7XHJcbiAgICAgICAgICAgIGdldFZlaGljbGVzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5tYWtlRGVmYXVsdCA9IGZ1bmN0aW9uICh2SWQsIGluZGV4KSB7XHJcbiAgICAgICAgICAgIHZlaGljbGVTZXJ2aWNlLm1hcmtEZWZhdWx0KHZJZCwgcGFzc2VuZ2VySWQpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgeyBcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKVxyXG4gICAgICAgICAgICAgICAgICAgIGdldFZlaGljbGVzKCk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgZXNzYWdlU2VydmljZS5zaG93RXJyb3IoZXJyb3IuZGF0YS5yZXN1bHQpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgZ2V0VmVoaWNsZXMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZtLmlzTG9hZGluZyA9IHRydWU7XHJcbiAgICAgICAgICAgIHZlaGljbGVTZXJ2aWNlLmdldFZlaGljbGVzRm9yUGFzc2VuZ2VyKHBhc3NlbmdlcklkKVxyXG4gICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSAmJiByZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0LnBhc3NlbmdlclZlaGljbGVzICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgIHZtLnZlaGljbGVzID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQucGFzc2VuZ2VyVmVoaWNsZXM7XHJcbiAgICAgICAgICAgICAgICAgICAgICBpZiAodm0udmVoaWNsZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkVmVoaWNsZSA9IHZtLnZlaGljbGVzWzBdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHZtLmhhc1ZlaGljbGVzID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5uZWVkc1BhcmtpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgIHZtLmlzTG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgdm0uaGFzVmVoaWNsZXMgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgdm0uaXNMb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICBhY3RpdmF0ZSgpO1xyXG5cclxuICAgICAgICAvLyBTdGFydCBvZiBjb2RlIGZvciBJb25pY1xyXG4gICAgICAgIHZtLmlvbmljSW5jbHVkZSA9ICdhcHAvbW9kdWxlcy9jb21tdXRlci9teS12ZWhpY2xlcy9teS12ZWhpY2xlcy5odG1sJztcclxuICAgICAgICB2bS5pb25pY0N1c3RvbUNsYXNzTmFtZSA9ICdpcy1teVZlaGljbGVzJztcclxuICAgICAgICB2bS5pb25pY0hpZGVOYXZCYXIgPSBmYWxzZTtcclxuICAgICAgICB2bS5pb25pY1VzZVJlZnJlc2hlciA9IHRydWU7XHJcbiAgICAgICAgdm0uaW9uaWNQdWxsaW5nVGV4dCA9ICdSZWZyZXNoIFZlaGljbGVzJztcclxuICAgICAgICB2bS5pb25pY1JlZnJlc2hpbmdUZXh0ID0gJ0xvYWRpbmcgVmVoaWNsZXMnO1xyXG4gICAgICAgIHZtLmlvbmljU3Bpbm5lciA9ICdzcGlyYWwnOyAvLyBub25lIHRvIGRpc2FibGUuXHJcbiAgICAgICAgdm0ucmVmcmVzaCA9IGZ1bmN0aW9uIChyZWZyZXNoZXIpIHtcclxuICAgICAgICAgICAgdm0uaXNMb2FkaW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgdm0udmVoaWNsZXMgPSBbXTtcclxuICAgICAgICAgICAgYWN0aXZhdGUoKTtcclxuICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdzY3JvbGwucmVmcmVzaENvbXBsZXRlJyk7XHJcbiAgICAgICAgICAgIHZtLmlzTG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBFbmQgb2YgY29kZSBmb3IgSW9uaWNcclxuICAgICAgIFxyXG5cclxuICAgIH1cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5mYWN0b3J5KCd2ZWhpY2xlU2VydmljZScsIHZlaGljbGVTZXJ2aWNlKTtcclxuXHJcbiAgICB2ZWhpY2xlU2VydmljZS4kaW5qZWN0ID0gWyckaHR0cCcsJyRxJywnZW52JywnRGl2aXNpb25TZXJ2aWNlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gdmVoaWNsZVNlcnZpY2UoJGh0dHAsICRxLCBlbnYsIERpdmlzaW9uU2VydmljZSkge1xyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgICAgICBzYXZlOiBzYXZlVmVoaWNsZSxcclxuICAgICAgICAgICAgZ2V0VmVoaWNsZXNGb3JQYXNzZW5nZXI6IGdldFZlaGljbGVzLFxyXG4gICAgICAgICAgICByZW1vdmVWZWhpY2xlOiBkZWFjdGl2YXRlVmVoaWNsZSxcclxuICAgICAgICAgICAgY2FuUGFyazogZ2V0QXZhaWxhYmxlUGFya2luZ0ZvclN0b3AsXHJcbiAgICAgICAgICAgIG1hcmtEZWZhdWx0IDptYXJrRGVmYXVsdFxyXG4gICAgICAgIH07ICAgICAgICBcclxuXHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFZlaGljbGVzKHBhc3NlbmdlcklkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cCh7IG1ldGhvZDogJ0dFVCcsICd1cmwnOiBlbnYub25lTVZBcGlVcmwgKyAnY29tbXV0ZXIvcGFzc2VuZ2Vycy8nICsgcGFzc2VuZ2VySWQgKyAnL3ZlaGljbGVzJyB9KVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikgeyBcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXJyOyB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBzYXZlVmVoaWNsZSh2ZWhpY2xlSW5mbywgcGFzc2VuZ2VySWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwKHsgZGF0YTogdmVoaWNsZUluZm8sIG1ldGhvZDogJ1BPU1QnLCAndXJsJzogZW52Lm9uZU1WQXBpVXJsICsgJ2NvbW11dGVyL3Bhc3NlbmdlcnMvJyArIHBhc3NlbmdlcklkICsgJy92ZWhpY2xlcycgfSlcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlcnI7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGRlYWN0aXZhdGVWZWhpY2xlKHZlaGljbGVJZCxwYXNzZW5nZXJJZCkgeyAgICAgICAgICAgIFxyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAoeyBtZXRob2Q6ICdQVVQnLCAndXJsJzogZW52Lm9uZU1WQXBpVXJsICsgJ2NvbW11dGVyL3Bhc3NlbmdlcnMvJyArIHBhc3NlbmdlcklkICsgJy92ZWhpY2xlcycgKyAnLycgKyB2ZWhpY2xlSWQgKyAnL2RlYWN0aXZhdGUnIH0pXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVycjtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTsgICAgICAgXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIG1hcmtEZWZhdWx0KHZlaGljbGVJZCxwYXNzZW5nZXJJZCkgeyAgICAgICAgICAgIFxyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAoeyBtZXRob2Q6ICdQVVQnLCAndXJsJzogZW52Lm9uZU1WQXBpVXJsICsgJ2NvbW11dGVyL3Bhc3NlbmdlcnMvJyArIHBhc3NlbmdlcklkICsgJy92ZWhpY2xlcycgKyAnLycgKyB2ZWhpY2xlSWQgKyAnL21hcmtEZWZhdWx0JyB9KVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlcnI7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vbW92ZSB0aGlzIG91dCB3aGlsZSB3b3JraW5nIG9uIHNlbGVjdGVkIHN0b3AgcGFnZVxyXG4gICAgICAgIGZ1bmN0aW9uIGdldEF2YWlsYWJsZVBhcmtpbmdGb3JTdG9wKHN0b3BJZCwgcmVzZXJ2YXRpb25EYXRlKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gZW52Lm9uZU1WQXBpVXJsICsgJ2NvbW11dGVyL3N0b3BzLycgKyBzdG9wSWQgKyAnL2F2YWlsYWJsZVBhcmtpbmcvJyArIHJlc2VydmF0aW9uRGF0ZTtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICAndXJsJzogc2VydmljZVVybFxyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ1B1Ymxpc2hlZFNjaGVkdWxlQ29udHJvbGxlcicsIFB1Ymxpc2hlZFNjaGVkdWxlQ29udHJvbGxlcik7XHJcblxyXG4gICAgUHVibGlzaGVkU2NoZWR1bGVDb250cm9sbGVyLiRpbmplY3QgPSBbJyRzY29wZScsICckbG9jYXRpb24nLCAnUHVibGlzaGVkU2NoZWR1bGVTZXJ2aWNlJywgJyR1aWJNb2RhbCcsICdTdG9wRGF0YVNlcnZpY2UnLFxyXG4gICAgICAgICdNZXNzYWdlU2VydmljZScsICckZmlsdGVyJywgJyRhbmNob3JTY3JvbGwnLCAnUGFnZVNlcnZpY2UnLCdPbmVNdlNlcnZpY2VzJ107XHJcblxyXG4gICAgZnVuY3Rpb24gUHVibGlzaGVkU2NoZWR1bGVDb250cm9sbGVyKCRzY29wZSwgJGxvY2F0aW9uLCBQdWJsaXNoZWRTY2hlZHVsZVNlcnZpY2UsICR1aWJNb2RhbCwgU3RvcERhdGFTZXJ2aWNlLFxyXG4gICAgICAgIE1lc3NhZ2VTZXJ2aWNlLCAkZmlsdGVyLCAkYW5jaG9yU2Nyb2xsLCBQYWdlU2VydmljZSxPbmVNdlNlcnZpY2VzKSB7XHJcblxyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2UgPSBQYWdlU2VydmljZTtcclxuICAgICAgICB2bS5QYWdlU2VydmljZS5zZXRUaXRsZSgnUHVibGlzaGVkIFNjaGVkdWxlJyk7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2Uuc2V0SGVhZGxpbmUoT25lTXZTZXJ2aWNlcy5nZXRDb21tdXRlckluZm8oKS5hbGlhcyk7XHJcblxyXG5cclxuICAgICAgICB2YXIgdG9kYXkgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgIHZhciBkZCA9IHRvZGF5LmdldERhdGUoKTtcclxuICAgICAgICB2YXIgbW0gPSB0b2RheS5nZXRNb250aCgpICsgMTtcclxuICAgICAgICB2YXIgeXl5eSA9IHRvZGF5LmdldEZ1bGxZZWFyKCk7XHJcbiAgICAgICAgdm0uZGF0ZSA9IG1tICsgJy8nICsgZGQgKyAnLycgKyB5eXl5O1xyXG4gICAgICAgIHZtLnNjaGVkdWxlQmxvY2sgPSBbXTtcclxuICAgICAgICB2bS5wdWJsaWNTY2hlZHVsZSA9IFtdO1xyXG4gICAgICAgIHZtLmFsbFNjaGRldWxlRm9yU3RvcCA9IFtdO1xyXG4gICAgICAgIHZtLnN0b3BzTGF0TG9uZyA9IFtdO1xyXG4gICAgICAgIHZtLmluY2lkZW50UmVjb3JkcyA9IFtdO1xyXG4gICAgICAgIHZtLmZ1dHVyZVJvdXRlcyA9IFtdO1xyXG4gICAgICAgIHZtLnR1cm5MYXRMb25nID0gW107XHJcbiAgICAgICAgdm0uaXNMb2FkaW5nID0gdHJ1ZTtcclxuICAgICAgICB2bS5zZWFyY2hCeSA9IFwiJFwiO1xyXG4gICAgICAgIHZtLnNlbGVjdGVkUm91dGUgPSBTdG9wRGF0YVNlcnZpY2UuZ2V0Um91dGUoKTtcclxuXHJcbiAgICAgICAgdm0uZ2V0RHJvcE9mZlBpY2tVcENsYXNzID0gZ2V0RHJvcE9mZlBpY2tVcENsYXNzO1xyXG5cclxuXHJcbiAgICAgICAgUHVibGlzaGVkU2NoZWR1bGVTZXJ2aWNlLmdldFNjaGVkdWxlcyh2bS5kYXRlKVxyXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICB2bS5pbmNpZGVudFJlY29yZHMgPSByZXNwb25zZS5kYXRhLnJlc3VsdC5yb3V0ZXM7XHJcbiAgICAgICAgICAgIHZtLmZpbHRlckNoYW5nZSgpO1xyXG4gICAgICAgICAgICB2bS5pc0xvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgIE1lc3NhZ2VTZXJ2aWNlLnNob3dFcnJvcignU29ycnkhIENvdWxkIG5vdCBsb2FkIHRoZSBzY2hlZHVsZXMhJyk7XHJcbiAgICAgICAgICAgIHZtLmlzTG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBQdWJsaXNoZWRTY2hlZHVsZVNlcnZpY2UuZ2V0VXBDb21pbmdTY2hlZHVsZXModm0uZGF0ZSlcclxuICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgdm0uZnV0dXJlUm91dGVzID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQ7XHJcbiAgICAgICAgICAgIHZtLmlzTG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy9maWx0ZXIgdXNlcnMgYmFzZWQgb24gc2VhcmNoIHJlc3VsdFxyXG4gICAgICAgIHZtLmZpbHRlckNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKHZtLnNlYXJjaFRleHQgIT0gJycgJiYgdm0uc2VhcmNoVGV4dCAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHZhciBzZXJjaFRlcm0gPSAneyBcIicgKyB2bS5zZWFyY2hCeSArICdcIiA6IFwiJyArIHZtLnNlYXJjaFRleHQgKyAnXCIgfSc7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2VyY2hUZXJtT2JqID0gSlNPTi5wYXJzZShzZXJjaFRlcm0pO1xyXG4gICAgICAgICAgICAgICAgdm0uZmlsdGVySW5jaWRlbnRzID0gJGZpbHRlcignZmlsdGVyJykodm0uaW5jaWRlbnRSZWNvcmRzLCBzZXJjaFRlcm1PYmopO1xyXG5cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZtLmZpbHRlckluY2lkZW50cyA9IHZtLmluY2lkZW50UmVjb3JkcztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgc29ydFJvdXRlcygpO1xyXG4gICAgICAgICAgICBzb3J0QXJyaXZhbHMoKTtcclxuXHJcbiAgICAgICAgICAgIGlmICh2bS5zZWxlY3RlZFJvdXRlICE9IG51bGwgJiYgdm0uc2VsZWN0ZWRSb3V0ZS5yb3V0ZUlkICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHZhciBuZXdIYXNoID0gdm0uc2VsZWN0ZWRSb3V0ZS5yb3V0ZUlkO1xyXG4gICAgICAgICAgICAgICAgaWYgKCRsb2NhdGlvbi5oYXNoKCkgIT09IG5ld0hhc2gpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBzZXQgdGhlICRsb2NhdGlvbi5oYXNoIHRvIGBuZXdIYXNoYCBhbmRcclxuICAgICAgICAgICAgICAgICAgICAvLyAkYW5jaG9yU2Nyb2xsIHdpbGwgYXV0b21hdGljYWxseSBzY3JvbGwgdG8gaXRcclxuICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24uaGFzaChuZXdIYXNoKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gY2FsbCAkYW5jaG9yU2Nyb2xsKCkgZXhwbGljaXRseSxcclxuICAgICAgICAgICAgICAgICAgICAvLyBzaW5jZSAkbG9jYXRpb24uaGFzaCBoYXNuJ3QgY2hhbmdlZFxyXG4gICAgICAgICAgICAgICAgICAgICRhbmNob3JTY3JvbGwoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNvcnRSb3V0ZXMoKSB7XHJcbiAgICAgICAgICAgIGlmICh2bS5pbmNpZGVudFJlY29yZHMpXHJcbiAgICAgICAgICAgICAgICB2bS5pbmNpZGVudFJlY29yZHMuc29ydChmdW5jdGlvbiAoYSwgYikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoYS5sb25nTmFtZS50b0xvd2VyQ2FzZSgpID4gYi5sb25nTmFtZS50b0xvd2VyQ2FzZSgpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICA/IDFcclxuICAgICAgICAgICAgICAgICAgICAgICAgOiAoKGIubG9uZ05hbWUudG9Mb3dlckNhc2UoKSA+IGEubG9uZ05hbWUudG9Mb3dlckNhc2UoKSkgPyAtMSA6IDApO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzb3J0QXJyaXZhbHMoKSB7XHJcbiAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh2bS5pbmNpZGVudFJlY29yZHMsIGZ1bmN0aW9uIChyb3V0ZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJvdXRlLnN0b3BzKVxyXG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChyb3V0ZS5zdG9wcywgZnVuY3Rpb24gKHN0b3ApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0b3AuYXJyaXZhbHMpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdG9wLmFycml2YWxzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbW9tZW50KGEsICdoOm1tIGEnKS5pc0FmdGVyKG1vbWVudChiLCAnaDptbSBhJykpID8gMSA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vbWVudChhLCAnaDptbSBhJykuaXNCZWZvcmUobW9tZW50KGIsICdoOm1tIGEnKSkgPyAtMSA6IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICB2bS5uYXZpZ2F0ZVRvU3RvcCA9IGZ1bmN0aW9uIChzZWxlY3RlZFN0b3ApIHtcclxuXHJcbiAgICAgICAgICAgIGlmIChzZWxlY3RlZFN0b3AuaXNIdWIpIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgIHZhciBzdG9wID0ge1xyXG4gICAgICAgICAgICAgICAgJ25hbWUnOiBzZWxlY3RlZFN0b3AubmFtZSxcclxuICAgICAgICAgICAgICAgICdpZCc6IHNlbGVjdGVkU3RvcC5zdG9wSWQsXHJcbiAgICAgICAgICAgICAgICAnZGlzdGFuY2UnOiBudWxsLFxyXG4gICAgICAgICAgICAgICAgJ2ljb24nOiAnaW1hZ2VzL3Bpbi1idXNzdG9wLnN2ZycsXHJcbiAgICAgICAgICAgICAgICAnbGF0aXR1ZGUnOiBzZWxlY3RlZFN0b3AubGF0aXR1ZGUsXHJcbiAgICAgICAgICAgICAgICAnbG9uZ2l0dWRlJzogc2VsZWN0ZWRTdG9wLmxvbmdpdHVkZSxcclxuICAgICAgICAgICAgICAgICdhZGRyZXNzJzogc2VsZWN0ZWRTdG9wLmFkZHJlc3NcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgU3RvcERhdGFTZXJ2aWNlLnNldFN0b3Aoc3RvcCk7XHJcbiAgICAgICAgICAgIHZhciBsb2NhdGlvbkljb24gPSB7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICdpbWFnZXMvcGluLW15LWxvY2F0aW9uLnN2ZydcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdm0ucG9zaXRpb24gPSB7XHJcbiAgICAgICAgICAgICAgICBcImNvb3Jkc1wiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgXCJsYXRpdHVkZVwiOiBzZWxlY3RlZFN0b3AubGF0aXR1ZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgXCJsb25naXR1ZGVcIjogc2VsZWN0ZWRTdG9wLmxvbmdpdHVkZVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIFwiaWNvblwiOiBsb2NhdGlvbkljb25cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgLy9pZiAodm0ucG9zaXRpb24gIT0gdW5kZWZpbmVkICYmIHZtLnBvc2l0aW9uICE9IG51bGwpXHJcbiAgICAgICAgICAgIFN0b3BEYXRhU2VydmljZS5zZXRHZW9Mb2NhdGlvbih2bS5wb3NpdGlvbilcclxuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9jb21tdXRlci9zZWxlY3RlZC1zdG9wJyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uZ2V0TWFwID0gZnVuY3Rpb24gKGluZGV4KSB7XHJcblxyXG4gICAgICAgICAgICB2bS5zdG9wc0xhdExvbmcgPSB2bS5maWx0ZXJJbmNpZGVudHNbaW5kZXhdO1xyXG5cclxuICAgICAgICAgICAgUHVibGlzaGVkU2NoZWR1bGVTZXJ2aWNlLmdldFR1cm5MYXRMbmdzKHZtLnN0b3BzTGF0TG9uZy5pZClcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcm91dGVEYXRhID0gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgICAgICAgIC8vaWYgKHJvdXRlRGF0YS5Sb3V0ZURpcjEuVmVydGljZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgdm0udHVybkxhdExvbmcgPSByb3V0ZURhdGEuUm91dGVEaXIxLlZlcnRpY2VzXHJcbiAgICAgICAgICAgICAgICAvL31cclxuICAgICAgICAgICAgICAgIC8vZWxzZVxyXG4gICAgICAgICAgICAgICAgLy97XHJcbiAgICAgICAgICAgICAgICAvLyAgICBNZXNzYWdlU2VydmljZS5zaG93RXJyb3IoJ1NvcnJ5ISBDb3VsZCBub3QgbG9hZCB0aGUgbWFwLCBjYW5ub3QgZmluZCB0aGUgc3RvcHMuJyk7XHJcbiAgICAgICAgICAgICAgICAvL31cclxuICAgICAgICAgICAgICAgIG1hcFBhZ2Uocm91dGVEYXRhKTtcclxuXHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uZ2V0RnV0dXJlUm91dGVNYXAgPSBmdW5jdGlvbiAocm91dGUpIHtcclxuXHJcbiAgICAgICAgICAgIHZtLnN0b3BzTGF0TG9uZyA9IHJvdXRlO1xyXG5cclxuICAgICAgICAgICAgUHVibGlzaGVkU2NoZWR1bGVTZXJ2aWNlLmdldFR1cm5MYXRMbmdzKHZtLnN0b3BzTGF0TG9uZy5Sb3V0ZUlkKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIHZhciByb3V0ZURhdGEgPSByZXNwb25zZS5kYXRhO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICAvL2Vsc2VcclxuICAgICAgICAgICAgICAgIC8ve1xyXG4gICAgICAgICAgICAgICAgLy8gICAgTWVzc2FnZVNlcnZpY2Uuc2hvd0Vycm9yKCdTb3JyeSEgQ291bGQgbm90IGxvYWQgdGhlIG1hcCwgY2Fubm90IGZpbmQgdGhlIHN0b3BzLicpO1xyXG4gICAgICAgICAgICAgICAgLy99XHJcbiAgICAgICAgICAgICAgICBtYXBQYWdlKHJvdXRlRGF0YSk7XHJcblxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIG1hcFBhZ2Uocm91dGVEYXRhKSB7XHJcbiAgICAgICAgICAgIHZhciBtb2RhbEdldE1hcCA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIHdpbmRvd0NsYXNzOiAnbWFwLW1vZGFsJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL21vZHVsZXMvY29tbXV0ZXIvbW9kYWxzL3N0b3BzLW1hcC1tb2RhbC9zdG9wcy1tYXAuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnU3RvcHNNYXBDb250cm9sbGVyIGFzIHZtJyxcclxuICAgICAgICAgICAgICAgIGJhY2tkcm9wOiAnc3RhdGljJyxcclxuICAgICAgICAgICAgICAgIHNpemU6ICctZnMnLFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjaGVkdWxlX3N0b3BzOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2bS5zdG9wc0xhdExvbmc7XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICByb3V0ZURhdGE6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJvdXRlRGF0YTtcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBtb2RhbEdldE1hcC5yZXN1bHQudGhlbihmdW5jdGlvbiAoaXNEb25lKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXNEb25lKSB7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBhY3RpdmF0ZSgpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHsgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXREcm9wT2ZmUGlja1VwQ2xhc3MoaXNBTSwgaXNIdWIpIHtcclxuICAgICAgICAgICAgdmFyIGNsYXNzTmFtZTtcclxuICAgICAgICAgICAgaWYgKGlzQU0pIHtcclxuICAgICAgICAgICAgICAgIGlmIChpc0h1YilcclxuICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWUgPSAnZHJvcG9mZic7XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lID0gJ3BpY2t1cCc7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXNIdWIpXHJcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lID0gJ3BpY2t1cCc7XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lID0gJ2Ryb3BvZmYnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBjbGFzc05hbWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkc2NvcGUuJG9uKCckbG9jYXRpb25DaGFuZ2VTdGFydCcsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICBTdG9wRGF0YVNlcnZpY2Uuc2V0Um91dGUobnVsbCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy8gU3RhcnQgb2YgY29kZSBmb3IgSW9uaWNcclxuICAgICAgICB2bS5pb25pY0luY2x1ZGUgPSAnYXBwL21vZHVsZXMvY29tbXV0ZXIvcHVibGlzaGVkLXNjaGVkdWxlL3B1Ymxpc2hlZC1zY2hlZHVsZS5odG1sJztcclxuICAgICAgICB2bS5pb25pY0N1c3RvbUNsYXNzTmFtZSA9ICcnO1xyXG4gICAgICAgIHZtLmlvbmljVXNlUmVmcmVzaGVyID0gdHJ1ZTtcclxuICAgICAgICB2bS5pb25pY1B1bGxpbmdUZXh0ID0gJ1JlZnJlc2ggU2NoZWR1bGUnO1xyXG4gICAgICAgIHZtLmlvbmljUmVmcmVzaGluZ1RleHQgPSAnTG9hZGluZyBTY2hlZHVsZSc7XHJcbiAgICAgICAgdm0uaW9uaWNTcGlubmVyID0gJ3NwaXJhbCc7IC8vIG5vbmUgdG8gZGlzYWJsZS5cclxuICAgICAgICB2bS5yZWZyZXNoID0gZnVuY3Rpb24gKHJlZnJlc2hlcikge1xyXG4gICAgICAgICAgICBhY3RpdmF0ZSgpO1xyXG4gICAgICAgICAgICAkc2NvcGUuJGJyb2FkY2FzdCgnc2Nyb2xsLnJlZnJlc2hDb21wbGV0ZScpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBFbmQgb2YgY29kZSBmb3IgSW9uaWNcclxuXHJcbiAgICB9XHJcbn0pKCk7XHJcblxyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmZhY3RvcnkoJ1B1Ymxpc2hlZFNjaGVkdWxlU2VydmljZScsIFB1Ymxpc2hlZFNjaGVkdWxlU2VydmljZSk7XHJcblxyXG4gICAgUHVibGlzaGVkU2NoZWR1bGVTZXJ2aWNlLiRpbmplY3QgPSBbJyRodHRwJywgJyRxJywgJ2VudicsJ0RpdmlzaW9uU2VydmljZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIFB1Ymxpc2hlZFNjaGVkdWxlU2VydmljZSgkaHR0cCwgJHEsIGVudiwgRGl2aXNpb25TZXJ2aWNlKSB7XHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XHJcbiAgICAgICAgICAgIGdldFNjaGVkdWxlczogZ2V0U2NoZWR1bGVzLFxyXG4gICAgICAgICAgICBnZXRJbmNpZGVudHM6IGdldEluY2lkZW50cyxcclxuICAgICAgICAgICAgZ2V0QWxsU2NoZWR1bGVGb3JTdG9wOiBnZXRBbGxTY2hlZHVsZUZvclN0b3AsXHJcbiAgICAgICAgICAgIGdldFR1cm5MYXRMbmdzOiBnZXRUdXJuTGF0TG5ncyxcclxuICAgICAgICAgICAgZ2V0VXBDb21pbmdTY2hlZHVsZXM6IGdldFVwQ29taW5nU2NoZWR1bGVzXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFNjaGVkdWxlcyhkYXRlKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIC8vZ2V0IHRoZSBiYXNlIHVybCBmcm9tIGNvbmZpZy5cclxuICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBlbnYub25lTVZBcGlVcmwgKyAnY29tbXV0ZXIvJyArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCkgKyAnL3NjaGVkdWxlL3B1Ymxpc2hlZCc7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICAndXJsJzogc2VydmljZVVybFxyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRVcENvbWluZ1NjaGVkdWxlcyhkYXRlKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIC8vZ2V0IHRoZSBiYXNlIHVybCBmcm9tIGNvbmZpZy5cclxuICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBlbnYub25lTVZBcGlVcmwgKyAnY29tbXV0ZXIvJyArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCkgKyAnL3NjaGVkdWxlL3VwY29taW5nJztcclxuICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICd1cmwnOiBzZXJ2aWNlVXJsXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycilcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFR1cm5MYXRMbmdzKHJvdXRlSWQpIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgLy9nZXQgdGhlIGJhc2UgdXJsIGZyb20gY29uZmlnLlxyXG4gICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5vbmVNVkZpeGVkUm91dGVBcGlVcmwgKyAncm91dGUvc2hhcGVzQnlSb3V0ZS8nICsgcm91dGVJZCArICcvMjA2JzsvLyArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCk7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICAndXJsJzogc2VydmljZVVybFxyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRJbmNpZGVudHMoYmxvY2tJZCwgbWluSW5jSWQsIGluY0NvdW50KSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIHZhciBpbmNsdWRlU3RvcHMgPSB0cnVlO1xyXG4gICAgICAgICAgICAvL2dldCB0aGUgYmFzZSB1cmwgZnJvbSBjb25maWcuXHJcbiAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gZW52LmNvbW11dGVyQXBpVXJsICsgJ2NvbW1vbi8nICsgRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKSArICcvaW5jaWRlbnRzLycgKyBibG9ja0lkO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgJ3VybCc6IHNlcnZpY2VVcmxcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0QWxsU2NoZWR1bGVGb3JTdG9wKHN0b3BJZCwgcm91dGVJZCkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICB2YXIgcm91dGVJZCA9IDA7XHJcbiAgICAgICAgICAgIC8vZ2V0IHRoZSBiYXNlIHVybCBmcm9tIGNvbmZpZy5cclxuICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBlbnYuY29tbXV0ZXJBcGlVcmwgKyAnY29tbW9uLycgKyBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpICsgJy9zdG9wLycgKyBzdG9wSWQgKyAnP1JvdXRlSWQ9JyArIHJvdXRlSWQ7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICAndXJsJzogc2VydmljZVVybFxyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ1NjaGVkdWxlQ29udHJvbGxlcicsIFNjaGVkdWxlQ29udHJvbGxlcik7XHJcblxyXG4gICAgU2NoZWR1bGVDb250cm9sbGVyLiRpbmplY3QgPSBbJyRsb2NhdGlvbicsICckc3RhdGVQYXJhbXMnLCAnJHVpYk1vZGFsJyxcclxuICAgICAgICAnU2NoZWR1bGVTZXJ2aWNlJywgJ2VudicsICdTdG9wRGF0YVNlcnZpY2UnLCAndWlHbWFwSXNSZWFkeScsICdSZXNlcnZhdGlvblNlcnZpY2UnLCdEaXZpc2lvblNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBTY2hlZHVsZUNvbnRyb2xsZXIoJGxvY2F0aW9uLCAkc3RhdGVQYXJhbXMsICR1aWJNb2RhbCxcclxuICAgICAgICBTY2hlZHVsZVNlcnZpY2UsIGVudiwgU3RvcERhdGFTZXJ2aWNlLCB1aUdtYXBJc1JlYWR5LCBSZXNlcnZhdGlvblNlcnZpY2UsIERpdmlzaW9uU2VydmljZSkge1xyXG4gICAgICAgIFxyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcblxyXG4gICAgICAgIHZtLnVzZXJJZCA9ICdiMWM1N2RmMy03NjA0LTQ3ZWItYmY1MS0zMTczMzJhOWY2YTAnIC8vaGFyZC1jb2RpbmcuIFdhaXRpbmcgZm9yIHNvY2lhbCBsb2dpbiB0YXNrIHRvIGdldCBvdmVyXHJcblxyXG4gICAgICAgIC8vZGVmYXVsdCB2YWx1ZXMgc2V0LXVwXHJcbiAgICAgICAgdm0uU2NoZWR1bGVUeXBlID0gXCJBTVwiO1xyXG5cclxuICAgICAgICAvL2Z1bmN0aW9ucyBleHBvc2VkIHRvIHZpZXdcclxuICAgICAgICB2bS5yZXNlcnZlID0gcmVzZXJ2ZTtcclxuICAgICAgICB2bS5jYW5jZWxSZXNlcnZhdGlvbiA9IGNhbmNlbFJlc2VydmF0aW9uO1xyXG4gICAgICAgIHZtLmNoYW5nZVNjaGVkdWxlID0gY2hhbmdlU2NoZWR1bGU7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy92bS5zZWxlY3RlZFN0b3AgPSBTdG9wRGF0YVNlcnZpY2UuZ2V0U3RvcCgpO1xyXG4gICAgICAgIHZtLnNlbGVjdGVkU3RvcCA9IHsgXCJuYW1lXCI6IFwiVGVzdCBTdG9wIDFcIiwgXCJpZFwiOiAxNTIxMzExNDUsIFwiZGlzdGFuY2VcIjogbnVsbCwgXCJpY29uXCI6IHsgXCJ1cmxcIjogXCJpbWFnZXMvcGluLWJ1c3N0b3AtZ3JleS5zdmdcIiB9LCBcImxhdGl0dWRlXCI6IDQzLjc1NTE0MjIxMTkxNDA2LCBcImxvbmdpdHVkZVwiOiAtMTE2LjU3NTk3MzUxMDc0MjE5LCBcIiQkaGFzaEtleVwiOiBcIm9iamVjdDoxMTNcIiB9O1xyXG4gICAgICAgIHZhciBjdXJyZW50TG9jYXRpb24gPSBTdG9wRGF0YVNlcnZpY2UuZ2V0R2VvTG9jYXRpb24oKTtcclxuICAgICAgICB2bS5mcm9tTG9jYXRpb24gPSBjdXJyZW50TG9jYXRpb24gIT1udWxsID8gY3VycmVudExvY2F0aW9uLmNvb3Jkcy5sYXRpdHVkZSArICcsJyArIGN1cnJlbnRMb2NhdGlvbi5jb29yZHMubG9uZ2l0dWRlIDogJyc7XHJcblxyXG4gICAgICAgIHZtLmNlbnRlciA9IHtcclxuICAgICAgICAgICAgbGF0aXR1ZGU6IDQwLjY1MTczOSxcclxuICAgICAgICAgICAgbG9uZ2l0dWRlOiAtNzMuOTUzMTQ4XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uem9vbSA9IDEwO1xyXG4gICAgICAgIHZtLm1hcENvbnRyb2wgPSB7fTtcclxuICAgICAgICB2bS5vcHRpb25zID0ge307XHJcbiAgICAgICAgdm0ubWFya2VyRXZlbnRzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAvL2ZvciBmdXR1cmU/XHJcbiAgICAgICAgfTtcclxuICAgICAgICB2bS5zaG93RGlyZWN0aW9ucyA9IGN1cnJlbnRMb2NhdGlvbiA9PSBudWxsO1xyXG5cclxuICAgICAgICB2YXIgYm91bmRzID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZ0JvdW5kcygpO1xyXG5cclxuXHJcbiAgICAgICAgdWlHbWFwSXNSZWFkeS5wcm9taXNlKCkudGhlbihmdW5jdGlvbiAobWFwcykgeyAgICAgICBcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmKHZtLnNob3dEaXJlY3Rpb25zKXtcclxuICAgICAgICAgICAgICAgIGJvdW5kcy5leHRlbmQobmV3IGdvb2dsZS5tYXBzLkxhdExuZyh2bS5zZWxlY3RlZFN0b3AubGF0aXR1ZGUsIHZtLnNlbGVjdGVkU3RvcC5sb25naXR1ZGUpKTtcclxuICAgICAgICAgICAgICAgIHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpLmZpdEJvdW5kcyhib3VuZHMpO1xyXG4gICAgICAgICAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQudHJpZ2dlcih2bS5tYXBDb250cm9sLmdldEdNYXAoKSwgXCJyZXNpemVcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZXtcclxuICAgICAgICAgICAgICAgIG1hcERpcmVjdGlvbih2bS5mcm9tTG9jYXRpb24pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgbG9hZEluY2lkZW50cygpO1xyXG5cclxuICAgICAgICB2bS5nZXREaXJlY3Rpb24gPSBmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgZ2VvY29kZXIgPSBuZXcgZ29vZ2xlLm1hcHMuR2VvY29kZXI7XHJcbiAgICAgICAgICAgIGdlb2NvZGVyLmdlb2NvZGUoeyAnYWRkcmVzcyc6IHZtLmZyb21Mb2NhdGlvbiB9LFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKHJlc3BvbnNlLCBzdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09PSBnb29nbGUubWFwcy5HZW9jb2RlclN0YXR1cy5PSykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXBEaXJlY3Rpb24ocmVzcG9uc2VbMF0uZ2VvbWV0cnkubG9jYXRpb24ubGF0KCkgKyAnLCcgKyByZXNwb25zZVswXS5nZW9tZXRyeS5sb2NhdGlvbi5sbmcoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7ICAgICAgICAgICAgXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIG1hcERpcmVjdGlvbiA9IGZ1bmN0aW9uIChzdGFydCkge1xyXG5cclxuICAgICAgICAgICAgdmFyIGRpcmVjdGlvbnNEaXNwbGF5ID0gbmV3IGdvb2dsZS5tYXBzLkRpcmVjdGlvbnNSZW5kZXJlcjtcclxuICAgICAgICAgICAgdmFyIGRpcmVjdGlvbnNTZXJ2aWNlID0gbmV3IGdvb2dsZS5tYXBzLkRpcmVjdGlvbnNTZXJ2aWNlO1xyXG4gICAgICAgICAgICB2YXIgZGlyZWN0aW9ucyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaXJlY3Rpb25zJyk7XHJcbiAgICAgICAgICAgIGRpcmVjdGlvbnNEaXNwbGF5LnNldFBhbmVsKGRpcmVjdGlvbnMpO1xyXG5cclxuICAgICAgICAgICAgZGlyZWN0aW9uc1NlcnZpY2Uucm91dGUoe1xyXG4gICAgICAgICAgICAgICAgb3JpZ2luOiBzdGFydCxcclxuICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uOiB2bS5zZWxlY3RlZFN0b3AubGF0aXR1ZGUgKyAnLCcgKyB2bS5zZWxlY3RlZFN0b3AubG9uZ2l0dWRlLFxyXG4gICAgICAgICAgICAgICAgdHJhdmVsTW9kZTogZ29vZ2xlLm1hcHMuRGlyZWN0aW9uc1RyYXZlbE1vZGUuRFJJVklOR1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVzcG9uc2UsIHN0YXR1cykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gJ09LJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbnNEaXNwbGF5LnNldERpcmVjdGlvbnMocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbnNEaXNwbGF5LnNldE1hcCh2bS5tYXBDb250cm9sLmdldEdNYXAoKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cuYWxlcnQoJ0RpcmVjdGlvbnMgcmVxdWVzdCBmYWlsZWQgZHVlIHRvICcgKyBzdGF0dXMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgdm0ubmF2aWdhdGVUb1RyaXBQYWdlID0gZnVuY3Rpb24gKGluZGV4KSB7XHJcbiAgICAgICAgICAgIHZhciBpbmNpZGVudCA9IHZtLm5vblBlcmZvcm1lZEluY2lkZW50c1tpbmRleF07XHJcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvY29tbXV0ZXIvc2VsZWN0ZWQtdHJpcC8nICsgRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKSArICcvJyArIGluY2lkZW50LkJsb2NrSWQgKyAnLycgKyBpbmNpZGVudC5JbmNpZGVudElkKTtcclxuICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgXHJcbiAgICAgICAgZnVuY3Rpb24gbG9hZEluY2lkZW50cygpIHtcclxuICAgICAgICAgICAgU2NoZWR1bGVTZXJ2aWNlLmdldFNjaGVkdWxlKCB2bS5zZWxlY3RlZFN0b3AuaWQsIHZtLnVzZXJJZCwgMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0ubm9uUGVyZm9ybWVkSW5jaWRlbnRzID0gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiByZXNlcnZlKGluY2lkZW50VG9SZXNlcnZlKSB7XHJcbiAgICAgICAgICAgIC8vYWxlcnQoaW5jaWRlbnRUb1Jlc2VydmUuVmVoaWNsZS5WZWhpY2xlTmFtZSk7XHJcbiAgICAgICAgICAgIHZhciBtb2RhbFJlc2VydmUgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9tb2R1bGVzL2NvbW11dGVyL21vZGFscy9yZXNlcnZhdGlvbi1tb2RhbC9yZXNlcnZhdGlvbi5odG1sJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdSZXNlcnZhdGlvbkNvbnRyb2xsZXIgYXMgdm0nLFxyXG4gICAgICAgICAgICAgICAgc2l6ZTogJycsXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5jaWRlbnRUb1Jlc2VydmU6IGluY2lkZW50VG9SZXNlcnZlLFxyXG4gICAgICAgICAgICAgICAgICAgIGlzQWRkOiB0cnVlXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBtb2RhbFJlc2VydmUucmVzdWx0LnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgLy9yZWZyZXNoIHRoZSBncmlkIHRvIHNob3cgdGhlIGluY2lkZW50IGFzIHJlc2VydmVkXHJcbiAgICAgICAgICAgICAgICBsb2FkSW5jaWRlbnRzKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNhbmNlbFJlc2VydmF0aW9uKGluY2lkZW50VG9DYW5jZWwpIHtcclxuICAgICAgICAgICAgdmFyIF9yZXNlcnZhdGlvbiA9IGluY2lkZW50VG9DYW5jZWwuVGhlUmVzZXJ2YXRpb247XHJcbiAgICAgICAgICAgIFJlc2VydmF0aW9uU2VydmljZS5jYW5jZWxSZXNlcnZhdGlvbihfcmVzZXJ2YXRpb24uSWQpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLmRhdGEgJiYgcmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGFsZXJ0KCdSZXNlcnZhdGlvbiBDYW5jZWxsZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICBsb2FkSW5jaWRlbnRzKCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGFsZXJ0KHJlc3BvbnNlLmRhdGEubWVzc2FnZSlcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNoYW5nZVNjaGVkdWxlKCkge1xyXG4gICAgICAgICAgICAvL2FsZXJ0KHZtLlNjaGVkdWxlVHlwZSk7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdTZWxlY3RlZFRyaXBDb250cm9sbGVyJywgU2VsZWN0ZWRUcmlwQ29udHJvbGxlcik7XHJcblxyXG4gICAgU2VsZWN0ZWRUcmlwQ29udHJvbGxlci4kaW5qZWN0ID0gWydTZWxlY3RlZFRyaXBTZXJ2aWNlJywnJHN0YXRlUGFyYW1zJywgJ3VpR21hcElzUmVhZHknXTtcclxuXHJcbiAgICBmdW5jdGlvbiBTZWxlY3RlZFRyaXBDb250cm9sbGVyKFNlbGVjdGVkVHJpcFNlcnZpY2UsICRzdGF0ZVBhcmFtcywgdWlHbWFwSXNSZWFkeSkge1xyXG4gICAgICAgIC8qIGpzaGludCB2YWxpZHRoaXM6dHJ1ZSAqL1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdm0udGl0bGUgPSAnU2VsZWN0ZWQgVHJpcCc7XHJcbiAgICAgICAgdmFyIHN0b3BJZCA9ICRzdGF0ZVBhcmFtcy5zdG9wSWQ7XHJcbiAgICAgICAgdmFyIHN0YXJ0TG9jYXRpb24gPSB7fTtcclxuICAgICAgICB2YXIgZW5kTG9jYXRpb24gPSB7fTtcclxuICAgICAgICB2bS5jZW50ZXIgPSB7XHJcbiAgICAgICAgICAgIGxhdGl0dWRlOiA0MC42NTE3MzksXHJcbiAgICAgICAgICAgIGxvbmdpdHVkZTogLTczLjk1MzE0OFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLnpvb20gPSAxMDtcclxuICAgICAgICB2bS5tYXBDb250cm9sID0ge307XHJcbiAgICAgICAgdm0uc3RvcHNNYXJrZXJBcnJheSA9IFtdO1xyXG5cclxuICAgICAgICAvL2dldE1hcCgpO1xyXG5cclxuICAgICAgICAvL2Z1bmN0aW9uIGdldE1hcCgpIHtcclxuICAgICAgICAvLyAgICB2YXIgbWFwT3B0aW9ucyA9IHtcclxuICAgICAgICAvLyAgICAgICAgem9vbTogdm0uem9vbSxcclxuICAgICAgICAvLyAgICAgICAgY2VudGVyOiB2bS5jZW50ZXIsXHJcbiAgICAgICAgLy8gICAgICAgIG1hcFR5cGVJZDogZ29vZ2xlLm1hcHMuTWFwVHlwZUlkLlJPQURNQVBcclxuICAgICAgICAvLyAgICB9XHJcbiAgICAgICAgLy8gICAgdm0ubWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyksIG1hcE9wdGlvbnMpO1xyXG4gICAgICAgIC8vfTtcclxuXHJcbiAgICAgICAgdWlHbWFwSXNSZWFkeS5wcm9taXNlKCkudGhlbihmdW5jdGlvbiAobWFwcykgeyAgXHJcbiAgICAgICAgICAgIC8vdm0ubWFwQ29udHJvbC5nZXRHTWFwKCkuZml0Qm91bmRzKGJvdW5kcyk7XHJcbiAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnRyaWdnZXIodm0ubWFwQ29udHJvbC5nZXRHTWFwKCksIFwicmVzaXplXCIpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBTZWxlY3RlZFRyaXBTZXJ2aWNlLmdldFRyaXBzKCRzdGF0ZVBhcmFtcy5ibG9ja0lkLCAkc3RhdGVQYXJhbXMubWluSW5jSWQsIDUpXHJcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIHZtLnVwQ29taW5nU3RvcHMgPSByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgICAgICBlbmRMb2NhdGlvbiA9IHZtLnVwQ29taW5nU3RvcHMuc2xpY2UoLTEpWzBdO1xyXG4gICAgICAgICAgICB2bS5lbmRTdG9wbG9jYXRpb24gPSBlbmRMb2NhdGlvbi5UaGVTdG9wO1xyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2bS51cENvbWluZ1N0b3BzLmxlbmd0aDsgaSsrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZiAodm0udXBDb21pbmdTdG9wc1tpXS5UaGVTdG9wLlN0b3BJZCA9PSBzdG9wSWQpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uc3RhcnRTdG9wTG9jYXRpb24gPSB2bS51cENvbWluZ1N0b3BzW2ldLlRoZVN0b3A7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodm0udXBDb21pbmdTdG9wc1tpXS5UaGVTdG9wLlN0b3BJZCAhPSB2bS5lbmRTdG9wbG9jYXRpb24uU3RvcElkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnN0b3BzTWFya2VycyA9IHsgbGF0OiB2bS51cENvbWluZ1N0b3BzW2ldLlRoZVN0b3AuTGF0aXR1ZGUsIGxuZzogdm0udXBDb21pbmdTdG9wc1tpXS5UaGVTdG9wLkxvbmdpdHVkZSB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnN0b3BzTWFya2VyQXJyYXkucHVzaCh7J2xvY2F0aW9uJyA6IHZtLnN0b3BzTWFya2VycywgJ3N0b3BvdmVyJyA6IGZhbHNlfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBtYXBEaXJlY3Rpb24oKTtcclxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgIC8vYWxlcnQoZXJyKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdmFyIG1hcERpcmVjdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHN0YXJ0ID0gdm0uc3RhcnRTdG9wTG9jYXRpb24uTGF0aXR1ZGUgKyAnLCcgKyB2bS5zdGFydFN0b3BMb2NhdGlvbi5Mb25naXR1ZGU7XHJcbiAgICAgICAgICAgIHZhciBlbmQgPSB2bS5lbmRTdG9wbG9jYXRpb24uTGF0aXR1ZGUgKyAnLCcgKyB2bS5lbmRTdG9wbG9jYXRpb24uTG9uZ2l0dWRlO1xyXG4gICAgICAgICAgICB2YXIgZGlyZWN0aW9uc0Rpc3BsYXkgPSBuZXcgZ29vZ2xlLm1hcHMuRGlyZWN0aW9uc1JlbmRlcmVyKHtcclxuICAgICAgICAgICAgICAgIHN1cHByZXNzTWFya2VyczogdHJ1ZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdmFyIGRpcmVjdGlvbnNTZXJ2aWNlID0gbmV3IGdvb2dsZS5tYXBzLkRpcmVjdGlvbnNTZXJ2aWNlOyAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB2bS5zdG9wc01hcmtlckFycmF5LnNwbGljZSgtMSwgMSk7XHJcbiAgICAgICAgICAgIGRpcmVjdGlvbnNTZXJ2aWNlLnJvdXRlKHtcclxuICAgICAgICAgICAgICAgIG9yaWdpbjogc3RhcnQsXHJcbiAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbjogZW5kLFxyXG4gICAgICAgICAgICAgICAgd2F5cG9pbnRzOiB2bS5zdG9wc01hcmtlckFycmF5LFxyXG4gICAgICAgICAgICAgICAgdHJhdmVsTW9kZTogZ29vZ2xlLm1hcHMuRGlyZWN0aW9uc1RyYXZlbE1vZGUuRFJJVklOR1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVzcG9uc2UsIHN0YXR1cykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gJ09LJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbnNEaXNwbGF5LnNldERpcmVjdGlvbnMocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbnNEaXNwbGF5LnNldE1hcCh2bS5tYXBDb250cm9sLmdldEdNYXAoKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cuYWxlcnQoJ0RpcmVjdGlvbnMgcmVxdWVzdCBmYWlsZWQgZHVlIHRvICcgKyBzdGF0dXMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG59KSgpO1xyXG5cclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5mYWN0b3J5KCdTZWxlY3RlZFRyaXBTZXJ2aWNlJywgU2VsZWN0ZWRUcmlwU2VydmljZSk7XHJcblxyXG4gICAgU2VsZWN0ZWRUcmlwU2VydmljZS4kaW5qZWN0ID0gWyckaHR0cCcsICckcScsJ2VudicsJ0RpdmlzaW9uU2VydmljZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIFNlbGVjdGVkVHJpcFNlcnZpY2UoJGh0dHAsICRxLCBlbnYsIERpdmlzaW9uU2VydmljZSkge1xyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgICAgICBnZXRUcmlwczogZ2V0VHJpcHNcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0VHJpcHMoYmxvY2tJZCwgbWluSW5jSWQsIGluY0NvdW50KSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIC8vZ2V0IHRoZSBiYXNlIHVybCBmcm9tIGNvbmZpZy5cclxuICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBlbnYuY29tbXV0ZXJBcGlVcmwgKyAnY29tbW9uJyArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCkgKyAnL2luY2lkZW50cy8nICsgYmxvY2tJZCArICc/bWluSW5jSWQ9JyArIG1pbkluY0lkICsgJyZpbmNDb3VudD0nICsgaW5jQ291bnQ7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICAndXJsJzogc2VydmljZVVybFxyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5kaXJlY3RpdmUoJ3NlYXRBdmFpbGFiaWxpdHknLCBzZWF0QXZhaWxhYmlsaXR5KTtcclxuXHJcbiAgICBzZWF0QXZhaWxhYmlsaXR5LiRpbmplY3QgPSBbXTtcclxuXHJcbiAgICBmdW5jdGlvbiBzZWF0QXZhaWxhYmlsaXR5KCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgICAgICBkaXZpc2lvbkFsbG93c1dhaXRsaXN0OiAnPScsXHJcbiAgICAgICAgICAgICAgICB0cmlwOic9J1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9tb2R1bGVzL2NvbW11dGVyL3N0b3Avc2VhdC1hdmFpbGFiaWxpdHkuY29tcG9uZW50Lmh0bWwnXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdTZWxlY3RlZFN0b3BDb250cm9sbGVyJywgU2VsZWN0ZWRTdG9wQ29udHJvbGxlcik7XHJcblxyXG4gICAgU2VsZWN0ZWRTdG9wQ29udHJvbGxlci4kaW5qZWN0ID0gWyckbG9jYXRpb24nLCAnJHJvb3RTY29wZScsICckc2NvcGUnLCAnJHVpYk1vZGFsJywgJyRpbnRlcnZhbCcsICckc3RhdGUnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdTdG9wRGF0YVNlcnZpY2UnLCAnUmVzZXJ2YXRpb25TZXJ2aWNlJywgJ2F1dGhTZXJ2aWNlJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0RpdmlzaW9uU2VydmljZScsICdNYXBTZXJ2aWNlJywgJ0NvbW1vblNlcnZpY2UnLCAnTWFwSWNvblNlcnZpY2UnLCAnUGFnZVNlcnZpY2UnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnVmVoaWNsZURhdGFTZXJ2aWNlJywgJ1NjaGVkdWxlU2VydmljZScsICdMdXVtTGlua2VkU2VydmljZScsJ09uZU12U2VydmljZXMnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBTZWxlY3RlZFN0b3BDb250cm9sbGVyKCRsb2NhdGlvbiwgJHJvb3RTY29wZSwgJHNjb3BlLCAkdWliTW9kYWwsICRpbnRlcnZhbCwgJHN0YXRlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdG9wRGF0YVNlcnZpY2UsIFJlc2VydmF0aW9uU2VydmljZSwgYXV0aFNlcnZpY2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERpdmlzaW9uU2VydmljZSwgTWFwU2VydmljZSwgQ29tbW9uU2VydmljZSwgTWFwSWNvblNlcnZpY2UsIFBhZ2VTZXJ2aWNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBWZWhpY2xlRGF0YVNlcnZpY2UsIFNjaGVkdWxlU2VydmljZSwgTHV1bUxpbmtlZFNlcnZpY2UsT25lTXZTZXJ2aWNlcykge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdm0uc2VsZWN0ZWRTdG9wID0gU3RvcERhdGFTZXJ2aWNlLmdldFN0b3AoKTtcclxuICAgICAgICB2bS5QYWdlU2VydmljZSA9IFBhZ2VTZXJ2aWNlO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlLnNldFRpdGxlKHZtLnNlbGVjdGVkU3RvcC5uYW1lKTtcclxuICAgICAgICB2bS5QYWdlU2VydmljZS5zZXRIZWFkbGluZShPbmVNdlNlcnZpY2VzLmdldENvbW11dGVySW5mbygpLmFsaWFzKTtcclxuXHJcbiAgICAgICAgdm0uaHVicyA9IFtdO1xyXG4gICAgICAgIHZtLnNlbGVjdGVkSHViID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHZtLmF2YWlsYWJsZVBhcmtpbmcgPSAwO1xyXG4gICAgICAgIHZtLm5vblBlcmZvcm1lZFRyaXBzID0gW107XHJcbiAgICAgICAgdm0uc2hvdyA9IGZhbHNlO1xyXG4gICAgICAgIHZtLmNhbGVuZGFyT3BlbmVkID0gZmFsc2U7XHJcbiAgICAgICAgdm0ucGFzc2VuZ2VyUmVzZXJ2YXRpb24gPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgdm0uaXNMb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgdm0uY2FsZW5kYXIgPSB7fTtcclxuICAgICAgICB2bS5jYWxlbmRhci5vcGVuZWQgPSBmYWxzZTtcclxuICAgICAgICB2bS5jYWxlbmRhci5kYXRlT3B0aW9ucyA9IHt9O1xyXG4gICAgICAgIHZtLmlzUGFzc2VuZ2VyTG9nZ2VkSW4gPSBhdXRoU2VydmljZS5pc0xvZ2dlZEluKCk7XHJcbiAgICAgICAgdm0uaGFzUmVzZXJ2YXRpb24gPSBmYWxzZTtcclxuICAgICAgICB2bS5hZHZSZXNlcnZhdGlvbldpbmRvdyA9IDE0O1xyXG4gICAgICAgIHZtLm1hcmtlcnMgPSBbXTtcclxuICAgICAgICB2bS5tYXAgPSBNYXBTZXJ2aWNlLmluaXRpYWxpemVNYXAoKTtcclxuICAgICAgICB2YXIgZGl2aXNpb25EYXRlID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHZhciBtYXBWZWhpY2xlcyA9IFtdO1xyXG4gICAgICAgIHZhciB2ZWhpY2xlUG9sbCA9IHVuZGVmaW5lZDtcclxuICAgICAgICB2YXIgbWFya2VyRXZlbnRzID0gW3sgZXZlbnQ6ICdjbGljaycsIGNhbGxiYWNrOiBpY29uQ2xpY2tIYW5kbGVyIH1dOyAgICAgICAgXHJcbiAgICAgICAgdm0uZGl2aXNpb25BbGxvd3NXYWl0bGlzdCA9IHRydWU7XHJcbiAgICAgICAgdm0uY29tcGFuaW9uQWxsb3dlZCA9IGZhbHNlO1xyXG4gICAgICAgIHZtLnNwZWNpYWxFdmVudCA9IHVuZGVmaW5lZDtcclxuICAgICAgICB2bS5zZWxlY3RHdWVzdERheSA9IHNlbGVjdEd1ZXN0RGF5O1xyXG5cclxuXHJcbiAgICAgICAgdm0uZ2V0RGlyZWN0aW9uc1RvU2VsZWN0ZWRTdG9wID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBTdG9wRGF0YVNlcnZpY2Uuc2V0U3RvcCh2bS5zZWxlY3RlZFN0b3ApO1xyXG4gICAgICAgICAgICAvL1N0b3BEYXRhU2VydmljZS5zZXRHZW9Mb2NhdGlvbih2bS5zZWxlY3RlZExvY2F0aW9uKTtcclxuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9jb21tdXRlci9kaXJlY3Rpb25zJyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0ub3Blbk1hcEFwcCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHVybCA9IFwiXCI7XHJcbiAgICAgICAgICAgIGlmICgobmF2aWdhdG9yLnBsYXRmb3JtLmluZGV4T2YoXCJpUGhvbmVcIikgIT0gLTEpXHJcbiAgICAgICAgIHx8IChuYXZpZ2F0b3IucGxhdGZvcm0uaW5kZXhPZihcImlQb2RcIikgIT0gLTEpXHJcbiAgICAgICAgICAgICAgICB8fCAobmF2aWdhdG9yLnBsYXRmb3JtLmluZGV4T2YoXCJpUGFkXCIpICE9IC0xKSkge1xyXG4gICAgICAgICAgICAgICAgdXJsID0gXCJodHRwOi8vbWFwcy5hcHBsZS5jb20vP3E9XCIgKyB2bS5zZWxlY3RlZFN0b3AubGF0aXR1ZGUgKyBcIixcIiArIHZtLnNlbGVjdGVkU3RvcC5sb25naXR1ZGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB1cmwgPSBcImh0dHA6Ly9tYXBzLmdvb2dsZS5jb20vP3E9XCIgKyB2bS5zZWxlY3RlZFN0b3AubGF0aXR1ZGUgKyBcIixcIiArIHZtLnNlbGVjdGVkU3RvcC5sb25naXR1ZGU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh1cmwubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgLy8gRm9yIElvbmljXHJcbiAgICAgICAgICAgICAgICBpZiAoJCgnYm9keScpLmhhc0NsYXNzKCdwbGF0Zm9ybS1jb3Jkb3ZhJykpIHtcclxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cub3Blbih1cmwsICdfc3lzdGVtJywgJycpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cub3Blbih1cmwpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBpY29uQ2xpY2tIYW5kbGVyKG1vZGVsKSB7XHJcbiAgICAgICAgICAgIHZtLnNob3cgPSB0cnVlO1xyXG4gICAgICAgICAgICB2bS5jb29yZHMgPSBtb2RlbC5jb29yZHM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5vcGVuQ2FsZW5kYXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZtLmNhbGVuZGFyLm9wZW5lZCA9IHRydWU7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGFkZERheXMgPSBmdW5jdGlvbiAoZGF0ZSwgZGF5cykge1xyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IERhdGUoZGF0ZSk7XHJcbiAgICAgICAgICAgIHJlc3VsdC5zZXREYXRlKHJlc3VsdC5nZXREYXRlKCkgKyBkYXlzKTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgc2V0RGF0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdm0uY2FsZW5kYXIuZGF0ZU9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICAnbWluRGF0ZSc6IGRpdmlzaW9uRGF0ZSxcclxuICAgICAgICAgICAgICAgICdtYXhEYXRlJzogYWRkRGF5cyhkaXZpc2lvbkRhdGUsIHZtLmFkdlJlc2VydmF0aW9uV2luZG93KVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2VsZWN0R3Vlc3REYXkoKSB7ICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHZtLnNlbGVjdGVkUmVzZXJ2YXRpb25EYXRlID0gbW9tZW50KHZtLnNwZWNpYWxFdmVudC5kYXRlLCAnWVlZWS1NTS1ERCBISDptbScpLnRvRGF0ZSgpO1xyXG4gICAgICAgICAgICB2bS5kYXRlQ2hhbmdlZCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGFjdGl2YXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBMdXVtTGlua2VkU2VydmljZS52ZXJpZnkoYXV0aFNlcnZpY2UuYXV0aGVudGljYXRpb24ucGFzc2VuZ2VySWQpO1xyXG4gICAgICAgICAgICBEaXZpc2lvblNlcnZpY2VcclxuICAgICAgICAgICAgICAgIC5nZXRDdXJyZW50RGl2aXNpb25UaW1lKClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpdmlzaW9uRGF0ZSA9IG1vbWVudChyZXNwb25zZS5kYXRhLnJlc3VsdCwgJ1lZWVktTU0tREQgSEg6bW0nKS50b0RhdGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRSZXNlcnZhdGlvbkRhdGUgPSBkaXZpc2lvbkRhdGU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZFNjaGVkdWxlID0gbmV3IERhdGUocmVzcG9uc2UuZGF0YS5yZXN1bHQpLmdldEhvdXJzKCkgPCAxMiA/IENvbW1vblNlcnZpY2UuU2NoZWR1bGVUeXBlLk1vcm5pbmcgOiBDb21tb25TZXJ2aWNlLlNjaGVkdWxlVHlwZS5FdmVuaW5nO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2V0TWF4RGF5c0ZvckFkdlJlc2VydmF0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2ZhbGxiYWNrIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXZpc2lvbkRhdGUgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBkaXZpc2lvbkRhdGUgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBEaXZpc2lvblNlcnZpY2VcclxuICAgICAgICAgICAgICAgIC5pc1dhaXRsaXN0QWxsb3dlZEJ5RGl2aXNpb24oKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIHZtLmRpdmlzaW9uQWxsb3dzV2FpdGxpc3QgPSByZXNwb25zZTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIFxyXG5cclxuICAgICAgICAgICAgRGl2aXNpb25TZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICAuZ2V0Q3VycmVudERpdmlzaW9uVGltZSgpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXZpc2lvbkRhdGUgPSBtb21lbnQocmVzcG9uc2UuZGF0YS5yZXN1bHQsICdZWVlZLU1NLUREIEhIOm1tJykudG9EYXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkUmVzZXJ2YXRpb25EYXRlID0gZGl2aXNpb25EYXRlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRTY2hlZHVsZSA9IG5ldyBEYXRlKHJlc3BvbnNlLmRhdGEucmVzdWx0KS5nZXRIb3VycygpIDwgMTJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gQ29tbW9uU2VydmljZS5TY2hlZHVsZVR5cGUuTW9ybmluZ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBDb21tb25TZXJ2aWNlLlNjaGVkdWxlVHlwZS5FdmVuaW5nO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2V0TWF4RGF5c0ZvckFkdlJlc2VydmF0aW9uKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBnZXRTcGVjaWFsRXZlbnQoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2ZhbGxiYWNrIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXZpc2lvbkRhdGUgPSBuZXcgbW9tZW50KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIGRpdmlzaW9uRGF0ZSA9IG5ldyBtb21lbnQoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuXHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0U3BlY2lhbEV2ZW50KCkge1xyXG4gICAgICAgICAgICB2bS5zcGVjaWFsRXZlbnQgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIFN0b3BEYXRhU2VydmljZVxyXG4gICAgICAgICAgICAgICAgLmdldFNwZWNpYWxFdmVudCh2bS5zZWxlY3RlZFN0b3AuaWQsIHZtLnNlbGVjdGVkU2NoZWR1bGUpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSAmJiByZXNwb25zZS5kYXRhLnJlc3VsdC5kYXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNwZWNpYWxFdmVudCA9IHJlc3BvbnNlLmRhdGEucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRNYXhEYXlzRm9yQWR2UmVzZXJ2YXRpb24oKSB7XHJcbiAgICAgICAgICAgIFN0b3BEYXRhU2VydmljZVxyXG4gICAgICAgICAgICAgICAgLmdldE1heERheXNBbGxvd2VkRm9yUmVzZXJ2YXRpb24odm0uc2VsZWN0ZWRTdG9wLmlkLCB2bS5zZWxlY3RlZFNjaGVkdWxlKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uYWR2UmVzZXJ2YXRpb25XaW5kb3cgPSByZXNwb25zZS5kYXRhLnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICBzZXREYXRlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG5cclxuICAgICAgICAgICAgICAgIHNldERhdGUoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5kYXRlQ2hhbmdlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgLy93aGVuIHVzZXIgY2xpY2tzIG9uIGNsZWFyIGJ1dHRvbiBvbiB0aGUgY2FsZW5kYXIsIHRoZSBtb2RlbCBpcyBzZXQgdG8gbnVsbCwgdGhpcyB3aWxsIHJlc2V0IHRoZSBtb2RlbCBiYWNrIHRvIGN1cnJlbnQgZGF0ZVxyXG4gICAgICAgICAgICBpZiAodm0uc2VsZWN0ZWRSZXNlcnZhdGlvbkRhdGUgPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRSZXNlcnZhdGlvbkRhdGUgPSBkaXZpc2lvbkRhdGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdm0uc2VsZWN0ZWRSZXNlcnZhdGlvbkRhdGUgPSBtb21lbnQobW9tZW50KHZtLnNlbGVjdGVkUmVzZXJ2YXRpb25EYXRlKS5mb3JtYXQoJ01NL0REL1lZWVknKSkudG9EYXRlKCk7XHJcblx0XHRcdC8vdm0uc2VsZWN0ZWRSZXNlcnZhdGlvbkRhdGUgPSBtb21lbnQobW9tZW50LnR6KHZtLnNlbGVjdGVkUmVzZXJ2YXRpb25EYXRlLCBEaXZpc2lvblNlcnZpY2UuZ2V0VGltZVpvbmUoKSkuZm9ybWF0KCdNTS9ERC9ZWVlZJykpLnRvRGF0ZSgpO1xyXG5cdFx0XHRcclxuICAgICAgICAgICAgdm0uc2VsZWN0ZWRTY2hlZHVsZSA9IENvbW1vblNlcnZpY2UuU2NoZWR1bGVUeXBlLk1vcm5pbmc7XHJcbiAgICAgICAgICAgIGdldFNwZWNpYWxFdmVudCgpO1xyXG4gICAgICAgICAgICBnZXROb25QZXJmb3JtZWRUcmlwcygpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFBpY2tVcCgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHZtLnNlbGVjdGVkU2NoZWR1bGUgPT0gQ29tbW9uU2VydmljZS5TY2hlZHVsZVR5cGUuTW9ybmluZyA/IHZtLnNlbGVjdGVkU3RvcCA6IHZtLnNlbGVjdGVkSHViO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldERyb3BPZmYoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2bS5zZWxlY3RlZFNjaGVkdWxlID09IENvbW1vblNlcnZpY2UuU2NoZWR1bGVUeXBlLk1vcm5pbmcgPyB2bS5zZWxlY3RlZEh1YiA6IHZtLnNlbGVjdGVkU3RvcDtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICB2YXIgZ2V0Tm9uUGVyZm9ybWVkVHJpcHMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZtLmlzTG9hZGluZyA9IHRydWU7XHJcbiAgICAgICAgICAgIHZtLm5vblBlcmZvcm1lZFRyaXBzID0gW107XHJcbiAgICAgICAgICAgIHZtLnBhc3NlbmdlclJlc2VydmF0aW9uID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICB2bS5oYXNSZXNlcnZhdGlvbiA9IGZhbHNlO1xyXG4gICAgICAgICAgICB2bS5jb21wYW5pb25BbGxvd2VkID0gZmFsc2U7XHJcblxyXG5cclxuICAgICAgICAgICAgaWYgKHZtLnNlbGVjdGVkSHViICYmIHZtLnNlbGVjdGVkU2NoZWR1bGUgJiYgdm0uc2VsZWN0ZWRSZXNlcnZhdGlvbkRhdGUpIHtcclxuICAgICAgICAgICAgICAgIFN0b3BEYXRhU2VydmljZVxyXG4gICAgICAgICAgICAgICAgLmdldE5vblBlcmZvcm1lZFRyaXBzKGdldFBpY2tVcCgpLmlkLCBnZXREcm9wT2ZmKCkuaWQsIHZtLnNlbGVjdGVkU2NoZWR1bGUsIHJlc2VydmF0aW9uVGltZXNwYW4oKSlcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0Lk5vblBlcmZvcm1lZFRyaXBzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLm5vblBlcmZvcm1lZFRyaXBzID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQuTm9uUGVyZm9ybWVkVHJpcHM7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wYW5pb25zQWxsb3dlZCgpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2V0UGFzc2VuZ2VyUmVzZXJ2YXRpb25Gb3IoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGdldENvbW11dGVyVmVoaWNsZUluZm9Gb3JUcmlwcygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2V2ZXJ5IHRpbWUgbmV3IG5vbiBwZXJmb3JtZWQgZXZlbnRzIGFyZSByZXRyaWV2ZWQgc3RvcCBwb2xsaW5nIGZvciBvbGQgYW5kIHN0YXJ0IHBvbGxpbmdcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3RvcFBvbGxpbmcoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcG9sbFZlaGljbGVzRm9yUm91dGUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZtLmlzTG9hZGluZyA9IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2bS5hdmFpbGFibGVQYXJraW5nID0gMDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodm0ubm9uUGVyZm9ybWVkVHJpcHMubGVuZ3RoID4gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2V0QXZhaWxhYmxlUGFya2luZ3NGb3JTdG9wKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNvbXBhbmlvbnNBbGxvd2VkKCkge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZtLm5vblBlcmZvcm1lZFRyaXBzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodm0ubm9uUGVyZm9ybWVkVHJpcHNbaV0uYWxsb3dlZENvbXBhbmlvbnMgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uY29tcGFuaW9uQWxsb3dlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICB2YXIgZ2V0UGFzc2VuZ2VyUmVzZXJ2YXRpb25Gb3IgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICghdm0uaXNQYXNzZW5nZXJMb2dnZWRJbilcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgIFJlc2VydmF0aW9uU2VydmljZVxyXG4gICAgICAgICAgICAuZ2V0VXNlclJlc2VydmF0aW9uRm9yKGF1dGhTZXJ2aWNlLmF1dGhlbnRpY2F0aW9uLnBhc3NlbmdlcklkLCB2bS5zZWxlY3RlZFNjaGVkdWxlLCByZXNlcnZhdGlvblRpbWVzcGFuKCkpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEgJiYgcmVzcG9uc2UuZGF0YS5yZXN1bHRcclxuICAgICAgICAgICAgICAgICAgICAmJiByZXNwb25zZS5kYXRhLnJlc3VsdC5yZXNlcnZhdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5wYXNzZW5nZXJSZXNlcnZhdGlvbiA9IHJlc3BvbnNlLmRhdGEucmVzdWx0LnJlc2VydmF0aW9uc1swXTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5oYXNSZXNlcnZhdGlvbiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG5cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgdmFyIGdldEF2YWlsYWJsZVBhcmtpbmdzRm9yU3RvcCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgU3RvcERhdGFTZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICAuZ2V0QXZhaWxhYmxlUGFya2luZ3NGb3JTdG9wKHZtLnNlbGVjdGVkU3RvcC5pZCwgcmVzZXJ2YXRpb25UaW1lc3BhbigpKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uYXZhaWxhYmxlUGFya2luZyA9IHJlc3BvbnNlLmRhdGEucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoZXJyb3IpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGdldEh1YnMgPSBmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgICAgICAgICBTdG9wRGF0YVNlcnZpY2VcclxuICAgICAgICAgICAgLmdldEh1YnModm0uc2VsZWN0ZWRTdG9wLmlkLCB2bS5zZWxlY3RlZFNjaGVkdWxlLCByZXNlcnZhdGlvblRpbWVzcGFuKCkpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5odWJzID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQuaHVicztcclxuICAgICAgICAgICAgICAgICAgICBpZiAodm0uaHVicy5sZW5ndGggPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZEh1YiA9IHZtLmh1YnNbMF07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG5cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgJHNjb3BlLiR3YXRjaCgndm0uc2VsZWN0ZWRTY2hlZHVsZScsIGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgICAgICBpZiAodmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIGdldEh1YnMoKTtcclxuICAgICAgICAgICAgICAgIGdldFNwZWNpYWxFdmVudCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICAkc2NvcGUuJHdhdGNoKCd2bS5zZWxlY3RlZEh1YicsIGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgICAgICBpZiAodmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIGdldE5vblBlcmZvcm1lZFRyaXBzKCk7XHJcbiAgICAgICAgICAgICAgICBzZXRNYXJrZXJzKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNldE1hcmtlcnMoKSB7XHJcbiAgICAgICAgICAgIHZtLnNob3cgPSBmYWxzZTtcclxuICAgICAgICAgICAgdm0ubWFya2VycyA9IFtdO1xyXG5cclxuICAgICAgICAgICAgdm0ubWFya2Vycy5wdXNoKHtcclxuICAgICAgICAgICAgICAgIGxhdGl0dWRlOiB2bS5zZWxlY3RlZFN0b3AubGF0aXR1ZGUsXHJcbiAgICAgICAgICAgICAgICBsb25naXR1ZGU6IHZtLnNlbGVjdGVkU3RvcC5sb25naXR1ZGUsXHJcbiAgICAgICAgICAgICAgICBpY29uOiBNYXBJY29uU2VydmljZS5nZXRDb21tdXRlclN0b3BJY29uKCksXHJcbiAgICAgICAgICAgICAgICBuYW1lOiB2bS5zZWxlY3RlZFN0b3AubmFtZSxcclxuICAgICAgICAgICAgICAgIGFkZHJlc3M6IHZtLnNlbGVjdGVkU3RvcC5hZGRyZXNzXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB2bS5tYXJrZXJzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgbGF0aXR1ZGU6IHZtLnNlbGVjdGVkSHViLmxhdGl0dWRlLFxyXG4gICAgICAgICAgICAgICAgbG9uZ2l0dWRlOiB2bS5zZWxlY3RlZEh1Yi5sb25naXR1ZGUsXHJcbiAgICAgICAgICAgICAgICBpY29uOiBNYXBJY29uU2VydmljZS5nZXRDb21tdXRlckh1Ykljb24oKSxcclxuICAgICAgICAgICAgICAgIG5hbWU6IHZtLnNlbGVjdGVkSHViLm5hbWUsXHJcbiAgICAgICAgICAgICAgICBhZGRyZXNzOiB2bS5zZWxlY3RlZEh1Yi5hZGRyZXNzXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgTWFwU2VydmljZS5zZXRNYXBCb3VuZHModm0ubWFya2VycywgbWFya2VyRXZlbnRzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciByZXNlcnZhdGlvblRpbWVzcGFuID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gRGF0ZS5wYXJzZSh2bS5zZWxlY3RlZFJlc2VydmF0aW9uRGF0ZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5yZXNlcnZlID0gZnVuY3Rpb24gKHRyaXApIHtcclxuXHJcbiAgICAgICAgICAgIGlmICghdm0uaXNQYXNzZW5nZXJMb2dnZWRJbikge1xyXG4gICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdsb2dpbicpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoIWNhblJlc2VydmUodHJpcCkpIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgIHZhciBtb2RhbFJlc2VydmUgPSAkdWliTW9kYWwub3BlbihnZXRSZXNlcnZhdGlvbk1vZGFsKHRyaXApKTtcclxuXHJcbiAgICAgICAgICAgIG1vZGFsUmVzZXJ2ZS5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0ICYmIHJlc3VsdC5hY3Rpb24gPT09ICdjbG9zZScgJiYgcmVzdWx0LmlzUmVzZXJ2ZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBnZXROb25QZXJmb3JtZWRUcmlwcygpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAocmVzdWx0ICYmIHJlc3VsdC5hY3Rpb24gPT09ICdyZXNlcnZhdGlvbicpIHtcclxuICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL3Bhc3Nlbmdlci10cmlwcycpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAocmVzdWx0ICYmIHJlc3VsdC5hY3Rpb24gPT09ICd2ZWhpY2xlJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHNob3dBZGRWZWhpY2xlTW9kYWwodHJpcCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdyZXNlcnZhdGlvbkNoYW5nZWQnKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBjYW5SZXNlcnZlKHRyaXApIHtcclxuICAgICAgICAgICAgaWYodm0uaGFzUmVzZXJ2YXRpb24pIHJldHVybiBmYWxzZTsgICAgICAgICAgICBcclxuXHJcbiAgICAgICAgICAgIGlmICh2bS5kaXZpc2lvbkFsbG93c1dhaXRsaXN0KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJpcC50b3RhbFBhc3NlbmdlcnMgPjA7XHJcbiAgICAgICAgICAgIH0gICAgICAgICAgICBcclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJpcC5hdmFpbGFibGVDYXBhY2l0eSA+IDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICB2bS5jYW5jZWxSZXNlcnZhdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHJlc2VydmF0aW9uSW5mbyA9XHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzZXJ2YXRpb25JZDogdm0ucGFzc2VuZ2VyUmVzZXJ2YXRpb24uaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgcm91dGVOYW1lOiB2bS5wYXNzZW5nZXJSZXNlcnZhdGlvbi5yb3V0ZU5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgcGFzc2VuZ2VySWQ6IGF1dGhTZXJ2aWNlLmF1dGhlbnRpY2F0aW9uLnBhc3NlbmdlcklkLFxyXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0VGltZTogdm0ucGFzc2VuZ2VyUmVzZXJ2YXRpb24ucGlja3VwVGltZSxcclxuICAgICAgICAgICAgICAgICAgICByZXNlcnZhdGlvbkRhdGU6IHZtLnBhc3NlbmdlclJlc2VydmF0aW9uLnJlc2VydmF0aW9uRGF0ZVxyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHZhciBtb2RhbENhbmNlbFJlc2VydmF0aW9uID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvbW9kdWxlcy9jb21tdXRlci9tb2RhbHMvY2FuY2VsLXJlc2VydmF0aW9uLW1vZGFsL2NhbmNlbC1yZXNlcnZhdGlvbi5odG1sJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDYW5jZWxSZXNlcnZhdGlvbkNvbnRyb2xsZXIgYXMgdm0nLFxyXG4gICAgICAgICAgICAgICAgc2l6ZTogJy1mcycsXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzZXJ2YXRpb25JbmZvOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXNlcnZhdGlvbkluZm87XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIG1vZGFsQ2FuY2VsUmVzZXJ2YXRpb24ucmVzdWx0LnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5pc0NhbmNlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGdldE5vblBlcmZvcm1lZFRyaXBzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdyZXNlcnZhdGlvbkNoYW5nZWQnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0Q29tbXV0ZXJWZWhpY2xlSW5mb0ZvclRyaXBzKCkge1xyXG4gICAgICAgICAgICB2YXIgY29tbXV0ZXJWZWhpY2xlc0lkcyA9IFtdO1xyXG4gICAgICAgICAgICB2YXIgcm91dGVJZCA9IDA7XHJcblxyXG4gICAgICAgICAgICBpZiAodm0ubm9uUGVyZm9ybWVkVHJpcHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgcm91dGVJZCA9IHZtLm5vblBlcmZvcm1lZFRyaXBzWzBdLnJvdXRlSWQ7XHJcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2godm0ubm9uUGVyZm9ybWVkVHJpcHMsIGZ1bmN0aW9uICh0cmlwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRyaXAudmVoaWNsZUlkICYmIHRyaXAudmVoaWNsZUlkICE9IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW11dGVyVmVoaWNsZXNJZHMucHVzaCh0cmlwLnZlaGljbGVJZCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoY29tbXV0ZXJWZWhpY2xlc0lkcy5sZW5ndGggPiAwICYmIHJvdXRlSWQgIT0gMClcclxuICAgICAgICAgICAgICAgICAgICBWZWhpY2xlRGF0YVNlcnZpY2UuR2V0Q29tbXV0ZXJWZWhpY2xlcyhjb21tdXRlclZlaGljbGVzSWRzLCByb3V0ZUlkKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZlaGljbGVzID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5VmVoaWNsZXModmVoaWNsZXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2VyciBoZXJlXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBkaXNwbGF5VmVoaWNsZXModmVoaWNsZXMpIHtcclxuICAgICAgICAgICAgaWYgKG1hcFZlaGljbGVzLmxlbmd0aCA+IDApXHJcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2gobWFwVmVoaWNsZXMsIGZ1bmN0aW9uICh2ZWhpY2xlSWNvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZlaGljbGVJY29uLnNldE1hcChudWxsKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBtYXBWZWhpY2xlcyA9IFtdO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZlaGljbGVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdmVoaWNsZUluZm8gPSB2ZWhpY2xlc1tpXTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgdmVoaWNsZSA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xyXG4gICAgICAgICAgICAgICAgICAgIC8vaWQ6IHZlaGljbGVJbmZvLmlkLFxyXG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKHZlaGljbGVJbmZvLmxhdGl0dWRlLCB2ZWhpY2xlSW5mby5sb25naXR1ZGUpLFxyXG4gICAgICAgICAgICAgICAgICAgIG1hcDogdm0ubWFwLmNvbnRyb2wuZ2V0R01hcCgpLFxyXG4gICAgICAgICAgICAgICAgICAgIG9wdGltaXplZDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgZmxhdDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICBpY29uOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6ICdNMTUuMjQxMzEyMiwyMS4xNTI3ODYxIEwxMSwyNiBMNi43NTg2MTg1NiwyMS4xNTI3MDY5IEMyLjc4OTEwOTU5LDE5LjQ5Mjc1MDYgMCwxNS41NzI4NDc1IDAsMTEgQzAsNC45MjQ4Njc3NSA0LjkyMzUzMiwwIDExLDAgQzE3LjA3NTEzMjIsMCAyMiw0LjkyMzUzMiAyMiwxMSBDMjIsMTUuNTcyMDg0NSAxOS4yMTEzNTE1LDE5LjQ5MjY2ODQgMTUuMjQxMzEyMiwyMS4xNTI3ODYxIFonLC8vZ29vZ2xlLm1hcHMuU3ltYm9sUGF0aC5GT1JXQVJEX0NMT1NFRF9BUlJPVyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGU6IDEuMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsbE9wYWNpdHk6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGxDb2xvcjogJyNmZmYnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHJva2VXZWlnaHQ6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0cm9rZU9wYWNpdHk6IC4zLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByb3RhdGlvbjogdmVoaWNsZUluZm8uaGVhZGluZyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luOiBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQoMCwgMCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuY2hvcjogbmV3IGdvb2dsZS5tYXBzLlBvaW50KHZlaGljbGVJbmZvLmFuY2hvclgsIHZlaGljbGVJbmZvLmFuY2hvclkpLy9nZXRBbmNob3IodmVoaWNsZUluZm8uaGVhZGluZylcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHpJbmRleDogMlxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHZlaGljbGVDb2xvciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xyXG4gICAgICAgICAgICAgICAgICAgIC8vaWQ6IHZlaGljbGVJbmZvLmlkLFxyXG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKHZlaGljbGVJbmZvLmxhdGl0dWRlLCB2ZWhpY2xlSW5mby5sb25naXR1ZGUpLFxyXG4gICAgICAgICAgICAgICAgICAgIG1hcDogdm0ubWFwLmNvbnRyb2wuZ2V0R01hcCgpLFxyXG4gICAgICAgICAgICAgICAgICAgIGljb246IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogJ00wLDEwIEMwLDQuNDc3MTUyNSA0LjQ3NTkzODE4LDAgMTAsMCBDMTUuNTIyODQ3NSwwIDIwLDQuNDc1OTM4MTggMjAsMTAgQzIwLDE1LjUyMjg0NzUgMTUuNTI0MDYxOCwyMCAxMCwyMCBDNC40NzcxNTI1LDIwIDAsMTUuNTI0MDYxOCAwLDEwIFogTTUsNSBMNSwxMy44IEw1LjgxOTA0NzYyLDEzLjggTDUuODE5MDQ3NjIsMTUgTDcsMTUgTDcsMTMuOCBMMTMsMTMuOCBMMTMsMTUgTDE0LjE4MDk1MjQsMTUgTDE0LjE4MDk1MjQsMTMuOCBMMTUsMTMuOCBMMTUsNSBMNSw1IFogTTE0LjYzMzY5OTYsOS43MTYxMDIwOSBDMTQuNjMzNjk5Niw5Ljk5MjU1NjI3IDE0LjQwNTUyMiwxMC4yMTY2NjY3IDE0LjEzNzQxMzQsMTAuMjE2NjY2NyBMNS44OTkyMTY2NSwxMC4yMTY2NjY3IEM1LjYyNTEyNTMyLDEwLjIxNjY2NjcgNS40MDI5MzA0LDEwLjAwMjI1MTMgNS40MDI5MzA0LDkuNzE2MTAyMDkgTDUuNDAyOTMwNCw3LjExNzIzMTI0IEM1LjQwMjkzMDQsNi44NDA3NzcwNiA1LjYzMTEwNzk5LDYuNjE2NjY2NjcgNS44OTkyMTY2NSw2LjYxNjY2NjY3IEwxNC4xMzc0MTM0LDYuNjE2NjY2NjcgQzE0LjQxMTUwNDcsNi42MTY2NjY2NyAxNC42MzM2OTk2LDYuODMxMDgyMDMgMTQuNjMzNjk5Niw3LjExNzIzMTI0IEwxNC42MzM2OTk2LDkuNzE2MTAyMDkgWiBNNS4zODQ2MTUzOCw1LjggQzUuMzg0NjE1MzgsNS41NzkwODYxIDUuNTYwNzY5NjcsNS40IDUuNzgxMjUsNS40IEwxNC4yMTg3NSw1LjQgQzE0LjQzNzgwNTIsNS40IDE0LjYxNTM4NDYsNS41ODU1NDY4OCAxNC42MTUzODQ2LDUuOCBDMTQuNjE1Mzg0Niw2LjAyMDkxMzkgMTQuNDM5MjMwMyw2LjIgMTQuMjE4NzUsNi4yIEw1Ljc4MTI1LDYuMiBDNS41NjIxOTQ3NSw2LjIgNS4zODQ2MTUzOCw2LjAxNDQ1MzEzIDUuMzg0NjE1MzgsNS44IFogTTUuMzg0NjE1MzgsMTEuNiBDNS4zODQ2MTUzOCwxMS4yNjg2MjkyIDUuNjUyMDEwOTksMTEgNS45OTMwODg5NCwxMSBMNi42OTkyMTg3NSwxMSBDNy4wMzUyNjk0MiwxMSA3LjMwNzY5MjMxLDExLjI3ODMyMDMgNy4zMDc2OTIzMSwxMS42IEM3LjMwNzY5MjMxLDExLjkzMTM3MDggNy4wNDAyOTY3LDEyLjIgNi42OTkyMTg3NSwxMi4yIEw1Ljk5MzA4ODk0LDEyLjIgQzUuNjU3MDM4MjgsMTIuMiA1LjM4NDYxNTM4LDExLjkyMTY3OTcgNS4zODQ2MTUzOCwxMS42IFogTTEyLjY5MjMwNzcsMTEuNiBDMTIuNjkyMzA3NywxMS4yNjg2MjkyIDEyLjk1OTcwMzMsMTEgMTMuMzAwNzgxMiwxMSBMMTQuMDA2OTExMSwxMSBDMTQuMzQyOTYxNywxMSAxNC42MTUzODQ2LDExLjI3ODMyMDMgMTQuNjE1Mzg0NiwxMS42IEMxNC42MTUzODQ2LDExLjkzMTM3MDggMTQuMzQ3OTg5LDEyLjIgMTQuMDA2OTExMSwxMi4yIEwxMy4zMDA3ODEyLDEyLjIgQzEyLjk2NDczMDYsMTIuMiAxMi42OTIzMDc3LDExLjkyMTY3OTcgMTIuNjkyMzA3NywxMS42IFonLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxsT3BhY2l0eTogMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlT3BhY2l0eTogMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsbENvbG9yOiAnIzU1NScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHpJbmRleDogM1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgbWFwVmVoaWNsZXMucHVzaCh2ZWhpY2xlKTtcclxuICAgICAgICAgICAgICAgIG1hcFZlaGljbGVzLnB1c2godmVoaWNsZUNvbG9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgZnVuY3Rpb24gcG9sbFZlaGljbGVzRm9yUm91dGUoKSB7XHJcbiAgICAgICAgICAgIHZlaGljbGVQb2xsID0gJGludGVydmFsKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGdldENvbW11dGVyVmVoaWNsZUluZm9Gb3JUcmlwcygpO1xyXG5cclxuICAgICAgICAgICAgfSwgMzAwMDApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBzdG9wUG9sbGluZygpIHtcclxuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKHZlaGljbGVQb2xsKSkge1xyXG4gICAgICAgICAgICAgICAgJGludGVydmFsLmNhbmNlbCh2ZWhpY2xlUG9sbCk7XHJcbiAgICAgICAgICAgICAgICB2ZWhpY2xlUG9sbCA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFJlc2VydmF0aW9uTW9kYWwodHJpcCkge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvbW9kdWxlcy9jb21tdXRlci9tb2RhbHMvcmVzZXJ2YXRpb24tbW9kYWwvcmVzZXJ2YXRpb24uaHRtbCcsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnUmVzZXJ2YXRpb25Db250cm9sbGVyIGFzIHZtJyxcclxuICAgICAgICAgICAgICAgIHNpemU6ICctZnMnLFxyXG4gICAgICAgICAgICAgICAgYmFja2Ryb3A6ICdzdGF0aWMnLFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc2VydmF0aW9uSW5mbzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAnZGl2aXNpb25JZCc6IERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdwYXNzZW5nZXJJZCc6IGF1dGhTZXJ2aWNlLmF1dGhlbnRpY2F0aW9uLnBhc3NlbmdlcklkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAncGlja3VwU3RvcCc6IGdldFBpY2tVcCgpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnZHJvcG9mZlN0b3AnOiBnZXREcm9wT2ZmKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICd0cmlwJzogdHJpcCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ3NjaGVkdWxlVHlwZSc6IHZtLnNlbGVjdGVkU2NoZWR1bGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdyZXNlcnZhdGlvbkRhdGUnOiB2bS5zZWxlY3RlZFJlc2VydmF0aW9uRGF0ZVxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgaXNBZGQ6IHRydWVcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNob3dBZGRWZWhpY2xlTW9kYWwodHJpcCkge1xyXG4gICAgICAgICAgICB2YXIgbW9kYWxSZXNlcnZlID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvbW9kdWxlcy9jb21tdXRlci9tb2RhbHMvYWRkLXZlaGljbGUtbW9kYWwvYWRkLXZlaGljbGUuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnQWRkVmVoaWNsZUNvbnRyb2xsZXIgYXMgdm0nLFxyXG4gICAgICAgICAgICAgICAgYmFja2Ryb3A6ICdzdGF0aWMnLFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGF0bGVhc3RPbmVWZWhpY2xlRXhpc3Q6IGZhbHNlXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBtb2RhbFJlc2VydmUucmVzdWx0LnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgdm0ucmVzZXJ2ZSh0cmlwKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5nb1RvU2NoZWR1bGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIFN0b3BEYXRhU2VydmljZS5zZXRSb3V0ZShzdG9wKTtcclxuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9jb21tdXRlci9wdWJsaXNoZWQtc2NoZWR1bGUnKTtcclxuICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgdm0udmlld1Jlc2VydmF0aW9uID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgY29tbXV0ZXJUcmlwTW9kYWwgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9tb2R1bGVzL3NoYXJlZC90cmlwcy9jb21tdXRlci10cmlwLW1vZGFsLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0NvbW11dGVyVHJpcE1vZGFsQ29udHJvbGxlciBhcyB2bScsXHJcbiAgICAgICAgICAgICAgICBzaXplOiAnLWZzJyxcclxuICAgICAgICAgICAgICAgIGJhY2tkcm9wOiAnc3RhdGljJyxcclxuICAgICAgICAgICAgICAgIGtleWJvYXJkOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICB0cmlwSWQ6IHZtLnBhc3NlbmdlclJlc2VydmF0aW9uLmlkXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgY29tbXV0ZXJUcmlwTW9kYWwucmVzdWx0LnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuY2FuY2VsbGVkIHx8IHJlc3BvbnNlLmlzTW9kaWZpZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBnZXROb25QZXJmb3JtZWRUcmlwcygpO1xyXG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgncmVzZXJ2YXRpb25DaGFuZ2VkJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgYWN0aXZhdGUoKTtcclxuXHJcbiAgICAgICAgJHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgc3RvcFBvbGxpbmcoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gU3RhcnQgb2YgY29kZSBmb3IgSW9uaWNcclxuICAgICAgICB2bS5pb25pY0luY2x1ZGUgPSAnYXBwL21vZHVsZXMvY29tbXV0ZXIvc3RvcC9zZWxlY3RlZC1zdG9wLmh0bWwnO1xyXG4gICAgICAgIHZtLmlvbmljQ3VzdG9tQ2xhc3NOYW1lID0gJyc7XHJcbiAgICAgICAgdm0uaW9uaWNIaWRlTmF2QmFyID0gZmFsc2U7XHJcbiAgICAgICAgdm0uaW9uaWNVc2VSZWZyZXNoZXIgPSBmYWxzZTtcclxuICAgICAgICAvLyBFbmQgb2YgY29kZSBmb3IgSW9uaWNcclxuICAgIH1cclxuXHJcblxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24oKSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZShcIm9uZU1WQXBwXCIpXHJcbiAgICAgICAgLmRpcmVjdGl2ZShcIm5vblBlcmZvcm1lZFRyaXBDb21wb25lbnRcIiwgbm9uUGVyZm9ybWVkVHJpcENvbXBvbmVudCk7XHJcblxyXG4gICAgZnVuY3Rpb24gbm9uUGVyZm9ybWVkVHJpcENvbXBvbmVudCgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogXCJFXCIsXHJcbiAgICAgICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgICAgICB0cmlwOiBcIj1cIixcclxuICAgICAgICAgICAgICAgIGRpdmlzaW9uQWxsb3dzV2FpdGxpc3QgOiAnPSdcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiYXBwL21vZHVsZXMvY29tbXV0ZXIvc3RvcC9zZWxlY3RlZFN0b3AtbnB0LmNvbXBvbmVudC5odG1sXCJcclxuICAgICAgICB9O1xyXG5cclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmZhY3RvcnkoJ1N0b3BEYXRhU2VydmljZScsIFN0b3BEYXRhU2VydmljZSk7XHJcblxyXG4gICAgU3RvcERhdGFTZXJ2aWNlLiRpbmplY3QgPSBbJyRxJywgJyRodHRwJywgJ2VudicsICckY2FjaGVGYWN0b3J5JywgJ2xvY2FsU3RvcmFnZVNlcnZpY2UnLCdEaXZpc2lvblNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBTdG9wRGF0YVNlcnZpY2UoJHEsICRodHRwLCBlbnYsICRjYWNoZUZhY3RvcnksIGxvY2FsU3RvcmFnZVNlcnZpY2UsIERpdmlzaW9uU2VydmljZSkge1xyXG5cclxuICAgICAgICB2YXIgc2VsZWN0ZWRTdG9wID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHZhciBjYWNoZSA9ICRjYWNoZUZhY3RvcnkoJ0xvY2F0aW9uQ2FjaGUnKTtcclxuXHJcbiAgICAgICAgdmFyIHNldFNlbGVjdGVkU3RvcCA9IGZ1bmN0aW9uIChzdG9wKSB7XHJcbiAgICAgICAgICAgIC8vY2FjaGUucHV0KFwic3RvcFwiLCBzdG9wKTtcclxuICAgICAgICAgICAgbG9jYWxTdG9yYWdlU2VydmljZS5zZXQoJ3N0b3AnLCBzdG9wKTtcclxuICAgICAgICAgICAgc2VsZWN0ZWRTdG9wID0gc3RvcDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGNsZWFySXRlbUZyb21TdG9yYWdlID0gZnVuY3Rpb24gKGtleSkge1xyXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2VTZXJ2aWNlLnJlbW92ZShrZXkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgZ2V0U2VsZWN0ZWRTdG9wID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAvL3JldHVybiBjYWNoZS5nZXQoXCJzdG9wXCIpO1xyXG4gICAgICAgICAgICByZXR1cm4gbG9jYWxTdG9yYWdlU2VydmljZS5nZXQoJ3N0b3AnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGdldEluY2lkZW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbG9jYWxTdG9yYWdlU2VydmljZS5nZXQoJ2luY2lkZW50Jyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBzZXRJbmNpZGVudCA9IGZ1bmN0aW9uIChpbmNpZGVudCkge1xyXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2VTZXJ2aWNlLnNldCgnaW5jaWRlbnQnLCBpbmNpZGVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBnZXRSb3V0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGxvY2FsU3RvcmFnZVNlcnZpY2UuZ2V0KCdyb3V0ZScpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgc2V0Um91dGUgPSBmdW5jdGlvbiAocm91dGUpIHtcclxuICAgICAgICAgICAgbG9jYWxTdG9yYWdlU2VydmljZS5zZXQoJ3JvdXRlJywgcm91dGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgZ2V0VmVoaWNsZUlkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gbG9jYWxTdG9yYWdlU2VydmljZS5nZXQoJ3ZlaGljbGUnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIHNldFZlaGljbGVJZCA9IGZ1bmN0aW9uICh2ZWhpY2xlSWQpIHtcclxuICAgICAgICAgICAgbG9jYWxTdG9yYWdlU2VydmljZS5zZXQoJ3ZlaGljbGUnLCB2ZWhpY2xlSWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgY3Vyckdlb0xvY2F0aW9uID0gdW5kZWZpbmVkO1xyXG5cclxuICAgICAgICB2YXIgc2V0R2VvTG9jYXRpb24gPSBmdW5jdGlvbiAoY3VyckxvY2F0aW9uKSB7XHJcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZVNlcnZpY2Uuc2V0KFwiY3VyckxvY2F0aW9uXCIsIGN1cnJMb2NhdGlvbik7XHJcbiAgICAgICAgICAgIGN1cnJHZW9Mb2NhdGlvbiA9IGN1cnJMb2NhdGlvblxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICB2YXIgZ2V0R2VvTG9jYXRpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBsb2NhbFN0b3JhZ2VTZXJ2aWNlLmdldChcImN1cnJMb2NhdGlvblwiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFN0b3BEZXRhaWxzKHN0b3BJZCkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5jb21tdXRlckFwaVVybCArICdzdG9wLycgKyBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpICsgJy8nICsgc3RvcElkO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgdXJsOiBzZXJ2aWNlVXJsLFxyXG4gICAgICAgICAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJ1xyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRJbmNpZGVudHNGb3JTdG9wKHN0b3BJZCwgZGF5KSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gZW52LmNvbW11dGVyQXBpVXJsICsgJ3N0b3AvJyArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCkgKyAnL2luY2lkZW50cy8nICsgc3RvcElkICsgJy8nICsgZGF5ICsgJz9ybmQ9JyArIG5ldyBEYXRlKCkuZ2V0TWlsbGlzZWNvbmRzKCk7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICB1cmw6IHNlcnZpY2VVcmwsXHJcbiAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycilcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0VXNlckluY2lkZW50c0ZvclN0b3Aoc3RvcElkLCBkYXksIHVzZXJJZCkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5jb21tdXRlckFwaVVybCArICdzdG9wLycgKyBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpICsgJy9pbmNpZGVudHMvJyArIHN0b3BJZCArICcvJyArIGRheSArICcvJyArIHVzZXJJZCArICc/cm5kPScgKyBuZXcgRGF0ZSgpLmdldE1pbGxpc2Vjb25kcygpO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgdXJsOiBzZXJ2aWNlVXJsLFxyXG4gICAgICAgICAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJ1xyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFVzZXJJbmNpZGVudHNCeUlkKGluY2lkZW50SWQsIHVzZXJJZCkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5jb21tdXRlckFwaVVybCArICdzdG9wLycgKyBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpICsgJy9pbmNpZGVudC8nICsgaW5jaWRlbnRJZCArICcvJyArIHVzZXJJZCArICc/cm5kPScgKyBuZXcgRGF0ZSgpLmdldE1pbGxpc2Vjb25kcygpO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgdXJsOiBzZXJ2aWNlVXJsLFxyXG4gICAgICAgICAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJ1xyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgIGZ1bmN0aW9uIGdldFZlaGljbGUodmVoSWQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBlbnYuY29tbXV0ZXJBcGlVcmwgKyAnY29tbW9uLycgKyBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpICsgJy92ZWhpY2xlLycgKyB2ZWhJZCArICc/cm5kPScgK25ldyBEYXRlKCkuZ2V0TWlsbGlzZWNvbmRzKCk7XHJcbiAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNVbmRlZmluZWQodmVoSWQpIHx8IHZlaElkID09IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KCdObyBWZWhpY2xlIEZvdW5kJyk7XHJcbiAgICAgICAgICAgICBlbHNle1xyXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICAgICAgJ3VybCc6IHNlcnZpY2VVcmxcclxuICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycilcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgIGZ1bmN0aW9uIGdldEh1YnMoc3RvcElkLCBzY2hlZHVsZVR5cGUsIHRpbWVzcGFuKSB7XHJcbiAgICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5vbmVNVkFwaVVybCArICdjb21tdXRlci8nICsgIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCkgKyAnLycgKyBzdG9wSWQgKyAnL2h1YnMvJyArIHNjaGVkdWxlVHlwZSArICcvJyArIHRpbWVzcGFuICsgJz9ybmQ9JyArIG5ldyBEYXRlKCkuZ2V0TWlsbGlzZWNvbmRzKCk7XHJcbiAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICAgJ3VybCc6IHNlcnZpY2VVcmxcclxuICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycilcclxuICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgIH1cclxuXHJcbiAgICAgICAgIGZ1bmN0aW9uIGdldEF2YWlsYWJsZVBhcmtpbmdzRm9yU3RvcChzdG9wSWQsIHJlc2VydmF0aW9uRGF0ZSkge1xyXG4gICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBlbnYub25lTVZBcGlVcmwgKyAnY29tbXV0ZXIvc3RvcHMvJyArIHN0b3BJZCArICcvYXZhaWxhYmxlUGFya2luZy8nICsgcmVzZXJ2YXRpb25EYXRlICsgJz9ybmQ9JyArIG5ldyBEYXRlKCkuZ2V0TWlsbGlzZWNvbmRzKCk7XHJcbiAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICAgJ3VybCc6IHNlcnZpY2VVcmxcclxuICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycilcclxuICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgIH1cclxuXHJcbiAgICAgICAgIGZ1bmN0aW9uIGdldE5vblBlcmZvcm1lZFRyaXBzKHBpY2t1cFN0b3BJZCwgZHJvcG9mZlN0b3BJZCwgc2NoZWR1bGVUeXBlLCBzY2hlZHVsZURhdGUpe1xyXG4gICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBlbnYub25lTVZBcGlVcmwgKyAnY29tbXV0ZXIvJyArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCkgKyAnL3N0b3BzL25vbnBlcmZvcm1lZHRyaXBzLycgKyBwaWNrdXBTdG9wSWQgKyAnLycgXHJcbiAgICAgICAgICAgICAgICAgKyBkcm9wb2ZmU3RvcElkICsgJy8nICsgc2NoZWR1bGVEYXRlICsgJy8nICsgc2NoZWR1bGVUeXBlICsgJz9ybmQ9JyArIG5ldyBEYXRlKCkuZ2V0TWlsbGlzZWNvbmRzKCk7XHJcbiAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICAgJ3VybCc6IHNlcnZpY2VVcmxcclxuICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycilcclxuICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgIH0gICAgICAgXHJcblxyXG5cclxuICAgICAgICAgZnVuY3Rpb24gZ2V0TWF4RGF5c0FsbG93ZWRGb3JSZXNlcnZhdGlvbihzdG9wSWQsc2NoZWR1bGVUeXBlKSB7XHJcbiAgICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5vbmVNVkFwaVVybCArICdjb21tdXRlci8nICsgRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKSArICcvc3RvcHMvJyArIHN0b3BJZCArICcvYWR2YW5jZWREYXlzLycgKyBzY2hlZHVsZVR5cGUgKyAgJz9ybmQ9JyArIG5ldyBEYXRlKCkuZ2V0TWlsbGlzZWNvbmRzKCk7XHJcbiAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICAgJ3VybCc6IHNlcnZpY2VVcmxcclxuICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycilcclxuICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICBmdW5jdGlvbiBnZXREcm9wb2Zmc0ZvclNlbGVjdGVkUGlja3VwKHN0b3BJZCkge1xyXG4gICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBlbnYub25lTVZBcGlVcmwgKyAnY29tbXV0ZXIvJyArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCkgKyAnLycgKyBzdG9wSWQgKyAnL2Ryb3BPZmZzP3JuZD0nICsgbmV3IERhdGUoKS5nZXRNaWxsaXNlY29uZHMoKTtcclxuICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICAndXJsJzogc2VydmljZVVybFxyXG4gICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgIGZ1bmN0aW9uIGdldFRyaXBUaW1lc0ZvckFkdmFuY2VkUmVzZXJ2YXRpb24ocGlja3VwU3RvcElkLCBkcm9wb2ZmU3RvcElkLCBzY2hlZHVsZVR5cGUpIHtcclxuICAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gZW52Lm9uZU1WQXBpVXJsICsgJ2NvbW11dGVyLycgKyBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpICsgJy9hbGx0cmlwcy8nXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBwaWNrdXBTdG9wSWQgKyAnLycgKyBkcm9wb2ZmU3RvcElkICsgJy8nICsgc2NoZWR1bGVUeXBlICsgJy8/cm5kPScgKyBuZXcgRGF0ZSgpLmdldE1pbGxpc2Vjb25kcygpO1xyXG4gICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgICd1cmwnOiBzZXJ2aWNlVXJsXHJcbiAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpXHJcbiAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgICB9XHJcblxyXG4gICAgICAgICBmdW5jdGlvbiBnZXRBbGxCdXNTdG9wcygpIHtcclxuICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5vbmVNVkFwaVVybCArICdjb21tdXRlci8nICsgRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKSArICcvc3RvcHMvY29tbXV0ZXIvMCc7XHJcbiAgICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICAndXJsJzogc2VydmljZVVybFxyXG4gICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICBmdW5jdGlvbiBnZXRQaWNrdXBGb3JSZXR1cm5UcmlwKGFtUGlja3VwLCBhbUh1Yikge1xyXG4gICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gZW52Lm9uZU1WQXBpVXJsICsgJ2NvbW11dGVyL3BpY2t1cC8nICsgRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKSArICcvJyArIGFtUGlja3VwICsgJy8nICsgYW1IdWI7XHJcbiAgICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICAndXJsJzogc2VydmljZVVybFxyXG4gICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgIH1cclxuXHJcblxyXG5cclxuICAgICAgICAgZnVuY3Rpb24gZ2V0U3BlY2lhbEV2ZW50KHN0b3BJZCwgc2NoZWR1bGUpIHtcclxuICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5vbmVNVkFwaVVybCArICdjb21tdXRlci9zcGVjaWFsRXZlbnQvJyArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCkgKyAgJy8nICsgc3RvcElkICsgJy8nICsgc2NoZWR1bGU7XHJcbiAgICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICAndXJsJzogc2VydmljZVVybFxyXG4gICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgc2V0U3RvcDogc2V0U2VsZWN0ZWRTdG9wLFxyXG4gICAgICAgICAgICBnZXRTdG9wOiBnZXRTZWxlY3RlZFN0b3AsXHJcbiAgICAgICAgICAgIHNldEdlb0xvY2F0aW9uOiBzZXRHZW9Mb2NhdGlvbixcclxuICAgICAgICAgICAgZ2V0R2VvTG9jYXRpb246IGdldEdlb0xvY2F0aW9uLFxyXG4gICAgICAgICAgICBnZXRTdG9wRGV0YWlsczogZ2V0U3RvcERldGFpbHMsXHJcbiAgICAgICAgICAgIGdldEluY2lkZW50c0ZvclN0b3A6IGdldEluY2lkZW50c0ZvclN0b3AsXHJcbiAgICAgICAgICAgIGdldFVzZXJJbmNpZGVudHNGb3JTdG9wOiBnZXRVc2VySW5jaWRlbnRzRm9yU3RvcCxcclxuICAgICAgICAgICAgZ2V0VXNlckluY2lkZW50c0J5SWQ6IGdldFVzZXJJbmNpZGVudHNCeUlkLFxyXG4gICAgICAgICAgICBnZXRWZWhpY2xlOiBnZXRWZWhpY2xlLFxyXG4gICAgICAgICAgICBnZXRJbmNpZGVudDogZ2V0SW5jaWRlbnQsXHJcbiAgICAgICAgICAgIHNldEluY2lkZW50OiBzZXRJbmNpZGVudCxcclxuICAgICAgICAgICAgZ2V0Um91dGU6IGdldFJvdXRlLFxyXG4gICAgICAgICAgICBzZXRSb3V0ZTogc2V0Um91dGUsXHJcbiAgICAgICAgICAgIGdldFZlaGljbGVJZDogZ2V0VmVoaWNsZUlkLFxyXG4gICAgICAgICAgICBzZXRWZWhpY2xlSWQ6IHNldFZlaGljbGVJZCxcclxuICAgICAgICAgICAgY2xlYXJJdGVtOiBjbGVhckl0ZW1Gcm9tU3RvcmFnZSxcclxuICAgICAgICAgICAgZ2V0SHViczogZ2V0SHVicyxcclxuICAgICAgICAgICAgZ2V0QXZhaWxhYmxlUGFya2luZ3NGb3JTdG9wOiBnZXRBdmFpbGFibGVQYXJraW5nc0ZvclN0b3AsXHJcbiAgICAgICAgICAgIGdldE5vblBlcmZvcm1lZFRyaXBzOiBnZXROb25QZXJmb3JtZWRUcmlwcyxcclxuICAgICAgICAgICAgZ2V0RHJvcG9mZnNGb3JTZWxlY3RlZFBpY2t1cDogZ2V0RHJvcG9mZnNGb3JTZWxlY3RlZFBpY2t1cCxcclxuICAgICAgICAgICAgZ2V0VHJpcFRpbWVzRm9yQWR2YW5jZWRSZXNlcnZhdGlvbjogZ2V0VHJpcFRpbWVzRm9yQWR2YW5jZWRSZXNlcnZhdGlvbixcclxuICAgICAgICAgICAgZ2V0TWF4RGF5c0FsbG93ZWRGb3JSZXNlcnZhdGlvbjogZ2V0TWF4RGF5c0FsbG93ZWRGb3JSZXNlcnZhdGlvbixcclxuICAgICAgICAgICAgZ2V0QWxsQnVzU3RvcHM6IGdldEFsbEJ1c1N0b3BzLFxyXG4gICAgICAgICAgICBnZXRQaWNrdXBGb3JSZXR1cm5UcmlwOiBnZXRQaWNrdXBGb3JSZXR1cm5UcmlwLFxyXG4gICAgICAgICAgICBnZXRTcGVjaWFsRXZlbnQ6IGdldFNwZWNpYWxFdmVudFxyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmZhY3RvcnkoJ1ZlaGljbGVEYXRhU2VydmljZScsIFZlaGljbGVEYXRhU2VydmljZSk7XHJcblxyXG4gICAgVmVoaWNsZURhdGFTZXJ2aWNlLiRpbmplY3QgPSBbJyRxJywgJyRodHRwJywgJ2VudicsICckY2FjaGVGYWN0b3J5JywgJ2xvY2FsU3RvcmFnZVNlcnZpY2UnLCAnRGl2aXNpb25TZXJ2aWNlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gVmVoaWNsZURhdGFTZXJ2aWNlKCRxLCAkaHR0cCwgZW52LCAkY2FjaGVGYWN0b3J5LCBsb2NhbFN0b3JhZ2VTZXJ2aWNlLCBEaXZpc2lvblNlcnZpY2UpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBHZXRDb21tdXRlclZlaGljbGVzIDogZ2V0Q29tbXV0ZXJWZWhpY2xlc1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldENvbW11dGVyVmVoaWNsZXModmVoaWNsZXNBcnJheSwgcm91dGVJZClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gZW52Lm9uZU1WQXBpVXJsICsgJ2NvbW11dGVyLycgKyBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpICsgJy9Db21tdXRlclZlaGljbGVzJztcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICd1cmwnOiBzZXJ2aWNlVXJsLFxyXG4gICAgICAgICAgICAgICAgcGFyYW1zOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgJ3ZlaGljbGVJZHMnOiB2ZWhpY2xlc0FycmF5LFxyXG4gICAgICAgICAgICAgICAgICAgICdyb3V0ZUlkJzogcm91dGVJZFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdMYW5kaW5nQ29udHJvbGxlcicsIExhbmRpbmdDb250cm9sbGVyKTtcclxuICAgIExhbmRpbmdDb250cm9sbGVyLiRpbmplY3QgPSBbJyR3aW5kb3cnLCAnJGxvY2F0aW9uJyxcclxuICAgICAgICAnU2NoZWR1bGVTZXJ2aWNlJywgJ3VpR21hcElzUmVhZHknLCAnRGl2aXNpb25TZXJ2aWNlJywgJ1N0b3BTZXJ2aWNlJyxcclxuICAgICAgICAnZ29vZ2xlTWFwc0NvbmZpZycsICdHZW9Mb2NhdGlvblNlcnZpY2UnLCdQYWdlU2VydmljZScsJ09uZU12U2VydmljZXMnXTtcclxuICAgIGZ1bmN0aW9uIExhbmRpbmdDb250cm9sbGVyKCR3aW5kb3csICRsb2NhdGlvbixcclxuICAgICAgICBTY2hlZHVsZVNlcnZpY2UsIHVpR21hcElzUmVhZHksIERpdmlzaW9uU2VydmljZSxTdG9wU2VydmljZSxcclxuICAgICAgICBnb29nbGVNYXBzQ29uZmlnLCBHZW9Mb2NhdGlvblNlcnZpY2UsIFBhZ2VTZXJ2aWNlLE9uZU12U2VydmljZXMpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG5cclxuICAgICAgICBQYWdlU2VydmljZS5zZXRUaXRsZSgnU3RvcHMgLyBSb3V0ZXMnKTtcclxuICAgICAgICBQYWdlU2VydmljZS5zZXRIZWFkbGluZShPbmVNdlNlcnZpY2VzLmdldEZpeGVkUm91dGVJbmZvKCkuYWxpYXMpO1xyXG4gICAgICAgIHZtLm9wdGlvblNlbGVjdGlvbiA9IFwic3RvcFwiO1xyXG4gICAgICAgIHZtLmdvdG9Sb3V0ZXMgPSBnb3RvUm91dGVzO1xyXG4gICAgICAgIHZtLmdvdG9TdG9wcyA9IGdvdG9TdG9wcztcclxuICAgICAgICB2YXIgZGl2aXNpb25JZDtcclxuICAgICAgICB2YXIgZ09iamVjdDtcclxuICAgICAgICB2YXIgY2xvc2VzdFBpbiwgb3RoZXJQaW4sIGxvY2F0aW9uUGluLCBteUxvY2F0aW9uUGluLCBodWJJY29uO1xyXG4gICAgICAgIGlmICgkd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcIlRyaWRlbnRcIikgPiAwIHx8ICR3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiTVNJRVwiKSA+IDApIHtcclxuXHJcbiAgICAgICAgICAgIG15TG9jYXRpb25QaW4gPSAnaW1hZ2VzL3Bpbi1teS1sb2NhdGlvbi5wbmcnO1xyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcblxyXG4gICAgICAgICAgICBteUxvY2F0aW9uUGluID0gJ2ltYWdlcy9waW4tbXktbG9jYXRpb24uc3ZnJztcclxuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZtLnpvb20gPSAxNTtcclxuICAgICAgICB2bS5jZW50ZXIgPSB7XHJcbiAgICAgICAgICAgICAgICBsYXRpdHVkZTogMzkuODA5ODYwLFxyXG4gICAgICAgICAgICAgICAgbG9uZ2l0dWRlOiAtOTguNTU1MTgzXHJcbiAgICAgICAgfTtcclxuICAgICAgICB2bS5teVN0eWxlcyA9IGdvb2dsZU1hcHNDb25maWcubWFwU3R5bGVzO1xyXG4gICAgICAgIHZtLm1hcE9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIG1hcFR5cGVDb250cm9sOiBmYWxzZSxcclxuICAgICAgICAgICAgem9vbUNvbnRyb2w6IGZhbHNlLFxyXG4gICAgICAgICAgICBzdHJlZXRWaWV3Q29udHJvbDogZmFsc2UsXHJcbiAgICAgICAgICAgIHN0eWxlczogdm0ubXlTdHlsZXNcclxuXHJcbiAgICAgICAgfTtcclxuICAgICAgICB2bS5teUxvY2F0aW9uSWNvbiA9IHtcclxuICAgICAgICAgICAgdXJsOiBteUxvY2F0aW9uUGluLFxyXG4gICAgICAgICAgICBzaXplOiBuZXcgZ29vZ2xlLm1hcHMuU2l6ZSg0MiwgNDIpLFxyXG4gICAgICAgICAgICBvcmlnaW46IG5ldyBnb29nbGUubWFwcy5Qb2ludCgwLCAwKSxcclxuICAgICAgICAgICAgYW5jaG9yOiBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQoMjAsIDIwKVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdm0ubWFwQ29udHJvbCA9IHt9O1xyXG4gICAgICAgIHZtLmFsbFN0b3BzID0gW107XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdvdG9Sb3V0ZXMoKSB7XHJcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCdmaXhlZC1yb3V0ZS9hbGxSb3V0ZXMnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdvdG9TdG9wcygpIHtcclxuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJ2ZpeGVkLXJvdXRlL3N0b3BzJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRNYXAoKSB7XHJcbiAgICAgICAgICAgIHVpR21hcElzUmVhZHkucHJvbWlzZSgpLnRoZW4oZnVuY3Rpb24gKG1hcHMpIHtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgR2VvTG9jYXRpb25TZXJ2aWNlLmdldEN1cnJlbnRQb3NpdGlvbigpLnRoZW4oZnVuY3Rpb24gKHBvc2l0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0ucG9zaXRpb24gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvb3Jkczoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF0aXR1ZGU6IHBvc2l0aW9uLmNvb3Jkcy5sYXRpdHVkZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvbmdpdHVkZTogcG9zaXRpb24uY29vcmRzLmxvbmdpdHVkZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpY29uOiB2bS5teUxvY2F0aW9uSWNvblxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uY2VudGVyLmxhdGl0dWRlID0gcG9zaXRpb24uY29vcmRzLmxhdGl0dWRlO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmNlbnRlci5sb25naXR1ZGUgPSBwb3NpdGlvbi5jb29yZHMubG9uZ2l0dWRlO1xyXG4gICAgICAgICAgICAgICAgICAgIGdldFN0b3BzKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnRyaWdnZXIodm0ubWFwQ29udHJvbC5nZXRHTWFwKCksIFwicmVzaXplXCIpO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9wb3NpdGlvbiBlcnJvclxyXG4gICAgICAgICAgICAgICAgICAgIFNjaGVkdWxlU2VydmljZS5nZXRTZXJ2aWNlQXJlYUxvY2F0aW9uKGRpdmlzaW9uSWQpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5jZW50ZXIubGF0aXR1ZGUgPSByZXNwb25zZS5kYXRhLnJlc3VsdC5MYXRpdHVkZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLmNlbnRlci5sb25naXR1ZGUgPSByZXNwb25zZS5kYXRhLnJlc3VsdC5Mb25naXR1ZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5yZXN1bHQuWm9vbUxldmVsICE9PSB1bmRlZmluZWQgJiYgcmVzcG9uc2UuZGF0YS5yZXN1bHQuWm9vbUxldmVsICE9PSBudWxsICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0Llpvb21MZXZlbCAhPSAnJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS56b29tID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQuWm9vbUxldmVsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0U3RvcHMoKTtcclxuICAgICAgICAgICAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC50cmlnZ2VyKHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpLCBcInJlc2l6ZVwiKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcblxyXG5cclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRTdG9wcygpIHtcclxuICAgICAgICAgICAgdmFyIHN0b3BzcyA9IFtdO1xyXG4gICAgICAgICAgICB2YXIgbWFwID0gdm0ubWFwQ29udHJvbC5nZXRHTWFwKCk7XHJcblxyXG4gICAgICAgICAgICBTdG9wU2VydmljZS5nZXRBbGxTdG9wcyhkaXZpc2lvbklkKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIHZhciBhbGxTdG9wcyA9IHJlc3VsdC5kYXRhO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhbGxTdG9wcy5sZW5ndGg7IGkrKykgeyAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3AgPSBhbGxTdG9wc1tpXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwb3NpdGlvbiA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmcoc3RvcC5MYXRpdHVkZSwgc3RvcC5Mb25naXR1ZGUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN0b3BNYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBwb3NpdGlvbixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcDogbWFwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW1pemVkOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGljb246IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiAnTTAsMi45OTQyMDIwOCBDMCwxLjM0MDU0OTkzIDEuMzQzMzExOTcsMCAyLjk5NDIwMjA4LDAgTDE3LjAwNTc5NzksMCBDMTguNjU5NDUwMSwwIDIwLDEuMzQzMzExOTcgMjAsMi45OTQyMDIwOCBMMjAsMTcuMDA1Nzk3OSBDMjAsMTguNjU5NDUwMSAxOC42NTY2ODgsMjAgMTcuMDA1Nzk3OSwyMCBMMi45OTQyMDIwOCwyMCBDMS4zNDA1NDk5MywyMCAwLDE4LjY1NjY4OCAwLDE3LjAwNTc5NzkgTDAsMi45OTQyMDIwOCBaIE02LDIwIEwxMy43NjkwODEyLDIwIEw5Ljc1OTk5OTk5LDIyLjc2IEw2LDIwIFonLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsbE9wYWNpdHk6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsbENvbG9yOiAnI0Y3NkYxRScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlV2VpZ2h0OiAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuY2hvcjogbmV3IGdvb2dsZS5tYXBzLlBvaW50KDksIDIxKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplOiBuZXcgZ29vZ2xlLm1hcHMuU2l6ZSgyMCwgMjMpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgekluZGV4OiA1LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uOiBnb29nbGUubWFwcy5BbmltYXRpb24uRFJPUFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpY29uID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogcG9zaXRpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXA6IG1hcCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGltaXplZDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogJ00wLDAgTDAsMTMuMDg5OTIxNyBDMCwxMy42MzY3MjY5IDAuNDQzNjY3NDU3LDE0LjA4IDEuMDA2NTMyNzQsMTQuMDggTDEuMzEwNDc2MTksMTQuMDggTDEuMzEwNDc2MTksMTYgTDMuMiwxNiBMMy4yLDE0LjA4IEwxMi44LDE0LjA4IEwxMi44LDE2IEwxNC42ODk1MjM4LDE2IEwxNC42ODk1MjM4LDE0LjA4IEwxNC45OTM0NjczLDE0LjA4IEMxNS41NDkzNTk5LDE0LjA4IDE2LDEzLjYyNzQ4MDEgMTYsMTMuMDg5OTIxNyBMMTYsMC45OTAwNzgyNTkgQzE2LDAuNDQzMjczMTM1IDE1LjU1NTM2OTEsMCAxNC45OTkxMjgzLDAgTDAsMCBaIE0xNS40MTM5MTk0LDcuODU1NTcyMzEgQzE1LjQxMzkxOTQsOC4xMjY3OTYyMyAxNS4xODE5MzAxLDguMzQ2NjY2NjcgMTQuOTIyNTIwNyw4LjM0NjY2NjY3IEwxLjEzNjA4NzM4LDguMzQ2NjY2NjcgQzAuODY0Njk1MzU0LDguMzQ2NjY2NjcgMC42NDQ2ODg2NDUsOC4xMjc5MDE0MSAwLjY0NDY4ODY0NSw3Ljg1NTU3MjMxIEwwLjY0NDY4ODY0NSwzLjA3Nzc2MTAzIEMwLjY0NDY4ODY0NSwyLjgwNjUzNzEgMC44NzY2Nzc5OTIsMi41ODY2NjY2NyAxLjEzNjA4NzM4LDIuNTg2NjY2NjcgTDE0LjkyMjUyMDcsMi41ODY2NjY2NyBDMTUuMTkzOTEyNywyLjU4NjY2NjY3IDE1LjQxMzkxOTQsMi44MDU0MzE5MyAxNS40MTM5MTk0LDMuMDc3NzYxMDMgTDE1LjQxMzkxOTQsNy44NTU1NzIzMSBaIE0wLjYxNTM4NDYxNSwxLjEzMTIyMDcgQzAuNjE1Mzg0NjE1LDAuODU5OTI3IDAuODQ3MzczOTYyLDAuNjQgMS4xMDY3ODMzNSwwLjY0IEwxNC44OTMyMTY2LDAuNjQgQzE1LjE2NDYwODcsMC42NCAxNS4zODQ2MTU0LDAuODYyOTU4OTg0IDE1LjM4NDYxNTQsMS4xMzEyMjA3IEwxNS4zODQ2MTU0LDEuNDI4Nzc5MyBDMTUuMzg0NjE1NCwxLjcwMDA3MyAxNS4xNTI2MjYsMS45MiAxNC44OTMyMTY2LDEuOTIgTDEuMTA2NzgzMzUsMS45MiBDMC44MzUzOTEzMjQsMS45MiAwLjYxNTM4NDYxNSwxLjY5NzA0MTAyIDAuNjE1Mzg0NjE1LDEuNDI4Nzc5MyBMMC42MTUzODQ2MTUsMS4xMzEyMjA3IFogTTAuNjE1Mzg0NjE1LDEwLjU2IEMwLjYxNTM4NDYxNSwxMC4wMjk4MDY2IDEuMDQzMjE3NTksOS42IDEuNTcyMDc1ODQsOS42IEwyLjczNTYxNjQ2LDkuNiBDMy4yNjM5ODI0NCw5LjYgMy42OTIzMDc2OSwxMC4wMjYxMTAyIDMuNjkyMzA3NjksMTAuNTYgQzMuNjkyMzA3NjksMTEuMDkwMTkzNCAzLjI2NDQ3NDcyLDExLjUyIDIuNzM1NjE2NDYsMTEuNTIgTDEuNTcyMDc1ODQsMTEuNTIgQzEuMDQzNzA5ODcsMTEuNTIgMC42MTUzODQ2MTUsMTEuMDkzODg5OCAwLjYxNTM4NDYxNSwxMC41NiBaIE0xMi4zMDc2OTIzLDEwLjU2IEMxMi4zMDc2OTIzLDEwLjAyOTgwNjYgMTIuNzM1NTI1Myw5LjYgMTMuMjY0MzgzNSw5LjYgTDE0LjQyNzkyNDIsOS42IEMxNC45NTYyOTAxLDkuNiAxNS4zODQ2MTU0LDEwLjAyNjExMDIgMTUuMzg0NjE1NCwxMC41NiBDMTUuMzg0NjE1NCwxMS4wOTAxOTM0IDE0Ljk1Njc4MjQsMTEuNTIgMTQuNDI3OTI0MiwxMS41MiBMMTMuMjY0MzgzNSwxMS41MiBDMTIuNzM2MDE3NiwxMS41MiAxMi4zMDc2OTIzLDExLjA5Mzg4OTggMTIuMzA3NjkyMywxMC41NiBaIE0xMS40MjM5NTUsMTEuMTk5OTUwNyBDMTEuNjM0MDY1OSwxMS4zNzY3MzYzIDExLjU4NDg4MzksMTEuNTIwMDQ5MyAxMS4zMDUxNjA1LDExLjUyMDA0OTMgTDQuNjk0ODM5NDgsMTEuNTIwMDQ5MyBDNC40MTkxMjAyMiwxMS41MjAwNDkzIDQuMzY4MDE1NDMsMTEuMzc0OTg1MSA0LjU3NjA0NTAzLDExLjE5OTk1MDcgTDQuMTk1NjA1NTksMTEuNTIwMDQ5MyBDNC40MDU3MTY0OSwxMS4zNDMyNjM3IDQuODAzODg3MjUsMTEuMTk5OTUwNyA1LjA2ODUyOTgzLDExLjE5OTk1MDcgTDEwLjkzMTQ3MDIsMTEuMTk5OTUwNyBDMTEuMjAzNDYyLDExLjE5OTk1MDcgMTEuNTk2MzY0OCwxMS4zNDUwMTQ5IDExLjgwNDM5NDQsMTEuNTIwMDQ5MyBMMTEuNDIzOTU1LDExLjE5OTk1MDcgWiBNMTEuNDIzOTU1LDExLjgzOTk1MDcgQzExLjYzNDA2NTksMTIuMDE2NzM2MyAxMS41ODQ4ODM5LDEyLjE2MDA0OTMgMTEuMzA1MTYwNSwxMi4xNjAwNDkzIEw0LjY5NDgzOTQ4LDEyLjE2MDA0OTMgQzQuNDE5MTIwMjIsMTIuMTYwMDQ5MyA0LjM2ODAxNTQzLDEyLjAxNDk4NTEgNC41NzYwNDUwMywxMS44Mzk5NTA3IEw0LjE5NTYwNTU5LDEyLjE2MDA0OTMgQzQuNDA1NzE2NDksMTEuOTgzMjYzNyA0LjgwMzg4NzI1LDExLjgzOTk1MDcgNS4wNjg1Mjk4MywxMS44Mzk5NTA3IEwxMC45MzE0NzAyLDExLjgzOTk1MDcgQzExLjIwMzQ2MiwxMS44Mzk5NTA3IDExLjU5NjM2NDgsMTEuOTg1MDE0OSAxMS44MDQzOTQ0LDEyLjE2MDA0OTMgTDExLjQyMzk1NSwxMS44Mzk5NTA3IFonLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGxDb2xvcjogJyNmZmYnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGxPcGFjaXR5OiAxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cm9rZVdlaWdodDogMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmNob3I6IG5ldyBnb29nbGUubWFwcy5Qb2ludCg3LCAxOSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogbmV3IGdvb2dsZS5tYXBzLlNpemUoMTYsIDE2KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHpJbmRleDogNixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogZ29vZ2xlLm1hcHMuQW5pbWF0aW9uLkRST1BcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2hhZG93ID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogcG9zaXRpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXA6IG1hcCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGltaXplZDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogJ00tNS44MzI1MjU5NywxNC4zMTU1NTQ1IEMtNi4zNTM1MDI5NSwxMy41ODg5OTM4IC01LjQzNTkxMDYsMTMgLTMuNzg5MTc5NzIsMTMgTDEwLjE4NzExNTUsMTMgQzExLjgzNjYwMTUsMTMgMTMuNTk2OTc5NSwxMy41OTAyMDc0IDE0LjExNzA4NjMsMTQuMzE1NTU0NSBMMTguNTMxMzg3NywyMC40NzE3OTE3IEMxOS4wNTIzNjQ3LDIxLjE5ODM1MjQgMTguMTM0NzcyNCwyMS43ODczNDYyIDE2LjQ4ODA0MTUsMjEuNzg3MzQ2MiBMMi41MTE3NDYyNCwyMS43ODczNDYyIEMwLjg2MjI2MDI4MSwyMS43ODczNDYyIC0wLjg5ODExNzc1MSwyMS4xOTcxMzg5IC0xLjQxODIyNDU3LDIwLjQ3MTc5MTcgTC01LjgzMjUyNTk3LDE0LjMxNTU1NDUgWiBNNS41MDk5NzE0LDIxLjc4NzM0NjIgTDEzLjI1OTQ3OTMsMjEuNzg3MzQ2MiBMMTAuMTMwMDI2MywyMyBMNS41MDk5NzE0LDIxLjc4NzM0NjIgWicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsbENvbG9yOiAnIzAwMCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsbE9wYWNpdHk6IDAuMTAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlV2VpZ2h0OiAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuY2hvcjogbmV3IGdvb2dsZS5tYXBzLlBvaW50KDksIDIxKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplOiBuZXcgZ29vZ2xlLm1hcHMuU2l6ZSgyMSwgMTApXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHpJbmRleDogNCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogZ29vZ2xlLm1hcHMuQW5pbWF0aW9uLkRST1BcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgIFxyXG5cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKGNhbGxiYWNrKSB7XHJcblxyXG4gICAgICAgICAgICBkaXZpc2lvbklkID0gRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKTtcclxuICAgICAgICAgICAgaWYgKGRpdmlzaW9uSWQgIT0gbnVsbCAmJiBkaXZpc2lvbklkICE9IHVuZGVmaW5lZCAmJiBkaXZpc2lvbklkICE9ICcnKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2sgJiYgdHlwZW9mIGNhbGxiYWNrID09PSBcImZ1bmN0aW9uXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnZGFzaGJvYXJkLycpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGFjdGl2YXRlKGdldE1hcCk7XHJcblxyXG4gICAgICAgIC8vIFN0YXJ0IG9mIGNvZGUgZm9yIElvbmljXHJcbiAgICAgICAgdm0uaW9uaWNTcGlubmVyID0gJ3NwaXJhbCc7IC8vIG5vbmUgdG8gZGlzYWJsZS5cclxuICAgICAgICB2bS5pb25pY0luY2x1ZGUgPSAnYXBwL21vZHVsZXMvZml4ZWQtcm91dGUvTGFuZGluZy9sYW5kaW5nLmh0bWwnO1xyXG4gICAgICAgIHZtLmlvbmljQ3VzdG9tQ2xhc3NOYW1lID0gJ2lvbmljLWZpeGVkLXJvdXRlLWxhbmRpbmcnO1xyXG4gICAgICAgIHZtLmlvbmljSGlkZU5hdkJhciA9IGZhbHNlO1xyXG4gICAgICAgIHZtLmlvbmljVXNlUmVmcmVzaGVyID0gZmFsc2U7XHJcbiAgICAgICAgLy8gRW5kIG9mIGNvZGUgZm9yIElvbmljXHJcblxyXG4gICAgfVxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignQWxsUm91dGVzQ29udHJvbGxlcicsIEFsbFJvdXRlc0NvbnRyb2xsZXIpO1xyXG4gICAgQWxsUm91dGVzQ29udHJvbGxlci4kaW5qZWN0ID0gWyAnJHNjb3BlJywgJyRmaWx0ZXInLCckbG9jYXRpb24nLCAnJGludGVydmFsJyxcclxuICAgICAgICAnU2NoZWR1bGVTZXJ2aWNlJywgJ3VpR21hcElzUmVhZHknLCAnRGl2aXNpb25TZXJ2aWNlJywgJ1JvdXRlU2VydmljZScsICdTdG9wU2VydmljZScsICdnb29nbGVNYXBzQ29uZmlnJywgJ1BhZ2VTZXJ2aWNlJywnT25lTXZTZXJ2aWNlcyddO1xyXG4gICAgZnVuY3Rpb24gQWxsUm91dGVzQ29udHJvbGxlcigkc2NvcGUsICRmaWx0ZXIsICRsb2NhdGlvbiwgJGludGVydmFsLFxyXG4gICAgICAgIFNjaGVkdWxlU2VydmljZSwgdWlHbWFwSXNSZWFkeSwgRGl2aXNpb25TZXJ2aWNlLCBSb3V0ZVNlcnZpY2UsIFN0b3BTZXJ2aWNlLCBnb29nbGVNYXBzQ29uZmlnLCBQYWdlU2VydmljZSxPbmVNdlNlcnZpY2VzKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2YXIgZGl2aXNpb25JZDtcclxuICAgICAgICB2YXIgYm91bmRzO1xyXG4gICAgICAgIHZhciBpbmZvV2luZG93ID0gbmV3IGdvb2dsZS5tYXBzLkluZm9XaW5kb3coe2NvbnRlbnQ6ICcnfSk7XHJcbiAgICAgICAgdm0uZGlzcGxheVNlbGVjdGVkUm91dGVzID0gZGlzcGxheVNlbGVjdGVkUm91dGVzO1xyXG4gICAgICAgIHZtLmRpc3BsYXlSb3V0ZSA9IGRpc3BsYXlSb3V0ZTtcclxuICAgICAgICB2bS5maWx0ZXJDaGFuZ2UgPSBmaWx0ZXJDaGFuZ2U7XHJcbiAgICAgICAgdm0uZ290b1N0b3BzID0gZ29Ub1N0b3BzO1xyXG4gICAgICAgXHJcbiAgICAgICAgdm0uZGlzcGxheUJ1dHRvbiA9IGRpc3BsYXlCdXR0b247XHJcbiAgICAgICAgdm0uZ29Ub1JvdXRlID0gZ29Ub1JvdXRlO1xyXG4gICAgICAgIHZtLmhpZ2h0bGlnaHRSb3V0ZSA9IGhpZ2h0bGlnaHRSb3V0ZTtcclxuICAgICAgICB2bS56b29tID0gMTU7XHJcbiAgICAgICAgdm0ucm91dGVzID0gW107XHJcbiAgICAgICAgdm0uZmlsdGVyZWRSb3V0ZXMgPSBbXTtcclxuICAgICAgICB2bS5sb2FkaW5nID0gdHJ1ZTtcclxuICAgICAgICB2YXIgdmVoaWNsZVBvbGwgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgdmFyIHZlaGljbGVJY29uTDEgPSAnaW1hZ2VzL21hcmtlci1idXMtbDEuc3ZnJztcclxuICAgICAgICB2bS5QYWdlU2VydmljZSA9IFBhZ2VTZXJ2aWNlO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlLnNldFRpdGxlKCdSb3V0ZXMnKTtcclxuICAgICAgICBQYWdlU2VydmljZS5zZXRIZWFkbGluZShPbmVNdlNlcnZpY2VzLmdldEZpeGVkUm91dGVJbmZvKCkuYWxpYXMpO1xyXG5cclxuICAgICAgICB2bS52ZWhpY2xlcyA9IFtdO1xyXG4gICAgICAgIHZtLmFsbFN0b3BzID0gW107XHJcbiAgICAgICAgdm0udG9TdG9wcyA9IFtdO1xyXG4gICAgICAgIHZtLnJvdXRlc09uTWFwID0gW107XHJcbiAgICAgICAgdm0uY2VudGVyID0ge1xyXG4gICAgICAgICAgICBsYXRpdHVkZTogMzkuODA5ODYwLCBcclxuICAgICAgICAgICAgbG9uZ2l0dWRlOiAtOTguNTU1MTgzXHJcbiAgICAgICAgfTtcclxuICAgICAgICB2bS5teVN0eWxlcyA9IGdvb2dsZU1hcHNDb25maWcubWFwU3R5bGVzO1xyXG4gICAgICAgICAgIFxyXG4gICAgICAgIHZtLm1hcE9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIG1hcFR5cGVDb250cm9sOiBmYWxzZSxcclxuICAgICAgICAgICAgem9vbUNvbnRyb2w6IGZhbHNlLFxyXG4gICAgICAgICAgICBzdHJlZXRWaWV3Q29udHJvbDogZmFsc2UsXHJcbiAgICAgICAgICAgIHN0eWxlczogdm0ubXlTdHlsZXNcclxuXHJcbiAgICAgICAgfTtcclxuICAgICAgICB2bS5tYXBDb250cm9sID0ge307XHJcbiAgICAgICAgXHJcbiAgICAgICAgZnVuY3Rpb24gZmlsdGVyQ2hhbmdlKGl0ZW0pIHtcclxuICAgICAgICAgICAgaWYgKHZtLnNlYXJjaF90ZXh0ID09PSB1bmRlZmluZWQgfHwgdm0uc2VhcmNoX3RleHQgPT09IG51bGwgfHwgdm0uc2VhcmNoX3RleHQudHJpbSgpID09PSAnJylcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICByZXR1cm4gaXRlbS5uYW1lLnRvTG93ZXJDYXNlKCkuaW5kZXhPZih2bS5zZWFyY2hfdGV4dC50b0xvd2VyQ2FzZSgpKSAhPT0gLTEgfHwgaXRlbS5zaG9ydE5hbWUudG9Mb3dlckNhc2UoKS5pbmRleE9mKHZtLnNlYXJjaF90ZXh0LnRvTG93ZXJDYXNlKCkpICE9PSAtMTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgIFxyXG4gICAgICAgIGZ1bmN0aW9uIGRpc3BsYXlCdXR0b24oKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2bS5yb3V0ZXMubGVuZ3RoOyBpKyspXHJcbiAgICAgICAgICAgICAgICBpZiAodm0ucm91dGVzW2ldLmRpc3BsYXlPbk1hcClcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0VmVoaWNsZXNCeVJvdXRlKHJvdXRlSWQpIHtcclxuICAgICAgICAgICAgaWYgKHZtLnJvdXRlc09uTWFwW3JvdXRlSWRdLnZlaGljbGVzICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdm0ucm91dGVzT25NYXBbcm91dGVJZF0udmVoaWNsZXMubGVuZ3RoOyBpKyspXHJcbiAgICAgICAgICAgICAgICAgICAgdm0ucm91dGVzT25NYXBbcm91dGVJZF0udmVoaWNsZXNbaV0uc2V0TWFwKG51bGwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZtLnJvdXRlc09uTWFwW3JvdXRlSWRdLnZlaGljbGVzID0gW107XHJcbiAgICAgICAgICAgUm91dGVTZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICAuZ2V0VmVoaWNsZXNGb3JSb3V0ZShyb3V0ZUlkKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2UuZGF0YSAmJiByZXNwb25zZS5kYXRhLmxlbmd0aCA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXBBY3RpdmVWZWhpY2xlcyhyZXNwb25zZSwgcm91dGVJZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgdmVoaWNsZXNGYWlsdXJlSGFuZGxlcik7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgdm0uaGlnaGxpZ2h0UGFyZW50ID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KGUudGFyZ2V0KS5wYXJlbnQoKS5hZGRDbGFzcygnYWN0aXZlJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZtLmJsdXJQYXJlbnQgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoZS50YXJnZXQpLnBhcmVudCgpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZnVuY3Rpb24gaGlnaHRsaWdodFJvdXRlKHJvdXRlSWQsIHNob3cpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZiAodm0ucm91dGVzT25NYXBbcm91dGVJZF0gIT0gdW5kZWZpbmVkICYmIHZtLnJvdXRlc09uTWFwW3JvdXRlSWRdICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGlmICh2bS5yb3V0ZXNPbk1hcFtyb3V0ZUlkXS5kaXNwbGF5T25NYXApIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpbmRleCBpbiB2bS5yb3V0ZXNPbk1hcFtyb3V0ZUlkXS5saW5lcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2hvdylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnJvdXRlc09uTWFwW3JvdXRlSWRdLmxpbmVzW2luZGV4XS5zZXRPcHRpb25zKHsgc3Ryb2tlT3BhY2l0eTogMC44IH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5yb3V0ZXNPbk1hcFtyb3V0ZUlkXS5saW5lc1tpbmRleF0uc2V0T3B0aW9ucyh7IHN0cm9rZU9wYWNpdHk6IDAuNSB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZnVuY3Rpb24gbWFwQWN0aXZlVmVoaWNsZXMocmVzcG9uc2UsIHJvdXRlSWQpIHtcclxuICAgICAgICAgICBcclxuXHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVzcG9uc2UuZGF0YS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHZlaGljbGVJbmZvID0gcmVzcG9uc2UuZGF0YVtpXTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgdmVoaWNsZSA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIgKHtcclxuICAgICAgICAgICAgICAgICAgICAvL2lkOiB2ZWhpY2xlSW5mby5pZCxcclxuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogbmV3IGdvb2dsZS5tYXBzLkxhdExuZyh2ZWhpY2xlSW5mby5sYXRpdHVkZSwgdmVoaWNsZUluZm8ubG9uZ2l0dWRlKSxcclxuICAgICAgICAgICAgICAgICAgICBtYXA6IHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpLFxyXG4gICAgICAgICAgICAgICAgICAgIG9wdGltaXplZDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgZmxhdDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICBpY29uOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6ICdNMTUuMjQxMzEyMiwyMS4xNTI3ODYxIEwxMSwyNiBMNi43NTg2MTg1NiwyMS4xNTI3MDY5IEMyLjc4OTEwOTU5LDE5LjQ5Mjc1MDYgMCwxNS41NzI4NDc1IDAsMTEgQzAsNC45MjQ4Njc3NSA0LjkyMzUzMiwwIDExLDAgQzE3LjA3NTEzMjIsMCAyMiw0LjkyMzUzMiAyMiwxMSBDMjIsMTUuNTcyMDg0NSAxOS4yMTEzNTE1LDE5LjQ5MjY2ODQgMTUuMjQxMzEyMiwyMS4xNTI3ODYxIFonLC8vZ29vZ2xlLm1hcHMuU3ltYm9sUGF0aC5GT1JXQVJEX0NMT1NFRF9BUlJPVyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGU6IDEuMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsbE9wYWNpdHk6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGxDb2xvcjogJyNmZmYnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHJva2VXZWlnaHQ6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0cm9rZU9wYWNpdHk6IC4zLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByb3RhdGlvbjogdmVoaWNsZUluZm8uaGVhZGluZyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luOiBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQoMCwgMCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuY2hvcjogbmV3IGdvb2dsZS5tYXBzLlBvaW50KHZlaGljbGVJbmZvLmFuY2hvclgsIHZlaGljbGVJbmZvLmFuY2hvclkpLy9nZXRBbmNob3IodmVoaWNsZUluZm8uaGVhZGluZylcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgekluZGV4OiAyXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHZhciB2ZWhpY2xlQ29sb3IgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuICAgICAgICAgICAgICAgICAgICAvL2lkOiB2ZWhpY2xlSW5mby5pZCxcclxuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogbmV3IGdvb2dsZS5tYXBzLkxhdExuZyh2ZWhpY2xlSW5mby5sYXRpdHVkZSwgdmVoaWNsZUluZm8ubG9uZ2l0dWRlKSxcclxuICAgICAgICAgICAgICAgICAgICBtYXA6IHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpLFxyXG4gICAgICAgICAgICAgICAgICAgIGljb246IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogJ00wLDEwIEMwLDQuNDc3MTUyNSA0LjQ3NTkzODE4LDAgMTAsMCBDMTUuNTIyODQ3NSwwIDIwLDQuNDc1OTM4MTggMjAsMTAgQzIwLDE1LjUyMjg0NzUgMTUuNTI0MDYxOCwyMCAxMCwyMCBDNC40NzcxNTI1LDIwIDAsMTUuNTI0MDYxOCAwLDEwIFogTTUsNSBMNSwxMy44IEw1LjgxOTA0NzYyLDEzLjggTDUuODE5MDQ3NjIsMTUgTDcsMTUgTDcsMTMuOCBMMTMsMTMuOCBMMTMsMTUgTDE0LjE4MDk1MjQsMTUgTDE0LjE4MDk1MjQsMTMuOCBMMTUsMTMuOCBMMTUsNSBMNSw1IFogTTE0LjYzMzY5OTYsOS43MTYxMDIwOSBDMTQuNjMzNjk5Niw5Ljk5MjU1NjI3IDE0LjQwNTUyMiwxMC4yMTY2NjY3IDE0LjEzNzQxMzQsMTAuMjE2NjY2NyBMNS44OTkyMTY2NSwxMC4yMTY2NjY3IEM1LjYyNTEyNTMyLDEwLjIxNjY2NjcgNS40MDI5MzA0LDEwLjAwMjI1MTMgNS40MDI5MzA0LDkuNzE2MTAyMDkgTDUuNDAyOTMwNCw3LjExNzIzMTI0IEM1LjQwMjkzMDQsNi44NDA3NzcwNiA1LjYzMTEwNzk5LDYuNjE2NjY2NjcgNS44OTkyMTY2NSw2LjYxNjY2NjY3IEwxNC4xMzc0MTM0LDYuNjE2NjY2NjcgQzE0LjQxMTUwNDcsNi42MTY2NjY2NyAxNC42MzM2OTk2LDYuODMxMDgyMDMgMTQuNjMzNjk5Niw3LjExNzIzMTI0IEwxNC42MzM2OTk2LDkuNzE2MTAyMDkgWiBNNS4zODQ2MTUzOCw1LjggQzUuMzg0NjE1MzgsNS41NzkwODYxIDUuNTYwNzY5NjcsNS40IDUuNzgxMjUsNS40IEwxNC4yMTg3NSw1LjQgQzE0LjQzNzgwNTIsNS40IDE0LjYxNTM4NDYsNS41ODU1NDY4OCAxNC42MTUzODQ2LDUuOCBDMTQuNjE1Mzg0Niw2LjAyMDkxMzkgMTQuNDM5MjMwMyw2LjIgMTQuMjE4NzUsNi4yIEw1Ljc4MTI1LDYuMiBDNS41NjIxOTQ3NSw2LjIgNS4zODQ2MTUzOCw2LjAxNDQ1MzEzIDUuMzg0NjE1MzgsNS44IFogTTUuMzg0NjE1MzgsMTEuNiBDNS4zODQ2MTUzOCwxMS4yNjg2MjkyIDUuNjUyMDEwOTksMTEgNS45OTMwODg5NCwxMSBMNi42OTkyMTg3NSwxMSBDNy4wMzUyNjk0MiwxMSA3LjMwNzY5MjMxLDExLjI3ODMyMDMgNy4zMDc2OTIzMSwxMS42IEM3LjMwNzY5MjMxLDExLjkzMTM3MDggNy4wNDAyOTY3LDEyLjIgNi42OTkyMTg3NSwxMi4yIEw1Ljk5MzA4ODk0LDEyLjIgQzUuNjU3MDM4MjgsMTIuMiA1LjM4NDYxNTM4LDExLjkyMTY3OTcgNS4zODQ2MTUzOCwxMS42IFogTTEyLjY5MjMwNzcsMTEuNiBDMTIuNjkyMzA3NywxMS4yNjg2MjkyIDEyLjk1OTcwMzMsMTEgMTMuMzAwNzgxMiwxMSBMMTQuMDA2OTExMSwxMSBDMTQuMzQyOTYxNywxMSAxNC42MTUzODQ2LDExLjI3ODMyMDMgMTQuNjE1Mzg0NiwxMS42IEMxNC42MTUzODQ2LDExLjkzMTM3MDggMTQuMzQ3OTg5LDEyLjIgMTQuMDA2OTExMSwxMi4yIEwxMy4zMDA3ODEyLDEyLjIgQzEyLjk2NDczMDYsMTIuMiAxMi42OTIzMDc3LDExLjkyMTY3OTcgMTIuNjkyMzA3NywxMS42IFonLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxsT3BhY2l0eTogMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlT3BhY2l0eTogMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsbENvbG9yOiB2bS5yb3V0ZXNPbk1hcFtyb3V0ZUlkXS5yb3V0ZS5jb2xvcixcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGU6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHpJbmRleDogM1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB2bS5yb3V0ZXNPbk1hcFtyb3V0ZUlkXS52ZWhpY2xlcy5wdXNoKHZlaGljbGVDb2xvcik7XHJcbiAgICAgICAgICAgICAgICB2bS5yb3V0ZXNPbk1hcFtyb3V0ZUlkXS52ZWhpY2xlcy5wdXNoKHZlaGljbGUpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHZlaGljbGVzRmFpbHVyZUhhbmRsZXIoKSB7XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgIFxyXG4gICAgICBcclxuICAgICAgICBmdW5jdGlvbiBnZXRTdG9wc0J5Um91dGUocm91dGUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBTdG9wU2VydmljZS5nZXRTdG9wc0J5Um91dGUoZGl2aXNpb25JZCwgcm91dGUuaWQpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHN0b3BzID0gW107XHJcbiAgICAgICAgICAgICAgICB2YXIgcm91dGVTdG9wcyA9IHJlc3VsdC5kYXRhO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByb3V0ZVN0b3BzLmxlbmd0aDsgaSsrKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vaWNvbiBwYXRoIGFsbG93cyB1cyB0byByb3RhdGUgaWNvbi5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RvcCA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogbmV3IGdvb2dsZS5tYXBzLkxhdExuZyhyb3V0ZVN0b3BzW2ldLkxhdGl0dWRlLCByb3V0ZVN0b3BzW2ldLkxvbmdpdHVkZSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGljb246IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6ICdNMCwyLjk5NDIwMjA4IEMwLDEuMzQwNTQ5OTMgMS4zNDMzMTE5NywwIDIuOTk0MjAyMDgsMCBMMTcuMDA1Nzk3OSwwIEMxOC42NTk0NTAxLDAgMjAsMS4zNDMzMTE5NyAyMCwyLjk5NDIwMjA4IEwyMCwxNy4wMDU3OTc5IEMyMCwxOC42NTk0NTAxIDE4LjY1NjY4OCwyMCAxNy4wMDU3OTc5LDIwIEwyLjk5NDIwMjA4LDIwIEMxLjM0MDU0OTkzLDIwIDAsMTguNjU2Njg4IDAsMTcuMDA1Nzk3OSBMMCwyLjk5NDIwMjA4IFogTTYsMjAgTDEzLjc2OTA4MTIsMjAgTDkuNzU5OTk5OTksMjIuNzYgTDYsMjAgWicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxsQ29sb3I6IHZtLnNlbGVjdGVkUm91dGUuY29sb3IsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxsT3BhY2l0eTogMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cm9rZVdlaWdodDogMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuY2hvcjogbmV3IGdvb2dsZS5tYXBzLlBvaW50KDksIDIxKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpemU6IG5ldyBnb29nbGUubWFwcy5TaXplKDIwLCAyMylcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgekluZGV4OjVcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RvcEljb24gPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IG5ldyBnb29nbGUubWFwcy5MYXRMbmcocm91dGVTdG9wc1tpXS5MYXRpdHVkZSwgcm91dGVTdG9wc1tpXS5Mb25naXR1ZGUpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpY29uOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiAnTTAsMCBMMCwxMy4wODk5MjE3IEMwLDEzLjYzNjcyNjkgMC40NDM2Njc0NTcsMTQuMDggMS4wMDY1MzI3NCwxNC4wOCBMMS4zMTA0NzYxOSwxNC4wOCBMMS4zMTA0NzYxOSwxNiBMMy4yLDE2IEwzLjIsMTQuMDggTDEyLjgsMTQuMDggTDEyLjgsMTYgTDE0LjY4OTUyMzgsMTYgTDE0LjY4OTUyMzgsMTQuMDggTDE0Ljk5MzQ2NzMsMTQuMDggQzE1LjU0OTM1OTksMTQuMDggMTYsMTMuNjI3NDgwMSAxNiwxMy4wODk5MjE3IEwxNiwwLjk5MDA3ODI1OSBDMTYsMC40NDMyNzMxMzUgMTUuNTU1MzY5MSwwIDE0Ljk5OTEyODMsMCBMMCwwIFogTTE1LjQxMzkxOTQsNy44NTU1NzIzMSBDMTUuNDEzOTE5NCw4LjEyNjc5NjIzIDE1LjE4MTkzMDEsOC4zNDY2NjY2NyAxNC45MjI1MjA3LDguMzQ2NjY2NjcgTDEuMTM2MDg3MzgsOC4zNDY2NjY2NyBDMC44NjQ2OTUzNTQsOC4zNDY2NjY2NyAwLjY0NDY4ODY0NSw4LjEyNzkwMTQxIDAuNjQ0Njg4NjQ1LDcuODU1NTcyMzEgTDAuNjQ0Njg4NjQ1LDMuMDc3NzYxMDMgQzAuNjQ0Njg4NjQ1LDIuODA2NTM3MSAwLjg3NjY3Nzk5MiwyLjU4NjY2NjY3IDEuMTM2MDg3MzgsMi41ODY2NjY2NyBMMTQuOTIyNTIwNywyLjU4NjY2NjY3IEMxNS4xOTM5MTI3LDIuNTg2NjY2NjcgMTUuNDEzOTE5NCwyLjgwNTQzMTkzIDE1LjQxMzkxOTQsMy4wNzc3NjEwMyBMMTUuNDEzOTE5NCw3Ljg1NTU3MjMxIFogTTAuNjE1Mzg0NjE1LDEuMTMxMjIwNyBDMC42MTUzODQ2MTUsMC44NTk5MjcgMC44NDczNzM5NjIsMC42NCAxLjEwNjc4MzM1LDAuNjQgTDE0Ljg5MzIxNjYsMC42NCBDMTUuMTY0NjA4NywwLjY0IDE1LjM4NDYxNTQsMC44NjI5NTg5ODQgMTUuMzg0NjE1NCwxLjEzMTIyMDcgTDE1LjM4NDYxNTQsMS40Mjg3NzkzIEMxNS4zODQ2MTU0LDEuNzAwMDczIDE1LjE1MjYyNiwxLjkyIDE0Ljg5MzIxNjYsMS45MiBMMS4xMDY3ODMzNSwxLjkyIEMwLjgzNTM5MTMyNCwxLjkyIDAuNjE1Mzg0NjE1LDEuNjk3MDQxMDIgMC42MTUzODQ2MTUsMS40Mjg3NzkzIEwwLjYxNTM4NDYxNSwxLjEzMTIyMDcgWiBNMC42MTUzODQ2MTUsMTAuNTYgQzAuNjE1Mzg0NjE1LDEwLjAyOTgwNjYgMS4wNDMyMTc1OSw5LjYgMS41NzIwNzU4NCw5LjYgTDIuNzM1NjE2NDYsOS42IEMzLjI2Mzk4MjQ0LDkuNiAzLjY5MjMwNzY5LDEwLjAyNjExMDIgMy42OTIzMDc2OSwxMC41NiBDMy42OTIzMDc2OSwxMS4wOTAxOTM0IDMuMjY0NDc0NzIsMTEuNTIgMi43MzU2MTY0NiwxMS41MiBMMS41NzIwNzU4NCwxMS41MiBDMS4wNDM3MDk4NywxMS41MiAwLjYxNTM4NDYxNSwxMS4wOTM4ODk4IDAuNjE1Mzg0NjE1LDEwLjU2IFogTTEyLjMwNzY5MjMsMTAuNTYgQzEyLjMwNzY5MjMsMTAuMDI5ODA2NiAxMi43MzU1MjUzLDkuNiAxMy4yNjQzODM1LDkuNiBMMTQuNDI3OTI0Miw5LjYgQzE0Ljk1NjI5MDEsOS42IDE1LjM4NDYxNTQsMTAuMDI2MTEwMiAxNS4zODQ2MTU0LDEwLjU2IEMxNS4zODQ2MTU0LDExLjA5MDE5MzQgMTQuOTU2NzgyNCwxMS41MiAxNC40Mjc5MjQyLDExLjUyIEwxMy4yNjQzODM1LDExLjUyIEMxMi43MzYwMTc2LDExLjUyIDEyLjMwNzY5MjMsMTEuMDkzODg5OCAxMi4zMDc2OTIzLDEwLjU2IFogTTExLjQyMzk1NSwxMS4xOTk5NTA3IEMxMS42MzQwNjU5LDExLjM3NjczNjMgMTEuNTg0ODgzOSwxMS41MjAwNDkzIDExLjMwNTE2MDUsMTEuNTIwMDQ5MyBMNC42OTQ4Mzk0OCwxMS41MjAwNDkzIEM0LjQxOTEyMDIyLDExLjUyMDA0OTMgNC4zNjgwMTU0MywxMS4zNzQ5ODUxIDQuNTc2MDQ1MDMsMTEuMTk5OTUwNyBMNC4xOTU2MDU1OSwxMS41MjAwNDkzIEM0LjQwNTcxNjQ5LDExLjM0MzI2MzcgNC44MDM4ODcyNSwxMS4xOTk5NTA3IDUuMDY4NTI5ODMsMTEuMTk5OTUwNyBMMTAuOTMxNDcwMiwxMS4xOTk5NTA3IEMxMS4yMDM0NjIsMTEuMTk5OTUwNyAxMS41OTYzNjQ4LDExLjM0NTAxNDkgMTEuODA0Mzk0NCwxMS41MjAwNDkzIEwxMS40MjM5NTUsMTEuMTk5OTUwNyBaIE0xMS40MjM5NTUsMTEuODM5OTUwNyBDMTEuNjM0MDY1OSwxMi4wMTY3MzYzIDExLjU4NDg4MzksMTIuMTYwMDQ5MyAxMS4zMDUxNjA1LDEyLjE2MDA0OTMgTDQuNjk0ODM5NDgsMTIuMTYwMDQ5MyBDNC40MTkxMjAyMiwxMi4xNjAwNDkzIDQuMzY4MDE1NDMsMTIuMDE0OTg1MSA0LjU3NjA0NTAzLDExLjgzOTk1MDcgTDQuMTk1NjA1NTksMTIuMTYwMDQ5MyBDNC40MDU3MTY0OSwxMS45ODMyNjM3IDQuODAzODg3MjUsMTEuODM5OTUwNyA1LjA2ODUyOTgzLDExLjgzOTk1MDcgTDEwLjkzMTQ3MDIsMTEuODM5OTUwNyBDMTEuMjAzNDYyLDExLjgzOTk1MDcgMTEuNTk2MzY0OCwxMS45ODUwMTQ5IDExLjgwNDM5NDQsMTIuMTYwMDQ5MyBMMTEuNDIzOTU1LDExLjgzOTk1MDcgWicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxsQ29sb3I6ICcjZmZmJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGxPcGFjaXR5OiAxLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlV2VpZ2h0OiAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5jaG9yOiBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQoNywgMTkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogbmV3IGdvb2dsZS5tYXBzLlNpemUoMTYsIDE2KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB6SW5kZXg6NlxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdG9wU2hhZG93ID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKHJvdXRlU3RvcHNbaV0uTGF0aXR1ZGUsIHJvdXRlU3RvcHNbaV0uTG9uZ2l0dWRlKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWNvbjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogJ00tNS44MzI1MjU5NywxNC4zMTU1NTQ1IEMtNi4zNTM1MDI5NSwxMy41ODg5OTM4IC01LjQzNTkxMDYsMTMgLTMuNzg5MTc5NzIsMTMgTDEwLjE4NzExNTUsMTMgQzExLjgzNjYwMTUsMTMgMTMuNTk2OTc5NSwxMy41OTAyMDc0IDE0LjExNzA4NjMsMTQuMzE1NTU0NSBMMTguNTMxMzg3NywyMC40NzE3OTE3IEMxOS4wNTIzNjQ3LDIxLjE5ODM1MjQgMTguMTM0NzcyNCwyMS43ODczNDYyIDE2LjQ4ODA0MTUsMjEuNzg3MzQ2MiBMMi41MTE3NDYyNCwyMS43ODczNDYyIEMwLjg2MjI2MDI4MSwyMS43ODczNDYyIC0wLjg5ODExNzc1MSwyMS4xOTcxMzg5IC0xLjQxODIyNDU3LDIwLjQ3MTc5MTcgTC01LjgzMjUyNTk3LDE0LjMxNTU1NDUgWiBNNS41MDk5NzE0LDIxLjc4NzM0NjIgTDEzLjI1OTQ3OTMsMjEuNzg3MzQ2MiBMMTAuMTMwMDI2MywyMyBMNS41MDk5NzE0LDIxLjc4NzM0NjIgWicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxsQ29sb3I6ICcjMDAwJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGxPcGFjaXR5OiAuMTAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJva2VXZWlnaHQ6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmNob3I6IG5ldyBnb29nbGUubWFwcy5Qb2ludCg5LCAyMSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplOiBuZXcgZ29vZ2xlLm1hcHMuU2l6ZSgyMSwgMTApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgekluZGV4OiA0XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RvcC5zZXRNYXAodm0ubWFwQ29udHJvbC5nZXRHTWFwKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHN0b3BJY29uLnNldE1hcCh2bS5tYXBDb250cm9sLmdldEdNYXAoKSk7XHJcbiAgICAgICAgICAgICAgICAgICBzdG9wU2hhZG93LnNldE1hcCh2bS5tYXBDb250cm9sLmdldEdNYXAoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9hZGQgZXZlbnQgbGlzdG5lciB0byBjYWxsIHNlcnZpY2UgYW5kIHJlbmRlciBpbmZvIHdpbmRvdy5cclxuICAgICAgICAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKHN0b3BJY29uLCAnY2xpY2snLCBnZXRBcnJpdmFsc0ZvclN0b3Aocm91dGVTdG9wc1tpXSwgc3RvcCkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzdG9wcy5wdXNoKHN0b3ApO1xyXG4gICAgICAgICAgICAgICAgICAgIHN0b3BzLnB1c2goc3RvcEljb24pO1xyXG4gICAgICAgICAgICAgICAgICAgIHN0b3BzLnB1c2goc3RvcFNoYWRvdyk7XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdm0ucm91dGVzT25NYXBbcm91dGUuaWRdLnN0b3BzID0gc3RvcHM7XHJcbiAgICAgICAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC50cmlnZ2VyKHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpLCBcInJlc2l6ZVwiKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRBcnJpdmFsc0ZvclN0b3Aoc3RvcCwgbWFya2VyKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIFN0b3BTZXJ2aWNlLmdldEFycml2YWxzQnlTdG9wSWQoZGl2aXNpb25JZCwgc3RvcC5JZCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFycml2YWxzID0gcmVzdWx0LmRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbnRlbnQgPSAnPHNwYW4gc3R5bGU9XCJmb250LXdlaWdodDogYm9sZDtcIj4nICsgc3RvcC5OYW1lICsgJzwvc3Bhbj48YnIgLz4nO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyaXZhbHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQgKz0gJzxzcGFuIHN0eWxlPVwiY29sb3I6JyArIGFycml2YWxzW2ldLnJvdXRlLmNvbG9yICsgJztcIj4nICsgYXJyaXZhbHNbaV0ucm91dGUuc2hvcnROYW1lICsgJzwvc3Bhbj48YnIgLz4nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGFycml2YWxzW2ldLnRyaXBzLmxlbmd0aDsgaisrKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudCArPSAnJm5ic3A7Jm5ic3A7JyArIChhcnJpdmFsc1tpXS50cmlwc1tqXS52ZWhpY2xlLm5hbWUgPT0gbnVsbCA/ICdCdXMnIDogYXJyaXZhbHNbaV0udHJpcHNbal0udmVoaWNsZS5uYW1lKSArICcgaW4gJyArIGFycml2YWxzW2ldLnRyaXBzW2pdLmV0YUluTWlucyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgbWludXRlcyA8YnIgLz4nO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoY29udGVudCA9PSAnJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudCA9ICdObyBjdXJyZW50IGFycml2YWxzIGF0IHRoaXMgc3RvcCc7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5mb1dpbmRvdy5zZXRDb250ZW50KGNvbnRlbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGluZm9XaW5kb3cub3Blbih2bS5tYXBDb250cm9sLmdldEdNYXAoKSwgbWFya2VyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgXHJcblxyXG4gICAgICAgIC8vVE9ETzogYWRkIHJlbW92ZSBsaW5lcyBmb3IgY2hlY2sgdW5jaGNlay5cclxuICAgICAgICBmdW5jdGlvbiBkaXNwbGF5U2VsZWN0ZWRSb3V0ZXMoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgYm91bmRzID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZ0JvdW5kcygpO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBydCA9IDA7IHJ0IDwgdm0uZmlsdGVyZWRSb3V0ZXMubGVuZ3RoOyBydCsrKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcm91dGUgPSB2bS5maWx0ZXJlZFJvdXRlc1tydF07XHJcbiAgICAgICAgICAgICAgICBpZihyb3V0ZS5kaXNwbGF5T25NYXApXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWFwUm91dGUocm91dGUpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBoaWRlUm91dGUocm91dGUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBkaXNwbGF5Um91dGUocm91dGUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYgKHJvdXRlLmRpc3BsYXlPbk1hcClcclxuICAgICAgICAgICAgICAgIG1hcFJvdXRlKHJvdXRlKVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICBoaWRlUm91dGUocm91dGUpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICB9XHJcbiAgICAgICAgZnVuY3Rpb24gZGlzcGxheUFsbFZlaGljbGVzKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGZvcih2YXIgcm91dGVJZCBpbiB2bS5yb3V0ZXNPbk1hcClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKHZtLnJvdXRlc09uTWFwW3JvdXRlSWRdLmRpc3BsYXlPbk1hcClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBnZXRWZWhpY2xlc0J5Um91dGUocm91dGVJZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZnVuY3Rpb24gYWRqdXN0TWFwQm91bmRzKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBudW1iZXJPbk1hcCA9IDA7XHJcbiAgICAgICAgICAgIGJvdW5kcyA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmdCb3VuZHMoKTtcclxuICAgICAgICAgICAgZm9yICh2YXIgcm91dGUgaW4gdm0ucm91dGVzT25NYXApXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmICh2bS5yb3V0ZXNPbk1hcFtyb3V0ZV0uZGlzcGxheU9uTWFwKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIG51bWJlck9uTWFwKys7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2bS5yb3V0ZXNPbk1hcFtyb3V0ZV0ubGluZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYm91bmRzLnVuaW9uKGdldExpbmVCb3VuZHModm0ucm91dGVzT25NYXBbcm91dGVdLmxpbmVzW2ldKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKG51bWJlck9uTWFwID4gMCkgXHJcbiAgICAgICAgICAgICAgICB2bS5tYXBDb250cm9sLmdldEdNYXAoKS5maXRCb3VuZHMoYm91bmRzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGhpZGVSb3V0ZShyb3V0ZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmKHZtLnJvdXRlc09uTWFwW3JvdXRlLmlkXSE9IHVuZGVmaW5lZCAmJiB2bS5yb3V0ZXNPbk1hcFtyb3V0ZS5pZF0gIT0gbnVsbClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKHZtLnJvdXRlc09uTWFwW3JvdXRlLmlkXS5kaXNwbGF5T25NYXApIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5yb3V0ZXNPbk1hcFtyb3V0ZS5pZF0uZGlzcGxheU9uTWFwID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2bS5yb3V0ZXNPbk1hcFtyb3V0ZS5pZF0ubGluZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0ucm91dGVzT25NYXBbcm91dGUuaWRdLmxpbmVzW2ldLnNldE1hcChudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2bS5yb3V0ZXNPbk1hcFtyb3V0ZS5pZF0uc3RvcHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0ucm91dGVzT25NYXBbcm91dGUuaWRdLnN0b3BzW2ldLnNldE1hcChudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2bS5yb3V0ZXNPbk1hcFtyb3V0ZS5pZF0udmVoaWNsZXMubGVuZ3RoOyBpKyspXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5yb3V0ZXNPbk1hcFtyb3V0ZS5pZF0udmVoaWNsZXNbaV0uc2V0TWFwKG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB2bS5yb3V0ZXNPbk1hcFtyb3V0ZS5pZF0udmVoaWNsZXMgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICBhZGp1c3RNYXBCb3VuZHMoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBtYXBSb3V0ZShyb3V0ZSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmICh2bS5yb3V0ZXNPbk1hcFtyb3V0ZS5pZF0gIT0gdW5kZWZpbmVkICYmIHZtLnJvdXRlc09uTWFwW3JvdXRlLmlkXSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5yb3V0ZXNPbk1hcFtyb3V0ZS5pZF0uZGlzcGxheU9uTWFwID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdm0ucm91dGVzT25NYXBbcm91dGUuaWRdLmxpbmVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0ucm91dGVzT25NYXBbcm91dGUuaWRdLmxpbmVzW2ldLnNldE1hcCh2bS5tYXBDb250cm9sLmdldEdNYXAoKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZtLnJvdXRlc09uTWFwW3JvdXRlLmlkXS5zdG9wcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnJvdXRlc09uTWFwW3JvdXRlLmlkXS5zdG9wc1tpXS5zZXRNYXAodm0ubWFwQ29udHJvbC5nZXRHTWFwKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBnZXRWZWhpY2xlc0J5Um91dGUocm91dGUuaWQpO1xyXG4gICAgICAgICAgICAgICAgYWRqdXN0TWFwQm91bmRzKCk7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdm0ucm91dGVzT25NYXBbcm91dGUuaWRdID0geyByb3V0ZTogcm91dGUgfTtcclxuICAgICAgICAgICAgICAgIHZhciBsaW5lcyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRSb3V0ZSA9IHJvdXRlO1xyXG4gICAgICAgICAgICAgICAgUm91dGVTZXJ2aWNlLmdldFNoYXBlc0J5Um91dGUocm91dGUuaWQpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzaGFwZXMgPSByZXN1bHQuZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNoYXBlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGVjb2RlZFBhdGggPSBnb29nbGUubWFwcy5nZW9tZXRyeS5lbmNvZGluZy5kZWNvZGVQYXRoKHNoYXBlc1tpXS5saW5lKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsaW5lID0gbmV3IGdvb2dsZS5tYXBzLlBvbHlsaW5lKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6IGRlY29kZWRQYXRoLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlQ29sb3I6IHJvdXRlLmNvbG9yLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlT3BhY2l0eTogMC41LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlV2VpZ2h0OjUsIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbnM6IFt7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWNvbjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiBnb29nbGUubWFwcy5TeW1ib2xQYXRoLkZPUldBUkRfT1BFTl9BUlJPVyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlT3BhY2l0eTogMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsbENvbG9yOiByb3V0ZS5jb2xvcixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsbE9wYWNpdHk6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlOiAyLjVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldDogJzI1cHgnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdDogJzIwMHB4JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHpJbmRleDoxXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbGluZVN0cm9rZSA9IG5ldyBnb29nbGUubWFwcy5Qb2x5bGluZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiBkZWNvZGVkUGF0aCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cm9rZUNvbG9yOiAnI2ZmZicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJva2VPcGFjaXR5OiAxLjAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJva2VXZWlnaHQ6IDgsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB6aW5kZXg6MFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGluZS5zZXRNYXAodm0ubWFwQ29udHJvbC5nZXRHTWFwKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5lU3Ryb2tlLnNldE1hcCh2bS5tYXBDb250cm9sLmdldEdNYXAoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVzLnB1c2gobGluZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVzLnB1c2gobGluZVN0cm9rZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHZtLnJvdXRlc09uTWFwW3JvdXRlLmlkXS5saW5lcyA9IGxpbmVzO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnJvdXRlc09uTWFwW3JvdXRlLmlkXS5kaXNwbGF5T25NYXAgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0U3RvcHNCeVJvdXRlKHJvdXRlKTtcclxuICAgICAgICAgICAgICAgICAgICBnZXRWZWhpY2xlc0J5Um91dGUocm91dGUuaWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGFkanVzdE1hcEJvdW5kcygpO1xyXG5cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBnZXRNYXAoKSB7XHJcbiAgICAgICAgICAgIHVpR21hcElzUmVhZHkucHJvbWlzZSgpLnRoZW4oZnVuY3Rpb24gKG1hcHMpIHtcclxuICAgICAgICAgICAgICAgIFNjaGVkdWxlU2VydmljZS5nZXRTZXJ2aWNlQXJlYUxvY2F0aW9uKGRpdmlzaW9uSWQpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uY2VudGVyLmxhdGl0dWRlID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQuTGF0aXR1ZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmNlbnRlci5sb25naXR1ZGUgPSByZXNwb25zZS5kYXRhLnJlc3VsdC5Mb25naXR1ZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnJlc3VsdC5ab29tTGV2ZWwgIT09IHVuZGVmaW5lZCAmJiByZXNwb25zZS5kYXRhLnJlc3VsdC5ab29tTGV2ZWwgIT09IG51bGxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0Llpvb21MZXZlbCAhPSAnJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS56b29tID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQuWm9vbUxldmVsO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0QWxsUm91dGVzKCk7ICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIGdvVG9Sb3V0ZShyb3V0ZUlkKSB7XHJcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCdmaXhlZC1yb3V0ZS9yb3V0ZS8nICsgcm91dGVJZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIGdvVG9TdG9wcygpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnZml4ZWQtcm91dGUvc3RvcHMnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldExpbmVCb3VuZHMobGluZSkge1xyXG4gICAgICAgICAgICB2YXIgYm91bmQgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nQm91bmRzKCk7XHJcbiAgICAgICAgICAgIGxpbmUuZ2V0UGF0aCgpLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7XHJcbiAgICAgICAgICAgICAgICBib3VuZC5leHRlbmQobmV3IGdvb2dsZS5tYXBzLkxhdExuZyhpdGVtLmxhdCgpLCBpdGVtLmxuZygpKSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gYm91bmQ7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0Um91dGVTdGF0dXMoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgUm91dGVTZXJ2aWNlXHJcbiAgICAgICAgICAgICAgIC5nZXRSb3V0ZXMoKVxyXG4gICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIHZhciByb3V0ZXMgPSByZXN1bHQuZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpbmRleCBpbiByb3V0ZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHIgPSAkZmlsdGVyKCdmaWx0ZXInKSh2bS5maWx0ZXJlZFJvdXRlcywgeyBpZDogcm91dGVzW2luZGV4XS5pZCB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHIsIGZ1bmN0aW9uKHZhbHVlLCBrZXkpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUuSXNBY3RpdmUgPSByb3V0ZXNbaW5kZXhdLklzQWN0aXZlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICAgICBcclxuICAgICAgICBmdW5jdGlvbiBnZXRBbGxSb3V0ZXMoKSB7XHJcbiAgICAgICAgICAgIFJvdXRlU2VydmljZVxyXG4gICAgICAgICAgICAgICAgLmdldFJvdXRlcygpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5yb3V0ZXMgPSByZXN1bHQuZGF0YTsgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uZmlsdGVyZWRSb3V0ZXMgPSB2bS5yb3V0ZXM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcG9sbFZlaGljbGVzRm9yUm91dGUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGZ1bmN0aW9uIGdldEFsbFN0b3BzKCkge1xyXG4gICAgICAgICAgICB2bS5hbGxTdG9wcyA9IFtdO1xyXG4gICAgICAgICAgICB2YXIgc3RvcHNzID0gW107XHJcbiAgICAgICAgICAgIFN0b3BTZXJ2aWNlLmdldEFsbFN0b3BzKCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYWxsU3RvcHMgPSByZXN1bHQuZGF0YTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYWxsU3RvcHMubGVuZ3RoOyBpKyspXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFzdG9wc3MuaW5jbHVkZXMoYWxsU3RvcHNbaV0uSWQpKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uYWxsU3RvcHMucHVzaChhbGxTdG9wc1tpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0b3Bzcy5wdXNoKGFsbFN0b3BzW2ldLklkKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZtLmFsbFN0b3BzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYS5OYW1lID4gYi5OYW1lID8gMSA6IGEuTmFtZSA9PSBiLk5hbWUgPyAwIDogLTE7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHZtLmZpbHRlcmVkU3RvcHMgPSB2bS5hbGxTdG9wcztcclxuXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgXHJcbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XHJcbiAgICAgICAgICAgIGRpdmlzaW9uSWQgPSBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpO1xyXG4gICAgICAgICAgICBnZXRNYXAoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRzY29wZS4kb24oJyRkZXN0cm95JywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIHN0b3BQb2xsaW5nKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHBvbGxWZWhpY2xlc0ZvclJvdXRlKCkge1xyXG4gICAgICAgICAgICB2ZWhpY2xlUG9sbCA9ICRpbnRlcnZhbChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBnZXRSb3V0ZVN0YXR1cygpO1xyXG4gICAgICAgICAgICAgICAgZGlzcGxheUFsbFZlaGljbGVzKCk7XHJcbiAgICAgICAgICAgIH0sIDMwMDAwKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZnVuY3Rpb24gc3RvcFBvbGxpbmcoKSB7XHJcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzRGVmaW5lZCh2ZWhpY2xlUG9sbCkpIHtcclxuICAgICAgICAgICAgICAgICRpbnRlcnZhbC5jYW5jZWwodmVoaWNsZVBvbGwpO1xyXG4gICAgICAgICAgICAgICAgdmVoaWNsZVBvbGwgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgYWN0aXZhdGUoKTtcclxuXHJcbiAgICAgICAgLy8gU3RhcnQgb2YgY29kZSBmb3IgSW9uaWNcclxuICAgICAgICB2bS5pb25pY1NwaW5uZXIgPSAnc3BpcmFsJzsgLy8gbm9uZSB0byBkaXNhYmxlLlxyXG4gICAgICAgIHZtLmlvbmljSW5jbHVkZSA9ICdhcHAvbW9kdWxlcy9maXhlZC1yb3V0ZS9yb3V0ZXMvYWxsLXJvdXRlcy5odG1sJztcclxuICAgICAgICB2bS5pb25pY0N1c3RvbUNsYXNzTmFtZSA9ICdpb25pYy1maXhlZC1yb3V0ZS1hbGwtcm91dGVzJztcclxuICAgICAgICB2bS5pb25pY1VzZUZpeGVkUm91dGVOYXYgPSB0cnVlO1xyXG4gICAgICAgIHZtLmlvbmljSGlkZU5hdkJhciA9IGZhbHNlO1xyXG4gICAgICAgIHZtLmlvbmljVXNlUmVmcmVzaGVyID0gZmFsc2U7XHJcbiAgICAgICAgLy8gRW5kIG9mIGNvZGUgZm9yIElvbmljXHJcbiAgICB9XHJcbiAgXHJcblxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignRnJTY2hlZHVsZUNvbnRyb2xsZXInLCBGclNjaGVkdWxlQ29udHJvbGxlcik7XHJcblxyXG4gICAgRnJTY2hlZHVsZUNvbnRyb2xsZXIuJGluamVjdCA9IFsnJHdpbmRvdycsICdGclNjaGVkdWxlU2VydmljZScsICdTY2hlZHVsZVNlcnZpY2UnLCAnRGl2aXNpb25TZXJ2aWNlJyxcclxuICAgICAnR2VvTG9jYXRpb25TZXJ2aWNlJywgJ2dvb2dsZU1hcHNDb25maWcnLCAndWlHbWFwSXNSZWFkeScsICdQYWdlU2VydmljZScsJ09uZU12U2VydmljZXMnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBGclNjaGVkdWxlQ29udHJvbGxlcigkd2luZG93LCBGclNjaGVkdWxlU2VydmljZSwgU2NoZWR1bGVTZXJ2aWNlLCBEaXZpc2lvblNlcnZpY2UsXHJcbiAgICAgICAgIEdlb0xvY2F0aW9uU2VydmljZSwgZ29vZ2xlTWFwc0NvbmZpZywgdWlHbWFwSXNSZWFkeSwgUGFnZVNlcnZpY2UsT25lTXZTZXJ2aWNlcykge1xyXG4gICAgICAgIC8qIGpzaGludCB2YWxpZHRoaXM6dHJ1ZSAqL1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdm0uc2NoZWR1bGU7XHJcbiAgICAgICAgdmFyIGRpdmlzaW9uSWQ7XHJcbiAgICAgICAgdm0uc2NoZWR1bGVWaWV3O1xyXG4gICAgICAgIHZtLnNob3dCYWNrQnV0dG9uID0gZmFsc2U7XHJcbiAgICAgICAgdm0uc2hvd1RyaXAgPSBzaG93VHJpcDtcclxuICAgICAgICB2bS5zaG93U2NoZWR1bGVzID0gc2hvd1NjaGVkdWxlcztcclxuICAgICAgICB2bS5maWx0ZXJFbXB0eVRpbWVzID0gZmlsdGVyRW1wdHlUaW1lcztcclxuICAgICAgICB2bS5QYWdlU2VydmljZSA9IFBhZ2VTZXJ2aWNlO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlLnNldFRpdGxlKCdTY2hlZHVsZScpO1xyXG4gICAgICAgIFBhZ2VTZXJ2aWNlLnNldEhlYWRsaW5lKE9uZU12U2VydmljZXMuZ2V0Rml4ZWRSb3V0ZUluZm8oKS5hbGlhcyk7XHJcbiAgICAgICAgLy9tYXAgc3R1ZmZcclxuICAgICAgICB2YXIgY2xvc2VzdFBpbiwgb3RoZXJQaW4sIGxvY2F0aW9uUGluLCBteUxvY2F0aW9uUGluLCBodWJJY29uO1xyXG4gICAgICAgIGlmICgkd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcIlRyaWRlbnRcIikgPiAwIHx8ICR3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiTVNJRVwiKSA+IDApIHtcclxuXHJcbiAgICAgICAgICAgIG15TG9jYXRpb25QaW4gPSAnaW1hZ2VzL3Bpbi1teS1sb2NhdGlvbi5wbmcnO1xyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcblxyXG4gICAgICAgICAgICBteUxvY2F0aW9uUGluID0gJ2ltYWdlcy9waW4tbXktbG9jYXRpb24uc3ZnJztcclxuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZtLnpvb20gPSAxNTtcclxuICAgICAgICB2bS5jZW50ZXIgPSB7XHJcbiAgICAgICAgICAgIGxhdGl0dWRlOiA0Ny42MDQzNTYsXHJcbiAgICAgICAgICAgIGxvbmdpdHVkZTogLTEyMi4zMzYwODE3XHJcbiAgICAgICAgfTtcclxuICAgICAgICB2bS5teVN0eWxlcyA9IGdvb2dsZU1hcHNDb25maWcubWFwU3R5bGVzO1xyXG4gICAgICAgIHZtLm1hcE9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIG1hcFR5cGVDb250cm9sOiBmYWxzZSxcclxuICAgICAgICAgICAgem9vbUNvbnRyb2w6IGZhbHNlLFxyXG4gICAgICAgICAgICBzdHJlZXRWaWV3Q29udHJvbDogZmFsc2UsXHJcbiAgICAgICAgICAgIHN0eWxlczogdm0ubXlTdHlsZXNcclxuXHJcbiAgICAgICAgfTtcclxuICAgICAgICB2bS5teUxvY2F0aW9uSWNvbiA9IHtcclxuICAgICAgICAgICAgdXJsOiBteUxvY2F0aW9uUGluLFxyXG4gICAgICAgICAgICBzaXplOiBuZXcgZ29vZ2xlLm1hcHMuU2l6ZSg0MiwgNDIpLFxyXG4gICAgICAgICAgICBvcmlnaW46IG5ldyBnb29nbGUubWFwcy5Qb2ludCgwLCAwKSxcclxuICAgICAgICAgICAgYW5jaG9yOiBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQoMjAsIDIwKVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdm0ubWFwQ29udHJvbCA9IHt9O1xyXG4gICAgICAgIGZ1bmN0aW9uIGdldE1hcCgpIHtcclxuICAgICAgICAgICAgdWlHbWFwSXNSZWFkeS5wcm9taXNlKCkudGhlbihmdW5jdGlvbiAobWFwcykge1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICBHZW9Mb2NhdGlvblNlcnZpY2UuZ2V0Q3VycmVudFBvc2l0aW9uKCkudGhlbihmdW5jdGlvbiAocG9zaXRpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5wb3NpdGlvbiA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29vcmRzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXRpdHVkZTogcG9zaXRpb24uY29vcmRzLmxhdGl0dWRlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9uZ2l0dWRlOiBwb3NpdGlvbi5jb29yZHMubG9uZ2l0dWRlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGljb246IHZtLm15TG9jYXRpb25JY29uXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5jZW50ZXIubGF0aXR1ZGUgPSBwb3NpdGlvbi5jb29yZHMubGF0aXR1ZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uY2VudGVyLmxvbmdpdHVkZSA9IHBvc2l0aW9uLmNvb3Jkcy5sb25naXR1ZGU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnRyaWdnZXIodm0ubWFwQ29udHJvbC5nZXRHTWFwKCksIFwicmVzaXplXCIpO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9wb3NpdGlvbiBlcnJvclxyXG4gICAgICAgICAgICAgICAgICAgIFNjaGVkdWxlU2VydmljZS5nZXRTZXJ2aWNlQXJlYUxvY2F0aW9uKGRpdmlzaW9uSWQpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5jZW50ZXIubGF0aXR1ZGUgPSByZXNwb25zZS5kYXRhLnJlc3VsdC5MYXRpdHVkZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLmNlbnRlci5sb25naXR1ZGUgPSByZXNwb25zZS5kYXRhLnJlc3VsdC5Mb25naXR1ZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy9tYXAgc3R1ZmZcclxuXHJcbiAgICAgICAgYWN0aXZhdGUoKTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XHJcbiAgICAgICAgICAgIGRpdmlzaW9uSWQgPSBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpO1xyXG4gICAgICAgICAgICBpZiAoZGl2aXNpb25JZCAhPSBudWxsICYmIGRpdmlzaW9uSWQgIT0gdW5kZWZpbmVkICYmIGRpdmlzaW9uSWQgIT0gJycpIHtcclxuICAgICAgICAgICAgICAgIHBvcHVsYXRlU2NoZWR1bGUoKTtcclxuICAgICAgICAgICAgICAgIGdldE1hcCgpO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHBvcHVsYXRlU2NoZWR1bGUoKSB7XHJcbiAgICAgICAgICAgIEZyU2NoZWR1bGVTZXJ2aWNlLmdldFNjaGVkdWxlKGRpdmlzaW9uSWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uc2NoZWR1bGUgPSByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uc2NoZWR1bGVWaWV3ID0gYW5ndWxhci5jb3B5KHZtLnNjaGVkdWxlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNob3dTY2hlZHVsZXMoKSB7XHJcbiAgICAgICAgICAgIGlmICh2bS5zY2hlZHVsZSkge1xyXG4gICAgICAgICAgICAgICAgdm0uc2NoZWR1bGVWaWV3ID0gdm0uc2NoZWR1bGU7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBwb3B1bGF0ZVNjaGVkdWxlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdm0uc2hvd0JhY2tCdXR0b24gPSBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNob3dUcmlwKHRyaXBJZCkge1xyXG4gICAgICAgICAgICB2YXIgdHJpcFNjaGVkdWxlO1xyXG4gICAgICAgICAgICBmb3IgKHZhciByID0gMDsgciA8IHZtLnNjaGVkdWxlLnJvdXRlcy5sZW5ndGg7IHIrKykge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgcyA9IDA7IHMgPCB2bS5zY2hlZHVsZS5yb3V0ZXNbcl0uc3RvcHMubGVuZ3RoOyBzKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciB0ID0gMDsgdCA8IHZtLnNjaGVkdWxlLnJvdXRlc1tyXS5zdG9wc1tzXS50cmlwcy5sZW5ndGg7IHQrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodm0uc2NoZWR1bGUucm91dGVzW3JdLnN0b3BzW3NdLnRyaXBzW3RdLmlkID09IHRyaXBJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF0cmlwU2NoZWR1bGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmlwU2NoZWR1bGUgPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmlwU2NoZWR1bGUucm91dGVzID0gW11cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmlwU2NoZWR1bGUucm91dGVzLnB1c2goYW5ndWxhci5jb3B5KHZtLnNjaGVkdWxlLnJvdXRlc1tyXSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyaXBTY2hlZHVsZS5yb3V0ZXNbMF0uc3RvcHMgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmlwU2NoZWR1bGUucm91dGVzWzBdLnN0b3BzLnB1c2goYW5ndWxhci5jb3B5KHZtLnNjaGVkdWxlLnJvdXRlc1tyXS5zdG9wc1tzXSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyaXBTY2hlZHVsZS5yb3V0ZXNbMF0uc3RvcHNbMF0udHJpcHMgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmlwU2NoZWR1bGUucm91dGVzWzBdLnN0b3BzWzBdLnRyaXBzLnB1c2goYW5ndWxhci5jb3B5KHZtLnNjaGVkdWxlLnJvdXRlc1tyXS5zdG9wc1tzXS50cmlwc1t0XSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaXNTdG9wRm91bmQgPSBmYWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIHNzID0gMDsgc3MgPCB0cmlwU2NoZWR1bGUucm91dGVzWzBdLnN0b3BzLmxlbmd0aDsgc3MrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodm0uc2NoZWR1bGUucm91dGVzW3JdLnN0b3BzW3NdLmlkID09IHRyaXBTY2hlZHVsZS5yb3V0ZXNbMF0uc3RvcHNbc3NdLmlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1N0b3BGb3VuZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmlwU2NoZWR1bGUucm91dGVzWzBdLnN0b3BzW3NzXS50cmlwcy5wdXNoKGFuZ3VsYXIuY29weSh2bS5zY2hlZHVsZS5yb3V0ZXNbcl0uc3RvcHNbc10udHJpcHNbdF0pKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzU3RvcEZvdW5kKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyaXBTY2hlZHVsZS5yb3V0ZXNbMF0uc3RvcHMucHVzaChhbmd1bGFyLmNvcHkodm0uc2NoZWR1bGUucm91dGVzW3JdLnN0b3BzW3NdKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyaXBTY2hlZHVsZS5yb3V0ZXNbMF0uc3RvcHNbdHJpcFNjaGVkdWxlLnJvdXRlc1swXS5zdG9wcy5sZW5ndGggLSAxXS50cmlwcyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmlwU2NoZWR1bGUucm91dGVzWzBdLnN0b3BzW3RyaXBTY2hlZHVsZS5yb3V0ZXNbMF0uc3RvcHMubGVuZ3RoIC0gMV0udHJpcHMucHVzaChhbmd1bGFyLmNvcHkodm0uc2NoZWR1bGUucm91dGVzW3JdLnN0b3BzW3NdLnRyaXBzW3RdKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvL0JpbmQgdGhlIHRyaXAgc2NoZWR1bGUgdG8gdGhlIHZpZXdcclxuICAgICAgICAgICAgdm0uc2NoZWR1bGVWaWV3ID0gdHJpcFNjaGVkdWxlO1xyXG4gICAgICAgICAgICB2bS5zaG93QmFja0J1dHRvbiA9IHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBmaWx0ZXJFbXB0eVRpbWVzKHRyaXApIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRyaXAudGltZS5sZW5ndGggPiAwO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy9VSSBJTlRFUkFDVElPTlNcclxuICAgICAgICAvL0FkZHMgYW5kIHJlbW92ZXMgdGhlIGFjdGl2ZSBjbGFzcyB0byB0aGUgcGFyZW50IG9mIGFuIGVsZW1lbnQuXHJcbiAgICAgICAgdm0uaGlnaGxpZ2h0UGFyZW50ID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KGUudGFyZ2V0KS5wYXJlbnQoKS5hZGRDbGFzcygnYWN0aXZlJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZtLmJsdXJQYXJlbnQgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoZS50YXJnZXQpLnBhcmVudCgpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFN0YXJ0IG9mIGNvZGUgZm9yIElvbmljXHJcbiAgICAgICAgdm0uaW9uaWNJbmNsdWRlID0gJ2FwcC9tb2R1bGVzL2ZpeGVkLXJvdXRlL3NjaGVkdWxlL2ZyLXNjaGVkdWxlLmh0bWwnO1xyXG4gICAgICAgIHZtLmlvbmljQ3VzdG9tQ2xhc3NOYW1lID0gJ2lvbmljLWZpeGVkLXJvdXRlLXNjaGVkdWxlJztcclxuICAgICAgICB2bS5pb25pY1VzZUZpeGVkUm91dGVOYXYgPSB0cnVlO1xyXG4gICAgICAgIHZtLmlvbmljSGlkZU5hdkJhciA9IGZhbHNlO1xyXG4gICAgICAgIHZtLmlvbmljVXNlUmVmcmVzaGVyID0gZmFsc2U7XHJcbiAgICAgICAgLy8gRW5kIG9mIGNvZGUgZm9yIElvbmljXHJcblxyXG4gICAgfVxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLnNlcnZpY2UoJ0ZpeGVkUm91dGVOb3RpZmljYXRpb25zU2VydmljZScsIEZpeGVkUm91dGVOb3RpZmljYXRpb25zU2VydmljZSk7XHJcblxyXG4gICAgRml4ZWRSb3V0ZU5vdGlmaWNhdGlvbnNTZXJ2aWNlLiRpbmplY3QgPSBbJyRodHRwJywgJyRxJywgJ2VudiddO1xyXG5cclxuICAgIGZ1bmN0aW9uIEZpeGVkUm91dGVOb3RpZmljYXRpb25zU2VydmljZSgkaHR0cCwgJHEsIGVudikge1xyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgICAgICBnZXQ6IF9nZXRcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBfZ2V0KGRpdmlzaW9uSWQpIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICd1cmwnOiBlbnYub25lTVZGaXhlZFJvdXRlQXBpVXJsICsgXCJub3RpZmljYXRpb25zL1wiICsgZGl2aXNpb25JZFxyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdCgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuc2VydmljZSgnRnJTY2hlZHVsZVNlcnZpY2UnLCBGclNjaGVkdWxlU2VydmljZSk7XHJcblxyXG4gICAgRnJTY2hlZHVsZVNlcnZpY2UuJGluamVjdCA9IFsnJGh0dHAnLCAnJHEnLCAnZW52J107XHJcblxyXG4gICAgZnVuY3Rpb24gRnJTY2hlZHVsZVNlcnZpY2UoJGh0dHAsICRxLCBlbnYpIHtcclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuXHJcbiAgICAgICAgICAgIGdldFNjaGVkdWxlOiBfZ2V0U2NoZWR1bGVcclxuXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gX2dldCh1cmxTZWdtZW50KSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICAndXJsJzogZW52Lm9uZU1WRml4ZWRSb3V0ZUFwaVVybCArIHVybFNlZ21lbnRcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gX2dldFNjaGVkdWxlKGRpdmlzaW9uSWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIF9nZXQoJ3NjaGVkdWxlLycgKyBkaXZpc2lvbklkKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ29uZU1WQXBwJyk7XHJcbiAgICBhcHAuZmFjdG9yeSgnUm91dGVTZXJ2aWNlJywgUm91dGVTZXJ2aWNlKTtcclxuICAgIFJvdXRlU2VydmljZS4kaW5qZWN0ID0gWyckaHR0cCcsICckcScsICdlbnYnLCAnRGl2aXNpb25TZXJ2aWNlJ107XHJcbiAgICBmdW5jdGlvbiBSb3V0ZVNlcnZpY2UoJGh0dHAsICRxLCBlbnYsIERpdmlzaW9uU2VydmljZSlcclxuICAgIHtcclxuICAgICAgICBmdW5jdGlvbiBfZ2V0Um91dGUocm91dGVJZCkge1xyXG4gICAgICAgICAgICB2YXIgZGl2aXNpb25JZCA9IERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCk7XHJcbiAgICAgICAgICAgIHJldHVybiBfZ2V0KHJvdXRlSWQgKyAnLycgKyBkaXZpc2lvbklkKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIF9nZXRSb3V0ZXMoKSB7XHJcbiAgICAgICAgICAgIHZhciBkaXZpc2lvbklkID0gRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKTtcclxuICAgICAgICAgICAgcmV0dXJuIF9nZXQoJ2FsbFJvdXRlcy8nICsgZGl2aXNpb25JZCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBfZ2V0U2hhcGVzQnlSb3V0ZShyb3V0ZUlkKSB7XHJcbiAgICAgICAgICAgIHZhciBkaXZpc2lvbklkID0gRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKTtcclxuICAgICAgICAgICAgcmV0dXJuIF9nZXQoJ3NoYXBlc0J5Um91dGUvJyArIHJvdXRlSWQgKyAnLycgKyBkaXZpc2lvbklkKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIF9nZXRSb3V0ZXNGb3JTdG9wKHN0b3BJZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gX2dldCgncm91dGVzQnlTdG9wLycgKyBzdG9wSWQgKyAnLycgKyBkaXZpc2lvbklkKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIF9nZXRBcnJpdmFsc0ZvclJvdXRlKHJvdXRlSWQsIGRpdmlzaW9uSWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIF9nZXQoZGl2aXNpb25JZCArICcvYXJyaXZhbHNGb3JSb3V0ZS8nICsgcm91dGVJZCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBfZ2V0VmVoaWNsZXNGb3JSb3V0ZShyb3V0ZUlkKSB7XHJcbiAgICAgICAgICAgIHZhciBkaXZpc2lvbklkID0gRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKTtcclxuICAgICAgICAgICAgcmV0dXJuIF9nZXQoZGl2aXNpb25JZCArICcvdmVoaWNsZXNCeVJvdXRlLycgKyByb3V0ZUlkKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBfZ2V0KHVybFNlZ21lbnQpIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICd1cmwnOiBlbnYub25lTVZGaXhlZFJvdXRlQXBpVXJsICsgJ3JvdXRlLycgKyB1cmxTZWdtZW50XHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgZ2V0Um91dGVJbmZvIDogX2dldFJvdXRlLFxyXG4gICAgICAgICAgICBnZXRSb3V0ZXM6IF9nZXRSb3V0ZXMsXHJcbiAgICAgICAgICAgIGdldFNoYXBlc0J5Um91dGU6IF9nZXRTaGFwZXNCeVJvdXRlLFxyXG4gICAgICAgICAgICBnZXRSb3V0ZXNGb3JTdG9wOiBfZ2V0Um91dGVzRm9yU3RvcCxcclxuICAgICAgICAgICAgZ2V0QXJyaXZhbHNGb3JSb3V0ZTogX2dldEFycml2YWxzRm9yUm91dGUsXHJcbiAgICAgICAgICAgIGdldFZlaGljbGVzRm9yUm91dGUgOiBfZ2V0VmVoaWNsZXNGb3JSb3V0ZVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlOyAgICAgICAgXHJcbiAgICB9XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgICAgIC5mYWN0b3J5KCdTdG9wU2VydmljZScsIFN0b3BTZXJ2aWNlKTtcclxuXHJcbiAgICBTdG9wU2VydmljZS4kaW5qZWN0ID0gWyckaHR0cCcsICckcScsICdlbnYnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBTdG9wU2VydmljZSgkaHR0cCwgJHEsIGVudikge1xyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG5cclxuICAgICAgICAgICAgZ2V0U3RvcHNCeVJvdXRlOiBfZ2V0U3RvcHNCeVJvdXRlLFxyXG4gICAgICAgICAgICBnZXRBcnJpdmFsc0ZvclN0b3A6IF9nZXRBcnJpdmFsc0ZvclN0b3AsXHJcbiAgICAgICAgICAgIGdldEFsbFN0b3BzOiBfZ2V0QWxsU3RvcHMsXHJcbiAgICAgICAgICAgIGdldFN0b3BzRm9yU3RvcDogX2dldFN0b3BzRm9yU3RvcCxcclxuICAgICAgICAgICAgZ2V0QXJyaXZhbHNCeVN0b3BJZDogX2dldEFycml2YWxzQnlTdG9wSWQsXHJcbiAgICAgICAgICAgIGdldFVwY29taW5nQXJyaXZhbHNGb3JTdG9wOiBfZ2V0VXBjb21pbmdBcnJpdmFsc0ZvclN0b3BcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBfZ2V0QWxsU3RvcHMoZGl2aXNpb25JZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gX2dldCgnc3RvcHMvJyArIGRpdmlzaW9uSWQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gX2dldFN0b3BzQnlSb3V0ZShkaXZpc2lvbklkLCByb3V0ZUlkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBfZ2V0KCdzdG9wcy8nICsgZGl2aXNpb25JZCArICcvc3RvcHNCeVJvdXRlLycgKyByb3V0ZUlkKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIF9nZXRBcnJpdmFsc0ZvclN0b3AoZGl2aXNpb25JZCwgZnJvbVN0b3BJZCwgdG9TdG9wSWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIF9nZXQoJ3N0b3BzLycgKyBkaXZpc2lvbklkICsgJy9hcnJpdmFsc0J5U3RvcC8nICsgZnJvbVN0b3BJZCArICcvJyArIHRvU3RvcElkKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIF9nZXRVcGNvbWluZ0Fycml2YWxzRm9yU3RvcChkaXZpc2lvbklkLCBmcm9tU3RvcElkLCB0b1N0b3BJZCwgbm9PZkFycml2YWxzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBfZ2V0KCdzdG9wcy8nICsgZGl2aXNpb25JZCArICcvYXJyaXZhbHNCeVN0b3AvJyArIGZyb21TdG9wSWQgKyAnLycgKyB0b1N0b3BJZCArICcvJyArIG5vT2ZBcnJpdmFscyArICc/cm5kPScgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBfZ2V0U3RvcHNGb3JTdG9wKHN0b3BJZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gX2dldCgnc3RvcHNCeVN0b3AvJyArIHN0b3BJZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIF9nZXRBcnJpdmFsc0J5U3RvcElkKGRpdmlzaW9uSWQsIHN0b3BJZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gX2dldCgnc3RvcHMvJyArIGRpdmlzaW9uSWQgKyAnL2Fycml2YWxzLycgKyBzdG9wSWQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICBcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gX2dldCh1cmxTZWdtZW50KSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICAndXJsJzogZW52Lm9uZU1WRml4ZWRSb3V0ZUFwaVVybCArIHVybFNlZ21lbnRcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH0gICAgICAgXHJcbiAgICB9XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ29uZU1WQXBwJyk7XHJcbiAgICBhcHAuZmFjdG9yeSgnVmVoaWNsZVNlcnZpY2UnLCBWZWhpY2xlU2VydmljZSk7XHJcbiAgICBWZWhpY2xlU2VydmljZS4kaW5qZWN0ID0gWyckaHR0cCcsICckcScsICdDb25maWdGYWN0b3J5JywgJ2VudicsICdEaXZpc2lvblNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBWZWhpY2xlU2VydmljZSgkaHR0cCwgJHEsIENvbmZpZ0ZhY3RvcnksIGVudiwgRGl2aXNpb25TZXJ2aWNlKVxyXG4gICAge1xyXG5cclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICBcclxuICAgICAgICAgICAgZ2V0VmVoaWNsZXNGb3JSb3V0ZTogX2dldFZlaGljbGVzRm9yUm91dGVcclxuICAgICAgICBcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG4gICAgICAgIFxyXG4gICAgICAgIFxyXG4gICAgICAgIFxyXG4gICAgICAgIFxyXG4gICAgICAgIGZ1bmN0aW9uIF9nZXRWZWhpY2xlc0ZvclJvdXRlKHJvdXRlSWQpIHtcclxuICAgICAgICAgICAgdmFyIGRpdmlzaW9uSWQgPSBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpO1xyXG4gICAgICAgICAgICB2YXIgdXJsID0gX2dldFVybCgpO1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgJ3VybCc6IHVybCArICdmaXhlZHJvdXRlLycgKyBkaXZpc2lvbklkICsgJy92ZWhpY2xlc0J5Um91dGUvJyArIHJvdXRlSWRcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBfZ2V0VXJsKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHJldHVybiBlbnYub25lTVZGaXhlZFJvdXRlQXBpVXJsO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0ZyU3RvcHNDb250cm9sbGVyJywgRnJTdG9wc0NvbnRyb2xsZXIpO1xyXG5cclxuICAgIEZyU3RvcHNDb250cm9sbGVyLiRpbmplY3QgPSBbJyRsb2NhdGlvbicsICckd2luZG93JywgJ1N0b3BTZXJ2aWNlJywgJ0RpdmlzaW9uU2VydmljZScsICdHZW9Mb2NhdGlvblNlcnZpY2UnLFxyXG4gICAgICAgICdTY2hlZHVsZVNlcnZpY2UnLCAnZ29vZ2xlTWFwc0NvbmZpZycsICd1aUdtYXBJc1JlYWR5JywgJ1JvdXRlU2VydmljZScsICdQYWdlU2VydmljZScsJ09uZU12U2VydmljZXMnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBGclN0b3BzQ29udHJvbGxlcigkbG9jYXRpb24sICR3aW5kb3csIFN0b3BTZXJ2aWNlLCBEaXZpc2lvblNlcnZpY2UsIEdlb0xvY2F0aW9uU2VydmljZSxcclxuICAgICAgICAgU2NoZWR1bGVTZXJ2aWNlLCBnb29nbGVNYXBzQ29uZmlnLCB1aUdtYXBJc1JlYWR5LCBSb3V0ZVNlcnZpY2UsIFBhZ2VTZXJ2aWNlLE9uZU12U2VydmljZXMpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLnNlbGVjdGVkRnJvbVN0b3A7XHJcbiAgICAgICAgdm0uc2VsZWN0ZWRUb1N0b3A7XHJcbiAgICAgICAgdm0uYWxsU3RvcHM7XHJcbiAgICAgICAgdm0uZnJvbVN0b3BzO1xyXG4gICAgICAgIHZtLnRvU3RvcHM7XHJcbiAgICAgICAgdm0ucG9wdWxhdGVGcm9tU3RvcHMgPSBwb3B1bGF0ZUZyb21TdG9wcztcclxuICAgICAgICB2bS5zZWxlY3RGcm9tU3RvcCA9IHNlbGVjdEZyb21TdG9wO1xyXG4gICAgICAgIHZtLnBvcHVsYXRlVG9TdG9wcyA9IHBvcHVsYXRlVG9TdG9wcztcclxuICAgICAgICB2bS5zZWxlY3RUb1N0b3AgPSBzZWxlY3RUb1N0b3A7XHJcbiAgICAgICAgdm0uZ290b1JvdXRlcyA9IGdvdG9Sb3V0ZXM7XHJcbiAgICAgICAgdm0uZ290b1N0b3BzID0gZ290b1N0b3BzO1xyXG4gICAgICAgIHZtLmhhbmRsZUtleVByZXNzID0gaGFuZGxlS2V5UHJlc3M7XHJcbiAgICAgICAgdm0ubWFwUm91dGUgPSBtYXBSb3V0ZTtcclxuICAgICAgICB2bS5jbGVhclBpbnMgPSBjbGVhclBpbnM7XHJcbiAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgIHZtLnVwY29taW5nU2NoZWR1bGVzO1xyXG4gICAgICAgIHZtLnNob3dGcm9tU3RvcHMgPSB0cnVlO1xyXG4gICAgICAgIHZtLnNob3dUb1N0b3BzID0gZmFsc2U7XHJcbiAgICAgICAgdm0uc2hvd1JvdXRlcyA9IGZhbHNlO1xyXG4gICAgICAgIHZtLmRpdmlzaW9uSWQgPSBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpO1xyXG4gICAgICAgIHZhciBmcm9tU3RvcFBpbiA9ICdpbWFnZXMvYnVzLWdyZWVuLnN2Zyc7XHJcbiAgICAgICAgdmFyIHRvU3RvcFBpbiA9ICdpbWFnZXMvYnVzLWRhcmtibHVlLnN2Zyc7XHJcbiAgICAgICAgdmFyIG1hcmtlcnMgPSBbXTtcclxuICAgICAgICB2YXIgYm91bmRzO1xyXG4gICAgICAgIHZtLnJvdXRlc09uTWFwID0gW107XHJcbiAgICAgICAgdm0uYWN0aXZlU2NoZWR1bGU7XHJcbiAgICAgICAgdm0uaXNBbnlSb3V0ZVNlbGVjdGVkID0gZmFsc2U7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2UgPSBQYWdlU2VydmljZTtcclxuICAgICAgICB2bS5QYWdlU2VydmljZS5zZXRUaXRsZSgnU3RvcHMnKTtcclxuICAgICAgICBQYWdlU2VydmljZS5zZXRIZWFkbGluZShPbmVNdlNlcnZpY2VzLmdldEZpeGVkUm91dGVJbmZvKCkuYWxpYXMpO1xyXG4gICAgICAgIC8vdmFyIGluZm9XaW5kb3cgPSBuZXcgZ29vZ2xlLm1hcHMuSW5mb1dpbmRvdyh7IGNvbnRlbnQ6ICcnIH0pO1xyXG5cclxuICAgICAgICBhY3RpdmF0ZSgpO1xyXG5cclxuICAgICAgICAvL21hcCBzdHVmZlxyXG4gICAgICAgIHZhciBjbG9zZXN0UGluLCBvdGhlclBpbiwgbG9jYXRpb25QaW4sIG15TG9jYXRpb25QaW4sIGh1Ykljb247XHJcbiAgICAgICAgaWYgKCR3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiVHJpZGVudFwiKSA+IDAgfHwgJHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXCJNU0lFXCIpID4gMCkge1xyXG5cclxuICAgICAgICAgICAgbXlMb2NhdGlvblBpbiA9ICdpbWFnZXMvcGluLW15LWxvY2F0aW9uLnBuZyc7XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuXHJcbiAgICAgICAgICAgIG15TG9jYXRpb25QaW4gPSAnaW1hZ2VzL3Bpbi1teS1sb2NhdGlvbi5zdmcnO1xyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgdm0uem9vbSA9IDE1O1xyXG4gICAgICAgIHZtLmNlbnRlciA9IHtcclxuICAgICAgICAgICAgbGF0aXR1ZGU6IDQ3LjYwNDM1NixcclxuICAgICAgICAgICAgbG9uZ2l0dWRlOiAtMTIyLjMzNjA4MTdcclxuICAgICAgICB9O1xyXG4gICAgICAgIHZtLm15U3R5bGVzID0gZ29vZ2xlTWFwc0NvbmZpZy5tYXBTdHlsZXM7XHJcbiAgICAgICAgdm0ubWFwT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgbWFwVHlwZUNvbnRyb2w6IGZhbHNlLFxyXG4gICAgICAgICAgICB6b29tQ29udHJvbDogZmFsc2UsXHJcbiAgICAgICAgICAgIHN0cmVldFZpZXdDb250cm9sOiBmYWxzZSxcclxuICAgICAgICAgICAgc3R5bGVzOiB2bS5teVN0eWxlc1xyXG5cclxuICAgICAgICB9O1xyXG4gICAgICAgIHZtLm15TG9jYXRpb25JY29uID0ge1xyXG4gICAgICAgICAgICB1cmw6IG15TG9jYXRpb25QaW4sXHJcbiAgICAgICAgICAgIHNpemU6IG5ldyBnb29nbGUubWFwcy5TaXplKDQyLCA0MiksXHJcbiAgICAgICAgICAgIG9yaWdpbjogbmV3IGdvb2dsZS5tYXBzLlBvaW50KDAsIDApLFxyXG4gICAgICAgICAgICBhbmNob3I6IG5ldyBnb29nbGUubWFwcy5Qb2ludCgyMCwgMjApXHJcbiAgICAgICAgfTtcclxuICAgICAgICB2bS5tYXBDb250cm9sID0ge307XHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0TWFwKCkge1xyXG4gICAgICAgICAgICB1aUdtYXBJc1JlYWR5LnByb21pc2UoKS50aGVuKGZ1bmN0aW9uIChtYXBzKSB7XHJcbiAgICAgICAgICAgICAgICBHZW9Mb2NhdGlvblNlcnZpY2UuZ2V0Q3VycmVudFBvc2l0aW9uKCkudGhlbihmdW5jdGlvbiAocG9zaXRpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5wb3NpdGlvbiA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29vcmRzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXRpdHVkZTogcG9zaXRpb24uY29vcmRzLmxhdGl0dWRlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9uZ2l0dWRlOiBwb3NpdGlvbi5jb29yZHMubG9uZ2l0dWRlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGljb246IHZtLm15TG9jYXRpb25JY29uXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5jZW50ZXIubGF0aXR1ZGUgPSBwb3NpdGlvbi5jb29yZHMubGF0aXR1ZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uY2VudGVyLmxvbmdpdHVkZSA9IHBvc2l0aW9uLmNvb3Jkcy5sb25naXR1ZGU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnRyaWdnZXIodm0ubWFwQ29udHJvbC5nZXRHTWFwKCksIFwicmVzaXplXCIpO1xyXG5cclxuXHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9wb3NpdGlvbiBlcnJvclxyXG4gICAgICAgICAgICAgICAgICAgIFNjaGVkdWxlU2VydmljZS5nZXRTZXJ2aWNlQXJlYUxvY2F0aW9uKHZtLmRpdmlzaW9uSWQpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5jZW50ZXIubGF0aXR1ZGUgPSByZXNwb25zZS5kYXRhLnJlc3VsdC5MYXRpdHVkZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLmNlbnRlci5sb25naXR1ZGUgPSByZXNwb25zZS5kYXRhLnJlc3VsdC5Mb25naXR1ZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0TGluZUJvdW5kcyhsaW5lKSB7XHJcbiAgICAgICAgICAgIHZhciBib3VuZCA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmdCb3VuZHMoKTtcclxuICAgICAgICAgICAgbGluZS5nZXRQYXRoKCkuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHtcclxuICAgICAgICAgICAgICAgIGJvdW5kLmV4dGVuZChuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKGl0ZW0ubGF0KCksIGl0ZW0ubG5nKCkpKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBib3VuZDtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGZ1bmN0aW9uIHNldE1hcEJvdW5kcygpIHtcclxuICAgICAgICAgICAgdmFyIGJvdW5kcyA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmdCb3VuZHMoKTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXJrZXJzLmxlbmd0aDsgaSsrKVxyXG4gICAgICAgICAgICAgICAgYm91bmRzLmV4dGVuZChtYXJrZXJzW2ldLnBvc2l0aW9uKTtcclxuICAgICAgICAgICAgdm0ubWFwQ29udHJvbC5nZXRHTWFwKCkuZml0Qm91bmRzKGJvdW5kcyk7XHJcbiAgICAgICAgICAgIHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpLnNldFpvb20odm0ubWFwQ29udHJvbC5nZXRHTWFwKCkuZ2V0Wm9vbSgpIC0gMSk7XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBhZGp1c3RNYXBCb3VuZHMoKSB7XHJcbiAgICAgICAgICAgIHZhciBudW1iZXJPbk1hcCA9IDA7XHJcbiAgICAgICAgICAgIGJvdW5kcyA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmdCb3VuZHMoKTtcclxuICAgICAgICAgICAgZm9yICh2YXIgcm91dGUgaW4gdm0ucm91dGVzT25NYXApIHtcclxuICAgICAgICAgICAgICAgIGlmICh2bS5yb3V0ZXNPbk1hcFtyb3V0ZV0uZGlzcGxheU9uTWFwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbnVtYmVyT25NYXArKztcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZtLnJvdXRlc09uTWFwW3JvdXRlXS5saW5lcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBib3VuZHMudW5pb24oZ2V0TGluZUJvdW5kcyh2bS5yb3V0ZXNPbk1hcFtyb3V0ZV0ubGluZXNbaV0pKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKG51bWJlck9uTWFwID4gMClcclxuICAgICAgICAgICAgICAgIHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpLmZpdEJvdW5kcyhib3VuZHMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBoaWRlUm91dGVPbk1hcChyb3V0ZSkge1xyXG4gICAgICAgICAgICBpZiAodm0ucm91dGVzT25NYXBbcm91dGUuaWRdICE9IHVuZGVmaW5lZCAmJiB2bS5yb3V0ZXNPbk1hcFtyb3V0ZS5pZF0gIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHZtLnJvdXRlc09uTWFwW3JvdXRlLmlkXS5kaXNwbGF5T25NYXApIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5yb3V0ZXNPbk1hcFtyb3V0ZS5pZF0uZGlzcGxheU9uTWFwID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2bS5yb3V0ZXNPbk1hcFtyb3V0ZS5pZF0ubGluZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0ucm91dGVzT25NYXBbcm91dGUuaWRdLmxpbmVzW2ldLnNldE1hcChudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYWRqdXN0TWFwQm91bmRzKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZnVuY3Rpb24gY2xlYXJBbGxSb3V0ZXNPbk1hcCgpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgciA9IDA7IHIgPCB2bS5yb3V0ZXNPbk1hcC5sZW5ndGg7IHIrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHZtLnJvdXRlc09uTWFwW3JdICE9IHVuZGVmaW5lZCAmJiB2bS5yb3V0ZXNPbk1hcFtyXSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZtLnJvdXRlc09uTWFwW3JdLmRpc3BsYXlPbk1hcCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5yb3V0ZXNPbk1hcFtyXS5kaXNwbGF5T25NYXAgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2bS5yb3V0ZXNPbk1hcFtyXS5saW5lcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0ucm91dGVzT25NYXBbcl0ubGluZXNbaV0uc2V0TWFwKG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFkanVzdE1hcEJvdW5kcygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBzaG93Um91dGVPbk1hcChyb3V0ZSkge1xyXG4gICAgICAgICAgICBpZiAodm0ucm91dGVzT25NYXBbcm91dGUuaWRdICE9IHVuZGVmaW5lZCAmJiB2bS5yb3V0ZXNPbk1hcFtyb3V0ZS5pZF0gIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgdm0ucm91dGVzT25NYXBbcm91dGUuaWRdLmRpc3BsYXlPbk1hcCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZtLnJvdXRlc09uTWFwW3JvdXRlLmlkXS5saW5lcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnJvdXRlc09uTWFwW3JvdXRlLmlkXS5saW5lc1tpXS5zZXRNYXAodm0ubWFwQ29udHJvbC5nZXRHTWFwKCkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYWRqdXN0TWFwQm91bmRzKCk7XHJcblxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdm0ucm91dGVzT25NYXBbcm91dGUuaWRdID0ge1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIHZhciBsaW5lcyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgUm91dGVTZXJ2aWNlLmdldFNoYXBlc0J5Um91dGUocm91dGUuaWQpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzaGFwZXMgPSByZXN1bHQuZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNoYXBlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGVjb2RlZFBhdGggPSBnb29nbGUubWFwcy5nZW9tZXRyeS5lbmNvZGluZy5kZWNvZGVQYXRoKHNoYXBlc1tpXS5saW5lKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vdmFyIGxpbmUgPSBuZXcgZ29vZ2xlLm1hcHMuUG9seWxpbmUoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICBwYXRoOiBkZWNvZGVkUGF0aCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgc3Ryb2tlQ29sb3I6IHJvdXRlLmNvbG9yLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICBzdHJva2VPcGFjaXR5OiAxLjAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIHN0cm9rZVdlaWdodDogMixcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgaWNvbnM6IFt7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICBpY29uOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgcGF0aDogZ29vZ2xlLm1hcHMuU3ltYm9sUGF0aC5GT1JXQVJEX09QRU5fQVJST1dcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgICAgICBvZmZzZXQ6ICcyNXB4JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgIHJlcGVhdDogJzEwMHB4J1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgICB9XVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgLy99KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxpbmUgPSBuZXcgZ29vZ2xlLm1hcHMuUG9seWxpbmUoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogZGVjb2RlZFBhdGgsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJva2VDb2xvcjogcm91dGUuY29sb3IsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJva2VPcGFjaXR5OiAwLjUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJva2VXZWlnaHQ6IDUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uczogW3tcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6IGdvb2dsZS5tYXBzLlN5bWJvbFBhdGguRk9SV0FSRF9PUEVOX0FSUk9XLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJva2VPcGFjaXR5OiAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxsQ29sb3I6IHJvdXRlLmNvbG9yLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxsT3BhY2l0eTogMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGU6IDIuNVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0OiAnMjVweCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwZWF0OiAnMjAwcHgnLFxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1dLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgekluZGV4OiAxXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbGluZVN0cm9rZSA9IG5ldyBnb29nbGUubWFwcy5Qb2x5bGluZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiBkZWNvZGVkUGF0aCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cm9rZUNvbG9yOiAnI2ZmZicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJva2VPcGFjaXR5OiAxLjAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJva2VXZWlnaHQ6IDgsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB6aW5kZXg6IDBcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5lLnNldE1hcCh2bS5tYXBDb250cm9sLmdldEdNYXAoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVTdHJva2Uuc2V0TWFwKHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGluZXMucHVzaChsaW5lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGluZXMucHVzaChsaW5lU3Ryb2tlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdm0ucm91dGVzT25NYXBbcm91dGUuaWRdLmxpbmVzID0gbGluZXM7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0ucm91dGVzT25NYXBbcm91dGUuaWRdLmRpc3BsYXlPbk1hcCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgYWRqdXN0TWFwQm91bmRzKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIGZ1bmN0aW9uIGRyb3BTdG9wTWFya2VyKHN0b3AsIGZyb21Ubykge1xyXG5cclxuICAgICAgICAgIFxyXG4gICAgICAgICAgICB2YXIgc3RvcE1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xyXG4gICAgICAgICAgICAgICAgcG9zaXRpb246IG5ldyBnb29nbGUubWFwcy5MYXRMbmcoc3RvcC5MYXRpdHVkZSwgc3RvcC5Mb25naXR1ZGUpLFxyXG4gICAgICAgICAgICAgICAgb3B0aW1pemVkOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIGljb246IHsgdXJsOiBmcm9tVG8gPT0gXCJmcm9tXCIgPyBmcm9tU3RvcFBpbiA6IHRvU3RvcFBpbiwgc2NhbGVkU2l6ZTogbmV3IGdvb2dsZS5tYXBzLlNpemUoMjgsIDI0KSB9LFxyXG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uOiBnb29nbGUubWFwcy5BbmltYXRpb24uRFJPUFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgc3RvcE1hcmtlci5pZCA9IHN0b3AuSWQ7XHJcbiAgICAgICAgICAgc3RvcE1hcmtlci5zZXRNYXAodm0ubWFwQ29udHJvbC5nZXRHTWFwKCkpO1xyXG4gICAgICAgICAgICBtYXJrZXJzLnB1c2goc3RvcE1hcmtlcik7XHJcbiAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKHN0b3BNYXJrZXIsICdjbGljaycsIHNob3dTdG9wTmFtZVdpbmRvdyhzdG9wLCBzdG9wTWFya2VyKSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBmdW5jdGlvbiBzaG93U3RvcE5hbWVXaW5kb3coc3RvcCwgbWFya2VyKSB7XHJcbiAgICAgICAgICAgIHZhciBpbmZvV2luZG93ID0gbmV3IGdvb2dsZS5tYXBzLkluZm9XaW5kb3coeyBjb250ZW50OiAnJyB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBjb250ZW50ID0gJzxzcGFuIHN0eWxlPVwiZm9udC13ZWlnaHQ6IGJvbGQ7XCI+JyArIHN0b3AuTmFtZSArICc8L3NwYW4+PGJyIC8+JztcclxuICAgICAgICAgICAgICAgIGluZm9XaW5kb3cuc2V0Q29udGVudChjb250ZW50KTtcclxuICAgICAgICAgICAgICAgIGluZm9XaW5kb3cub3Blbih2bS5tYXBDb250cm9sLmdldEdNYXAoKSwgbWFya2VyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgZnVuY3Rpb24gZGVsZXRlTWFya2VyKGlkKSB7XHJcbiAgICAgICAgICAgIC8vRmlyc3QgY2xlYXIgYWxsIHRoZSByb3V0ZXMgb24gdGhlIG1hcFxyXG4gICAgICAgICAgICBjbGVhckFsbFJvdXRlc09uTWFwKCk7XHJcbiAgICAgICAgICAgIC8vRmluZCBhbmQgcmVtb3ZlIHRoZSBtYXJrZXIgZnJvbSB0aGUgQXJyYXlcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXJrZXJzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobWFya2Vyc1tpXS5pZCA9PSBpZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vUmVtb3ZlIHRoZSBtYXJrZXIgZnJvbSBNYXAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICBtYXJrZXJzW2ldLnNldE1hcChudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICAvL1JlbW92ZSB0aGUgbWFya2VyIGZyb20gYXJyYXkuXHJcbiAgICAgICAgICAgICAgICAgICAgbWFya2Vycy5zcGxpY2UoaSwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICAvL21hcCBzdHVmZlxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnb3RvUm91dGVzKCkge1xyXG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnZml4ZWQtcm91dGUvYWxsUm91dGVzJylcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdvdG9TdG9wcygpIHtcclxuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJ2ZpeGVkLXJvdXRlL3N0b3BzJylcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xyXG4gICAgICAgICAgICBpZiAodm0uZGl2aXNpb25JZCAhPSBudWxsICYmIHZtLmRpdmlzaW9uSWQgIT0gdW5kZWZpbmVkICYmIHZtLmRpdmlzaW9uSWQgIT0gJycpIHsgZ2V0TWFwKCk7IH07XHJcbiBcclxuICAgICAgICAgICAgJChcIiN0eHRGcm9tU3RvcE5hbWVcIikucGFyZW50KCkuYWRkQ2xhc3MoJ2FjdGl2ZScpOy8vQWN0aXZhdGUgdGhlIGNsYXNzIHRvIGhpZ2hsaWdodCB0aGUgaW5wdXQgY29udHJvbFxyXG4gICAgICAgICAgICBwb3B1bGF0ZUZyb21TdG9wcygpOy8vTG9hZCB0aGUgZnJvbSBzdG9wc1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy9VSSBJTlRFUkFDVElPTlNcclxuICAgICAgICAvL0FkZHMgYW5kIHJlbW92ZXMgdGhlIGFjdGl2ZSBjbGFzcyB0byB0aGUgcGFyZW50IG9mIGFuIGVsZW1lbnQuXHJcbiAgICAgICAgdm0uaGlnaGxpZ2h0UGFyZW50ID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KGUudGFyZ2V0KS5wYXJlbnQoKS5hZGRDbGFzcygnYWN0aXZlJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZtLmJsdXJQYXJlbnQgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoZS50YXJnZXQpLnBhcmVudCgpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vRml4IHRvIGhhbmRsZSB1c2VyIGhpdHRpbmcgYmFja3NwYWNlIHRvIGNsZWFyIHRoZSBzdG9wLlxyXG4gICAgICAgIGZ1bmN0aW9uIGhhbmRsZUtleVByZXNzKGUsIGZyb21Ubykge1xyXG4gICAgICAgICAgICBpZiAoIChlICYmIGUua2V5Q29kZSA9PT0gOCkgJiYgLy9jaGVjayBmb3IgYmFja3NwYWNlXHJcbiAgICAgICAgICAgICAgICAgKGUuY3VycmVudFRhcmdldCAmJiBlLmN1cnJlbnRUYXJnZXQuc2VsZWN0aW9uU3RhcnQgPT0gMCAmJiBlLmN1cnJlbnRUYXJnZXQuc2VsZWN0aW9uRW5kID09IGUuY3VycmVudFRhcmdldC52YWx1ZS5sZW5ndGgpKSB7IC8vY2hlY2sgd2hlbiBiYWNrc3BhY2UgaXMgaGl0LCBpZiB0aGUgd2hvbGUgdGV4dCBpcyBzZWxlY3RlZFxyXG4gICAgICAgICAgICAgICAgaWYgKGZyb21UbyA9PSBcImZyb21cIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmZyb21TdG9wTmFtZSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJGcm9tU3RvcCgpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS50b1N0b3BOYW1lID0gXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICBjbGVhclRvU3RvcCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcG9wdWxhdGVGcm9tU3RvcHMoKSB7XHJcbiAgICAgICAgICAgIHZtLnNob3dGcm9tU3RvcHMgPSB0cnVlO1xyXG4gICAgICAgICAgICB2bS5zaG93VG9TdG9wcyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB2bS5zaG93Um91dGVzID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICB2bS5mcm9tU3RvcHMgPSBbXTtcclxuICAgICAgICAgICAgaWYgKHZtLnNlbGVjdGVkRnJvbVN0b3ApIHtcclxuICAgICAgICAgICAgICAgICQoXCIjdHh0RnJvbVN0b3BOYW1lXCIpLnNlbGVjdCgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodm0uYWxsU3RvcHMgJiYgdm0uYWxsU3RvcHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGZpbHRlcmVkTGlzdCA9IFtdO1xyXG4gICAgICAgICAgICAgICAgaWYgKHZtLnNlbGVjdGVkVG9TdG9wKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2bS5hbGxTdG9wcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodm0uYWxsU3RvcHNbaV0uSWQgIT0gdm0uc2VsZWN0ZWRUb1N0b3AuSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcmVkTGlzdC5wdXNoKHZtLmFsbFN0b3BzW2ldKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJlZExpc3QgPSB2bS5hbGxTdG9wcztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHZtLmZyb21TdG9wcyA9IGZpbHRlcmVkTGlzdDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIFN0b3BTZXJ2aWNlLmdldEFsbFN0b3BzKHZtLmRpdmlzaW9uSWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uYWxsU3RvcHMgPSByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uZnJvbVN0b3BzID0gdm0uYWxsU3RvcHM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHBvcHVsYXRlVG9TdG9wcygpIHtcclxuICAgICAgICAgICAgdm0uc2hvd0Zyb21TdG9wcyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB2bS5zaG93VG9TdG9wcyA9IHRydWU7XHJcbiAgICAgICAgICAgIHZtLnNob3dSb3V0ZXMgPSBmYWxzZTtcclxuICAgICAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XHJcbiAgICAgICAgICAgIHZtLnRvU3RvcHMgPSBbXTtcclxuICAgICAgICAgICAgaWYgKHZtLnNlbGVjdGVkVG9TdG9wKSB7XHJcbiAgICAgICAgICAgICAgICAkKFwiI3R4dFRvU3RvcE5hbWVcIikuc2VsZWN0KCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh2bS5hbGxTdG9wcyAmJiB2bS5hbGxTdG9wcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZmlsdGVyZWRMaXN0ID0gW107XHJcbiAgICAgICAgICAgICAgICBpZiAodm0uc2VsZWN0ZWRGcm9tU3RvcCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdm0uYWxsU3RvcHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZtLmFsbFN0b3BzW2ldLklkICE9IHZtLnNlbGVjdGVkRnJvbVN0b3AuSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcmVkTGlzdC5wdXNoKHZtLmFsbFN0b3BzW2ldKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJlZExpc3QgPSB2bS5hbGxTdG9wcztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHZtLnRvU3RvcHMgPSBmaWx0ZXJlZExpc3Q7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBTdG9wU2VydmljZS5nZXRBbGxTdG9wcyh2bS5kaXZpc2lvbklkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLmFsbFN0b3BzID0gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnRvU3RvcHMgPSB2bS5hbGxTdG9wcztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2VsZWN0RnJvbVN0b3Aoc3RvcCkge1xyXG4gICAgICAgICAgICBpZiAodm0uc2VsZWN0ZWRGcm9tU3RvcCkgeyBkZWxldGVNYXJrZXIodm0uc2VsZWN0ZWRGcm9tU3RvcC5JZCkgfTtcclxuICAgICAgICAgICAgdm0uc2VsZWN0ZWRGcm9tU3RvcCA9IHN0b3A7XHJcbiAgICAgICAgICAgIHZtLmZyb21TdG9wTmFtZSA9IHZtLnNlbGVjdGVkRnJvbVN0b3AuTmFtZTtcclxuXHJcbiAgICAgICAgICAgIGRyb3BTdG9wTWFya2VyKHN0b3AsIFwiZnJvbVwiKTtcclxuXHJcbiAgICAgICAgICAgIGlmICghdm0uc2VsZWN0ZWRUb1N0b3ApIHtcclxuICAgICAgICAgICAgICAgICQoXCIjdHh0VG9TdG9wTmFtZVwiKS5mb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgJChcIiN0eHRGcm9tU3RvcE5hbWVcIikucGFyZW50KCkucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpOy8vUmVtb3ZlIHRoZSBjbGFzcyB0byBoaWdobGlnaHQgdGhlIGlucHV0IGNvbnRyb2xcclxuICAgICAgICAgICAgICAgICQoXCIjdHh0VG9TdG9wTmFtZVwiKS5wYXJlbnQoKS5hZGRDbGFzcygnYWN0aXZlJyk7Ly9BY3RpdmF0ZSB0aGUgY2xhc3MgdG8gaGlnaGxpZ2h0IHRoZSBpbnB1dCBjb250cm9sXHJcblxyXG4gICAgICAgICAgICAgICAgcG9wdWxhdGVUb1N0b3BzKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzaG93Um91dGVzRm9yU2VsZWN0ZWRTdG9wcygpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2VsZWN0VG9TdG9wKHN0b3ApIHtcclxuICAgICAgICAgICAgaWYgKHZtLnNlbGVjdGVkVG9TdG9wKSB7IGRlbGV0ZU1hcmtlcih2bS5zZWxlY3RlZFRvU3RvcC5JZCkgfTtcclxuICAgICAgICAgICAgdm0uc2VsZWN0ZWRUb1N0b3AgPSBzdG9wO1xyXG4gICAgICAgICAgICB2bS50b1N0b3BOYW1lID0gdm0uc2VsZWN0ZWRUb1N0b3AuTmFtZTtcclxuXHJcbiAgICAgICAgICAgIGRyb3BTdG9wTWFya2VyKHN0b3AsIFwidG9cIik7XHJcblxyXG4gICAgICAgICAgICBpZiAoIXZtLnNlbGVjdGVkRnJvbVN0b3ApIHtcclxuICAgICAgICAgICAgICAgICQoXCIjdHh0RnJvbVN0b3BOYW1lXCIpLmZvY3VzKCk7XHJcbiAgICAgICAgICAgICAgICBwb3B1bGF0ZUZyb21TdG9wcygpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc2hvd1JvdXRlc0ZvclNlbGVjdGVkU3RvcHMoKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBcclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIG1hcFJvdXRlKHNjaGVkdWxlKSB7XHJcbiAgICAgICAgICAgIGlmIChzY2hlZHVsZS5pc1NlbGVjdGVkKSB7XHJcbiAgICAgICAgICAgICAgICBzaG93Um91dGVPbk1hcChzY2hlZHVsZS5yb3V0ZSk7XHJcbiAgICAgICAgICAgICAgICB2bS5hY3RpdmVTY2hlZHVsZSA9IHNjaGVkdWxlO1xyXG4gICAgICAgICAgICAgICAgdm0uaXNBbnlSb3V0ZVNlbGVjdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGhpZGVSb3V0ZU9uTWFwKHNjaGVkdWxlLnJvdXRlKTtcclxuICAgICAgICAgICAgICAgIHZtLmFjdGl2ZVNjaGVkdWxlID0gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2bS5pc0hpZGRlbiA9IHNjaGVkdWxlLmlzU2VsZWN0ZWQ7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY2xlYXJGcm9tU3RvcCgpIHtcclxuICAgICAgICAgICAgZGVsZXRlTWFya2VyKHZtLnNlbGVjdGVkRnJvbVN0b3AuSWQpXHJcbiAgICAgICAgICAgIHZtLnNlbGVjdGVkRnJvbVN0b3AgPSBudWxsO1xyXG4gICAgICAgICAgICBwb3B1bGF0ZUZyb21TdG9wcygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNsZWFyVG9TdG9wKCkge1xyXG4gICAgICAgICAgICBkZWxldGVNYXJrZXIodm0uc2VsZWN0ZWRUb1N0b3AuSWQpXHJcbiAgICAgICAgICAgIHZtLnNlbGVjdGVkVG9TdG9wID0gbnVsbDtcclxuICAgICAgICAgICAgcG9wdWxhdGVUb1N0b3BzKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2hvd1JvdXRlc0ZvclNlbGVjdGVkU3RvcHMoKSB7XHJcbiAgICAgICAgICAgIHNldE1hcEJvdW5kcygpO1xyXG4gICAgICAgICAgICBpZiAoIXZtLnNlbGVjdGVkRnJvbVN0b3ApIHtcclxuICAgICAgICAgICAgICAgICQoXCIjdHh0RnJvbVN0b3BOYW1lXCIpLmZvY3VzKCk7XHJcbiAgICAgICAgICAgICAgICBwb3B1bGF0ZUZyb21TdG9wcygpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgaWYgKCF2bS5zZWxlY3RlZFRvU3RvcCkge1xyXG4gICAgICAgICAgICAgICAgJChcIiN0eHRUb1N0b3BOYW1lXCIpLmZvY3VzKCk7XHJcbiAgICAgICAgICAgICAgICBwb3B1bGF0ZVRvU3RvcHMoKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHZtLnNob3dGcm9tU3RvcHMgPSBmYWxzZTtcclxuICAgICAgICAgICAgdm0uc2hvd1RvU3RvcHMgPSBmYWxzZTtcclxuICAgICAgICAgICAgdm0uc2hvd1JvdXRlcyA9IHRydWU7XHJcbiAgICAgICAgICAgIHZtLmxvYWRpbmdSb3V0ZXMgPSB0cnVlO1xyXG4gICAgICAgICAgICBTdG9wU2VydmljZS5nZXRBcnJpdmFsc0ZvclN0b3Aodm0uZGl2aXNpb25JZCwgdm0uc2VsZWN0ZWRGcm9tU3RvcC5JZCwgdm0uc2VsZWN0ZWRUb1N0b3AuSWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5sb2FkaW5nUm91dGVzID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdm0udXBjb21pbmdTY2hlZHVsZXMgPSByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdm0udXBjb21pbmdTY2hlZHVsZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0udXBjb21pbmdTY2hlZHVsZXNbaV0uaXNTZWxlY3RlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5pc0FueVJvdXRlU2VsZWN0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY2xlYXJQaW5zKCkge1xyXG4gICAgICAgICAgICB2bS5pc0hpZGRlbiA9ICF2bS5pc0hpZGRlbjtcclxuICAgICAgICAgICAgaWYgKCF2bS5pc0hpZGRlbikge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2bS51cGNvbWluZ1NjaGVkdWxlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnVwY29taW5nU2NoZWR1bGVzW2ldLmlzU2VsZWN0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZtLmlzQW55Um91dGVTZWxlY3RlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgY2xlYXJBbGxSb3V0ZXNPbk1hcCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBTdGFydCBvZiBjb2RlIGZvciBJb25pY1xyXG4gICAgICAgIHZtLmlvbmljSW5jbHVkZSA9ICdhcHAvbW9kdWxlcy9maXhlZC1yb3V0ZS9zdG9wcy9mci1zdG9wcy5odG1sJztcclxuICAgICAgICB2bS5pb25pY0N1c3RvbUNsYXNzTmFtZSA9ICdpb25pYy1maXhlZC1yb3V0ZS1zdG9wcyc7XHJcbiAgICAgICAgdm0uaW9uaWNVc2VGaXhlZFJvdXRlTmF2ID0gdHJ1ZTtcclxuICAgICAgICB2bS5pb25pY0hpZGVOYXZCYXIgPSBmYWxzZTtcclxuICAgICAgICB2bS5pb25pY1VzZVJlZnJlc2hlciA9IGZhbHNlO1xyXG4gICAgICAgIC8vIEVuZCBvZiBjb2RlIGZvciBJb25pY1xyXG5cclxuICAgIH1cclxuXHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdTdG9wc0ZvclJvdXRlQ29udHJvbGxlcicsIFN0b3BzRm9yUm91dGVDb250cm9sbGVyKTtcclxuXHJcbiAgICBTdG9wc0ZvclJvdXRlQ29udHJvbGxlci4kaW5qZWN0ID0gWyckc3RhdGUnLCAnJHN0YXRlUGFyYW1zJywgJyRpbnRlcnZhbCcsICckc2NvcGUnLFxyXG4gICAgICAgICdHZW9Mb2NhdGlvblNlcnZpY2UnLCAnZ29vZ2xlTWFwc0NvbmZpZycsICd1aUdtYXBJc1JlYWR5JywgJ1JvdXRlU2VydmljZScsXHJcbiAgICAgICAgICdEaXZpc2lvblNlcnZpY2UnLCAnU2NoZWR1bGVTZXJ2aWNlJywgJ1BvcnRhbFV0aWxpdHlTZXJ2aWNlJywgJ1BhZ2VTZXJ2aWNlJywnT25lTXZTZXJ2aWNlcyddO1xyXG5cclxuICAgIGZ1bmN0aW9uIFN0b3BzRm9yUm91dGVDb250cm9sbGVyKCRzdGF0ZSwgJHN0YXRlUGFyYW1zLCAkaW50ZXJ2YWwsICRzY29wZSxcclxuICAgICAgICBHZW9Mb2NhdGlvblNlcnZpY2UsIGdvb2dsZU1hcHNDb25maWcsIHVpR21hcElzUmVhZHksIFJvdXRlU2VydmljZSxcclxuICAgICAgICAgRGl2aXNpb25TZXJ2aWNlLCBTY2hlZHVsZVNlcnZpY2UsIFBvcnRhbFV0aWxpdHlTZXJ2aWNlLCBQYWdlU2VydmljZSxPbmVNdlNlcnZpY2VzKSB7XHJcblxyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7ICAgICAgICBcclxuICAgICAgICB2YXIgdmVoaWNsZVBvbGwgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgdmFyIGFycml2YWxQb2xsID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHZhciBkaXZpc2lvbklkID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHZhciByb3V0ZUlkID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHZhciB2ZWhpY2xlUG9sbEludGVydmFsID0gMjAwMDA7XHJcbiAgICAgICAgdmFyIGFycml2YWxQb2xsSW50ZXJ2YWwgPSAyMDAwMDtcclxuICAgICAgICB2YXIgZml4ZWRSb3V0ZUxhbmRpbmdSb3V0ZSA9ICdmaXhlZC1yb3V0ZS1sYW5kaW5nJztcclxuICAgICAgICB2YXIgc3RvcHNMb2FkZWQgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2UgPSBQYWdlU2VydmljZTtcclxuICAgICAgICB2bS5QYWdlU2VydmljZS5zZXRUaXRsZSgnU3RvcHMgZm9yIFJvdXRlJyk7XHJcbiAgICAgICAgUGFnZVNlcnZpY2Uuc2V0SGVhZGxpbmUoT25lTXZTZXJ2aWNlcy5nZXRGaXhlZFJvdXRlSW5mbygpLmFsaWFzKTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XHJcbiAgICAgICAgICAgIHZtLnJvdXRlID0ge307XHJcbiAgICAgICAgICAgIHZtLnJvdXRlQXJyaXZhbHMgPSBbXTtcclxuICAgICAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XHJcbiAgICAgICAgICAgIHZtLnZlaGljbGVNYXJrZXJzID0gW107XHJcbiAgICAgICAgICAgIHZtLnNlbGVjdGVkU3RvcElkID0gJyc7XHJcblxyXG4gICAgICAgICAgICB2bS5tYXBDb250cm9sID0ge307XHJcbiAgICAgICAgICAgIHZtLnpvb20gPSAxNTtcclxuICAgICAgICAgICAgdm0uY2VudGVyID0geyBsYXRpdHVkZTogNDcuNjA0MzU2LCBsb25naXR1ZGU6IC0xMjIuMzM2MDgxNyB9O1xyXG4gICAgICAgICAgICB2bS5tYXBPcHRpb25zID0ge1xyXG4gICAgICAgICAgICAgICAgbWFwVHlwZUNvbnRyb2w6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgem9vbUNvbnRyb2w6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgc3RyZWV0Vmlld0NvbnRyb2w6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgc3R5bGVzOiBnb29nbGVNYXBzQ29uZmlnLm1hcFN0eWxlc1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgaWYgKCFQb3J0YWxVdGlsaXR5U2VydmljZS5oYXNWYWx1ZSgkc3RhdGVQYXJhbXMucm91dGVJZCkpXHJcbiAgICAgICAgICAgICAgICAkc3RhdGUuZ28oZml4ZWRSb3V0ZUxhbmRpbmdSb3V0ZSk7XHJcblxyXG4gICAgICAgICAgICByb3V0ZUlkID0gJHN0YXRlUGFyYW1zLnJvdXRlSWQ7XHJcbiAgICAgICAgICAgIGRpdmlzaW9uSWQgPSBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpO1xyXG5cclxuICAgICAgICAgICAgaWYgKCFQb3J0YWxVdGlsaXR5U2VydmljZS5oYXNWYWx1ZShkaXZpc2lvbklkKSlcclxuICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnZGl2aXNpb24nKTtcclxuXHJcbiAgICAgICAgICAgIFJvdXRlU2VydmljZVxyXG4gICAgICAgICAgICAgICAgLmdldFJvdXRlSW5mbyhyb3V0ZUlkKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2UuZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0ucm91dGUgPSByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0TWFwKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKGZpeGVkUm91dGVMYW5kaW5nUm91dGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC50aGVuKGdldFN0b3BBcnJpdmFsc0ZvclJvdXRlKTtcclxuICAgICAgICB9ICAgICAgIFxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFBpblVybCgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFBvcnRhbFV0aWxpdHlTZXJ2aWNlLmlzSUUoKSA/XHJcbiAgICAgICAgICAgICAgICAnaW1hZ2VzL3Bpbi1teS1sb2NhdGlvbi5wbmcnXHJcbiAgICAgICAgICAgICAgICA6ICdpbWFnZXMvcGluLW15LWxvY2F0aW9uLnN2Zyc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRNYXAoKSB7XHJcbiAgICAgICAgICAgIHVpR21hcElzUmVhZHlcclxuICAgICAgICAgICAgICAgIC5wcm9taXNlKClcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihnZXRNYXBJbmZvKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihnZXRTaGFwZUZvclJvdXRlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZ2V0VmVoaWNsZXNGb3JSb3V0ZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihwb2xsVmVoaWNsZXNGb3JSb3V0ZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRNYXBJbmZvKG1hcHMpIHtcclxuICAgICAgICAgICAgR2VvTG9jYXRpb25TZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICAuZ2V0Q3VycmVudFBvc2l0aW9uKClcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihjdXJyZW50UG9zaXRpb25TdWNjZXNzSGFuZGxlciwgY3VycmVudFBvc2l0aW9uRmFpbHVyZUhhbmRsZXIpXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBjdXJyZW50UG9zaXRpb25TdWNjZXNzSGFuZGxlcihwb3NpdGlvbiwgbWFwcykge1xyXG4gICAgICAgICAgICB2bS5wb3NpdGlvbiA9IHtcclxuICAgICAgICAgICAgICAgIGNvb3Jkczoge1xyXG4gICAgICAgICAgICAgICAgICAgIGxhdGl0dWRlOiBwb3NpdGlvbi5jb29yZHMubGF0aXR1ZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgbG9uZ2l0dWRlOiBwb3NpdGlvbi5jb29yZHMubG9uZ2l0dWRlXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgaWNvbjogZ2V0TG9jYXRpb25JY29uKClcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdm0uY2VudGVyLmxhdGl0dWRlID0gcG9zaXRpb24uY29vcmRzLmxhdGl0dWRlO1xyXG4gICAgICAgICAgICB2bS5jZW50ZXIubG9uZ2l0dWRlID0gcG9zaXRpb24uY29vcmRzLmxvbmdpdHVkZTtcclxuXHJcbiAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnRyaWdnZXIodm0ubWFwQ29udHJvbC5nZXRHTWFwKCksIFwicmVzaXplXCIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0TG9jYXRpb25JY29uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgdXJsOiBnZXRQaW5VcmwoKSxcclxuICAgICAgICAgICAgICAgIHNpemU6IG5ldyBnb29nbGUubWFwcy5TaXplKDQyLCA0MiksXHJcbiAgICAgICAgICAgICAgICBvcmlnaW46IG5ldyBnb29nbGUubWFwcy5Qb2ludCgwLCAwKSxcclxuICAgICAgICAgICAgICAgIGFuY2hvcjogbmV3IGdvb2dsZS5tYXBzLlBvaW50KDIwLCAyMClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGN1cnJlbnRQb3NpdGlvbkZhaWx1cmVIYW5kbGVyKGVycikge1xyXG4gICAgICAgICAgICBTY2hlZHVsZVNlcnZpY2UuZ2V0U2VydmljZUFyZWFMb2NhdGlvbihkaXZpc2lvbklkKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5jZW50ZXIubGF0aXR1ZGUgPSByZXNwb25zZS5kYXRhLnJlc3VsdC5MYXRpdHVkZTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5jZW50ZXIubG9uZ2l0dWRlID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQuTG9uZ2l0dWRlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFZlaGljbGVzRm9yUm91dGUoKSB7XHJcbiAgICAgICAgICAgIFJvdXRlU2VydmljZVxyXG4gICAgICAgICAgICAgICAgLmdldFZlaGljbGVzRm9yUm91dGUocm91dGVJZClcclxuICAgICAgICAgICAgICAgICAgICAudGhlbih2ZWhpY2xlc1N1Y2Nlc3NIYW5kbGVyLCB2ZWhpY2xlc0ZhaWx1cmVIYW5kbGVyKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiB2ZWhpY2xlc1N1Y2Nlc3NIYW5kbGVyKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEubGVuZ3RoID4gMClcclxuICAgICAgICAgICAgICAgIG1hcEFjdGl2ZVZlaGljbGVzKHJlc3BvbnNlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIG1hcEFjdGl2ZVZlaGljbGVzKHJlc3BvbnNlKSB7XHJcblxyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJlc3BvbnNlLmRhdGEubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciB2ZWhpY2xlSW5mbyA9IHJlc3BvbnNlLmRhdGFbaV07ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGNvbnRhaW5zKHZtLnZlaGljbGVNYXJrZXJzLCB2ZWhpY2xlSW5mby5pZCkgPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBwb3NpdGlvbiA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmcodmVoaWNsZUluZm8ubGF0aXR1ZGUsIHZlaGljbGVJbmZvLmxvbmdpdHVkZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZU1hcmtlcnModmVoaWNsZUluZm8pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGhlYWRpbmdNYXJrZXIgPSBnZXRIZWFkaW5nTWFya2VyKHZlaGljbGVJbmZvKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdmVoaWNsZU1hcmtlciA9IGdldFZlaGljbGVNYXJrZXIodmVoaWNsZUluZm8pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2bS52ZWhpY2xlTWFya2Vycy5wdXNoKGhlYWRpbmdNYXJrZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnZlaGljbGVNYXJrZXJzLnB1c2godmVoaWNsZU1hcmtlcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiB1cGRhdGVNYXJrZXJzKHZlaGljbGVJbmZvKSB7XHJcbiAgICAgICAgICAgIHZhciBtYXJrZXJzID0gZmluZEFsbCh2bS52ZWhpY2xlTWFya2VycywgdmVoaWNsZUluZm8uaWQpO1xyXG4gICAgICAgICAgICB2YXIgbWFwID0gdm0ubWFwQ29udHJvbC5nZXRHTWFwKCk7XHJcbiAgICAgICAgICAgIHZhciBwb3NpdGlvbiA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmcodmVoaWNsZUluZm8ubGF0aXR1ZGUsIHZlaGljbGVJbmZvLmxvbmdpdHVkZSk7XHJcblxyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1hcmtlcnMubGVuZ3RoOyBpKyspIHtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgbWFya2VyID0gbWFya2Vyc1tpXTtcclxuICAgICAgICAgICAgICAgIGlmIChtYXJrZXIubWFya2VyVHlwZSA9PT0gJ2hlYWRpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGljb24gPSBtYXJrZXIuZ2V0SWNvbigpO1xyXG4gICAgICAgICAgICAgICAgICAgIGljb24ucm90YXRpb24gPSB2ZWhpY2xlSW5mby5oZWFkaW5nO1xyXG4gICAgICAgICAgICAgICAgICAgIGljb24uYW5jaG9yID0gbmV3IGdvb2dsZS5tYXBzLlBvaW50KHZlaGljbGVJbmZvLmFuY2hvclgsIHZlaGljbGVJbmZvLmFuY2hvclkpLy9nZXRBbmNob3IoaGVhZGluZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWNvbi5vcmlnaW4gPSBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQoMCwgMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgbWFya2VyLnNldEljb24oaWNvbik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICAgICAgbWFya2VyLnNldER1cmF0aW9uKHZlaGljbGVQb2xsSW50ZXJ2YWwpO1xyXG4gICAgICAgICAgICAgICAgbWFya2VyLnNldFBvc2l0aW9uKHBvc2l0aW9uKTtcclxuXHJcbiAgICAgICAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC50cmlnZ2VyKG1hcCwgXCJyZXNpemVcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldEhlYWRpbmdNYXJrZXIodmVoaWNsZUluZm8pIHsgICAgICAgICAgICBcclxuICAgICAgICAgICAgdmFyIG1hcCA9IHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpO1xyXG4gICAgICAgICAgICB2YXIgcG9zaXRpb24gPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKHZlaGljbGVJbmZvLmxhdGl0dWRlLCB2ZWhpY2xlSW5mby5sb25naXR1ZGUpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xyXG4gICAgICAgICAgICAgICAgaWQ6IHZlaGljbGVJbmZvLmlkLFxyXG4gICAgICAgICAgICAgICAgbWFya2VyVHlwZTogJ2hlYWRpbmcnLFxyXG4gICAgICAgICAgICAgICAgcG9zaXRpb246IHBvc2l0aW9uLFxyXG4gICAgICAgICAgICAgICAgbWFwOiBtYXAsXHJcbiAgICAgICAgICAgICAgICBmbGF0OnRydWUsXHJcbiAgICAgICAgICAgICAgICBpY29uOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGF0aDogJ00xNS4yNDEzMTIyLDIxLjE1Mjc4NjEgTDExLDI2IEw2Ljc1ODYxODU2LDIxLjE1MjcwNjkgQzIuNzg5MTA5NTksMTkuNDkyNzUwNiAwLDE1LjU3Mjg0NzUgMCwxMSBDMCw0LjkyNDg2Nzc1IDQuOTIzNTMyLDAgMTEsMCBDMTcuMDc1MTMyMiwwIDIyLDQuOTIzNTMyIDIyLDExIEMyMiwxNS41NzIwODQ1IDE5LjIxMTM1MTUsMTkuNDkyNjY4NCAxNS4yNDEzMTIyLDIxLjE1Mjc4NjEgWicsLy9nb29nbGUubWFwcy5TeW1ib2xQYXRoLkZPUldBUkRfQ0xPU0VEX0FSUk9XLFxyXG4gICAgICAgICAgICAgICAgICAgIHNjYWxlOiAxLjEsXHJcbiAgICAgICAgICAgICAgICAgICAgZmlsbE9wYWNpdHk6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgZmlsbENvbG9yOiAnI2ZmZicsXHJcbiAgICAgICAgICAgICAgICAgICAgc3Ryb2tlV2VpZ2h0OiAxLFxyXG4gICAgICAgICAgICAgICAgICAgIHN0cm9rZU9wYWNpdHk6IC4zLFxyXG4gICAgICAgICAgICAgICAgICAgIHJvdGF0aW9uOiB2ZWhpY2xlSW5mby5oZWFkaW5nLFxyXG4gICAgICAgICAgICAgICAgICAgIG9yaWdpbjogbmV3IGdvb2dsZS5tYXBzLlBvaW50KDAsIDApLFxyXG4gICAgICAgICAgICAgICAgICAgIGFuY2hvcjogbmV3IGdvb2dsZS5tYXBzLlBvaW50KHZlaGljbGVJbmZvLmFuY2hvclgsIHZlaGljbGVJbmZvLmFuY2hvclkpLy9nZXRBbmNob3IodmVoaWNsZUluZm8uaGVhZGluZylcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB6SW5kZXg6IDFcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSAgICAgICBcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0VmVoaWNsZU1hcmtlcih2ZWhpY2xlSW5mbykge1xyXG4gICAgICAgICAgICB2YXIgbWFwID0gdm0ubWFwQ29udHJvbC5nZXRHTWFwKCk7XHJcbiAgICAgICAgICAgIHZhciBwb3NpdGlvbiA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmcodmVoaWNsZUluZm8ubGF0aXR1ZGUsIHZlaGljbGVJbmZvLmxvbmdpdHVkZSk7XHJcblxyXG4gICAgICAgICAgICB2YXIgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XHJcbiAgICAgICAgICAgICAgICBpZDogdmVoaWNsZUluZm8uaWQsXHJcbiAgICAgICAgICAgICAgICBtYXJrZXJUeXBlOiAndmVoaWNsZScsXHJcbiAgICAgICAgICAgICAgICBwb3NpdGlvbjogcG9zaXRpb24sXHJcbiAgICAgICAgICAgICAgICBmbGF0OiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgbWFwOiBtYXAsXHJcbiAgICAgICAgICAgICAgICBpY29uOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGF0aDogJ00wLDEwIEMwLDQuNDc3MTUyNSA0LjQ3NTkzODE4LDAgMTAsMCBDMTUuNTIyODQ3NSwwIDIwLDQuNDc1OTM4MTggMjAsMTAgQzIwLDE1LjUyMjg0NzUgMTUuNTI0MDYxOCwyMCAxMCwyMCBDNC40NzcxNTI1LDIwIDAsMTUuNTI0MDYxOCAwLDEwIFogTTUsNSBMNSwxMy44IEw1LjgxOTA0NzYyLDEzLjggTDUuODE5MDQ3NjIsMTUgTDcsMTUgTDcsMTMuOCBMMTMsMTMuOCBMMTMsMTUgTDE0LjE4MDk1MjQsMTUgTDE0LjE4MDk1MjQsMTMuOCBMMTUsMTMuOCBMMTUsNSBMNSw1IFogTTE0LjYzMzY5OTYsOS43MTYxMDIwOSBDMTQuNjMzNjk5Niw5Ljk5MjU1NjI3IDE0LjQwNTUyMiwxMC4yMTY2NjY3IDE0LjEzNzQxMzQsMTAuMjE2NjY2NyBMNS44OTkyMTY2NSwxMC4yMTY2NjY3IEM1LjYyNTEyNTMyLDEwLjIxNjY2NjcgNS40MDI5MzA0LDEwLjAwMjI1MTMgNS40MDI5MzA0LDkuNzE2MTAyMDkgTDUuNDAyOTMwNCw3LjExNzIzMTI0IEM1LjQwMjkzMDQsNi44NDA3NzcwNiA1LjYzMTEwNzk5LDYuNjE2NjY2NjcgNS44OTkyMTY2NSw2LjYxNjY2NjY3IEwxNC4xMzc0MTM0LDYuNjE2NjY2NjcgQzE0LjQxMTUwNDcsNi42MTY2NjY2NyAxNC42MzM2OTk2LDYuODMxMDgyMDMgMTQuNjMzNjk5Niw3LjExNzIzMTI0IEwxNC42MzM2OTk2LDkuNzE2MTAyMDkgWiBNNS4zODQ2MTUzOCw1LjggQzUuMzg0NjE1MzgsNS41NzkwODYxIDUuNTYwNzY5NjcsNS40IDUuNzgxMjUsNS40IEwxNC4yMTg3NSw1LjQgQzE0LjQzNzgwNTIsNS40IDE0LjYxNTM4NDYsNS41ODU1NDY4OCAxNC42MTUzODQ2LDUuOCBDMTQuNjE1Mzg0Niw2LjAyMDkxMzkgMTQuNDM5MjMwMyw2LjIgMTQuMjE4NzUsNi4yIEw1Ljc4MTI1LDYuMiBDNS41NjIxOTQ3NSw2LjIgNS4zODQ2MTUzOCw2LjAxNDQ1MzEzIDUuMzg0NjE1MzgsNS44IFogTTUuMzg0NjE1MzgsMTEuNiBDNS4zODQ2MTUzOCwxMS4yNjg2MjkyIDUuNjUyMDEwOTksMTEgNS45OTMwODg5NCwxMSBMNi42OTkyMTg3NSwxMSBDNy4wMzUyNjk0MiwxMSA3LjMwNzY5MjMxLDExLjI3ODMyMDMgNy4zMDc2OTIzMSwxMS42IEM3LjMwNzY5MjMxLDExLjkzMTM3MDggNy4wNDAyOTY3LDEyLjIgNi42OTkyMTg3NSwxMi4yIEw1Ljk5MzA4ODk0LDEyLjIgQzUuNjU3MDM4MjgsMTIuMiA1LjM4NDYxNTM4LDExLjkyMTY3OTcgNS4zODQ2MTUzOCwxMS42IFogTTEyLjY5MjMwNzcsMTEuNiBDMTIuNjkyMzA3NywxMS4yNjg2MjkyIDEyLjk1OTcwMzMsMTEgMTMuMzAwNzgxMiwxMSBMMTQuMDA2OTExMSwxMSBDMTQuMzQyOTYxNywxMSAxNC42MTUzODQ2LDExLjI3ODMyMDMgMTQuNjE1Mzg0NiwxMS42IEMxNC42MTUzODQ2LDExLjkzMTM3MDggMTQuMzQ3OTg5LDEyLjIgMTQuMDA2OTExMSwxMi4yIEwxMy4zMDA3ODEyLDEyLjIgQzEyLjk2NDczMDYsMTIuMiAxMi42OTIzMDc3LDExLjkyMTY3OTcgMTIuNjkyMzA3NywxMS42IFonLFxyXG4gICAgICAgICAgICAgICAgICAgIGZpbGxPcGFjaXR5OiAxLFxyXG4gICAgICAgICAgICAgICAgICAgIHN0cm9rZU9wYWNpdHk6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgZmlsbENvbG9yOiB2bS5yb3V0ZS5jb2xvcixcclxuICAgICAgICAgICAgICAgICAgICBzY2FsZTogMSxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB6SW5kZXg6IDJcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcmtlciwgJ2NsaWNrJywgc2hvd1ZlaGljbGVOdW1iZXIobWFwLCBtYXJrZXIsIHZlaGljbGVJbmZvLm5hbWUpKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBtYXJrZXI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzaG93VmVoaWNsZU51bWJlcihtYXAsIG1hcmtlciwgbnVtYmVyKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgaW5mb1dpbmRvdyA9IG5ldyBnb29nbGUubWFwcy5JbmZvV2luZG93KHsgY29udGVudDogJycgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY29udGVudCA9ICc8c3BhbiBzdHlsZT1cImZvbnQtd2VpZ2h0OiBib2xkO1wiPicgKyAnIycrbnVtYmVyICsgJzwvc3Bhbj48YnIgLz4nO1xyXG4gICAgICAgICAgICAgICAgaW5mb1dpbmRvdy5zZXRDb250ZW50KGNvbnRlbnQpO1xyXG4gICAgICAgICAgICAgICAgaW5mb1dpbmRvdy5vcGVuKG1hcCwgbWFya2VyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gICAgICAgIFxyXG5cclxuICAgICAgICBmdW5jdGlvbiByZW1vdmVNYXJrZXIoY29sbGVjdGlvbiwgbWFya2VyKSB7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB2YXIgaW5kZXggPSBjb250YWlucyhjb2xsZWN0aW9uLCBtYXJrZXIuaWQpO1xyXG4gICAgICAgICAgICBjb2xsZWN0aW9uW2luZGV4XS5zZXRNYXAobnVsbCk7XHJcbiAgICAgICAgICAgIGNvbGxlY3Rpb24uc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNvbnRhaW5zKGxpc3QsIGlkKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGxpc3RbaV0uaWQgPT09IGlkKSByZXR1cm4gaTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBmaW5kQWxsKGxpc3QsIGlkKSB7XHJcbiAgICAgICAgICAgIHZhciBtYXJrZXJzID0gW107XHJcblxyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGlmIChsaXN0W2ldLmlkID09PSBpZClcclxuICAgICAgICAgICAgICAgICAgICBtYXJrZXJzLnB1c2gobGlzdFtpXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG1hcmtlcnM7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdmVoaWNsZXNGYWlsdXJlSGFuZGxlcigpIHtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBwb2xsVmVoaWNsZXNGb3JSb3V0ZSgpIHtcclxuICAgICAgICAgICAgdmVoaWNsZVBvbGwgPSAkaW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgZ2V0VmVoaWNsZXNGb3JSb3V0ZSgpO1xyXG4gICAgICAgICAgICB9LCB2ZWhpY2xlUG9sbEludGVydmFsKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRTdG9wQXJyaXZhbHNGb3JSb3V0ZSgpIHtcclxuICAgICAgICAgICAgUm91dGVTZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICAuZ2V0QXJyaXZhbHNGb3JSb3V0ZShyb3V0ZUlkLCBkaXZpc2lvbklkKVxyXG4gICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGhhbmRsZUFycml2YWxTdWNjZXNzLCBoYW5kbGVBcnJpdmFsRmFpbHVyZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKHBvbGxBcnJpdmFsc0ZvclJvdXRlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGhhbmRsZUFycml2YWxTdWNjZXNzKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIHZtLnJvdXRlQXJyaXZhbHMgPSByZXNwb25zZS5kYXRhLmFycml2YWxzO1xyXG4gICAgICAgICAgICB2bS5sb2FkaW5nID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICBpZiAoIXN0b3BzTG9hZGVkKVxyXG4gICAgICAgICAgICAgICAgbWFwU3RvcHNGb3JEaXNwbGF5KCk7O1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFNoYXBlRm9yUm91dGUoKSB7XHJcbiAgICAgICAgICAgIHZhciBtYXAgPSB2bS5tYXBDb250cm9sLmdldEdNYXAoKTtcclxuICAgICAgICAgICAgUm91dGVTZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICAuZ2V0U2hhcGVzQnlSb3V0ZShyb3V0ZUlkKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNoYXBlcyA9IHJlc3VsdC5kYXRhO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxpbmUgPSBuZXcgZ29vZ2xlLm1hcHMuUG9seWxpbmUoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogZ29vZ2xlLm1hcHMuZ2VvbWV0cnkuZW5jb2RpbmcuZGVjb2RlUGF0aChzaGFwZXNbMF0ubGluZSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJva2VDb2xvcjogdm0ucm91dGUuY29sb3IsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJva2VPcGFjaXR5OiA0LjAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJva2VXZWlnaHQ6IDQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXAgOiBtYXAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uczogW3tcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6IGdvb2dsZS5tYXBzLlN5bWJvbFBhdGguRk9SV0FSRF9DTE9TRURfQVJST1csXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlOiAzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXQ6ICcyNXB4JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQ6ICcyMDBweCdcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1dXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hcC5maXRCb3VuZHMoZ2V0TGluZUJvdW5kcyhsaW5lKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldExpbmVCb3VuZHMobGluZSkge1xyXG4gICAgICAgICAgICB2YXIgYm91bmQgPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nQm91bmRzKCk7XHJcbiAgICAgICAgICAgIGxpbmUuZ2V0UGF0aCgpLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7XHJcbiAgICAgICAgICAgICAgICBib3VuZC5leHRlbmQobmV3IGdvb2dsZS5tYXBzLkxhdExuZyhpdGVtLmxhdCgpLCBpdGVtLmxuZygpKSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gYm91bmQ7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaGFuZGxlQXJyaXZhbEZhaWx1cmUoZXJyb3IpIHtcclxuICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbWFwU3RvcHNGb3JEaXNwbGF5KCkge1xyXG4gICAgICAgICAgICB2YXIgbWFwID0gdm0ubWFwQ29udHJvbC5nZXRHTWFwKCk7XHJcblxyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZtLnJvdXRlQXJyaXZhbHMubGVuZ3RoOyBpKyspIHtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgc3RvcEluZm8gPSB2bS5yb3V0ZUFycml2YWxzW2ldLnN0b3A7XHJcbiAgICAgICAgICAgICAgICB2YXIgcG9zaXRpb24gPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKHN0b3BJbmZvLkxhdGl0dWRlLCBzdG9wSW5mby5Mb25naXR1ZGUpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBzdG9wID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6IHN0b3BJbmZvLklkLFxyXG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBwb3NpdGlvbixcclxuICAgICAgICAgICAgICAgICAgICBtYXA6IG1hcCxcclxuICAgICAgICAgICAgICAgICAgICBvcHRpbWl6ZWQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIGljb246IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogJ00wLDIuOTk0MjAyMDggQzAsMS4zNDA1NDk5MyAxLjM0MzMxMTk3LDAgMi45OTQyMDIwOCwwIEwxNy4wMDU3OTc5LDAgQzE4LjY1OTQ1MDEsMCAyMCwxLjM0MzMxMTk3IDIwLDIuOTk0MjAyMDggTDIwLDE3LjAwNTc5NzkgQzIwLDE4LjY1OTQ1MDEgMTguNjU2Njg4LDIwIDE3LjAwNTc5NzksMjAgTDIuOTk0MjAyMDgsMjAgQzEuMzQwNTQ5OTMsMjAgMCwxOC42NTY2ODggMCwxNy4wMDU3OTc5IEwwLDIuOTk0MjAyMDggWiBNNiwyMCBMMTMuNzY5MDgxMiwyMCBMOS43NTk5OTk5OSwyMi43NiBMNiwyMCBaJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsbENvbG9yOiB2bS5yb3V0ZS5jb2xvcixcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsbE9wYWNpdHk6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0cm9rZVdlaWdodDogMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYW5jaG9yOiBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQoOSwgMjEpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzaXplOiBuZXcgZ29vZ2xlLm1hcHMuU2l6ZSgyMCwgMjMpXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICB6SW5kZXg6IDUsXHJcbiAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uOiBnb29nbGUubWFwcy5BbmltYXRpb24uRFJPUFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGljb24gPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuICAgICAgICAgICAgICAgICAgICBpZDogc3RvcEluZm8uSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IHBvc2l0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgIG1hcDogbWFwLFxyXG4gICAgICAgICAgICAgICAgICAgIG9wdGltaXplZDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgaWNvbjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiAnTTAsMCBMMCwxMy4wODk5MjE3IEMwLDEzLjYzNjcyNjkgMC40NDM2Njc0NTcsMTQuMDggMS4wMDY1MzI3NCwxNC4wOCBMMS4zMTA0NzYxOSwxNC4wOCBMMS4zMTA0NzYxOSwxNiBMMy4yLDE2IEwzLjIsMTQuMDggTDEyLjgsMTQuMDggTDEyLjgsMTYgTDE0LjY4OTUyMzgsMTYgTDE0LjY4OTUyMzgsMTQuMDggTDE0Ljk5MzQ2NzMsMTQuMDggQzE1LjU0OTM1OTksMTQuMDggMTYsMTMuNjI3NDgwMSAxNiwxMy4wODk5MjE3IEwxNiwwLjk5MDA3ODI1OSBDMTYsMC40NDMyNzMxMzUgMTUuNTU1MzY5MSwwIDE0Ljk5OTEyODMsMCBMMCwwIFogTTE1LjQxMzkxOTQsNy44NTU1NzIzMSBDMTUuNDEzOTE5NCw4LjEyNjc5NjIzIDE1LjE4MTkzMDEsOC4zNDY2NjY2NyAxNC45MjI1MjA3LDguMzQ2NjY2NjcgTDEuMTM2MDg3MzgsOC4zNDY2NjY2NyBDMC44NjQ2OTUzNTQsOC4zNDY2NjY2NyAwLjY0NDY4ODY0NSw4LjEyNzkwMTQxIDAuNjQ0Njg4NjQ1LDcuODU1NTcyMzEgTDAuNjQ0Njg4NjQ1LDMuMDc3NzYxMDMgQzAuNjQ0Njg4NjQ1LDIuODA2NTM3MSAwLjg3NjY3Nzk5MiwyLjU4NjY2NjY3IDEuMTM2MDg3MzgsMi41ODY2NjY2NyBMMTQuOTIyNTIwNywyLjU4NjY2NjY3IEMxNS4xOTM5MTI3LDIuNTg2NjY2NjcgMTUuNDEzOTE5NCwyLjgwNTQzMTkzIDE1LjQxMzkxOTQsMy4wNzc3NjEwMyBMMTUuNDEzOTE5NCw3Ljg1NTU3MjMxIFogTTAuNjE1Mzg0NjE1LDEuMTMxMjIwNyBDMC42MTUzODQ2MTUsMC44NTk5MjcgMC44NDczNzM5NjIsMC42NCAxLjEwNjc4MzM1LDAuNjQgTDE0Ljg5MzIxNjYsMC42NCBDMTUuMTY0NjA4NywwLjY0IDE1LjM4NDYxNTQsMC44NjI5NTg5ODQgMTUuMzg0NjE1NCwxLjEzMTIyMDcgTDE1LjM4NDYxNTQsMS40Mjg3NzkzIEMxNS4zODQ2MTU0LDEuNzAwMDczIDE1LjE1MjYyNiwxLjkyIDE0Ljg5MzIxNjYsMS45MiBMMS4xMDY3ODMzNSwxLjkyIEMwLjgzNTM5MTMyNCwxLjkyIDAuNjE1Mzg0NjE1LDEuNjk3MDQxMDIgMC42MTUzODQ2MTUsMS40Mjg3NzkzIEwwLjYxNTM4NDYxNSwxLjEzMTIyMDcgWiBNMC42MTUzODQ2MTUsMTAuNTYgQzAuNjE1Mzg0NjE1LDEwLjAyOTgwNjYgMS4wNDMyMTc1OSw5LjYgMS41NzIwNzU4NCw5LjYgTDIuNzM1NjE2NDYsOS42IEMzLjI2Mzk4MjQ0LDkuNiAzLjY5MjMwNzY5LDEwLjAyNjExMDIgMy42OTIzMDc2OSwxMC41NiBDMy42OTIzMDc2OSwxMS4wOTAxOTM0IDMuMjY0NDc0NzIsMTEuNTIgMi43MzU2MTY0NiwxMS41MiBMMS41NzIwNzU4NCwxMS41MiBDMS4wNDM3MDk4NywxMS41MiAwLjYxNTM4NDYxNSwxMS4wOTM4ODk4IDAuNjE1Mzg0NjE1LDEwLjU2IFogTTEyLjMwNzY5MjMsMTAuNTYgQzEyLjMwNzY5MjMsMTAuMDI5ODA2NiAxMi43MzU1MjUzLDkuNiAxMy4yNjQzODM1LDkuNiBMMTQuNDI3OTI0Miw5LjYgQzE0Ljk1NjI5MDEsOS42IDE1LjM4NDYxNTQsMTAuMDI2MTEwMiAxNS4zODQ2MTU0LDEwLjU2IEMxNS4zODQ2MTU0LDExLjA5MDE5MzQgMTQuOTU2NzgyNCwxMS41MiAxNC40Mjc5MjQyLDExLjUyIEwxMy4yNjQzODM1LDExLjUyIEMxMi43MzYwMTc2LDExLjUyIDEyLjMwNzY5MjMsMTEuMDkzODg5OCAxMi4zMDc2OTIzLDEwLjU2IFogTTExLjQyMzk1NSwxMS4xOTk5NTA3IEMxMS42MzQwNjU5LDExLjM3NjczNjMgMTEuNTg0ODgzOSwxMS41MjAwNDkzIDExLjMwNTE2MDUsMTEuNTIwMDQ5MyBMNC42OTQ4Mzk0OCwxMS41MjAwNDkzIEM0LjQxOTEyMDIyLDExLjUyMDA0OTMgNC4zNjgwMTU0MywxMS4zNzQ5ODUxIDQuNTc2MDQ1MDMsMTEuMTk5OTUwNyBMNC4xOTU2MDU1OSwxMS41MjAwNDkzIEM0LjQwNTcxNjQ5LDExLjM0MzI2MzcgNC44MDM4ODcyNSwxMS4xOTk5NTA3IDUuMDY4NTI5ODMsMTEuMTk5OTUwNyBMMTAuOTMxNDcwMiwxMS4xOTk5NTA3IEMxMS4yMDM0NjIsMTEuMTk5OTUwNyAxMS41OTYzNjQ4LDExLjM0NTAxNDkgMTEuODA0Mzk0NCwxMS41MjAwNDkzIEwxMS40MjM5NTUsMTEuMTk5OTUwNyBaIE0xMS40MjM5NTUsMTEuODM5OTUwNyBDMTEuNjM0MDY1OSwxMi4wMTY3MzYzIDExLjU4NDg4MzksMTIuMTYwMDQ5MyAxMS4zMDUxNjA1LDEyLjE2MDA0OTMgTDQuNjk0ODM5NDgsMTIuMTYwMDQ5MyBDNC40MTkxMjAyMiwxMi4xNjAwNDkzIDQuMzY4MDE1NDMsMTIuMDE0OTg1MSA0LjU3NjA0NTAzLDExLjgzOTk1MDcgTDQuMTk1NjA1NTksMTIuMTYwMDQ5MyBDNC40MDU3MTY0OSwxMS45ODMyNjM3IDQuODAzODg3MjUsMTEuODM5OTUwNyA1LjA2ODUyOTgzLDExLjgzOTk1MDcgTDEwLjkzMTQ3MDIsMTEuODM5OTUwNyBDMTEuMjAzNDYyLDExLjgzOTk1MDcgMTEuNTk2MzY0OCwxMS45ODUwMTQ5IDExLjgwNDM5NDQsMTIuMTYwMDQ5MyBMMTEuNDIzOTU1LDExLjgzOTk1MDcgWicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGxDb2xvcjogJyNmZmYnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxsT3BhY2l0eTogMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3Ryb2tlV2VpZ2h0OiAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhbmNob3I6IG5ldyBnb29nbGUubWFwcy5Qb2ludCg3LCAxOSksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpemU6IG5ldyBnb29nbGUubWFwcy5TaXplKDE2LCAxNilcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHpJbmRleDogNixcclxuICAgICAgICAgICAgICAgICAgICBhbmltYXRpb246IGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5EUk9QXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgc2hhZG93ID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6IHN0b3BJbmZvLklkLFxyXG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBwb3NpdGlvbixcclxuICAgICAgICAgICAgICAgICAgICBtYXA6IG1hcCxcclxuICAgICAgICAgICAgICAgICAgICBvcHRpbWl6ZWQ6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIGljb246IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogJ00tNS44MzI1MjU5NywxNC4zMTU1NTQ1IEMtNi4zNTM1MDI5NSwxMy41ODg5OTM4IC01LjQzNTkxMDYsMTMgLTMuNzg5MTc5NzIsMTMgTDEwLjE4NzExNTUsMTMgQzExLjgzNjYwMTUsMTMgMTMuNTk2OTc5NSwxMy41OTAyMDc0IDE0LjExNzA4NjMsMTQuMzE1NTU0NSBMMTguNTMxMzg3NywyMC40NzE3OTE3IEMxOS4wNTIzNjQ3LDIxLjE5ODM1MjQgMTguMTM0NzcyNCwyMS43ODczNDYyIDE2LjQ4ODA0MTUsMjEuNzg3MzQ2MiBMMi41MTE3NDYyNCwyMS43ODczNDYyIEMwLjg2MjI2MDI4MSwyMS43ODczNDYyIC0wLjg5ODExNzc1MSwyMS4xOTcxMzg5IC0xLjQxODIyNDU3LDIwLjQ3MTc5MTcgTC01LjgzMjUyNTk3LDE0LjMxNTU1NDUgWiBNNS41MDk5NzE0LDIxLjc4NzM0NjIgTDEzLjI1OTQ3OTMsMjEuNzg3MzQ2MiBMMTAuMTMwMDI2MywyMyBMNS41MDk5NzE0LDIxLjc4NzM0NjIgWicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGxDb2xvcjogJyMwMDAnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxsT3BhY2l0eTogLjEwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHJva2VXZWlnaHQ6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFuY2hvcjogbmV3IGdvb2dsZS5tYXBzLlBvaW50KDksIDIxKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogbmV3IGdvb2dsZS5tYXBzLlNpemUoMjEsIDEwKVxyXG5cclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHpJbmRleDogNCxcclxuICAgICAgICAgICAgICAgICAgICBhbmltYXRpb246IGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5EUk9QXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihpY29uLCAnY2xpY2snLCBzaG93U3RvcEluZm8obWFwLCBpY29uLCBzdG9wSW5mby5OYW1lKSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHN0b3BzTG9hZGVkID0gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzaG93U3RvcEluZm8obWFwLCBtYXJrZXIsIG5hbWUpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciBpbmZvV2luZG93ID0gbmV3IGdvb2dsZS5tYXBzLkluZm9XaW5kb3coeyBjb250ZW50OiAnJyB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBjb250ZW50ID0gJzxzcGFuIHN0eWxlPVwiZm9udC13ZWlnaHQ6IGJvbGQ7XCI+JyAgKyBuYW1lICsgJzwvc3Bhbj48YnIgLz4nO1xyXG4gICAgICAgICAgICAgICAgaW5mb1dpbmRvdy5zZXRDb250ZW50KGNvbnRlbnQpO1xyXG4gICAgICAgICAgICAgICAgaW5mb1dpbmRvdy5vcGVuKG1hcCwgbWFya2VyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIG9uU3RvcENsaWNrKG1hcmtlciwgZXZlbnROYW1lLCBtb2RlbCkge1xyXG4gICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcG9sbEFycml2YWxzRm9yUm91dGUoKSB7XHJcbiAgICAgICAgICAgIGlmICghUG9ydGFsVXRpbGl0eVNlcnZpY2UuaGFzVmFsdWUoYXJyaXZhbFBvbGwpKSB7XHJcbiAgICAgICAgICAgICAgICBhcnJpdmFsUG9sbCA9ICRpbnRlcnZhbChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0U3RvcEFycml2YWxzRm9yUm91dGUoKVxyXG4gICAgICAgICAgICAgICAgfSwgYXJyaXZhbFBvbGxJbnRlcnZhbCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGFjdGl2YXRlKCk7XHJcblxyXG4gICAgICAgICRzY29wZS4kb24oJyRkZXN0cm95JywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIHN0b3BQb2xsaW5nKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHN0b3BQb2xsaW5nKCkge1xyXG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0RlZmluZWQodmVoaWNsZVBvbGwpKSB7XHJcbiAgICAgICAgICAgICAgICAkaW50ZXJ2YWwuY2FuY2VsKHZlaGljbGVQb2xsKTtcclxuICAgICAgICAgICAgICAgIHZlaGljbGVQb2xsID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0RlZmluZWQoYXJyaXZhbFBvbGwpKSB7XHJcbiAgICAgICAgICAgICAgICAkaW50ZXJ2YWwuY2FuY2VsKGFycml2YWxQb2xsKTtcclxuICAgICAgICAgICAgICAgIGFycml2YWxQb2xsID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIFN0YXJ0IG9mIGNvZGUgZm9yIElvbmljXHJcbiAgICAgICAgdm0uaW9uaWNJbmNsdWRlID0gJ2FwcC9tb2R1bGVzL2ZpeGVkLXJvdXRlL3N0b3BzLWZvci1yb3V0ZS9zdG9wcy1mb3Itcm91dGUuaHRtbCc7XHJcbiAgICAgICAgdm0uaW9uaWNDdXN0b21DbGFzc05hbWUgPSAnaW9uaWMtZml4ZWQtcm91dGUtc3RvcHMtZm9yLXJvdXRlJztcclxuICAgICAgICB2bS5pb25pY1VzZUZpeGVkUm91dGVOYXYgPSB0cnVlO1xyXG4gICAgICAgIHZtLmlvbmljSGlkZU5hdkJhciA9IGZhbHNlO1xyXG4gICAgICAgIHZtLmlvbmljVXNlUmVmcmVzaGVyID0gZmFsc2U7XHJcbiAgICAgICAgLy8gRW5kIG9mIGNvZGUgZm9yIElvbmljXHJcbiAgICB9XHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignQWN0aXZlVHJpcENvbnRyb2xsZXInLCBhY3RpdmVUcmlwQ29udHJvbGxlcik7XHJcblxyXG4gICAgYWN0aXZlVHJpcENvbnRyb2xsZXIuJGluamVjdCA9IFsnJHNjb3BlJywgJyRsb2NhdGlvbicsICckaW50ZXJ2YWwnLCAnJHdpbmRvdycsICckdWliTW9kYWwnLFxyXG4gICAgICAgICAgICAgICAgJ0NvbmZpZ0ZhY3RvcnknLCAnU2NoZWR1bGVTZXJ2aWNlJywgJ3VpR21hcElzUmVhZHknLCAnRGl2aXNpb25TZXJ2aWNlJywgJ2F1dGhTZXJ2aWNlJyxcclxuICAgICAgICAgICAgICAgICdVdGlsaXR5RmFjdG9yeScsICdSZWRpcmVjdGlvblNlcnZpY2UnLCAnQ29tbXVuaWNhdGlvbnNTZXJ2aWNlJywgJ1NldHRpbmdzU2VydmljZScsICAnUGFnZVNlcnZpY2UnLCdPbmVNdlNlcnZpY2VzJ107XHJcblxyXG4gICAgZnVuY3Rpb24gYWN0aXZlVHJpcENvbnRyb2xsZXIoJHNjb3BlLCAkbG9jYXRpb24sICRpbnRlcnZhbCwgJHdpbmRvdywgJHVpYk1vZGFsLFxyXG4gICAgICAgIENvbmZpZ0ZhY3RvcnksIFNjaGVkdWxlU2VydmljZSwgdWlHbWFwSXNSZWFkeSwgRGl2aXNpb25TZXJ2aWNlLCBhdXRoU2VydmljZSxcclxuICAgICAgICBVdGlsaXR5RmFjdG9yeSwgUmVkaXJlY3Rpb25TZXJ2aWNlLCBDb21tdW5pY2F0aW9uc1NlcnZpY2UsIFNldHRpbmdzU2VydmljZSwgIFBhZ2VTZXJ2aWNlLE9uZU12U2VydmljZXMpIHtcclxuXHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuXHJcbiAgICAgICAgUGFnZVNlcnZpY2Uuc2V0VGl0bGUoJ0FjdGl2ZSBUcmlwJyk7XHJcbiAgICAgICAgUGFnZVNlcnZpY2Uuc2V0SGVhZGxpbmUoT25lTXZTZXJ2aWNlcy5nZXREcnRJbmZvKCkuYWxpYXMpO1xyXG5cclxuICAgICAgICB2YXIgb3B0aW9ucyA9IHVuZGVmaW5lZDtcclxuICAgICAgICB2YXIgYXV0b1JlZnJlc2ggPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgdm0ucGFzc2VuZ2VySWQgPSBhdXRoU2VydmljZS5hdXRoZW50aWNhdGlvbi5wYXNzZW5nZXJJZDtcclxuICAgICAgICB2bS5jYW5jZWxUcmlwID0gY2FuY2VsVHJpcDtcclxuICAgICAgICB2bS5nZXRBY3RpdmVUcmlwID0gZ2V0QWN0aXZlVHJpcDtcclxuICAgICAgICB2bS50cnlDb250YWN0RHJpdmVyID0gdHJ5Q29udGFjdERyaXZlcjtcclxuICAgICAgICB2bS5pc0NhbmNlbGxpbmcgPSBmYWxzZTtcclxuICAgICAgICB2bS5hY3RpdmVUcmlwO1xyXG4gICAgICAgIHZtLmNvbnRhY3RpbmdEcml2ZXIgPSBmYWxzZTtcclxuICAgICAgICB2YXIgZGl2aXNpb25JZCA9ICcnO1xyXG4gICAgICAgIHZhciBvcGVyYXRvcklkID0gbnVsbDtcclxuICAgICAgICB2YXIgZGlyZWN0aW9uc0Rpc3BsYXkgPSBuZXcgZ29vZ2xlLm1hcHMuRGlyZWN0aW9uc1JlbmRlcmVyKHsgc3VwcHJlc3NNYXJrZXJzOiB0cnVlLCBkcmFnZ2FibGU6IGZhbHNlIH0pO1xyXG4gICAgICAgIHZhciBkaXJlY3Rpb25zU2VydmljZSA9IG5ldyBnb29nbGUubWFwcy5EaXJlY3Rpb25zU2VydmljZSgpO1xyXG4gICAgICAgIHZtLmlzTG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgIHZtLnZlaGljbGVJbmZvID0gbnVsbDtcclxuICAgICAgICB2bS5kcmF3ZXJTdGF0ZSA9IDE7XHJcblxyXG4gICAgICAgIHZhciBjbG9zZXN0UGluLCBvdGhlclBpbiwgbG9jYXRpb25QaW4sIG15TG9jYXRpb25QaW4sIGh1Ykljb247XHJcbiAgICAgICAgaWYgKCR3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiVHJpZGVudFwiKSA+IDAgfHwgJHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXCJNU0lFXCIpID4gMCkge1xyXG4gICAgICAgICAgICBjbG9zZXN0UGluID0gJ2ltYWdlcy9kZWZhdWx0L2ktZHJ0LXBpbi1iLnBuZyc7XHJcbiAgICAgICAgICAgIG90aGVyUGluID0gJ2ltYWdlcy9kZWZhdWx0L2ktZHJ0LXBpbi1nLnBuZyc7XHJcbiAgICAgICAgICAgIGxvY2F0aW9uUGluID0gJ2ltYWdlcy9waW4tbG9jYXRpb24ucG5nJztcclxuICAgICAgICAgICAgbXlMb2NhdGlvblBpbiA9ICdpbWFnZXMvcGluLW15LWxvY2F0aW9uLnBuZyc7XHJcbiAgICAgICAgICAgIGh1Ykljb24gPSAnaW1hZ2VzL3Bpbi1odWIucG5nJztcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGNsb3Nlc3RQaW4gPSAnaW1hZ2VzL2RlZmF1bHQvaS1waW4tZHJ0LWIuc3ZnJztcclxuICAgICAgICAgICAgb3RoZXJQaW4gPSAnaW1hZ2VzL2RlZmF1bHQvaS1kcnQtcGluLWcuc3ZnJztcclxuICAgICAgICAgICAgbG9jYXRpb25QaW4gPSAnaW1hZ2VzL3Bpbi1sb2NhdGlvbi5zdmcnO1xyXG4gICAgICAgICAgICBteUxvY2F0aW9uUGluID0gJ2ltYWdlcy9waW4tbXktbG9jYXRpb24uc3ZnJztcclxuICAgICAgICAgICAgaHViSWNvbiA9ICdpbWFnZXMvcGluLWh1Yi5zdmcnO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2V0QXV0b1JlZnJlc2goKSB7XHJcbiAgICAgICAgICAgIGF1dG9SZWZyZXNoID0gJGludGVydmFsKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGdldEFjdGl2ZVRyaXAoKTtcclxuICAgICAgICAgICAgfSwgMzAwMDApO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdHJ5Q29udGFjdERyaXZlcih0eXBlKSB7XHJcbiAgICAgICAgICAgIHZtLmNvbnRhY3RpbmdEcml2ZXIgPSB0cnVlO1xyXG4gICAgICAgICAgICB2bS50eXBlID0gdHlwZTtcclxuICAgICAgICAgICAgU2V0dGluZ3NTZXJ2aWNlXHJcbiAgICAgICAgICAgICAgIC5nZXRTZXR0aW5ncyhhdXRoU2VydmljZS5hdXRoZW50aWNhdGlvbi5wYXNzZW5nZXJJZClcclxuICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmxlbmd0aCA+PSAxMCkge1xyXG4gICAgICAgICAgICAgICAgICAgY29udGFjdERyaXZlcigpO1xyXG4gICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgQ29sbGVjdFBhc3Nlbmdlck1vYmlsZSgpO1xyXG4gICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICAkc2NvcGUuc3dpcGVVcCA9IGZ1bmN0aW9uICgkZXZlbnQpIHtcclxuICAgICAgICAgIGlmICh2bS5kcmF3ZXJTdGF0ZSA8IDIpIHtcclxuICAgICAgICAgICAgdm0uZHJhd2VyU3RhdGUgKz0gMTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuc3dpcGVEb3duID0gZnVuY3Rpb24gKCRldmVudCkge1xyXG4gICAgICAgICAgaWYgKHZtLmRyYXdlclN0YXRlID4gMCkge1xyXG4gICAgICAgICAgICB2bS5kcmF3ZXJTdGF0ZSAtPSAxO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNob3dTdXBwb3J0UG9wVXAoKSB7XHJcbiAgICAgICAgICAgIC8vIGdldCBoZWxwIHBob25lIG51bWJlclxyXG4gICAgICAgICAgICB2YXIgaGVscFBob25lID0gRGl2aXNpb25TZXJ2aWNlLmdldFN1cHBvcnRQaG9uZU51bWJlcigpO1xyXG4gICAgICAgICAgICB2YXIgbWVzc2FnZSA9IFwiQ291bGQgbm90IGNvbnRhY3QgZHJpdmVyLiBQbGVhc2UgY2FsbCBIZWxwIGRlc2sgYXQgPGEgaHJlZj0ndGVsOlwiICsgaGVscFBob25lICsgXCInPlwiICsgaGVscFBob25lICsgXCI8L2E+XCI7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJtb2RhbC1oZWFkZXJcIiA+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxoMyBjbGFzcz1cIm1vZGFsLXRpdGxlXCI+U3VwcG9ydDwvaDM+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgPC9kaXY+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwibW9kYWwtYm9keVwiPicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8cD4nICsgbWVzc2FnZSArICc8L3A+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJtb2RhbC1mb290ZXJcIj4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxidXR0b24gY2xhc3M9XCJidG4gYnRuLXdhcm5pbmdcIiB0eXBlPVwiYnV0dG9uXCIgbmctY2xpY2s9XCJjbG9zZSgpXCI+T0s8L2J1dHRvbj4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgPC9kaXY+JyxcclxuICAgICAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiBmdW5jdGlvbiAoJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8kbG9jYXRpb24ucmVwbGFjZSgpLnBhdGgoJ2Rhc2hib2FyZC8nKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGJhY2tkcm9wOiAnc3RhdGljJyxcclxuICAgICAgICAgICAgICAgIGtleWJvYXJkOiBmYWxzZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNvbnRhY3REcml2ZXIoKSB7XHJcbiAgICAgICAgICAgIENvbW11bmljYXRpb25zU2VydmljZS5jb250YWN0RHJpdmVyKHZtLmFjdGl2ZVRyaXAuVHJpcElEKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PSAxICYmIHJlc3BvbnNlLnJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2bS50eXBlID09IFwiY2FsbFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5sb2NhdGlvbi5ocmVmID0gXCJ0ZWw6XCIgKyByZXNwb25zZS5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodm0udHlwZSA9PSBcInNtc1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5sb2NhdGlvbi5ocmVmID0gXCJzbXM6XCIgKyByZXNwb25zZS5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PSAyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9IYW5kbGUgVmFsaWRhdGlvbiAxMDAwMDEgPSBEcml2ZXIgcGhvbmUgbWlzc2luZ1xyXG4gICAgICAgICAgICAgICAgICAgIC8vSGFuZGxlIFZhbGlkYXRpb24gMTAwMDAyID0gUGFzc2VuZ2VyIHBob25lIG1pc3NpbmdcclxuICAgICAgICAgICAgICAgICAgICBzaG93U3VwcG9ydFBvcFVwKCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHNob3dTdXBwb3J0UG9wVXAoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZtLmNvbnRhY3RpbmdEcml2ZXIgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5jb250YWN0aW5nRHJpdmVyID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBzaG93U3VwcG9ydFBvcFVwKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gQ29sbGVjdFBhc3Nlbmdlck1vYmlsZSgpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciBwYXNzZW5nZXJNb2JpbGVNb2RhbCA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL21vZHVsZXMvb24tZGVtYW5kL2FjdGl2ZVRyaXAvcGFzc2VuZ2VyLW1vYmlsZS1tb2RhbC5odG1sJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdQYXNzZW5nZXJNb2JpbGVDb250cm9sbGVyIGFzIHZtJyxcclxuICAgICAgICAgICAgICAgIHNpemU6ICdzbScsXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3M6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3NlbmdlcklkOiBhdXRoU2VydmljZS5hdXRoZW50aWNhdGlvbi5wYXNzZW5nZXJJZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBwYXNzZW5nZXJNb2JpbGVNb2RhbC5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udGFjdERyaXZlcigpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmKHJlc3BvbnNlID09IGZhbHNlKXtcclxuICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKCdFcnJvcicsICdDb3VsZCBub3QgdXBkYXRlIHlvdXIgbW9iaWxlIG51bWJlci4nKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRBY3RpdmVUcmlwKCkge1xyXG4gICAgICAgICAgICAvLyB2bS5pc0xvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgU2NoZWR1bGVTZXJ2aWNlLmdldGxhc3RyaXBkZXRhaWxzKHZtLnBhc3NlbmdlcklkKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5hY3RpdmVUcmlwID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQ7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vdmFyIHByb21pc2VXaW5kb3cgPSBvcHRpb25zLnByb21pc2VXaW5kb3c7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0YXJ0UGlja3VwV2luZG93VGltZSA9IG5ldyBtb21lbnQodm0uYWN0aXZlVHJpcC5TdGFydFBpY2t1cFdpbmRvd1RpbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBlbmRQaWNrdXBXaW5kb3dUaW1lID0gbmV3IG1vbWVudCh2bS5hY3RpdmVUcmlwLkVuZFBpY2t1cFdpbmRvd1RpbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmFjdGl2ZVRyaXAucHJvbWlzZVdpbmRvd1N0YXJ0VGltZSA9IHN0YXJ0UGlja3VwV2luZG93VGltZS5mb3JtYXQoJ2g6bW0gQScpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmFjdGl2ZVRyaXAucHJvbWlzZVdpbmRvd0VuZFRpbWUgPSBlbmRQaWNrdXBXaW5kb3dUaW1lLmZvcm1hdCgnaDptbSBBJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIG1hcFRyaXAoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmFjdGl2ZVRyaXAgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNjaGVkdWxlTWFya2VycyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbnNEaXNwbGF5LnNldE1hcChudWxsKTtcclxuICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnb24tZGVtYW5kL3Jlc2VydmF0aW9ucycpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy9nZXRNYXAoKTtcclxuXHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIHZtLmFjdGl2ZVRyaXAgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgdm0uaXNMb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAvLyBnZXRNYXAoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS56b29tID0gMTU7XHJcbiAgICAgICAgdm0uY2VudGVyID0ge1xyXG4gICAgICAgICAgICBsYXRpdHVkZTogMzkuODA5ODYwLFxyXG4gICAgICAgICAgICBsb25naXR1ZGU6IC05OC41NTUxODNcclxuICAgICAgICB9O1xyXG4gICAgICAgIHZtLm15U3R5bGVzID0gW1xyXG4gIHtcclxuICAgICAgXCJlbGVtZW50VHlwZVwiOiBcImdlb21ldHJ5XCIsXHJcbiAgICAgIFwic3R5bGVyc1wiOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBcImNvbG9yXCI6IFwiI2ViZTNjZFwiXHJcbiAgICAgICAgfVxyXG4gICAgICBdXHJcbiAgfSxcclxuICB7XHJcbiAgICAgIFwiZWxlbWVudFR5cGVcIjogXCJsYWJlbHMudGV4dC5maWxsXCIsXHJcbiAgICAgIFwic3R5bGVyc1wiOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBcImNvbG9yXCI6IFwiIzUyMzczNVwiXHJcbiAgICAgICAgfVxyXG4gICAgICBdXHJcbiAgfSxcclxuICB7XHJcbiAgICAgIFwiZWxlbWVudFR5cGVcIjogXCJsYWJlbHMudGV4dC5zdHJva2VcIixcclxuICAgICAgXCJzdHlsZXJzXCI6IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFwiY29sb3JcIjogXCIjZjVmMWU2XCJcclxuICAgICAgICB9XHJcbiAgICAgIF1cclxuICB9LFxyXG4gIHtcclxuICAgICAgXCJmZWF0dXJlVHlwZVwiOiBcImFkbWluaXN0cmF0aXZlXCIsXHJcbiAgICAgIFwiZWxlbWVudFR5cGVcIjogXCJnZW9tZXRyeS5zdHJva2VcIixcclxuICAgICAgXCJzdHlsZXJzXCI6IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFwiY29sb3JcIjogXCIjYzliMmE2XCJcclxuICAgICAgICB9XHJcbiAgICAgIF1cclxuICB9LFxyXG4gIHtcclxuICAgICAgXCJmZWF0dXJlVHlwZVwiOiBcImFkbWluaXN0cmF0aXZlLmxhbmRfcGFyY2VsXCIsXHJcbiAgICAgIFwiZWxlbWVudFR5cGVcIjogXCJnZW9tZXRyeS5zdHJva2VcIixcclxuICAgICAgXCJzdHlsZXJzXCI6IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFwiY29sb3JcIjogXCIjZGNkMmJlXCJcclxuICAgICAgICB9XHJcbiAgICAgIF1cclxuICB9LFxyXG4gIHtcclxuICAgICAgXCJmZWF0dXJlVHlwZVwiOiBcImFkbWluaXN0cmF0aXZlLmxhbmRfcGFyY2VsXCIsXHJcbiAgICAgIFwiZWxlbWVudFR5cGVcIjogXCJsYWJlbHNcIixcclxuICAgICAgXCJzdHlsZXJzXCI6IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFwidmlzaWJpbGl0eVwiOiBcIm9mZlwiXHJcbiAgICAgICAgfVxyXG4gICAgICBdXHJcbiAgfSxcclxuICB7XHJcbiAgICAgIFwiZmVhdHVyZVR5cGVcIjogXCJhZG1pbmlzdHJhdGl2ZS5sYW5kX3BhcmNlbFwiLFxyXG4gICAgICBcImVsZW1lbnRUeXBlXCI6IFwibGFiZWxzLnRleHQuZmlsbFwiLFxyXG4gICAgICBcInN0eWxlcnNcIjogW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgXCJjb2xvclwiOiBcIiNhZTllOTBcIlxyXG4gICAgICAgIH1cclxuICAgICAgXVxyXG4gIH0sXHJcbiAge1xyXG4gICAgICBcImZlYXR1cmVUeXBlXCI6IFwibGFuZHNjYXBlLm5hdHVyYWxcIixcclxuICAgICAgXCJlbGVtZW50VHlwZVwiOiBcImdlb21ldHJ5XCIsXHJcbiAgICAgIFwic3R5bGVyc1wiOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBcImNvbG9yXCI6IFwiI2RmZDJhZVwiXHJcbiAgICAgICAgfVxyXG4gICAgICBdXHJcbiAgfSxcclxuICB7XHJcbiAgICAgIFwiZmVhdHVyZVR5cGVcIjogXCJwb2lcIixcclxuICAgICAgXCJlbGVtZW50VHlwZVwiOiBcImdlb21ldHJ5XCIsXHJcbiAgICAgIFwic3R5bGVyc1wiOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBcImNvbG9yXCI6IFwiI2RmZDJhZVwiXHJcbiAgICAgICAgfVxyXG4gICAgICBdXHJcbiAgfSxcclxuICB7XHJcbiAgICAgIFwiZmVhdHVyZVR5cGVcIjogXCJwb2lcIixcclxuICAgICAgXCJlbGVtZW50VHlwZVwiOiBcImxhYmVscy50ZXh0LmZpbGxcIixcclxuICAgICAgXCJzdHlsZXJzXCI6IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFwiY29sb3JcIjogXCIjOTM4MTdjXCJcclxuICAgICAgICB9XHJcbiAgICAgIF1cclxuICB9LFxyXG4gIHtcclxuICAgICAgXCJmZWF0dXJlVHlwZVwiOiBcInBvaS5idXNpbmVzc1wiLFxyXG4gICAgICBcInN0eWxlcnNcIjogW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgXCJ2aXNpYmlsaXR5XCI6IFwib2ZmXCJcclxuICAgICAgICB9XHJcbiAgICAgIF1cclxuICB9LFxyXG4gIHtcclxuICAgICAgXCJmZWF0dXJlVHlwZVwiOiBcInBvaS5wYXJrXCIsXHJcbiAgICAgIFwiZWxlbWVudFR5cGVcIjogXCJnZW9tZXRyeS5maWxsXCIsXHJcbiAgICAgIFwic3R5bGVyc1wiOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBcImNvbG9yXCI6IFwiI2E1YjA3NlwiXHJcbiAgICAgICAgfVxyXG4gICAgICBdXHJcbiAgfSxcclxuICB7XHJcbiAgICAgIFwiZmVhdHVyZVR5cGVcIjogXCJwb2kucGFya1wiLFxyXG4gICAgICBcImVsZW1lbnRUeXBlXCI6IFwibGFiZWxzLnRleHRcIixcclxuICAgICAgXCJzdHlsZXJzXCI6IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFwidmlzaWJpbGl0eVwiOiBcIm9mZlwiXHJcbiAgICAgICAgfVxyXG4gICAgICBdXHJcbiAgfSxcclxuICB7XHJcbiAgICAgIFwiZmVhdHVyZVR5cGVcIjogXCJwb2kucGFya1wiLFxyXG4gICAgICBcImVsZW1lbnRUeXBlXCI6IFwibGFiZWxzLnRleHQuZmlsbFwiLFxyXG4gICAgICBcInN0eWxlcnNcIjogW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgXCJjb2xvclwiOiBcIiM0NDc1MzBcIlxyXG4gICAgICAgIH1cclxuICAgICAgXVxyXG4gIH0sXHJcbiAge1xyXG4gICAgICBcImZlYXR1cmVUeXBlXCI6IFwicm9hZFwiLFxyXG4gICAgICBcImVsZW1lbnRUeXBlXCI6IFwiZ2VvbWV0cnlcIixcclxuICAgICAgXCJzdHlsZXJzXCI6IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFwiY29sb3JcIjogXCIjZjVmMWU2XCJcclxuICAgICAgICB9XHJcbiAgICAgIF1cclxuICB9LFxyXG4gIHtcclxuICAgICAgXCJmZWF0dXJlVHlwZVwiOiBcInJvYWQuYXJ0ZXJpYWxcIixcclxuICAgICAgXCJlbGVtZW50VHlwZVwiOiBcImdlb21ldHJ5XCIsXHJcbiAgICAgIFwic3R5bGVyc1wiOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBcImNvbG9yXCI6IFwiI2ZkZmNmOFwiXHJcbiAgICAgICAgfVxyXG4gICAgICBdXHJcbiAgfSxcclxuICB7XHJcbiAgICAgIFwiZmVhdHVyZVR5cGVcIjogXCJyb2FkLmhpZ2h3YXlcIixcclxuICAgICAgXCJlbGVtZW50VHlwZVwiOiBcImdlb21ldHJ5XCIsXHJcbiAgICAgIFwic3R5bGVyc1wiOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBcImNvbG9yXCI6IFwiI2Y4Yzk2N1wiXHJcbiAgICAgICAgfVxyXG4gICAgICBdXHJcbiAgfSxcclxuICB7XHJcbiAgICAgIFwiZmVhdHVyZVR5cGVcIjogXCJyb2FkLmhpZ2h3YXlcIixcclxuICAgICAgXCJlbGVtZW50VHlwZVwiOiBcImdlb21ldHJ5LnN0cm9rZVwiLFxyXG4gICAgICBcInN0eWxlcnNcIjogW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgXCJjb2xvclwiOiBcIiNlOWJjNjJcIlxyXG4gICAgICAgIH1cclxuICAgICAgXVxyXG4gIH0sXHJcbiAge1xyXG4gICAgICBcImZlYXR1cmVUeXBlXCI6IFwicm9hZC5oaWdod2F5LmNvbnRyb2xsZWRfYWNjZXNzXCIsXHJcbiAgICAgIFwiZWxlbWVudFR5cGVcIjogXCJnZW9tZXRyeVwiLFxyXG4gICAgICBcInN0eWxlcnNcIjogW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgXCJjb2xvclwiOiBcIiNlOThkNThcIlxyXG4gICAgICAgIH1cclxuICAgICAgXVxyXG4gIH0sXHJcbiAge1xyXG4gICAgICBcImZlYXR1cmVUeXBlXCI6IFwicm9hZC5oaWdod2F5LmNvbnRyb2xsZWRfYWNjZXNzXCIsXHJcbiAgICAgIFwiZWxlbWVudFR5cGVcIjogXCJnZW9tZXRyeS5zdHJva2VcIixcclxuICAgICAgXCJzdHlsZXJzXCI6IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFwiY29sb3JcIjogXCIjZGI4NTU1XCJcclxuICAgICAgICB9XHJcbiAgICAgIF1cclxuICB9LFxyXG4gIHtcclxuICAgICAgXCJmZWF0dXJlVHlwZVwiOiBcInJvYWQubG9jYWxcIixcclxuICAgICAgXCJlbGVtZW50VHlwZVwiOiBcImxhYmVsc1wiLFxyXG4gICAgICBcInN0eWxlcnNcIjogW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgXCJ2aXNpYmlsaXR5XCI6IFwib2ZmXCJcclxuICAgICAgICB9XHJcbiAgICAgIF1cclxuICB9LFxyXG4gIHtcclxuICAgICAgXCJmZWF0dXJlVHlwZVwiOiBcInJvYWQubG9jYWxcIixcclxuICAgICAgXCJlbGVtZW50VHlwZVwiOiBcImxhYmVscy50ZXh0LmZpbGxcIixcclxuICAgICAgXCJzdHlsZXJzXCI6IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFwiY29sb3JcIjogXCIjODA2YjYzXCJcclxuICAgICAgICB9XHJcbiAgICAgIF1cclxuICB9LFxyXG4gIHtcclxuICAgICAgXCJmZWF0dXJlVHlwZVwiOiBcInRyYW5zaXQubGluZVwiLFxyXG4gICAgICBcImVsZW1lbnRUeXBlXCI6IFwiZ2VvbWV0cnlcIixcclxuICAgICAgXCJzdHlsZXJzXCI6IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFwiY29sb3JcIjogXCIjZGZkMmFlXCJcclxuICAgICAgICB9XHJcbiAgICAgIF1cclxuICB9LFxyXG4gIHtcclxuICAgICAgXCJmZWF0dXJlVHlwZVwiOiBcInRyYW5zaXQubGluZVwiLFxyXG4gICAgICBcImVsZW1lbnRUeXBlXCI6IFwibGFiZWxzLnRleHQuZmlsbFwiLFxyXG4gICAgICBcInN0eWxlcnNcIjogW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgXCJjb2xvclwiOiBcIiM4ZjdkNzdcIlxyXG4gICAgICAgIH1cclxuICAgICAgXVxyXG4gIH0sXHJcbiAge1xyXG4gICAgICBcImZlYXR1cmVUeXBlXCI6IFwidHJhbnNpdC5saW5lXCIsXHJcbiAgICAgIFwiZWxlbWVudFR5cGVcIjogXCJsYWJlbHMudGV4dC5zdHJva2VcIixcclxuICAgICAgXCJzdHlsZXJzXCI6IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFwiY29sb3JcIjogXCIjZWJlM2NkXCJcclxuICAgICAgICB9XHJcbiAgICAgIF1cclxuICB9LFxyXG4gIHtcclxuICAgICAgXCJmZWF0dXJlVHlwZVwiOiBcInRyYW5zaXQuc3RhdGlvblwiLFxyXG4gICAgICBcImVsZW1lbnRUeXBlXCI6IFwiZ2VvbWV0cnlcIixcclxuICAgICAgXCJzdHlsZXJzXCI6IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFwiY29sb3JcIjogXCIjZGZkMmFlXCJcclxuICAgICAgICB9XHJcbiAgICAgIF1cclxuICB9LFxyXG4gIHtcclxuICAgICAgXCJmZWF0dXJlVHlwZVwiOiBcIndhdGVyXCIsXHJcbiAgICAgIFwiZWxlbWVudFR5cGVcIjogXCJnZW9tZXRyeS5maWxsXCIsXHJcbiAgICAgIFwic3R5bGVyc1wiOiBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBcImNvbG9yXCI6IFwiI2I5ZDNjMlwiXHJcbiAgICAgICAgfVxyXG4gICAgICBdXHJcbiAgfSxcclxuICB7XHJcbiAgICAgIFwiZmVhdHVyZVR5cGVcIjogXCJ3YXRlclwiLFxyXG4gICAgICBcImVsZW1lbnRUeXBlXCI6IFwibGFiZWxzLnRleHQuZmlsbFwiLFxyXG4gICAgICBcInN0eWxlcnNcIjogW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgXCJjb2xvclwiOiBcIiM5Mjk5OGRcIlxyXG4gICAgICAgIH1cclxuICAgICAgXVxyXG4gIH1cclxuICAgICAgICBdO1xyXG4gICAgICAgIHZtLm1hcE9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIG1hcFR5cGVDb250cm9sOiBmYWxzZSxcclxuICAgICAgICAgICAgem9vbUNvbnRyb2w6IGZhbHNlLFxyXG4gICAgICAgICAgICBzdHJlZXRWaWV3Q29udHJvbDogZmFsc2UsXHJcbiAgICAgICAgICAgIHN0eWxlczogdm0ubXlTdHlsZXNcclxuXHJcbiAgICAgICAgfTtcclxuICAgICAgICB2bS5tYXBDb250cm9sID0ge307XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNhbmNlbFRyaXAodHJpcCkge1xyXG5cclxuICAgICAgICAgICAgdmFyIHRyaXBUb0NhbmNlbCA9IHtcclxuICAgICAgICAgICAgICAgICd0cmlwSWQnOiB0cmlwLlRyaXBJRCxcclxuICAgICAgICAgICAgICAgICdwYXNzZW5nZXJJZCc6IHRyaXAuUGFzc2VuZ2VySUQsXHJcbiAgICAgICAgICAgICAgICAnZnJvbSc6IHRyaXAuU3RhcnRBZGRyZXNzVmlld01vZGVsLk5hbWUsXHJcbiAgICAgICAgICAgICAgICAndG8nOiB0cmlwLkVuZEFkZHJlc3NWaWV3TW9kZWwuTmFtZSxcclxuICAgICAgICAgICAgICAgICdzY2hlZHVsZWRUaW1lJzogdHJpcC5TY2hlZHVsZWRQaWNrdXBUaW1lXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICB2YXIgbW9kYWxDYW5jZWxUcmlwID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvbW9kdWxlcy9vbi1kZW1hbmQvYWN0aXZlVHJpcC90cmlwLWNhbmNlbGxhdGlvbi1wcm9tcHQuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnVHJpcENhbmNlbGxhdGlvbkNvbnRyb2xsZXIgYXMgdm0nLFxyXG4gICAgICAgICAgICAgICAgc2l6ZTogJycsXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHJpcFRvQ2FuY2VsOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cmlwVG9DYW5jZWw7XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBzaG93Q2FuY2VsT3B0aW9uczogdm0ucmVzZXJ2YXRpb25Gb3JtT3B0aW9ucy5zaG93Q2FuY2VsT3B0aW9uc1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgbW9kYWxDYW5jZWxUcmlwLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuaXNDYW5jZWwpIHtcclxuICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdFN1Y2Nlc3MoXCJTdWNjZXNzIVwiLCBcIlRyaXAgY2FuY2VsbGVkXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCdvbi1kZW1hbmQvcmVzZXJ2YXRpb25zJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcihcIkVycm9yIVwiLCBcIlVuYWJsZSB0byBjYW5jZWwgdGhlIHRyaXAuXCIpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRNYXAoKSB7XHJcbiAgICAgICAgICAgIHVpR21hcElzUmVhZHkucHJvbWlzZSgpLnRoZW4oZnVuY3Rpb24gKG1hcHMpIHtcclxuICAgICAgICAgICAgICAgIFNjaGVkdWxlU2VydmljZS5nZXRTZXJ2aWNlQXJlYUxvY2F0aW9uKHZtLmRpdmlzaW9uSWQpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uY2VudGVyLmxhdGl0dWRlID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQuTGF0aXR1ZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmNlbnRlci5sb25naXR1ZGUgPSByZXNwb25zZS5kYXRhLnJlc3VsdC5Mb25naXR1ZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBnZXRBY3RpdmVUcmlwKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0QXV0b1JlZnJlc2goKTtcclxuICAgICAgICAgICAgICAgICAgICAvKmlmKHZtLmFjdGl2ZVRyaXAgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWFwVHJpcCgpOyovXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbWFwVHJpcCgpIHtcclxuICAgICAgICAgICAgdm0uc2NoZWR1bGVNYXJrZXJzID0gW107XHJcblxyXG4gICAgICAgICAgICBkaXJlY3Rpb25zRGlzcGxheS5zZXRNYXAodm0ubWFwQ29udHJvbC5nZXRHTWFwKCkpO1xyXG5cclxuICAgICAgICAgICAgdm0uc2NoZWR1bGVNYXJrZXJzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgJ2xhdGl0dWRlJzogdm0uYWN0aXZlVHJpcC5TdGFydEFkZHJlc3NWaWV3TW9kZWwuTGF0aXR1ZGUsICdsb25naXR1ZGUnOiB2bS5hY3RpdmVUcmlwLlN0YXJ0QWRkcmVzc1ZpZXdNb2RlbC5Mb25naXR1ZGUsXHJcbiAgICAgICAgICAgICAgICAnaWNvbic6ICdpbWFnZXMvZGVmYXVsdC9pLWRydC1waW4tYi5wbmcnLCAndHJpcElkJzogdm0uYWN0aXZlVHJpcC5UcmlwSURcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHZtLnNjaGVkdWxlTWFya2Vycy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICdsYXRpdHVkZSc6IHZtLmFjdGl2ZVRyaXAuRW5kQWRkcmVzc1ZpZXdNb2RlbC5MYXRpdHVkZSwgJ2xvbmdpdHVkZSc6IHZtLmFjdGl2ZVRyaXAuRW5kQWRkcmVzc1ZpZXdNb2RlbC5Mb25naXR1ZGUsXHJcbiAgICAgICAgICAgICAgICAnaWNvbic6ICdpbWFnZXMvZGVmYXVsdC9pLWRydC1waW4tZy5wbmcnLCAndHJpcElkJzogdm0uYWN0aXZlVHJpcC5UcmlwSURcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB2YXIgcmVxdWVzdCA9IHtcclxuICAgICAgICAgICAgICAgIG9yaWdpbjogbmV3IGdvb2dsZS5tYXBzLkxhdExuZyh2bS5hY3RpdmVUcmlwLlN0YXJ0QWRkcmVzc1ZpZXdNb2RlbC5MYXRpdHVkZSwgdm0uYWN0aXZlVHJpcC5TdGFydEFkZHJlc3NWaWV3TW9kZWwuTG9uZ2l0dWRlKSxcclxuICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uOiBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKHZtLmFjdGl2ZVRyaXAuRW5kQWRkcmVzc1ZpZXdNb2RlbC5MYXRpdHVkZSwgdm0uYWN0aXZlVHJpcC5FbmRBZGRyZXNzVmlld01vZGVsLkxvbmdpdHVkZSksXHJcbiAgICAgICAgICAgICAgICB0cmF2ZWxNb2RlOiBnb29nbGUubWFwcy5EaXJlY3Rpb25zVHJhdmVsTW9kZS5EUklWSU5HXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICB2bS52ZWhpY2xlSW5mbyA9IHtcclxuICAgICAgICAgICAgICAgIGNvb3Jkczoge1xyXG4gICAgICAgICAgICAgICAgICAgICdsYXRpdHVkZSc6IHZtLmFjdGl2ZVRyaXAuVmVoaWNsZUxhdGl0dWRlLFxyXG4gICAgICAgICAgICAgICAgICAgICdsb25naXR1ZGUnOiB2bS5hY3RpdmVUcmlwLlZlaGljbGVMb25naXR1ZGUsXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgaWNvbjogJ2ltYWdlcy9pLWNhci1ncmVlbi5zdmcnXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC50cmlnZ2VyKHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpLCBcInJlc2l6ZVwiKTtcclxuICAgICAgICAgICAgZGlyZWN0aW9uc1NlcnZpY2Uucm91dGUocmVxdWVzdCwgZnVuY3Rpb24gKHJlc3BvbnNlLCBzdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT09IGdvb2dsZS5tYXBzLkRpcmVjdGlvbnNTdGF0dXMuT0spIHtcclxuICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb25zRGlzcGxheS5zZXREaXJlY3Rpb25zKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy93aW5kb3cuYWxlcnQoJ0RpcmVjdGlvbnMgcmVxdWVzdCBmYWlsZWQgZHVlIHRvICcgKyBzdGF0dXMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdm0uaXNMb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgfTtcclxuXHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZShjYWxsYmFjaykge1xyXG4gICAgICAgICAgICBpZiAoIWF1dGhTZXJ2aWNlLmlzTG9nZ2VkSW4oKSkge1xyXG4gICAgICAgICAgICAgICAgUmVkaXJlY3Rpb25TZXJ2aWNlLCBzYXZlKCcvb24tZGVtYW5kL2FjdGl2ZS10cmlwJyk7XHJcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnbG9naW4nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuXHJcbiAgICAgICAgICAgICAgICBkaXZpc2lvbklkID0gRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKTtcclxuICAgICAgICAgICAgICAgIGlmIChkaXZpc2lvbklkICE9IG51bGwgJiYgZGl2aXNpb25JZCAhPSB1bmRlZmluZWQgJiYgZGl2aXNpb25JZCAhPSAnJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjayAmJiB0eXBlb2YgY2FsbGJhY2sgPT09IFwiZnVuY3Rpb25cIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHBvcHVsYXRlRGl2aXNpb25QYXJhbWV0ZXJzKCkge1xyXG4gICAgICAgICAgICBvcHRpb25zID0ge1xyXG4gICAgICAgICAgICAgICAgRGl2aXNpb25JZDogZGl2aXNpb25JZCxcclxuICAgICAgICAgICAgICAgIE9wZXJhdG9ySWQ6IG9wZXJhdG9ySWRcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgQ29uZmlnRmFjdG9yeS5nZXREaXZpc2lvblBhcmFtZXRlcnMoZGl2aXNpb25JZClcclxuICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHBhcmFtcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmFtcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMucGFzc2VuZ2Vyc0xpbWl0ID0gcGFyYW1zLlBhc3NlbmdlcnNMaW1pdCA/IGV2YWwocGFyYW1zLlBhc3NlbmdlcnNMaW1pdCkgOiA1O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYWxsb3dXaWxsQ2FsbCA9IHBhcmFtcy5BbGxvd1dpbGxDYWxsID8gZXZhbChwYXJhbXMuQWxsb3dXaWxsQ2FsbC50b0xvd2VyQ2FzZSgpKTogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5hbGxvd0VxdWlwbWVudCA9IHBhcmFtcy5BbGxvd0VxdWlwbWVudCA/IGV2YWwocGFyYW1zLkFsbG93RXF1aXBtZW50LnRvTG93ZXJDYXNlKCkpIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5pc0FkdmFuY2VkUmVzZXJ2YXRpb24gPSBwYXJhbXMuQWxsb3dBZHZhbmNlZFJlc2VydmF0aW9uID8gZXZhbChwYXJhbXMuQWxsb3dBZHZhbmNlZFJlc2VydmF0aW9uLnRvTG93ZXJDYXNlKCkpIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5hbGxvd011bHRpcGxlU2VhdEJvb2tpbmcgPSBwYXJhbXMuQWxsb3dNdWx0aXBsZVNlYXRCb29raW5nID8gZXZhbChwYXJhbXMuQWxsb3dNdWx0aXBsZVNlYXRCb29raW5nLnRvTG93ZXJDYXNlKCkpIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5pc1doZWVsQ2hhaXIgPSBwYXJhbXMuSGFzV2hlZWxDaGFpciA/IGV2YWwocGFyYW1zLkhhc1doZWVsQ2hhaXIudG9Mb3dlckNhc2UoKSkgOiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmlzUENBID0gcGFyYW1zLkhhc1BlcnNvbmFsQ2FyZUFzc2lzdGFudCA/IGV2YWwocGFyYW1zLkhhc1BlcnNvbmFsQ2FyZUFzc2lzdGFudC50b0xvd2VyQ2FzZSgpKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuaXNTZXJ2aWNlQW5pbWFsID0gcGFyYW1zLkhhc1NlcnZpY2VBbmltYWwgPyBldmFsKHBhcmFtcy5IYXNTZXJ2aWNlQW5pbWFsLnRvTG93ZXJDYXNlKCkpIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5pc0NvbXBhbmlvbiA9IHBhcmFtcy5IYXNDb21wYW5pb25zID8gZXZhbChwYXJhbXMuSGFzQ29tcGFuaW9ucy50b0xvd2VyQ2FzZSgpKSA6IGZhbHNlO1xyXG5cdFx0XHRcdFx0XHRcdCBvcHRpb25zLmNvbXBhbmlvbnNMaW1pdCA9IHBhcmFtcy5IYXNDb21wYW5pb25zID09IGZhbHNlID8gMDogcGFyYW1zLkNvbXBhbmlvbnNMaW1pdCA/IGV2YWwocGFyYW1zLkNvbXBhbmlvbnNMaW1pdCk6IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5hbGxvd0N1c3RvbUxvY2F0aW9uID0gcGFyYW1zLkFsbG93Q3VzdG9tTG9jYXRpb24gPyBldmFsKHBhcmFtcy5BbGxvd0N1c3RvbUxvY2F0aW9uLnRvTG93ZXJDYXNlKCkpIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5hbGxvd09ubHlTYW1lRGF5QWR2UmVzID0gcGFyYW1zLkFsbG93T25seVNhbWVEYXlBZHZSZXMgPyBldmFsKHBhcmFtcy5BbGxvd09ubHlTYW1lRGF5QWR2UmVzLnRvTG93ZXJDYXNlKCkpIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5wcm9taXNlV2luZG93ID0gcGFyYW1zLlByb21pc2VXaW5kb3cgPyBldmFsKHBhcmFtcy5Qcm9taXNlV2luZG93KSA6IDEwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuc2hvd0NhbmNlbE9wdGlvbnMgPSBwYXJhbXMuQ2FuY2VsUmVhc29uUmVxdWlyZWQgPyBldmFsKHBhcmFtcy5DYW5jZWxSZWFzb25SZXF1aXJlZC50b0xvd2VyQ2FzZSgpKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMucmVzZXJ2YXRpb25UeXBlID0gdm0ucmVzZXJ2YXRpb25UeXBlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYWxsb3dGYXJpbmcgPSBwYXJhbXMuQWxsb3dGYXJpbmcgPyBldmFsKHBhcmFtcy5BbGxvd0ZhcmluZy50b0xvd2VyQ2FzZSgpKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYWxsb3dMb2NhdGlvbk5vdGVzID0gcGFyYW1zLkFsbG93TG9jYXRpb25Ob3RlcyA/IGV2YWwocGFyYW1zLkFsbG93TG9jYXRpb25Ob3RlcykgOiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmFsbG93UGFzc2VuZ2VyVG9DYWxsID0gcGFyYW1zLkFsbG93UENEID8gZXZhbChwYXJhbXMuQWxsb3dQQ0QudG9Mb3dlckNhc2UoKSkgOiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmFsbG93UGFzc2VuZ2VyVG9TbXMgPSBwYXJhbXMuQWxsb3dQU0QgPyBldmFsKHBhcmFtcy5BbGxvd1BTRC50b0xvd2VyQ2FzZSgpKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYWxsb3dDaGlsZHJlbiA9IHBhcmFtcy5BbGxvd0NoaWxkcmVuID8gZXZhbChwYXJhbXMuQWxsb3dDaGlsZHJlbikgOiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5yZXNlcnZhdGlvbkZvcm1PcHRpb25zID0gb3B0aW9ucztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICBcdC8vZXh0cmEgb3B0aW9ucyBvbmx5IG5lZWRlZCBieSB1c2VyIHJlc2VydmF0aW9ucyBkaXJlY3RpdmUuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5pc1Bhc3NlbmdlciA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5pc1JlYWRPbmx5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmF1dG9SZWZyZXNoID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmJhdGNoRGF5cyA9IHBhcmFtcy5CYXRjaERheXMgPyBldmFsKHBhcmFtcy5CYXRjaERheXMpIDogNztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLm1pbkZyb21EYXlzID0gcGFyYW1zLk1pbkZyb21EYXlzID8gZXZhbChwYXJhbXMuTWluRnJvbURheXMpIDogMzA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0ucmVzZXJ2YXRpb25Gb3JtT3B0aW9ucyA9IG9wdGlvbnM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcignRXJyb3InLCByZXNwb25zZS5kYXRhLlJldHVybk1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgZ2V0TWFwKCk7XHJcbiAgICAgICAgICAgIC8vZ2V0QWN0aXZlVHJpcCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBhY3RpdmF0ZShwb3B1bGF0ZURpdmlzaW9uUGFyYW1ldGVycyk7XHJcblxyXG4gICAgICAgICRzY29wZS4kb24oJyRkZXN0cm95JywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzRGVmaW5lZChhdXRvUmVmcmVzaCkpIHtcclxuICAgICAgICAgICAgICAgICRpbnRlcnZhbC5jYW5jZWwoYXV0b1JlZnJlc2gpO1xyXG4gICAgICAgICAgICAgICAgYXV0b1JlZnJlc2ggPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gU3RhcnQgb2YgY29kZSBmb3IgSW9uaWNcclxuICAgICAgICB2bS5pb25pY0luY2x1ZGUgPSAnYXBwL21vZHVsZXMvb24tZGVtYW5kL2FjdGl2ZVRyaXAvYWN0aXZlLXRyaXAuaHRtbCc7XHJcbiAgICAgICAgdm0uaW9uaWNDdXN0b21DbGFzc05hbWUgPSAnJztcclxuICAgICAgICB2bS5pb25pY0hpZGVOYXZCYXIgPSBmYWxzZTtcclxuICAgICAgICB2bS5pb25pY1VzZVJlZnJlc2hlciA9IGZhbHNlO1xyXG4gICAgICAgIC8vIEVuZCBvZiBjb2RlIGZvciBJb25pY1xyXG4gICAgfVxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignUGFzc2VuZ2VyTW9iaWxlQ29udHJvbGxlcicsIFBhc3Nlbmdlck1vYmlsZUNvbnRyb2xsZXIpO1xyXG5cclxuICAgIFBhc3Nlbmdlck1vYmlsZUNvbnRyb2xsZXIuJGluamVjdCA9IFsnJGxvY2F0aW9uJywgJyR1aWJNb2RhbEluc3RhbmNlJywgJ3NldHRpbmdzJywgJ1NldHRpbmdzU2VydmljZScsICdVdGlsaXR5RmFjdG9yeSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIFBhc3Nlbmdlck1vYmlsZUNvbnRyb2xsZXIoJGxvY2F0aW9uLCAkdWliTW9kYWxJbnN0YW5jZSwgc2V0dGluZ3MsIFNldHRpbmdzU2VydmljZSwgVXRpbGl0eUZhY3RvcnkpIHtcclxuICAgICAgICAvKiBqc2hpbnQgdmFsaWR0aGlzOnRydWUgKi9cclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLnVwZGF0ZVNldHRpbmdzID0gdXBkYXRlU2V0dGluZ3M7XHJcbiAgICAgICAgdm0uY2FuY2VsID0gY2FuY2VsO1xyXG4gICAgICAgIHZtLnBhc3NlbmdlcklkID0gc2V0dGluZ3MucGFzc2VuZ2VySWQ7XHJcbiAgICAgICAgdm0uY2xpZW50VGVsZXBob25lID0gJyc7XHJcbiAgICAgICAgdm0uaXNVcGRhdGluZyA9IGZhbHNlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBjYW5jZWwoKSB7XHJcbiAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlU2V0dGluZ3MoKSB7XHJcbiAgICAgICAgICAgIHZtLmlzVXBkYXRpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICBpZiAodm0uY2xpZW50VGVsZXBob25lICE9IFwiXCIgJiYgIWlzTmFOKHZtLmNsaWVudFRlbGVwaG9uZSkgJiYgdm0uY2xpZW50VGVsZXBob25lID4gMCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1vYmlsZU51bWJlciA9IFwiKzFcIiArIHZtLmNsaWVudFRlbGVwaG9uZTtcclxuICAgICAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9IHtcclxuICAgICAgICAgICAgICAgICAgICBcIlBhc3NlbmdlcklkXCI6IHZtLnBhc3NlbmdlcklkLFxyXG4gICAgICAgICAgICAgICAgICAgIFwiQ2xpZW50VGVsZXBob25lXCI6IG1vYmlsZU51bWJlclxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgU2V0dGluZ3NTZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICAgICAudXBkYXRlU2V0dGluZ3Moc2V0dGluZ3MpXHJcbiAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgdm0uaXNVcGRhdGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgY2xvc2VNb2RhbChyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgdm0uaXNVcGRhdGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgY2xvc2VNb2RhbChmYWxzZSk7XHJcbiAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdm0uaXNVcGRhdGluZyA9IGZhbHNlOyBcclxuICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoJ0Vycm9yJywgJ1BsZWFzZSBlbnRlciBhIHZhbGlkIG51bWJlcicpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgY2xvc2VNb2RhbCA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZShyZXNwb25zZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBhY3RpdmF0ZSgpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHsgfVxyXG4gICAgfVxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ1RyaXBDYW5jZWxsYXRpb25Db250cm9sbGVyJywgVHJpcENhbmNlbGxhdGlvbkNvbnRyb2xsZXIpO1xyXG5cclxuICAgIFRyaXBDYW5jZWxsYXRpb25Db250cm9sbGVyLiRpbmplY3QgPSBbJyR1aWJNb2RhbEluc3RhbmNlJywgJ3RyaXBUb0NhbmNlbCcsICdzaG93Q2FuY2VsT3B0aW9ucycsICdVdGlsaXR5RmFjdG9yeScsICdTY2hlZHVsZVNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBUcmlwQ2FuY2VsbGF0aW9uQ29udHJvbGxlcigkdWliTW9kYWxJbnN0YW5jZSwgdHJpcFRvQ2FuY2VsLCBzaG93Q2FuY2VsT3B0aW9ucywgVXRpbGl0eUZhY3RvcnksIFNjaGVkdWxlU2VydmljZSkge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdm0udHJpcFRvQ2FuY2VsID0gdHJpcFRvQ2FuY2VsO1xyXG4gICAgICAgIHZtLnNob3dDYW5jZWxPcHRpb25zID0gc2hvd0NhbmNlbE9wdGlvbnM7XHJcbiAgICAgICAgdm0uY2FuY2VsRXJyb3IgPSBmYWxzZTtcclxuICAgICAgICB2bS5kaXNhYmxlID0gZmFsc2U7XHJcbiAgICAgICAgdm0ucmVhc29uQ29tbWVudCA9ICcnO1xyXG5cclxuICAgICAgICB2bS5jYW5jZWxUcmlwID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2bS5kaXNhYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJ1RyaXBJRCc6IHRyaXBUb0NhbmNlbC50cmlwSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgJ1Bhc3NlbmdlcklEJzogdHJpcFRvQ2FuY2VsLnBhc3NlbmdlcklkLFxyXG4gICAgICAgICAgICAgICAgICAgICdPcGVyYXRpb25JRCc6IG51bGxcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGlmICh2bS5zaG93Q2FuY2VsT3B0aW9ucylcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYodm0uY2FuY2VsUmVhc29uKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuQ2FuY2VsUmVhc29uSWQgPSB2bS5jYW5jZWxSZWFzb24uUmVhc29uSWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5DYW5jZWxSZWFzb25UZXh0ID0gdm0uY2FuY2VsUmVhc29uLlJlYXNvbjtcclxuICAgICAgICAgICAgICAgICAgICBpZih2bS5yZWFzb25Db21tZW50LnRyaW0oKSAhPSAnJylcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuQ2FuY2VsUmVhc29uVGV4dCArPSAnIC0gJyArIHZtLnJlYXNvbkNvbW1lbnQudHJpbSgpLnJlcGxhY2UoL1teYS16QS1aXFxkLEAhXFwuXFwoXFwpXFwtXFwqIFxcc10vZywgJycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihyZXF1ZXN0LkNhbmNlbFJlYXNvblRleHQubGVuZ3RoID4gMjUwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKFwiRXJyb3IhXCIsIFwiQ29tbWVudCB0b28gbG9uZy4gUGxlYXNlIG1ha2UgaXQgc2hvcnRlclwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLmRpc2FibGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh2bS5jYW5jZWxSZWFzb24uUmVhc29uID09PSAnT3RoZXInICYmIHZtLnJlYXNvbkNvbW1lbnQudHJpbSgpID09PSAnJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKFwiRXJyb3IhXCIsIFwiWW91IHNlbGVjdGVkIE90aGVyLCBwbGVhc2UgdHlwZSBhIHJlYXNvbi5cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmRpc2FibGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoXCJFcnJvciFcIiwgXCJQbGVhc2UgcHJvdmlkZSBhIHJlYXNvbiBmb3IgY2FuY2VsbGF0aW9uXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmRpc2FibGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgU2NoZWR1bGVTZXJ2aWNlLmNhbmNlbHBvc3QocmVxdWVzdCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSh7ICdhY3Rpb24nOiAnY2xvc2UnLCAnaXNDYW5jZWwnOiB0cnVlIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5jYW5jZWxFcnJvciA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2bS5kaXNhYmxlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgdm0uZGlzYWJsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdm0uY2FuY2VsRXJyb3IgPSB0cnVlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2NhbmNlbCcpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMuTWFrZURpc2FibGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICh2bS5kaXNhYmxlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLmRpc2FsbG93U3BlY2lhbENoYXIgPSBmdW5jdGlvbigpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBpZih2bS5yZWFzb25Db21tZW50LnRyaW0oKSAhPT0gJycpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZtLnJlYXNvbkNvbW1lbnQgPSB2bS5yZWFzb25Db21tZW50LnJlcGxhY2UoL1teYS16QS1aXFxkLEAhXFwuXFwoXFwpXFwtXFwqIFxcc10vZywgJycpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBhY3RpdmF0ZSgpO1xyXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xyXG4gICAgICAgICAgICAvL2ZpcnN0IGdldCBwYXJhbWV0ZXIgdG8gY2hlY2sgaWYgdHJpcCBjYW5jZWwgc3RhdHVzIGlzIG5lZWRlZC5cclxuICAgICAgICAgICAgLy9nZXQgdHJpcCBjYW5jZWxsYXRpb24gc3RhdHVzZXNcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiAodm0uc2hvd0NhbmNlbE9wdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgIFNjaGVkdWxlU2VydmljZS5nZXRUcmlwQ2FuY2VsU3RhdHVzTGlzdCgpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmNhbmNlbFJlYXNvbnMgPSByZXNwb25zZS5kYXRhLnJlc3VsdDtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikgeyB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ29uZU1WQXBwJyk7XHJcbiAgICBhcHAuY29udHJvbGxlcignRmFyaW5nTW9kYWxDb250cm9sbGVyJywgRmFyaW5nTW9kYWxDb250cm9sbGVyKTtcclxuXHJcbiAgICBGYXJpbmdNb2RhbENvbnRyb2xsZXIuJGluamVjdCA9IFsnJHNjb3BlJywgJ1V0aWxpdHlGYWN0b3J5JywgJ0ZhcmluZ1NlcnZpY2UnLCAnJGxvZycsICckdWliTW9kYWxJbnN0YW5jZScsICdEaXZpc2lvblNlcnZpY2UnLCAnUHJvZmlsZVNlcnZpY2UnLCAncmVzZXJ2YXRpb25SZXF1ZXN0JywgJ3NlcnZpY2VEYXRlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gRmFyaW5nTW9kYWxDb250cm9sbGVyKCRzY29wZSwgVXRpbGl0eUZhY3RvcnksIEZhcmluZ1NlcnZpY2UsICRsb2csICR1aWJNb2RhbEluc3RhbmNlLCBEaXZpc2lvblNlcnZpY2UsIFByb2ZpbGVTZXJ2aWNlLCByZXNlcnZhdGlvblJlcXVlc3QsIHNlcnZpY2VEYXRlICkge1xyXG4gICAgICAgICRzY29wZS5jYW5jZWwgPSBjYW5jZWw7XHJcbiAgICAgICAgJHNjb3BlLnNhdmVDb21wYW5pb25zID0gc2F2ZUNvbXBhbmlvbnM7XHJcbiAgICAgICAgJHNjb3BlLnJlc2V0Q29tcGFuaW9ucyA9IHJlc2V0Q29tcGFuaW9ucztcclxuICAgICAgICAkc2NvcGUuZWRpdENvbXBhbmlvbnMgPSBlZGl0Q29tcGFuaW9ucztcclxuICAgICAgICAkc2NvcGUuaW5jcmVhc2VDb3VudCA9IGluY3JlYXNlQ291bnQ7XHJcbiAgICAgICAgJHNjb3BlLmRlY3JlYXNlQ291bnQgPSBkZWNyZWFzZUNvdW50O1xyXG4gICAgICAgICRzY29wZS5ib29rVHJpcCA9IGJvb2tUcmlwO1xyXG4gICAgICAgICRzY29wZS5pc0hpZGRlbiA9IHRydWU7XHJcbiAgICAgICAgJHNjb3BlLmxvY2F0aW9uTm90ZXMgPSB7ICdmcm9tJzogJycsICd0byc6ICcnIH1cclxuXHJcbiAgICAgICAgJHNjb3BlLm1heENvdW50ID0gJHNjb3BlLiRwYXJlbnQub3B0aW9ucy5pc0NvbXBhbmlvbiA/ICRzY29wZS4kcGFyZW50Lm9wdGlvbnMuY29tcGFuaW9uc0xpbWl0IDogMDtcclxuICAgICAgICAkc2NvcGUuY29tcGFuaW9uQ291bnQgPSAwO1xyXG4gICAgICAgICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QgPSByZXNlcnZhdGlvblJlcXVlc3Q7ICBcclxuICAgICAgICAkc2NvcGUuc2VydmljZURhdGUgPSBzZXJ2aWNlRGF0ZS5mb3JtYXQoJ1lZWVktTU0tREQnKTtcclxuICAgICAgICAkc2NvcGUuY29tcGFuaW9uRmFyZSA9IDA7XHJcbiAgICAgICAgJHNjb3BlLmJhc2VGYXJlID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICRzY29wZS5tYXhDb21wYW5pb25Db3VudFdhcm5pbmcgPSBmYWxzZTtcclxuICAgICAgICB2YXIgbGFzdEZhcmVUeXBlcyA9IHVuZGVmaW5lZDtcclxuICAgICAgICB2YXIgbGFzdENvbXBhbmlvbkZhcmUgPSAwO1xyXG4gICAgICAgIHZhciBsYXN0Q29tcGFuaW9uQ291bnQgPSAwO1xyXG4gICAgICAgIHZhciByZXNlcnZhdGlvblRpbWUgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgJHNjb3BlLmZhcmVUeXBlcyA9IFtdO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBpbmNyZWFzZUNvdW50KGluZGV4KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy8gQWRkZWQgY2hlY2sgdG8gbWFrZSBzdXJlIHRoZSB1c2VyIGRvZXMgbm90IGFkZCBtb3JlIHRoYW4gJHNjb3BlLm1heENvdW50XHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUuY29tcGFuaW9uQ291bnQgPCAkc2NvcGUubWF4Q291bnQpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5mYXJlVHlwZXNbaW5kZXhdLk51bWJlck9mUGFzc2VuZ2VycysrO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmNvbXBhbmlvbkZhcmUgPSAkc2NvcGUuY29tcGFuaW9uRmFyZSArICRzY29wZS5mYXJlVHlwZXNbaW5kZXhdLkZhcmU7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuY29tcGFuaW9uQ291bnQrKztcclxuICAgICAgICAgICAgICAgICRzY29wZS5tYXhDb21wYW5pb25Db3VudFdhcm5pbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5tYXhDb21wYW5pb25Db3VudFdhcm5pbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBkZWNyZWFzZUNvdW50KGluZGV4KSB7XHJcbiAgICAgICAgICAgIC8vIEFkZGVkIGNoZWNrIHRvIG1ha2Ugc3VyZSB0aGUgdXNlciBkb2VzIG5vdCByZW1vdmUgbGVzcyB0aGFuIDAuXHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUuZmFyZVR5cGVzW2luZGV4XS5OdW1iZXJPZlBhc3NlbmdlcnMgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZmFyZVR5cGVzW2luZGV4XS5OdW1iZXJPZlBhc3NlbmdlcnMtLTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5jb21wYW5pb25GYXJlID0gJHNjb3BlLmNvbXBhbmlvbkZhcmUgLSAkc2NvcGUuZmFyZVR5cGVzW2luZGV4XS5GYXJlO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmNvbXBhbmlvbkNvdW50LS07XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubWF4Q29tcGFuaW9uQ291bnRXYXJuaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfVxyXG4gICAgICBcclxuICAgICAgIFxyXG4gICAgICAgIHZhciBmcm9tTG9jYXRpb24gPSByZXNlcnZhdGlvblJlcXVlc3QuZnJvbUxvY2F0aW9uO1xyXG4gICAgICAgIHZhciB0b0xvY2F0aW9uID0gcmVzZXJ2YXRpb25SZXF1ZXN0LnRvTG9jYXRpb247XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNhbmNlbCgpIHtcclxuICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5Jc1doZWVsQ2hhaXIgPSBmYWxzZTtcclxuICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5Jc1BDQSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LklzU2VydmljZUFuaW1hbCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LlRyaXBGYXJlcyA9IFtdO1xyXG4gICAgICAgICAgICAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LkJhc2VGYXJlID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAkc2NvcGUubWF4Q29tcGFuaW9uQ291bnRXYXJuaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QpO1xyXG5cclxuICAgICAgICAgICAgLy9yZXNldCBjb21wYW5pb25zIGFuZCBhY2Nlc3NpYmlsaXR5XHJcbiAgICAgICAgfTtcclxuICAgICAgICBcclxuICAgICAgICBcclxuICAgICAgICBmdW5jdGlvbiBzYXZlQ29tcGFuaW9ucygpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAkc2NvcGUuc2hvd0NvbXBhbmlvblNlbGVjdGlvbiA9ICEkc2NvcGUuc2hvd0NvbXBhbmlvblNlbGVjdGlvbjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZnVuY3Rpb24gcmVzZXRDb21wYW5pb25zKClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgXHJcbiAgICAgICAgICAgICRzY29wZS5mYXJlVHlwZXMgPSBhbmd1bGFyLmNvcHkobGFzdEZhcmVUeXBlcyk7XHJcbiAgICAgICAgICAgIC8vcmVzZXQgd2hlZWxjaGFpcnMgZXRjLlxyXG4gICAgICAgICAgICAkc2NvcGUuY29tcGFuaW9uRmFyZSA9IGxhc3RDb21wYW5pb25GYXJlO1xyXG4gICAgICAgICAgICAkc2NvcGUuY29tcGFuaW9uQ291bnQgPSBsYXN0Q29tcGFuaW9uQ291bnQ7XHJcbiAgICAgICAgICAgICRzY29wZS5zaG93Q29tcGFuaW9uU2VsZWN0aW9uID0gISRzY29wZS5zaG93Q29tcGFuaW9uU2VsZWN0aW9uO1xyXG4gICAgICAgICAgICAkc2NvcGUubWF4Q29tcGFuaW9uQ291bnRXYXJuaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIC8vY29tcGFuaW9uIG9iamVjdCBzaG91bGQgYmUgcmVzZXQgdG8gMCBjb3VudFxyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBlZGl0Q29tcGFuaW9ucygpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBsYXN0RmFyZVR5cGVzID0gYW5ndWxhci5jb3B5KCRzY29wZS5mYXJlVHlwZXMpO1xyXG4gICAgICAgICAgICBsYXN0Q29tcGFuaW9uRmFyZSA9ICRzY29wZS5jb21wYW5pb25GYXJlO1xyXG4gICAgICAgICAgICBsYXN0Q29tcGFuaW9uQ291bnQgPSAkc2NvcGUuY29tcGFuaW9uQ291bnQ7XHJcbiAgICAgICAgICAgICRzY29wZS5zaG93Q29tcGFuaW9uU2VsZWN0aW9uID0gISRzY29wZS5zaG93Q29tcGFuaW9uU2VsZWN0aW9uO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYm9va1RyaXAoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS5iYXNlRmFyZSA9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoJ0Vycm9yJywgJ0NhbiBub3QgZ2V0IGZhcmluZyBpbmZvcm1hdGlvbi4gUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci4nKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLiRwYXJlbnQub3B0aW9ucy5hbGxvd0xvY2F0aW9uTm90ZXMpIHtcclxuICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LmxvY2F0aW9uTm90ZXMuZnJvbSA9ICRzY29wZS5sb2NhdGlvbk5vdGVzLmZyb207XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LmxvY2F0aW9uTm90ZXMudG8gPSAkc2NvcGUubG9jYXRpb25Ob3Rlcy50bztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LlRyaXBGYXJlcyA9ICRzY29wZS5mYXJlVHlwZXM7XHJcbiAgICAgICAgICAgICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QuVG90YWxUcmlwRmFyZSA9ICRzY29wZS5iYXNlRmFyZSArICRzY29wZS5jb21wYW5pb25GYXJlO1xyXG4gICAgICAgICAgICAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LkNvbXBhbmlvbnNDb3VudCA9ICRzY29wZS5jb21wYW5pb25Db3VudDtcclxuICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5CYXNlRmFyZSA9ICRzY29wZS5iYXNlRmFyZTtcclxuICAgICAgICAgICAgJHNjb3BlLiRwYXJlbnQuc2F2ZVJlc2VydmF0aW9uKCRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QpO1xyXG4gICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBnZXRGYXJlcygpIHtcclxuICAgICAgICAgICAgJHNjb3BlLnJlcXVlc3RlZFRpbWUgPSByZXNlcnZhdGlvblRpbWUuZm9ybWF0KCdNTS9ERC9ZWVlZIGhoOm1tIEEnKTtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QuVHJpcEZhcmVzICE9IG51bGwgJiYgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5UcmlwRmFyZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmZhcmVUeXBlcyA9ICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QuVHJpcEZhcmVzO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmJhc2VGYXJlID0gJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5CYXNlRmFyZTtcclxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCgkc2NvcGUuZmFyZVR5cGVzLCBmdW5jdGlvbiAodmFsdWUsIGtleSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5OdW1iZXJPZlBhc3NlbmdlcnMgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5jb21wYW5pb25Db3VudCArPSB2YWx1ZS5OdW1iZXJPZlBhc3NlbmdlcnM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5jb21wYW5pb25GYXJlICs9ICh2YWx1ZS5GYXJlICogdmFsdWUuTnVtYmVyT2ZQYXNzZW5nZXJzKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LmxvY2F0aW9uTm90ZXMgJiYgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5sb2NhdGlvbk5vdGVzLmZyb20gIT0gJycpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmxvY2F0aW9uTm90ZXMuZnJvbSA9ICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QubG9jYXRpb25Ob3Rlcy5mcm9tO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QubG9jYXRpb25Ob3RlcyAmJiAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LmxvY2F0aW9uTm90ZXMudG8gIT0gJycpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubG9jYXRpb25Ob3Rlcy50byA9ICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QubG9jYXRpb25Ob3Rlcy50bztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgJHNjb3BlLmZhcmVUeXBlcyA9IFtdO1xyXG5cclxuICAgICAgICAgICAgRmFyaW5nU2VydmljZS5HZXRab25lRmFyZXMoJHNjb3BlLmRpdmlzaW9uSWQsICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QuZnJvbVpvbmUsICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QudG9ab25lLCByZXNlcnZhdGlvblRpbWUuZm9ybWF0KFwiWVlZWS1NTS1ERCBISG1tc3NcIiksICRzY29wZS5zZXJ2aWNlRGF0ZSlcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBpZihyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBmYXJlcyA9IHJlc3BvbnNlLmRhdGEucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChmYXJlcywgZnVuY3Rpb24odmFsdWUsIGtleSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5mYXJlVHlwZXMucHVzaCh7IFBhc3NlbmdlckZhcmVUeXBlSWQ6IHZhbHVlLlBhc3NlbmdlckZhcmVUeXBlSWQsIE51bWJlck9mUGFzc2VuZ2VyczogMCwgTmFtZTogdmFsdWUuRmFyZVR5cGUsIEZhcmU6IHZhbHVlLkZhcmUsIFpvbmVGYXJlSWQ6IHZhbHVlLlpvbmVGYXJlSWQgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2V0QmFzZUZhcmUoZmFyZXMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmJhc2VGYXJlID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiBlcnJvcihlcnIpIHtcclxuICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoJ0Vycm9yJywgJ0NhbiBub3QgZ2V0IGZhcmluZyBpbmZvcm1hdGlvbi4gUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci4nKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5iYXNlRmFyZSA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBcclxuICAgICAgICBhY3RpdmF0ZShnZXRGYXJlcyk7XHJcbiAgICAgICAgZnVuY3Rpb24gc2V0RGVmYXVsdEZhcmUoZmFyZXMpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgZmFyZXMubGVuZ3RoOyBpKyspXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlmIChmYXJlc1tpXS5Jc0RlZmF1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYmFzZUZhcmUgPSBmYXJlc1tpXS5GYXJlO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAkc2NvcGUuYmFzZUZhcmUgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzZXRCYXNlRmFyZShmYXJlcylcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIC8vZGVmYXVsdCBmYXJlIGlzIHNldCwgaWYgZmFyZSBpcyBmb3VuZCBpdCB3aWxsIG92ZXIgd3JpdGUgaXRcclxuICAgICAgICAgICAgc2V0RGVmYXVsdEZhcmUoZmFyZXMpO1xyXG4gICAgICAgICAgICBQcm9maWxlU2VydmljZS5HZXRQYXNzZW5nZXJBZ2UoJHNjb3BlLiRwYXJlbnQucGFzc2VuZ2VyLklkKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKXtcclxuICAgICAgICAgICAgICAgICAgICBpZihyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFnZSA9IHJlc3BvbnNlLmRhdGEucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBmYXJlcy5sZW5ndGg7IGkrKykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmFyZXNbaV0uRnJvbUFnZSA9PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhZ2UgPj0gZmFyZXNbaV0uRnJvbUFnZSAmJiAoZmFyZXNbaV0uVG9BZ2UgPT0gdW5kZWZpbmVkIHx8IGFnZSA8PSBmYXJlc1tpXS5Ub0FnZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmJhc2VGYXJlID0gZmFyZXNbaV0uRmFyZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoY2FsbGJhY2spIHtcclxuICAgICAgICAgXHJcbiAgICAgICAgICAgICRzY29wZS5kaXZpc2lvbklkID0gRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKTtcclxuICAgICAgICAgICAgaWYgKCRzY29wZS5kaXZpc2lvbklkICE9IG51bGwgJiYgJHNjb3BlLmRpdmlzaW9uSWQgIT0gdW5kZWZpbmVkICYmICRzY29wZS5kaXZpc2lvbklkICE9ICcnKSB7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LnJlc2VydmF0aW9uVHlwZSAhPSAkc2NvcGUuJHBhcmVudC5yZXNlcnZhdGlvblR5cGVFbnVtLkFTQVApXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzZXJ2YXRpb25UaW1lID0gJHNjb3BlLiRwYXJlbnQuZ2V0UmVzZXJ2YXRpb25EYXRlVGltZSgkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0KTtcclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICByZXNlcnZhdGlvblRpbWUgPSBtb21lbnQudHooRGl2aXNpb25TZXJ2aWNlLmdldFRpbWVab25lKCkpO1xyXG4gICAgICAgICAgICAgICAgRGl2aXNpb25TZXJ2aWNlLmdldFNlcnZpY2VEYXRlQnlEaXZpc2lvblRpbWUoJHNjb3BlLmRpdmlzaW9uSWQsIHJlc2VydmF0aW9uVGltZS5mb3JtYXQoXCJZWVlZLU1NLUREIEhIbW1zc1wiKSlcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zZXJ2aWNlRGF0ZSA9IG1vbWVudChyZXNwb25zZS5kYXRhLnJlc3VsdCkuZm9ybWF0KFwiWVlZWS1NTS1ERFwiKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2sgJiYgdHlwZW9mIGNhbGxiYWNrID09PSBcImZ1bmN0aW9uXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKCdFcnJvcicsICdDYW4gbm90IGdldCBmYXJpbmcgaW5mb3JtYXRpb24uIFBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmJhc2VGYXJlID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJ2Rhc2hib2FyZC8nKTtcclxuICAgICAgICAgICBcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ29uZU1WQXBwJyk7XHJcbiAgICBhcHAuY29udHJvbGxlcignRGlzcGxheVNjaGVkdWxlZFRyaXBDb250cm9sbGVyJywgRGlzcGxheVRyaXBNb2RhbENvbnRyb2xsZXIpO1xyXG5cclxuICAgIERpc3BsYXlUcmlwTW9kYWxDb250cm9sbGVyLiRpbmplY3QgPSBbJyRzY29wZScsICckaHR0cCcsICdVdGlsaXR5RmFjdG9yeScsICdEYXRlRmFjdG9yeScsXHJcbiAgICAgICAgJyRsb2cnLCAnJHVpYk1vZGFsSW5zdGFuY2UnLCAndHJpcCcsICdDb25maWdGYWN0b3J5Jywnb3B0aW9ucyddO1xyXG5cclxuICAgIGZ1bmN0aW9uIERpc3BsYXlUcmlwTW9kYWxDb250cm9sbGVyKCRzY29wZSwgJGh0dHAsIFV0aWxpdHlGYWN0b3J5LCBEYXRlRmFjdG9yeSxcclxuICAgICAgICAkbG9nLCAkdWliTW9kYWxJbnN0YW5jZSwgdHJpcCxDb25maWdGYWN0b3J5LCBvcHRpb25zKSB7XHJcblxyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdm0udHJpcCA9IHRyaXA7XHJcblxyXG4gICAgICAgIHZhciBzeXN0ZW1QYXJhbXMgPSBvcHRpb25zO1xyXG5cclxuICAgICAgICB2bS5hbGxvd0ZhcmluZyA9IHN5c3RlbVBhcmFtcy5hbGxvd0ZhcmluZztcclxuICAgICAgICB2bS5hbGxvd0NoaWxkcmVuID0gc3lzdGVtUGFyYW1zLmFsbG93Q2hpbGRyZW47XHJcbiAgICAgICAgdm0uYWxsb3dMb2NhdGlvbk5vdGVzID0gc3lzdGVtUGFyYW1zLmFsbG93TG9jYXRpb25Ob3RlczsgXHJcblxyXG4gICAgICAgIHZhciBzdGFydFRpbWUgPSBuZXcgbW9tZW50KHZtLnRyaXAuU2NoZWR1bGVkUGlja3VwVGltZSk7XHJcbiAgICAgICAgdm0udHJpcC5wcm9taXNlV2luZG93U3RhcnRUaW1lID0gc3RhcnRUaW1lLmZvcm1hdCgnaDptbSBBJyk7XHJcbiAgICAgICAgaWYgKG1vbWVudC5pc01vbWVudChzdGFydFRpbWUpKVxyXG4gICAgICAgICAgICB2bS50cmlwLnByb21pc2VXaW5kb3dFbmRUaW1lID0gc3RhcnRUaW1lLmFkZChwYXJzZUludChzeXN0ZW1QYXJhbXMucHJvbWlzZVdpbmRvdyksICdtJykuZm9ybWF0KCdoOm1tIEEnKTtcclxuICAgICAgICB2bS5jYW5jZWwgPSBjYW5jZWw7XHJcbiAgICAgICAgdm0uY2FuY2VsVHJpcCA9IGNhbmNlbFRyaXA7XHJcbiAgICAgICAgZnVuY3Rpb24gY2FuY2VsKCkge1xyXG4gICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNhbmNlbFRyaXAodHJpcElkKVxyXG4gICAgICAgIHtcclxuXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgdmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdvbmVNVkFwcCcpO1xyXG4gICAgYXBwLmZhY3RvcnkoJ0ZhcmluZ1NlcnZpY2UnLCBGYXJpbmdTZXJ2aWNlKTtcclxuICAgIEZhcmluZ1NlcnZpY2UuJGluamVjdCA9IFsnJGh0dHAnLCAnJHEnLCAnQ29uZmlnRmFjdG9yeScsICdhdXRoU2VydmljZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIEZhcmluZ1NlcnZpY2UoJGh0dHAsICRxLCBDb25maWdGYWN0b3J5LCBhdXRoU2VydmljZSkge1xyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgICAgICBHZXRab25lSURGb3JMb2NhdGlvbjogZ2V0Wm9uZUlERm9yTG9jYXRpb24sXHJcbiAgICAgICAgICAgIEdldFpvbmVGYXJlczogZ2V0Wm9uZUZhcmVzXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0Wm9uZUZhcmVzKGRpdmlzaW9uSWQsIGZyb21ab25lLCB0b1pvbmUsIHJlc2VydmF0aW9uVGltZSwgc2VydmljZURhdGUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXIgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICBDb25maWdGYWN0b3J5LmdldE9uZU1WQXBpVVJMUHJvbWlzZSgpLnRoZW4oZnVuY3Rpb24gKG9uZU1WVVJMKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAob25lTVZVUkwgJiYgb25lTVZVUkwgIT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vZ2V0IHRoZSBiYXNlIHVybCBmcm9tIGNvbmZpZy5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgX3VybCA9IG9uZU1WVVJMICsgXCJmYXJpbmcvXCIgKyBkaXZpc2lvbklkICsgXCIvXCIgKyBmcm9tWm9uZSArIFwiL1wiICsgdG9ab25lICsgXCIvXCIgKyByZXNlcnZhdGlvblRpbWUgKyBcIi9cIiArIHNlcnZpY2VEYXRlO1xyXG4gICAgICAgICAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBfdXJsXHJcbiAgICAgICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9pZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZlci5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy99IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgZGVmZXIucmVqZWN0KHJlc3BvbnNlLmRhdGEucmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy99XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjayhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZlci5yZWplY3QocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVyLnByb21pc2U7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBnZXRab25lSURGb3JMb2NhdGlvbihsYXRpdHVkZSwgbG9uZ2l0dWRlLCBkaXZpc2lvbklkKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgLy9zaG91bGQgaGF2ZSBtZXRob2QgaW4gc2VjdXJlZCBhcGkgXHJcbiAgICAgICAgICAgIHZhciBkZWZlciA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIENvbmZpZ0ZhY3RvcnkuZ2V0T25lTVZBcGlVUkxQcm9taXNlKCkudGhlbihmdW5jdGlvbiAob25lTVZVUkwpIHtcclxuICAgICAgICAgICAgICAgIGlmIChvbmVNVlVSTCAmJiBvbmVNVlVSTCAhPSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9nZXQgdGhlIGJhc2UgdXJsIGZyb20gY29uZmlnLlxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBfdXJsID0gb25lTVZVUkwgKyBcImZhcmluZy9nZXRab25lSWRGb3JMb2NhdGlvbi9cIiArIGRpdmlzaW9uSWQgKyBcIi9cIiArIGxhdGl0dWRlICsgXCIvXCIgKyBsb25naXR1ZGUgKyBcIi9cIjtcclxuICAgICAgICAgICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogX3VybFxyXG4gICAgICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXIucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gIGRlZmVyLnJlamVjdChyZXNwb25zZS5kYXRhLnJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vfVxyXG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2socmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXIucmVqZWN0KHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlci5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnb25lTVZBcHAnKTtcclxuICAgIGFwcC5mYWN0b3J5KCdGZWVkYmFja1NlcnZpY2UnLCBGZWVkYmFja1NlcnZpY2UpO1xyXG4gICAgRmVlZGJhY2tTZXJ2aWNlLiRpbmplY3QgPSBbJyRodHRwJywgJyRxJywgJ0NvbmZpZ0ZhY3RvcnknLCdhdXRoU2VydmljZScsJ0RpdmlzaW9uU2VydmljZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIEZlZWRiYWNrU2VydmljZSgkaHR0cCwgJHEsIENvbmZpZ0ZhY3RvcnksIGF1dGhTZXJ2aWNlLERpdmlzaW9uU2VydmljZSkge1xyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgICAgICBTYXZlRmVlZGJhY2s6IHNhdmVGZWVkYmFjayxcclxuICAgICAgICAgICAgYWRkQ29tbXV0ZXJGZWVkYmFjayA6IGFkZENvbW11dGVyRmVlZGJhY2tcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBzYXZlRmVlZGJhY2soZmVlZGJhY2tSZXF1ZXN0KSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlciA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIENvbmZpZ0ZhY3RvcnkuZ2V0T25lTVZBcGlVUkxQcm9taXNlKCkudGhlbihmdW5jdGlvbiAob25lTVZVUkwpIHtcclxuICAgICAgICAgICAgICAgIGlmIChvbmVNVlVSTCAmJiBvbmVNVlVSTCAhPSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9nZXQgdGhlIGJhc2UgdXJsIGZyb20gY29uZmlnLlxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBfdXJsID0gb25lTVZVUkwgKyBcInRyaXAvXCIgKyBhdXRoU2VydmljZS5hdXRoZW50aWNhdGlvbi5wYXNzZW5nZXJJZCArIFwiL2ZlZWRiYWNrL3NhdmVcIjtcclxuICAgICAgICAgICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB1cmw6IF91cmwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KGZlZWRiYWNrUmVxdWVzdCksXHJcbiAgICAgICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9pZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZlci5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy99IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAgZGVmZXIucmVqZWN0KHJlc3BvbnNlLmRhdGEucmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy99XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjayhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZlci5yZWplY3QocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVyLnByb21pc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBhZGRDb21tdXRlckZlZWRiYWNrKGZlZWRiYWNrUmVxdWVzdCwgcmVzZXJ2YXRpb25JZCkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXIgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICBDb25maWdGYWN0b3J5LmdldE9uZU1WQXBpVVJMUHJvbWlzZSgpLnRoZW4oZnVuY3Rpb24gKG9uZU1WVVJMKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAob25lTVZVUkwgJiYgb25lTVZVUkwgIT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBfdXJsID0gb25lTVZVUkwgKyBcImNvbW11dGVyL1wiICsgRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKSArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiL3Jlc2VydmF0aW9ucy9mZWVkYmFjay9cIiArIGF1dGhTZXJ2aWNlLmF1dGhlbnRpY2F0aW9uLnBhc3NlbmdlcklkICsgXCIvXCIgKyByZXNlcnZhdGlvbklkO1xyXG4gICAgICAgICAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogX3VybCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZmVlZGJhY2tSZXF1ZXN0LFxyXG4gICAgICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVyLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2socmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXIucmVqZWN0KHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlci5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0ZpeGVkUm91dGVzQ29udHJvbGxlcicsIEZpeGVkUm91dGVzQ29udHJvbGxlcik7XHJcblxyXG4gICAgRml4ZWRSb3V0ZXNDb250cm9sbGVyLiRpbmplY3QgPSBbICckdWliTW9kYWxJbnN0YW5jZScsICd1cGNvbWluZ1NjaGVkdWxlcycsICdmcm9tU3RvcE5hbWUnLCdPbmVNdlNlcnZpY2VzJ107XHJcblxyXG4gICAgZnVuY3Rpb24gRml4ZWRSb3V0ZXNDb250cm9sbGVyKCAkdWliTW9kYWxJbnN0YW5jZSwgdXBjb21pbmdTY2hlZHVsZXMsIGZyb21TdG9wTmFtZSxPbmVNdlNlcnZpY2VzKSB7XHJcbiAgICAgICAgLyoganNoaW50IHZhbGlkdGhpczp0cnVlICovXHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS51cGNvbWluZ1NjaGVkdWxlcyA9IHVwY29taW5nU2NoZWR1bGVzO1xyXG4gICAgICAgIHZtLmZyb21TdG9wTmFtZSA9IGZyb21TdG9wTmFtZTtcclxuICAgICAgICB2bS5jYW5jZWwgPSBjYW5jZWw7XHJcbiAgICAgICAgdm0uZnJJbmZvID0gT25lTXZTZXJ2aWNlcy5nZXRGaXhlZFJvdXRlSW5mbygpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBjYW5jZWwoKSB7XHJcbiAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgYWN0aXZhdGUoKTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7IH1cclxuICAgIH1cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5kaXJlY3RpdmUoJ2xvY2F0aW9uU2VhcmNoRGlyZWN0aXZlJywgbG9jYXRpb25TZWFyY2hEaXJlY3RpdmUpO1xyXG5cclxuICAgIGxvY2F0aW9uU2VhcmNoRGlyZWN0aXZlLiRpbmplY3QgPSBbJ0xvY2F0aW9uRmFjdG9yeScsICckcm9vdFNjb3BlJywgJyRxJywgJ1NjaGVkdWxlU2VydmljZScsICdVdGlsaXR5RmFjdG9yeScsICdhdXRoU2VydmljZScsICdEaXZpc2lvblNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBsb2NhdGlvblNlYXJjaERpcmVjdGl2ZShMb2NhdGlvbkZhY3RvcnksICRyb290U2NvcGUsICRxLCBTY2hlZHVsZVNlcnZpY2UsIFV0aWxpdHlGYWN0b3J5LCBhdXRoU2VydmljZSwgRGl2aXNpb25TZXJ2aWNlKSB7XHJcbiAgICAgICAgLy8gVXNhZ2U6XHJcbiAgICAgICAgLy8gICAgIDxMb2NhdGlvbi1zZWFyY2gtZGlyZWN0aXZlPjwvTG9jYXRpb24tc2VhcmNoLWRpcmVjdGl2ZT5cclxuICAgICAgICAvLyBDcmVhdGVzOlxyXG4gICAgICAgIC8vIFxyXG4gICAgICAgIC8vbG9jYXRpb25maWx0ZXI9MCBtZWFucyBTaG93IExvY2F0aW9ucyB0aGF0IGFyZSBNYW51YWxseSBhZGRlZCB0byB0aGUgb25lTVYgRGF0YWJhc2UoZm9yIG5vdylcclxuICAgICAgICAvL2xvY2F0aW9uZmlsdGVyPTEgbWVhbnMgU2hvdyBMb2NhdGlvbnMgYm90aCB0aGF0IGFyZSBNYW51YWxseSBhZGRlZCB0byB0aGUgb25lTVYgRGF0YWJhc2UgYW5kIGFsc28gZnJvbSB0aGUgZ29vZ2xlIGFwaShmb3Igbm93KVxyXG4gICAgICAgIC8vbG9jYXRpb25maWx0ZXIgaXMgZHluYW1pYyBlbm91Z2ggdG8gYmUgZXhwYW5kZWQgaW4gZnV0dXJlXHJcblxyXG4gICAgICAgIHZhciBkaXJlY3RpdmUgPSB7XHJcbiAgICAgICAgICAgIGxpbms6IGxpbmssXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IGNvbnRyb2xsZXIsXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgICAgICBvbkxvY2F0aW9uU2VsZWN0ZWQ6ICcmJywgbWlubGVuZ3RoOiAnPW1pbmxlbmd0aCcsIGxvY2F0aW9uZmlsdGVyOiAnQCcsXHJcbiAgICAgICAgICAgICAgICBsYWJlbG5hbWU6ICc9bGFiZWxuYW1lJywgc2VsZWN0ZWRsb2NhdGlvbjogJz1zZWxlY3RlZGxvY2F0aW9uJywgcGFzc2VuZ2VySWQ6ICdAJywgZ29vZ2xlb25seTogJ0AnICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9tb2R1bGVzL29uLWRlbWFuZC9yZXNlcnZhdGlvbnMvbG9jYXRpb25TZWFyY2guaHRtbCdcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBkaXJlY3RpdmU7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgIHNjb3BlLnR5cGUgPSBhdHRycy5sYWJlbG5hbWU7XHJcblx0XHR9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNvbnRyb2xsZXIoJHNjb3BlKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5kYXRhID0gTG9jYXRpb25GYWN0b3J5LmdldExvY2F0aW9ucztcclxuICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdCA9IHt9O1xyXG4gICAgICAgICAgICAkc2NvcGUuaW5pdGlhbFZhbHVlID0gJyc7XHJcbiAgICAgICAgXHJcbiAgICAgICAgICAgICRzY29wZS5yZXN1bHRzQVBJID0gZnVuY3Rpb24gKHVzZXJJbnB1dFN0cmluZywgdGltZW91dFByb21pc2UpIHtcclxuICAgICAgICAgICAgICAgIC8vdmFyIGRlZmVyID0gJHEuZGVmZXIoKTtcclxuXHJcbiAgICAgICAgICAgIFx0cmV0dXJuICRzY29wZS5kYXRhKHVzZXJJbnB1dFN0cmluZywgJHNjb3BlLmxvY2F0aW9uZmlsdGVyLCAkc2NvcGUuZGl2aXNpb25JZCwgJHNjb3BlLnBhc3NlbmdlcklkLCAkc2NvcGUuZ29vZ2xlb25seSwgeyB0aW1lb3V0OiB0aW1lb3V0UHJvbWlzZSB9KVxyXG4gICAgICAgICAgICAgICAgLy8udGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy92YXIgZmlsdGVyZWRSZXN1bHQgPSByZXN1bHQuZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAvL2lmICgkc2NvcGUuc2VsZWN0ZWRsb2NhdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL3ZhciBmaWx0ZXJlZFJlc3VsdCA9IHJlc3VsdC5kYXRhLmZpbHRlcihmdW5jdGlvbiAobG9jYXRpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gICAgcmV0dXJuIGxvY2F0aW9uLmxvYy5Mb2NhdGlvbklkICE9ICRzY29wZS5zZWxlY3RlZGxvY2F0aW9uO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL30pO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vfVxyXG4gICAgICAgICAgICAgICAgICAvLyAgZGVmZXIucmVzb2x2ZShmaWx0ZXJlZFJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAvL30pO1xyXG4gICAgICAgICAgICAgICAgLy9yZXR1cm4gZGVmZXIucHJvbWlzZTtcclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy9TZXQgc2VsZWN0ZWQgbG9jYXRpb24gZnJvbSBHb29nbGUgQXBpXHJcbiAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZEdvb2dsZUxvY2F0aW9uRnJvbSA9IGZ1bmN0aW9uIChhZGRyZXNzKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYWRkcmVzcyAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFkZCA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiBhZGRyZXNzLmFkZHJlc3NfY29tcG9uZW50cykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWRkcmVzcy5hZGRyZXNzX2NvbXBvbmVudHNbaV0udHlwZXNbMF0gPT0gXCJzdHJlZXRfbnVtYmVyXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZCA9IGFkZCArIFwiIFwiICsgYWRkcmVzcy5hZGRyZXNzX2NvbXBvbmVudHNbaV0uc2hvcnRfbmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChhZGRyZXNzLmFkZHJlc3NfY29tcG9uZW50c1tpXS50eXBlc1swXSA9PSBcInJvdXRlXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZCA9IGFkZCArIFwiIFwiICsgYWRkcmVzcy5hZGRyZXNzX2NvbXBvbmVudHNbaV0uc2hvcnRfbmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChhZGRyZXNzLmFkZHJlc3NfY29tcG9uZW50c1tpXS50eXBlc1swXSA9PSBcImxvY2FsaXR5XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QuQ2l0eSA9IGFkZHJlc3MuYWRkcmVzc19jb21wb25lbnRzW2ldLnNob3J0X25hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoYWRkcmVzcy5hZGRyZXNzX2NvbXBvbmVudHNbaV0udHlwZXNbMF0gPT0gXCJhZG1pbmlzdHJhdGl2ZV9hcmVhX2xldmVsXzFcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5TdGF0ZSA9IGFkZHJlc3MuYWRkcmVzc19jb21wb25lbnRzW2ldLnNob3J0X25hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoYWRkcmVzcy5hZGRyZXNzX2NvbXBvbmVudHNbaV0udHlwZXNbMF0gPT0gXCJwb3N0YWxfY29kZVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LlppcENvZGUgPSBhZGRyZXNzLmFkZHJlc3NfY29tcG9uZW50c1tpXS5zaG9ydF9uYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9kbyBub3RoaW5nXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5BZGRyZXNzMSA9IGFkZDtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LkZyb20gPSBhZGRyZXNzLmZvcm1hdHRlZF9hZGRyZXNzO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QuTGF0aXR1ZGUgPSBhZGRyZXNzLmdlb21ldHJ5LmxvY2F0aW9uLmxhdDtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LkxvbmdpdHVkZSA9IGFkZHJlc3MuZ2VvbWV0cnkubG9jYXRpb24ubG5nO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QuR29vZ2xlUGxhY2VJZCA9IGFkZHJlc3MucGxhY2VfaWQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgJHNjb3BlLm9uTG9jYXRpb25TZWxlY3RlZE5vdGlmeSA9IGZ1bmN0aW9uIChMb2NhdGlvbikge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdCA9IHt9O1xyXG4gICAgICAgICAgICAgICAgaWYgKExvY2F0aW9uICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBvYmogPSBMb2NhdGlvbi5vcmlnaW5hbE9iamVjdDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAob2JqICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5pc0dvb2dsZUxvY2F0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRHb29nbGVMb2NhdGlvbkZyb20ob2JqLmxvYyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0ID0gb2JqLmxvYztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgKCRzY29wZS5vbkxvY2F0aW9uU2VsZWN0ZWQpID09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUub25Mb2NhdGlvblNlbGVjdGVkKHsgbG9jYXRpb246ICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXRNYXBDZW50ZXIoKSB7XHJcbiAgICAgICAgICAgICAgICBTY2hlZHVsZVNlcnZpY2UuZ2V0U2VydmljZUFyZWFMb2NhdGlvbigkc2NvcGUuZGl2aXNpb25JZCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSAhPT0gbnVsbCAmJiAgcmVzcG9uc2UuZGF0YS5yZXN1bHQgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYWRkcmVzc1Jlc3QgPSByZXNwb25zZS5kYXRhLnJlc3VsdC5BZGRyZXNzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBMb2NhdGlvbkZhY3Rvcnkuc2V0YWRkKCRzY29wZS5hZGRyZXNzUmVzdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9ybXNnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcignRXJyb3InLCAnJyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKGNhbGxiYWNrKXtcclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuYWRkcmVzc1Jlc3QgPT0gdW5kZWZpbmVkIHx8ICRzY29wZS5hZGRyZXNzUmVzdCA9PSAnJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGl2aXNpb25JZCA9IERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuZGl2aXNpb25JZCAhPSBudWxsICYmICRzY29wZS5kaXZpc2lvbklkICE9IHVuZGVmaW5lZCAmJiAkc2NvcGUuZGl2aXNpb25JZCAhPSAnJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrICYmIHR5cGVvZiBjYWxsYmFjayA9PT0gXCJmdW5jdGlvblwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgfSAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICRzY29wZS4kb24oJ2Nsb3Nlc3RMb2NhdGlvbicsIGZ1bmN0aW9uIChldmVudCwgbG9jYXRpb24pIHtcclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUudHlwZSA9PT0gJ0ZST00nKVxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5pbml0aWFsVmFsdWUgPSBsb2NhdGlvbi50aXRsZTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAkc2NvcGUuJG9uKCdpbml0aWFsTG9jYXRpb25WYWx1ZScsIGZ1bmN0aW9uIChldmVudCwgdmFsdWUpIHtcclxuICAgICAgICAgICAgXHQkc2NvcGUuaW5pdGlhbFZhbHVlID0gdmFsdWU7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLiRvbignaG9tZUxvY2F0aW9uRGlzYWJsZScsIGZ1bmN0aW9uIChldmVudCwgdmFsdWUpIHtcclxuICAgICAgICAgICAgXHRpZiAoJHNjb3BlLnR5cGUgIT0gJ0ZST00nKSB7XHJcbiAgICAgICAgICAgIFx0XHQkc2NvcGUuZGlzYWJsZUlucHV0ID0gdmFsdWU7XHJcbiAgICAgICAgICAgIFx0fVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS4kb24oJ2hvbWVMb2NhdGlvblRleHQnLCBmdW5jdGlvbiAoZXZlbnQsIHRleHQpIHtcclxuICAgICAgICAgICAgXHRpZiAoJHNjb3BlLnR5cGUgIT0gJ0ZST00nKSB7XHJcbiAgICAgICAgICAgIFx0XHQkc2NvcGUuaW5pdGlhbFZhbHVlID0gdGV4dDtcclxuICAgICAgICAgICAgXHR9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLiRvbigndG9nZ2xlLWZyb20tYWRkcmVzcycsIGZ1bmN0aW9uIChldmVudCwgdmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUudHlwZSA9PSAnRlJPTScpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGlzYWJsZUlucHV0ID0gIXZhbHVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGFjdGl2YXRlKGdldE1hcENlbnRlcik7XHJcblx0XHR9XHJcbiAgICB9XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHsgXHJcblxyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmZhY3RvcnkoJ2xvY2F0aW9uU2VydmljZScsIGxvY2F0aW9uU2VydmljZSk7XHJcbiAgICBsb2NhdGlvblNlcnZpY2UuJGluamVjdCA9IFsnJGh0dHAnLCAnJHEnLCAnQ29uZmlnRmFjdG9yeSddO1xyXG5cclxuZnVuY3Rpb24gbG9jYXRpb25TZXJ2aWNlKCRodHRwLCAkcSwgQ29uZmlnRmFjdG9yeSkge1xyXG5cclxuICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgIHNhdmVMb2NhdGlvbjogc2F2ZUxvY2F0aW9uLFxyXG4gICAgICAgIGlzQWRkcmVzc0luU2VydmljZTogaXNBZGRyZXNzSW5TZXJ2aWNlLFxyXG4gICAgICAgIGdldExvY2F0aW9uVHlwZXM6IGdldExvY2F0aW9uVHlwZXMsXHJcbiAgICAgICAgZ2V0UmV2ZXJzZUdlb0NvZGU6IGdldFJldmVyc2VHZW9Db2RlLFxyXG4gICAgICAgIGdldEdlb0NvZGU6IGdldEdlb0NvZGUsXHJcbiAgICAgICAgZ2V0TG9jYXRpb25EYXRhOiBnZXRMb2NhdGlvbkRhdGEsXHJcbiAgICAgICAgZWRpdE1hbnVhbExvY2F0aW9uOiBlZGl0TWFudWFsTG9jYXRpb25cclxuICAgIH07XHJcbiAgICByZXR1cm4gc2VydmljZTtcclxuXHJcblxyXG5cclxuICAgIGZ1bmN0aW9uIHNhdmVMb2NhdGlvbihzYXZlTG9jYXRpb24pIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhzYXZlTG9jYXRpb24pO1xyXG4gICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgQ29uZmlnRmFjdG9yeS5nZXRPbmVNVkFwaVVSTFByb21pc2UoKS50aGVuKGZ1bmN0aW9uIChvbmVNVlVSTCkge1xyXG4gICAgICAgICAgICBpZiAob25lTVZVUkwgJiYgb25lTVZVUkwgIT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgLy9nZXQgdGhlIGJhc2UgdXJsIGZyb20gY29uZmlnLlxyXG4gICAgICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBvbmVNVlVSTCArICdUcmlwL1NhdmVMb2NhdGlvbic7XHJcbiAgICAgICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgICAgICAgICAgJ3VybCc6IHNlcnZpY2VVcmwsXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoc2F2ZUxvY2F0aW9uKSxcclxuICAgICAgICAgICAgICAgICAgICBDb250ZW50VHlwZTogXCJhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04XCJcclxuICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycilcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJGxvZy5lcnJvcignRXJyb3I6IC0gQ291bGQgbm90IGZldGNoIHNlcnZpY2UgYXBpIHVybCcpXHJcbiAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKFwiQ291bGQgbm90IGZldGNoIHNlcnZpY2UgYXBpIHVybFwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgfTtcclxuXHJcbiAgICBmdW5jdGlvbiBpc0FkZHJlc3NJblNlcnZpY2UoQWRkcmVzcykge1xyXG4gICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgQ29uZmlnRmFjdG9yeS5nZXRPbmVNVkFwaVVSTFByb21pc2UoKS50aGVuKGZ1bmN0aW9uIChvbmVNVlVSTCkge1xyXG4gICAgICAgICAgICBpZiAob25lTVZVUkwgJiYgb25lTVZVUkwgIT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgLy9nZXQgdGhlIGJhc2UgdXJsIGZyb20gY29uZmlnLlxyXG4gICAgICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBvbmVNVlVSTCArICdUcmlwL0lzQWRkcmVzc0luU2VydmljZSc7XHJcbiAgICAgICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgICAgICAgICAgJ3VybCc6IHNlcnZpY2VVcmwsXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoQWRkcmVzcyksXHJcbiAgICAgICAgICAgICAgICAgICAgQ29udGVudFR5cGU6IFwiYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOFwiXHJcbiAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRsb2cuZXJyb3IoJ0Vycm9yOiAtIENvdWxkIG5vdCBmZXRjaCBzZXJ2aWNlIGFwaSB1cmwnKVxyXG4gICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcihcIkNvdWxkIG5vdCBmZXRjaCBzZXJ2aWNlIGFwaSB1cmxcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgIH07XHJcblxyXG4gICAgZnVuY3Rpb24gZ2V0TG9jYXRpb25UeXBlcygpIHtcclxuICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgIHZhciBzZXJ2aWNlVXJsID0gJy4uL1NlcnZpY2VBcmVhL0dldExvY2F0aW9uVHlwZXMnO1xyXG4gICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgJ3VybCc6IHNlcnZpY2VVcmwsXHJcbiAgICAgICAgICAgIENvbnRlbnRUeXBlOiBcImFwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLThcIlxyXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycilcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgIH07XHJcblxyXG4gICAgZnVuY3Rpb24gZ2V0UmV2ZXJzZUdlb0NvZGUobGF0bG5nKSB7XHJcbiAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICB2YXIgc2VydmljZVVybCA9ICdodHRwczovL21hcHMuZ29vZ2xlYXBpcy5jb20vbWFwcy9hcGkvZ2VvY29kZS9qc29uP2xhdGxuZz0nICsgbGF0bG5nO1xyXG4gICAgICAgICRodHRwLmdldCgnLy9tYXBzLmdvb2dsZWFwaXMuY29tL21hcHMvYXBpL2dlb2NvZGUvanNvbicsIHtcclxuICAgICAgICAgICAgcGFyYW1zOiB7XHJcbiAgICAgICAgICAgICAgICBsYXRsbmc6IGxhdGxuZyxcclxuICAgICAgICAgICAgICAgIHNlbnNvcjogdHJ1ZVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB3aXRoQ3JlZGVudGlhbHM6IGZhbHNlXHJcbiAgICAgICAgICAgIC8vJGh0dHAoe1xyXG4gICAgICAgICAgICAvLyAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAvLyAgICAndXJsJzogc2VydmljZVVybCxcclxuICAgICAgICAgICAgLy8gICAgQ29udGVudFR5cGU6IFwiYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOFwiXHJcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgfTtcclxuXHJcbiAgICBmdW5jdGlvbiBnZXRHZW9Db2RlKGFkZHJlc3MpIHtcclxuICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgIHZhciBzZXJ2aWNlVXJsID0gJ2h0dHBzOi8vbWFwcy5nb29nbGVhcGlzLmNvbS9tYXBzL2FwaS9nZW9jb2RlL2pzb24/YWRkcmVzcz0nICsgYWRkcmVzcztcclxuICAgICAgICAkaHR0cC5nZXQoJy8vbWFwcy5nb29nbGVhcGlzLmNvbS9tYXBzL2FwaS9nZW9jb2RlL2pzb24nLCB7XHJcbiAgICAgICAgICAgIHBhcmFtczoge1xyXG4gICAgICAgICAgICAgICAgYWRkcmVzczogYWRkcmVzcyxcclxuICAgICAgICAgICAgICAgIHNlbnNvcjogdHJ1ZVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB3aXRoQ3JlZGVudGlhbHM6IGZhbHNlXHJcbiAgICAgICAgICAgIC8vJGh0dHAoe1xyXG4gICAgICAgICAgICAvLyAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAvLyAgICAndXJsJzogc2VydmljZVVybCxcclxuICAgICAgICAgICAgLy8gICAgQ29udGVudFR5cGU6IFwiYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOFwiXHJcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgfTtcclxuICAgIGZ1bmN0aW9uIGdldExvY2F0aW9uRGF0YShEaXZpc2lvbklkKSB7XHJcbiAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICB2YXIgc2VydmljZVVybCA9ICcnO1xyXG4gICAgICAgIC8vIGlmIChMb2NhdGlvbmlkID4gMClcclxuICAgICAgICBDb25maWdGYWN0b3J5LmdldE9uZU1WQXBpVVJMUHJvbWlzZSgpLnRoZW4oZnVuY3Rpb24gKG9uZU1WVVJMKSB7XHJcbiAgICAgICAgICAgIGlmIChvbmVNVlVSTCAmJiBvbmVNVlVSTCAhPSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICBzZXJ2aWNlVXJsID0gb25lTVZVUkwgKyAnVHJpcC9HZXRNYW51YWxMb2NhdGlvbnMvP0RpdmlzaW9uSWQ9JyArIERpdmlzaW9uSWQ7XHJcbiAgICAgICAgICAgICAgICAvL2Vsc2VcclxuICAgICAgICAgICAgICAgIC8vICAgIHNlcnZpY2VVcmwgPSAnLi4vU2VydmljZUFyZWEvR2V0TWFudWFsTG9jYXRpb25zJztcclxuICAgICAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgICAgICd1cmwnOiBzZXJ2aWNlVXJsLFxyXG4gICAgICAgICAgICAgICAgICAgIENvbnRlbnRUeXBlOiBcImFwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLThcIlxyXG4gICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkbG9nLmVycm9yKCdFcnJvcjogLSBDb3VsZCBub3QgZmV0Y2ggc2VydmljZSBhcGkgdXJsJylcclxuICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoXCJDb3VsZCBub3QgZmV0Y2ggc2VydmljZSBhcGkgdXJsXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgfTtcclxuXHJcbiAgICBmdW5jdGlvbiBlZGl0TWFudWFsTG9jYXRpb24obG9jYXRpb25JZCkge1xyXG4gICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSAnJztcclxuICAgICAgICAvLyBpZiAoTG9jYXRpb25pZCA+IDApXHJcbiAgICAgICAgQ29uZmlnRmFjdG9yeS5nZXRPbmVNVkFwaVVSTFByb21pc2UoKS50aGVuKGZ1bmN0aW9uIChvbmVNVlVSTCkge1xyXG4gICAgICAgICAgICBpZiAob25lTVZVUkwgJiYgb25lTVZVUkwgIT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgc2VydmljZVVybCA9IG9uZU1WVVJMICsgJ1RyaXAvRWRpdE1hbnVhbExvY2F0aW9uLz9sb2NhdGlvbklkPScgKyBsb2NhdGlvbklkO1xyXG4gICAgICAgICAgICAgICAgLy9lbHNlXHJcbiAgICAgICAgICAgICAgICAvLyAgICBzZXJ2aWNlVXJsID0gJy4uL1NlcnZpY2VBcmVhL0dldE1hbnVhbExvY2F0aW9ucyc7XHJcbiAgICAgICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICAgICAndXJsJzogc2VydmljZVVybCxcclxuICAgICAgICAgICAgICAgICAgICBDb250ZW50VHlwZTogXCJhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04XCJcclxuICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycilcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJGxvZy5lcnJvcignRXJyb3I6IC0gQ291bGQgbm90IGZldGNoIHNlcnZpY2UgYXBpIHVybCcpXHJcbiAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKFwiQ291bGQgbm90IGZldGNoIHNlcnZpY2UgYXBpIHVybFwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgIH07XHJcblxyXG5cclxufVxyXG5cclxuXHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgIC8vZGVidWdnZXI7XHJcblxyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ29uZU1WQXBwJykuZmFjdG9yeSgnTW9iaWxpdHlBaWRzU2VydmljZScsIE1vYmlsaXR5QWlkc1NlcnZpY2UpO1xyXG4gICAgTW9iaWxpdHlBaWRzU2VydmljZS4kaW5qZWN0ID0gWyckaHR0cCcsICckcScsICdDb25maWdGYWN0b3J5J107XHJcblxyXG4gICAgZnVuY3Rpb24gTW9iaWxpdHlBaWRzU2VydmljZSgkaHR0cCwgJHEsIENvbmZpZ0ZhY3RvcnkpIHtcclxuXHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XHJcbiAgICAgICAgICAgIGdldERpdmlzaW9uQWlkczogZ2V0RGl2aXNpb25BaWRzLFxyXG4gICAgICAgICAgICBzYXZlRGl2aXNpb25BaWRzOiBzYXZlRGl2aXNpb25BaWRzXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXREaXZpc2lvbkFpZHMoZGl2aXNpb25JZCkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXIgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICBDb25maWdGYWN0b3J5LmdldE9uZU1WQXBpVVJMUHJvbWlzZSgpLnRoZW4oZnVuY3Rpb24gKG9uZU1WVVJMKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAob25lTVZVUkwgJiYgb25lTVZVUkwgIT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBfdXJsID0gb25lTVZVUkwgKyBcIk1vYmlsaXR5QWlkcy9cIiArIGRpdmlzaW9uSWQgKyBcIj9ybmQ9XCIgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcclxuICAgICAgICAgICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogX3VybFxyXG4gICAgICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlci5yZXNvbHZlKHJlc3BvbnNlLmRhdGEucmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVyLnJlamVjdChyZXNwb25zZS5kYXRhLnJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVyLnJlamVjdChyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXIucHJvbWlzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNhdmVEaXZpc2lvbkFpZHMoZGl2aXNpb25JZCwgYWlkcykge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXIgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICBDb25maWdGYWN0b3J5LmdldE9uZU1WQXBpVVJMUHJvbWlzZSgpLnRoZW4oZnVuY3Rpb24gKG9uZU1WVVJMKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAob25lTVZVUkwgJiYgb25lTVZVUkwgIT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBfdXJsID0gb25lTVZVUkwgKyBcIk1vYmlsaXR5QWlkcy9cIiArIGRpdmlzaW9uSWQgKyBcIj9ybmQ9XCIgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcclxuICAgICAgICAgICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBhaWRzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB1cmw6IF91cmxcclxuICAgICAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXIucmVzb2x2ZShyZXNwb25zZS5kYXRhLnJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlci5yZWplY3QocmVzcG9uc2UuZGF0YS5yZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjayhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZlci5yZWplY3QocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVyLnByb21pc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignTmVnb3RpYXRpb25Db250cm9sbGVyJywgTmVnb3RpYXRpb25Db250cm9sbGVyKTtcclxuXHJcbiAgICBOZWdvdGlhdGlvbkNvbnRyb2xsZXIuJGluamVjdCA9IFsnJHVpYk1vZGFsSW5zdGFuY2UnLCAnJHNjb3BlJywgJyRmaWx0ZXInLCdhdXRoU2VydmljZScsJ0RpdmlzaW9uU2VydmljZScsXHJcbiAgICAgICAgJ1RyaXBOZWdvdGlhdGlvbkxvZ1NlcnZpY2UnLCAnRGF0ZUZhY3RvcnknLCAnbmVnb3RpYXRpb25SZXF1ZXN0J107XHJcblxyXG4gICAgZnVuY3Rpb24gTmVnb3RpYXRpb25Db250cm9sbGVyKCR1aWJNb2RhbEluc3RhbmNlLCAkc2NvcGUsICRmaWx0ZXIsYXV0aFNlcnZpY2UsIERpdmlzaW9uU2VydmljZSxcclxuICAgICAgICBUcmlwTmVnb3RpYXRpb25Mb2dTZXJ2aWNlLCBEYXRlRmFjdG9yeSwgbmVnb3RpYXRpb25SZXF1ZXN0KSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuXHJcbiAgICAgICAgdm0ucHJvcG9zZWRTbG90cyA9IG5lZ290aWF0aW9uUmVxdWVzdC5wcm9wb3NlZFNsb3RzO1xyXG4gICAgICAgIHZtLnNlbGVjdGVkU2xvdCA9ICcnO1xyXG4gICAgICAgIHZtLnJlc2VydmF0aW9uID0gYW5ndWxhci5jb3B5KG5lZ290aWF0aW9uUmVxdWVzdC5yZXNlcnZhdGlvblJlcXVlc3QpO1xyXG4gICAgICAgIHZtLnNlbGVjdGVkUmVzZXJ2YXRpb25UeXBlID0gJyc7XHJcblxyXG4gICAgICAgIHZhciB1c2VySWQgPSAwO1xyXG4gICAgICAgIHZhciB0cmlwUmVxdWVzdElkID0gMDtcclxuICAgICAgICB2YXIgc2VydmljZURhdGUgPSBuZWdvdGlhdGlvblJlcXVlc3Quc2VydmljZURhdGU7XHJcbiAgICAgICAgdmFyIHByb21pc2VXaW5kb3cgPSAwO1xyXG5cclxuICAgICAgICAvL2ZvcmNlZCB0byB1c2UgdGhpcyBhcyBwYXggYW5kIG9wcyBwb3J0YWwgcmVzZXJ2YXRpb24gb2JqZWN0cyBhcmUgbm90IGluIHN5bmMuICAgICAgICBcclxuICAgICAgICB2YXIgcmVzZXJ2YXRpb25UeXBlRW51bSA9IHtcclxuICAgICAgICAgICAgMTogXCJBU0FQXCIsXHJcbiAgICAgICAgICAgIDI6IFwiQURWQU5DRURcIixcclxuICAgICAgICAgICAgMzogXCJBUFBPSU5UTUVOVFwiXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0udG9Qcm9taXNlV2luZG93ID0gZnVuY3Rpb24gKHByb3Bvc2VkU2xvdCkge1xyXG5cclxuICAgICAgICAgICAgdmFyIHN0YXJ0VGltZSA9ICRmaWx0ZXIoJ2RhdGUnKShwcm9wb3NlZFNsb3QuUHJvcG9zZWRTdGFydFdpbmRvdywgJ2g6bW0gYScpO1xyXG4gICAgICAgICAgICAvL3ZhciBlbmRUaW1lID0gRGF0ZUZhY3RvcnkuZ2V0UHJvbWlzZVdpbmRvd0VuZFRpbWUoaW5wdXQsIHByb21pc2VXaW5kb3cpO1xyXG4gICAgICAgICAgICB2YXIgZW5kVGltZSA9ICRmaWx0ZXIoJ2RhdGUnKShwcm9wb3NlZFNsb3QuUHJvcG9zZWRFbmRXaW5kb3csICdoOm1tIGEnKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBzdGFydFRpbWUgKyAnIC0gJyArIGVuZFRpbWU7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHRvVGhpcnR5VGhyZWVIb3VyQ2xvY2sgPSBmdW5jdGlvbiAoaW5wdXQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIERhdGVGYWN0b3J5LmdldEN1c3RvbVRpbWUoaW5wdXQsIHNlcnZpY2VEYXRlKTtcclxuICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgdmFyIGFjdGl2YXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB0cmlwUmVxdWVzdElkID0gbmVnb3RpYXRpb25SZXF1ZXN0LnRyaXBSZXF1ZXN0SWQ7XHJcblxyXG4gICAgICAgICAgICB1c2VySWQgPSBhdXRoU2VydmljZS5hdXRoZW50aWNhdGlvbi51c2VySWQ7XHJcbiAgICAgICAgICAgIHByb21pc2VXaW5kb3cgPSBEaXZpc2lvblNlcnZpY2UuZ2V0U3lzdGVtUGFyYW1ldGVycygpLlByb21pc2VXaW5kb3c7XHJcblxyXG4gICAgICAgICAgICB2bS5zZWxlY3RlZFJlc2VydmF0aW9uVHlwZSA9IHJlc2VydmF0aW9uVHlwZUVudW1bdm0ucmVzZXJ2YXRpb24ucmVzZXJ2YXRpb25UeXBlXTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgY2xvc2VNb2RhbCA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZShyZXNwb25zZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5yZWplY3QgPSBmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgICAgICAgICBUcmlwTmVnb3RpYXRpb25Mb2dTZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICAgICAgLmFkZFJlamVjdGlvbkxvZyh0cmlwUmVxdWVzdElkLCB1c2VySWQpO1xyXG5cclxuICAgICAgICAgICAgY2xvc2VNb2RhbCh7XHJcbiAgICAgICAgICAgICAgICBjYW5OZWdvdGlhdGU6IGZhbHNlXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICB2bS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY2xvc2VNb2RhbCh7XHJcbiAgICAgICAgICAgICAgICBjYW5OZWdvdGlhdGU6IGZhbHNlXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0uYWNjZXB0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAodm0uc2VsZWN0ZWRTbG90ICE9ICcnKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbmVnb3RpYXRpb25Mb2dJZCA9IGdldE5lZ290aWF0ZWRMb2dJZCgpO1xyXG5cclxuICAgICAgICAgICAgICAgIFRyaXBOZWdvdGlhdGlvbkxvZ1NlcnZpY2VcclxuICAgICAgICAgICAgICAgICAgICAuYWRkQXBwcm92YWxMb2codHJpcFJlcXVlc3RJZCwgbmVnb3RpYXRpb25Mb2dJZCwgdXNlcklkKTtcclxuXHJcbiAgICAgICAgICAgICAgICBjbG9zZU1vZGFsKFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FuTmVnb3RpYXRlOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZFRpbWU6IHZtLnNlbGVjdGVkU2xvdCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHJpcFJlcXVlc3RJZDogdHJpcFJlcXVlc3RJZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmVnb3RpYXRpb25Mb2dJZDogbmVnb3RpYXRpb25Mb2dJZFxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXROZWdvdGlhdGVkTG9nSWQoKSB7XHJcbiAgICAgICAgICAgIGlmICh2bS5zZWxlY3RlZFNsb3QgIT0gJycpIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdm0ucHJvcG9zZWRTbG90cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2bS5wcm9wb3NlZFNsb3RzW2ldLlByb3Bvc2VkRGF0ZSA9PSB2bS5zZWxlY3RlZFNsb3QpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2bS5wcm9wb3NlZFNsb3RzW2ldLmlkO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiAtMTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGFjdGl2YXRlKCk7XHJcbiAgICB9XHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignUmVzZXJ2YXRpb25FcnJvck1vZGFsQ29udHJvbGxlcicsIFJlc2VydmF0aW9uRXJyb3JNb2RhbENvbnRyb2xsZXIpO1xyXG5cclxuICAgIFJlc2VydmF0aW9uRXJyb3JNb2RhbENvbnRyb2xsZXIuJGluamVjdCA9IFsnJHVpYk1vZGFsSW5zdGFuY2UnLCAnbWVzc2FnZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIFJlc2VydmF0aW9uRXJyb3JNb2RhbENvbnRyb2xsZXIoJHVpYk1vZGFsSW5zdGFuY2UsIG1lc3NhZ2UpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG5cclxuICAgICAgICB2bS5tc2cgPSBtZXNzYWdlLm1lc3NhZ2UuRXJyb3JNZXNzYWdlO1xyXG4gICAgICAgIHZtLmhlYWRlciA9IG1lc3NhZ2UuaGVhZGVyIHx8IFwiSW5mb3JtYXRpb25cIiA7XHJcbiAgICAgICAgdm0uY2FuY2VsID0gY2FuY2VsO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBjYW5jZWwoKSB7XHJcbiAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCk7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxufSkoKTtcclxuIiwiXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAuZGlyZWN0aXZlKCdyZXNlcnZhdGlvbkZvcm1EaXJlY3RpdmUnLCByZXNlcnZhdGlvbkZvcm1EaXJlY3RpdmUpO1xyXG5cclxuICAgIHJlc2VydmF0aW9uRm9ybURpcmVjdGl2ZS4kaW5qZWN0ID0gWyckd2luZG93JywgJ0xvY2F0aW9uRmFjdG9yeScsICdVdGlsaXR5RmFjdG9yeScsICdTY2hlZHVsZVNlcnZpY2UnLFxyXG4gICAgICAgICdEYXRlRmFjdG9yeScsJyRxJywgJ0RpdmlzaW9uU2VydmljZScsICdHZW9Mb2NhdGlvblNlcnZpY2UnLCAnU3RvcFNlcnZpY2UnLCAnRmFyaW5nU2VydmljZScsICckdGltZW91dCcsXHJcbiAgICAgICAgJ1Byb2ZpbGVTZXJ2aWNlJywnT25lTXZTZXJ2aWNlcyddO1xyXG5cclxuICAgIGZ1bmN0aW9uIHJlc2VydmF0aW9uRm9ybURpcmVjdGl2ZSgkd2luZG93LCBMb2NhdGlvbkZhY3RvcnksICBVdGlsaXR5RmFjdG9yeSwgU2NoZWR1bGVTZXJ2aWNlLFxyXG4gICAgICAgIERhdGVGYWN0b3J5LCAkcSwgRGl2aXNpb25TZXJ2aWNlLCBHZW9Mb2NhdGlvblNlcnZpY2UsIFN0b3BTZXJ2aWNlLCBGYXJpbmdTZXJ2aWNlLCAkdGltZW91dCxcclxuICAgICAgICBQcm9maWxlU2VydmljZSxPbmVNdlNlcnZpY2VzKSB7XHJcbiAgICAgICAgLy8gVXNhZ2U6XHJcbiAgICAgICAgLy8gICAgIDxyZXNlcnZhdGlvbi1mb3JtLWRpcmVjdGl2ZT48L3Jlc2VydmF0aW9uLWZvcm0tZGlyZWN0aXZlPlxyXG4gICAgICAgIC8vIENyZWF0ZXM6XHJcbiAgICAgICAgLy8gICAgICBBbiBpbnN0YW5jZSBvZiB0aGUgcmVzZXJ2YXRpb24gZm9ybSB3aGljaCBjYW4gdXNlZCB0byBib29rIGEgcmVzZXJ2YXRpb24uXHJcbiAgICAgICAgLy8gICAgICBUaGVyZSBhcmUgdGhyZWUgdmFyaWF0aW9ucyBvZiB0aGlzIGZvcm0gY29udHJvbGxlZCBieSB0aGUgdmFyaWFibGUgJ3Jlc2VydmF0aW9uVHlwZSdcclxuICAgICAgICAvLyAgICAgIDEuIHJlc2VydmF0aW9uVHlwZSA9ICdwYXN0J1xyXG4gICAgICAgIC8vICAgICAgICAgVGhpcyBpcyB0aGUgZm9ybSB3aGljaCBjYW4gYmUgdXNlZCB3aGVuIHRoZSBvcGVyYXRvciB3YW50cyB0byByZWNvbmNpbGUgcHJldmlvdXMgcmVzZXJ2YXRpb25zXHJcbiAgICAgICAgLy8gICAgICAyLiByZXNlcnZhdGlvblR5cGUgPSAnY3VycmVudCdcclxuICAgICAgICAvLyAgICAgICAgIFRoaXMgaXMgdGhlIGZvcm0gd2hpY2ggY2FuIGJlIHVzZWQgZm9yIGJvb2tpbmcgYSBjdXJyZW50IHJlc2VydmF0aW9uXHJcbiAgICAgICAgLy8gICAgICAzLiByZXNlcnZhdGlvblR5cGUgPSAnZnV0dXJlJ1xyXG4gICAgICAgIC8vICAgICAgICAgVGhpcyBpcyB0aGUgZm9ybSB3aGljaCBjYW4gYmUgdXNlZCB0byBib29rIGZ1dHVyZSByZXNlcnZhdGlvbnNcclxuICAgICAgICB2YXIgZGlyZWN0aXZlID0ge1xyXG4gICAgICAgICAgICBsaW5rOiBsaW5rLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiBjb250cm9sbGVyLFxyXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgICAgICBzY29wZTogeyBwYXNzZW5nZXI6ICc8Jywgb3B0aW9uczogJzwnLCBtb2RlOiAnQCcsIG5vdGlmeVN1Y2Vzc2Z1bGxSZXNlcnZhdGlvbjogJz1vblJlc2VydmF0aW9uU3VjY2VzcycgfSxcclxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvbW9kdWxlcy9vbi1kZW1hbmQvcmVzZXJ2YXRpb25zL3Bhc3NlbmdlclJlc2VydmF0aW9uRm9ybS5odG1sJ1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgLy8gSWYgc2NvcGUuJHdhdGNoKCdvcHRpb24nKSBsb2FkcyBsYXRlLCBJRSBpbiBhIHNsb3cgY29ubmVjdGlvbiwgdGhlbiB0aGUgd2F0Y2ggTkVWRVIgZmlyZXMuXHJcbiAgICAgICAgICAgIC8vIFRoaXMgaXMgaGVyZSB0byBydW4gc2NvcGUuYWN0aXZhdGUoKSBpZiBvbiBsb2FkLCBzY29wZS5vcHRpb25zIGV4aXN0cy5cclxuICAgICAgICAgICAgaWYgKHNjb3BlLmlzTG9hZGluZyAmJiBzY29wZS5vcHRpb25zKSB7XHJcbiAgICAgICAgICAgICAgICBzY29wZS5hY3RpdmF0ZSgpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBzY29wZS4kd2F0Y2goJ29wdGlvbnMnLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgIT0gb2xkVmFsdWUgJiYgbmV3VmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvL2lmICh0eXBlb2YgbmV3VmFsdWUgPT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgIHNjb3BlLm9wdGlvbnMgPSBKU09OLnBhcnNlKG5ld1ZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAvL31cclxuICAgICAgICAgICAgICAgICAgICAvL2Vsc2UgaWYgKHR5cGVvZiBuZXdWYWx1ZSA9PSBcIm9iamVjdFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLm9wdGlvbnMgPSBuZXdWYWx1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuYWN0aXZhdGUoKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICAgICAgICAgIC8vc2NvcGUuJHdhdGNoKCdwYXNzZW5nZXInLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgIC8vICAgIGlmIChuZXdWYWx1ZSAhPSBvbGRWYWx1ZSAmJiBuZXdWYWx1ZSkge1xyXG4gICAgICAgICAgICAvLyAgICAgICAgLy9pZiAodHlwZW9mIG5ld1ZhbHVlID09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICAgICAgLy8gICAgICAgIC8vICAgIHNjb3BlLnBhc3NlbmdlciA9IEpTT04ucGFyc2UobmV3VmFsdWUpO1xyXG4gICAgICAgICAgICAvLyAgICAgICAgLy99XHJcbiAgICAgICAgICAgIC8vICAgICAgICAvL2Vsc2UgaWYgKHR5cGVvZiBuZXdWYWx1ZSA9PSBcIm9iamVjdFwiKSB7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAgICAgc2NvcGUucGFzc2VuZ2VyID0gbmV3VmFsdWU7XHJcbiAgICAgICAgICAgIC8vICAgICAgICAvL31cclxuICAgICAgICAgICAgLy8gICAgICAgIC8vaWYgKG5ld1ZhbHVlICE9IG9sZFZhbHVlKVxyXG4gICAgICAgICAgICAvLyAgICAgICAgICAgIHNjb3BlLnJlc2V0Rm9ybSgpO1xyXG4gICAgICAgICAgICAvLyAgICB9O1xyXG4gICAgICAgICAgICAvL30pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY29udHJvbGxlcigkc2NvcGUsJHVpYk1vZGFsKSB7XHJcbiAgICAgICAgICAgIC8qTWV0aG9kcyBleHBvc2VkIHRvIHZpZXcqL1xyXG4gICAgICAgIFx0JHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdCA9IHt9O1xyXG4gICAgICAgIFx0JHNjb3BlLmFpZHMgPSBbXTtcclxuICAgICAgICBcdCRzY29wZS5hc3Npc3RhbnRzID0gW107XHJcbiAgICAgICAgXHQkc2NvcGUucG9wdWxhdGVSdW5zID0gcG9wdWxhdGVSdW5zO1xyXG4gICAgICAgIFx0JHNjb3BlLnBvcHVsYXRlQ291bnQgPSBwb3B1bGF0ZUNvdW50O1xyXG4gICAgICAgIFx0JHNjb3BlLmNoaWxkcmVuQ291bnQgPSBjaGlsZHJlbkNvdW50O1xyXG4gICAgICAgICAgICAkc2NvcGUucG9wdWxhdGVIb3VycyA9IHBvcHVsYXRlSG91cnM7XHJcbiAgICAgICAgICAgICRzY29wZS5wb3B1bGF0ZU1pbnV0ZXMgPSBwb3B1bGF0ZU1pbnV0ZXM7XHJcbiAgICAgICAgICAgICRzY29wZS5kYXRhU2VydmljZUZyb20gPSBMb2NhdGlvbkZhY3RvcnkuZGF0YVNlcnZpY2VGcm9tO1xyXG4gICAgICAgICAgICAkc2NvcGUuZGF0YVNlcnZpY2VUbyA9IExvY2F0aW9uRmFjdG9yeS5kYXRhU2VydmljZVRvO1xyXG4gICAgICAgICAgICAkc2NvcGUuc2F2ZVJlc2VydmF0aW9uID0gc2F2ZVJlc2VydmF0aW9uO1xyXG4gICAgICAgICAgICAkc2NvcGUuZGlzYWJsZVNhdmVCdXR0b24gPSBkaXNhYmxlU2F2ZUJ1dHRvbjtcclxuICAgICAgICAgICAgJHNjb3BlLnNldFBpY2t1cERhdGVUaW1lID0gc2V0UGlja3VwRGF0ZVRpbWU7XHJcbiAgICAgICAgICAgICRzY29wZS5hY3RpdmF0ZSA9IGFjdGl2YXRlO1xyXG4gICAgICAgICAgICAkc2NvcGUucmVzZXRGb3JtID0gcmVzZXRGb3JtO1xyXG4gICAgICAgICAgICAkc2NvcGUuY2xvc2VEYXRlVGltZVBpY2tlciA9IGNsb3NlRGF0ZVRpbWVQaWNrZXI7XHJcbiAgICAgICAgICAgICRzY29wZS50aW1lcGlja2VyQ2xpY2tlZCA9IHRpbWVwaWNrZXJDbGlja2VkO1xyXG4gICAgICAgICAgICAkc2NvcGUucmVzZXREYXRlT3B0aW9uRmllbGRzID0gcmVzZXREYXRlT3B0aW9uRmllbGRzO1xyXG4gICAgICAgICAgICAkc2NvcGUucmVzZXREYXRlcyA9IHJlc2V0RGF0ZXM7XHJcbiAgICAgICAgICAgICRzY29wZS5kaXNwbGF5RmFyaW5nID0gZGlzcGxheUZhcmluZztcclxuICAgICAgICAgICAgJHNjb3BlLmRpc2FibGVGYXJpbmdCdXR0b24gPSBkaXNhYmxlRmFyaW5nQnV0dG9uO1xyXG4gICAgICAgICAgICAkc2NvcGUuZ2V0UmVzZXJ2YXRpb25EYXRlVGltZSA9IGdldFJlc2VydmF0aW9uRGF0ZVRpbWU7XHJcbiAgICAgICAgICAgICRzY29wZS50b2dnbGVPcHRpb25zID0gdG9nZ2xlT3B0aW9ucztcclxuICAgICAgICAgICAgJHNjb3BlLmlzTG9hZGluZyA9IHRydWU7XHJcbiAgICAgICAgICAgICRzY29wZS5pc0hpZGRlbiA9IGZhbHNlO1xyXG4gICAgICAgICAgICAkc2NvcGUuc2hvd0NhbGVuZGFyQnV0dG9uID0gdHJ1ZTtcclxuICAgICAgICAgICAgJHNjb3BlLnNob3dDYWxlbmRhciA9IGZhbHNlO1xyXG4gICAgICAgICAgICAvKk1ldGhvZHMgZXhwb3NlZCB0byB2aWV3Ki9cclxuICAgICAgICAgICAgJHNjb3BlLnJ1bnMgPSBbXTtcclxuICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmdSdW5zID0gZmFsc2U7XHJcbiAgICAgICAgICAgICRzY29wZS5pc1NhdmluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAkc2NvcGUuZGl2aXNpb247XHJcbiAgICAgICAgICAgICRzY29wZS5vcGVyYXRvcjtcclxuICAgICAgICAgICAgJHNjb3BlLnN5c3RlbVBhcmFtZXRlcnM7XHJcbiAgICAgICAgICAgICRzY29wZS5kaXNwbGF5RGF0ZVRpbWVwaWNrZXIgPSBmYWxzZTtcclxuICAgICAgICAgICAgJHNjb3BlLm1pbkRhdGUgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgICAgICAvLyAkc2NvcGUub3B0aW9ucyA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgJHNjb3BlLnJlcXVlc3REYXRlVGltZSA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgJHNjb3BlLmlzRGF0ZVNlbGVjdGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICRzY29wZS5pc0dwc0VuYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAkc2NvcGUuaGFzR3BzQmVlbkNoZWNrZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgJHNjb3BlLmRhdGVPcHRpb25zID0ge1xyXG4gICAgICAgICAgICAgICAgZm9ybWF0WWVhcjogJ3l5JyxcclxuICAgICAgICAgICAgICAgIG1pbkRhdGU6IG5ldyBEYXRlKCksXHJcbiAgICAgICAgICAgICAgICBzdGFydGluZ0RheTogMSxcclxuICAgICAgICAgICAgICAgIHNob3dXZWVrczogZmFsc2VcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgJHNjb3BlLnRpbWVwaWNrZXJPYmplY3QgPSB7fTtcclxuICAgICAgICAgICAgJHNjb3BlLmlzRlJTZXJ2aWNlQWN0aXZlID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuaXNVc2VyQWxsb3dlZFRvTWFrZUFSZXNlcnZhdGlvbiA9IGlzVXNlckFsbG93ZWRUb01ha2VBUmVzZXJ2YXRpb247XHJcblxyXG4gICAgICAgICAgICBpbml0aWFsaXplTG9jYXRpb25Ob3RlcygpO1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLmlzQWxsb3dlZCA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAvL2VudW0gdG8gbWF0Y2ggZW51bSBpbiBTZXJ2ZXIgc2lkZSBjb2RlXHJcbiAgICAgICAgICAgIHZhciByZXNlcnZhdGlvblR5cGVFbnVtID0ge1xyXG4gICAgICAgICAgICAgICAgQVNBUDogMSxcclxuICAgICAgICAgICAgICAgIEFEVkFOQ0VEOiAyLFxyXG4gICAgICAgICAgICAgICAgQVBQT0lOVE1FTlQ6IDNcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uVHlwZUVudW0gPSByZXNlcnZhdGlvblR5cGVFbnVtO1xyXG5cclxuICAgICAgICAgICAgdmFyIHRpbWVGb3JtYXQgPSAnaDptbSBBJztcclxuXHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiB0b2dnbGVPcHRpb25zKCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmlzSGlkZGVuID0gISRzY29wZS5pc0hpZGRlbjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gcG9wdWxhdGVDb3VudChjb3VudCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBBcnJheShjb3VudCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGNoaWxkcmVuQ291bnQoY291bnQpIHtcclxuICAgICAgICAgICAgICAgIHZhciBjaGlsZHJlbkFycmF5ID0gW107XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8PSBjb3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW5BcnJheS5wdXNoKGkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNoaWxkcmVuQXJyYXk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBpc0NhbGVuZGVyQnV0dG9uQWN0aXZlKClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWYgKCEkc2NvcGUub3B0aW9ucy5pc0FkdmFuY2VkUmVzZXJ2YXRpb24pXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICghJHNjb3BlLmRpc3BsYXlEYXRlVGltZXBpY2tlciAmJiAhJHNjb3BlLmlzRGF0ZVNlbGVjdGVkKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xyXG5cclxuICAgICAgICAgICAgICAgIC8vRmluZCBvdXQgaWYgRlIgaXMgYWN0aXZlIGZvciB0aGlzIGRpdmlzaW9uLiBUaGlzIHdpbGwgYmUgdXNlZCBsYXRlciBvbiB3aGlsZSByZXNlcnZpbmdcclxuICAgICAgICAgICAgICAgIC8vIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbkluZm8oKVxyXG4gICAgICAgICAgICAgICAgLy8gLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgdmFyIGRpdmlzaW9uSW5mbyA9IHJlc3BvbnNlLmRhdGEucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgLy8gICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGl2aXNpb25JbmZvLlNlcnZpY2VzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgIGlmIChkaXZpc2lvbkluZm8uU2VydmljZXNbaV0uU2VydmljZUlkID09IFwiZml4ZWRcIikge1xyXG4gICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgJHNjb3BlLmlzRlJTZXJ2aWNlQWN0aXZlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIC8vICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gICAgIH1cclxuICAgICAgICAgICAgICAgIC8vIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgLy8gfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmlzRlJTZXJ2aWNlQWN0aXZlID0hYW5ndWxhci5pc1VuZGVmaW5lZChPbmVNdlNlcnZpY2VzLmdldEZpeGVkUm91dGVJbmZvKCkpO1xyXG5cclxuICAgICAgICAgICAgICAgIGdldFNlcnZpY2VEYXRlKCkvL3Byb21pc2UgY2hhaW5pbmcuXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oXHJcbiAgICAgICAgICAgICAgICAgICAgcG9wdWxhdGVSdW5zKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuaXNTdGFydERwID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB2YXIgZHQgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmRhdGVPcHRpb25zLm1pbkRhdGUgPSBuZXcgRGF0ZShkdC5zZXREYXRlKGR0LmdldERhdGUoKSArICRzY29wZS5vcHRpb25zLnBhc3NlbmdlckJvb2tpbmdNaW5EYXlzKSk7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZGF0ZU9wdGlvbnMubWF4RGF0ZSA9IG5ldyBEYXRlKGR0LnNldERhdGUoZHQuZ2V0RGF0ZSgpICsgJHNjb3BlLm9wdGlvbnMucGFzc2VuZ2VyQm9va2luZ01heERheXMpKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QuUmVzZXJ2YXRpb25EYXRlVmlldyA9ICRzY29wZS5kYXRlT3B0aW9ucy5taW5EYXRlO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNob3dDYWxlbmRhciA9ICEkc2NvcGUub3B0aW9ucy5pc0FkdmFuY2VkUmVzZXJ2YXRpb247XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd0NhbGVuZGFyQnV0dG9uID0gaXNDYWxlbmRlckJ1dHRvbkFjdGl2ZSgpO1xyXG4gICAgICAgICAgICAgICAgLy9zZXRSZXNlcnZhdGlvblR5cGUoKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5pc0xvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHJlc2V0Rm9ybSgpO1xyXG5cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgLy8gTGlzdGVuIHRvIEdlb2xvY2F0aW9uc2VydmljZSB0byBmaW5kIG91dCBpZiBHUFMgaXMgZW5hYmxlZC5cclxuICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgJHNjb3BlLiRvbignR2VvTG9jYXRpb25TZXJ2aWNlLmdwc0lzQXZhaWxhYmxlJywgZnVuY3Rpb24gKGV2ZW50LCBkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuaXNHcHNFbmFibGVkID0gZGF0YS5ncHNJc0VuYWJsZWQ7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWRhdGEuZ3BzSXNFbmFibGVkICYmICRzY29wZS5vcHRpb25zXHJcbiAgICAgICAgICAgICAgICAgICAgJiYgJHNjb3BlLm9wdGlvbnMuYWxsb3dSZXNlcnZhdGlvbk9ubHlXaGVuR3BzSXNPbikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghJHNjb3BlLmlzR3BzRW5hYmxlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuJGJyb2FkY2FzdCgndG9nZ2xlLWZyb20tYWRkcmVzcycsICEkc2NvcGUub3B0aW9ucy5hbGxvd1Jlc2VydmF0aW9uT25seVdoZW5HcHNJc09uKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gT25seSBzaG93IHRvYXN0IG1lc3NhZ2Ugb25jZS5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndG9hc3QtY29udGFpbmVyJykpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0SW5mbygnSW5mb3JtYXRpb24nLCAnRW5hYmxlIGdwcyB0byBtYWtlIGEgcmVzZXJ2YXRpb24uJywgMTAwMDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBXYWl0IDIgc2Vjb25kcywgdGhlbiBoaWRlIGFueSBtb2RhbHMgdGhhdCBtYXkgaGF2ZSBiZWVuIGRpc3BsYXllZCwgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIElFLiB0aGUgJ1BsZWFzZSBmaW5kIGFuZCBzZWxlY3QgeW91ciBob21lIGFkZHJlc3MnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJ1t1aWItbW9kYWwtd2luZG93PW1vZGFsLXdpbmRvd10nKS5yZW1vdmUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJ2JvZHknKS5yZW1vdmVDbGFzcygnbW9kYWwtb3BlbicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCAzMDAwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRGlzcGxheSBtZXNzYWdlIGZvciAxNSBzZWNvbmRzIHRoZW4gcmVkaXJlY3QgdG8gZGFzaGJvYXJkLiAgQ2hhbmdlZCB0byAxMCBzZWNvbmRzIHBlciBKYXNvbiByZXF1ZXN0LlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzVXNlckFsbG93ZWRUb01ha2VBUmVzZXJ2YXRpb24oKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJ1t1aWItbW9kYWwtd2luZG93PW1vZGFsLXdpbmRvd10nKS5yZW1vdmUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCdib2R5JykucmVtb3ZlQ2xhc3MoJ21vZGFsLW9wZW4nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkd2luZG93LmxvY2F0aW9uLnJlcGxhY2UoJyMvJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQodHJ1ZSk7ICAvLyBJIG11c3QgZG8gYSBoYXJkIHJlZnJlc2ggdG8gd2lwZSBvdXQgYW55IG1vZGFscyBjb250cm9sbGVycyB0aGF0IG1heSBvciBtYXkgbm90IGJlIGxvYWRlZC5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDE1MDAwKTtcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5oYXNHcHNCZWVuQ2hlY2tlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC8vXHJcbiAgICAgICAgICAgIC8vIEZ1bmN0aW9uIHRvIGRldGVybWluZSBpZiB0aGUgZGl2aXNpb24gb25seSBhbGxvd3MgcmVzZXJ2YXRpb24gd2hlbiBHUFMgaXMgb25cclxuICAgICAgICAgICAgLy8gQU5EIGlmIGdwcyBpcyBvbi5cclxuICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgZnVuY3Rpb24gaXNVc2VyQWxsb3dlZFRvTWFrZUFSZXNlcnZhdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgaWYoISRzY29wZS5oYXNHcHNCZWVuQ2hlY2tlZCl7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmhhc0dwc0JlZW5DaGVja2VkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBHZW9Mb2NhdGlvblNlcnZpY2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmdldEN1cnJlbnRQb3NpdGlvbigpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2YXIgciA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLm9wdGlvbnMgJiYgJHNjb3BlLm9wdGlvbnMuYWxsb3dSZXNlcnZhdGlvbk9ubHlXaGVuR3BzSXNPbiAmJiAkc2NvcGUuaGFzR3BzQmVlbkNoZWNrZWQpe1xyXG4gICAgICAgICAgICAgICAgICAgIHIgPSAkc2NvcGUub3B0aW9ucy5hbGxvd1Jlc2VydmF0aW9uT25seVdoZW5HcHNJc09uID8kc2NvcGUuaXNHcHNFbmFibGVkIDogdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiByO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBzZXRDdXJyZW50VGltZSgpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50RGF0ZSA9IG1vbWVudC50eihEaXZpc2lvblNlcnZpY2UuZ2V0VGltZVpvbmUoKSk7Ly9uZXcgRGF0ZShuZXcgRGF0ZSgpLmdldFRpbWUoKSArIDEwICogNjAgKiAxMDAwKTtcclxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50SG91ciA9IHBhcnNlSW50KGN1cnJlbnREYXRlLmZvcm1hdCgnSEgnKSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudE1pbnV0ZSA9IHBhcnNlSW50KGN1cnJlbnREYXRlLmZvcm1hdCgnbW0nKSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudFRpbWUxMkhyID0gKGN1cnJlbnRIb3VyID4gMTIgPyAoY3VycmVudEhvdXIgLSAxMikgOiAoY3VycmVudEhvdXIgPT0gMCA/IDEyIDogY3VycmVudEhvdXIpKTtcclxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50VGltZTVtSW52ID0gY3VycmVudE1pbnV0ZSA9PSAwID8gMCA6IChjdXJyZW50TWludXRlID09IDUgPyA1IDogKE1hdGguY2VpbChjdXJyZW50TWludXRlLzUpKjUpKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS50aW1lcGlja2VyT2JqZWN0LkFNUE1WaWV3ID0gY3VycmVudERhdGUuZm9ybWF0KCdhJykudG9VcHBlckNhc2UoKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS50aW1lcGlja2VyT2JqZWN0LnNjaGVkSHJWaWV3ID0gY3VycmVudFRpbWUxMkhyIDwgMTAgPyBcIjBcIiArIGN1cnJlbnRUaW1lMTJIci50b1N0cmluZygpOiBjdXJyZW50VGltZTEySHIudG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS50aW1lcGlja2VyT2JqZWN0LnNjaGVkTWluVmlldyA9IGN1cnJlbnRNaW51dGUgPCA1ID8gXCIwXCIgKyBjdXJyZW50VGltZTVtSW52LnRvU3RyaW5nKCkgOiBjdXJyZW50VGltZTVtSW52LnRvU3RyaW5nKCk7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LlJlc2VydmF0aW9uRGF0ZVZpZXcgPSAkc2NvcGUuZGF0ZU9wdGlvbnMubWluRGF0ZTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5zY2hlZEhyID0gICRzY29wZS50aW1lcGlja2VyT2JqZWN0LnNjaGVkSHJWaWV3O1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNjaGVkTWluID0gICRzY29wZS50aW1lcGlja2VyT2JqZWN0LnNjaGVkTWluVmlldztcclxuICAgICAgICAgICAgICAgICRzY29wZS5BTVBNID0gICRzY29wZS50aW1lcGlja2VyT2JqZWN0LkFNUE1WaWV3O1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5SZXNlcnZhdGlvbkRhdGUgPSAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LlJlc2VydmF0aW9uRGF0ZVZpZXc7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfSBcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHJlc2V0Rm9ybSgpIHtcclxuICAgICAgICAgICAgICAgIHJlc2V0RGF0ZU9wdGlvbkZpZWxkcygpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLiRicm9hZGNhc3QoJ2FuZ3Vjb21wbGV0ZS1hbHQ6Y2xlYXJJbnB1dCcpO1xyXG5cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgJHNjb3BlLmNsaWNrTW9iaWxpdHlBaWQgPSBmdW5jdGlvbiAoYWlkKSB7XHJcbiAgICAgICAgICAgIFx0aWYgKCRzY29wZS5haWRzICYmICRzY29wZS5haWRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgJHNjb3BlLmFpZHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgXHRcdFx0JHNjb3BlLmFpZHNbaV0uSXNTZWxlY3RlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBcdFx0fVxyXG4gICAgICAgICAgICBcdFx0aWYgKGFpZCkge1xyXG4gICAgICAgICAgICBcdFx0XHRhaWQuSXNTZWxlY3RlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIFx0XHR9XHJcbiAgICAgICAgICAgIFx0fVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBwb3B1bGF0ZU1vYmlsaXR5QWlkcygpIHtcclxuICAgICAgICAgICAgXHQkKFwiI3Jkb05vTW9iaWxpdHlBaWRzXCIpLnByb3AoXCJjaGVja2VkXCIsIHRydWUpO1xyXG4gICAgICAgICAgICBcdFByb2ZpbGVTZXJ2aWNlLkdldERlZmF1bHRNb2JpbGl0eUFpZHMoJHNjb3BlLm9wdGlvbnMuRGl2aXNpb25JZCwgJHNjb3BlLnBhc3Nlbmdlci5JZClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkZWZhdWx0TW9iaWxpdHlBaWRzKSB7XHJcbiAgICAgICAgICAgICAgICBcdC8vIGNsZWFyIGFpZHMgbGlzdHNcclxuICAgICAgICAgICAgICAgIFx0JHNjb3BlLmFpZHMubGVuZ3RoID0gMDtcclxuICAgICAgICAgICAgICAgIFx0JHNjb3BlLmFzc2lzdGFudHMubGVuZ3RoID0gMDtcclxuXHJcbiAgICAgICAgICAgICAgICBcdC8vIGNyZWF0ZSBubyBhaWRzIGNob2ljZVxyXG4gICAgICAgICAgICAgICAgXHR2YXIgbm9BaWRzID0ge1xyXG4gICAgICAgICAgICAgICAgXHRcdElzU2VsZWN0ZWQ6IHRydWUsXHJcbiAgICAgICAgICAgICAgICBcdFx0S2V5TmFtZTogXCJubyBhaWRzXCIsXHJcblx0XHRcdFx0XHRcdEdyb3VwOiAyLFxyXG4gICAgICAgICAgICAgICAgXHRcdERpc3BsYXlOYW1lOiBcIk5vIE1vYmlsaXR5IEFpZCBSZXF1aXJlZFwiXHJcbiAgICAgICAgICAgICAgICBcdH07XHJcbiAgICAgICAgICAgICAgICBcdCRzY29wZS5haWRzLnB1c2gobm9BaWRzKTtcclxuXHJcbiAgICAgICAgICAgICAgICBcdC8vIGFwcGVuZCBhbGwgYWlkcyBhbGxvd2VkIGJ5IGRpdmlzaW9uXHJcbiAgICAgICAgICAgICAgICBcdHZhciBhaWRDb3VudCA9IDA7XHJcbiAgICAgICAgICAgICAgICBcdGZvciAodmFyIGkgPSAwOyBpIDwgZGVmYXVsdE1vYmlsaXR5QWlkcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIFx0dmFyIG1vYmlsaXR5QWlkID0gZGVmYXVsdE1vYmlsaXR5QWlkc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICBcdGlmIChtb2JpbGl0eUFpZC5Hcm91cCA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgXHRcdG1vYmlsaXR5QWlkLnNlbGVjdGVkID0gbW9iaWxpdHlBaWQuSXNTZWxlY3RlZDtcclxuICAgICAgICAgICAgICAgICAgICBcdFx0JHNjb3BlLmFzc2lzdGFudHMucHVzaChtb2JpbGl0eUFpZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgXHR9IGVsc2UgaWYgKG1vYmlsaXR5QWlkLkdyb3VwID09IDIpIHtcclxuICAgICAgICAgICAgICAgICAgICBcdFx0aWYgKG1vYmlsaXR5QWlkLklzU2VsZWN0ZWQgPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIFx0XHRcdGlmIChhaWRDb3VudCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBcdFx0XHRcdG1vYmlsaXR5QWlkLklzU2VsZWN0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBcdFx0XHR9XHJcbiAgICAgICAgICAgICAgICAgICAgXHRcdFx0YWlkQ291bnQrKztcclxuICAgICAgICAgICAgICAgICAgICBcdFx0fVxyXG4gICAgICAgICAgICAgICAgICAgIFx0XHRtb2JpbGl0eUFpZC5zZWxlY3RlZCA9IG1vYmlsaXR5QWlkLklzU2VsZWN0ZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgXHRcdGlmIChtb2JpbGl0eUFpZC5Jc1NlbGVjdGVkKVxyXG4gICAgICAgICAgICAgICAgICAgIFx0XHQgICAgbm9BaWRzLklzU2VsZWN0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBcdFx0JHNjb3BlLmFpZHMucHVzaChtb2JpbGl0eUFpZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKCdFcnJvcicsIHJlc3BvbnNlLk1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZnVuY3Rpb24gcmVzZXREYXRlT3B0aW9uRmllbGRzKClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdCA9IHt9O1xyXG5cclxuICAgICAgICAgICAgICAgICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QuUGFzc2VuZ2VyQ291bnQgPSBcIjFcIjtcclxuICAgICAgICAgICAgICAgICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QuQ29tcGFuaW9uc0NvdW50ID0gXCIwXCI7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0Lm1vYmlsaXR5QWlkID0gXCJub25lXCI7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LklzV2hlZWxDaGFpciA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5Jc1BDQSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5Jc1NlcnZpY2VBbmltYWwgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QuVHJpcEZhcmVzID0gW107XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIC8vJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5Jc0FTQVAgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgc2V0UmVzZXJ2YXRpb25UeXBlKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmVzZXREYXRlcygpO1xyXG5cclxuICAgICAgICAgICAgICAgIGluaXRpYWxpemVMb2NhdGlvbk5vdGVzKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGluaXRpYWxpemVMb2NhdGlvbk5vdGVzKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5vcHRpb25zICYmICRzY29wZS5vcHRpb25zLmFsbG93TG9jYXRpb25Ob3Rlcykge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QubG9jYXRpb25Ob3RlcyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ2Zyb20nOiAnJywgJ3RvJzogJydcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgIC8vJHNjb3BlLnNob3dMb2NhdGlvbk5vdGVzID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vICAgICdmcm9tJzogZmFsc2UsICd0byc6IGZhbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgLy99O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgIFxyXG5cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHJlc2V0RGF0ZXMoKSB7XHJcbiAgICAgICAgICAgICAgICBzZXRDdXJyZW50VGltZSgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5vcHRpb25zLmlzQWR2YW5jZWRSZXNlcnZhdGlvbiAmJiAoJHNjb3BlLm9wdGlvbnMucGFzc2VuZ2VyQm9va2luZ01pbkRheXMgPiAwKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICgkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LlJlc2VydmF0aW9uRGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRQaWNrdXBEYXRlVGltZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5pc0RhdGVTZWxlY3RlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5kaXNwbGF5RGF0ZVRpbWVwaWNrZXIgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICRzY29wZS5zaG93Q2FsZW5kYXJCdXR0b24gPSBpc0NhbGVuZGVyQnV0dG9uQWN0aXZlKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHNldFJlc2VydmF0aW9uVHlwZSgpIHtcclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUub3B0aW9ucy5pc0FkdmFuY2VkUmVzZXJ2YXRpb24gJiYgKCRzY29wZS5vcHRpb25zLnBhc3NlbmdlckJvb2tpbmdNaW5EYXlzID4gMCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LnJlc2VydmF0aW9uVHlwZSA9ICRzY29wZS5yZXNlcnZhdGlvblR5cGVFbnVtLkFEVkFOQ0VEO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5vcHRpb25zLmFsbG93QVNBUFJlc2VydmF0aW9ucylcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5yZXNlcnZhdGlvblR5cGUgPSAkc2NvcGUucmVzZXJ2YXRpb25UeXBlRW51bS5BU0FQO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKCRzY29wZS5vcHRpb25zLmlzQWR2YW5jZWRSZXNlcnZhdGlvbilcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5yZXNlcnZhdGlvblR5cGUgPSAkc2NvcGUucmVzZXJ2YXRpb25UeXBlRW51bS5BRFZBTkNFRDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gY2xvc2VEYXRlVGltZVBpY2tlcigpIHtcclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUub3B0aW9ucy5pc0FkdmFuY2VkUmVzZXJ2YXRpb24gJiYgKCRzY29wZS5vcHRpb25zLnBhc3NlbmdlckJvb2tpbmdNaW5EYXlzID4gMCkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXNldERhdGVzKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvL2dldCBvbGQgZGF0ZXMgdGltZVxyXG4gICAgICAgICAgICAgICAgICAgICAkc2NvcGUudGltZXBpY2tlck9iamVjdC5zY2hlZEhyVmlldyA9ICRzY29wZS5zY2hlZEhyO1xyXG4gICAgICAgICAgICAgICAgICAgICAkc2NvcGUudGltZXBpY2tlck9iamVjdC5zY2hlZE1pblZpZXcgPSAkc2NvcGUuc2NoZWRNaW47XHJcbiAgICAgICAgICAgICAgICAgICAgICRzY29wZS50aW1lcGlja2VyT2JqZWN0LkFNUE1WaWV3ID0gJHNjb3BlLkFNUE07XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmRpc3BsYXlEYXRlVGltZXBpY2tlciA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QuUmVzZXJ2YXRpb25EYXRlVmlldyA9ICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QuUmVzZXJ2YXRpb25EYXRlO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghJHNjb3BlLmlzRGF0ZVNlbGVjdGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldFJlc2VydmF0aW9uVHlwZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd0NhbGVuZGFyQnV0dG9uID0gaXNDYWxlbmRlckJ1dHRvbkFjdGl2ZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHRpbWVwaWNrZXJDbGlja2VkKCkge1xyXG5cclxuICAgICAgICAgICAgICAgICRzY29wZS5kaXNwbGF5RGF0ZVRpbWVwaWNrZXIgPSAhJHNjb3BlLmRpc3BsYXlEYXRlVGltZXBpY2tlcjtcclxuICAgICAgICAgICAgICAgIC8vJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5Jc0FTQVAgPSAhJHNjb3BlLmRpc3BsYXlEYXRlVGltZXBpY2tlcjtcclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUub3B0aW9ucy5pc0FkdmFuY2VkUmVzZXJ2YXRpb24pXHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5yZXNlcnZhdGlvblR5cGUgPSBTdHJpbmcocmVzZXJ2YXRpb25UeXBlRW51bS5BRFZBTkNFRCk7XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmKCRzY29wZS5vcHRpb25zLmFsbG93QXBwb2ludG1lbnRzKVxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QucmVzZXJ2YXRpb25UeXBlID0gU3RyaW5nKHJlc2VydmF0aW9uVHlwZUVudW0uQVBQT0lOVE1FTlQpO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmlzRGF0ZVNlbGVjdGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd0NhbGVuZGFyQnV0dG9uID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBzZXRDdXJyZW50VGltZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldFNlcnZpY2VEYXRlKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFNjaGVkdWxlU2VydmljZS5nZXRTZXJ2aWNlRGF0ZUJ5RGl2aXNpb24oJHNjb3BlLm9wdGlvbnMuRGl2aXNpb25JZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5zZXJ2aWNlRGF0ZSA9IG1vbWVudChyZXNwb25zZS5kYXRhLnJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5SZXNlcnZhdGlvbkRhdGUgPSBuZXcgRGF0ZSgkc2NvcGUuc2VydmljZURhdGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5tb2RlID09IFwicmVjb25jaWxpYXRpb25cIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QuUmVzZXJ2YXRpb25EYXRlID0gJHNjb3BlLnNlcnZpY2VEYXRlLnN1YnRyYWN0KDEsICdkYXlzJykuZm9ybWF0KCdNTS1ERC1ZWVlZJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5taW5EYXRlID0gbmV3IERhdGUoMTk5MCwgNSwgMjIpOyAvL25vciBzdXJlIHdoeSB0aGlzIGlzIGhhcmQtY29kZWRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1heERhdGVBbGxvd2VkID0gJHNjb3BlLnNlcnZpY2VEYXRlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjayhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcihcIkVycm9yIVwiLCBcIkZhaWxlZCB0byBnZXQgc2VydmljZSBkYXRlLlwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZnVuY3Rpb24gcG9wdWxhdGVIb3VycygpIHsgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gIG5ldyBBcnJheSAoJzAxJywgJzAyJywgJzAzJywgJzA0JywgJzA1JywgJzA2JywgJzA3JywgJzA4JywgJzA5JywgJzEwJywgJzExJywgJzEyJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZnVuY3Rpb24gcG9wdWxhdGVNaW51dGVzKClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1pbnV0ZXNBcnJheSA9IG5ldyBBcnJheSgpO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA2MDsgaSs9NSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG1pbnV0ZXNBcnJheS5wdXNoKGkgPCAxMCA/ICgnMCcgKyBpLnRvU3RyaW5nKCkpIDogaS50b1N0cmluZygpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBtaW51dGVzQXJyYXk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBzZXRQaWNrdXBEYXRlVGltZSgpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5zY2hlZEhyID0gICRzY29wZS50aW1lcGlja2VyT2JqZWN0LnNjaGVkSHJWaWV3O1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNjaGVkTWluID0gICRzY29wZS50aW1lcGlja2VyT2JqZWN0LnNjaGVkTWluVmlldztcclxuICAgICAgICAgICAgICAgICRzY29wZS5BTVBNID0gICRzY29wZS50aW1lcGlja2VyT2JqZWN0LkFNUE1WaWV3O1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5SZXNlcnZhdGlvbkRhdGUgPSAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LlJlc2VydmF0aW9uRGF0ZVZpZXc7XHJcblxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmlzRGF0ZVNlbGVjdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzVW5kZWZpbmVkKCRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QpIHx8ICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QgPT09IG51bGwgfHwgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5yZXNlcnZhdGlvblR5cGUgPT0gcmVzZXJ2YXRpb25UeXBlRW51bS5BU0FQKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHZhciBocnMgPSAwO1xyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5BTVBNID09PSBcIlBNXCIgJiYgcGFyc2VJbnQoJHNjb3BlLnNjaGVkSHIpICE9IDEyKVxyXG4gICAgICAgICAgICAgICAgICAgIGhycyA9IHBhcnNlSW50KCRzY29wZS5zY2hlZEhyKSArIDEyO1xyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoJHNjb3BlLkFNUE0gPT09IFwiQU1cIiAmJiBwYXJzZUludCgkc2NvcGUuc2NoZWRIcikgPT0gMTIpXHJcbiAgICAgICAgICAgICAgICAgICAgaHJzID0gMDtcclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICBocnMgPSBwYXJzZUludCgkc2NvcGUuc2NoZWRIcik7XHJcblxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlcXVlc3REYXRlVGltZSA9IG5ldyBEYXRlKCRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QuUmVzZXJ2YXRpb25EYXRlKS5zZXRIb3VycyhocnMsIHBhcnNlSW50KCRzY29wZS5zY2hlZE1pbiksIDApOyAgICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmRpc3BsYXlTZWxlY3RlZERhdGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmRpc3BsYXlEYXRlVGltZXBpY2tlciA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gcG9wdWxhdGVSdW5zKCkge1xyXG4gICAgICAgICAgICAgICAgcG9wdWxhdGVNb2JpbGl0eUFpZHMoKTtcclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUucGFzc2VuZ2VyKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICRzY29wZS5sb2FkaW5nUnVucyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAvLyBsZXQgcnVuRGF0ZSA9IG1vbWVudCgkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LlJlc2VydmF0aW9uRGF0ZSkuZm9ybWF0KCdNTS1ERC1ZWVlZJyk7XHJcbiAgICAgICAgICAgICAgICAvL2xldCBpc29Gb3JtYXRSdW5EYXRlID0gbW9tZW50KCRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QuUmVzZXJ2YXRpb25EYXRlLCAnTU0tREQtWVlZWScpLmZvcm1hdCgpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUubW9kZSA9PSBcInJlY29uY2lsaWF0aW9uXCIpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgU2NoZWR1bGVTZXJ2aWNlLmdldFBhc3RSdW5zKCRzY29wZS5vcHRpb25zLkRpdmlzaW9uSWQsIHJ1bkRhdGUpXHJcbiAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubG9hZGluZ1J1bnMgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5ydW5zID0gcmVzcG9uc2UuZGF0YS5yZXN1bHRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAkc2NvcGUucnVucy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJ1bnNbaV0uU3RhcnRUaW1lRGlzcGxheSA9IERhdGVGYWN0b3J5LmdldEN1c3RvbVRpbWUoJHNjb3BlLnJ1bnNbaV0uU3RhcnRUaW1lLCBydW5EYXRlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5ydW5zW2ldLkVuZFRpbWVEaXNwbGF5ID0gRGF0ZUZhY3RvcnkuZ2V0Q3VzdG9tVGltZSgkc2NvcGUucnVuc1tpXS5FbmRUaW1lLCBydW5EYXRlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoJ0Vycm9yJywgcmVzcG9uc2UuZGF0YS5SZXR1cm5NZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubG9hZGluZ1J1bnMgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKCdFcnJvcicsIHJlc3BvbnNlLmRhdGEuUmV0dXJuTWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBTY2hlZHVsZVNlcnZpY2UuZ2V0QWN0aXZlUnVucygkc2NvcGUub3B0aW9ucy5EaXZpc2lvbklkLCBydW5EYXRlKVxyXG4gICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmdSdW5zID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucnVucyA9IHJlc3BvbnNlLmRhdGEucmVzdWx0XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgJHNjb3BlLnJ1bnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5ydW5zW2ldLlN0YXJ0VGltZURpc3BsYXkgPSBEYXRlRmFjdG9yeS5nZXRDdXN0b21UaW1lKCRzY29wZS5ydW5zW2ldLlN0YXJ0VGltZSwgcnVuRGF0ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucnVuc1tpXS5FbmRUaW1lRGlzcGxheSA9IERhdGVGYWN0b3J5LmdldEN1c3RvbVRpbWUoJHNjb3BlLnJ1bnNbaV0uRW5kVGltZSwgcnVuRGF0ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXNlcnZhdGlvblJ1bnMgPSBbXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCgkc2NvcGUucnVucywgZnVuY3Rpb24gKHZhbHVlLCBrZXkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5sb2dpc3RpY1N0YXR1cyAhPSAnMTA5JyAmJiB2YWx1ZS5TdGF0dXMgIT0gJ0Zyb3plbicgJiYgIXZhbHVlLklzRGVsZXRlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc2VydmF0aW9uUnVucy5wdXNoKHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyRzY29wZS5ydW5zLnNwbGljZSgkc2NvcGUucnVucy5pbmRleE9mKHZhbHVlKSsxLCAxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5ydW5zID0gcmVzZXJ2YXRpb25SdW5zO1xyXG4gICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcignRXJyb3InLCByZXNwb25zZS5kYXRhLlJldHVybk1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5sb2FkaW5nUnVucyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoJ0Vycm9yJywgcmVzcG9uc2UuZGF0YS5SZXR1cm5NZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmdW5jdGlvbiBvblN1Y2Vzc2Z1bGxSZXNlcnZhdGlvbih0cmlwLCBpc0FTQVApIHtcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgKCRzY29wZS5ub3RpZnlTdWNlc3NmdWxsUmVzZXJ2YXRpb24pID09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubm90aWZ5U3VjZXNzZnVsbFJlc2VydmF0aW9uKHRyaXAsIGlzQVNBUCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZnVuY3Rpb24gc2F2ZVJlc2VydmF0aW9uKHJlc2VydmF0aW9uUmVxdWVzdCkge1xyXG4gICAgICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgICAgIC8vIERvdWJsZSBjaGVjayB0byBzZWUgaWYgR1BTIGlzIHJlcXVpcmVkIGFuZCBpZiBHUFMgaXMgZW5hYmxlZC5cclxuICAgICAgICAgICAgICAgIC8vXHJcbiAgICAgICAgICAgICAgICBpZigkc2NvcGUub3B0aW9ucy5hbGxvd1Jlc2VydmF0aW9uT25seVdoZW5HcHNJc09uICYmIGlzVXNlckFsbG93ZWRUb01ha2VBUmVzZXJ2YXRpb24oKSl7XHJcbiAgICAgICAgICAgICAgICAgICAgR2VvTG9jYXRpb25TZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRDdXJyZW50UG9zaXRpb24oKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpc1VzZXJBbGxvd2VkVG9NYWtlQVJlc2VydmF0aW9uKCkpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNlcnZhdGlvblJlcXVlc3QucmVzZXJ2YXRpb25UeXBlID09IHJlc2VydmF0aW9uVHlwZUVudW0uQURWQU5DRUQgfHwgcmVzZXJ2YXRpb25SZXF1ZXN0LnJlc2VydmF0aW9uVHlwZSA9PSByZXNlcnZhdGlvblR5cGVFbnVtLkFQUE9JTlRNRU5UKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEkc2NvcGUuaXNEYXRlU2VsZWN0ZWQpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lcGlja2VyQ2xpY2tlZCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy9yZXNlcnZhdGlvblR5cGUgMSwgMiwgM1xyXG4gICAgICAgICAgICAgICAgaWYgKCEkc2NvcGUuaXNEYXRlU2VsZWN0ZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzZXJ2YXRpb25SZXF1ZXN0LklzQVNBUCA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmlzU2F2aW5nID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgaHJzID0gZ2V0SG91cnMoKTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgbWlucyA9ICRzY29wZS5zY2hlZE1pbjtcclxuXHJcbiAgICAgICAgICAgICAgICByZXNlcnZhdGlvblJlcXVlc3QuUmVzZXJ2YXRpb25UaW1lID0gaHJzLnRvU3RyaW5nKCkubGVuZ3RoID09IDEgPyAoXCIwXCIgKyBocnMudG9TdHJpbmcoKSArIG1pbnMpIDogKGhycy50b1N0cmluZygpICsgbWlucyk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHZhbGlkYXRlUmVxdWVzdChyZXNlcnZhdGlvblJlcXVlc3QpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9DaGVjayBmb3IgRlIgZXhjbHVzaW9uXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5pc0ZSU2VydmljZUFjdGl2ZSkvL2NoZWNrIGlmIEZSIGlzIGFjdGl2ZSBmb3IgdGhpcyBkaXZpc2lvblxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNoZWNrRml4ZWRSb3V0ZXMgPSAkc2NvcGUub3B0aW9ucy5jaGVja0ZSQmVmb3JlRFJUOyAvL3N5c3RlbSBwYXJhbWV0ZXIgd2hpY2ggdGVsbHMgd2hldGhlciB0byBjaGVjayBmb3IgZml4ZWQgcm91dGUgYmVmb3JlIGJvb2tpbmcgYSBkcnRcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5vT2ZBcnJpdmFscyA9ICRzY29wZS5vcHRpb25zLm5vT2ZGUkFycml2YWxzOyAvL3N5c3RlbSBwYXJhbWV0ZXIgd2hpY2ggdGVsbHMgaG93IG1hbnkgZml4ZWQgcm90ZSBhcnJpdmFscyB0byBzaG93XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjaGVja0ZpeGVkUm91dGVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdG9wU2VydmljZS5nZXRVcGNvbWluZ0Fycml2YWxzRm9yU3RvcCgkc2NvcGUub3B0aW9ucy5EaXZpc2lvbklkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc2VydmF0aW9uUmVxdWVzdC5Gcm9tTG9jYXRpb24uTG9jYXRpb25JZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNlcnZhdGlvblJlcXVlc3QuVG9Mb2NhdGlvbi5Mb2NhdGlvbklkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vT2ZBcnJpdmFscylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1cGNvbWluZ1NjaGVkdWxlcyA9IHJlc3BvbnNlLmRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVwY29taW5nU2NoZWR1bGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd0ZpeGVkUm91dGVzKHVwY29taW5nU2NoZWR1bGVzLCByZXNlcnZhdGlvblJlcXVlc3QuRnJvbUxvY2F0aW9uLk5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaXNTYXZpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNlcnZlVHJpcChyZXNlcnZhdGlvblJlcXVlc3QpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChlcnJvcikge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzZXJ2ZVRyaXAocmVzZXJ2YXRpb25SZXF1ZXN0KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzZXJ2ZVRyaXAocmVzZXJ2YXRpb25SZXF1ZXN0KVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5pc1NhdmluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gZ2V0SG91cnMoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaHJzID0gMDtcclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuQU1QTSA9PT0gXCJQTVwiICYmIHBhcnNlSW50KCRzY29wZS5zY2hlZEhyKSAhPSAxMilcclxuICAgICAgICAgICAgICAgICAgICBocnMgPSBwYXJzZUludCgkc2NvcGUuc2NoZWRIcikgKyAxMjtcclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKCRzY29wZS5BTVBNID09PSBcIkFNXCIgJiYgcGFyc2VJbnQoJHNjb3BlLnNjaGVkSHIpID09IDEyKVxyXG4gICAgICAgICAgICAgICAgICAgIGhycyA9IDA7XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgaHJzID0gcGFyc2VJbnQoJHNjb3BlLnNjaGVkSHIpO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBocnM7XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXRSZXNlcnZhdGlvbkRhdGVUaW1lKHJlc2VydmF0aW9uUmVxdWVzdClcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgdmFyIGhycyA9IGdldEhvdXJzKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIGQgPSBuZXcgRGF0ZShyZXNlcnZhdGlvblJlcXVlc3QuUmVzZXJ2YXRpb25EYXRlLnNldEhvdXJzKGhycywgcGFyc2VJbnQoJHNjb3BlLnNjaGVkTWluKSwgMCkpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBjdXJyX2RhdGUgPSBkLmdldERhdGUoKTtcclxuICAgICAgICAgICAgICAgIHZhciBjdXJyX21vbnRoID0gZC5nZXRNb250aCgpICsxO1xyXG4gICAgICAgICAgICAgICAgdmFyIGN1cnJfeWVhciA9IGQuZ2V0RnVsbFllYXIoKTtcclxuICAgICAgICAgICAgICAgIHZhciBpbnB1dERhdGUgPSBjdXJyX3llYXIgKyBcIi9cIiArY3Vycl9tb250aCArIFwiL1wiICsgY3Vycl9kYXRlICsgXCIgXCIgK2hycy50b1N0cmluZygpICsgXCI6XCIgKyRzY29wZS5zY2hlZE1pbjtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbW9tZW50LnR6KGlucHV0RGF0ZSwgXCJZWVlZL00vRCBISDptbVwiLCBEaXZpc2lvblNlcnZpY2UuZ2V0VGltZVpvbmUoKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZnVuY3Rpb24gcmVzZXJ2ZVRyaXAocmVzZXJ2YXRpb25SZXF1ZXN0KSB7XHJcbiAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEluZm8oXCJDcmVhdGluZyBUcmlwXCIpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHNhdmVUcmlwUmVxID0ge1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIHZhciBzYXZlZFRyaXAgPSB7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgc2F2ZVRyaXBSZXEuUGFzc2VuZ2VySUQgPSBwYXJzZUludCgkc2NvcGUucGFzc2VuZ2VyLklkKTtcclxuICAgICAgICAgICAgICAgIC8vaGVyZSBmaWd1cmUgb3V0IGZyb20gcmVzZXJ2YXRpb25UeXBlIHdoYXQgQVNBUCwgQWR2YW5jZWQsIEFwcG9pbnRtZW50XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHJlc2VydmF0aW9uUmVxdWVzdCAmJiAocmVzZXJ2YXRpb25SZXF1ZXN0LnJlc2VydmF0aW9uVHlwZSAhPSByZXNlcnZhdGlvblR5cGVFbnVtLkFTQVApICYmIHJlc2VydmF0aW9uUmVxdWVzdC5SZXNlcnZhdGlvblRpbWUpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gcmVxdWVzdCBhZHZhbmNlZCByZXNlcnZhdGlvblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICgkc2NvcGUucGFzc2VuZ2VyKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaHJzID0gZ2V0SG91cnMoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBkID0gbmV3IERhdGUocmVzZXJ2YXRpb25SZXF1ZXN0LlJlc2VydmF0aW9uRGF0ZS5zZXRIb3VycyhocnMsIHBhcnNlSW50KCRzY29wZS5zY2hlZE1pbiksIDApKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJyX2RhdGUgPSBkLmdldERhdGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnJfbW9udGggPSBkLmdldE1vbnRoKCkgKyAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3Vycl95ZWFyID0gZC5nZXRGdWxsWWVhcigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5wdXREYXRlID0gY3Vycl95ZWFyICsgXCIvXCIgKyBjdXJyX21vbnRoICsgXCIvXCIgKyBjdXJyX2RhdGUgKyBcIiBcIiArIGhycy50b1N0cmluZygpICsgXCI6XCIgKyAkc2NvcGUuc2NoZWRNaW47XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzYXZlVHJpcFJlcS5SZXF1ZXN0ZWRTdGFydERhdGVUaW1lID0gbW9tZW50LnR6KGlucHV0RGF0ZSwgXCJZWVlZL00vRCBISDptbVwiICxEaXZpc2lvblNlcnZpY2UuZ2V0VGltZVpvbmUoKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgc2F2ZVRyaXBSZXEuUmVxdWVzdGVkU3RhcnREYXRlVGltZSA9IERhdGVGYWN0b3J5LmdldERhdGVGcm9tQ3VzdG9tVGltZShyZXNlcnZhdGlvblJlcXVlc3QuUmVzZXJ2YXRpb25UaW1lLCBtb21lbnQocmVzZXJ2YXRpb25SZXF1ZXN0LlJlc2VydmF0aW9uRGF0ZSkpOy8vbm9uIGFzYXAgZmllbGRcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHNhdmVUcmlwUmVxLk9wZXJhdGlvbklEID0gKCRzY29wZS5vcHRpb25zLk9wZXJhdG9ySWQgIT0gbnVsbCkgPyAkc2NvcGUub3B0aW9ucy5PcGVyYXRvcklkIDogbnVsbDtcclxuXHJcbiAgICAgICAgICAgICAgICBzYXZlVHJpcFJlcS5OdW1PZlBhc3NlbmdlcnMgPSByZXNlcnZhdGlvblJlcXVlc3QuUGFzc2VuZ2VyQ291bnQ7XHJcbiAgICAgICAgICAgICAgICBzYXZlVHJpcFJlcS5OdW1PZldoZWVsQ2hhaXJQYXNzZW5nZXJzID0gMDtcclxuICAgICAgICAgICAgICAgIHNhdmVUcmlwUmVxLk51bU9mWExXaGVlbENoYWlyUGFzc2VuZ2VycyA9IDA7XHJcbiAgICAgICAgICAgICAgICBzYXZlVHJpcFJlcS5OdW1PZlNjb290ZXJQYXNzZW5nZXJzID0gMDtcclxuICAgICAgICAgICAgICAgIHNhdmVUcmlwUmVxLk51bU9mV2Fsa2VyUGFzc2VuZ2VycyA9IDA7XHJcbiAgICAgICAgICAgICAgICBzYXZlVHJpcFJlcS5OdW1PZlBDQXMgPSAwO1xyXG4gICAgICAgICAgICAgICAgc2F2ZVRyaXBSZXEuTnVtT2ZTZXJ2aWNlQW5pbWFscyA9IDA7XHJcbiAgICAgICAgICAgICAgICBzYXZlVHJpcFJlcS5OdW1PZkJpa2VQYXNzZW5nZXJzID0gMDtcclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUub3B0aW9ucy5hbGxvd0VxdWlwbWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuYWlkcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgXHRmb3IgKHZhciBpID0gMDsgaSA8ICRzY29wZS5haWRzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgXHRcdHZhciBtb2JpbGl0eUFpZCA9ICRzY29wZS5haWRzW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIFx0XHRpZiAobW9iaWxpdHlBaWQuSXNTZWxlY3RlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIFx0XHQgICAgc2F2ZVRyaXBSZXEuU2VsZWN0ZWRNb2JpbGl0eUFpZElkID0gbW9iaWxpdHlBaWQuTVZNb2JpbGl0eUFpZHNJZDtcclxuICAgICAgICAgICAgICAgICAgICBcdFx0XHR2YXIga2V5TmFtZSA9IG1vYmlsaXR5QWlkLktleU5hbWUudHJpbSgpLnRvTG93ZXJDYXNlKClcclxuICAgICAgICAgICAgICAgICAgICBcdFx0XHRpZiAoa2V5TmFtZSA9PSBcIndjXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBcdFx0XHRcdHNhdmVUcmlwUmVxLk51bU9mUGFzc2VuZ2VycyA9IHJlc2VydmF0aW9uUmVxdWVzdC5QYXNzZW5nZXJDb3VudCAtIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgXHRcdFx0XHRzYXZlVHJpcFJlcS5OdW1PZldoZWVsQ2hhaXJQYXNzZW5nZXJzID0gMTtcclxuICAgICAgICAgICAgICAgICAgICBcdFx0XHR9IGVsc2UgaWYgKGtleU5hbWUgPT0gXCJ3Y3hsXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBcdFx0XHRcdHNhdmVUcmlwUmVxLk51bU9mUGFzc2VuZ2VycyA9IHJlc2VydmF0aW9uUmVxdWVzdC5QYXNzZW5nZXJDb3VudCAtIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgXHRcdFx0XHRzYXZlVHJpcFJlcS5OdW1PZlhMV2hlZWxDaGFpclBhc3NlbmdlcnMgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIFx0XHRcdH0gZWxzZSBpZiAoa2V5TmFtZSA9PSBcInNjdHJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIFx0XHRcdFx0c2F2ZVRyaXBSZXEuTnVtT2ZQYXNzZW5nZXJzID0gcmVzZXJ2YXRpb25SZXF1ZXN0LlBhc3NlbmdlckNvdW50IC0gMTtcclxuICAgICAgICAgICAgICAgICAgICBcdFx0XHRcdHNhdmVUcmlwUmVxLk51bU9mU2Nvb3RlclBhc3NlbmdlcnMgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIFx0XHRcdH0gZWxzZSBpZiAoa2V5TmFtZSA9PSBcIndrclwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgXHRcdFx0XHRzYXZlVHJpcFJlcS5OdW1PZlBhc3NlbmdlcnMgPSByZXNlcnZhdGlvblJlcXVlc3QuUGFzc2VuZ2VyQ291bnQgLSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIFx0XHRcdFx0c2F2ZVRyaXBSZXEuTnVtT2ZXYWxrZXJQYXNzZW5nZXJzID0gMTtcclxuICAgICAgICAgICAgICAgICAgICBcdFx0XHR9IGVsc2UgaWYgKGtleU5hbWUgPT0gJ2JpcmsnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgXHRcdFx0ICAgIHNhdmVUcmlwUmVxLk51bU9mUGFzc2VuZ2VycyA9IHJlc2VydmF0aW9uUmVxdWVzdC5QYXNzZW5nZXJDb3VudCAtIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgXHRcdFx0ICAgIHNhdmVUcmlwUmVxLk51bU9mQmlrZVBhc3NlbmdlcnMgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIFx0XHRcdH1cclxuICAgICAgICAgICAgICAgICAgICBcdFx0fVxyXG4gICAgICAgICAgICAgICAgICAgIFx0fVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5hc3Npc3RhbnRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBcdGZvciAodmFyIGkgPSAwOyBpIDwgJHNjb3BlLmFzc2lzdGFudHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBcdFx0dmFyIGFzc2lzdGFudCA9ICRzY29wZS5hc3Npc3RhbnRzW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIFx0XHRpZiAoYXNzaXN0YW50LklzU2VsZWN0ZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBcdFx0XHR2YXIga2V5TmFtZSA9IGFzc2lzdGFudC5LZXlOYW1lLnRyaW0oKS50b0xvd2VyQ2FzZSgpXHJcbiAgICAgICAgICAgICAgICAgICAgXHRcdFx0aWYgKGtleU5hbWUgPT0gXCJzYVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVUcmlwUmVxLk51bU9mU2VydmljZUFuaW1hbHMgPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgIFx0XHRcdH0gZWxzZSBpZiAoa2V5TmFtZSA9PSBcInBjYVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVUcmlwUmVxLk51bU9mUENBcyA9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHNhdmVUcmlwUmVxLk51bU9mQ29tcGFuaW9ucyA9IHJlc2VydmF0aW9uUmVxdWVzdC5Db21wYW5pb25zQ291bnQ7XHJcbiAgICAgICAgICAgICAgICBzYXZlVHJpcFJlcS5SdW5JZCA9IHJlc2VydmF0aW9uUmVxdWVzdCAmJiByZXNlcnZhdGlvblJlcXVlc3QuUnVuICYmIHJlc2VydmF0aW9uUmVxdWVzdC5SdW4uUnVuSWQgPyByZXNlcnZhdGlvblJlcXVlc3QuUnVuLlJ1bklkIDogbnVsbDtcclxuXHJcbiAgICAgICAgICAgICAgICBzYXZlVHJpcFJlcS5TdGFydEFkZHJlc3NWaWV3TW9kZWwgPSByZXNlcnZhdGlvblJlcXVlc3QuRnJvbUxvY2F0aW9uO1xyXG4gICAgICAgICAgICAgICAgc2F2ZVRyaXBSZXEuRW5kQWRkcmVzc1ZpZXdNb2RlbCA9IHJlc2VydmF0aW9uUmVxdWVzdC5Ub0xvY2F0aW9uO1xyXG4gICAgICAgICAgICAgICAgc2F2ZVRyaXBSZXEuUmVzZXJ2YXRpb25UeXBlID0gcmVzZXJ2YXRpb25SZXF1ZXN0LnJlc2VydmF0aW9uVHlwZTtcclxuICAgICAgICAgICAgICAgIGlmIChhbmd1bGFyLmVxdWFscyhzYXZlVHJpcFJlcS5TdGFydEFkZHJlc3NWaWV3TW9kZWwsIHt9KSB8fCBzYXZlVHJpcFJlcS5TdGFydEFkZHJlc3NWaWV3TW9kZWwgPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcignRXJyb3InLCBcIkludmFsaWQgbG9jYXRpb25cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmlzU2F2aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuZXF1YWxzKHNhdmVUcmlwUmVxLkVuZEFkZHJlc3NWaWV3TW9kZWwsIHt9KSB8fCBzYXZlVHJpcFJlcS5FbmRBZGRyZXNzVmlld01vZGVsID09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoJ0Vycm9yJywgXCJJbnZhbGlkIGxvY2F0aW9uXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5pc1NhdmluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUub3B0aW9ucyAmJiAkc2NvcGUub3B0aW9ucy5hbGxvd0xvY2F0aW9uTm90ZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBzYXZlVHJpcFJlcS5TdGFydEFkZHJlc3NWaWV3TW9kZWwuTG9jYXRpb25Ob3RlID0gcmVzZXJ2YXRpb25SZXF1ZXN0LmxvY2F0aW9uTm90ZXMuZnJvbS50cmltKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2F2ZVRyaXBSZXEuRW5kQWRkcmVzc1ZpZXdNb2RlbC5Mb2NhdGlvbk5vdGUgPSByZXNlcnZhdGlvblJlcXVlc3QubG9jYXRpb25Ob3Rlcy50by50cmltKCk7IFxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChyZXNlcnZhdGlvblJlcXVlc3QuVHJpcEZhcmVzICE9IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICBzYXZlVHJpcFJlcS5UcmlwRmFyZXMgPSByZXNlcnZhdGlvblJlcXVlc3QuVHJpcEZhcmVzO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc2VydmF0aW9uUmVxdWVzdC5Ub3RhbFRyaXBGYXJlICE9IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgICAgICAgICBzYXZlVHJpcFJlcS5Ub3RhbFRyaXBGYXJlID0gcmVzZXJ2YXRpb25SZXF1ZXN0LlRvdGFsVHJpcEZhcmU7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIHNhdmVUcmlwUmVxLklzRGl2aXNpb25BZHZhbmNlZCA9ICRzY29wZS5vcHRpb25zLmlzQWR2YW5jZWRSZXNlcnZhdGlvbjtcclxuICAgICAgICAgICAgICAgIHNhdmVUcmlwUmVxLlNlcnZpY2VEYXRlID0gJHNjb3BlLnNlcnZpY2VEYXRlO1xyXG4gICAgICAgICAgICAgICAgc2F2ZVRyaXBSZXEuSXNXaWxsQ2FsbCA9IHJlc2VydmF0aW9uUmVxdWVzdC5Jc1dpbGxDYWxsO1xyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5tb2RlID09IFwicmVjb25jaWxpYXRpb25cIikge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vUmVjb25jaWxpYXRpb24gQ2FzZVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghc2F2ZVRyaXBSZXEuUnVuSWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVUcmlwUmVxLlJ1bklkID0gLTE7IC8vc2V0dGluZyBpdCB0byBhbiBpbnQgdmFsdWUsIGVsc2UgdGhlIHJlcXVlc3Qgb2JqZWN0IGlzIGdvaW5nIGFzIG51bGwgdG8gdGhlIHNlcnZlclxyXG4gICAgICAgICAgICAgICAgICAgIHNhdmVUcmlwUmVxLlJ1bkRhdGUgPSByZXNlcnZhdGlvblJlcXVlc3QuUmVzZXJ2YXRpb25EYXRlO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzZXJ2aWNlRGF0ZSA9IG1vbWVudChyZXNlcnZhdGlvblJlcXVlc3QuUmVzZXJ2YXRpb25EYXRlKTtcclxuICAgICAgICAgICAgICAgICAgICBzYXZlVHJpcFJlcS5BcnJpdmVQaWNrVXBEYXRlVGltZVVUQyA9IERhdGVGYWN0b3J5LmdldERhdGVGcm9tQ3VzdG9tVGltZShyZXNlcnZhdGlvblJlcXVlc3QuQXJyaXZlUGlja1VwVGltZSwgc2VydmljZURhdGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNhdmVUcmlwUmVxLlBlcmZvcm1QaWNrVXBEYXRlVGltZVVUQyA9IERhdGVGYWN0b3J5LmdldERhdGVGcm9tQ3VzdG9tVGltZShyZXNlcnZhdGlvblJlcXVlc3QuUGVyZm9ybVBpY2tVcFRpbWUsIHNlcnZpY2VEYXRlKTtcclxuICAgICAgICAgICAgICAgICAgICBzYXZlVHJpcFJlcS5BcnJpdmVEcm9wT2ZmRGF0ZVRpbWVVVEMgPSBEYXRlRmFjdG9yeS5nZXREYXRlRnJvbUN1c3RvbVRpbWUocmVzZXJ2YXRpb25SZXF1ZXN0LkFycml2ZURyb3BPZmZUaW1lLCBzZXJ2aWNlRGF0ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2F2ZVRyaXBSZXEuUGVyZm9ybURyb3BPZmZEYXRlVGltZVVUQyA9IERhdGVGYWN0b3J5LmdldERhdGVGcm9tQ3VzdG9tVGltZShyZXNlcnZhdGlvblJlcXVlc3QuUGVyZm9ybURyb3BPZmZUaW1lLCBzZXJ2aWNlRGF0ZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIFNjaGVkdWxlU2VydmljZS5zYXZlUGFzdFRyaXAoc2F2ZVRyaXBSZXEpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYXZlZFRyaXAgPSByZXNwb25zZS5kYXRhLnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc2V0Rm9ybSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RTdWNjZXNzKHJlc3BvbnNlLmRhdGEubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblN1Y2Vzc2Z1bGxSZXNlcnZhdGlvbihzYXZlZFRyaXApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RJbmZvKHJlc3BvbnNlLmRhdGEubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmlzU2F2aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoZXJyb3Jtc2cpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcignRXJyb3InLCBlcnJvcm1zZy5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmlzU2F2aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoJHNjb3BlLm1vZGUgPT0gXCJyZXNlcnZhdGlvblwiKSB7XHJcbiAgICAgICAgICAgICAgICBcdC8vIHJlcXVlc3QgZGVtYW5kIHJlc2VydmF0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgU2NoZWR1bGVTZXJ2aWNlLnNjaGVkdWxlcG9zdChzYXZlVHJpcFJlcSlcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVkVHJpcCA9IHJlc3BvbnNlLmRhdGEucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzZXRGb3JtKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdFN1Y2Nlc3MocmVzcG9uc2UuZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uU3VjZXNzZnVsbFJlc2VydmF0aW9uKHNhdmVkVHJpcCwgcGFyc2VJbnQocmVzZXJ2YXRpb25SZXF1ZXN0LnJlc2VydmF0aW9uVHlwZSkgPT0gcmVzZXJ2YXRpb25UeXBlRW51bS5BU0FQKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChyZXNwb25zZS5kYXRhLmVycm9ycyAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgem9uZUV4Y2xJbmRleCA9IC0xO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxvY0V4Y2xJbmRleCA9IC0xO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNhcGFjaXR5RXJyb3IgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuZWdvdGlhdGVkUmVzcG9uc2UgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQuZWFjaChyZXNwb25zZS5kYXRhLmVycm9ycywgZnVuY3Rpb24gKGluZGV4LCB2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlcnJDb2RlID0gdmFsdWUuRXJyb3JDb2RlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vU2hvdyB0aGUgb3Zlci1yaWRlIHBvcC11cFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnJDb2RlID09IC04KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHpvbmVFeGNsSW5kZXggPSBpbmRleDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoZXJyQ29kZSA9PSAtNykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NFeGNsSW5kZXggPSBpbmRleDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoZXJyQ29kZSA9PSA5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhcGFjaXR5RXJyb3IgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChlcnJDb2RlID09IDEwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5lZ290aWF0ZWRSZXNwb25zZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHpvbmVFeGNsSW5kZXggPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dSZXNlcnZhdGlvbkVycm9yTW9kYWwocmVzcG9uc2UuZGF0YS5lcnJvcnNbem9uZUV4Y2xJbmRleF0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvY0V4Y2xJbmRleCA+PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd092ZXJyaWRlTW9kYWwocmVzcG9uc2UuZGF0YS5lcnJvcnNbbG9jRXhjbEluZGV4XSkudGhlbihmdW5jdGlvbiAocmV0VmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGxvY0V4Y2xJbmRleCA+PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd1Jlc2VydmF0aW9uRXJyb3JNb2RhbChyZXNwb25zZS5kYXRhLmVycm9yc1tsb2NFeGNsSW5kZXhdKS50aGVuKGZ1bmN0aW9uIChyZXRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAobmVnb3RpYXRlZFJlc3BvbnNlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hbmFnZU5lZ290aWF0aW9uKHJlc3BvbnNlLCBzYXZlVHJpcFJlcSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChjYXBhY2l0eUVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd1Jlc2VydmF0aW9uRXJyb3JNb2RhbChyZXNwb25zZS5kYXRhLmVycm9yc1swXSwgXCJDYXBhY2l0eSBVbmF2YWlsYWJsZVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoJ0NyZWF0aW5nIFJlc2VydmF0aW9uJywgcmVzcG9uc2UuZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoJ0NyZWF0aW5nIFJlc2VydmF0aW9uJywgcmVzcG9uc2UuZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaXNTYXZpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChlcnJvcm1zZykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKCdFcnJvcicsIGVycm9ybXNnLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaXNTYXZpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmdW5jdGlvbiBkaXNhYmxlU2F2ZUJ1dHRvbigpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBpc1NhdmluZztcclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIG1hbmFnZU5lZ290aWF0aW9uKHJlc3BvbnNlLCB0cmlwUmVxdWVzdCkge1xyXG4gICAgICAgICAgICAgICAgdHJpcFJlcXVlc3QuTmVnb3RpYXRpb25JbmZvID0gdW5kZWZpbmVkO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOZWdvdGlhdGlvbk1vZGFsKHJlc3BvbnNlLmRhdGEsIHRyaXBSZXF1ZXN0KVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChuZWdvdGlhdGVkUmVxdWVzdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNlcnZlTmVnb3RpYXRlZFRyaXAobmVnb3RpYXRlZFJlcXVlc3QsIHRyaXBSZXF1ZXN0KTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiByZXNlcnZlTmVnb3RpYXRlZFRyaXAobmVnb3RpYXRlZFJlcXVlc3QsIHRyaXBSZXF1ZXN0KSB7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKG5lZ290aWF0ZWRSZXF1ZXN0XHJcbiAgICAgICAgICAgICAgICAgICAgJiYgbmVnb3RpYXRlZFJlcXVlc3QuTmVnb3RpYXRpb25JbmZvXHJcbiAgICAgICAgICAgICAgICAgICAgJiYgbmVnb3RpYXRlZFJlcXVlc3QuTmVnb3RpYXRpb25JbmZvLklzTmVnb3RpYXRlZCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB0cmlwUmVxdWVzdC5OZWdvdGlhdGlvbkluZm8gPSBuZWdvdGlhdGVkUmVxdWVzdC5OZWdvdGlhdGlvbkluZm87XHJcbiAgICAgICAgICAgICAgICAgICAgdHJpcFJlcXVlc3QuUmVxdWVzdGVkU3RhcnREYXRlVGltZSA9IG5lZ290aWF0ZWRSZXF1ZXN0Lk5lZ290aWF0aW9uSW5mby5TZWxlY3RlZFRpbWU7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHNjaGVkdWxlTmVnb3RpYXRlZFRyaXAodHJpcFJlcXVlc3QpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBzY2hlZHVsZU5lZ290aWF0ZWRUcmlwKHRyaXBSZXF1ZXN0KSB7XHJcbiAgICAgICAgICAgICAgICBTY2hlZHVsZVNlcnZpY2Uuc2NoZWR1bGVwb3N0KHRyaXBSZXF1ZXN0KVxyXG4gICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNhdmVkVHJpcCA9IHJlc3BvbnNlLmRhdGEucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICByZXNldEZvcm0oKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RTdWNjZXNzKHJlc3BvbnNlLmRhdGEubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uU3VjZXNzZnVsbFJlc2VydmF0aW9uKHNhdmVkVHJpcCwgcGFyc2VJbnQodHJpcFJlcXVlc3QuUmVzZXJ2YXRpb25UeXBlKSA9PSByZXNlcnZhdGlvblR5cGVFbnVtLkFTQVApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoJ0NyZWF0aW5nIFJlc2VydmF0aW9uJywgcmVzcG9uc2UuZGF0YS5tZXNzYWdlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmlzU2F2aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3Jtc2cpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKCdFcnJvcicsIGVycm9ybXNnLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5pc1NhdmluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBkaXNwbGF5TmVnb3RpYXRpb25Nb2RhbChuZWdvdGlhdGlvblJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBuZWdvdGlhdGlvbk1vZGFsID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9tb2R1bGVzL29uLWRlbWFuZC9yZXNlcnZhdGlvbnMvbmVnb3RpYXRpb24tbW9kYWwuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ05lZ290aWF0aW9uQ29udHJvbGxlciBhcyB2bScsXHJcbiAgICAgICAgICAgICAgICAgICAgc2l6ZTogJy1mcycsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZWdvdGlhdGlvblJlcXVlc3Q6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcG9zZWRTbG90czogbmVnb3RpYXRpb25SZXNwb25zZS5yZXN1bHQuUHJvcG9zZWRTbG90cyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNlcnZhdGlvblJlcXVlc3Q6ICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJpcFJlcXVlc3RJZDogbmVnb3RpYXRpb25SZXNwb25zZS5yZXN1bHQudHJpcFJlcXVlc3RJZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXJ2aWNlRGF0ZTogJHNjb3BlLnNlcnZpY2VEYXRlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgbmVnb3RpYXRpb25Nb2RhbC5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLmNhbk5lZ290aWF0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5lZ290aWF0aW9uSW5mbzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIElzTmVnb3RpYXRlZDogZmFsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHJlc3BvbnNlLnNlbGVjdGVkVGltZSAmJiByZXNwb25zZS5jYW5OZWdvdGlhdGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBOZWdvdGlhdGlvbkluZm86IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJc05lZ290aWF0ZWQ6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2VsZWN0ZWRUaW1lOiByZXNwb25zZS5zZWxlY3RlZFRpbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJpcFJlcXVlc3RJZDogcmVzcG9uc2UudHJpcFJlcXVlc3RJZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOZWdvdGlhdGlvbkxvZ0lkOiByZXNwb25zZS5uZWdvdGlhdGlvbkxvZ0lkXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG5cclxuXHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBkaXNhYmxlRmFyaW5nQnV0dG9uKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCEkc2NvcGUuaXNBbGxvd2VkIHx8ICRzY29wZS5pc1NhdmluZylcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LkZyb21Mb2NhdGlvbiA9PSBudWxsIHx8IGFuZ3VsYXIuZXF1YWxzKCRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QuRnJvbUxvY2F0aW9uLCB7fSlcclxuICAgICAgICAgICAgICAgICAgICB8fCAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LlRvTG9jYXRpb24gPT0gbnVsbCB8fCBhbmd1bGFyLmVxdWFscygkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LlRvTG9jYXRpb24sIHt9KSlcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gZGlzcGxheUZhcmluZygpXHJcbiAgICAgICAgICAgIHtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgbW9kYWxPdmVycmlkZSA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgICAgICBhbmltYXRpb246IHRydWUsXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL21vZHVsZXMvb24tZGVtYW5kL2ZhcmluZy9mYXJpbmctbW9kYWwuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0ZhcmluZ01vZGFsQ29udHJvbGxlciBhcyB2bScsXHJcbiAgICAgICAgICAgICAgICAgICAgc2l6ZTogJy1mcycsXHJcbiAgICAgICAgICAgICAgICAgICAgd2luZG93Q2xhc3M6ICdwaG9uZS1tb2RhbC0tZnVsbHNjcmVlbicsXHJcbiAgICAgICAgICAgICAgICAgICAgYmFja2Ryb3A6ICdzdGF0aWMnLFxyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlOiAkc2NvcGUsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNlcnZhdGlvblJlcXVlc3Q6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXJ2aWNlRGF0ZTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRzY29wZS5zZXJ2aWNlRGF0ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIG1vZGFsT3ZlcnJpZGUucmVzdWx0LnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5yZXNlcnZhdGlvblJlcXVlc3QgPSByZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmdW5jdGlvbiBzaG93UmVzZXJ2YXRpb25FcnJvck1vZGFsKG1zZyxoZWFkZXIpIHtcclxuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIG1vZGFsT3ZlcnJpZGUgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL21vZHVsZXMvb24tZGVtYW5kL3Jlc2VydmF0aW9ucy9yZXNlcnZhdGlvbi1tb2RhbC1tZXNzYWdlLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdSZXNlcnZhdGlvbkVycm9yTW9kYWxDb250cm9sbGVyIGFzIHZtJyxcclxuICAgICAgICAgICAgICAgICAgICBzaXplOiAnLWZzJyxcclxuICAgICAgICAgICAgICAgICAgICBiYWNrZHJvcDogJ3N0YXRpYycsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBmdW5jdGlvbiAoKSB7IHJldHVybiB7IG1lc3NhZ2U6IG1zZywgaGVhZGVyOmhlYWRlciB9O31cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBtb2RhbE92ZXJyaWRlLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBzaG93Rml4ZWRSb3V0ZXMoX3VwY29taW5nU2NoZWR1bGVzLCBfZnJvbVN0b3BOYW1lKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBtb2RhbEZSID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9tb2R1bGVzL29uLWRlbWFuZC9yZXNlcnZhdGlvbnMvZml4ZWQtcm91dGVzLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdGaXhlZFJvdXRlc0NvbnRyb2xsZXIgYXMgdm0nLFxyXG4gICAgICAgICAgICAgICAgICAgIHNpemU6ICctZnMnLFxyXG4gICAgICAgICAgICAgICAgICAgIGJhY2tkcm9wOiAnc3RhdGljJyxcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwY29taW5nU2NoZWR1bGVzOiBmdW5jdGlvbiAoKSB7IHJldHVybiBfdXBjb21pbmdTY2hlZHVsZXMgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZnJvbVN0b3BOYW1lOiBmdW5jdGlvbiAoKSB7IHJldHVybiBfZnJvbVN0b3BOYW1lIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBtb2RhbEZSLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAvL2RlZmVycmVkLnJlc29sdmUocmVzdWx0KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiB2YWxpZGF0ZVJlcXVlc3QocmVzZXJ2YXRpb25SZXF1ZXN0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoISRzY29wZS5wYXNzZW5nZXIgfHwgISRzY29wZS5wYXNzZW5nZXIuSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEluZm8oXCJQbGVhc2Ugc2VsZWN0IGEgUGFzc2VuZ2VyXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUucGFzc2VuZ2VyLklzRGVhY3RpdmF0ZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEluZm8oXCJQbGVhc2Ugc2VsZWN0IGFuIEFjdGl2ZSBQYXNzZW5nZXJcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5tb2RlID09ICdyZXNlcnZhdGlvbicpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc2VydmF0aW9uUmVxdWVzdC5Jc0FTQVAgJiYgJHNjb3BlLm9wdGlvbnMuaXNBZHZhbmNlZFJlc2VydmF0aW9uKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc2VydmF0aW9uUmVxdWVzdC5SZXNlcnZhdGlvblRpbWUgfHwgcmVzZXJ2YXRpb25SZXF1ZXN0LlJlc2VydmF0aW9uVGltZSA9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0SW5mbyhcIlBsZWFzZSBlbnRlciBhIHZhbGlkIFJlc2VydmF0aW9uIFRpbWVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGltZVpvbmUgPSBEaXZpc2lvblNlcnZpY2UuZ2V0VGltZVpvbmUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXFfZGF0ZSA9IHJlc2VydmF0aW9uUmVxdWVzdC5SZXNlcnZhdGlvbkRhdGUuZ2V0RGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlcV9tb250aCA9IHJlc2VydmF0aW9uUmVxdWVzdC5SZXNlcnZhdGlvbkRhdGUuZ2V0TW9udGgoKSArIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVxX3llYXIgPSByZXNlcnZhdGlvblJlcXVlc3QuUmVzZXJ2YXRpb25EYXRlLmdldEZ1bGxZZWFyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVxX2lucHV0ID0gcmVxX3llYXIgKyBcIi9cIiArIHJlcV9tb250aCArIFwiL1wiICsgcmVxX2RhdGUgKyBcIiBcIiArIHJlc2VydmF0aW9uUmVxdWVzdC5SZXNlcnZhdGlvblRpbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVxdWVzdERhdGVUaW1lID0gbW9tZW50LnR6KHJlcV9pbnB1dCwgXCJZWVlZL00vRCBISG1tXCIsIHRpbWVab25lKTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgcmVxdWVzdGVkRGF0ZVRpbWUgPSBEYXRlRmFjdG9yeS5nZXREYXRlRnJvbUN1c3RvbVRpbWUocmVzZXJ2YXRpb25SZXF1ZXN0LlJlc2VydmF0aW9uVGltZSwgbW9tZW50KHJlc2VydmF0aW9uUmVxdWVzdC5SZXNlcnZhdGlvbkRhdGUpKTtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnJlbnREYXRlVGltZSA9IG1vbWVudC50eih0aW1lWm9uZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjdXJyZW50RGF0ZVRpbWUgPSBjdXJyZW50RGF0ZVRpbWUuY2xvbmUoKS50eihcIkFtZXJpY2EvU2VhdHRsZVwiKTsvL0RpdmlzaW9uU2VydmljZS5nZXRUaW1lWm9uZSgpKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVxdWVzdERhdGVUaW1lLmlzQmVmb3JlKGN1cnJlbnREYXRlVGltZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEluZm8oXCJQbGVhc2UgZW50ZXIgYSBSZXNlcnZhdGlvbiBUaW1lIHdoaWNoIGlzIGdyZWF0ZXIgdGhhbiB0aGUgY3VycmVudCB0aW1lXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICghcmVzZXJ2YXRpb25SZXF1ZXN0LkZyb21Mb2NhdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0SW5mbyhcIlBsZWFzZSBlbnRlciBhIHZhbGlkIEZyb20gTG9jYXRpb25cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKCFyZXNlcnZhdGlvblJlcXVlc3QuVG9Mb2NhdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0SW5mbyhcIlBsZWFzZSBlbnRlciBhIHZhbGlkIFRvIExvY2F0aW9uXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChyZXNlcnZhdGlvblJlcXVlc3QuRnJvbUxvY2F0aW9uLkdvb2dsZVBsYWNlSWQgJiYgcmVzZXJ2YXRpb25SZXF1ZXN0LlRvTG9jYXRpb24uR29vZ2xlUGxhY2VJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNlcnZhdGlvblJlcXVlc3QuRnJvbUxvY2F0aW9uLkdvb2dsZVBsYWNlSWQgPT0gcmVzZXJ2YXRpb25SZXF1ZXN0LlRvTG9jYXRpb24uR29vZ2xlUGxhY2VJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEluZm8oXCJGcm9tIGFuZCBUbyBsb2NhdGlvbnMgc2hvdWxkIG5vdCBiZSBzYW1lXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzZXJ2YXRpb25SZXF1ZXN0LkZyb21Mb2NhdGlvbi5Mb2NhdGlvbklkICYmIHJlc2VydmF0aW9uUmVxdWVzdC5Ub0xvY2F0aW9uLkxvY2F0aW9uSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc2VydmF0aW9uUmVxdWVzdC5Gcm9tTG9jYXRpb24uTG9jYXRpb25JZCA9PSByZXNlcnZhdGlvblJlcXVlc3QuVG9Mb2NhdGlvbi5Mb2NhdGlvbklkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEluZm8oXCJGcm9tIGFuZCBUbyBsb2NhdGlvbnMgc2hvdWxkIG5vdCBiZSBzYW1lXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy9WYWxpZGF0aW9ucyBmb3IgcmVjb25jaWxpYXRpb25cclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUubW9kZSA9PSBcInJlY29uY2lsaWF0aW9uXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzZXJ2YXRpb25SZXF1ZXN0LlJlc2VydmF0aW9uRGF0ZSA9PSBudWxsIHx8IHJlc2VydmF0aW9uUmVxdWVzdC5SZXNlcnZhdGlvbkRhdGUgPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0SW5mbyhcIlBsZWFzZSBlbnRlciBhIHZhbGlkIFJlc2VydmF0aW9uIERhdGVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXNlcnZhdGlvblJlcXVlc3QuQXJyaXZlUGlja1VwVGltZSB8fCByZXNlcnZhdGlvblJlcXVlc3QuQXJyaXZlUGlja1VwVGltZSA9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RJbmZvKFwiUGxlYXNlIGVudGVyIGEgdmFsaWQgQXJyaXZlIFBpY2tVcFRpbWVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXNlcnZhdGlvblJlcXVlc3QuUGVyZm9ybURyb3BPZmZUaW1lIHx8IHJlc2VydmF0aW9uUmVxdWVzdC5QZXJmb3JtRHJvcE9mZlRpbWUgPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0SW5mbyhcIlBsZWFzZSBlbnRlciBhIHZhbGlkIFBlcmZvcm0gRHJvcE9mZlRpbWVcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc2VydmF0aW9uUmVxdWVzdC5SdW4gPT0gbnVsbCB8fCAhcmVzZXJ2YXRpb25SZXF1ZXN0LlJ1bi5SdW5JZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEluZm8oXCJQbGVhc2Ugc2VsZWN0IGEgUnVuXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZnVuY3Rpb24gem9uZUZvckxvY2F0aW9uKGxvY2F0aW9uLCB0eXBlKVxyXG4gICAgICAgICAgICB7XHJcblxyXG4gICAgICAgICAgICAgICAgRmFyaW5nU2VydmljZVxyXG4gICAgICAgICAgICAgICAgICAgIC5HZXRab25lSURGb3JMb2NhdGlvbihsb2NhdGlvbi5MYXRpdHVkZSwgbG9jYXRpb24uTG9uZ2l0dWRlLCAkc2NvcGUub3B0aW9ucy5EaXZpc2lvbklkKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gJ2Zyb20nKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5mcm9tWm9uZSA9IHJlc3BvbnNlLmRhdGEucmVzdWx0ID09IG51bGwgPyAwOiByZXNwb25zZS5kYXRhLnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC50b1pvbmUgPSByZXNwb25zZS5kYXRhLnJlc3VsdCA9PSBudWxsID8gMCA6IHJlc3BvbnNlLmRhdGEucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yKGVycikge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkTG9jYXRpb25Gcm9tID0gZnVuY3Rpb24gKGxvY2F0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LkZyb21Mb2NhdGlvbiA9IGxvY2F0aW9uO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmlzQWxsb3dlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLm9wdGlvbnMuYWxsb3dSZXNlcnZhdGlvbk9ubHlXaGVuR3BzSXNPbilcclxuICAgICAgICAgICAgICAgICAgICBpc1NlbGVjdGVkTG9jYXRpb25JbkFsbG93ZWRCb29raW5nUmFuZ2UobG9jYXRpb24pO1xyXG5cclxuICAgICAgICAgICAgICAgIHpvbmVGb3JMb2NhdGlvbihsb2NhdGlvbiwgJ2Zyb20nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRMb2NhdGlvblRvID0gZnVuY3Rpb24gKGxvY2F0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucmVzZXJ2YXRpb25SZXF1ZXN0LlRvTG9jYXRpb24gPSBsb2NhdGlvbjtcclxuICAgICAgICAgICAgICAgIHpvbmVGb3JMb2NhdGlvbihsb2NhdGlvbiwgJ3RvJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgJHNjb3BlLiRvbignY2xvc2VzdExvY2F0aW9uJywgZnVuY3Rpb24gKGV2ZW50LCBsb2NhdGlvbikge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uUmVxdWVzdC5Gcm9tTG9jYXRpb24gPSBsb2NhdGlvbi5sb2M7XHJcbiAgICAgICAgICAgICAgICB6b25lRm9yTG9jYXRpb24obG9jYXRpb24ubG9jLCAnZnJvbScpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS4kb24oJ2hvbWVMb2NhdGlvbicsIGZ1bmN0aW9uIChldmVudCwgbG9jYXRpb24pIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZExvY2F0aW9uVG8obG9jYXRpb24pO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGlzU2VsZWN0ZWRMb2NhdGlvbkluQWxsb3dlZEJvb2tpbmdSYW5nZShzZWxlY3RlZExvY2F0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBHZW9Mb2NhdGlvblNlcnZpY2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmdldEN1cnJlbnRQb3NpdGlvbigpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChwb3NpdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBvc2l0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGhkaXN0YW5jZSA9IGdldEhhdmVyc2luZURpc3RhbmNlSW5GZWV0KFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXRpdHVkZTogcG9zaXRpb24uY29vcmRzLmxhdGl0dWRlLCBsb25naXR1ZGU6IHBvc2l0aW9uLmNvb3Jkcy5sb25naXR1ZGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXRpdHVkZTogc2VsZWN0ZWRMb2NhdGlvbi5MYXRpdHVkZSwgbG9uZ2l0dWRlOiBzZWxlY3RlZExvY2F0aW9uLkxvbmdpdHVkZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1heEFsbG93ZWREaXN0YW5jZSA9ICRzY29wZS5vcHRpb25zLm1heFJhZGl1c1RvQWxsb3dCb29raW5nO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGRpc3RhbmNlID4gbWF4QWxsb3dlZERpc3RhbmNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoJ0Nhbm5vdCBib29rIHRyaXAhJywgJ1RoZSBwaWNrdXAgbG9jYXRpb24gbXVzdCBiZSB3aXRoaW4gJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhBbGxvd2VkRGlzdGFuY2UgKyAnIGZlZXQgb2YgeW91ciBjdXJyZW50IGxvY2F0aW9uLicsIDE1MDAwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmlzQWxsb3dlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXRIYXZlcnNpbmVEaXN0YW5jZUluRmVldChjdXJyZW50TG9jYXRpb24sIHNlbGVjdGVkTG9jYXRpb24pIHtcclxuICAgICAgICAgICAgICAgIHZhciBsYXQxID0gY3VycmVudExvY2F0aW9uLmxhdGl0dWRlO1xyXG4gICAgICAgICAgICAgICAgdmFyIGxvbjEgPSBjdXJyZW50TG9jYXRpb24ubG9uZ2l0dWRlO1xyXG4gICAgICAgICAgICAgICAgdmFyIGxhdDIgPSBzZWxlY3RlZExvY2F0aW9uLmxhdGl0dWRlO1xyXG4gICAgICAgICAgICAgICAgdmFyIGxvbjIgPSBzZWxlY3RlZExvY2F0aW9uLmxvbmdpdHVkZVxyXG5cclxuICAgICAgICAgICAgICAgIHZhciBSID0gNjM3MTtcclxuICAgICAgICAgICAgICAgIHZhciB4MSA9IGxhdDIgLSBsYXQxO1xyXG4gICAgICAgICAgICAgICAgdmFyIGRMYXQgPSB4MSAqIE1hdGguUEkgLyAxODA7XHJcbiAgICAgICAgICAgICAgICB2YXIgeDIgPSBsb24yIC0gbG9uMTtcclxuICAgICAgICAgICAgICAgIHZhciBkTG9uID0geDIgKiBNYXRoLlBJIC8gMTgwO1xyXG4gICAgICAgICAgICAgICAgdmFyIGEgPSBNYXRoLnNpbihkTGF0IC8gMikgKiBNYXRoLnNpbihkTGF0IC8gMikgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGguY29zKGxhdDEgKiBNYXRoLlBJIC8gMTgwKSAqIE1hdGguY29zKGxhdDIgKiBNYXRoLlBJIC8gMTgwKSAqXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5zaW4oZExvbiAvIDIpICogTWF0aC5zaW4oZExvbiAvIDIpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGMgPSAyICogTWF0aC5hdGFuMihNYXRoLnNxcnQoYSksIE1hdGguc3FydCgxIC0gYSkpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHAgPSAyICogTWF0aC5hc2luKE1hdGguc3FydChhKSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgZCA9IFIgKiBjICogMC42MjEzNyAqIDUyODA7IC8vY29udmVydCB0byBmZWV0XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gTnVtYmVyKGQpLnRvRml4ZWQoMik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIlxyXG4rKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5kaXJlY3RpdmUoJ3Jlc2VydmF0aW9uTWFwRGlyZWN0aXZlJywgcmVzZXJ2YXRpb25NYXBEaXJlY3RpdmUpO1xyXG5cclxuICAgIHJlc2VydmF0aW9uTWFwRGlyZWN0aXZlLiRpbmplY3QgPSBbJyR3aW5kb3cnLCAnJGh0dHAnLCAnJGZpbHRlcicsICdDb25maWdGYWN0b3J5JywgJ1NjaGVkdWxlU2VydmljZScsICdEYXRlRmFjdG9yeScsICd1aUdtYXBJc1JlYWR5JywgJ1V0aWxpdHlGYWN0b3J5JywgJyRpbnRlcnZhbCddO1xyXG5cclxuICAgIGZ1bmN0aW9uIHJlc2VydmF0aW9uTWFwRGlyZWN0aXZlKCR3aW5kb3csICRodHRwLCAkZmlsdGVyLCBDb25maWdGYWN0b3J5LCBTY2hlZHVsZVNlcnZpY2UsIERhdGVGYWN0b3J5LCB1aUdtYXBJc1JlYWR5LCBVdGlsaXR5RmFjdG9yeSwgJGludGVydmFsKSB7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcclxuICAgICAgICAgICAgbGluazoge1xyXG4gICAgICAgICAgICAgICAgcHJlOiBwcmVMaW5rLFxyXG4gICAgICAgICAgICAgICAgcG9zdDogcG9zdExpbmtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogY29udHJvbGxlcixcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgICAgc2NvcGU6IHsgcGFzc2VuZ2VyOiAnQCcsIHRyaXBSZXF1ZXN0OiAnQCcsIGN1cnJlbnRUcmlwOiAnQCcsIGRpc3BhdGNoU2VsZWN0ZWRSdW5JZDogJ0AnLCBkaXNwYXRjaFNlbGVjdGVkVHJpcDogJ0AnfSxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvbW9kdWxlcy9vbi1kZW1hbmQvcmVzZXJ2YXRpb25zL3Jlc2VydmF0aW9uTWFwLmh0bWwnXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBjb250cm9sbGVyKCRzY29wZSkge1xyXG4gICAgICAgICAgICAkc2NvcGUubWlubGVuZ3RobGltaXQgPSAzO1xyXG4gICAgICAgICAgICAkc2NvcGUubWFwID0ge1xyXG4gICAgICAgICAgICAgICAgY2VudGVyOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGF0aXR1ZGU6IDQwLjY4MDYzOCxcclxuICAgICAgICAgICAgICAgICAgICBsb25naXR1ZGU6IC05OS4yMjg1MTZcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB6b29tOiAxMCxcclxuICAgICAgICAgICAgICAgIGxpbmVTdHlsZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbG9yOiAnIzMzMycsXHJcbiAgICAgICAgICAgICAgICAgICAgd2VpZ2h0OiA1LFxyXG4gICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAuN1xyXG4gICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5zaG93VHJhZmZpYyA9IGZhbHNlO1xyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLmRpc3BhdGNoU2VsZWN0ZWRSdW5JZCAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd1RyYWZmaWMgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICRzY29wZS5tYXBDb250cm9sID0ge307XHJcbiAgICAgICAgICAgICRzY29wZS5tYXBPcHRpb25zID0ge1xyXG4gICAgICAgICAgICAgICAgbWFwVHlwZUNvbnRyb2w6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgem9vbUNvbnRyb2w6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgc3RyZWV0Vmlld0NvbnRyb2w6IGZhbHNlXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHZhciBjdXJyZW50RGl2aXNpb24gPSBcIlwiO1xyXG4gICAgICAgICAgICAkc2NvcGUuc3RvcE1hcmtlciA9IFtdO1xyXG4gICAgICAgICAgICAkc2NvcGUuYWRkcmVzc1Jlc3QgPSBudWxsO1xyXG4gICAgICAgICAgICAkc2NvcGUuc2V0TWFwID0gc2V0TWFwO1xyXG4gICAgICAgICAgICAkc2NvcGUuZ2V0Q3VycmVudEFjdGl2ZVRyaXAgPSBnZXRDdXJyZW50QWN0aXZlVHJpcDtcclxuICAgICAgICAgICAgJHNjb3BlLnNldEN1cnJlbnRUcmlwTWFwID0gc2V0Q3VycmVudFRyaXBNYXA7XHJcbiAgICAgICAgICAgICRzY29wZS5zZXRTZWxlY3RlZFRyaXBNYXAgPSBzZXRTZWxlY3RlZFRyaXBNYXA7XHJcbiAgICAgICAgICAgIC8vJHNjb3BlLnNldE5ld0Rpc3BhdGNoU2VsZWN0ZWRSdW5JZCA9IHNldE5ld0Rpc3BhdGNoU2VsZWN0ZWRSdW5JZDtcclxuICAgICAgICAgICAgJHNjb3BlLmNsZWFyTWFya2VycyA9IGNsZWFyTWFya2VycztcclxuICAgICAgICAgICAgdmFyIGF1dG9SZWZyZXNoTWFya2VyID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAkc2NvcGUudHJpcGlkID0gbnVsbDtcclxuICAgICAgICAgICAgJHNjb3BlLnBhc3NlbmdlcklkID0gbnVsbDtcclxuICAgICAgICAgICAgJHNjb3BlLmFjdGl2ZVRyaXBSdW5JZCA9IG51bGw7XHJcbiAgICAgICAgICAgIHZhciBpc1RyaXBBY3RpdmU7XHJcbiAgICAgICAgICAgIHZhciBpc0NhbmNlbGFibGU7XHJcbiAgICAgICAgICAgICRzY29wZS5wYXNzZW5nZXIgPSB7fTtcclxuICAgICAgICAgICAgJHNjb3BlLnRyaXBSZXF1ZXN0ID0ge307XHJcbiAgICAgICAgICAgICRzY29wZS5jdXJyZW50VHJpcCA9IHt9O1xyXG4gICAgICAgICAgICAkc2NvcGUuZGlzcGF0Y2hTZWxlY3RlZFJ1bklkID0gbnVsbDtcclxuICAgICAgICAgICAgJHNjb3BlLmRpc3BhdGNoU2VsZWN0ZWRUcmlwID0gW107XHJcbiAgICAgICAgICAgICRzY29wZS5hY3RpdmVUcmlwID0gZmFsc2U7XHJcbiAgICAgICAgICAgICRzY29wZS5jYW5jZWxUcmlwID0gZmFsc2U7XHJcbiAgICAgICAgICAgICRzY29wZS5kaXNhYmxlQ2FuY2VsID0gZmFsc2U7XHJcbiAgICAgICAgICAgICRzY29wZS52ZWhpY2xlc01hcmtlckRldGFpbHMgPSBbXTtcclxuICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkVHJpcG1hcmtlckRldGFpbHMgPSBbXTtcclxuICAgICAgICAgICAgJHNjb3BlLmNlbnRlckxhdExvbmc7XHJcbiAgICAgICAgICAgIC8vJHNjb3BlLnBhc3NlbmdlckRldGFpbHMgPSAkc2NvcGUucGFzc2VuZ2VyO1xyXG4gICAgICAgICAgICAvLyBpbnN0YW50aWF0ZSBnb29nbGUgbWFwIG9iamVjdHMgZm9yIGRpcmVjdGlvbnNcclxuICAgICAgICAgICAgdmFyIGRpcmVjdGlvbnNEaXNwbGF5ID0gbmV3IGdvb2dsZS5tYXBzLkRpcmVjdGlvbnNSZW5kZXJlcih7IHN1cHByZXNzTWFya2VyczogdHJ1ZSwgZHJhZ2dhYmxlOiBmYWxzZSB9KTtcclxuICAgICAgICAgICAgdmFyIGRpcmVjdGlvbnNTZXJ2aWNlID0gbmV3IGdvb2dsZS5tYXBzLkRpcmVjdGlvbnNTZXJ2aWNlKCk7XHJcblxyXG4gICAgICAgICAgICBDb25maWdGYWN0b3J5LmdldEN1cnJlbnREaXZpc2lvbigpLnRoZW4oZnVuY3Rpb24gKGRpdmlzaW9uRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudERpdmlzaW9uID0gZGl2aXNpb25EYXRhO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAvL0Vycm9yIGhhbmRsaW5nIFRCRFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHNldFNlbGVjdGVkVHJpcE1hcCgpIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgJHNjb3BlLmRpc3BhdGNoU2VsZWN0ZWRUcmlwLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoJHNjb3BlLmRpc3BhdGNoU2VsZWN0ZWRUcmlwW2ldLlR5cGUgPT0gJ3BpY2t1cCcpXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpY29uID0gJy4uLy4uL2ltYWdlcy9waWNrdXAucG5nJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGljb24gPSAnLi4vLi4vaW1hZ2VzL2Ryb3BvZmYucG5nJztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkVHJpcG1hcmtlckRldGFpbHMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICd0cmlwSWQnOiAkc2NvcGUuZGlzcGF0Y2hTZWxlY3RlZFRyaXBbaV0uVHJpcElELCAnc2NoZWR1bGVUaW1lJzogJHNjb3BlLmRpc3BhdGNoU2VsZWN0ZWRUcmlwW2ldLlNjaGVkVGltZVZpZXcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdsYXRpdHVkZSc6ICRzY29wZS5kaXNwYXRjaFNlbGVjdGVkVHJpcFtpXS5MYXRpdHVkZSwgJ2xvbmdpdHVkZSc6ICRzY29wZS5kaXNwYXRjaFNlbGVjdGVkVHJpcFtpXS5Mb25naXR1ZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdsb2NhdGlvbk5hbWUnOiAkc2NvcGUuZGlzcGF0Y2hTZWxlY3RlZFRyaXBbaV0uTG9hY3Rpb25OYW1lLCAnbG9jYXRpb25BZGRyZXNzJzogJHNjb3BlLmRpc3BhdGNoU2VsZWN0ZWRUcmlwW2ldLkxvYWN0aW9uQWRkcmVzcyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ2ljb24nOiBpY29uXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2YXIgaWNvbiA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHNldEJvdW5kcygpO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgLy9tYXJrZXIgY2xpY2sgZnVuY3Rpb25cclxuICAgICAgICAgICAgJHNjb3BlLnRyaXBNYXJrZXJFdmVudCA9IHtcclxuICAgICAgICAgICAgICAgIGNsaWNrOiBmdW5jdGlvbiAoZ01hcmtlciwgZXZlbnROYW1lLCBtb2RlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChtb2RlbC4kaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRyaXBDb29yZHMgPSBtb2RlbC5jb29yZHM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5zaG93VHJpcCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gc2V0Q3VycmVudFRyaXBNYXAoKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUudHJpcFJlcXVlc3QuRnJvbUxhdCA9ICRzY29wZS5jdXJyZW50VHJpcC5TdGFydEFkZHJlc3NWaWV3TW9kZWwuTGF0aXR1ZGU7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUudHJpcFJlcXVlc3QuRnJvbUxvbmcgPSAkc2NvcGUuY3VycmVudFRyaXAuU3RhcnRBZGRyZXNzVmlld01vZGVsLkxvbmdpdHVkZTtcclxuICAgICAgICAgICAgICAgICRzY29wZS50cmlwUmVxdWVzdC5Ub0xhdCA9ICRzY29wZS5jdXJyZW50VHJpcC5FbmRBZGRyZXNzVmlld01vZGVsLkxhdGl0dWRlO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnRyaXBSZXF1ZXN0LlRvTG9uZyA9ICRzY29wZS5jdXJyZW50VHJpcC5FbmRBZGRyZXNzVmlld01vZGVsLkxvbmdpdHVkZTtcclxuICAgICAgICAgICAgICAgICRzY29wZS50cmlwUmVxdWVzdC50cmlwSWQgPSAkc2NvcGUuY3VycmVudFRyaXAuVHJpcElEO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnRyaXBJZCA9ICRzY29wZS5jdXJyZW50VHJpcC5UcmlwSUQ7XHJcbiAgICAgICAgICAgICAgICBzY2hlZHVsZVRyaXAoJHNjb3BlLnRyaXBSZXF1ZXN0KTtcclxuXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXRDdXJyZW50QWN0aXZlVHJpcCgpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5wYXNzZW5nZXJJZCA9ICRzY29wZS5wYXNzZW5nZXIuSWRcclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUucGFzc2VuZ2VyLklkID09IG51bGwpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcignRXJyb3InLCBlcnJvcm1zZy5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBTY2hlZHVsZVNlcnZpY2UuZ2V0bGFzdHJpcGRldGFpbHMoJHNjb3BlLnBhc3Nlbmdlci5JZClcclxuICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB4ID0gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmFjdGl2ZVRyaXBSdW5JZCA9IHJlc3BvbnNlLmRhdGEucmVzdWx0LlJ1bklEO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUudHJpcFJlcXVlc3QuRnJvbUxhdCA9IChyZXNwb25zZS5kYXRhLnJlc3VsdC5TdGFydEFkZHJlc3NWaWV3TW9kZWwuTGF0aXR1ZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUudHJpcFJlcXVlc3QuRnJvbUxvbmcgPSAocmVzcG9uc2UuZGF0YS5yZXN1bHQuU3RhcnRBZGRyZXNzVmlld01vZGVsLkxvbmdpdHVkZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS50cmlwUmVxdWVzdC5Ub0xhdCA9IChyZXNwb25zZS5kYXRhLnJlc3VsdC5FbmRBZGRyZXNzVmlld01vZGVsLkxhdGl0dWRlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRyaXBSZXF1ZXN0LlRvTG9uZyA9IChyZXNwb25zZS5kYXRhLnJlc3VsdC5FbmRBZGRyZXNzVmlld01vZGVsLkxvbmdpdHVkZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS50cmlwUmVxdWVzdC50cmlwSWQgPSByZXNwb25zZS5kYXRhLnJlc3VsdC5UcmlwSUQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS50cmlwSWQgPSByZXNwb25zZS5kYXRhLnJlc3VsdC5UcmlwSUQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVkdWxlVHJpcCgkc2NvcGUudHJpcFJlcXVlc3QpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9VdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKCdFcnJvcicsIHJlc3BvbnNlLmRhdGEubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS50cmlwSWQgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUudHJpcFJlcXVlc3QuRnJvbSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS50cmlwUmVxdWVzdC5UbyA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5zY2hlZHVsZU1hcmtlcnMgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uc0Rpc3BsYXkuc2V0TWFwKG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcm1zZykge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKCdFcnJvcicsIGVycm9ybXNnLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBzZXRNYXAoKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubWFwID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNlbnRlcjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYXRpdHVkZTogJHNjb3BlLmNlbnRlckxhdGl0dWRlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsb25naXR1ZGU6ICRzY29wZS5jZW50ZXJMb25naXR1ZGVcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHpvb206IDE1LFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5pc0ZsZWV0TWFwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXV0b1JlZnJlc2hNYXJrZXIgPSAkaW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRGbGVldE1hcmtlcnMoKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCA1MDAwKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHNjaGVkdWxlVHJpcCgkc2NvcGUudHJpcFJlcXVlc3QpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9ICAgICAgICAgICBcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHNjaGVkdWxlVHJpcCh0cmlwUmVxdWVzdCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNjaGVkdWxlTWFya2VycyA9IFtdO1xyXG5cclxuICAgICAgICAgICAgICAgIGRpcmVjdGlvbnNEaXNwbGF5LnNldE1hcCgkc2NvcGUubWFwQ29udHJvbC5nZXRHTWFwKCkpO1xyXG5cclxuICAgICAgICAgICAgICAgICRzY29wZS5zY2hlZHVsZU1hcmtlcnMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgJ2xhdGl0dWRlJzogdHJpcFJlcXVlc3QuRnJvbUxhdCwgJ2xvbmdpdHVkZSc6IHRyaXBSZXF1ZXN0LkZyb21Mb25nLFxyXG4gICAgICAgICAgICAgICAgICAgICdpY29uJzogJy4uLy4uL2ltYWdlcy9waWNrdXAucG5nJywgJ3RyaXBJZCc6ICRzY29wZS50cmlwUmVxdWVzdC50cmlwSWRcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNjaGVkdWxlTWFya2Vycy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAnbGF0aXR1ZGUnOiB0cmlwUmVxdWVzdC5Ub0xhdCwgJ2xvbmdpdHVkZSc6IHRyaXBSZXF1ZXN0LlRvTG9uZyxcclxuICAgICAgICAgICAgICAgICAgICAnaWNvbic6ICcuLi8uLi9pbWFnZXMvZHJvcG9mZi5wbmcnLCAndHJpcElkJzogJHNjb3BlLnRyaXBSZXF1ZXN0LnRyaXBJZFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHJlcXVlc3QgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb3JpZ2luOiBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKHRyaXBSZXF1ZXN0LkZyb21MYXQsIHRyaXBSZXF1ZXN0LkZyb21Mb25nKSxcclxuICAgICAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbjogbmV3IGdvb2dsZS5tYXBzLkxhdExuZyh0cmlwUmVxdWVzdC5Ub0xhdCwgdHJpcFJlcXVlc3QuVG9Mb25nKSxcclxuICAgICAgICAgICAgICAgICAgICB0cmF2ZWxNb2RlOiBnb29nbGUubWFwcy5EaXJlY3Rpb25zVHJhdmVsTW9kZS5EUklWSU5HXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgZGlyZWN0aW9uc1NlcnZpY2Uucm91dGUocmVxdWVzdCwgZnVuY3Rpb24gKHJlc3BvbnNlLCBzdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09PSBnb29nbGUubWFwcy5EaXJlY3Rpb25zU3RhdHVzLk9LKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbnNEaXNwbGF5LnNldERpcmVjdGlvbnMocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2RpcmVjdGlvbnNEaXNwbGF5LnNldFBhbmVsKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaXJlY3Rpb25zTGlzdCcpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8kc2NvcGUuZGlyZWN0aW9ucy5zaG93TGlzdCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldEJvdW5kcygpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5hbGVydCgnRGlyZWN0aW9ucyByZXF1ZXN0IGZhaWxlZCBkdWUgdG8gJyArIHN0YXR1cyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICB1aUdtYXBJc1JlYWR5LnByb21pc2UoKS50aGVuKGZ1bmN0aW9uIChtYXBzKSB7XHJcbiAgICAgICAgICAgICAgICBnb29nbGUubWFwcy5ldmVudC50cmlnZ2VyKCRzY29wZS5tYXBDb250cm9sLmdldEdNYXAoKSwgXCJyZXNpemVcIik7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBzZXRCb3VuZHMoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYm91bmRzID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZ0JvdW5kcygpO1xyXG5cclxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCgkc2NvcGUuc2VsZWN0ZWRUcmlwbWFya2VyRGV0YWlscywgZnVuY3Rpb24gKHN0b3ApIHtcclxuICAgICAgICAgICAgICAgICAgICBib3VuZHMuZXh0ZW5kKG5ldyBnb29nbGUubWFwcy5MYXRMbmcoc3RvcC5sYXRpdHVkZSwgc3RvcC5sb25naXR1ZGUpKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICRzY29wZS5tYXBDb250cm9sLmdldEdNYXAoKS5maXRCb3VuZHMoYm91bmRzKTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGNsZWFyTWFya2VycygpIHsgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICRzY29wZS52ZWhpY2xlc01hcmtlckRldGFpbHMgPSBbXTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHNldEZsZWV0TWFya2VycygpIHtcclxuICAgICAgICAgICAgICAgIGNsZWFyTWFya2VycygpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGxhdCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB2YXIgbG9uZyA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS50cmlwSWQgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIFNjaGVkdWxlU2VydmljZS5nZXREcml2ZXJHUFMoJHNjb3BlLnRyaXBJZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmFjdGl2ZVRyaXBSdW5JZCA9IHJlc3BvbnNlLmRhdGEuUnVuSWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNUcmlwQWN0aXZlID0gcmVzcG9uc2UuZGF0YS5Jc1RyaXBBY3RpdmVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzVHJpcEFjdGl2ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGFzc2VuZ2VySWQgPSAkc2NvcGUucGFzc2VuZ2VySWRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2NoZWR1bGVTZXJ2aWNlLmdldGxhc3RyaXBkZXRhaWxzKCRzY29wZS5wYXNzZW5nZXJJZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUudHJpcFJlcXVlc3QuRnJvbSA9IHJlc3BvbnNlLmRhdGEucmVzdWx0LlN0YXJ0QWRkcmVzc1ZpZXdNb2RlbC5BZGRyZXNzMSArICcsICcgKyByZXNwb25zZS5kYXRhLnJlc3VsdC5TdGFydEFkZHJlc3NWaWV3TW9kZWwuQ2l0eSArICcsICcgKyByZXNwb25zZS5kYXRhLnJlc3VsdC5TdGFydEFkZHJlc3NWaWV3TW9kZWwuWmlwQ29kZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUudHJpcFJlcXVlc3QuVG8gPSByZXNwb25zZS5kYXRhLnJlc3VsdC5FbmRBZGRyZXNzVmlld01vZGVsLkFkZHJlc3MxICsgJywgJyArIHJlc3BvbnNlLmRhdGEucmVzdWx0LkVuZEFkZHJlc3NWaWV3TW9kZWwuQ2l0eSArICcsICcgKyByZXNwb25zZS5kYXRhLnJlc3VsdC5FbmRBZGRyZXNzVmlld01vZGVsLlppcENvZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRyaXBSZXF1ZXN0LkZyb21MYXQgPSAocmVzcG9uc2UuZGF0YS5yZXN1bHQuU3RhcnRBZGRyZXNzVmlld01vZGVsLkxhdGl0dWRlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUudHJpcFJlcXVlc3QuRnJvbUxvbmcgPSAocmVzcG9uc2UuZGF0YS5yZXN1bHQuU3RhcnRBZGRyZXNzVmlld01vZGVsLkxvbmdpdHVkZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRyaXBSZXF1ZXN0LlRvTGF0ID0gKHJlc3BvbnNlLmRhdGEucmVzdWx0LkVuZEFkZHJlc3NWaWV3TW9kZWwuTGF0aXR1ZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS50cmlwUmVxdWVzdC5Ub0xvbmcgPSAocmVzcG9uc2UuZGF0YS5yZXN1bHQuRW5kQWRkcmVzc1ZpZXdNb2RlbC5Mb25naXR1ZGUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYWN0aXZlVHJpcCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNhbmNlbFRyaXAgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUudHJpcElkID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQuVHJpcElEO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS50cmlwUmVxdWVzdC5TaHV0dGxlID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQuVmVoaWNsZU5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRyaXBSZXF1ZXN0LlJ1bk5hbWUgPSByZXNwb25zZS5kYXRhLnJlc3VsdC5SdW5OYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS50cmlwUmVxdWVzdC5TdGFydFRpbWUgPSByZXNwb25zZS5kYXRhLnJlc3VsdC5Fc3RpbWF0ZWRQaWNrdXBUaW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS50cmlwUmVxdWVzdC5FbmRUaW1lID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQuRXN0aW1hdGVkRGVzdGluYXRpb25UaW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5kaXNhYmxlQ2FuY2VsID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NoZWR1bGVUcmlwKCRzY29wZS50cmlwUmVxdWVzdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUudHJpcElkID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUudHJpcFJlcXVlc3QuRnJvbSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRyaXBSZXF1ZXN0LlRvID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYWN0aXZlVHJpcCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5jYW5jZWxUcmlwID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuc2NoZWR1bGVNYXJrZXJzID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uc0Rpc3BsYXkuc2V0TWFwKG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vc3RvcEF1dG9SZWZyZXNoTWFya2VyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy93aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3Jtc2cpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKCdFcnJvcicsIGVycm9ybXNnLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzQ2FuY2VsYWJsZSA9IHJlc3BvbnNlLmRhdGEuSXNDYW5jZWxhYmxlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaXNDYW5jZWxhYmxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGlzYWJsZUNhbmNlbCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9ybXNnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuZGlzcGF0Y2hTZWxlY3RlZFJ1bklkICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgU2NoZWR1bGVTZXJ2aWNlLmdldEFjdGl2ZVJ1bnMoY3VycmVudERpdmlzaW9uLkRpdmlzaW9uSUQsIG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVzcG9uc2UuZGF0YS5yZXN1bHQubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZ2V0QWN0aXZlUnVucyA9IHJlc3BvbnNlLmRhdGEucmVzdWx0W2ldXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuZ2V0QWN0aXZlUnVucy5SdW5JZCA9PSAkc2NvcGUuZGlzcGF0Y2hTZWxlY3RlZFJ1bklkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuZ2V0QWN0aXZlUnVucy5MYXRlc3RWZWhpY2xlTGF0aXR1ZGUgIT0gbnVsbCAmICRzY29wZS5nZXRBY3RpdmVSdW5zLkxhdGVzdFZlaGljbGVMb25naXR1ZGUgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGljb24gPSAnLi4vLi4vaW1hZ2VzL1ZlaGljbGVDdXJyZW50VHJpcC5wbmcnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUudmVoaWNsZXNNYXJrZXJEZXRhaWxzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd2ZWhpY2xlTmFtZSc6ICRzY29wZS5nZXRBY3RpdmVSdW5zLlZlaGljbGVOYW1lLCAnZHJpdmVyTmFtZSc6ICRzY29wZS5nZXRBY3RpdmVSdW5zLkRyaXZlck5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xhdGl0dWRlJzogJHNjb3BlLmdldEFjdGl2ZVJ1bnMuTGF0ZXN0VmVoaWNsZUxhdGl0dWRlLCAnbG9uZ2l0dWRlJzogJHNjb3BlLmdldEFjdGl2ZVJ1bnMuTGF0ZXN0VmVoaWNsZUxvbmdpdHVkZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncnVuTmFtZSc6ICRzY29wZS5nZXRBY3RpdmVSdW5zLlJ1bk5hbWUsICdydW5JZCc6ICRzY29wZS5nZXRBY3RpdmVSdW5zLlJ1bklkLCAnaWNvbic6IGljb25cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcignRXJyb3InLCAkc2NvcGUucmV0dXJuTXNnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcm1zZykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKCdFcnJvcicsICRzY29wZS5yZXR1cm5Nc2cpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgU2NoZWR1bGVTZXJ2aWNlLmdldEFjdGl2ZVJ1bnMoY3VycmVudERpdmlzaW9uLkRpdmlzaW9uSUQsIG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVzcG9uc2UuZGF0YS5yZXN1bHQubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZ2V0QWN0aXZlUnVucyA9IHJlc3BvbnNlLmRhdGEucmVzdWx0W2ldO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmdldEFjdGl2ZVJ1bnMuTGF0ZXN0VmVoaWNsZUxhdGl0dWRlICE9IG51bGwgJiAkc2NvcGUuZ2V0QWN0aXZlUnVucy5MYXRlc3RWZWhpY2xlTG9uZ2l0dWRlICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmFjdGl2ZVRyaXBSdW5JZCAhPSBudWxsICYmICRzY29wZS5nZXRBY3RpdmVSdW5zLlJ1bklkID09ICRzY29wZS5hY3RpdmVUcmlwUnVuSWQgJiYgaXNUcmlwQWN0aXZlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWNvbiA9ICcuLi8uLi9pbWFnZXMvVmVoaWNsZUN1cnJlbnRUcmlwLnBuZydcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS52ZWhpY2xlc01hcmtlckRldGFpbHMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3ZlaGljbGVOYW1lJzogJHNjb3BlLmdldEFjdGl2ZVJ1bnMuVmVoaWNsZU5hbWUsICdkcml2ZXJOYW1lJzogJHNjb3BlLmdldEFjdGl2ZVJ1bnMuRHJpdmVyTmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbGF0aXR1ZGUnOiAkc2NvcGUuZ2V0QWN0aXZlUnVucy5MYXRlc3RWZWhpY2xlTGF0aXR1ZGUsICdsb25naXR1ZGUnOiAkc2NvcGUuZ2V0QWN0aXZlUnVucy5MYXRlc3RWZWhpY2xlTG9uZ2l0dWRlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdydW5OYW1lJzogJHNjb3BlLmdldEFjdGl2ZVJ1bnMuUnVuTmFtZSwgJ3J1bklkJzogJHNjb3BlLmdldEFjdGl2ZVJ1bnMuUnVuSWQsICdpY29uJzogaWNvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoJHNjb3BlLmdldEFjdGl2ZVJ1bnMuRHJpdmVySWQgIT0gbnVsbCAmJiAkc2NvcGUuZ2V0QWN0aXZlUnVucy5WZWhpY2xlSWQgIT0gbnVsbCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc2NvcGUuZ2V0QWN0aXZlUnVucy5OdW1PZkFjdGl2ZVRyaXBzID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpY29uID0gJy4uLy4uL2ltYWdlcy9WZWhpY2xlQWN0aXZlVHJpcHMucG5nJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS52ZWhpY2xlc01hcmtlckRldGFpbHMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd2ZWhpY2xlTmFtZSc6ICRzY29wZS5nZXRBY3RpdmVSdW5zLlZlaGljbGVOYW1lLCAnZHJpdmVyTmFtZSc6ICRzY29wZS5nZXRBY3RpdmVSdW5zLkRyaXZlck5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdsYXRpdHVkZSc6ICRzY29wZS5nZXRBY3RpdmVSdW5zLkxhdGVzdFZlaGljbGVMYXRpdHVkZSwgJ2xvbmdpdHVkZSc6ICRzY29wZS5nZXRBY3RpdmVSdW5zLkxhdGVzdFZlaGljbGVMb25naXR1ZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdydW5OYW1lJzogJHNjb3BlLmdldEFjdGl2ZVJ1bnMuUnVuTmFtZSwgJ3J1bklkJzogJHNjb3BlLmdldEFjdGl2ZVJ1bnMuUnVuSWQsICdpY29uJzogaWNvblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGljb24gPSAnLi4vLi4vaW1hZ2VzL1ZlaGljbGVOb1RyaXBzLnBuZydcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUudmVoaWNsZXNNYXJrZXJEZXRhaWxzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAndmVoaWNsZU5hbWUnOiAkc2NvcGUuZ2V0QWN0aXZlUnVucy5WZWhpY2xlTmFtZSwgJ2RyaXZlck5hbWUnOiAkc2NvcGUuZ2V0QWN0aXZlUnVucy5Ecml2ZXJOYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnbGF0aXR1ZGUnOiAkc2NvcGUuZ2V0QWN0aXZlUnVucy5MYXRlc3RWZWhpY2xlTGF0aXR1ZGUsICdsb25naXR1ZGUnOiAkc2NvcGUuZ2V0QWN0aXZlUnVucy5MYXRlc3RWZWhpY2xlTG9uZ2l0dWRlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncnVuTmFtZSc6ICRzY29wZS5nZXRBY3RpdmVSdW5zLlJ1bk5hbWUsICdydW5JZCc6ICRzY29wZS5nZXRBY3RpdmVSdW5zLlJ1bklkLCAnaWNvbic6IGljb25cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vRG8gbm90aGluZ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcignRXJyb3InLCAkc2NvcGUucmV0dXJuTXNnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcm1zZykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKCdFcnJvcicsICRzY29wZS5yZXR1cm5Nc2cpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAvL21hcmtlciBjbGljayBmdW5jdGlvblxyXG4gICAgICAgICAgICAkc2NvcGUubWFya2VyRXZlbnQgPSB7XHJcbiAgICAgICAgICAgICAgICBjbGljazogZnVuY3Rpb24gKGdNYXJrZXIsIGV2ZW50TmFtZSwgbW9kZWwpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobW9kZWwuJGlkKSB7ICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5jb29yZHMgPSBtb2RlbC5jb29yZHM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5zaG93ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBzdG9wQXV0b1JlZnJlc2hNYXJrZXIoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoYW5ndWxhci5pc0RlZmluZWQoYXV0b1JlZnJlc2hNYXJrZXIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJGludGVydmFsLmNhbmNlbChhdXRvUmVmcmVzaE1hcmtlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgYXV0b1JlZnJlc2hNYXJrZXIgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgc3RvcEF1dG9SZWZyZXNoTWFya2VyKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHByZUxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgIFNjaGVkdWxlU2VydmljZS5nZXRTZXJ2aWNlQXJlYUxvY2F0aW9uKClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmNlbnRlckxhdGl0dWRlID0gcmVzcG9uc2UuZGF0YS5MYXRpdHVkZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuY2VudGVyTG9uZ2l0dWRlID0gcmVzcG9uc2UuZGF0YS5Mb25naXR1ZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmFkZHJlc3NSZXN0ID0gcmVzcG9uc2UuZGF0YS5BZGRyZXNzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL0xvY2F0aW9uRmFjdG9yeS5zZXRhZGQoJHNjb3BlLmFkZHJlc3NSZXN0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9zY29wZS5tYXBDZW50ZXIubGF0aXR1ZGUgPSBsYXRpdHVkZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9zY29wZS5tYXBDZW50ZXIubG9uZ2l0dWRlID0gbG9uZ2l0dWRlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLnRyaXBSZXF1ZXN0Lmxlbmd0aCA+IDApe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBzY29wZS50cmlwUmVxdWVzdCA9PSBcInN0cmluZ1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnRyaXBSZXF1ZXN0ID0gSlNPTi5wYXJzZShzY29wZS50cmlwUmVxdWVzdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5pc0ZsZWV0TWFwID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmlzRmxlZXRNYXAgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnNldE1hcCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9VdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKCdFcnJvcicsICRzY29wZS5yZXR1cm5Nc2cpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcm1zZykge1xyXG4gICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoJ0Vycm9yJywgJHNjb3BlLnJldHVybk1zZyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcG9zdExpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaChcImN1cnJlbnRUcmlwXCIsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSAhPT0gb2xkVmFsdWUgJiYgbmV3VmFsdWUgIT0gJycpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG5ld1ZhbHVlID09IFwic3RyaW5nXCIpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5jdXJyZW50VHJpcCA9IEpTT04ucGFyc2UobmV3VmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgbmV3VmFsdWUgPT0gXCJvYmplY3RcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5jdXJyZW50VHJpcCA9IG5ld1ZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5zZXRDdXJyZW50VHJpcE1hcCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBzY29wZS4kd2F0Y2goXCJwYXNzZW5nZXJcIiwgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlICE9PSBvbGRWYWx1ZSAmJiBuZXdWYWx1ZSAhPSAnJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbmV3VmFsdWUgPT0gXCJzdHJpbmdcIilcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnBhc3NlbmdlciA9IEpTT04ucGFyc2UobmV3VmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgbmV3VmFsdWUgPT0gXCJvYmplY3RcIilcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnBhc3NlbmdlciA9IG5ld1ZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5nZXRDdXJyZW50QWN0aXZlVHJpcCgpXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBzY29wZS4kd2F0Y2goXCJkaXNwYXRjaFNlbGVjdGVkUnVuSWRcIiwgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlICE9PSBvbGRWYWx1ZSAmJiBuZXdWYWx1ZSAhPSAnJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbmV3VmFsdWUgPT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5kaXNwYXRjaFNlbGVjdGVkUnVuSWQgPSBKU09OLnBhcnNlKG5ld1ZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuY2xlYXJNYXJrZXJzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnNlbGVjdGVkVHJpcG1hcmtlckRldGFpbHMgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIG5ld1ZhbHVlID09IFwib2JqZWN0XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuZGlzcGF0Y2hTZWxlY3RlZFJ1bklkID0gbmV3VmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vc2NvcGUuc2V0TmV3RGlzcGF0Y2hTZWxlY3RlZFJ1bklkKClcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaChcImRpc3BhdGNoU2VsZWN0ZWRUcmlwXCIsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChuZXdWYWx1ZSAhPT0gb2xkVmFsdWUgJiYgbmV3VmFsdWUgIT0gJycpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG5ld1ZhbHVlID09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuZGlzcGF0Y2hTZWxlY3RlZFRyaXAgPSBKU09OLnBhcnNlKG5ld1ZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2VsZWN0ZWRUcmlwbWFya2VyRGV0YWlscyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgbmV3VmFsdWUgPT0gXCJvYmplY3RcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5zZWxlY3RlZFRyaXBtYXJrZXJEZXRhaWxzID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmRpc3BhdGNoU2VsZWN0ZWRUcmlwID0gbmV3VmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnNldFNlbGVjdGVkVHJpcE1hcCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgXHJcbiAgICB9XHJcblxyXG59KSgpO1xyXG5cclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdSZXNlcnZhdGlvbnNDb250cm9sbGVyJyxcclxuXHRcdFsnJGxvY2F0aW9uJywgJyRzY29wZScsICckc3RhdGUnLCAnJHRpbWVvdXQnLCAnJHdpbmRvdycsICckdWliTW9kYWwnLFxyXG4gICAgICAgICAnQ29uZmlnRmFjdG9yeScsICdTY2hlZHVsZVNlcnZpY2UnLCAndWlHbWFwSXNSZWFkeScsICdEaXZpc2lvblNlcnZpY2UnLCAnTWVzc2FnZUJveCcsXHJcbiAgICAgICAgICdVdGlsaXR5RmFjdG9yeScsICdhdXRoU2VydmljZScsICdHZW9Mb2NhdGlvblNlcnZpY2UnLCAnTG9jYXRpb25GYWN0b3J5JywgJ1JlZGlyZWN0aW9uU2VydmljZScsICdQcm9maWxlU2VydmljZScsICdnb29nbGVNYXBzQ29uZmlnJyxcclxuICAgICAgICAgJ1BhZ2VTZXJ2aWNlJyxcclxuICAgICAgICAgIHJlc2VydmF0aW9uc0NvbnRyb2xsZXJdXHJcbiAgICAgICAgKTtcclxuXHJcbiAgICBmdW5jdGlvbiByZXNlcnZhdGlvbnNDb250cm9sbGVyXHJcblx0XHQoJGxvY2F0aW9uLCAkc2NvcGUsICRzdGF0ZSwgJHRpbWVvdXQsICR3aW5kb3csICR1aWJNb2RhbCxcclxuICAgICAgICBDb25maWdGYWN0b3J5LCBTY2hlZHVsZVNlcnZpY2UsIHVpR21hcElzUmVhZHksIERpdmlzaW9uU2VydmljZSwgTWVzc2FnZUJveCxcclxuXHRcdFV0aWxpdHlGYWN0b3J5LCBhdXRoU2VydmljZSwgR2VvTG9jYXRpb25TZXJ2aWNlLCBMb2NhdGlvbkZhY3RvcnksIFJlZGlyZWN0aW9uU2VydmljZSwgUHJvZmlsZVNlcnZpY2UsIGdvb2dsZU1hcHNDb25maWdcclxuICAgICAgICAsUGFnZVNlcnZpY2UpIHtcclxuXHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICBQYWdlU2VydmljZS5zZXRUaXRsZSgnTmV3IFJlc2VydmF0aW9uJyk7XHJcbiAgICAgICAgUGFnZVNlcnZpY2Uuc2V0SGVhZGxpbmUoJ09uIERlbWFuZCcpO1xyXG4gICAgICAgIHZtLnJlc2VydmF0aW9uUmVxdWVzdCA9IHt9O1xyXG4gICAgICAgIHZtLnJlc2VydmF0aW9uUmVxdWVzdC5SZXNlcnZhdGlvbkRhdGUgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgIHZtLm1pbkRhdGUgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgIHZtLm1heERhdGVBbGxvd2VkID0gbmV3IERhdGUoMjAxNywgMiwgMjgpO1xyXG5cclxuICAgICAgICB2bS5jdXJyZW50UGFzc2VuZ2VyID0geyBcIklkXCI6IGF1dGhTZXJ2aWNlLmF1dGhlbnRpY2F0aW9uLnBhc3NlbmdlcklkIH07XHJcbiAgICAgICAgdmFyIG9wZXJhdG9ySWQgPSBudWxsO1xyXG4gICAgICAgIHZtLnVzZXJSZXNlcnZhdGlvbk9wdGlvbnMgPSB7fTtcclxuICAgICAgICB2bS5oYXNBY3RpdmVUcmlwID0gZmFsc2U7XHJcbiAgICAgICAgdm0uaGFzRnV0dXJlVHJpcHMgPSBmYWxzZTtcclxuICAgICAgICB2bS5wb3NpdGlvbiA9IG51bGw7XHJcbiAgICAgICAgdm0ucmVzZXJ2YXRpb25UeXBlID0gJ2N1cnJlbnQnO1xyXG4gICAgICAgIHZhciBkaXZpc2lvbklkID0gJyc7XHJcbiAgICAgICAgdm0uaG9tZVBhc3NlbmdlcklkID0gbnVsbDtcclxuXHJcbiAgICAgICAgdmFyIGNsb3Nlc3RQaW4sIG90aGVyUGluLCBsb2NhdGlvblBpbiwgbXlMb2NhdGlvblBpbiwgaHViSWNvbjtcclxuICAgICAgICBpZiAoJHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXCJUcmlkZW50XCIpID4gMCB8fCAkd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcIk1TSUVcIikgPiAwKSB7XHJcbiAgICAgICAgICAgIG15TG9jYXRpb25QaW4gPSAnaW1hZ2VzL3Bpbi1teS1sb2NhdGlvbi5wbmcnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgbXlMb2NhdGlvblBpbiA9ICdpbWFnZXMvcGluLW15LWxvY2F0aW9uLnN2Zyc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgZ2V0QWN0aXZlVHJpcCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgU2NoZWR1bGVTZXJ2aWNlLmdldGxhc3RyaXBkZXRhaWxzKHZtLmN1cnJlbnRQYXNzZW5nZXIuSWQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT09IDEgJiYgcmVzcG9uc2UuZGF0YS5yZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uaGFzQWN0aXZlVHJpcCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgU2NoZWR1bGVTZXJ2aWNlLnRyaXBzRm9yU2VydmljZURhdGUodm0uY3VycmVudFBhc3Nlbmdlci5JZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihyZXNwb25zZS5kYXRhLnN0YXR1cyA9PT0gMSAmJiByZXNwb25zZS5kYXRhLnJlc3VsdClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5yZXN1bHQubGVuZ3RoID4gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uaGFzRnV0dXJlVHJpcHMgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uaGFzRnV0dXJlVHJpcHMgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIC8vY2hlY2sgY3VycmVudCB0aW1lIGFuZCBzZWUgaWYgdGhlIHdpbmRvdyBpcyBpbiB0aGUgZnV0dXJlIFxyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmhhc0FjdGl2ZVRyaXAgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5oYXNGdXR1cmVUcmlwcyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBwb3B1bGF0ZURpdmlzaW9uUGFyYW1ldGVycygpIHtcclxuICAgICAgICAgICAgZ2V0QWN0aXZlVHJpcCgpO1xyXG5cclxuICAgICAgICAgICAgdm0udXNlclJlc2VydmF0aW9uT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgIERpdmlzaW9uSWQ6IGRpdmlzaW9uSWQsXHJcbiAgICAgICAgICAgICAgICBPcGVyYXRvcklkOiBvcGVyYXRvcklkXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIENvbmZpZ0ZhY3RvcnkuZ2V0RGl2aXNpb25QYXJhbWV0ZXJzKGRpdmlzaW9uSWQpXHJcbiAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChwYXJhbXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJhbXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHZtLnVzZXJSZXNlcnZhdGlvbk9wdGlvbnM7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMucGFzc2VuZ2Vyc0xpbWl0ID0gcGFyYW1zLlBhc3NlbmdlcnNMaW1pdCA/IGV2YWwocGFyYW1zLlBhc3NlbmdlcnNMaW1pdCkgOiA1O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYWxsb3dXaWxsQ2FsbCA9IHBhcmFtcy5BbGxvd1dpbGxDYWxsID8gZXZhbChwYXJhbXMuQWxsb3dXaWxsQ2FsbC50b0xvd2VyQ2FzZSgpKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYWxsb3dQYXNzZW5nZXJXaWxsQ2FsbCA9IHBhcmFtcy5BbGxvd1Bhc3NlbmdlcldpbGxDYWxsID8gZXZhbChwYXJhbXMuQWxsb3dQYXNzZW5nZXJXaWxsQ2FsbC50b0xvd2VyQ2FzZSgpKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYWxsb3dFcXVpcG1lbnQgPSBwYXJhbXMuQWxsb3dFcXVpcG1lbnQgPyBldmFsKHBhcmFtcy5BbGxvd0VxdWlwbWVudC50b0xvd2VyQ2FzZSgpKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuaXNBZHZhbmNlZFJlc2VydmF0aW9uID0gcGFyYW1zLkFsbG93QWR2YW5jZWRSZXNlcnZhdGlvbiA/IGV2YWwocGFyYW1zLkFsbG93QWR2YW5jZWRSZXNlcnZhdGlvbi50b0xvd2VyQ2FzZSgpKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYWxsb3dNdWx0aXBsZVNlYXRCb29raW5nID0gcGFyYW1zLkFsbG93TXVsdGlwbGVTZWF0Qm9va2luZyA/IGV2YWwocGFyYW1zLkFsbG93TXVsdGlwbGVTZWF0Qm9va2luZy50b0xvd2VyQ2FzZSgpKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuaXNXaGVlbENoYWlyID0gcGFyYW1zLkhhc1doZWVsQ2hhaXIgPyBldmFsKHBhcmFtcy5IYXNXaGVlbENoYWlyLnRvTG93ZXJDYXNlKCkpIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5pc0NvbXBhbmlvbiA9IHBhcmFtcy5IYXNDb21wYW5pb25zID8gZXZhbChwYXJhbXMuSGFzQ29tcGFuaW9ucy50b0xvd2VyQ2FzZSgpKSA6IGZhbHNlO1xyXG5cdFx0XHRcdFx0XHRcdCBvcHRpb25zLmNvbXBhbmlvbnNMaW1pdCA9IHBhcmFtcy5IYXNDb21wYW5pb25zID09IGZhbHNlID8gMDogcGFyYW1zLkNvbXBhbmlvbnNMaW1pdCA/IGV2YWwocGFyYW1zLkNvbXBhbmlvbnNMaW1pdCk6IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5pc1BDQSA9IHBhcmFtcy5IYXNQQ0EgPyBldmFsKHBhcmFtcy5IYXNQQ0EudG9Mb3dlckNhc2UoKSkgOiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmlzU2VydmljZUFuaW1hbCA9IHBhcmFtcy5IYXNTZXJ2aWNlQW5pbWFsID8gZXZhbChwYXJhbXMuSGFzU2VydmljZUFuaW1hbC50b0xvd2VyQ2FzZSgpKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYWxsb3dDdXN0b21Mb2NhdGlvbiA9IHBhcmFtcy5BbGxvd0N1c3RvbUxvY2F0aW9uID8gZXZhbChwYXJhbXMuQWxsb3dDdXN0b21Mb2NhdGlvbi50b0xvd2VyQ2FzZSgpKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMucHJvbWlzZVdpbmRvdyA9IHBhcmFtcy5Qcm9taXNlV2luZG93ID8gZXZhbChwYXJhbXMuUHJvbWlzZVdpbmRvdykgOiAxMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnJlc2VydmF0aW9uVHlwZSA9IHZtLnJlc2VydmF0aW9uVHlwZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmFsbG93T25seVNhbWVEYXlBZHZSZXMgPSBwYXJhbXMuQWxsb3dPbmx5U2FtZURheUFkdlJlcyA/IGV2YWwocGFyYW1zLkFsbG93T25seVNhbWVEYXlBZHZSZXMudG9Mb3dlckNhc2UoKSkgOiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmRyb3BvZmZIb21lTG9jYXRpb25Pbmx5ID0gcGFyYW1zLkRyb3BvZmZIb21lTG9jYXRpb25Pbmx5ID8gZXZhbChwYXJhbXMuRHJvcG9mZkhvbWVMb2NhdGlvbk9ubHkudG9Mb3dlckNhc2UoKSkgOiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmhvbWVQYXNzZW5nZXJJZCA9IG9wdGlvbnMuZHJvcG9mZkhvbWVMb2NhdGlvbk9ubHkgPyB2bS5jdXJyZW50UGFzc2VuZ2VyLklkIDogbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmNoZWNrRlJCZWZvcmVEUlQgPSBwYXJhbXMuQ2hlY2tGUkJlZm9yZURSVCA/IGV2YWwocGFyYW1zLkNoZWNrRlJCZWZvcmVEUlQudG9Mb3dlckNhc2UoKSkgOiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLm5vT2ZGUkFycml2YWxzID0gcGFyYW1zLk5vT2ZGUkFycml2YWxzID8gZXZhbChwYXJhbXMuTm9PZkZSQXJyaXZhbHMpIDogMztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmFsbG93QVNBUFJlc2VydmF0aW9ucyA9IHBhcmFtcy5BbGxvd0FTQVBSZXNlcnZhdGlvbnMgPyBldmFsKHBhcmFtcy5BbGxvd0FTQVBSZXNlcnZhdGlvbnMpIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5hbGxvd0FwcG9pbnRtZW50cyA9IHBhcmFtcy5BbGxvd0FwcG9pbnRtZW50cyA/IGV2YWwocGFyYW1zLkFsbG93QXBwb2ludG1lbnRzKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYWxsb3dMb2NhdGlvbk5vdGVzID0gcGFyYW1zLkFsbG93TG9jYXRpb25Ob3RlcyA/IGV2YWwocGFyYW1zLkFsbG93TG9jYXRpb25Ob3RlcykgOiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmFsbG93UmVzZXJ2YXRpb25Pbmx5V2hlbkdwc0lzT24gPSBwYXJhbXMuQWxsb3dCb29raW5nSWZmR3BzSXNPbiA/IGV2YWwocGFyYW1zLkFsbG93Qm9va2luZ0lmZkdwc0lzT24pIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5tYXhSYWRpdXNUb0FsbG93Qm9va2luZyA9IHBhcmFtcy5NYXhSYWRpdXNUb0FsbG93Qm9va2luZyA/IGV2YWwocGFyYW1zLk1heFJhZGl1c1RvQWxsb3dCb29raW5nKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYWxsb3dGYXJpbmcgPSBwYXJhbXMuQWxsb3dGYXJpbmcgPyBldmFsKHBhcmFtcy5BbGxvd0ZhcmluZykgOiBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5zYW1lRGF5UmVzTG93ZXJCb3VuZCA9IHBhcmFtcy5TYW1lRGF5UmVzTG93ZXJCb3VuZCA/IHBhcmFtcy5TYW1lRGF5UmVzTG93ZXJCb3VuZCA6IFwiMDA6MDBcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnNhbWVEYXlSZXNVcHBlckJvdW5kID0gcGFyYW1zLlNhbWVEYXlSZXNVcHBlckJvdW5kID8gcGFyYW1zLlNhbWVEYXlSZXNVcHBlckJvdW5kIDogXCIyNDowMFwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZnV0dXJlUmVzTG93ZXJCb3VuZCA9IHBhcmFtcy5GdXR1cmVSZXNMb3dlckJvdW5kID8gcGFyYW1zLkZ1dHVyZVJlc0xvd2VyQm91bmQgOiBcIjAwOjAwXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5mdXR1cmVSZXNVcHBlckJvdW5kID0gcGFyYW1zLkZ1dHVyZVJlc1VwcGVyQm91bmQgPyBwYXJhbXMuRnV0dXJlUmVzVXBwZXJCb3VuZCA6IFwiMjQ6MDBcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmFsbG93Q2hpbGRyZW4gPSBwYXJhbXMuQWxsb3dDaGlsZHJlbiA/IGV2YWwocGFyYW1zLkFsbG93Q2hpbGRyZW4pIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5jaGlsZHJlbkxpbWl0ID0gcGFyYW1zLkNoaWxkcmVuTGltaXQgPyBldmFsKHBhcmFtcy5DaGlsZHJlbkxpbWl0KSA6IDM7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnJlc2VydmF0aW9uRm9ybU9wdGlvbnMgPSBvcHRpb25zO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgIFx0IC8vIHVzZSBUTyBob21lIGxvY2F0aW9uIGlmIHByZXNlbnRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5kcm9wb2ZmSG9tZUxvY2F0aW9uT25seSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIFx0JHRpbWVvdXQoZ2V0RGVzdGluYXRpb25Ib21lTG9jYXRpb24sIDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9leHRyYSBvcHRpb25zIG9ubHkgbmVlZGVkIGJ5IHVzZXIgcmVzZXJ2YXRpb25zIGRpcmVjdGl2ZS5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmlzUGFzc2VuZ2VyID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmlzUmVhZE9ubHkgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYXV0b1JlZnJlc2ggPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYmF0Y2hEYXlzID0gcGFyYW1zLkJhdGNoRGF5cyA/IGV2YWwocGFyYW1zLkJhdGNoRGF5cykgOiA3O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMubWluRnJvbURheXMgPSBwYXJhbXMuTWluRnJvbURheXMgPyBldmFsKHBhcmFtcy5NaW5Gcm9tRGF5cykgOiAzMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnBhc3NlbmdlckJvb2tpbmdNaW5EYXlzID0gcGFyYW1zLlBhc3NlbmdlckJvb2tpbmdNaW5EYXlzID8gZXZhbChwYXJhbXMuUGFzc2VuZ2VyQm9va2luZ01pbkRheXMpIDogMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnBhc3NlbmdlckJvb2tpbmdNYXhEYXlzID0gcGFyYW1zLlBhc3NlbmdlckJvb2tpbmdNYXhEYXlzID8gZXZhbChwYXJhbXMuUGFzc2VuZ2VyQm9va2luZ01heERheXMpIDogMTQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0ucmVzZXJ2YXRpb25Gb3JtT3B0aW9ucyA9IG9wdGlvbnM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcignRXJyb3InLCByZXNwb25zZS5kYXRhLlJldHVybk1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGdldE1hcCgpO1xyXG5cdFx0fVxyXG5cclxuICAgICAgICB2bS5vblJlc2VydmF0aW9uU3VjY2VzcyA9IGZ1bmN0aW9uICh0cmlwLCBpc0FTQVApIHtcclxuICAgICAgICAgICAgdm0uYWRkZWRUcmlwID0gdHJpcDsgLy9oZXJlIHdlIGNhbiBkaXNwbGF5IGEgdHJpcCBvbiBvdXIgZXhpc3RpbmcgbWFwXHJcbiAgICAgICAgICAgIGlmIChpc0FTQVApXHJcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnb24tZGVtYW5kL2FjdGl2ZS10cmlwJyk7XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmFyIHNjaGVkdWxlVHJpcERpc3BsYXkgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL21vZHVsZXMvb24tZGVtYW5kL3Jlc2VydmF0aW9ucy9kaXNwbGF5VHJpcC1tb2RhbC5odG1sJyxcclxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnRGlzcGxheVNjaGVkdWxlZFRyaXBDb250cm9sbGVyIGFzIHZtJyxcclxuICAgICAgICAgICAgICAgICAgICBzaXplOiAnJyxcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyaXA6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cmlwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zIDpmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZtLnJlc2VydmF0aW9uRm9ybU9wdGlvbnM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHNjaGVkdWxlVHJpcERpc3BsYXkucmVzdWx0LnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vbG9hZE1hc3RlclJ1bnMoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgLy9vcGVuIG1vZGFsXHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uc2hvd01hcCA9ZmFsc2U7XHJcbiAgICAgICB2bS56b29tID0gMTU7XHJcbiAgICAgICAgdm0uY2VudGVyID0ge1xyXG4gICAgICAgIGxhdGl0dWRlOiAzOS44MDk4NjAsXHJcbiAgICAgICAgICAgIGxvbmdpdHVkZTogLTk4LjU1NTE4M1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgdm0ubXlTdHlsZXMgPSBnb29nbGVNYXBzQ29uZmlnLm1hcFN0eWxlcztcclxuICAgICAgICB2bS5tYXBPcHRpb25zID0ge1xyXG4gICAgICAgICAgICBtYXBUeXBlQ29udHJvbDogZmFsc2UsXHJcbiAgICAgICAgICAgIHpvb21Db250cm9sOiBmYWxzZSxcclxuICAgICAgICAgICAgc3RyZWV0Vmlld0NvbnRyb2w6IGZhbHNlLFxyXG4gICAgICAgICAgICBzdHlsZXM6IHZtLm15U3R5bGVzXHJcblxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdm0ubXlMb2NhdGlvbkljb24gPSB7XHJcbiAgICAgICAgICAgIHVybDogbXlMb2NhdGlvblBpbixcclxuICAgICAgICAgICAgc2l6ZTogbmV3IGdvb2dsZS5tYXBzLlNpemUoNDIsIDQyKSxcclxuICAgICAgICAgICAgb3JpZ2luOiBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQoMCwgMCksXHJcbiAgICAgICAgICAgIGFuY2hvcjogbmV3IGdvb2dsZS5tYXBzLlBvaW50KDIwLCAyMClcclxuICAgICAgICB9O1xyXG4gICAgICAgIHZtLm1hcENvbnRyb2wgPSB7fTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0TWFwKCkge1xyXG4gICAgICAgICAgICB1aUdtYXBJc1JlYWR5LnByb21pc2UoKS50aGVuKGZ1bmN0aW9uIChtYXBzKSB7XHJcbiAgICAgICAgICAgICAgICBTY2hlZHVsZVNlcnZpY2UuZ2V0U2VydmljZUFyZWFMb2NhdGlvbihkaXZpc2lvbklkKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmNlbnRlci5sYXRpdHVkZSA9IHJlc3BvbnNlLmRhdGEucmVzdWx0LkxhdGl0dWRlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5jZW50ZXIubG9uZ2l0dWRlID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQuTG9uZ2l0dWRlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5yZXN1bHQuWm9vbUxldmVsICE9PSB1bmRlZmluZWQgJiYgcmVzcG9uc2UuZGF0YS5yZXN1bHQuWm9vbUxldmVsICE9PSBudWxsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJiYgcmVzcG9uc2UuZGF0YS5yZXN1bHQuWm9vbUxldmVsICE9ICcnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS56b29tID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQuWm9vbUxldmVsO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB2bS5zaG93TWFwID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBHZW9Mb2NhdGlvblNlcnZpY2UuZ2V0Q3VycmVudFBvc2l0aW9uKCkudGhlbihmdW5jdGlvbiAocG9zaXRpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5wb3NpdGlvbiA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJjb29yZHNcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJMYXRpdHVkZVwiOiBwb3NpdGlvbi5jb29yZHMubGF0aXR1ZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIkxvbmdpdHVkZVwiOiBwb3NpdGlvbi5jb29yZHMubG9uZ2l0dWRlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiaWNvblwiOiB2bS5teUxvY2F0aW9uSWNvblxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vaGVyZSBnZXQgY2xvc2VzdCBsb2NhdGlvblxyXG4gICAgICAgICAgICAgICAgICAgIExvY2F0aW9uRmFjdG9yeS5nZXRMb2NhdGlvbnMoJycsICdmYWxzZScsIGRpdmlzaW9uSWQpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIFx0dmFyIGZpbHRlcmVkUmVzdWx0cyA9IGFuZ3VsYXIuY29weShyZXN1bHQuZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgXHR2YXIgZmlsdGVyZWRSZXN1bHQgPSBMb2NhdGlvbkZhY3RvcnkuZmluZENsb3Nlc3RMb2NhdGlvbih2bS5wb3NpdGlvbi5jb29yZHMsIGZpbHRlcmVkUmVzdWx0cyk7XHJcbiAgICAgICAgICAgICAgICAgICAgXHQvL3Nob3cgc2VsZWN0ZWQgbG9jYXRpb24gaWZmIHRoZSBjdXJyZW50IGdwcyBpcyB3aXRoaW4gMzAwIGZ0IG9mIGEgYnVpbGRpbmdcclxuICAgICAgICAgICAgICAgICAgICBcdC8vMSBtaWxlIH49IDUyODAgZnRcclxuICAgICAgICAgICAgICAgICAgICBcdGlmIChmaWx0ZXJlZFJlc3VsdCAmJiBwYXJzZUZsb2F0KGZpbHRlcmVkUmVzdWx0LmRpc3RhbmNlKSAqIDUyODAgPD0gMzAwKVxyXG4gICAgICAgICAgICAgICAgICAgIFx0XHQkc2NvcGUuJGJyb2FkY2FzdCgnY2xvc2VzdExvY2F0aW9uJywgZmlsdGVyZWRSZXN1bHQpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBcdC8vIGdldCBkZXN0aW5hdGlvbiBIb21lIGxvY2F0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vcG9zaXRpb24gZXJyb3JcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblx0XHRcclxuICAgICAgICBmdW5jdGlvbiBnZXREZXN0aW5hdGlvbkhvbWVMb2NhdGlvbigpIHtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgXHRQcm9maWxlU2VydmljZS5HZXRIb21lQWRkcmVzcyh2bS5jdXJyZW50UGFzc2VuZ2VyLklkKVxyXG5cdFx0XHRcdC50aGVuKGZ1bmN0aW9uIChob21lQWRkcmVzcykge1xyXG5cdFx0XHRcdFx0JHNjb3BlLiRicm9hZGNhc3QoJ2hvbWVMb2NhdGlvbkRpc2FibGUnLCB0cnVlKTtcclxuXHRcdFx0XHRcdGlmIChob21lQWRkcmVzcykge1xyXG5cdFx0XHRcdFx0ICAgIC8vIHNldCBUTyBhZGRyZXNzIHRvIHRoZSBob21lIGFkZHJlc3NcclxuXHRcdFx0XHRcdFx0dm0ucmVzZXJ2YXRpb25SZXF1ZXN0LlRvTG9jYXRpb24gPSBob21lQWRkcmVzcztcclxuXHRcdFx0XHRcdFx0dmFyIHRvQWRkcmVzc0Rpc3BsYXkgPSAoaG9tZUFkZHJlc3MuTmFtZSB8fCAnJykgKyBcIiBcIiArIChob21lQWRkcmVzcy5BZGRyZXNzIHx8ICcnKSArIFwiIFwiICsgKGhvbWVBZGRyZXNzLkNpdHkgfHwgJycpICsgXCIgXCIgKyAoaG9tZUFkZHJlc3MuWmlwIHx8ICcnKTtcclxuXHRcdFx0XHRcdCAgICAvL1xyXG5cdFx0XHRcdFx0ICAgIC8vIE9uIHNsb3cgY2VsbCBjb25uZWN0aW9ucywgdGhpcyBnZXRzIGJyb2FkY2FzdCBiZWZvcmUgcmVzZXJ2YXRpb25Gb3JtRGlyZWN0aXZlLmpzIGdldHMgbG9hZGVkLlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBTbyB0aGUgaG9tZSBhZGRyZXNzIGlzIE5FVkVSIERJU1BMQVlFRCEhISAgWW91IGNhbiB0ZXN0IHRoaXMgYnkgdGhyb3R0bGluZyBjb25uZWN0aW9uIGF0IDIwMDAga2JzLlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBuZWVkIHRvICRicm9hZGNhc3QgYWZ0ZXIgd2FpdGluZyA0IHNlY29uZHMuXHJcblx0XHRcdFx0XHQgICAgLy9cclxuXHRcdFx0XHRcdFx0JHNjb3BlLiRicm9hZGNhc3QoJ2hvbWVMb2NhdGlvbicsIGhvbWVBZGRyZXNzKTtcclxuXHRcdFx0XHRcdFx0JHNjb3BlLiRicm9hZGNhc3QoJ2hvbWVMb2NhdGlvblRleHQnLCB0b0FkZHJlc3NEaXNwbGF5KTtcclxuXHRcdFx0XHRcdFx0JHRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdFx0XHQgICAgJHNjb3BlLiRicm9hZGNhc3QoJ2hvbWVMb2NhdGlvbicsIGhvbWVBZGRyZXNzKTtcclxuXHRcdFx0XHRcdFx0ICAgICRzY29wZS4kYnJvYWRjYXN0KCdob21lTG9jYXRpb25UZXh0JywgdG9BZGRyZXNzRGlzcGxheSk7XHJcblx0XHRcdFx0XHRcdCAgICAkc2NvcGUuJGJyb2FkY2FzdCgnaG9tZUxvY2F0aW9uRGlzYWJsZScsIHRydWUpO1xyXG5cdFx0XHRcdFx0XHR9LCA0MDAwKVxyXG5cdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0Ly8gYXNrIHBhc3NlbmdlciB0byBjcmVhdGUgYSBob21lIGFkZHJlc3NcclxuXHRcdFx0XHRcdFx0dmFyIGRpdmlzaW9uUGFyYW1ldGVycyA9IERpdmlzaW9uU2VydmljZS5nZXRTeXN0ZW1QYXJhbWV0ZXJzKCk7XHJcblx0XHRcdFx0XHRcdGlmICghIGRpdmlzaW9uUGFyYW1ldGVycy5Ecm9wb2ZmSG9tZUxvY2F0aW9uRWRpdCkge1xyXG5cdFx0XHRcdFx0XHRcdC8vIGdldCBoZWxwIHBob25lIG51bWJlclxyXG5cdFx0XHRcdFx0XHRcdHZhciBoZWxwUGhvbmUgPSBEaXZpc2lvblNlcnZpY2UuZ2V0U3VwcG9ydFBob25lTnVtYmVyKCk7XHJcblx0XHRcdFx0XHRcdFx0dmFyIG1lc3NhZ2UgPSBcIlBsZWFzZSBjYWxsIEhlbHAgZGVzayBhdCBcIiArIGhlbHBQaG9uZSArIFwiIGFuZCBhc2sgdGhlbSB0byBjcmVhdGUgYSBIb21lIEFkZHJlc3MgZm9yIHlvdS5cIjtcclxuXHRcdFx0XHRcdFx0XHRNZXNzYWdlQm94LmluZm8oJ0hvbWUgQWRkcmVzcyBpcyBSZXF1aXJlZCcsIG1lc3NhZ2UpLnRoZW4oZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0JHdpbmRvdy5oaXN0b3J5LmJhY2soKTtcclxuXHRcdFx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHRcdFx0XHQvLyBwYXNzZW5nZXIgaGFzIG5vdCBzZXQgaGlzIGhvbWUgbG9jYXRpb24sIGFuZCBtYXkgZWRpdCBpdCwgc28gc2hvdyBob21lIGFkZHJlc3MgZWRpdG9yIGFzIGEgbW9kYWxcclxuXHRcdFx0XHRcdFx0XHQkdWliTW9kYWwub3Blbih7XHJcblx0XHRcdFx0XHRcdFx0XHRhbmltYXRpb246IHRydWUsXHJcblx0XHRcdFx0XHRcdFx0XHRiYWNrZHJvcDogZmFsc2UsXHJcblx0XHRcdFx0XHRcdFx0XHR0ZW1wbGF0ZVVybDogJ2FwcC9tb2R1bGVzL3NoYXJlZC9wcm9maWxlL2hvbWUtYWRkcmVzcy1tb2RhbC5odG1sJyxcclxuXHRcdFx0XHRcdFx0XHRcdGNvbnRyb2xsZXI6IGZ1bmN0aW9uICgpIHsgfSxcclxuXHRcdFx0XHRcdFx0XHRcdHNpemU6ICcnXHJcblx0XHRcdFx0XHRcdFx0fSkuY2xvc2VkLnRoZW4oZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0Ly8gaG9tZSBhZGRyZXNzIHdhcyBjaGFuZ2VkIC0gcmVsb2FkIHRoZSBwYWdlXHJcblx0XHRcdFx0XHRcdFx0XHQkc3RhdGUucmVsb2FkKCk7XHJcblx0XHRcdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9LFxyXG5cdFx0XHRcdGZ1bmN0aW9uIChlcnIpIHtcclxuXHRcdFx0XHQgICAgY29uc29sZS5sb2coJ0Vycm9yIGdldHRpbmcgaG9tZSBsb2NhdGlvbicpO1xyXG5cdFx0XHRcdCAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG5cdFx0XHRcdH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgaWYgKCFhdXRoU2VydmljZS5pc0xvZ2dlZEluKCkpIHtcclxuICAgICAgICAgICAgICAgIFJlZGlyZWN0aW9uU2VydmljZS5zYXZlKCcvb24tZGVtYW5kL3Jlc2VydmF0aW9ucycpO1xyXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJ2xvZ2luJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBkaXZpc2lvbklkID0gRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKTtcclxuICAgICAgICAgICAgICAgIGlmIChkaXZpc2lvbklkICE9IG51bGwgJiYgZGl2aXNpb25JZCAhPSB1bmRlZmluZWQgJiYgZGl2aXNpb25JZCAhPSAnJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjayAmJiB0eXBlb2YgY2FsbGJhY2sgPT09IFwiZnVuY3Rpb25cIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnZGFzaGJvYXJkLycpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBhY3RpdmF0ZShwb3B1bGF0ZURpdmlzaW9uUGFyYW1ldGVycyk7XHJcblxyXG4gICAgICAgIC8vIFN0YXJ0IG9mIGNvZGUgZm9yIElvbmljXHJcbiAgICAgICAgdm0uaW9uaWNJbmNsdWRlID0gJ2FwcC9tb2R1bGVzL29uLWRlbWFuZC9yZXNlcnZhdGlvbnMvcmVzZXJ2YXRpb25zLmh0bWwnO1xyXG4gICAgICAgIHZtLmlvbmljQ3VzdG9tQ2xhc3NOYW1lID0gJyc7XHJcbiAgICAgICAgdm0uZGlzYWJsZVNjcm9sbCA9IHRydWU7XHJcbiAgICAgICAgdm0uaW9uaWNIaWRlTmF2QmFyID0gZmFsc2U7XHJcbiAgICAgICAgdm0uaW9uaWNVc2VSZWZyZXNoZXIgPSBmYWxzZTtcclxuICAgICAgICAvLyBFbmQgb2YgY29kZSBmb3IgSW9uaWNcclxuXHJcbiAgICB9O1xyXG5cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgLy9kZWJ1Z2dlcjtcclxuXHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ29uZU1WQXBwJykuZmFjdG9yeSgnU2NoZWR1bGVTZXJ2aWNlJywgU2NoZWR1bGVTZXJ2aWNlKTtcclxuICAgIFNjaGVkdWxlU2VydmljZS4kaW5qZWN0ID0gWyckaHR0cCcsICckcScsICdDb25maWdGYWN0b3J5JywgJ2F1dGhTZXJ2aWNlJywgJ2VudicsICdsb2NhbFN0b3JhZ2VTZXJ2aWNlJywgJyRyb290U2NvcGUnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBTY2hlZHVsZVNlcnZpY2UoJGh0dHAsICRxLCBDb25maWdGYWN0b3J5LCBhdXRoU2VydmljZSwgZW52LCBsb2NhbFN0b3JhZ2VTZXJ2aWNlLCAkcm9vdFNjb3BlKSB7XHJcbiAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICBnZXRDdXJyZW50VXNlcjogZ2V0Q3VycmVudFVzZXIsXHJcbiAgICAgICAgZ2V0UGFzc2RhdGFsbDogZ2V0UGFzc2RhdGFsbCxcclxuICAgICAgICBnZXRwYXNzZW5nZXI6IGdldHBhc3NlbmdlcixcclxuICAgICAgICBzY2hlZHVsZXBvc3Q6IHNjaGVkdWxlcG9zdCxcclxuICAgICAgICBjYW5jZWxwb3N0OiBjYW5jZWxwb3N0LFxyXG4gICAgICAgIGdldGxhc3RyaXBkZXRhaWxzOiBnZXRsYXN0cmlwZGV0YWlscyxcclxuICAgICAgICB1cGRhdGVFbWFpbFBob25lYW5kQWRkcmVzczogdXBkYXRlRW1haWxQaG9uZWFuZEFkZHJlc3MsXHJcbiAgICAgICAgZ2V0QWN0aXZlUnVuczogZ2V0QWN0aXZlUnVucyxcclxuICAgICAgICBnZXRTZXJ2aWNlQXJlYUxvY2F0aW9uOiBnZXRTZXJ2aWNlQXJlYUxvY2F0aW9uLFxyXG4gICAgICAgIGdldERyaXZlckdQUzogZ2V0RHJpdmVyR1BTLFxyXG4gICAgICAgIGdldFNlYXJjaFBhc3NhbmdlcjogZ2V0U2VhcmNoUGFzc2FuZ2VyLFxyXG4gICAgICAgIGdldFBhc3RSdW5zOiBnZXRQYXN0UnVucyxcclxuICAgICAgICBzYXZlUGFzdFRyaXA6IHNhdmVQYXN0VHJpcCxcclxuICAgICAgICBnZXRQYXNzZW5nZXJUcmlwczogZ2V0UGFzc2VuZ2VyVHJpcHMsXHJcbiAgICAgICAgZ2V0U2VydmljZURhdGVCeURpdmlzaW9uOiBnZXRTZXJ2aWNlRGF0ZUJ5RGl2aXNpb24sXHJcbiAgICAgICAgZ2V0U3RhdGVzOiBnZXRTdGF0ZXMsXHJcbiAgICAgICAgc2VhcmNoUGFzc2VuZ2VyOiBzZWFyY2hQYXNzZW5nZXIsXHJcbiAgICAgICAgdHJpcHNGb3JTZXJ2aWNlRGF0ZTogdHJpcHNGb3JTZXJ2aWNlRGF0ZSxcclxuICAgICAgICBnZXRUcmlwQ2FuY2VsU3RhdHVzTGlzdDogZ2V0VHJpcENhbmNlbFN0YXR1c0xpc3RcclxuICAgIH07XHJcbiAgICByZXR1cm4gc2VydmljZTtcclxuICAgIHZhciB2YWx1ZTtcclxuXHJcblxyXG4gICAgZnVuY3Rpb24gdHJpcHNGb3JTZXJ2aWNlRGF0ZShwYXNzZW5nZXJJZCkge1xyXG4gICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcblxyXG4gICAgICAgIHZhciB1cmwgPSBlbnYub25lTVZBcGlVcmwgICsgJ3Bhc3Nlbmdlci8nICsgcGFzc2VuZ2VySWQgKyAnL3RyaXBzRm9yU2VydmljZURhdGUnO1xyXG5cclxuICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgIHVybDogdXJsICsgJz9ybmQ9JyArIG5ldyBEYXRlKCkuZ2V0VGltZSgpLFxyXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgfTtcclxuXHJcblxyXG4gICAgZnVuY3Rpb24gc2VhcmNoUGFzc2VuZ2VyKGRpdmlzaW9uSW5mbywgcGFzc2VuZ2VySWQpIHtcclxuICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG5cclxuICAgICAgICBDb25maWdGYWN0b3J5LmdldE9uZU1WQXBpVVJMUHJvbWlzZSgpLnRoZW4oZnVuY3Rpb24gKG9uZU1WVVJMKSB7XHJcbiAgICAgICAgICAgIHZhciB1cmwgPSBvbmVNVlVSTCArIFwicGFzc2VuZ2VyL3NlYXJjaC9cIiArIHBhc3NlbmdlcklkO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgdXJsOiB1cmwgKyAnP3JuZD0nICsgbmV3IERhdGUoKS5nZXRUaW1lKCksXHJcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyb3IpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgfTtcclxuXHJcblxyXG4gICAgZnVuY3Rpb24gZ2V0U3RhdGVzKCkge1xyXG4gICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICB1cmw6ICcuLi9QYXNzZW5nZXIvZ2V0U3RhdGVzP3JuZD0nICsgbmV3IERhdGUoKS5nZXRUaW1lKCksXHJcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgIH07XHJcblxyXG4gICAgZnVuY3Rpb24gZ2V0Q3VycmVudFVzZXIoKSB7XHJcbiAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAvL2dldCB0aGUgYmFzZSB1cmwgZnJvbSBjb25maWcuXHJcbiAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSAnLi4vT3BlcmF0aW9uL0dldEN1cnJlbnRVc2VyJztcclxuICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICd1cmwnOiBzZXJ2aWNlVXJsXHJcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgfTtcclxuXHJcbiAgICBmdW5jdGlvbiBnZXRQYXNzZGF0YWxsKCkge1xyXG4gICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgLy9nZXQgdGhlIGJhc2UgdXJsIGZyb20gY29uZmlnLlxyXG4gICAgICAgIHZhciBzZXJ2aWNlVXJsID0gJy4uL1Bhc3Nlbmdlci9nZXRwYXNzRGF0YWF1dG8/cm5kPScgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcclxuICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICd1cmwnOiBzZXJ2aWNlVXJsXHJcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgfTtcclxuXHJcbiAgICBmdW5jdGlvbiBnZXRwYXNzZW5nZXIocGFzc2VuZ2VySWQpIHtcclxuICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgIC8vZ2V0IHRoZSBiYXNlIHVybCBmcm9tIGNvbmZpZy5cclxuICAgICAgICB2YXIgc2VydmljZVVybCA9ICcuLi9QYXNzZW5nZXIvR2V0UGFzc0RldGFpbEJ5UGFzc0lkP3JuZD0nICsgbmV3IERhdGUoKS5nZXRUaW1lKCk7XHJcbiAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAndXJsJzogc2VydmljZVVybCxcclxuICAgICAgICAgICAgcGFyYW1zOiB7IFBhc3NlbmdlcklkOiBwYXNzZW5nZXJJZCB9LFxyXG4gICAgICAgICAgICBkYXRhVHlwZTogXCJqc29uXCIsXHJcbiAgICAgICAgICAgIGNvbnRlbnRUeXBlOiBcImFwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLThcIlxyXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycilcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgIH07XHJcbiAgICBmdW5jdGlvbiBnZXRQYXNzZW5nZXJUcmlwcyhkaXZpc2lvbklkLCBwYXNzZW5nZXJJZCwgZnJvbURhdGUsIHRvRGF0ZSkge1xyXG4gICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgQ29uZmlnRmFjdG9yeS5nZXRPbmVNVkFwaVVSTFByb21pc2UoKS50aGVuKGZ1bmN0aW9uIChvbmVNVlVSTCkge1xyXG4gICAgICAgICAgICBpZiAob25lTVZVUkwgJiYgb25lTVZVUkwgIT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgLy9nZXQgdGhlIGJhc2UgdXJsIGZyb20gY29uZmlnLlxyXG4gICAgICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBvbmVNVlVSTCArICdwYXNzZW5nZXIvJyArIHBhc3NlbmdlcklkICsnL3RyaXBzLycgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyb21EYXRlICsgJy8nICsgdG9EYXRlICsgJz9ybmQ9JyArIG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICAgICAgJ3VybCc6IHNlcnZpY2VVcmwsXHJcbiAgICAgICAgICAgICAgICAgICAgLy9kYXRhOiBKU09OLnN0cmluZ2lmeShwYXNzZW5nZXJUcmlwUGFyYW0pLFxyXG4gICAgICAgICAgICAgICAgICAgIENvbnRlbnRUeXBlOiBcImFwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLThcIlxyXG4gICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkbG9nLmVycm9yKCdFcnJvcjogLSBDb3VsZCBub3QgZmV0Y2ggc2VydmljZSBhcGkgdXJsJylcclxuICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoXCJDb3VsZCBub3QgZmV0Y2ggc2VydmljZSBhcGkgdXJsXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICB9O1xyXG5cclxuICAgIGZ1bmN0aW9uIHNjaGVkdWxlcG9zdChzY2hlZHVsZVRyaXBSZXFwYXJhbSkge1xyXG4gICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgQ29uZmlnRmFjdG9yeS5nZXRPbmVNVkFwaVVSTFByb21pc2UoKS50aGVuKGZ1bmN0aW9uIChvbmVNVlVSTCkge1xyXG4gICAgICAgICAgICBpZiAob25lTVZVUkwgJiYgb25lTVZVUkwgIT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgLy9nZXQgdGhlIGJhc2UgdXJsIGZyb20gY29uZmlnLlxyXG4gICAgICAgICAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSBvbmVNVlVSTCArICdwYXNzZW5nZXIvJyArIHNjaGVkdWxlVHJpcFJlcXBhcmFtLlBhc3NlbmdlcklEICsgJy90cmlwL3NjaGVkdWxlJztcclxuICAgICAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgICAgICAgICAndXJsJzogc2VydmljZVVybCxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShzY2hlZHVsZVRyaXBSZXFwYXJhbSksXHJcbiAgICAgICAgICAgICAgICAgICAgQ29udGVudFR5cGU6IFwiYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOFwiXHJcbiAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRsb2cuZXJyb3IoJ0Vycm9yOiAtIENvdWxkIG5vdCBmZXRjaCBzZXJ2aWNlIGFwaSB1cmwnKVxyXG4gICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcihcIkNvdWxkIG5vdCBmZXRjaCBzZXJ2aWNlIGFwaSB1cmxcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgIH07XHJcblxyXG4gICAgLy9jYWxsIGFwaSB0byBjYW5jZWwgdHJpcFxyXG4gICAgZnVuY3Rpb24gY2FuY2VscG9zdChjYW5jZWxyZXEpIHtcclxuICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgIENvbmZpZ0ZhY3RvcnkuZ2V0T25lTVZBcGlVUkxQcm9taXNlKCkudGhlbihmdW5jdGlvbiAob25lTVZVUkwpIHtcclxuICAgICAgICAgICAgaWYgKG9uZU1WVVJMICYmIG9uZU1WVVJMICE9IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgIC8vZ2V0IHRoZSBiYXNlIHVybCBmcm9tIGNvbmZpZy5cclxuICAgICAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gb25lTVZVUkwgKyAncGFzc2VuZ2VyLycgKyBjYW5jZWxyZXEuUGFzc2VuZ2VySUQgKyAnL3RyaXAvY2FuY2VsJztcclxuICAgICAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgICAgICAgICAndXJsJzogc2VydmljZVVybCxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShjYW5jZWxyZXEpLFxyXG4gICAgICAgICAgICAgICAgICAgIENvbnRlbnRUeXBlOiBcImFwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLThcIlxyXG4gICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkbG9nLmVycm9yKCdFcnJvcjogLSBDb3VsZCBub3QgZmV0Y2ggc2VydmljZSBhcGkgdXJsJylcclxuICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoXCJDb3VsZCBub3QgZmV0Y2ggc2VydmljZSBhcGkgdXJsXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vY2FsbCBhcGkgdG8gZ2V0IHRoZSBsYXN0IGFjdGl2ZSB0cmlwIGRldGFpbHNcclxuICAgIGZ1bmN0aW9uIGdldGxhc3RyaXBkZXRhaWxzKHBhc3NlbmdlcklEKSB7XHJcbiAgICBcdFx0dmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgIFx0XHRDb25maWdGYWN0b3J5LmdldE9uZU1WQXBpVVJMUHJvbWlzZSgpLnRoZW4oZnVuY3Rpb24gKG9uZU1WVVJMKSB7XHJcbiAgICBcdFx0XHRpZiAob25lTVZVUkwgJiYgb25lTVZVUkwgIT0gXCJcIikge1xyXG4gICAgXHRcdFx0XHQvL2dldCB0aGUgYmFzZSB1cmwgZnJvbSBjb25maWcuXHJcbiAgICBcdFx0XHRcdHZhciBzZXJ2aWNlVXJsID0gb25lTVZVUkwgKyAncGFzc2VuZ2VyLycgKyBwYXJzZUludChwYXNzZW5nZXJJRCkgKyAnL2FjdGl2ZVRyaXA/cm5kPScgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcclxuICAgIFx0XHRcdFx0JGh0dHAoe1xyXG4gICAgXHRcdFx0XHRcdG1ldGhvZDogJ0dFVCcsXHJcbiAgICBcdFx0XHRcdFx0J3VybCc6IHNlcnZpY2VVcmwsXHJcbiAgICBcdFx0XHRcdFx0ZGF0YVR5cGU6IFwianNvblwiLFxyXG4gICAgXHRcdFx0XHRcdENvbnRlbnRUeXBlOiBcImFwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLThcIlxyXG4gICAgXHRcdFx0XHR9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgXHRcdFx0XHRcdCRyb290U2NvcGUuJGJyb2FkY2FzdChcImhhc0FjdGl2ZVRyaXBDaGFuZ2VkXCIsIHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEpO1xyXG4gICAgXHRcdFx0XHRcdGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgXHRcdFx0XHR9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICBcdFx0XHRcdFx0ZGVmZXJyZWQucmVqZWN0KGVycilcclxuICAgIFx0XHRcdFx0fSk7XHJcbiAgICBcdFx0XHR9XHJcbiAgICBcdFx0XHRlbHNlIHtcclxuICAgIFx0XHRcdFx0JGxvZy5lcnJvcignRXJyb3I6IC0gQ291bGQgbm90IGZldGNoIHNlcnZpY2UgYXBpIHVybCcpXHJcbiAgICBcdFx0XHRcdFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoXCJDb3VsZCBub3QgZmV0Y2ggc2VydmljZSBhcGkgdXJsXCIpO1xyXG4gICAgXHRcdFx0fVxyXG4gICAgXHRcdH0pO1xyXG4gICAgXHRcdHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgfTtcclxuXHJcbiAgICBmdW5jdGlvbiB1cGRhdGVFbWFpbFBob25lYW5kQWRkcmVzcyhuZXdwYXNzZW5nZXIpIHtcclxuICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgIC8vZ2V0IHRoZSBiYXNlIHVybCBmcm9tIGNvbmZpZy5cclxuICAgICAgICB2YXIgc2VydmljZVVybCA9ICcvUGFzc2VuZ2VyL1VwZGF0ZUVtYWlsUGhvbmVhbmRBZGRyZXNzJztcclxuICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgICAgICAndXJsJzogc2VydmljZVVybCxcclxuICAgICAgICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkobmV3cGFzc2VuZ2VyKSxcclxuICAgICAgICAgICAgZGF0YVR5cGU6IFwianNvblwiLFxyXG4gICAgICAgICAgICBjb250ZW50VHlwZTogXCJhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04XCIsXHJcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgfTtcclxuXHJcbiAgICBmdW5jdGlvbiBnZXRTZXJ2aWNlQXJlYUxvY2F0aW9uKGRpdmlzaW9uSWQpIHtcclxuICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgIC8vZ2V0IHRoZSBiYXNlIHVybCBmcm9tIGNvbmZpZy5cclxuICAgICAgICBDb25maWdGYWN0b3J5LmdldE9uZU1WQXBpVVJMUHJvbWlzZSgpLnRoZW4oZnVuY3Rpb24gKG9uZU1WVVJMKSB7XHJcbiAgICAgICAgICAgIGlmIChvbmVNVlVSTCAmJiBvbmVNVlVSTCAhPSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IG9uZU1WVVJMICsgXCJkaXZpc2lvbi9cIiArIGRpdmlzaW9uSWQgKyBcIi9zZXJ2aWNlQXJlYT9ybmQ9XCIgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICAgICAndXJsJzogc2VydmljZVVybCxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogXCJqc29uXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgY29udGVudFR5cGU6IFwiYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOFwiLFxyXG4gICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgIH07XHJcblxyXG4gICAgZnVuY3Rpb24gZ2V0RHJpdmVyR1BTKHRyaXBJZCkge1xyXG4gICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgLy9nZXQgdGhlIGJhc2UgdXJsIGZyb20gY29uZmlnLlxyXG4gICAgICAgIHZhciBzZXJ2aWNlVXJsID0gJy4uL1Bhc3Nlbmdlci9HZXREcml2ZXJHUFM/cm5kPScgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcclxuICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICd1cmwnOiBzZXJ2aWNlVXJsLFxyXG4gICAgICAgICAgICBwYXJhbXM6IHtcclxuICAgICAgICAgICAgICAgIFRyaXBJZDogdHJpcElkXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGRhdGFUeXBlOiBcImpzb25cIixcclxuICAgICAgICAgICAgY29udGVudFR5cGU6IFwiYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOFwiLFxyXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycilcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgIH07XHJcblxyXG4gICAgLy9TZWFyY2ggcGFzc2FuZ2VyICBieSBjbGllbnRwYXNzYW5nZXJpZFxyXG4gICAgZnVuY3Rpb24gZ2V0U2VhcmNoUGFzc2FuZ2VyKENsaWVudFBhc3NhbmdlcklEKSB7XHJcbiAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAvL2dldCB0aGUgYmFzZSB1cmwgZnJvbSBjb25maWcuXHJcbiAgICAgICAgdmFyIHNlcnZpY2VVcmwgPSAnLi4vUGFzc2VuZ2VyL0dldFNlYXJjaFBhc3Nhbmdlcj9DbGllbnRQYXNzYW5nZXJJRD0nICsgQ2xpZW50UGFzc2FuZ2VySUQ7XHJcbiAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAndXJsJzogc2VydmljZVVybCxcclxuICAgICAgICAgICAgZGF0YVR5cGU6IFwianNvblwiLFxyXG4gICAgICAgICAgICBjb250ZW50VHlwZTogXCJhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04XCIsXHJcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgfTtcclxuXHJcbiAgICAvL2NhbGwgYXBpIHRvIGdldCB0aGUgYWN0aXZlIHJ1bnMgZm9yIGN1cnJlbnQgc2VydmljZSBkYXRlXHJcbiAgICBmdW5jdGlvbiBnZXRBY3RpdmVSdW5zKGRpdmlzaW9uSWQpIHtcclxuICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgIENvbmZpZ0ZhY3RvcnkuZ2V0T25lTVZBcGlVUkxQcm9taXNlKCkudGhlbihmdW5jdGlvbiAob25lTVZVUkwpIHtcclxuICAgICAgICAgICAgaWYgKG9uZU1WVVJMICYmIG9uZU1WVVJMICE9IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgIC8vZ2V0IHRoZSBiYXNlIHVybCBmcm9tIGNvbmZpZy5cclxuICAgICAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gb25lTVZVUkwgKyAnRGlzcGF0Y2gvR2V0UnVucz9ybmQ9JyArIG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgICAgICAgICAgICAgICd1cmwnOiBzZXJ2aWNlVXJsLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHsgXCJEaXZpc2lvbklkXCI6IGRpdmlzaW9uSWQsIFwiU2VydmljZURhdGVcIjogbnVsbCB9KSxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogXCJqc29uXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgQ29udGVudFR5cGU6IFwiYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOFwiXHJcbiAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRsb2cuZXJyb3IoJ0Vycm9yOiAtIENvdWxkIG5vdCBmZXRjaCBzZXJ2aWNlIGFwaSB1cmwnKVxyXG4gICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcihcIkNvdWxkIG5vdCBmZXRjaCBzZXJ2aWNlIGFwaSB1cmxcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgIH07XHJcblxyXG4gICAgLy9jYWxsIGFwaSB0byBnZXQgdGhlIHBhc3QgcnVucyBmb3IgdGhlIHNlcnZpY2UgZGF0ZVxyXG4gICAgZnVuY3Rpb24gZ2V0UGFzdFJ1bnMoZGl2aXNpb25JZCwgc2VydmljZURhdGUpIHtcclxuICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgIENvbmZpZ0ZhY3RvcnkuZ2V0T25lTVZBcGlVUkxQcm9taXNlKCkudGhlbihmdW5jdGlvbiAob25lTVZVUkwpIHtcclxuICAgICAgICAgICAgaWYgKG9uZU1WVVJMICYmIG9uZU1WVVJMICE9IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgIC8vZ2V0IHRoZSBiYXNlIHVybCBmcm9tIGNvbmZpZy5cclxuICAgICAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gb25lTVZVUkwgKyAnRGlzcGF0Y2gvR2V0UGFzdFJ1bnM/cm5kPScgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcclxuICAgICAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgICAgICAgICAgICAgICAgICAndXJsJzogc2VydmljZVVybCxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeSh7IFwiRGl2aXNpb25JZFwiOiBkaXZpc2lvbklkLCBcIlNlcnZpY2VEYXRlXCI6IHNlcnZpY2VEYXRlIH0pLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiBcImpzb25cIixcclxuICAgICAgICAgICAgICAgICAgICBDb250ZW50VHlwZTogXCJhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04XCJcclxuICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycilcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJGxvZy5lcnJvcignRXJyb3I6IC0gQ291bGQgbm90IGZldGNoIHNlcnZpY2UgYXBpIHVybCcpXHJcbiAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKFwiQ291bGQgbm90IGZldGNoIHNlcnZpY2UgYXBpIHVybFwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgfTtcclxuXHJcbiAgICAvL2NhbGwgYXBpIHRvIHRoZSB0cmlwcyBpbiB0aGUgcGFzdFxyXG4gICAgZnVuY3Rpb24gc2F2ZVBhc3RUcmlwKHNhdmVUcmlwUmVxcGFyYW0pIHtcclxuICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgIENvbmZpZ0ZhY3RvcnkuZ2V0T25lTVZBcGlVUkxQcm9taXNlKCkudGhlbihmdW5jdGlvbiAob25lTVZVUkwpIHtcclxuICAgICAgICAgICAgaWYgKG9uZU1WVVJMICYmIG9uZU1WVVJMICE9IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgIC8vZ2V0IHRoZSBiYXNlIHVybCBmcm9tIGNvbmZpZy5cclxuICAgICAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gb25lTVZVUkwgKyAnRGlzcGF0Y2gvSW5zZXJ0UGFzdFRyaXAnO1xyXG4gICAgICAgICAgICAgICAgJGh0dHAoe1xyXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgICAgICAgICAgICAgICd1cmwnOiBzZXJ2aWNlVXJsLFxyXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHNhdmVUcmlwUmVxcGFyYW0pLFxyXG4gICAgICAgICAgICAgICAgICAgIENvbnRlbnRUeXBlOiBcImFwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLThcIlxyXG4gICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkbG9nLmVycm9yKCdFcnJvcjogLSBDb3VsZCBub3QgZmV0Y2ggc2VydmljZSBhcGkgdXJsJylcclxuICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoXCJDb3VsZCBub3QgZmV0Y2ggc2VydmljZSBhcGkgdXJsXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vY2FsbCBhcGkgdG8gZ2V0IHRoZSBzZXJ2aWNlIGRhdGUgZm9yIHRoZSBkaXZpc2lvblxyXG4gICAgZnVuY3Rpb24gZ2V0U2VydmljZURhdGVCeURpdmlzaW9uKGRpdmlzaW9uSWQpIHtcclxuICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgIENvbmZpZ0ZhY3RvcnkuZ2V0T25lTVZBcGlVUkxQcm9taXNlKCkudGhlbihmdW5jdGlvbiAob25lTVZVUkwpIHtcclxuICAgICAgICAgICAgaWYgKG9uZU1WVVJMICYmIG9uZU1WVVJMICE9IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgIC8vZ2V0IHRoZSBiYXNlIHVybCBmcm9tIGNvbmZpZy5cclxuICAgICAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gb25lTVZVUkwgKyAnZGl2aXNpb24vJyArIGRpdmlzaW9uSWQgKyAnL3NlcnZpY2VEYXRlP3JuZD0nICsgbmV3IERhdGUoKS5nZXRUaW1lKCk7XHJcbiAgICAgICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICAgICAndXJsJzogc2VydmljZVVybCxcclxuICAgICAgICAgICAgICAgICAgICBDb250ZW50VHlwZTogXCJhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04XCJcclxuICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycilcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJGxvZy5lcnJvcignRXJyb3I6IC0gQ291bGQgbm90IGZldGNoIHNlcnZpY2UgYXBpIHVybCcpXHJcbiAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKFwiQ291bGQgbm90IGZldGNoIHNlcnZpY2UgYXBpIHVybFwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgfTtcclxuXHJcbiAgICBmdW5jdGlvbiBnZXRUcmlwQ2FuY2VsU3RhdHVzTGlzdCgpXHJcbiAgICB7XHJcbiAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICBDb25maWdGYWN0b3J5LmdldE9uZU1WQXBpVVJMUHJvbWlzZSgpLnRoZW4oZnVuY3Rpb24gKG9uZU1WVVJMKSB7XHJcbiAgICAgICAgICAgIGlmIChvbmVNVlVSTCAmJiBvbmVNVlVSTCAhPSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAvL2dldCB0aGUgYmFzZSB1cmwgZnJvbSBjb25maWcuXHJcbiAgICAgICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IG9uZU1WVVJMICsgJ3Bhc3Nlbmdlci9nZXRDYW5jZWxsYXRpb25SZWFzb25zP3JuZD0nICsgbmV3IERhdGUoKS5nZXRUaW1lKCk7XHJcbiAgICAgICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgICAgICAgICAndXJsJzogc2VydmljZVVybCxcclxuICAgICAgICAgICAgICAgICAgICBDb250ZW50VHlwZTogXCJhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04XCJcclxuICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycilcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJGxvZy5lcnJvcignRXJyb3I6IC0gQ291bGQgbm90IGZldGNoIHNlcnZpY2UgYXBpIHVybCcpXHJcbiAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKFwiQ291bGQgbm90IGZldGNoIHNlcnZpY2UgYXBpIHVybFwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG5cclxuICAgIH1cclxufVxyXG59KSgpO1xyXG5cclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5mYWN0b3J5KCdUcmlwTmVnb3RpYXRpb25Mb2dTZXJ2aWNlJywgVHJpcE5lZ290aWF0aW9uTG9nU2VydmljZSk7XHJcblxyXG4gICAgVHJpcE5lZ290aWF0aW9uTG9nU2VydmljZS4kaW5qZWN0ID0gWyckaHR0cCcsICckcScsICdlbnYnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBUcmlwTmVnb3RpYXRpb25Mb2dTZXJ2aWNlKCRodHRwLCAkcSwgZW52KSB7XHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XHJcbiAgICAgICAgICAgIGFkZEFwcHJvdmFsTG9nOiBhZGRBcHByb3ZhbExvZyxcclxuICAgICAgICAgICAgYWRkUmVqZWN0aW9uTG9nOmFkZFJlamVjdGlvbkxvZ1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFkZEFwcHJvdmFsTG9nKHRyaXBSZXF1ZXN0SWQsIG5lZ290aWF0aW9uTG9nSWQsIG1vZGlmaWVkQnkpIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVyID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgdmFyIF91cmwgPSBlbnYub25lTVZBcGlVcmwgKyBcInRyaXBOZWdvdGlhdGlvbkxvZy9hY2NlcHQvXCIgKyB0cmlwUmVxdWVzdElkICsgJy8nICsgbmVnb3RpYXRpb25Mb2dJZCArICcvJyArIG1vZGlmaWVkQnk7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BVVCcsXHJcbiAgICAgICAgICAgICAgICB1cmw6IF91cmxcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXIucmVzb2x2ZShyZXNwb25zZS5kYXRhLnJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVyLnJlamVjdChyZXNwb25zZS5kYXRhLnJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXIucHJvbWlzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFkZFJlamVjdGlvbkxvZyh0cmlwUmVxdWVzdElkLCBtb2RpZmllZEJ5KSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlciA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIHZhciBfdXJsID0gZW52Lm9uZU1WQXBpVXJsICsgXCJ0cmlwTmVnb3RpYXRpb25Mb2cvcmVqZWN0L1wiICsgdHJpcFJlcXVlc3RJZCArICcvJyArIG1vZGlmaWVkQnk7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BVVCcsXHJcbiAgICAgICAgICAgICAgICB1cmw6IF91cmxcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXIucmVzb2x2ZShyZXNwb25zZS5kYXRhLnJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmVyLnJlamVjdChyZXNwb25zZS5kYXRhLnJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXIucHJvbWlzZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdEYXNoYm9hcmRDb250cm9sbGVyJywgRGFzaGJvYXJkQ29udHJvbGxlcik7XHJcblxyXG4gICAgRGFzaGJvYXJkQ29udHJvbGxlci4kaW5qZWN0ID0gW1xyXG4gICAgICAgICckc2NvcGUnLFxyXG4gICAgICAgICckc3RhdGVQYXJhbXMnLFxyXG4gICAgICAgICckbG9jYXRpb24nLFxyXG4gICAgICAgICckdWliTW9kYWwnLFxyXG4gICAgICAgICckcm9vdFNjb3BlJywgICAgICAgIFxyXG4gICAgICAgICckaW50ZXJ2YWwnLFxyXG4gICAgICAgICdEaXZpc2lvblNlcnZpY2UnLFxyXG4gICAgICAgICdSZXNlcnZhdGlvblNlcnZpY2UnLFxyXG4gICAgICAgICdTY2hlZHVsZVNlcnZpY2UnLFxyXG4gICAgICAgICdhdXRoU2VydmljZScsXHJcbiAgICAgICAgJ1V0aWxpdHlGYWN0b3J5JywgICAgICAgIFxyXG4gICAgICAgICdDb25maWdGYWN0b3J5JyxcclxuICAgICAgICAnZW52JyxcclxuICAgICAgICAnUGFnZVNlcnZpY2UnLFxyXG4gICAgICAgICdPbmVNdlNlcnZpY2VzJ1xyXG4gICAgXTtcclxuXHJcbiAgICBmdW5jdGlvbiBEYXNoYm9hcmRDb250cm9sbGVyKCRzY29wZSwgJHN0YXRlUGFyYW1zLCAkbG9jYXRpb24sICR1aWJNb2RhbCwgJHJvb3RTY29wZSwgJGludGVydmFsLCBEaXZpc2lvblNlcnZpY2UsXHJcbiAgICAgICAgUmVzZXJ2YXRpb25TZXJ2aWNlLCBTY2hlZHVsZVNlcnZpY2UsIGF1dGhTZXJ2aWNlLCBVdGlsaXR5RmFjdG9yeSxDb25maWdGYWN0b3J5LCBlbnYsIFBhZ2VTZXJ2aWNlLE9uZU12U2VydmljZXMpIHtcclxuXHJcblxyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdm0udXNlcklkID0gJyc7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2UgPSBQYWdlU2VydmljZTtcclxuICAgICAgICB2bS5QYWdlU2VydmljZS5zZXRUaXRsZSgnRGFzaGJvYXJkJyk7XHJcbiAgICAgICAgdm0uaXNVc2VyTG9nZ2VkSW4gPSBhdXRoU2VydmljZS5pc0xvZ2dlZEluKCk7XHJcbiAgICAgICAgdm0ucGFzc2VuZ2VyUmVzZXJ2YXRpb25zID0gW107XHJcbiAgICAgICAgdm0udG9kYXlzVHJpcHMgPSBbXTtcclxuICAgICAgICB2bS5hbGxvd2VkU2VydmljZXMgPSBbXTtcclxuICAgICAgICB2bS5sb2FkaW5nU2VydmljZXMgPSBmYWxzZTtcclxuICAgICAgICB2bS5hbGxvd0ZhcmluZyA9IGZhbHNlO1xyXG4gICAgICAgIHZtLnBhc3NlbmdlcklkID0gJyc7XHJcbiAgICAgICAgdmFyIGF1dG9SZWZyZXNoID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHZtLmN1cnJlbnRZZWFyID0gbmV3IERhdGUoKS5nZXRGdWxsWWVhcigpO1xyXG4gICAgICAgIHZtLnNob3dEcnQgPSBmYWxzZTtcclxuICAgICAgICB2bS5zaG93Q29tbXV0ZXIgPSBmYWxzZTsgICAgICAgIFxyXG4gICAgICAgIHZtLmNvbW11dGVySW5mbyA9IE9uZU12U2VydmljZXMuZ2V0Q29tbXV0ZXJJbmZvKCk7ICAgXHJcbiAgICAgICAgdm0uZHJ0SW5mbyA9IE9uZU12U2VydmljZXMuZ2V0RHJ0SW5mbygpO1xyXG5cclxuICAgICAgICB2YXIgb3B0aW9ucyA9IHt9O1xyXG5cclxuICAgICAgICB2bS5sb2dpbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9sb2dpbicpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0ubWVudUNsYXNzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAodm0uYWxsb3dlZFNlcnZpY2VzXHJcbiAgICAgICAgICAgICAgICAmJiB2bS5hbGxvd2VkU2VydmljZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGVsQ291bnQgPSB2bS5hbGxvd2VkU2VydmljZXMubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICdjb2wtc20tJyArIDEyIC8gZWxDb3VudDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gJ2NvbC1zbS0xMic7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBwb3B1bGF0ZURpdmlzaW9uUGFyYW1ldGVycyhjYWxsYmFjaykge1xyXG4gICAgICAgICAgICB2YXIgZGl2aXNpb25JZCA9IERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCk7XHJcbiAgICAgICAgICAgIENvbmZpZ0ZhY3RvcnkuZ2V0RGl2aXNpb25QYXJhbWV0ZXJzKGRpdmlzaW9uSWQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChwYXJhbXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJhbXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnByb21pc2VXaW5kb3cgPSBwYXJhbXMuUHJvbWlzZVdpbmRvdyA/IGV2YWwocGFyYW1zLlByb21pc2VXaW5kb3cpIDogMTA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5zaG93Q2FuY2VsT3B0aW9ucyA9IHBhcmFtcy5DYW5jZWxSZWFzb25SZXF1aXJlZCA/IGV2YWwocGFyYW1zLkNhbmNlbFJlYXNvblJlcXVpcmVkLnRvTG93ZXJDYXNlKCkpIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5hbGxvd0xvY2F0aW9uTm90ZXMgPSBwYXJhbXMuQWxsb3dMb2NhdGlvbk5vdGVzID8gZXZhbChwYXJhbXMuQWxsb3dMb2NhdGlvbk5vdGVzLnRvTG93ZXJDYXNlKCkpIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uYWxsb3dGYXJpbmcgPSBwYXJhbXMuQWxsb3dGYXJpbmcgPyBldmFsKHBhcmFtcy5BbGxvd0ZhcmluZy50b0xvd2VyQ2FzZSgpKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuYWxsb3dDaGlsZHJlbiA9IHBhcmFtcy5BbGxvd0NoaWxkcmVuID8gZXZhbChwYXJhbXMuQWxsb3dDaGlsZHJlbikgOiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmFsbG93TXVsdGlwbGVTZWF0Qm9va2luZyA9IHBhcmFtcy5BbGxvd011bHRpcGxlU2VhdEJvb2tpbmcgPyBldmFsKHBhcmFtcy5BbGxvd011bHRpcGxlU2VhdEJvb2tpbmcudG9Mb3dlckNhc2UoKSkgOiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmZXRjaFRyaXBzQW5kUmVzZXJ2YXRpb25zKGNhbGxiYWNrKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKCdFcnJvcicsIHJlc3BvbnNlLmRhdGEuUmV0dXJuTWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGdldFBhc3NlbmdlclRyaXBzID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgIFNjaGVkdWxlU2VydmljZS50cmlwc0ZvclNlcnZpY2VEYXRlKHZtLnBhc3NlbmdlcklkKVxyXG4gICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEgJiYgcmVzcG9uc2UuZGF0YS5yZXN1bHQgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICB2bS50b2RheXNUcmlwcyA9IHJlc3BvbnNlLmRhdGEucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgICB2YXIgcHJvbWlzZVdpbmRvdyA9IG9wdGlvbnMucHJvbWlzZVdpbmRvdztcclxuICAgICAgICAgICAgICAgICAgICAgdm0udG9kYXlzVHJpcHMuc29ydChmdW5jdGlvbiAoYSwgYikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKGEuc2NoZWRQaWNrdXBUaW1lKS5nZXRUaW1lKCkgLSBuZXcgRGF0ZShiLnNjaGVkUGlja3VwVGltZSkuZ2V0VGltZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2bS50b2RheXNUcmlwcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgdm0uc2VydmljZURhdGUgPSB2bS50b2RheXNUcmlwc1tpXS5zZXJ2aWNlRGF0ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2bS50b2RheXNUcmlwc1tpXS5lc3RpbWF0ZWRQaWNrdXBUaW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy92YXIgcGlja3VwVGltZSA9IHZtLnRvZGF5c1RyaXBzW2ldLnNjaGVkUGlja3VwVGltZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3ZhciBwcm9taXNlV2luZG93c0VuZFRpbWUgPSBEYXRlRmFjdG9yeS5nZXRQcm9taXNlV2luZG93RW5kVGltZShwaWNrdXBUaW1lLCBwcm9taXNlV2luZG93KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL3ZtLnRvZGF5c1RyaXBzW2ldLnByb21pc2VXaW5kb3dTdGFydFRpbWUgPSAkZmlsdGVyKCdkYXRlJykocGlja3VwVGltZSwgJ2g6bW0gYScpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vdm0udG9kYXlzVHJpcHNbaV0ucHJvbWlzZVdpbmRvd0VuZFRpbWUgPSAkZmlsdGVyKCdkYXRlJykocHJvbWlzZVdpbmRvd3NFbmRUaW1lLCAnaDptbSBhJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdGFydFBpY2t1cFdpbmRvd1RpbWUgPSBuZXcgbW9tZW50KHZtLnRvZGF5c1RyaXBzW2ldLnN0YXJ0UGlja3VwV2luZG93VGltZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVuZFBpY2t1cFdpbmRvd1RpbWUgPSBuZXcgbW9tZW50KHZtLnRvZGF5c1RyaXBzW2ldLmVuZFBpY2t1cFdpbmRvd1RpbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnRvZGF5c1RyaXBzW2ldLnByb21pc2VXaW5kb3dTdGFydFRpbWUgPSBzdGFydFBpY2t1cFdpbmRvd1RpbWUuZm9ybWF0KCdoOm1tIEEnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS50b2RheXNUcmlwc1tpXS5wcm9taXNlV2luZG93RW5kVGltZSA9IGVuZFBpY2t1cFdpbmRvd1RpbWUuZm9ybWF0KCdoOm1tIEEnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgaWYgKCFhbmd1bGFyLmlzVW5kZWZpbmVkKGNhbGxiYWNrKSAmJiBjYWxsYmFjayAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xyXG4gICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgICAgXHJcbiAgICAgICAgLy92bS5hbGxvd0NhbmNlbCA9IGZ1bmN0aW9uICh0cmlwKSB7XHJcbiAgICAgICAgLy8gICAgcmV0dXJuIHRyaXAuU3RhdHVzICE9PSAnUmVzZXJ2ZWQnO1xyXG4gICAgICAgIC8vfSAgICAgXHJcblxyXG4gICAgICAgIHZhciBnZXRQYXNzZW5nZXJSZXNlcnZhdGlvbnNGb3JUb2RheSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgUmVzZXJ2YXRpb25TZXJ2aWNlLmdldFBhc3NlbmdlclJlc2VydmF0aW9uc0ZvclRvZGF5KHZtLnBhc3NlbmdlcklkKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEgJiYgcmVzcG9uc2UuZGF0YS5yZXN1bHQucmVzZXJ2YXRpb25zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0ucGFzc2VuZ2VyUmVzZXJ2YXRpb25zID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQucmVzZXJ2YXRpb25zOyAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5wYXNzZW5nZXJSZXNlcnZhdGlvbnMgPSBbXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgaWYgKGVyci5zdGF0dXMgIT09IDQwMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoXCJFcnJvciFcIiwgXCInU29ycnkhIENvdWxkIG5vdCBsb2FkIHlvdXIgUmVzZXJ2YXRpb24hJ1wiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH07XHJcbiAgICAgICBcclxuICAgICAgICBmdW5jdGlvbiBzZXRBdXRvUmVmcmVzaCgpIHtcclxuICAgICAgICAgICAgaWYgKGF1dGhTZXJ2aWNlLmlzTG9nZ2VkSW4oKSkge1xyXG4gICAgICAgICAgICAgICAgYXV0b1JlZnJlc2ggPSAkaW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZldGNoVHJpcHNBbmRSZXNlcnZhdGlvbnMoKTtcclxuICAgICAgICAgICAgICAgIH0sIDMwMDAwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGFjdGl2YXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2bS5sb2FkaW5nU2VydmljZXMgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgdmFyIGFsaWFzID0gYWxpYXNOb3RGb3VuZEluUm91dGUoKVxyXG4gICAgICAgICAgICAgICAgPyBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25BbGlhcygpXHJcbiAgICAgICAgICAgICAgICA6ICRzdGF0ZVBhcmFtcy5kaXZpc2lvbjtcclxuXHJcbiAgICAgICAgICAgIERpdmlzaW9uU2VydmljZVxyXG4gICAgICAgICAgICAgICAgLnNldERpdmlzaW9uKGFsaWFzKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oaGFuZGxlU3VjY2VzcywgaGFuZGxlRmFpbHVyZSk7ICAgICBcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBhbGlhc05vdEZvdW5kSW5Sb3V0ZSgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGFuZ3VsYXIuaXNVbmRlZmluZWQoJHN0YXRlUGFyYW1zLmRpdmlzaW9uKSBcclxuICAgICAgICAgICAgICAgICAgICAgICAgfHwgJHN0YXRlUGFyYW1zLmRpdmlzaW9uID09PSBudWxsIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB8fCAkc3RhdGVQYXJhbXMuZGl2aXNpb24udHJpbSgpID09PSAnJztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGhhbmRsZVN1Y2Nlc3MocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEpIHtcclxuICAgICAgICAgICAgICAgIHZtLmFsbG93ZWRTZXJ2aWNlcyA9IHNvcnQocmVzcG9uc2UuZGF0YS5yZXN1bHQuRGl2aXNpb25TZXJ2aWNlcyk7XHJcbiAgICAgICAgICAgICAgICB2bS5zaG93Q29tbXV0ZXIgPSAhYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5jb21tdXRlckluZm8pO1xyXG4gICAgICAgICAgICAgICAgdm0uc2hvd0RydCA9ICFhbmd1bGFyLmlzVW5kZWZpbmVkKHZtLmRydEluZm8pO1xyXG4gICAgICAgICAgICAgICAgaWYgKHZtLmlzVXNlckxvZ2dlZEluKVxyXG4gICAgICAgICAgICAgICAgICAgIGZldGNoVXNlckRldGFpbHMoKTtcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuZGl2aXNpb25OYW1lID0gKHJlc3BvbnNlLmRhdGEucmVzdWx0LkRpdmlzaW9uTmFtZSA/IHJlc3BvbnNlLmRhdGEucmVzdWx0LkRpdmlzaW9uTmFtZSA6ICdPbmUgUG9ydGFsJyk7XHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLnN1cHBvcnRQaG9uZU51bWJlciA9IChyZXNwb25zZS5kYXRhLnJlc3VsdC5TdXBwb3J0UGhvbmVOdW1iZXIgPyByZXNwb25zZS5kYXRhLnJlc3VsdC5TdXBwb3J0UGhvbmVOdW1iZXIgOiAnJyk7XHJcbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nU2VydmljZXMgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICAvL1NldHMgdGhlIHBhZ2UgbmFtZSBhbmQgaGVhZGxpbmUgZnJvbSB0aGUgZGF0YWJhc2UuXHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHZtLlBhZ2VTZXJ2aWNlLnNldEhlYWRsaW5lKCRyb290U2NvcGUuZGl2aXNpb25OYW1lKTsgICBcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCdkaXZpc2lvbicpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBoYW5kbGVGYWlsdXJlKGVycm9yKSB7XHJcbiAgICAgICAgICAgIHZtLmxvYWRpbmdTZXJ2aWNlcyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnZGl2aXNpb24nKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBzb3J0ID0gZnVuY3Rpb24gKHNlcnZpY2VzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBzZXJ2aWNlcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcGFyc2VJbnQoYS5EaXNwbGF5T3JkZXIpIC0gcGFyc2VJbnQoYi5EaXNwbGF5T3JkZXIpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBmZXRjaFVzZXJEZXRhaWxzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2bS51c2VySWQgPSBhdXRoU2VydmljZS5hdXRoZW50aWNhdGlvbi51c2VySWQ7XHJcbiAgICAgICAgICAgIHZtLnBhc3NlbmdlcklkID0gYXV0aFNlcnZpY2UuYXV0aGVudGljYXRpb24ucGFzc2VuZ2VySWQ7XHJcbiAgICAgICAgICAgIHBvcHVsYXRlRGl2aXNpb25QYXJhbWV0ZXJzKHNldEF1dG9SZWZyZXNoKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICB2bS5zaG93U3RvcHNNYXAgPSBmdW5jdGlvbiAoaW5jKSB7XHJcbiAgICAgICAgICAgIHZhciBtb2RhbEdldE1hcCA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIHdpbmRvd0NsYXNzOiAnbWFwLW1vZGFsJyxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL21vZHVsZXMvY29tbXV0ZXIvbW9kYWxzL3Jlc2VydmF0aW9uLW1hcC1tb2RhbC9yZXNlcnZhdGlvbi1tYXAuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnUmVzZXJ2YXRpb25NYXBDb250cm9sbGVyIGFzIHZtJyxcclxuICAgICAgICAgICAgICAgIGJhY2tkcm9wOiAnc3RhdGljJyxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICByZXNlcnZhdGlvbl9zdG9wczogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW5jO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBtb2RhbEdldE1hcC5yZXN1bHQudGhlbihmdW5jdGlvbiAoaXNEb25lKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXNEb25lKSB7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuXHJcblxyXG4gICAgICAgIHZhciBmZXRjaFRyaXBzQW5kUmVzZXJ2YXRpb25zID0gZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICAgICAgaWYgKHZtLnNob3dDb21tdXRlcikgZ2V0UGFzc2VuZ2VyUmVzZXJ2YXRpb25zRm9yVG9kYXkoKTtcclxuICAgICAgICAgICAgaWYgKHZtLnNob3dEcnQpIHtcclxuXHRcdFx0XHQvLyBnZXQgYWxsIERSVCB0cmlwcyBvZiBpbnRlcmVzdCB0byB0aGUgcGFzc2VuZ2VyXHJcbiAgICAgICAgICAgIFx0Z2V0UGFzc2VuZ2VyVHJpcHMoKTtcclxuICAgICAgICAgICAgXHQvLyBnZXQgY3VycmVudCB0cmlwXHJcbiAgICAgICAgICAgIFx0U2NoZWR1bGVTZXJ2aWNlLmdldGxhc3RyaXBkZXRhaWxzKHZtLnBhc3NlbmdlcklkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICBzdG9wQXV0b1JlZnJlc2goKTtcclxuICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgIHZhciBzdG9wQXV0b1JlZnJlc2ggPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzRGVmaW5lZChhdXRvUmVmcmVzaCkpIHtcclxuICAgICAgICAgICAgICAgICRpbnRlcnZhbC5jYW5jZWwoYXV0b1JlZnJlc2gpO1xyXG4gICAgICAgICAgICAgICAgYXV0b1JlZnJlc2ggPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIH0gICAgICAgICAgICBcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRzY29wZS4kb24oJ2RpdmlzaW9uQ2hhbmdlZCcsIHN0b3BBdXRvUmVmcmVzaCk7XHJcblxyXG4gICAgICAgIHZtLm5hdmlnYXRlID0gZnVuY3Rpb24gKHBhdGgsIHNlcnZpY2VUeXBlLCBzZXJ2aWNlSWQpIHtcclxuICAgICAgICAgICAgLy8kcm9vdFNjb3BlLiRicm9hZGNhc3Qoc2VydmljZUlkKTtcclxuICAgICAgICAgICAgaWYgKHNlcnZpY2VUeXBlID09PSAnZXh0ZXJuYWwnKVxyXG4gICAgICAgICAgICAgICAgaWYgKCQoJ2JvZHknKS5oYXNDbGFzcygncGxhdGZvcm0tY29yZG92YScpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBoZXJlIGZvciBJb25pYyBmcmFtZXdvcmsuXHJcbiAgICAgICAgICAgICAgICAgICAgd2luZG93Lm9wZW4ocGF0aCwgJ19zeXN0ZW0nLCAnJyk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IHBhdGg7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgZWxzZSBpZiAoc2VydmljZVR5cGUgPT09ICdpbnRlcm5hbCcpXHJcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aChwYXRoKTtcclxuICAgICAgICB9XHJcbiAgICAgIFxyXG5cclxuICAgICAgICB2bS5zaG93Q29tbXV0ZXJUcmlwID0gZnVuY3Rpb24gKHRyaXApIHtcclxuICAgICAgICAgICAgdmFyIGNvbW11dGVyVHJpcE1vZGFsID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvbW9kdWxlcy9zaGFyZWQvdHJpcHMvY29tbXV0ZXItdHJpcC1tb2RhbC5odG1sJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDb21tdXRlclRyaXBNb2RhbENvbnRyb2xsZXIgYXMgdm0nLFxyXG4gICAgICAgICAgICAgICAgc2l6ZTogJy1mcycsXHJcbiAgICAgICAgICAgICAgICBiYWNrZHJvcDogJ3N0YXRpYycsXHJcbiAgICAgICAgICAgICAgICBrZXlib2FyZDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHJpcElkOiB0cmlwLmlkXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgY29tbXV0ZXJUcmlwTW9kYWwucmVzdWx0LnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuY2FuY2VsbGVkIHx8IHJlc3BvbnNlLmlzTW9kaWZpZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBnZXRQYXNzZW5nZXJSZXNlcnZhdGlvbnNGb3JUb2RheSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5zaG93RHJ0VHJpcCA9IGZ1bmN0aW9uICh0cmlwKSB7XHJcbiAgICAgICAgICAgIHZhciBfdHJpcE1vZGFsUmVxdWVzdCA9IHtcclxuICAgICAgICAgICAgICAgIHBhc3NlbmdlclRyaXA6IHRyaXAsXHJcbiAgICAgICAgICAgICAgICBvcHRpb25zOiBvcHRpb25zLFxyXG4gICAgICAgICAgICAgICAgc2VydmljZURhdGU6IHZtLnNlcnZpY2VEYXRlXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIGRydFRyaXBNb2RhbCA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL21vZHVsZXMvc2hhcmVkL3RyaXBzL2RydC10cmlwLW1vZGFsLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1RyaXBEZXRhaWxzTW9kYWxDb250cm9sbGVyIGFzIHZtJyxcclxuICAgICAgICAgICAgICAgIHNpemU6ICctZnMnLFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIHRyaXBNb2RhbFJlcXVlc3Q6IF90cmlwTW9kYWxSZXF1ZXN0XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgZHJ0VHJpcE1vZGFsLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgJiYgcmVzdWx0LmFjdGlvbiA9PT0gJ2NhbmNlbCcpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYW5jZWxUcmlwKHRyaXApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY2FuY2VsVHJpcCh0cmlwKSB7XHJcbiAgICAgICAgICAgIHZhciB0cmlwVG9DYW5jZWwgPSB7XHJcbiAgICAgICAgICAgICAgICAndHJpcElkJzogdHJpcC5UcmlwSWQsXHJcbiAgICAgICAgICAgICAgICAncGFzc2VuZ2VySWQnOiB0cmlwLlBhc3NlbmdlcklkLFxyXG4gICAgICAgICAgICAgICAgJ2Zyb20nOiB0cmlwLnN0YXJ0TmFtZSxcclxuICAgICAgICAgICAgICAgICd0byc6IHRyaXAuZW5kTmFtZSxcclxuICAgICAgICAgICAgICAgICdzY2hlZHVsZWRUaW1lJzogdHJpcC5zY2hlZFBpY2t1cFRpbWVcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHZhciBtb2RhbENhbmNlbFRyaXAgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9tb2R1bGVzL29uLWRlbWFuZC9hY3RpdmVUcmlwL3RyaXAtY2FuY2VsbGF0aW9uLXByb21wdC5odG1sJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdUcmlwQ2FuY2VsbGF0aW9uQ29udHJvbGxlciBhcyB2bScsXHJcbiAgICAgICAgICAgICAgICBzaXplOiAnLWZzJyxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICB0cmlwVG9DYW5jZWw6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRyaXBUb0NhbmNlbDtcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHNob3dDYW5jZWxPcHRpb25zOiBvcHRpb25zLnNob3dDYW5jZWxPcHRpb25zXHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIG1vZGFsQ2FuY2VsVHJpcC5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmlzQ2FuY2VsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RTdWNjZXNzKFwiU3VjY2VzcyFcIiwgXCJUcmlwIGNhbmNlbGxlZFwiKTtcclxuICAgICAgICAgICAgICAgICAgICBnZXRQYXNzZW5nZXJUcmlwcygpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoXCJFcnJvciFcIiwgXCJVbmFibGUgdG8gY2FuY2VsIHRoZSB0cmlwLlwiKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgIGFjdGl2YXRlKCk7XHJcblxyXG4gICAgICAgIC8vIElvbmljIHBhcmFtZXRlcnNcclxuICAgICAgICBpZiAoZW52LmlvbmljKSB7XHJcbiAgICAgICAgICAgIHZtLmFwcFZlcnNpb24gPSBlbnYuaW9uaWMuYXBwVmVyc2lvbjtcclxuICAgICAgICAgICAgdm0uYXBwVmVyc2lvbiArPSBlbnYuaW9uaWMuc29mdHdhcmVWZXJzaW9uID09IG51bGwgPyAnJyA6ICcgJyArIGVudi5pb25pYy5zb2Z0d2FyZVZlcnNpb247XHJcbiAgICAgICAgICAgIHZtLmFwcFZlcnNpb24gKz0gZW52LmlvbmljLmVudmlyb25tZW50ID09IG51bGwgPyAnJyA6ICcuJyArIGVudi5pb25pYy5lbnZpcm9ubWVudDtcclxuICAgICAgICAgICAgdm0uYXBwVmVyc2lvbiArPSBlbnYuaW9uaWMubG9jYWxFbnZpcm9ubWVudCA9PSBudWxsID8gJycgOiAnLicgKyBlbnYuaW9uaWMubG9jYWxFbnZpcm9ubWVudDtcclxuXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdm0uYXBwVmVyc2lvbiA9ICcnO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2bS5yZWZyZXNoID0gZnVuY3Rpb24gKHJlZnJlc2hlcikge1xyXG4gICAgICAgICAgICBhY3RpdmF0ZSgpO1xyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3Njcm9sbC5yZWZyZXNoQ29tcGxldGUnKTtcclxuICAgICAgICB9ICAgICAgICBcclxuXHJcbiAgICB9XHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignRGl2aXNpb25zQ29udHJvbGxlcicsIERpdmlzaW9uc0NvbnRyb2xsZXIpO1xyXG5cclxuICAgIERpdmlzaW9uc0NvbnRyb2xsZXIuJGluamVjdCA9IFsnJHdpbmRvdycsICckc2NvcGUnLCAnJHJvb3RTY29wZScsICckbG9jYXRpb24nLCAnRGl2aXNpb25TZXJ2aWNlJywgJ0dlb0xvY2F0aW9uU2VydmljZScsXHJcbiAgICAgICAgJ0NvbW1vblNlcnZpY2UnLCAnZW52JywnVXRpbGl0eUZhY3RvcnknXTtcclxuXHJcbiAgICBmdW5jdGlvbiBEaXZpc2lvbnNDb250cm9sbGVyKCR3aW5kb3csICRzY29wZSwgJHJvb3RTY29wZSwgJGxvY2F0aW9uLCBEaXZpc2lvblNlcnZpY2UsIEdlb0xvY2F0aW9uU2VydmljZSwgQ29tbW9uU2VydmljZSwgZW52LFV0aWxpdHlGYWN0b3J5KSB7XHJcbiAgICAgICAgLy9maWd1cmUgb3V0IGdwcyBpcyBvbiBvciBvZmYuIElmIG9uIHRoZW4gZmluZCBkaXZpc2lvbnMgaW4gc2FtZSBzdGF0ZSBhbmQgc3RhdGUgZHJvcCBkb3duXHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS5kaXZpc2lvbnMgPSBbXTtcclxuICAgICAgICB2bS5zZWxlY3RlZERpdmlzaW9uID0gJyc7XHJcbiAgICAgICAgdm0uaXNEaXZpc2lvbkxvYWRlZCA9IGZhbHNlO1xyXG4gICAgICAgIHZtLnNob3dEaXZpc2lvbkRyb3Bkb3duID0gdHJ1ZTtcclxuICAgICAgICB2bS5zdGF0ZXMgPSBbXTtcclxuICAgICAgICB2YXIgbm9EaXZpc2lvbiA9IHsgJ0FsaWFzJzogJy0tJywgJ0RpdmlzaW9uTmFtZSc6ICctLScgfTtcclxuICAgICAgICB2YXIgbm9TdGF0ZSA9IHsgJ05hbWUnOiAnLS0nLCAnSWQnOiAnLS0nIH07XHJcbiAgICAgICAgdm0uc2V0RGl2aXNpb24gPSBzZXREaXZpc2lvbjtcclxuICAgICAgICB2bS5mZXRjaERpdmlzaW9uc0ZvclNlbGVjdGVkU3RhdGUgPSBmZXRjaERpdmlzaW9uc0ZvclNlbGVjdGVkU3RhdGU7XHJcblxyXG4gICAgICAgIGFjdGl2YXRlKCk7XHJcbiAgICAgICAgZnVuY3Rpb24gcG9wdWxhdGVEaXZpc2lvbnMocmVzcG9uc2UpIHtcclxuXHJcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnJlc3VsdCAhPSBudWxsICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIHZtLmRpdmlzaW9ucyA9IHJlc3BvbnNlLmRhdGEucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgdm0uZGl2aXNpb25zLnNwbGljZSgwLCAwLCBub0RpdmlzaW9uKTtcclxuICAgICAgICAgICAgICAgIGlmIChlbnYuaXNJb25pYyAmJiBlbnYuaXNJb25pY0RldmljZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIEluIHBhc3NlbmdlciBhcHAsIGxldHMgc2VsZWN0IEFtYXpvbiwgb3IgcmVtb3ZlIGFtYXpvbiBmcm9tXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhlIGRyb3AgZG93biBiYXNlZCBvbiBlbnYuaW9uaWMuZGl2aXNpb25OYW1lXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVudi5pb25pYy5kaXZpc2lvbk5hbWUgPT0gJ2FtYXpvbicpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSXRzIEFtYXpvbiwgc2VsZWN0IEFtYXpvbiBhbmQgR09cclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWREaXZpc2lvbiA9ICdhbWF6b24nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zZXREaXZpc2lvbigpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5vdCBBbWF6b24sIHJlbW92ZSBBbWF6b24gZnJvbSB0aGUgbGlzdC5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGV4Y2x1c2lvbnMgPSBbMjA2XTsgLy8gYWRkIGFueSBkaXZpc2lvbnMgdGhhdCBoYXZlIHRoZWlyIG93biBhcHAgdG8gdGhpcyBhcnJheS5cclxuICAgICAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHZtLmRpdmlzaW9ucywgZnVuY3Rpb24gKHZhbHVlLCBrZXkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChleGNsdXNpb25zLmluZGV4T2YocGFyc2VJbnQodmFsdWUuRGl2aXNpb25JRCkpICE9IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gdm0uZGl2aXNpb25zLmluZGV4T2YodmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLmRpdmlzaW9ucy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkRGl2aXNpb24gPSB2bS5kaXZpc2lvbnNbMF0uQWxpYXM7XHJcbiAgICAgICAgICAgICAgICB2bS5pc0RpdmlzaW9uTG9hZGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XHJcbiAgICAgICAgICAgIGlmIChlbnYuaXNJb25pYyAmJiBlbnYuaXNJb25pY0RldmljZSAmJiBlbnYuaW9uaWMuZGl2aXNpb25OYW1lID09ICdhbWF6b24nKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBJdHMgQW1hem9uLCBzZWxlY3QgQW1hem9uIGFuZCBHT1xyXG4gICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWREaXZpc2lvbiA9ICdhbWF6b24nO1xyXG4gICAgICAgICAgICAgICAgdm0uc2V0RGl2aXNpb24oKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBHZW9Mb2NhdGlvblNlcnZpY2UuZ2V0Q3VycmVudFBvc2l0aW9uKCkudGhlbihmdW5jdGlvbiAocG9zaXRpb24pIHtcclxuICAgICAgICAgICAgICAgIHZhciBsYXRpdHVkZSA9IHBvc2l0aW9uLmNvb3Jkcy5sYXRpdHVkZVxyXG4gICAgICAgICAgICAgICAgdmFyIGxvbmdpdHVkZSA9IHBvc2l0aW9uLmNvb3Jkcy5sb25naXR1ZGVcclxuICAgICAgICAgICAgICAgIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbnNCeUxvY2F0aW9uKGxhdGl0dWRlLCBsb25naXR1ZGUpLnRoZW4ocG9wdWxhdGVEaXZpc2lvbnMsIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmlzRGl2aXNpb25Mb2FkZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNob3dEaXZpc2lvbkRyb3Bkb3duID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIENvbW1vblNlcnZpY2UuR2V0U3RhdGVzV2l0aERpdmlzaW9ucygpLnRoZW4oXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uc3RhdGVzID0gcmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnN0YXRlcy5zcGxpY2UoMCwgMCwgbm9TdGF0ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uc2VsZWN0ZWRTdGF0ZSA9IHZtLnN0YXRlc1swXS5JZDtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcignJywgXCJDb3VsZCBub3QgbG9hZCBzdGF0ZXMgbGlzdC4gUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci5cIilcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAvL0RpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbnMoKVxyXG4gICAgICAgICAgICAvLyAgICAudGhlbihwb3B1bGF0ZURpdmlzaW9ucywgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgIC8vICAgICAgICB2bS5pc0RpdmlzaW9uTG9hZGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgLy8gICAgICAgIHZtLnNob3dEaXZpc2lvbkRyb3Bkb3duID0gZmFsc2U7XHJcbiAgICAgICAgICAgIC8vICAgIH0pXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLnJlbG9hZFBhZ2UgPSBmdW5jdGlvbiAoKSB7ICR3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7IH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNldERpdmlzaW9uKCkge1xyXG4gICAgICAgICAgICBpZiAodm0uc2VsZWN0ZWREaXZpc2lvbiAhPSBub0RpdmlzaW9uLkFsaWFzKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYWxpYXMgPSB2bS5zZWxlY3RlZERpdmlzaW9uO1xyXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJ2Rhc2hib2FyZC8nICsgYWxpYXMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIGZldGNoRGl2aXNpb25zRm9yU2VsZWN0ZWRTdGF0ZSgpIHtcclxuICAgICAgICAgICAgaWYgKHZtLnNlbGVjdGVkU3RhdGUgIT0gbm9TdGF0ZS5JZCkge1xyXG4gICAgICAgICAgICAgICAgdm0uZGl2aXNpb25zID0gW107XHJcbiAgICAgICAgICAgICAgICB2bS5kaXZpc2lvbnMuc3BsaWNlKDAsIDAsIG5vRGl2aXNpb24pO1xyXG4gICAgICAgICAgICAgICAgRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uQnlTdGF0ZSh2bS5zZWxlY3RlZFN0YXRlKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKHBvcHVsYXRlRGl2aXNpb25zLCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uaXNEaXZpc2lvbkxvYWRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNob3dEaXZpc2lvbkRyb3Bkb3duID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gU3RhcnQgb2YgY29kZSBmb3IgSW9uaWNcclxuICAgICAgICBpZiAoZW52LmlzSW9uaWMpIHtcclxuICAgICAgICAgICAgdm0uZW52ID0gZW52LmlvbmljLmVudjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB2bS5lbnYgPSAnJztcclxuICAgICAgICB9XHJcbiAgICAgICAgdm0ucmVmcmVzaCA9IGZ1bmN0aW9uIChyZWZyZXNoZXIpIHtcclxuICAgICAgICAgICAgYWN0aXZhdGUoKTtcclxuICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdzY3JvbGwucmVmcmVzaENvbXBsZXRlJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIEVuZCBvZiBjb2RlIGZvciBJb25pY1xyXG5cclxuICAgIH1cclxuICAgIFxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0ZvcmdvdFBhc3N3b3JkQ29udHJvbGxlcicsIEZvcmdvdFBhc3N3b3JkQ29udHJvbGxlcik7XHJcblxyXG4gICAgRm9yZ290UGFzc3dvcmRDb250cm9sbGVyLiRpbmplY3QgPSBbJyRzY29wZScsICckc3RhdGUnLCAnZW52JywgJ1Bhc3N3b3JkU2VydmljZScsICdhdXRoU2VydmljZScsICd2Y1JlY2FwdGNoYVNlcnZpY2UnLCAnRGl2aXNpb25TZXJ2aWNlJywgJ1BvcnRhbFV0aWxpdHlTZXJ2aWNlJywgJ01lc3NhZ2VTZXJ2aWNlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gRm9yZ290UGFzc3dvcmRDb250cm9sbGVyKCRzY29wZSwgJHN0YXRlLCBlbnYsIFBhc3N3b3JkU2VydmljZSwgYXV0aFNlcnZpY2UsIHZjUmVjYXB0Y2hhU2VydmljZSwgRGl2aXNpb25TZXJ2aWNlLCBQb3J0YWxVdGlsaXR5U2VydmljZSwgTWVzc2FnZVNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLmNhcHRjaGFQdWJsaWNLZXkgPSBlbnYuY2FwdGNoYVB1YmxpY0tleTtcclxuICAgICAgICB2bS5XaWRnZXRDcmVhdGUgPSB3aWRnZXRDcmVhdGU7XHJcbiAgICAgICAgdm0uc2V0Q2FwdGNoYVJlc3BvbnNlID0gc2V0Q2FwdGNoYVJlc3BvbnNlO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHZtLnZlcmlmeUVtYWlsID0gdmVyaWZ5RW1haWw7XHJcbiAgICAgICAgdm0uY2FuY2VsID0gY2FuY2VsO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHZhciB3aWRnZXRJZCA9IC0xO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBzZXRDYXB0Y2hhUmVzcG9uc2UocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgYXV0aFNlcnZpY2UudmVyaWZ5Q2FwdGNoYShyZXNwb25zZSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3VsdC5zdWNjZXNzKVxyXG4gICAgICAgICAgICAgICAgICAgIHZjUmVjYXB0Y2hhU2VydmljZS5yZWxvYWQod2lkZ2V0SWQpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHdpZGdldENyZWF0ZShfd2lkZ2V0SWQpIHtcclxuICAgICAgICAgICAgd2lkZ2V0SWQgPSBfd2lkZ2V0SWQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIGNhbmNlbCgpIHtcclxuICAgICAgICAgICAgJHN0YXRlLmdvKCdsb2dpbk9uZU1WJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIHZlcmlmeUVtYWlsKCkge1xyXG5cclxuICAgICAgICAgICAgUGFzc3dvcmRTZXJ2aWNlLlNlbmRQYXNzY29kZSh2bS5FbWFpbCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEucmVzdWx0LkNoYW5nZVN0YXR1cylcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCd2ZXJpZnktdXBkYXRlLXBhc3N3b3JkJywgeyBvYmo6IHsgZW1haWw6IHZtLkVtYWlsIH0gfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmlzQ2xpY2tlZCA9ICF2bS5pc0NsaWNrZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2VTZXJ2aWNlLnNob3dFcnJvcihyZXNwb25zZS5kYXRhLnJlc3VsdC5DaGFuZ2VTdGF0dXNEZXNjcmlwdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgdm0uaXNDbGlja2VkID0gIXZtLmlzQ2xpY2tlZDtcclxuICAgICAgICAgICAgICAgIE1lc3NhZ2VTZXJ2aWNlLnNob3dFcnJvcihlcnIpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBTdGFydCBvZiBjb2RlIGZvciBJb25pY1xyXG4gICAgICAgIHZtLmlvbmljSW5jbHVkZSA9ICdhcHAvc2hhcmVkL2xvZ2luL2ZvcmdvdC1wYXNzd29yZC5odG1sJztcclxuICAgICAgICB2bS5pb25pY0N1c3RvbUNsYXNzTmFtZSA9ICdpb25pYy1vbmVtdi1sb2dpbic7XHJcbiAgICAgICAgdm0uaW9uaWNIaWRlTmF2QmFyID0gZmFsc2U7XHJcbiAgICAgICAgdm0uaW9uaWNVc2VSZWZyZXNoZXIgPSBmYWxzZTtcclxuICAgICAgICB2bS5zaG93UmVjYXB0Y2hhID0gIWVudi5pc0lvbmljO1xyXG4gICAgICAgIC8vIEVuZCBvZiBjb2RlIGZvciBJb25pY1xyXG5cclxuICAgICAgICBhY3RpdmF0ZSgpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcclxuICAgICAgICAgICAgdmFyIGRpdmlzaW9uSWQgPSBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpO1xyXG4gICAgICAgICAgICBpZiAoIVBvcnRhbFV0aWxpdHlTZXJ2aWNlLmhhc1ZhbHVlKGRpdmlzaW9uSWQpKVxyXG4gICAgICAgICAgICAgICAgJHN0YXRlLmdvKFwiZGl2aXNpb25cIik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0xvZ2luQ29udHJvbGxlcicsIExvZ2luQ29udHJvbGxlcik7XHJcblxyXG4gICAgTG9naW5Db250cm9sbGVyLiRpbmplY3QgPSBbJyRsb2NhdGlvbicsICckc2NvcGUnLCAnJHJvb3RTY29wZScsIFxyXG4gICAgICAgICdhdXRoU2VydmljZScsICdlbnYnLCAnTWVzc2FnZVNlcnZpY2UnLCAnRGl2aXNpb25TZXJ2aWNlJywgJ0NvbmZpZ0ZhY3RvcnknLFxyXG4gICAgICAgICdHZW9Mb2NhdGlvblNlcnZpY2UnLCAnU2VydmljZUFyZWFTZXJ2aWNlJywgJyR0aW1lb3V0JywgJyR3aW5kb3cnLCdQYWdlU2VydmljZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIExvZ2luQ29udHJvbGxlcigkbG9jYXRpb24sICRzY29wZSwgJHJvb3RTY29wZSwgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRoU2VydmljZSwgZW52LCBNZXNzYWdlU2VydmljZSwgRGl2aXNpb25TZXJ2aWNlLCBDb25maWdGYWN0b3J5LCBHZW9Mb2NhdGlvblNlcnZpY2UsIFNlcnZpY2VBcmVhU2VydmljZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aW1lb3V0LCAkd2luZG93LCBQYWdlU2VydmljZSkge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7ICAgICAgICBcclxuICAgICAgICB2YXIgZGl2aXNpb24gPSB7fTtcclxuICAgICAgICB2YXIgZGl2aXNpb25TdXBwb3J0c0ZlZWQgPSBmYWxzZTtcclxuICAgICAgICB2bS5tZXNzYWdlID0gXCJcIjtcclxuICAgICAgICAvL3ZtLmFsaWFzID0gJyc7XHJcbiAgICAgICAgdm0ucHJvdmlkZXJzID0gW107XHJcbiAgICAgICAgJHNjb3BlLmhpZGVIZWFkZXIgPSAkbG9jYXRpb24ucGF0aCgpID09PSAnL2xvZ2luJztcclxuICAgICAgICB2bS5pc0FtYXpvblByb3ZpZGVyID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHZtLm5hdmlnYXRlVG9Ib21lID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB3aW5kb3cuaGlzdG9yeS5iYWNrKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uYWxsb3dlZFRvTG9naW5PclJlZ2lzdGVyID0gZmFsc2U7XHJcbiAgICAgICAgdm0ubG9naW5PclJlZ2lzdGVyTWVzc2FnZSA9ICcnO1xyXG4gICAgICAgIHZtLmhhc0dwc0JlZW5DaGVja2VkID0gZmFsc2U7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2UgPSBQYWdlU2VydmljZTtcclxuICAgICAgICB2bS5QYWdlU2VydmljZS5zZXRUaXRsZSgnV2hhdHMgTmV3Jyk7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2Uuc2V0SGVhZGxpbmUoJ0xhdGVzdCBTZXJ2aWNlIFVwZGF0ZXMnKTtcclxuICAgICAgICB2YXIgYWN0aXZhdGUgPSBmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgICAgICAgICBEaXZpc2lvblNlcnZpY2VcclxuICAgICAgICAgICAgICAgIC5nZXREaXZpc2lvbkluZm8oKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4ob25EaXZpc2lvblN1Y2Nlc3MsIG9uRGl2aXNpb25GYWlsdXJlKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRTeXN0ZW1QYXJhbXMoKSB7XHJcbiAgICAgICAgICAgIENvbmZpZ0ZhY3RvcnlcclxuICAgICAgICAgICAgICAgIC5nZXREaXZpc2lvblBhcmFtZXRlcnMoZGl2aXNpb24uRGl2aXNpb25JRClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChwYXJhbXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocGFyYW1zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpdmlzaW9uU3VwcG9ydHNGZWVkID0gcGFyYW1zLkRpdmlzaW9uU3VwcG9ydHNGZWVkXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gZXZhbChwYXJhbXMuRGl2aXNpb25TdXBwb3J0c0ZlZWQudG9Mb3dlckNhc2UoKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFsbG93UmVnaXN0ZXJJZmZHcHNJc09uID0gcGFyYW1zLkFsbG93UmVnaXN0ZXJJZmZHcHNJc09uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBldmFsKHBhcmFtcy5BbGxvd1JlZ2lzdGVySWZmR3BzSXNPbilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWxsb3dSZWdpc3RlcklmZkdwc0lzT24pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzR3BzRW5hYmxlZCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uYWxsb3dlZFRvTG9naW5PclJlZ2lzdGVyID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLmhhc0dwc0JlZW5DaGVja2VkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGlzR3BzRW5hYmxlZCgpIHtcclxuICAgICAgICAgICAgR2VvTG9jYXRpb25TZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICAgICAuZ2V0Q3VycmVudFBvc2l0aW9uKClcclxuICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChwb3NpdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIGlmIChwb3NpdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBpc0luU2VydmljZUFyZWEocG9zaXRpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc2FibGVMb2dpbignWW91ciBkZXZpY2UgaXMgdW5hYmxlIHRvIGRldGVybWluZSB5b3VyIEdQUyBsb2NhdGlvbi4nKTtcclxuICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlTG9naW4oJ0dQUyBtdXN0IGJlIGVuYWJsZWQgdG8gdXNlIHRoaXMgYXBwbGljYXRpb24uJyk7XHJcbiAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBpc0luU2VydmljZUFyZWEocG9zaXRpb24pIHtcclxuICAgICAgICAgICAgdm0uaGFzR3BzQmVlbkNoZWNrZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBTZXJ2aWNlQXJlYVNlcnZpY2VcclxuICAgICAgICAgICAgICAgIC5pc0luU2VydmljZUFyZWEoZGl2aXNpb24uRGl2aXNpb25JRCwgcG9zaXRpb24uY29vcmRzLmxhdGl0dWRlLCBwb3NpdGlvbi5jb29yZHMubG9uZ2l0dWRlKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmICFyZXNwb25zZS5kYXRhLnJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlTG9naW4oJ1lvdSBtdXN0IGJlIHdpdGhpbiB0aGUgc2VydmljZSBhcmVhIHRvIGxvZ2luIG9yIHJlZ2lzdGVyLicpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uYWxsb3dlZFRvTG9naW5PclJlZ2lzdGVyID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICBkaXNhYmxlTG9naW4oJ1dlIGFyZSB1bmFibGUgdG8gdmVyaWZ5IHlvdXIgR1BTIGxvY2F0aW9uLiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLicpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiBkaXNhYmxlTG9naW4obWVzc2FnZSkge1xyXG4gICAgICAgICAgICB2bS5oYXNHcHNCZWVuQ2hlY2tlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIHZtLmFsbG93ZWRUb0xvZ2luT3JSZWdpc3RlciA9IGZhbHNlO1xyXG4gICAgICAgICAgICB2bS5sb2dpbk9yUmVnaXN0ZXJNZXNzYWdlID0gbWVzc2FnZTtcclxuICAgICAgICAgICAgLy8gbmF2aWdhdGUgdG8gZGFzaGJvYXJkIGFmdGVyIDEwIHNlY29uZHMuXHJcbiAgICAgICAgICAgIHZtLnJlZGlyZWN0VGltZW91dCA9ICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICR3aW5kb3cubG9jYXRpb24ucmVwbGFjZSgnIy8nKTtcclxuICAgICAgICAgICAgfSwgMTAwMDApO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBraWxsIHRoZSB0aW1lb3V0IGlmIHRoZSB1c2VyIG5hdmlnYXRlcyBhd2F5IGJlZm9yZSAxMCBzZWNvbmRzLlxyXG4gICAgICAgICRzY29wZS4kb24oXCIkZGVzdHJveVwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICh2bS5yZWRpcmVjdFRpbWVvdXQpIHtcclxuICAgICAgICAgICAgICAgICR0aW1lb3V0LmNhbmNlbCh2bS5yZWRpcmVjdFRpbWVvdXQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgZnVuY3Rpb24gb25EaXZpc2lvblN1Y2Nlc3MocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICBkaXZpc2lvbiA9IHJlc3BvbnNlLmRhdGEucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgdm0uYWxpYXMgPSBkaXZpc2lvbi5BbGlhcztcclxuICAgICAgICAgICAgICAgIHZhciBsb2dpbnMgPSByZXNwb25zZS5kYXRhLnJlc3VsdC5BbGxvd2VkTG9naW5zO1xyXG4gICAgICAgICAgICAgICAgdmFyIHByb3ZpZGVycyA9IGxvZ2lucy5zcGxpdCgnLCcpO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm92aWRlcnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pc0FtYXpvblByb3ZpZGVyID0gcHJvdmlkZXJzW2ldLnRvTG93ZXJDYXNlKCkgPT0gXCJhbWF6b25cIjtcclxuICAgICAgICAgICAgICAgICAgICB2bS5wcm92aWRlcnMucHVzaCh7ICduYW1lJzogcHJvdmlkZXJzW2ldIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGdldFN5c3RlbVBhcmFtcygpO1xyXG4gICAgICAgICAgICB9ICAgICAgICAgICAgXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gb25EaXZpc2lvbkZhaWx1cmUoZXJyb3IpIHtcclxuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCJkYXNoYm9hcmQvXCIpO1xyXG4gICAgICAgIH0gICAgICAgIFxyXG5cclxuICAgICAgICBhY3RpdmF0ZSgpO1xyXG5cclxuICAgICAgICB2bS5pb25pY1VzZUV4dGVybmFsTGluayA9IGVudi5pb25pYyA9PSBudWxsID8gZmFsc2UgOiAgZW52LmlvbmljLmFwcFZlcnNpb24gPT0gJ3Y5LjYuNTInO1xyXG5cclxuICAgICAgICB2bS5hdXRoRXh0ZXJuYWxQcm92aWRlciA9IGZ1bmN0aW9uIChwcm92aWRlcikge1xyXG4gICAgICAgICAgICBpZiAocHJvdmlkZXIgPT0gJ09uZU1WJyB8fCBwcm92aWRlciA9PSAnT25lIE1WJylcclxuICAgICAgICAgICAge1xyXG5cclxuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCdsb2dpbk9uZU1WJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocHJvdmlkZXIgPT0gJ0dvb2dsZScgJiYgJCgnYm9keScpLmhhc0NsYXNzKCdwbGF0Zm9ybS1jb3Jkb3ZhJykpIHtcclxuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCdsb2dpbkdvb2dsZUlvbmljJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIHJlZGlyZWN0VXJpID0gbG9jYXRpb24ucHJvdG9jb2wgKyAnLy8nICsgbG9jYXRpb24uaG9zdCArICcnO1xyXG4gICAgICAgICAgICAvLyBmb3IgSU9OSUNcclxuICAgICAgICAgICAgaWYgKCQoJ2JvZHknKS5oYXNDbGFzcygncGxhdGZvcm0taW9zJykgfHwgJCgnYm9keScpLmhhc0NsYXNzKCdwbGF0Zm9ybS1hbmRyb2lkJykpIHtcclxuICAgICAgICAgICAgICAgIC8vIGZvciB0aGUgbW9iaWxlIElPTklDIGFwcCBpT1MgYW5kIEFuZHJvaWQgdmVyc2lvbiwgXHJcbiAgICAgICAgICAgICAgICAvLyB0aGlzIGlzIGEgZHVtbXkgVVJMIHRoYXQgd2lsbCB3b3JrIGluIHRoZSBJbkFwcEJyb3dzZXIgcGx1Z2luXHJcbiAgICAgICAgICAgICAgICByZWRpcmVjdFVyaSA9ICdodHRwOi8vbG9jYWxob3N0L2NhbGxiYWNrLyc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCQoJ2JvZHknKS5oYXNDbGFzcygncGxhdGZvcm0tYnJvd3NlcicpKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBmb3IgcnVubmluZyBJT05JQyB2ZXJzaW9uIGxvY2FsbHkuXHJcbiAgICAgICAgICAgICAgICByZWRpcmVjdFVyaSArPSAnL2luZGV4LmlvbmljLmh0bWwjJztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICB2YXIgZXh0ZXJuYWxQcm92aWRlclVybCA9IGVudi5hdXRoU2VydmVyVXJsICArIFwiQWNjb3VudC9FeHRlcm5hbExvZ2luP3Byb3ZpZGVyPVwiICsgcHJvdmlkZXJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBcIiZyZXNwb25zZV90eXBlPXRva2VuJmNsaWVudF9pZD1cIiArIGVudi5hdWRpZW5jZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIFwiJnJlZGlyZWN0X3VyaT1cIiArIHJlZGlyZWN0VXJpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgXCImZGl2aXNpb25TdXBwb3J0c0ZlZWQ9XCIgKyBkaXZpc2lvblN1cHBvcnRzRmVlZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIFwiJmRpdmlzaW9uSWQ9XCIgKyBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpO1xyXG4gICAgICAgICAgICAvLyBJZiBib2R5IGhhcyBjbGFzcyAncGxhdGZvcm0tY29yZG92YScsIHRoZW4gd2UgYXJlIG9uIGEgbW9iaWxlIGRldmljZS5cclxuICAgICAgICAgICAgLy8gV2hlbiBvbiBhIG1vYmlsZSBkZXZpY2UsIHdlIG5lZWQgdG8gdXNlIHRoZSBjb3Jkb3ZhIGluYXBwYnJvd3NlclxyXG4gICAgICAgICAgICBpZiAoJCgnYm9keScpLmhhc0NsYXNzKCdwbGF0Zm9ybS1jb3Jkb3ZhJykpIHtcclxuICAgICAgICAgICAgICAgIHZhciB0YXJnZXQgPSAnX2JsYW5rJztcclxuICAgICAgICAgICAgICAgIHZhciBvcHRpb25zID0gJ2xvY2F0aW9uPW5vLHRvb2xiYXI9eWVzLGNsZWFyY2FjaGU9eWVzLGNsZWFyc2Vzc2lvbmNhY2hlPXllcyxjbG9zZWJ1dHRvbmNhcHRpb249QmFjayB0byBQYXNzZW5nZXIgQXBwLHRvb2xiYXI9eWVzLHRyYW5zaXRpb25zdHlsZT1jb3ZlcnZlcnRpY2FsJztcclxuICAgICAgICAgICAgICAgIHZhciByZWYgPSB3aW5kb3cub3BlbihleHRlcm5hbFByb3ZpZGVyVXJsLCB0YXJnZXQsIG9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgcmVmLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWRzdGFydCcsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChldmVudC51cmwuaW5kZXhPZignaHR0cDovL2xvY2FsaG9zdC9jYWxsYmFjay8jJykgPT0gMCB8fCBldmVudC51cmwuaW5kZXhPZignZmlsZTovLy8jLycpID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5ld0xvY2F0aW9uID0gZXZlbnQudXJsLnN1YnN0cmluZyhldmVudC51cmwuaW5kZXhPZignIycpLCBldmVudC51cmwubGVuZ3RoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVmLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IG5ld0xvY2F0aW9uO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgcmVmLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWRlcnJvcicsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdsb2FkZXJyb3I6JyArIEpTT04uc3RyaW5naWZ5KGV2ZW50KSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IGV4dGVybmFsUHJvdmlkZXJVcmw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBTdGFydCBvZiBjb2RlIGZvciBJb25pY1xyXG4gICAgICAgIHZtLmlvbmljSW5jbHVkZSA9ICdhcHAvc2hhcmVkL2xvZ2luL2xvZ2luLmh0bWwnO1xyXG4gICAgICAgIHZtLmlvbmljQ3VzdG9tQ2xhc3NOYW1lID0gJ2lvbmljLWxvZ2luLWNsYXNzJztcclxuICAgICAgICB2bS5pb25pY0hpZGVOYXZCYXIgPSB0cnVlO1xyXG4gICAgICAgIHZtLmlvbmljVXNlUmVmcmVzaGVyID0gZmFsc2U7XHJcbiAgICAgICAgLy8gRW5kIG9mIGNvZGUgZm9yIElvbmljXHJcbiAgICAgIFxyXG4gICAgfVxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ09uZU1WTG9naW5Db250cm9sbGVyJywgT25lTVZMb2dpbkNvbnRyb2xsZXIpO1xyXG5cclxuICAgIE9uZU1WTG9naW5Db250cm9sbGVyLiRpbmplY3QgPSBbJyRsb2NhdGlvbicsICckc2NvcGUnLCAnJHJvb3RTY29wZScsIFxyXG4gICAgICAgICdhdXRoU2VydmljZScsICdlbnYnLCAnTWVzc2FnZVNlcnZpY2UnLCAnRGl2aXNpb25TZXJ2aWNlJywgJ1BhZ2VTZXJ2aWNlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gT25lTVZMb2dpbkNvbnRyb2xsZXIoJGxvY2F0aW9uLCAkc2NvcGUsICRyb290U2NvcGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRoU2VydmljZSwgZW52LCBNZXNzYWdlU2VydmljZSwgRGl2aXNpb25TZXJ2aWNlLCBQYWdlU2VydmljZSkge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdm0ubG9naW4gPSBsb2dpbjtcclxuICAgICAgICB2bS5jYW5jZWwgPSBjYW5jZWxcclxuICAgICAgICB2bS5kaXZpc2lvbklkID0gRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKTtcclxuICAgICAgICB2bS5QYWdlU2VydmljZSA9IFBhZ2VTZXJ2aWNlO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlLnNldFRpdGxlKCdMb2dpbicpO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlLnNldEhlYWRsaW5lKCdXaXRoIHlvdXIgT05FTVYgYWNjb3VudCcpO1xyXG4gICAgICAgIGZ1bmN0aW9uIGNhbmNlbCgpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnZGFzaGJvYXJkLycpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmdW5jdGlvbiBsb2dpbigpIHtcclxuICAgICAgICAgICAgLy9jYWxsIG9uZSBtdiBsb2dpblxyXG4gICAgICAgICAgICB2YXIgcmVxdWVzdCA9IHtcclxuICAgICAgICAgICAgICAgIFVzZXJOYW1lOiB2bS51c2VybmFtZSxcclxuICAgICAgICAgICAgICAgIFBhc3N3b3JkOiB2bS5wYXNzd29yZCxcclxuICAgICAgICAgICAgICAgIERpdmlzaW9uSWQ6IHZtLmRpdmlzaW9uSWQsXHJcbiAgICAgICAgICAgICAgICBQcm92aWRlcjogJ012TG9naW4nXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgLy93aWxsIGNhbGwgYSBzZXJ2aWNlXHJcbiAgICAgICAgICAgIGF1dGhTZXJ2aWNlLmxvZ2luT25lTVYocmVxdWVzdCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnbG9nZ2VkSW4nLCBudWxsKTtcclxuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCdkYXNoYm9hcmQvJyk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2soZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIC8vY2FsbCBtZXNzYWdlIHNlcnZpY2VcclxuICAgICAgICAgICAgICAgIHZtLmlzQ2xpY2tlZCA9ICF2bS5pc0NsaWNrZWRcclxuICAgICAgICAgICAgICAgIGlmKGVycm9yKVxyXG4gICAgICAgICAgICAgICAgICAgIE1lc3NhZ2VTZXJ2aWNlLnNob3dFcnJvcihlcnJvci5NZXNzYWdlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBTdGFydCBvZiBjb2RlIGZvciBJb25pY1xyXG4gICAgICAgIHZtLmlvbmljSW5jbHVkZSA9ICdhcHAvc2hhcmVkL2xvZ2luL29uZW12LWxvZ2luLmh0bWwnO1xyXG4gICAgICAgIHZtLmlvbmljQ3VzdG9tQ2xhc3NOYW1lID0gJ2lvbmljLW9uZW12LWxvZ2luJztcclxuICAgICAgICB2bS5pb25pY0hpZGVOYXZCYXIgPSBmYWxzZTtcclxuICAgICAgICB2bS5pb25pY1VzZVJlZnJlc2hlciA9IGZhbHNlO1xyXG4gICAgICAgIC8vIEVuZCBvZiBjb2RlIGZvciBJb25pY1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ1ZlcmlmeVVwZGF0ZVBhc3N3b3JkQ29udHJvbGxlcicsIFZlcmlmeVVwZGF0ZVBhc3N3b3JkQ29udHJvbGxlcik7XHJcblxyXG4gICAgVmVyaWZ5VXBkYXRlUGFzc3dvcmRDb250cm9sbGVyLiRpbmplY3QgPSBbJyRzY29wZScsICckc3RhdGUnLCAnJHN0YXRlUGFyYW1zJywgJyRsb2NhdGlvbicsJ2VudicsICdQYXNzd29yZFNlcnZpY2UnLCAnTWVzc2FnZVNlcnZpY2UnLCAnYXV0aFNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBWZXJpZnlVcGRhdGVQYXNzd29yZENvbnRyb2xsZXIoJHNjb3BlLCAkc3RhdGUsICRzdGF0ZVBhcmFtcywgJGxvY2F0aW9uLCBlbnYsIFBhc3N3b3JkU2VydmljZSwgTWVzc2FnZVNlcnZpY2UsIGF1dGhTZXJ2aWNlKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS5zdWJtaXQgPSBzdWJtaXQ7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdm0uY2FwdGNoYVB1YmxpY0tleSA9IGVudi5jYXB0Y2hhUHVibGljS2V5O1xyXG4gICAgICAgIHZtLldpZGdldENyZWF0ZSA9IHdpZGdldENyZWF0ZTtcclxuICAgICAgICB2bS5zZXRDYXB0Y2hhUmVzcG9uc2UgPSBzZXRDYXB0Y2hhUmVzcG9uc2U7XHJcbiAgICAgICAgdm0uZW1haWwgPSAoJHN0YXRlUGFyYW1zLm9iaikgPyAkc3RhdGVQYXJhbXMub2JqLmVtYWlsIDogXCJcIjtcclxuICAgICAgICB2YXIgcXVlcnlTdHJpbmcgPSAkbG9jYXRpb24uc2VhcmNoKCk7XHJcbiAgICAgICAgaWYgKHF1ZXJ5U3RyaW5nKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKHF1ZXJ5U3RyaW5nLmVtYWlsKVxyXG4gICAgICAgICAgICAgICAgdm0uZW1haWwgPSBxdWVyeVN0cmluZy5lbWFpbDtcclxuICAgICAgICAgICAgaWYgKHF1ZXJ5U3RyaW5nLmRpdmlzaW9uKVxyXG4gICAgICAgICAgICAgICAgdm0uZGl2aXNpb24gPSBxdWVyeVN0cmluZy5kaXZpc2lvbjtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgfVxyXG4gICAgICBcclxuXHJcbiAgICAgICAgdmFyIHdpZGdldElkID0gLTE7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHNldENhcHRjaGFSZXNwb25zZShyZXNwb25zZSkge1xyXG4gICAgICAgICAgICBhdXRoU2VydmljZS52ZXJpZnlDYXB0Y2hhKHJlc3BvbnNlKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIGlmICghcmVzdWx0LnN1Y2Nlc3MpXHJcbiAgICAgICAgICAgICAgICAgICAgdmNSZWNhcHRjaGFTZXJ2aWNlLnJlbG9hZCh3aWRnZXRJZCk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gd2lkZ2V0Q3JlYXRlKF93aWRnZXRJZCkge1xyXG4gICAgICAgICAgICB3aWRnZXRJZCA9IF93aWRnZXRJZDtcclxuICAgICAgICB9XHJcblxyXG5cclxuXHJcbiAgICAgICBcclxuICAgICAgICBmdW5jdGlvbiBzdWJtaXQoKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKHZtLm5ld1Bhc3N3b3JkICE9IHZtLnJlcGVhdE5ld1Bhc3N3b3JkKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBNZXNzYWdlU2VydmljZS5zaG93RXJyb3IoXCJOZXcgYW5kIFJlcGVhdCBQYXNzd29yZHMgZG9uJ3QgbWF0Y2guXCIpXHJcbiAgICAgICAgICAgICAgICB2bS5pc0NsaWNrZWQgPSAhdm0uaXNDbGlja2VkO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBwYXNzd29yZERhdGEgPSB7XHJcbiAgICAgICAgICAgICAgICBUZW1wb3JhcnlDb2RlOiB2bS50ZW1wb3JhcnlDb2RlLFxyXG4gICAgICAgICAgICAgICAgRW1haWw6IHZtLmVtYWlsLFxyXG4gICAgICAgICAgICAgICAgTmV3UGFzc3dvcmQ6IHZtLm5ld1Bhc3N3b3JkXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgUGFzc3dvcmRTZXJ2aWNlLlZlcmlmeUFuZFVwZGF0ZVBhc3N3b3JkKHBhc3N3b3JkRGF0YSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0ICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEucmVzdWx0LkNoYW5nZVN0YXR1cykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oXCJsb2dpbk9uZU1WXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uaXNDbGlja2VkID0gIXZtLmlzQ2xpY2tlZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgTWVzc2FnZVNlcnZpY2Uuc2hvd0Vycm9yKHJlc3BvbnNlLmRhdGEucmVzdWx0LkNoYW5nZVN0YXR1c0Rlc2NyaXB0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBNZXNzYWdlU2VydmljZS5zaG93RXJyb3IoXCJDb3VsZCBub3QgdXBkYXRlIHBhc3N3b3JkXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmlzQ2xpY2tlZCA9ICF2bS5pc0NsaWNrZWQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIE1lc3NhZ2VTZXJ2aWNlLnNob3dFcnJvcihlcnIpO1xyXG4gICAgICAgICAgICAgICAgdm0uaXNDbGlja2VkID0gIXZtLmlzQ2xpY2tlZDtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICBcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFN0YXJ0IG9mIGNvZGUgZm9yIElvbmljXHJcbiAgICAgICAgdm0uaW9uaWNJbmNsdWRlID0gJ2FwcC9zaGFyZWQvbG9naW4vdmVyaWZ5LXVwZGF0ZS1wYXNzd29yZC5odG1sJztcclxuICAgICAgICB2bS5pb25pY0N1c3RvbUNsYXNzTmFtZSA9ICdpb25pYy1vbmVtdi1sb2dpbic7XHJcbiAgICAgICAgdm0uaW9uaWNIaWRlTmF2QmFyID0gZmFsc2U7XHJcbiAgICAgICAgdm0uaW9uaWNVc2VSZWZyZXNoZXIgPSBmYWxzZTtcclxuICAgICAgICB2bS5zaG93UmVjYXB0Y2hhID0gIWVudi5pc0lvbmljO1xyXG4gICAgICAgIC8vIEVuZCBvZiBjb2RlIGZvciBJb25pY1xyXG5cclxuICAgICAgICBhY3RpdmF0ZSgpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignTG9nb3V0Q29udHJvbGxlcicsIExvZ291dENvbnRyb2xsZXIpO1xyXG5cclxuICAgIExvZ291dENvbnRyb2xsZXIuJGluamVjdCA9IFsnJGxvY2F0aW9uJywgJyRyb290U2NvcGUnLCAnYXV0aFNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBMb2dvdXRDb250cm9sbGVyKCRsb2NhdGlvbiwgJHJvb3RTY29wZSxhdXRoU2VydmljZSkge1xyXG4gICAgICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgICAgYXV0aFNlcnZpY2UubG9nT3V0KCkudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnbG9nZ2Vkb3V0JywgbnVsbCk7XHJcbiAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCdkYXNoYm9hcmQvJyk7XHJcbiAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICBjb25zb2xlLmxvZygnVW5hYmxlIHRvIHNpZ24tb3V0IHVzZXIuJyk7XHJcbiAgICAgICAgICAgfSlcclxuICAgICAgICAgICBcclxuICAgIH1cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdNaW5BcHBTdXBwb3J0Q29udHJvbGxlcicsIE1pbkFwcFN1cHBvcnRDb250cm9sbGVyKTtcclxuXHJcbiAgICBNaW5BcHBTdXBwb3J0Q29udHJvbGxlci4kaW5qZWN0ID0gWyckcm9vdFNjb3BlJywgJyRsb2NhdGlvbicsICdEeW5hbWljQ29udGVudFNlcnZpY2UnLCAnUGFnZVNlcnZpY2UnLCAnRGl2aXNpb25TZXJ2aWNlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gTWluQXBwU3VwcG9ydENvbnRyb2xsZXIoJHJvb3RTY29wZSwgJGxvY2F0aW9uLCBEeW5hbWljQ29udGVudFNlcnZpY2UsIFBhZ2VTZXJ2aWNlLCBEaXZpc2lvblNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlID0gUGFnZVNlcnZpY2U7XHJcbiAgICAgICAgdmFyIF9lcnJvciA9ICdUaGlzIHZlcnNpb24gaXMgbm8gbG9uZ2VyIHN1cHBvcnRlZC4gUGxlYXNlIGRvd25sb2FkIHRoZSBsYXRlc3QgdmVyc2lvbiBmcm9tIGFwcCBzdG9yZSc7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2Uuc2V0VGl0bGUoJ0FwcCBFcnJvcicpO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlLnNldEhlYWRsaW5lKCdUaGlzIHZlcnNpb24gaXMgbm8gbG9uZ2VyIHN1cHBvcnRlZCcpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcclxuICAgICAgICAgICAgaWYgKERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCkpXHJcbiAgICAgICAgICAgICAgICBEaXZpc2lvblNlcnZpY2VcclxuICAgICAgICAgICAgICAgICAgICAgLmdldERpdmlzaW9uSW5mbygpXHJcbiAgICAgICAgICAgICAgICAgLnRoZW4oaGFuZGxlU3VjY2VzcywgaGFuZGxlRmFpbHVyZSk7XHJcbiAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgIGhhbmRsZUZhaWx1cmUoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGhhbmRsZVN1Y2Nlc3MocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGl2aXNpb24gPSByZXNwb25zZS5kYXRhLnJlc3VsdDtcclxuICAgICAgICAgICAgICAgIHZtLkVycm9yTWVzc2FnZSA9IGRpdmlzaW9uLk1pbkFwcEVycm9yXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGhhbmRsZUZhaWx1cmUoKSB7XHJcbiAgICAgICAgICAgIHZtLkVycm9yTWVzc2FnZSA9IF9lcnJvcjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGFjdGl2YXRlKCk7XHJcblxyXG4gICAgICAgIC8vIFN0YXJ0IG9mIGNvZGUgZm9yIElvbmljXHJcbiAgICAgICAgLy92bS5pb25pY0luY2x1ZGUgPSAnYXBwL3NoYXJlZC93aGF0cy1uZXcvd2hhdHMtbmV3Lmh0bWwnO1xyXG4gICAgICAgIC8vdm0uaW9uaWNDdXN0b21DbGFzc05hbWUgPSAnaW9uaWMtd2hhdHMtbmV3IGNhcmQnO1xyXG4gICAgICAgIC8vdm0uaW9uaWNIaWRlTmF2QmFyID0gZmFsc2U7XHJcbiAgICAgICAgLy92bS5pb25pY1VzZVJlZnJlc2hlciA9IHRydWU7XHJcbiAgICAgICAgLy92bS5pb25pY1B1bGxpbmdUZXh0ID0gJ1JlZnJlc2gnO1xyXG4gICAgICAgIC8vdm0uaW9uaWNSZWZyZXNoaW5nVGV4dCA9ICdMb2FkaW5nJztcclxuICAgICAgICAvL3ZtLmlvbmljU3Bpbm5lciA9ICdzcGlyYWwnOyAvLyBub25lIHRvIGRpc2FibGUuXHJcbiAgICAgICAgLy92bS5yZWZyZXNoID0gZnVuY3Rpb24gKHJlZnJlc2hlcikge1xyXG4gICAgICAgIC8vICAgIGdldERhdGEoKTtcclxuICAgICAgICAvLyAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3Njcm9sbC5yZWZyZXNoQ29tcGxldGUnKTtcclxuXHJcbiAgICAgICAgLy99XHJcbiAgICAgICAgLy8gRW5kIG9mIGNvZGUgZm9yIElvbmljXHJcbiAgICB9XHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnb25lTVZBcHAnKS5jb250cm9sbGVyKCduYXYnLCBuYXYpO1xyXG5cclxuXHJcbiAgICBuYXYuJGluamVjdCA9IFsgJyRzY29wZScsICckbG9jYXRpb24nLCAnJHJvb3RTY29wZScsICckdWliTW9kYWwnLCAnJHRpbWVvdXQnLCAnJGludGVydmFsJyxcclxuICAgICAgICAgICAgICAgICAgICAnYXV0aFNlcnZpY2UnLCAnU2NoZWR1bGVTZXJ2aWNlJywgJ0RpdmlzaW9uU2VydmljZScsJ09uZU12U2VydmljZXMnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBuYXYoJHNjb3BlLCRsb2NhdGlvbiwgJHJvb3RTY29wZSwgJHVpYk1vZGFsLCAkdGltZW91dCwgJGludGVydmFsLFxyXG4gICAgICAgICAgICAgICAgICAgIGF1dGhTZXJ2aWNlLCBTY2hlZHVsZVNlcnZpY2UsIERpdmlzaW9uU2VydmljZSxPbmVNdlNlcnZpY2VzKSB7XHJcblxyXG4gICAgICAgICRzY29wZS50aXRsZSA9ICdNT0JJJztcclxuICAgICAgICAkc2NvcGUuaGFzQWN0aXZlVHJpcCA9IGZhbHNlO1xyXG4gICAgICAgIHZhciBhdXRvUmVmcmVzaCA9IHVuZGVmaW5lZDtcclxuICAgICAgICB2YXIgbW9kYWxWZWhpY2xlQXJyaXZpbmcgPSBmYWxzZTtcclxuICAgICAgICB2YXIgbW9kYWxWZWhpY2xlQXJyaXZlZCA9IGZhbHNlO1xyXG4gICAgICAgICRzY29wZS5wYXJlbnRTdGF0ZSA9IHVuZGVmaW5lZDtcclxuICAgICAgICB2YXIgYWxsb3dlZFNlcnZpY2VzID0gIERpdmlzaW9uU2VydmljZS5nZXRBbGxvd2VkU2VydmljZXMoKTsgICAgICAgXHJcblxyXG4gICAgICAgIHZhciBtZW51cyA9IFtcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiY29tbXV0ZXJcIixcclxuICAgICAgICAgICAgICAgIFwic2VydmljZVwiOiBcImNvbW11dGVyXCIsXHJcbiAgICAgICAgICAgICAgICBcInVybFwiOiBcImNvbW11dGVyL2hvbWUtY29tbXV0ZXJcIixcclxuICAgICAgICAgICAgICAgIFwib3JkZXJcIjogNixcclxuICAgICAgICAgICAgICAgIFwiY2xhc3NcIjogXCJsaW5rLS1jb21tdXRlclwiLFxyXG4gICAgICAgICAgICAgICAgXCJsZXZlbFwiOiAxLFxyXG4gICAgICAgICAgICAgICAgXCJpc1NlcnZpY2VNZW51XCIgOnRydWUsXHJcbiAgICAgICAgICAgICAgICBcInN1YlBhZ2VzXCI6IFtcclxuICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiQWR2YW5jZWQgUmVzZXJ2YXRpb25zXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICBcInVybFwiOiBcImNvbW11dGVyL2Fkdi1zY2hlZHVsZS1zZXR1cFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgXCJzZXJ2aWNlXCI6IFwiY29tbXV0ZXJcIixcclxuICAgICAgICAgICAgICAgICAgICAgIFwic2hvd09mZmxpbmVcIjogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICBcIm9yZGVyXCI6IDdcclxuICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiQnVzIFN0b3BzXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICBcInVybFwiOiBcImNvbW11dGVyL2FsbC1zdG9wc1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgXCJzZXJ2aWNlXCI6IFwiY29tbXV0ZXJcIixcclxuICAgICAgICAgICAgICAgICAgICAgIFwib3JkZXJcIjogOFxyXG4gICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJQdWJsaXNoZWQgU2NoZWR1bGVcIixcclxuICAgICAgICAgICAgICAgICAgICAgIFwidXJsXCI6IFwiY29tbXV0ZXIvcHVibGlzaGVkLXNjaGVkdWxlXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICBcInNlcnZpY2VcIjogXCJjb21tdXRlclwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgXCJvcmRlclwiOiA5XHJcbiAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiZHJ0XCIsXHJcbiAgICAgICAgICAgICAgXCJpc1NlcnZpY2VNZW51XCIgOnRydWUsXHJcbiAgICAgICAgICAgICAgXCJvcmRlclwiOiAxMCxcclxuICAgICAgICAgICAgICBcInVybFwiOiBcIm9uLWRlbWFuZC9yZXNlcnZhdGlvbnNcIixcclxuICAgICAgICAgICAgICBcInNlcnZpY2VcIjogXCJkcnRcIixcclxuICAgICAgICAgICAgICBcImNsYXNzXCI6IFwibGluay0tZGVtYW5kXCIsXHJcbiAgICAgICAgICAgICAgXCJzaG93T2ZmbGluZVwiOiBmYWxzZSxcclxuICAgICAgICAgICAgICBcImxldmVsXCI6IDEsXHJcbiAgICAgICAgICAgICAgXCJzdWJQYWdlc1wiOiBbXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiQWN0aXZlIFRyaXBcIixcclxuICAgICAgICAgICAgICAgICAgICBcInVybFwiOiBcIm9uLWRlbWFuZC9hY3RpdmUtdHJpcFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIFwic2VydmljZVwiOiBcImRydFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIFwic2hvd09mZmxpbmVcIjogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgXCJzaG93QWN0aXZlXCI6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIFwib3JkZXJcIjogMTFcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBdXHJcblxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAgICBcIm5hbWVcIjogXCJmaXhlZFwiLFxyXG4gICAgICAgICAgICAgIFwiaXNTZXJ2aWNlTWVudVwiIDp0cnVlLFxyXG4gICAgICAgICAgICAgIFwidXJsXCI6IFwiZml4ZWQtcm91dGUvbGFuZGluZ1wiLFxyXG4gICAgICAgICAgICAgIFwic2VydmljZVwiOiBcImZpeGVkXCIsXHJcbiAgICAgICAgICAgICAgXCJjbGFzc1wiOiBcImxpbmstLWZpeGVkXCIsXHJcbiAgICAgICAgICAgICAgXCJvcmRlclwiOiAxMixcclxuICAgICAgICAgICAgICBcImxldmVsXCI6IDEsXHJcbiAgICAgICAgICAgICAgc3ViUGFnZXM6IFtcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJSb3V0ZXNcIixcclxuICAgICAgICAgICAgICAgICAgICBcInVybFwiOiBcImZpeGVkLXJvdXRlL2FsbFJvdXRlc1wiLFxyXG4gICAgICAgICAgICAgICAgICAgIFwic2VydmljZVwiOiBcImZpeGVkXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgXCJvcmRlclwiOiAxM1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjogXCJTdG9wc1wiLFxyXG4gICAgICAgICAgICAgICAgICAgIFwidXJsXCI6IFwiZml4ZWQtcm91dGUvc3RvcHNcIixcclxuICAgICAgICAgICAgICAgICAgICBcInNlcnZpY2VcIjogXCJmaXhlZFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIFwib3JkZXJcIjogMTRcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiU2NoZWR1bGVcIixcclxuICAgICAgICAgICAgICAgICAgICBcInVybFwiOiBcImZpeGVkLXJvdXRlL3NjaGVkdWxlXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgXCJzZXJ2aWNlXCI6IFwiZml4ZWRcIixcclxuICAgICAgICAgICAgICAgICAgICBcIm9yZGVyXCI6IDE1XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIFwibmFtZVwiOiBcIlB1Ymxpc2hlZCBTY2hlZHVsZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgIFwidXJsXCI6IFwiaHR0cDovL3RoZWJ1cy5tb2JpL2NvbnRlbnQvZG9jdW1lbnRzL2Ftei1wdWJsaXNoZWQtc2NoZWR1bGUucGRmXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgXCJzZXJ2aWNlXCI6IFwiZml4ZWRcIixcclxuICAgICAgICAgICAgICAgICAgICBcImlzRXh0ZXJuYWxcIjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICBcIm9yZGVyXCI6IDE2XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgXVxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAgICBcIm5hbWVcIjogXCJNeSBUcmlwc1wiLFxyXG4gICAgICAgICAgICAgIFwidXJsXCI6IFwicGFzc2VuZ2VyLXRyaXBzXCIsXHJcbiAgICAgICAgICAgICAgXCJzZXJ2aWNlXCI6IFwiZHJ0LGNvbW11dGVyXCIsXHJcbiAgICAgICAgICAgICAgXCJjbGFzc1wiOiBcImxpbmstLXRyaXBzXCIsXHJcbiAgICAgICAgICAgICAgXCJvcmRlclwiOiAxNyxcclxuICAgICAgICAgICAgICBcInNob3dPZmZsaW5lXCI6IGZhbHNlLFxyXG4gICAgICAgICAgICAgIFwibGV2ZWxcIjogMSAgICAgICAgICAgXHJcbiAgICAgICAgICB9LFxyXG5cclxuICAgICAgICAgIC8vc2hhcmVkIFBhZ2VzXHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiVXNlciBQcm9maWxlXCIsXHJcbiAgICAgICAgICAgICAgXCJpZFwiOiBcIm1lbnVQcm9maWxlXCIsXHJcbiAgICAgICAgICAgICAgXCJ1cmxcIjogXCJzaGFyZWQvcHJvZmlsZVwiLFxyXG4gICAgICAgICAgICAgIFwic2VydmljZVwiOiBcImNvbW11dGVyLGZyLGRydFwiLFxyXG4gICAgICAgICAgICAgIFwic2hvd09mZmxpbmVcIjogZmFsc2UsXHJcbiAgICAgICAgICAgICAgXCJpc1Byb2ZpbGVNZW51XCI6IHRydWUsXHJcbiAgICAgICAgICAgICAgXCJvcmRlclwiOiAyMCxcclxuICAgICAgICAgICAgICBcImxldmVsXCI6IDJcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiQ2hhbmdlIFBhc3N3b3JkXCIsXHJcbiAgICAgICAgICAgICAgXCJpZFwiOiBcImNoYW5nZVBhc3N3b3JkXCIsXHJcbiAgICAgICAgICAgICAgXCJ1cmxcIjogXCJjaGFuZ2UtcGFzc3dvcmRcIixcclxuICAgICAgICAgICAgICBcInNlcnZpY2VcIjogXCJjb21tdXRlcixmcixkcnRcIixcclxuICAgICAgICAgICAgICBcInNob3dPZmZsaW5lXCI6IGZhbHNlLFxyXG4gICAgICAgICAgICAgIFwiaXNPbmVNVlwiOiB0cnVlLFxyXG4gICAgICAgICAgICAgIFwib3JkZXJcIjogMjEsXHJcbiAgICAgICAgICAgICAgXCJsZXZlbFwiOiAyXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICAgIFwibmFtZVwiOiBcIk1hbmFnZSBWZWhpY2xlc1wiLFxyXG4gICAgICAgICAgICAgIFwidXJsXCI6IFwiY29tbXV0ZXIvbXktdmVoaWNsZXNcIixcclxuICAgICAgICAgICAgICBcInNlcnZpY2VcIjogXCJjb21tdXRlclwiLFxyXG4gICAgICAgICAgICAgIFwic2hvd09mZmxpbmVcIjogZmFsc2UsXHJcbiAgICAgICAgICAgICAgXCJvcmRlclwiOiAyMixcclxuICAgICAgICAgICAgICBcImxldmVsXCI6IDJcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiV2hhdCdzIE5ld1wiLFxyXG4gICAgICAgICAgICAgIFwidXJsXCI6IFwibmV3c1wiLFxyXG4gICAgICAgICAgICAgIFwic2VydmljZVwiOiBcImNvbW11dGVyLGZyLGRydFwiLFxyXG4gICAgICAgICAgICAgIFwib3JkZXJcIjogMjMsXHJcbiAgICAgICAgICAgICAgXCJsZXZlbFwiOiAyXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICAgIFwibmFtZVwiOiBcIlBvbGljaWVzXCIsXHJcbiAgICAgICAgICAgICAgXCJ1cmxcIjogXCJjb21tdXRlci9wb2xpY3lcIixcclxuICAgICAgICAgICAgICBcInNlcnZpY2VcIjogXCJjb21tdXRlclwiLFxyXG4gICAgICAgICAgICAgIFwib3JkZXJcIjogMjQsXHJcbiAgICAgICAgICAgICAgXCJsZXZlbFwiOiAyXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICAgIFwibmFtZVwiOiBcIlN1cHBvcnRcIixcclxuICAgICAgICAgICAgICBcInVybFwiOiBcInN1cHBvcnRcIixcclxuICAgICAgICAgICAgICBcInNlcnZpY2VcIjogXCJjb21tdXRlclwiLFxyXG4gICAgICAgICAgICAgIFwib3JkZXJcIjogMjUsXHJcbiAgICAgICAgICAgICAgXCJsZXZlbFwiOiAyXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICAgIFwibmFtZVwiOiBcIk5vdGlmaWNhdGlvbnNcIixcclxuICAgICAgICAgICAgICBcInVybFwiOiBcIm5vdGlmaWNhdGlvbnNcIixcclxuICAgICAgICAgICAgICBcInNlcnZpY2VcIjogXCJjb21tdXRlcixmcixkcnRcIixcclxuICAgICAgICAgICAgICBcIm9yZGVyXCI6IDI2LFxyXG4gICAgICAgICAgICAgIFwibGV2ZWxcIjogMlxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIHtcclxuICAgICAgICAgICAgICBcIm5hbWVcIjogXCJTZXR0aW5nc1wiLFxyXG4gICAgICAgICAgICAgIFwidXJsXCI6IFwic2V0dGluZ3NcIixcclxuICAgICAgICAgICAgICBcInNlcnZpY2VcIjogXCJjb21tdXRlcixkcnQsZnJcIixcclxuICAgICAgICAgICAgICBcInNob3dPZmZsaW5lXCI6IGZhbHNlLFxyXG4gICAgICAgICAgICAgIFwib3JkZXJcIjogMjcsXHJcbiAgICAgICAgICAgICAgXCJsZXZlbFwiOiAyXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICAgIFwibmFtZVwiOiBcIlNpZ24gaW5cIixcclxuICAgICAgICAgICAgICBcInVybFwiOiBcImxvZ2luXCIsXHJcbiAgICAgICAgICAgICAgXCJzZXJ2aWNlXCI6IFwiY29tbXV0ZXIsZHJ0XCIsXHJcbiAgICAgICAgICAgICAgXCJvcmRlclwiOiAyOCxcclxuICAgICAgICAgICAgICBcInNob3dPZmZsaW5lXCI6IHRydWUsXHJcbiAgICAgICAgICAgICAgXCJsZXZlbFwiOiAyXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAge1xyXG4gICAgICAgICAgICAgIFwibmFtZVwiOiBcIlNpZ24gb3V0XCIsXHJcbiAgICAgICAgICAgICAgXCJ1cmxcIjogXCJsb2dvdXRcIixcclxuICAgICAgICAgICAgICBcInNlcnZpY2VcIjogXCJjb21tdXRlcixkcnRcIixcclxuICAgICAgICAgICAgICBcIm9yZGVyXCI6IDI5LFxyXG4gICAgICAgICAgICAgIFwic2hvd09mZmxpbmVcIjogZmFsc2UsXHJcbiAgICAgICAgICAgICAgXCJsZXZlbFwiOiAyXHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgIF07XHJcblxyXG4gICAgICAgICRzY29wZS5wYWdlbGluayA9IGZ1bmN0aW9uICh1cmwsIGFwcCwgc2hvd0FzTW9kYWwsIGV2ZW50LCBpc0V4dGVybmFsKSB7XHJcbiAgICAgICAgICAgIGlmIChhcHAgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmlvbmljVG9nZ2xlTWVudSgpXHJcbiAgICAgICAgICAgIH0gICAgICAgICAgICBcclxuXHJcbiAgICAgICAgICAgIC8vaWYgd2UgaGF2ZSBtdWx0aXBsZSBtb2RhbHMgbmVlZGVkIG9uIG1lbnUgY2xpY2tzIHRvbW9ycm93LCB3ZSBuZWVkIHRvIHBhc3MgY29udHJvbGxlciBhbmQgbWFya3VwIGFzIG1lbnUgcHJvcGVydGllcy5cclxuICAgICAgICAgICAgaWYgKHNob3dBc01vZGFsKSB7XHJcbiAgICAgICAgICAgICAgICBzaG93Tm90aWZpY2F0aW9uTW9kYWwoKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICghYW5ndWxhci5pc1VuZGVmaW5lZChpc0V4dGVybmFsKSAmJiBpc0V4dGVybmFsKSB7XHJcbiAgICAgICAgICAgICAgICB3aW5kb3cub3Blbih1cmwsICdfc3lzdGVtJywgJycpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKHVybClcclxuICAgICAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCh1cmwpO1xyXG4gICAgICAgICAgICAgICAgZWxzZSAkbG9jYXRpb24ucGF0aCgnIycpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzaG93Tm90aWZpY2F0aW9uTW9kYWwoKSB7XHJcblxyXG4gICAgICAgICAgICAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9zaGFyZWQvbm90aWZpY2F0aW9uL25vdGlmaWNhdGlvbi5odG1sJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdOb3RpZmljYXRpb25Db250cm9sbGVyIGFzIHZtJyxcclxuICAgICAgICAgICAgICAgIHNpemU6ICcnXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIC8vIHJldHVybnMgdHJ1ZSBpZiB0aGUgY3VycmVudCByb3V0ZXIgdXJsIG1hdGNoZXMgdGhlIHBhc3NlZCBpbiB1cmxcclxuICAgICAgICAvLyBzbyB2aWV3cyBjYW4gc2V0ICdhY3RpdmUnIG9uIGxpbmtzIGVhc2lseVxyXG4gICAgICAgICRzY29wZS5pc0FjdGl2ZSA9IGZ1bmN0aW9uIChuYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBpc0NvbW11dGVyTGluayhuYW1lKSB8fCBpc015VHJpcHNMaW5rKG5hbWUpIHx8IGlzRHJ0TGluayhuYW1lKSB8fCBpc0ZpeGVkUm91dGVMaW5rKG5hbWUpOyAgICAgICAgICAgIFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGlzTXlUcmlwc0xpbmsobmFtZSl7XHJcbiAgICAgICAgICAgIHJldHVybiBuYW1lID09ICdNeSBUcmlwcycgXHJcbiAgICAgICAgICAgICAgICAgICAgJiYgKCRsb2NhdGlvbi5wYXRoKCkgPT0gJy9wYXNzZW5nZXItdHJpcHMnKTtcclxuICAgICAgICB9ICAgIFxyXG5cclxuICAgICAgICBmdW5jdGlvbiBpc0RydExpbmsobmFtZSl7XHJcbiAgICAgICAgICAgIHJldHVybiAkbG9jYXRpb24ucGF0aCgpLmluZGV4T2YoJ29uLWRlbWFuZCcpID4gLTEgJiYgbmFtZSA9PT0gJ2RydCc7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBpc0NvbW11dGVyTGluayhuYW1lKXtcclxuICAgICAgICAgICAgcmV0dXJuICRsb2NhdGlvbi5wYXRoKCkuaW5kZXhPZignY29tbXV0ZXInKSA+IC0xICYmIG5hbWUgPT09ICdjb21tdXRlcic7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBpc0ZpeGVkUm91dGVMaW5rKG5hbWUpe1xyXG4gICAgICAgICAgICByZXR1cm4gJGxvY2F0aW9uLnBhdGgoKS5pbmRleE9mKCdmaXhlZC1yb3V0ZScpID4gLTEgJiYgbmFtZSA9PT0gJ2ZpeGVkJztcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAkc2NvcGUuY2xvc2VEcm9wRG93biA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJHNjb3BlLmlzb3BlbiA9IGZhbHNlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5nb0JhY2sgPSBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KCcjcGFnZS13cmFwcGVyJykuYWRkQ2xhc3MoJ2JhY2snKTtcclxuICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KCcjcGFnZS13cmFwcGVyJykucmVtb3ZlQ2xhc3MoJ2JhY2snKTtcclxuICAgICAgICAgICAgfSwgMTAwMCk7XHJcbiAgICAgICAgICAgIHdpbmRvdy5oaXN0b3J5LmJhY2soKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgXHJcbiAgICAgICAgZnVuY3Rpb24gb25saW5lTWVudXMobWVudSkge1xyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gYW5ndWxhci5pc1VuZGVmaW5lZChtZW51LnNob3dPZmZsaW5lKSB8fCAhbWVudS5zaG93T2ZmbGluZTtcclxuICAgICAgICAgICAgaWYgKHJlc3VsdCAmJiBtZW51LmlzUHJvZmlsZU1lbnUpIHtcclxuICAgICAgICAgICAgICAgIC8vIHNob3cgcHJvZmlsZSBtZW51IG9ubHkgaWYgZHJvcG9mZiBIb21lIGxvY2F0aW9uIG9ubHkgaXMgdHJ1ZVxyXG4gICAgICAgICAgICAgICAgLy8gbm90ZTogcmVtb3ZlIHRoaXMgbGltaXRhdGlvbiB3aGVuIG5vbiBob21lIGxvY2F0aW9uIGl0ZW1zIGFyZSBhZGRlZCB0byBQcm9maWxlXHJcbiAgICAgICAgICAgICAgICB2YXIgcGFyYW0gPSBEaXZpc2lvblNlcnZpY2UuZ2V0U3lzdGVtUGFyYW1ldGVycygpO1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gcGFyYW0uRHJvcG9mZkhvbWVMb2NhdGlvbk9ubHk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHJlc3VsdCAmJiBtZW51LmlzT25lTVYpIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IGF1dGhTZXJ2aWNlLmF1dGhlbnRpY2F0aW9uLmxvZ2luUHJvdmlkZXIgPT09IFwiTXZMb2dpblwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIG9mZmxpbmVNZW51cyhtZW51KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBhbmd1bGFyLmlzVW5kZWZpbmVkKG1lbnUuc2hvd09mZmxpbmUpIHx8IG1lbnUuc2hvd09mZmxpbmU7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWxsb3dlZEZvckRpdmlzaW9uKG1lbnUpIHsgICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYgKGFsbG93ZWRTZXJ2aWNlcykge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1lbnVTZXJ2aWNlcyA9IG1lbnUuc2VydmljZS5zcGxpdCgnLCcpO1xyXG5cclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWVudVNlcnZpY2VzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yKHZhciBqID0gMDtqPGFsbG93ZWRTZXJ2aWNlcy5sZW5ndGg7aisrKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoYWxsb3dlZFNlcnZpY2VzW2pdLm5hbWUudG9Mb3dlckNhc2UoKSA9PSBtZW51U2VydmljZXNbaV0udG9Mb3dlckNhc2UoKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzb3J0QnlPcmRlcihhLCBiKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBhLm9yZGVyID4gYi5vcmRlcjtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBjb3B5KG8pIHtcclxuICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe30sIG8pXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdG9nZ2xlTWVudSgpIHtcclxuICAgICAgICAgICAgdmFyIGxvZ2luUHJlZGljYXRlID0gYXV0aFNlcnZpY2UuaXNMb2dnZWRJbigpID8gb25saW5lTWVudXMgOiBvZmZsaW5lTWVudXM7XHJcbiAgICAgICAgICAgIHZhciBkaXZpc2lvblByZWRpY2F0ZSA9IGFsbG93ZWRGb3JEaXZpc2lvbjtcclxuXHJcbiAgICAgICAgICAgIHZhciBwcm9jZXNzZWRNZW51cyA9IG1lbnVzXHJcbiAgICAgICAgICAgICAgLm1hcChjb3B5KVxyXG4gICAgICAgICAgICAgIC5maWx0ZXIoZGl2aXNpb25QcmVkaWNhdGUpXHJcbiAgICAgICAgICAgICAgLmZpbHRlcihsb2dpblByZWRpY2F0ZSlcclxuICAgICAgICAgICAgICAuc29ydChzb3J0QnlPcmRlcik7XHJcblxyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHByb2Nlc3NlZE1lbnVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocHJvY2Vzc2VkTWVudXNbaV0uc3ViUGFnZXMpXHJcbiAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc2VkTWVudXNbaV0uc3ViUGFnZXMgPSBwcm9jZXNzZWRNZW51c1tpXVxyXG4gICAgICAgICAgICAgICAgICAgIC5zdWJQYWdlc1xyXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoY29weSlcclxuICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKGRpdmlzaW9uUHJlZGljYXRlKVxyXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIobG9naW5QcmVkaWNhdGUpXHJcbiAgICAgICAgICAgICAgICAgICAgLnNvcnQoc29ydEJ5T3JkZXIpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUucGFnZXMgPSBzZXRQYWdlcyhwcm9jZXNzZWRNZW51cyk7ICAgICAgICAgICAgXHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2V0UGFnZXMocGFnZXMpIHtcclxuXHJcbiAgICAgICAgICAgIGlmICghcGFnZXMpIHJldHVybiB1bmRlZmluZWQ7XHJcblxyXG4gICAgICAgICAgICB2YXIgbWVudXMgPSBbXTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGFnZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciBwYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICdhbGlhcyc6IGdldE1lbnVOYW1lKHBhZ2VzW2ldKSxcclxuICAgICAgICAgICAgICAgICAgICAnbmFtZScgOiBwYWdlc1tpXS5uYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICdvcmRlcic6IHBhZ2VzW2ldLm9yZGVyLFxyXG4gICAgICAgICAgICAgICAgICAgICdzZXJ2aWNlJzogcGFnZXNbaV0uc2VydmljZSxcclxuICAgICAgICAgICAgICAgICAgICAnc2hvd0FzTW9kYWwnOiBwYWdlc1tpXS5zaG93QXNNb2RhbCxcclxuICAgICAgICAgICAgICAgICAgICAnY2xhc3MnOiBwYWdlc1tpXS5jbGFzcyxcclxuICAgICAgICAgICAgICAgICAgICAnc2hvd0FjdGl2ZSc6IHBhZ2VzW2ldLnNob3dBY3RpdmUsXHJcbiAgICAgICAgICAgICAgICAgICAgJ2xldmVsJzogcGFnZXNbaV0ubGV2ZWxcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICBpZiAocGFnZXNbaV0udXJsKVxyXG4gICAgICAgICAgICAgICAgICAgIHBhZ2UudXJsID0gcGFnZXNbaV0udXJsO1xyXG4gICAgICAgICAgICAgICAgaWYgKHBhZ2VzW2ldLnN1YlBhZ2VzKVxyXG4gICAgICAgICAgICAgICAgICAgIHBhZ2Uuc3ViUGFnZXMgPSBzZXRQYWdlcyhwYWdlc1tpXS5zdWJQYWdlcyk7XHJcbiAgICAgICAgICAgICAgICBwYWdlLmlzRXh0ZXJuYWwgPSBwYWdlc1tpXS5pc0V4dGVybmFsO1xyXG4gICAgICAgICAgICAgICAgbWVudXMucHVzaChwYWdlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbWVudXM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRNZW51TmFtZShtZW51KXtcclxuXHJcbiAgICAgICAgICAgIGlmKCFtZW51LmlzU2VydmljZU1lbnUpIHJldHVybiBtZW51Lm5hbWU7XHJcblxyXG4gICAgICAgICAgICBmb3IodmFyIGkgPSAwO2kgPGFsbG93ZWRTZXJ2aWNlcy5sZW5ndGg7aSsrKXtcclxuICAgICAgICAgICAgICAgIGlmKG1lbnUuc2VydmljZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGFsbG93ZWRTZXJ2aWNlc1tpXS5uYW1lLnRvTG93ZXJDYXNlKCkpKVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhbGxvd2VkU2VydmljZXNbaV0uYWxpYXM7XHJcbiAgICAgICAgICAgIH0gICAgXHJcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBzZXRBY3RpdmVUcmlwTWVudUl0ZW0oZmxhZykge1xyXG4gICAgICAgICAgICBvdXRlcjogZm9yICh2YXIgbSBpbiAkc2NvcGUucGFnZXMpIHtcclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUucGFnZXNbbV0ubmFtZSA9PSBcImRydFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5uZXI6IGZvciAodmFyIHN1Yk0gaW4gJHNjb3BlLnBhZ2VzW21dLnN1YlBhZ2VzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkc2NvcGUucGFnZXNbbV0uc3ViUGFnZXNbc3ViTV0ubmFtZSA9PSBcIkFjdGl2ZSBUcmlwXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5wYWdlc1ttXS5zdWJQYWdlc1tzdWJNXS5zaG93QWN0aXZlID0gZmxhZztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrIG91dGVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBDaGVja1ZlaGljbGVTdGF0dXNGb3JUcmlwKHBhc3NlbmdlcklkKSB7XHJcbiAgICAgICAgICAgIGlmICghYW5ndWxhci5pc1VuZGVmaW5lZChPbmVNdlNlcnZpY2VzLmdldERydEluZm8oKSkgJiYgYXV0aFNlcnZpY2UuaXNMb2dnZWRJbigpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGl2aXNpb25JZCA9ICcnO1xyXG4gICAgICAgICAgICAgICAgU2NoZWR1bGVTZXJ2aWNlLmdldGxhc3RyaXBkZXRhaWxzKHBhc3NlbmdlcklkLCBkaXZpc2lvbklkKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PT0gMSAmJiByZXNwb25zZS5kYXRhLnJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRBY3RpdmVUcmlwTWVudUl0ZW0odHJ1ZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldEFjdGl2ZVRyaXBNZW51SXRlbShmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJyZW50VHJpcERldGFpbHMgPSByZXNwb25zZS5kYXRhLnJlc3VsdDtcclxuXHJcblxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFtb2RhbFZlaGljbGVBcnJpdmluZyAmJiBjdXJyZW50VHJpcERldGFpbHMuVHJpcElEICE9IG51bGwgJiYgY3VycmVudFRyaXBEZXRhaWxzLlBpY2tVcEdlb2ZlbmNlVGltZSAhPSBudWxsICYmIGN1cnJlbnRUcmlwRGV0YWlscy5TdGFydFRpbWUgPT0gbnVsbCAmJiBjdXJyZW50VHJpcERldGFpbHMuT3JpZ2luRGVwYXJ0VGltZSA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1vZGVsaW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwibW9kYWxfX2hlYWRlclwiID4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8aDQgY2xhc3M9XCJtb2RhbC10aXRsZVwiPkluZm88L2g0PicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyA8L2Rpdj4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwibW9kYWxfXy1ib2R5XCI+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPHA+WW91ciB2ZWhpY2xlIHdpbGwgYmUgYXJyaXZpbmcgc29vbjwvcD4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwibW9kYWxfX2Zvb3RlclwiPicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxidXR0b24gY2xhc3M9XCJidG4gYnRuLXdhcm5pbmdcIiB0eXBlPVwiYnV0dG9uXCIgbmctY2xpY2s9XCJjbG9zZSgpXCI+T0s8L2J1dHRvbj4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgPC9kaXY+JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZTogJHNjb3BlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFja2Ryb3A6ICdzdGF0aWMnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleWJvYXJkOiBmYWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RhbFZlaGljbGVBcnJpdmluZyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIW1vZGFsVmVoaWNsZUFycml2ZWQgJiYgY3VycmVudFRyaXBEZXRhaWxzLlRyaXBJRCAhPSBudWxsICYmIGN1cnJlbnRUcmlwRGV0YWlscy5TdGFydFRpbWUgIT0gbnVsbCAmJiBjdXJyZW50VHJpcERldGFpbHMuT3JpZ2luRGVwYXJ0VGltZSA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobW9kYWxWZWhpY2xlQXJyaXZpbmcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RhbFZlaGljbGVBcnJpdmluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubW9kZWxpbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJtb2RhbC1oZWFkZXJcIiA+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGgzIGNsYXNzPVwibW9kYWwtdGl0bGVcIj5JbmZvPC9oMz4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgPC9kaXY+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cIm1vZGFsLWJvZHlcIj4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8cD5Zb3VyIHZlaGljbGUgaGFzIGp1c3QgYXJyaXZlZDwvcD4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwibW9kYWwtZm9vdGVyXCI+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGJ1dHRvbiBjbGFzcz1cImJ0biBidG4td2FybmluZ1wiIHR5cGU9XCJidXR0b25cIiBuZy1jbGljaz1cImNsb3NlKClcIj5PSzwvYnV0dG9uPicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyA8L2Rpdj4nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlOiAkc2NvcGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYWNrZHJvcDogJ3N0YXRpYycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5Ym9hcmQ6IGZhbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGFsVmVoaWNsZUFycml2ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcEF1dG9SZWZyZXNoKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0NoZWNrVmVoaWNsZVN0YXR1c0ZvclRyaXAnLCBlcnIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgICRzY29wZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJHNjb3BlLm1vZGVsaW5zdGFuY2UuY2xvc2UoKTtcclxuICAgICAgICAgICAgbW9kYWxWZWhpY2xlQXJyaXZlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBtb2RhbFZlaGljbGVBcnJpdmluZyA9IGZhbHNlO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHJlZnJlc2goKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5wYWdlcyA9IFtdO1xyXG4gICAgICAgICAgICBhbGxvd2VkU2VydmljZXMgPSAgRGl2aXNpb25TZXJ2aWNlLmdldEFsbG93ZWRTZXJ2aWNlcygpO1xyXG4gICAgICAgICAgICB0b2dnbGVNZW51KCk7XHJcblxyXG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc1VuZGVmaW5lZChhdXRvUmVmcmVzaCkgJiYgISRyb290U2NvcGUubmF2QXV0b1JlZnJlc2hJc1J1bm5pbmcpIHtcclxuICAgICAgICAgICAgICAgIGF1dG9SZWZyZXNoID0gJGludGVydmFsKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBDaGVja1ZlaGljbGVTdGF0dXNGb3JUcmlwKGF1dGhTZXJ2aWNlLmF1dGhlbnRpY2F0aW9uLnBhc3NlbmdlcklkKTtcclxuICAgICAgICAgICAgICAgIH0sIDE1MDAwKTtcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUubmF2QXV0b1JlZnJlc2hJc1J1bm5pbmcgPSAhYW5ndWxhci5pc1VuZGVmaW5lZChhdXRvUmVmcmVzaCk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgc3RvcEF1dG9SZWZyZXNoKClcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc3RvcEF1dG9SZWZyZXNoKCkge1xyXG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0RlZmluZWQoYXV0b1JlZnJlc2gpKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgJGludGVydmFsLmNhbmNlbChhdXRvUmVmcmVzaCk7XHJcbiAgICAgICAgICAgICAgICBhdXRvUmVmcmVzaCA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgICRyb290U2NvcGUubmF2QXV0b1JlZnJlc2hJc1J1bm5pbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuJG9uKCdsb2dnZWRJbicsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmVmcmVzaCgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgICRzY29wZS4kb24oJ2xvZ2dlZG91dCcsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmVmcmVzaCgpO1xyXG4gICAgICAgICAgICBzdG9wQXV0b1JlZnJlc2goKTtcclxuICAgICAgICB9KTtcclxuICAgICAgXHJcbiAgICAgICAgJHNjb3BlLiRvbignZGl2aXNpb25DaGFuZ2VkJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZWZyZXNoKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIHNob3cgYWN0aXZlIHRyaXAgbWVudSBpdGVtIG9ubHkgaWYgdXNlciBoYXMgYW4gYWN0aXZlIHRyaXBcclxuICAgICAgICAkc2NvcGUuJG9uKCdoYXNBY3RpdmVUcmlwQ2hhbmdlZCcsIGZ1bmN0aW9uIChldmVudCwgaGFzQWN0aXZlVHJpcCkge1xyXG4gICAgICAgICAgICBpZiAoJHNjb3BlLmhhc0FjdGl2ZVRyaXAgIT0gaGFzQWN0aXZlVHJpcCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmhhc0FjdGl2ZVRyaXAgPSBoYXNBY3RpdmVUcmlwO1xyXG4gICAgICAgICAgICAgICAgc2V0QWN0aXZlVHJpcE1lbnVJdGVtKGhhc0FjdGl2ZVRyaXApO1xyXG4gICAgICAgICAgICAgICAgcmVmcmVzaCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7ICAgICAgIFxyXG5cclxuICAgICAgICByZWZyZXNoKCk7XHJcblxyXG5cclxuXHJcbiAgICAgICAgJHNjb3BlLnRvZ2dsZUdyb3VwSW9uaWMgPSBmdW5jdGlvbiAoZ3JvdXAsIGlzUGFyZW50KSB7XHJcbiAgICAgICAgICAgIGlmICghJHNjb3BlLmlzR3JvdXBTaG93bklvbmljKGdyb3VwKSkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNob3duR3JvdXBJb25pYyA9IGdyb3VwO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGlzUGFyZW50KSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd25Hcm91cElvbmljID0gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgJHNjb3BlLndpcGVMb2NhbFN0b3JhZ2VJbmZvID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnZ28gMScpO1xyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2lvbmljU2hvd1NwbGFzaFNjcmVlbicpO1xyXG4gICAgICAgICAgICAkc2NvcGUuaW9uaWNUb2dnbGVNZW51KCk7XHJcbiAgICAgICAgICAgIHZhciBpb25pY0NIQ1BPbiA9IHdpbmRvdy5sb2NhbFN0b3JhZ2VbJ2lvbmljQ0hDUE9uJ10gPyB3aW5kb3cubG9jYWxTdG9yYWdlWydpb25pY0NIQ1BPbiddIDogJ3RydWUnO1xyXG4gICAgICAgICAgICB2YXIgbG9jYWxFbnYgPSB3aW5kb3cubG9jYWxTdG9yYWdlWydlbnYnXSA/IHdpbmRvdy5sb2NhbFN0b3JhZ2VbJ2VudiddIDogJy1kZXYnO1xyXG4gICAgICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLmNsZWFyKCk7XHJcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2VbJ2lvbmljQ0hDUE9uJ10gPSBpb25pY0NIQ1BPbjtcclxuICAgICAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZVsnZW52J10gPSBsb2NhbEVudjtcclxuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlcGxhY2UoJyMvbmF2L2RpdmlzaW9uJyk7XHJcbiAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQodHJ1ZSk7XHJcbiAgICAgICAgICAgIH0sIDUwMClcclxuICAgICAgICB9O1xyXG4gICAgICAgICRzY29wZS5pc0dyb3VwU2hvd25Jb25pYyA9IGZ1bmN0aW9uIChncm91cCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJHNjb3BlLnNob3duR3JvdXBJb25pYyA9PT0gZ3JvdXA7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgJHNjb3BlLmlvbmljVG9nZ2xlTWVudSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdpb25pY1RvZ2dsZUxlZnRNZW51Jyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICB9XHJcblxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ05vdGlmaWNhdGlvbkNvbnRyb2xsZXInLCBOb3RpZmljYXRpb25Db250cm9sbGVyKTtcclxuXHJcbiAgICBOb3RpZmljYXRpb25Db250cm9sbGVyLiRpbmplY3QgPSBbJyR1aWJNb2RhbCcsJ05vdGlmaWNhdGlvblNlcnZpY2UnLCAnUGFnZVNlcnZpY2UnLCAnYXV0aFNlcnZpY2UnLCdPbmVNdlNlcnZpY2VzJ107XHJcblxyXG4gICAgZnVuY3Rpb24gTm90aWZpY2F0aW9uQ29udHJvbGxlcigkdWliTW9kYWwsIE5vdGlmaWNhdGlvblNlcnZpY2UsIFBhZ2VTZXJ2aWNlLCBhdXRoU2VydmljZSwgT25lTXZTZXJ2aWNlcykge1xyXG5cclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLnRpdGxlID0gJ05vdGlmaWNhdGlvbnMnO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlID0gUGFnZVNlcnZpY2U7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2Uuc2V0VGl0bGUoJ05vdGlmaWNhdGlvbnMnKTtcclxuICAgICAgICB2bS5QYWdlU2VydmljZS5zZXRIZWFkbGluZSgnU2VydmljZSB1cGRhdGVzJyk7XHJcbiAgICAgICAgdm0uY29tbXV0ZXJBbGVydHMgPSBbXTtcclxuICAgICAgICB2bS5mck5vdGlmaWNhdGlvbnMgPSBbXTtcclxuXHJcbiAgICAgICAgdm0uaXNGck5vdGlmaWNhdGlvbkxvYWRpbmcgPSB0cnVlO1xyXG4gICAgICAgIHZtLmlzQ29tbXV0ZXJBbGVydExvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICB2bS5pc0NvbW11dGVyTm90aWZpY2F0aW9uTG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgIHZtLmlzRFJUTm90aWZpY2F0aW9uTG9hZGluZyA9IGZhbHNlOyAgICAgICAgICAgXHJcbiAgICAgICAgdm0uaGFzQ29tbXV0ZXIgPSBmYWxzZTtcclxuICAgICAgICB2bS5oYXNGaXhlZFJvdXRlID0gZmFsc2U7XHJcbiAgICAgICAgdm0uaGFzRFJUID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHZtLmNvbW11dGVySW5mbyA9IE9uZU12U2VydmljZXMuZ2V0Q29tbXV0ZXJJbmZvKCk7XHJcbiAgICAgICAgdm0uZml4ZWRSb3V0ZUluZm8gPSBPbmVNdlNlcnZpY2VzLmdldEZpeGVkUm91dGVJbmZvKCk7XHJcbiAgICAgICAgdm0uZHJ0SW5mbyA9IE9uZU12U2VydmljZXMuZ2V0RHJ0SW5mbygpO1xyXG5cclxuICAgICAgICB2bS5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAvLyAgJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnY2FuY2VsJyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgYWN0aXZhdGUoKTtcclxuXHJcbiAgICAgICAgdm0uc2hvd1RyaXBJbmZvID0gc2hvd1RyaXBJbmZvO1xyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2hvd1RyaXBJbmZvKG5vdGlmaWNhdGlvbikge1xyXG4gICAgICAgICAgICBzaG93Q29tbXV0ZXJUcmlwSW5mbyhub3RpZmljYXRpb24uTGlua2VkSWQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2hvd0NvbW11dGVyVHJpcEluZm8odHJpcElkKSB7XHJcbiAgICAgICAgICAgIHZhciBjb21tdXRlclRyaXBNb2RhbCA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL3NoYXJlZC90cmlwcy9jb21tdXRlci10cmlwLW1vZGFsLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0NvbW11dGVyVHJpcE1vZGFsQ29udHJvbGxlciBhcyB2bScsXHJcbiAgICAgICAgICAgICAgICBzaXplOiAnLWZzJyxcclxuICAgICAgICAgICAgICAgIGJhY2tkcm9wOiAnc3RhdGljJyxcclxuICAgICAgICAgICAgICAgIGtleWJvYXJkOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICB0cmlwSWQ6IHRyaXBJZFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGNvbW11dGVyVHJpcE1vZGFsLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmNhbmNlbGxlZCB8fCByZXNwb25zZS5pc01vZGlmaWVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0Q29tbXV0ZXJOb3RpZmljYXRpb25zKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xyXG5cclxuICAgICAgICB2bS5pc2xvZ2dlZEluID0gYXV0aFNlcnZpY2UuaXNMb2dnZWRJbigpO1xyXG4gICAgICAgIFxyXG4gICAgICAgICAgICBpZighYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5jb21tdXRlckluZm8pKXtcclxuICAgICAgICAgICAgICAgIHZtLmhhc0NvbW11dGVyID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGdldENvbW11dGVyTm90aWZpY2F0aW9ucygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKCFhbmd1bGFyLmlzVW5kZWZpbmVkKHZtLmZpeGVkUm91dGVJbmZvKSl7XHJcbiAgICAgICAgICAgICAgICB2bS5oYXNGaXhlZFJvdXRlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGdldEZpeGVkUm91dGVOb3RpZmljYXRpb25zKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYoIWFuZ3VsYXIuaXNVbmRlZmluZWQodm0uZHJ0SW5mbykpe1xyXG4gICAgICAgICAgICAgICAgdm0uaGFzRFJUID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGdldERSVE5vdGlmaWNhdGlvbnMoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBmdW5jdGlvbiBnZXRGaXhlZFJvdXRlTm90aWZpY2F0aW9ucygpIHtcclxuICAgICAgICAgICAgdm0uaXNGck5vdGlmaWNhdGlvbkxvYWRpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICBOb3RpZmljYXRpb25TZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICAuZ2V0Rml4ZWRSb3V0ZU5vdGlmaWNhdGlvbigpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgdm0uZnJOb3RpZmljYXRpb25zID0gcmVzcG9uc2UuZGF0YS5ub3RpZmljYXRpb25zO1xyXG4gICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHZtLmZyTm90aWZpY2F0aW9ucywgZnVuY3Rpb24gKG5vdGlmaWNhdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbi5UaXRsZSA9IG5vdGlmaWNhdGlvbi5saW5rVGl0bGU7XHJcbiAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uLk1lc3NhZ2UgPSBub3RpZmljYXRpb24udGV4dDtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgdm0uaXNGck5vdGlmaWNhdGlvbkxvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5pc0ZyTm90aWZpY2F0aW9uTG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldENvbW11dGVyTm90aWZpY2F0aW9ucygpIHtcclxuICAgICAgICAgICAgdm0uaXNDb21tdXRlck5vdGlmaWNhdGlvbkxvYWRpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICBOb3RpZmljYXRpb25TZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICAuZ2V0Q29tbXV0ZXJOb3RpZmljYXRpb25zKClcclxuICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgIHZtLkNvbW11dGVyTm90aWZpY2F0aW9ucyA9IHJlc3BvbnNlLmRhdGEucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgIHZtLmlzQ29tbXV0ZXJOb3RpZmljYXRpb25Mb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICB2bS5pc0NvbW11dGVyTm90aWZpY2F0aW9uTG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0RFJUTm90aWZpY2F0aW9ucygpIHtcclxuICAgICAgICAgICAgdm0uaXNEUlROb3RpZmljYXRpb25Mb2FkaW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgTm90aWZpY2F0aW9uU2VydmljZVxyXG4gICAgICAgICAgICAgICAgLmdldERSVE5vdGlmaWNhdGlvbnMoKVxyXG4gICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgdm0uRFJUTm90aWZpY2F0aW9ucyA9IHJlc3BvbnNlLmRhdGEucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgIHZtLmlzRFJUTm90aWZpY2F0aW9uTG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgdm0uaXNEUlROb3RpZmljYXRpb25Mb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgIH1cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuXHRcInVzZSBzdHJpY3RcIjtcclxuXHJcblx0YW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoXCJvbmVNVkFwcFwiKVxyXG4gICAgICAgIC5kaXJlY3RpdmUoXCJub3RpZmljYXRpb25JdGVtXCIsIG5vdGlmaWNhdGlvbkl0ZW0pO1xyXG5cclxuXHRmdW5jdGlvbiBub3RpZmljYXRpb25JdGVtKCkge1xyXG5cdFx0cmV0dXJuIHtcclxuXHRcdFx0cmVzdHJpY3Q6IFwiRVwiLFxyXG5cdFx0XHRzY29wZToge1xyXG5cdFx0XHRcdGRhdGE6IFwiPVwiXHJcblx0XHRcdH0sXHJcblx0XHRcdHRlbXBsYXRlVXJsOiBcImFwcC9tb2R1bGVzL3NoYXJlZC9ub3RpZmljYXRpb24vbm90aWZpY2F0aW9uLWl0ZW0uY29tcG9uZW50Lmh0bWxcIlxyXG5cdFx0fTtcclxuXHJcblx0fVxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuZmFjdG9yeSgnTm90aWZpY2F0aW9uU2VydmljZScsIE5vdGlmaWNhdGlvblNlcnZpY2UpO1xyXG5cclxuICAgIE5vdGlmaWNhdGlvblNlcnZpY2UuJGluamVjdCA9IFsnJGh0dHAnLCAnJHEnLCAnZW52JywgJ2F1dGhTZXJ2aWNlJywgJ0RpdmlzaW9uU2VydmljZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIE5vdGlmaWNhdGlvblNlcnZpY2UoJGh0dHAsICRxLCBlbnYsIGF1dGhTZXJ2aWNlLCBEaXZpc2lvblNlcnZpY2UpIHtcclxuXHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XHJcbiAgICAgICAgICAgIGdldFNlcnZpY2VBbGVydHM6IGdldFNlcnZpY2VBbGVydHMsXHJcbiAgICAgICAgICAgIGdldEZpeGVkUm91dGVOb3RpZmljYXRpb246IGdldEZpeGVkUm91dGVOb3RpZmljYXRpb24sXHJcbiAgICAgICAgICAgIGdldENvbW11dGVyTm90aWZpY2F0aW9uczogZ2V0Q29tbXV0ZXJOb3RpZmljYXRpb25zLFxyXG4gICAgICAgICAgICBnZXREUlROb3RpZmljYXRpb25zOiBnZXREUlROb3RpZmljYXRpb25zXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0U2VydmljZUFsZXJ0cygpIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuXHJcbiAgICAgICAgICAgIHZhciByb3V0ZSA9IGF1dGhTZXJ2aWNlLmlzTG9nZ2VkSW4oKSA/ICcvc2VydmljZUFsZXJ0c0ZvclVzZXIvJyArIGF1dGhTZXJ2aWNlLmF1dGhlbnRpY2F0aW9uLnVzZXJJZCA6ICcvc2VydmljZUFsZXJ0cyc7XHJcblxyXG4gICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5jb21tdXRlckFwaVVybCArICdjb21tb24vJyArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCkgKyByb3V0ZSArIFwiP3JuZD1cIiArIERhdGUucGFyc2UobmV3IERhdGUoKSk7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICAndXJsJzogc2VydmljZVVybFxyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfTtcclxuICAgICAgIFxyXG4gICAgICAgIGZ1bmN0aW9uIGdldEZpeGVkUm91dGVOb3RpZmljYXRpb24oKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICAndXJsJzogZW52Lm9uZU1WRml4ZWRSb3V0ZUFwaVVybCArIFwibm90aWZpY2F0aW9ucy9cIiArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKClcclxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0Q29tbXV0ZXJOb3RpZmljYXRpb25zKCkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICB2YXIgcGFzc2VuZ2VySWQgPSBhdXRoU2VydmljZS5pc0xvZ2dlZEluKCkgPyBhdXRoU2VydmljZS5hdXRoZW50aWNhdGlvbi5wYXNzZW5nZXJJZCA6IDA7XHJcbiAgICAgICAgICAgIHZhciB1cmwgPSBwYXNzZW5nZXJJZCA9PSAwXHJcbiAgICAgICAgICAgICAgICA/IGVudi5vbmVNVkFwaVVybCArIFwibm90aWZpY2F0aW9ucy9jb21tdXRlci9cIiArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKClcclxuICAgICAgICAgICAgICAgIDogZW52Lm9uZU1WQXBpVXJsICsgXCJub3RpZmljYXRpb25zL2NvbW11dGVyL1wiICsgRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKSArICcvJyArIHBhc3NlbmdlcklkO1xyXG4gICAgICAgICAgICAkaHR0cCh7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgJ3VybCc6IHVybFxyXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdCgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIGdldERSVE5vdGlmaWNhdGlvbnMoKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIGlmICghYXV0aFNlcnZpY2UuaXNMb2dnZWRJbigpKVxyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KCk7XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmFyIHBhc3NlbmdlcklkID0gYXV0aFNlcnZpY2UuYXV0aGVudGljYXRpb24ucGFzc2VuZ2VySWQ7XHJcbiAgICAgICAgICAgICAgICB2YXIgdXJsID0gZW52Lm9uZU1WQXBpVXJsICsgXCJub3RpZmljYXRpb25zL0RSVC9cIiArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCkgKyAnLycgKyBwYXNzZW5nZXJJZDtcclxuICAgICAgICAgICAgICAgICRodHRwKHtcclxuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICAgICAgICAgICd1cmwnOiB1cmxcclxuICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICAgICBcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0Rpc3BsYXlQdXNoTWVzc2FnZUNvbnRyb2xsZXInLCBEaXNwbGF5UHVzaE1lc3NhZ2VDb250cm9sbGVyKTtcclxuXHJcbiAgICBEaXNwbGF5UHVzaE1lc3NhZ2VDb250cm9sbGVyLiRpbmplY3QgPSBbJyR1aWJNb2RhbEluc3RhbmNlJywnbWVzc2FnZVRpdGxlJywnbWVzc2FnZUJvZHknLCdtZXNzYWdlVHlwZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIERpc3BsYXlQdXNoTWVzc2FnZUNvbnRyb2xsZXIoJHVpYk1vZGFsSW5zdGFuY2UsIG1lc3NhZ2VUaXRsZSwgbWVzc2FnZUJvZHksIG1lc3NhZ2VUeXBlKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS5tZXNzYWdlVHlwZSA9IG1lc3NhZ2VUeXBlO1xyXG4gICAgICAgIHZtLm1lc3NhZ2VUaXRsZSA9IG1lc3NhZ2VUaXRsZTtcclxuICAgICAgICB2bS5tZXNzYWdlQm9keSA9IG1lc3NhZ2VCb2R5O1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdtb2RhbCcsIHZtKTtcclxuICAgICAgICB2bS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoeyAncmVzdWx0JzogJ29rJyB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdDaGFuZ2VQYXNzd29yZENvbnRyb2xsZXInLCBDaGFuZ2VQYXNzd29yZENvbnRyb2xsZXIpO1xyXG5cclxuICAgIENoYW5nZVBhc3N3b3JkQ29udHJvbGxlci4kaW5qZWN0ID0gWyckbG9jYXRpb24nLFxyXG4gICAgICAgICdhdXRoU2VydmljZScsICdlbnYnLCAnTWVzc2FnZVNlcnZpY2UnLCAnRGl2aXNpb25TZXJ2aWNlJywgJ1BhZ2VTZXJ2aWNlJywgJ1Bhc3N3b3JkU2VydmljZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIENoYW5nZVBhc3N3b3JkQ29udHJvbGxlcigkbG9jYXRpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRoU2VydmljZSwgZW52LCBNZXNzYWdlU2VydmljZSwgRGl2aXNpb25TZXJ2aWNlLCBQYWdlU2VydmljZSwgUGFzc3dvcmRTZXJ2aWNlKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS5jaGFuZ2VQYXNzd29yZCA9IGNoYW5nZVBhc3N3b3JkO1xyXG4gICAgICAgIHZtLmNhbmNlbCA9IGNhbmNlbDtcclxuICAgICAgICB2bS5kaXZpc2lvbklkID0gRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKTtcclxuICAgICAgICB2bS5QYWdlU2VydmljZSA9IFBhZ2VTZXJ2aWNlO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlLnNldFRpdGxlKCdDaGFuZ2UgUGFzc3dvcmQnKTtcclxuICAgICAgICB2bS5QYWdlU2VydmljZS5zZXRIZWFkbGluZSgnVXBkYXRlIHlvdXIgcGFzc3dvcmQnKTtcclxuICAgICAgICBmdW5jdGlvbiBjYW5jZWwoKSB7XHJcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCdkYXNoYm9hcmQvJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIGNoYW5nZVBhc3N3b3JkKCkge1xyXG4gICAgICAgICAgICBpZiAodm0ubmV3UGFzc3dvcmQgIT09IHZtLm5ld1Bhc3N3b3JkUmV0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBNZXNzYWdlU2VydmljZS5zaG93RXJyb3IoXCJOZXcgUGFzc3dvcmQgYW5kIFJldHlwZSBQYXNzd29yZCBkbyBub3QgbWF0Y2hcIik7XHJcbiAgICAgICAgICAgICAgICB2bS5pc0NsaWNrZWQgPSAhdm0uaXNDbGlja2VkO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvL2NhbGwgb25lIG12IGxvZ2luXHJcbiAgICAgICAgICAgIHZhciByZXF1ZXN0ID0ge1xyXG4gICAgICAgICAgICAgICAgVXNlck5hbWU6IHZtLnVzZXJuYW1lLFxyXG4gICAgICAgICAgICAgICAgT2xkUGFzc3dvcmQ6IHZtLm9sZFBhc3N3b3JkLFxyXG4gICAgICAgICAgICAgICAgTmV3UGFzc3dvcmQ6IHZtLm5ld1Bhc3N3b3JkLFxyXG4gICAgICAgICAgICAgICAgRGl2aXNpb25JZDogdm0uZGl2aXNpb25JZCxcclxuICAgICAgICAgICAgICAgIFBhc3NlbmdlcklkOiBhdXRoU2VydmljZS5hdXRoZW50aWNhdGlvbi5wYXNzZW5nZXJJZCxcclxuICAgICAgICAgICAgICAgIFByb3ZpZGVyOiAnTXZMb2dpbidcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvL3dpbGwgY2FsbCBhIHNlcnZpY2VcclxuICAgICAgICAgICAgUGFzc3dvcmRTZXJ2aWNlLkNoYW5nZVBhc3N3b3JkKHJlcXVlc3QpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5pc0NsaWNrZWQgPSAhdm0uaXNDbGlja2VkXHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSAmJiByZXNwb25zZS5kYXRhLnJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnJlc3VsdC5DaGFuZ2VTdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgTWVzc2FnZVNlcnZpY2Uuc2hvd1N1Y2Nlc3MoXCJQYXNzd29yZCBDaGFuZ2VkIHN1Y2Nlc3NmdWxseVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0ub2xkUGFzc3dvcmQgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5uZXdQYXNzd29yZCA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLm5ld1Bhc3N3b3JkUmV0eXBlID0gXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBNZXNzYWdlU2VydmljZS5zaG93RXJyb3IocmVzcG9uc2UuZGF0YS5yZXN1bHQuQ2hhbmdlU3RhdHVzRGVzY3JpcHRpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjayhlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgLy9jYWxsIG1lc3NhZ2Ugc2VydmljZVxyXG4gICAgICAgICAgICAgICAgdm0uaXNDbGlja2VkID0gIXZtLmlzQ2xpY2tlZFxyXG4gICAgICAgICAgICAgICAgaWYgKGVycm9yKVxyXG4gICAgICAgICAgICAgICAgICAgIE1lc3NhZ2VTZXJ2aWNlLnNob3dFcnJvcihlcnJvci5NZXNzYWdlKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBTdGFydCBvZiBjb2RlIGZvciBJb25pY1xyXG4gICAgICAgIHZtLmlvbmljSW5jbHVkZSA9ICdhcHAvc2hhcmVkL3Byb2ZpbGUvY2hhbmdlLXBhc3N3b3JkLmh0bWwnO1xyXG4gICAgICAgIHZtLmlvbmljQ3VzdG9tQ2xhc3NOYW1lID0gJ2lvbmljLW9uZW12LWxvZ2luJztcclxuICAgICAgICB2bS5pb25pY0hpZGVOYXZCYXIgPSBmYWxzZTtcclxuICAgICAgICB2bS5pb25pY1VzZVJlZnJlc2hlciA9IGZhbHNlO1xyXG4gICAgICAgIC8vIEVuZCBvZiBjb2RlIGZvciBJb25pY1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG5cdCd1c2Ugc3RyaWN0JztcclxuXHJcblx0YW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuZGlyZWN0aXZlKCdob21lQWRkcmVzc0RpcmVjdGl2ZScsIGhvbWVBZGRyZXNzRGlyZWN0aXZlKTtcclxuXHJcblx0aG9tZUFkZHJlc3NEaXJlY3RpdmUuJGluamVjdCA9IFsnJHdpbmRvdycsICdEaXZpc2lvblNlcnZpY2UnLCAnTG9jYXRpb25GYWN0b3J5JywgJ2F1dGhTZXJ2aWNlJywgJ1Byb2ZpbGVTZXJ2aWNlJywgJ0NvbW1vblNlcnZpY2UnLCAnVXRpbGl0eUZhY3RvcnknLCAnJHVpYk1vZGFsU3RhY2snXTtcclxuXHJcblx0ZnVuY3Rpb24gaG9tZUFkZHJlc3NEaXJlY3RpdmUoJHdpbmRvdywgRGl2aXNpb25TZXJ2aWNlLCBMb2NhdGlvbkZhY3RvcnksIGF1dGhTZXJ2aWNlLCBQcm9maWxlU2VydmljZSwgQ29tbW9uU2VydmljZSwgVXRpbGl0eUZhY3RvcnksICR1aWJNb2RhbFN0YWNrKSB7XHJcblx0XHRyZXR1cm4ge1xyXG5cdFx0XHRjb250cm9sbGVyOiBob21lQWRkcmVzc0NvbnRyb2xsZXIsXHJcblx0XHRcdHJlcGxhY2U6IHRydWUsXHJcblx0XHRcdHJlc3RyaWN0OiAnRScsXHJcblx0XHRcdHNjb3BlOiB7XHJcblx0XHRcdFx0SG9tZUFkZHJlc3M6ICc9P2RhdGEnLFxyXG5cdFx0XHRcdGludmFsaWQ6ICc9P2ludmFsaWQnXHJcblx0XHRcdH0sXHJcblx0XHRcdHRlbXBsYXRlVXJsOiAnYXBwL21vZHVsZXMvc2hhcmVkL3Byb2ZpbGUvaG9tZUFkZHJlc3MuaHRtbCdcclxuXHRcdH07XHJcblx0XHRcclxuXHRcdGZ1bmN0aW9uIGhvbWVBZGRyZXNzQ29udHJvbGxlcigkc2NvcGUsICR1aWJNb2RhbFN0YWNrKSB7XHJcblx0XHRcdC8vIGluaXRpYWxpemUgYmluZGluZ3NcclxuXHRcdFx0JHNjb3BlLmhhc01vZGFsUGFyZW50ID0gJHVpYk1vZGFsU3RhY2suZ2V0VG9wKCkgIT09IHVuZGVmaW5lZDtcclxuXHRcdFx0JHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xyXG5cdFx0XHQkc2NvcGUuaW52YWxpZCA9IHRydWU7XHJcblx0XHRcdCRzY29wZS5oYXNIb21lQWRkcmVzcyA9IGZhbHNlO1xyXG5cdFx0XHQkc2NvcGUuaXNDb250YWluZXJNYW5hZ2luZ0RhdGEgPSAkc2NvcGUuSG9tZUFkZHJlc3MgIT09IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgLy8gSWYgSG9tZUFkZHJlc3MgaXMgcGFzc2VkIGZyb20gdGhlIGNhbGxlciwgdXNlIGl0LlxyXG5cdFx0XHQkc2NvcGUuSG9tZUFkZHJlc3MgPSAkc2NvcGUuSG9tZUFkZHJlc3MgPT0gbnVsbCA/IHt9IDogJHNjb3BlLkhvbWVBZGRyZXNzO1xyXG5cdFx0XHQkc2NvcGUuSG9tZUFkZHJlc3NTZWFyY2ggPSB7fTtcclxuXHRcdFx0JHNjb3BlLmdvb2dsZUxvY2F0aW9ucyA9IFtdO1xyXG5cdFx0XHQkc2NvcGUuc3RhdGVzID0gW107XHJcblx0XHRcdCRzY29wZS5jb3VudHJpZXMgPSBbeyBuYW1lOiAnVW5pdGVkIFN0YXRlcycsIGNvZGU6ICdVU0EnIH1dO1xyXG5cclxuXHRcdFx0Ly8gaW5pdGlhbGl6ZSBnbG9iYWxzXHJcblx0XHRcdCRzY29wZS5kaXZpc2lvbklkID0gRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKTtcclxuXHRcdFx0JHNjb3BlLnBhc3NlbmdlcklkID0gYXV0aFNlcnZpY2UuYXV0aGVudGljYXRpb24ucGFzc2VuZ2VySWQ7XHJcblx0XHRcdCRzY29wZS5zdWJtaXR0ZWQgPSBmYWxzZTtcclxuXHRcdFx0JHNjb3BlLkFkZEVkaXQgPSB0cnVlO1xyXG5cdFx0XHQkc2NvcGUuemlwY29kZSA9IFwiXCI7XHJcblx0XHRcdCRzY29wZS5zdGF0ZWFiYnIgPSBcIlwiO1xyXG5cdFx0XHQkc2NvcGUuaXNWYWxpZFppcCA9IGZhbHNlO1xyXG5cdFx0XHQkc2NvcGUuYWxsb3dFZGl0SG9tZUFkZHJlc3MgPSBmYWxzZTtcclxuXHRcdFx0JHNjb3BlLnNob3dIb21lQWRkcmVzcyA9IGZhbHNlO1xyXG5cdFx0XHQkc2NvcGUuZGF0YVNlcnZpY2VUbyA9IExvY2F0aW9uRmFjdG9yeS5kYXRhU2VydmljZVRvO1xyXG5cclxuXHRcdFx0Ly8gcG9wdWxhdGUgU3RhdGVzIGxpc3RcclxuXHRcdFx0Q29tbW9uU2VydmljZS5HZXRBbGxTdGF0ZXMoKS50aGVuKFxyXG5cdFx0XHRcdGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuXHRcdFx0XHRcdCRzY29wZS5zdGF0ZXMgPSByZXN1bHQ7XHJcblx0XHRcdFx0fSxcclxuXHRcdFx0XHRmdW5jdGlvbiAoZXJyKSB7XHJcblx0XHRcdFx0XHRVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKCcnLCBcIkNvdWxkIG5vdCBsb2FkIHN0YXRlcyBsaXN0LiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLlwiKVxyXG5cdFx0XHRcdH0pO1xyXG5cclxuXHRcdFx0Ly8gcmV0dXJuIHVzZXIgdG8gcHJldmlvdXMgc2NyZWVuXHJcblx0XHRcdCRzY29wZS5DYW5jZWwgPSBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0JHVpYk1vZGFsU3RhY2suZGlzbWlzc0FsbCgpO1xyXG5cdFx0XHRcdCR3aW5kb3cuaGlzdG9yeS5iYWNrKCk7XHJcblx0XHRcdH07XHJcblxyXG5cdFx0XHQvLyB1c2VyIHNlbGVjdGVkIGEgaG9tZSBsb2NhdGlvblxyXG5cdFx0XHQkc2NvcGUuU2VsZWN0ZWRIb21lQWRkcmVzcyA9IGZ1bmN0aW9uIChsb2NhdGlvbikge1xyXG5cdFx0XHRcdC8vIHJlbWVtYmVyIHN1aXRlXHJcblx0XHRcdFx0dmFyIHN1aXRlID0gJHNjb3BlLkhvbWVBZGRyZXNzU2VhcmNoLlN1aXRlO1xyXG5cclxuXHRcdFx0XHQvLyBzZXQgaG9tZSBsb2NhdGlvblxyXG5cdFx0XHRcdCRzY29wZS5Ib21lQWRkcmVzc1NlYXJjaCA9IGFuZ3VsYXIuY29weShsb2NhdGlvbik7XHJcblx0XHRcdFx0JHNjb3BlLkhvbWVBZGRyZXNzU2VhcmNoLlN1aXRlID0gc3VpdGU7XHJcblxyXG5cdFx0XHRcdC8vIGdldCB0aGUgc3RhdGUgSWRcclxuXHRcdFx0XHQkc2NvcGUuSG9tZUFkZHJlc3NTZWFyY2guU3RhdGVJZCA9ICRzY29wZS5zdGF0ZXMuZmlsdGVyKGZ1bmN0aW9uIChzKSB7IHJldHVybiBzLkFiYnIgPT0gbG9jYXRpb24uU3RhdGUgfSlbMF0uSWQ7XHJcblx0XHRcdFx0JHNjb3BlLkhvbWVBZGRyZXNzID0gYW5ndWxhci5jb3B5KCRzY29wZS5Ib21lQWRkcmVzc1NlYXJjaCk7XHJcblxyXG5cdFx0XHRcdC8vIGNsaWNrIHRoZSBsaXN0IHJhZGlvIGJ1dHRvbiBmb3IgdGhpcyBhZGRyZXNzXHJcblx0XHRcdFx0JHNjb3BlLkhvbWVBZGRyZXNzR29vZ2xlUGxhY2VJZCA9IGxvY2F0aW9uLkdvb2dsZVBsYWNlSWQ7XHJcblxyXG5cdFx0XHRcdCRzY29wZS5pbnZhbGlkID0gZmFsc2U7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vIHNlYXJjaCBmb3IgaG9tZSBsb2NhdGlvbnMgYmFzZWQgb24gdXNlciBpbnB1dCB0byBzZWFyY2ggZmllbGRzXHJcblx0XHRcdCRzY29wZS5Hb29nbGVTZWFyY2ggPSBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0JHNjb3BlLmludmFsaWQgPSB0cnVlO1xyXG5cdFx0XHRcdCRzY29wZS5nb29nbGVMb2NhdGlvbnMgPSBbXTtcclxuXHRcdFx0XHRVdGlsaXR5RmFjdG9yeS50b2FzdEluZm8oXCJIb21lIEFkZHJlc3MgLSBTZWFyY2hcIiwgXCJTZWFyY2hpbmcgZm9yIG1hdGNoaW5nIGFkZHJlc3Nlcy4gUGxlYXNlIHdhaXQuXCIpO1xyXG5cdFx0XHRcdHZhciBzdGF0ZSA9ICRzY29wZS5zdGF0ZXMuZmlsdGVyKGZ1bmN0aW9uIChzKSB7IHJldHVybiBzLklkID09ICRzY29wZS5Ib21lQWRkcmVzc1NlYXJjaC5TdGF0ZUlkOyB9KVswXTtcclxuXHRcdFx0XHR2YXIgc2VhcmNoU3RyaW5nID0gKCRzY29wZS5Ib21lQWRkcmVzc1NlYXJjaC5BZGRyZXNzIHx8IFwiXCIpICsgJywgJyArICgkc2NvcGUuSG9tZUFkZHJlc3NTZWFyY2guQ2l0eSB8fCBcIlwiKSArICcsICcgKyAoKHN0YXRlICYmIHN0YXRlLkFiYnIpIHx8IFwiXCIpICsgJywgJyArICgkc2NvcGUuSG9tZUFkZHJlc3NTZWFyY2guWmlwIHx8IFwiXCIpO1xyXG5cdFx0XHRcdExvY2F0aW9uRmFjdG9yeS5nZXRMb2NhdGlvbnMoc2VhcmNoU3RyaW5nLCB0cnVlLCAkc2NvcGUuZGl2aXNpb25JZCwgJHNjb3BlLnBhc3NlbmdlcklkLCB0cnVlKS50aGVuKGZ1bmN0aW9uIChsb2NhdGlvbnMpIHtcclxuXHRcdFx0XHRcdC8vIGNvbnZlcnQgR29vZ2xlIGxvY2F0aW9uIHNlYXJjaCB0byBPbmVNViBMb2NhdGlvbiBvYmplY3RcclxuXHRcdFx0XHRcdGZvciAodmFyIGwgPSAwOyBsIDwgbG9jYXRpb25zLmRhdGEubGVuZ3RoOyBsKyspIHtcclxuXHRcdFx0XHRcdFx0dmFyIGFkZHJlc3MgPSBsb2NhdGlvbnMuZGF0YVtsXS5sb2M7XHJcblx0XHRcdFx0XHRcdHZhciBsb2NhdGlvbiA9IHt9O1xyXG5cdFx0XHRcdFx0XHR2YXIgYWRkID0gXCJcIiwgc3RyZWV0TnVtYmVyID0gXCJcIiwgc3RyZWV0TmFtZSA9IFwiXCI7XHJcblx0XHRcdFx0XHRcdGZvciAodmFyIGkgaW4gYWRkcmVzcy5hZGRyZXNzX2NvbXBvbmVudHMpIHtcclxuXHRcdFx0XHRcdFx0XHR2YXIgYWRkcmVzc0NvbXBvbmVudCA9IGFkZHJlc3MuYWRkcmVzc19jb21wb25lbnRzW2ldO1xyXG5cdFx0XHRcdFx0XHRcdGlmIChhZGRyZXNzQ29tcG9uZW50LnR5cGVzWzBdID09IFwic3RyZWV0X251bWJlclwiKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRzdHJlZXROdW1iZXIgPSBhZGRyZXNzQ29tcG9uZW50LnNob3J0X25hbWU7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdGVsc2UgaWYgKGFkZHJlc3NDb21wb25lbnQudHlwZXNbMF0gPT0gXCJyb3V0ZVwiKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRzdHJlZXROYW1lID0gYWRkcmVzc0NvbXBvbmVudC5zaG9ydF9uYW1lO1xyXG5cdFx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0XHRlbHNlIGlmIChhZGRyZXNzQ29tcG9uZW50LnR5cGVzWzBdID09IFwibG9jYWxpdHlcIikge1xyXG5cdFx0XHRcdFx0XHRcdFx0bG9jYXRpb24uQ2l0eSA9IGFkZHJlc3NDb21wb25lbnQuc2hvcnRfbmFtZTtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0ZWxzZSBpZiAoYWRkcmVzc0NvbXBvbmVudC50eXBlc1swXSA9PSBcImFkbWluaXN0cmF0aXZlX2FyZWFfbGV2ZWxfMVwiKSB7XHJcblx0XHRcdFx0XHRcdFx0XHRsb2NhdGlvbi5TdGF0ZSA9IGFkZHJlc3NDb21wb25lbnQuc2hvcnRfbmFtZTtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0ZWxzZSBpZiAoYWRkcmVzc0NvbXBvbmVudC50eXBlc1swXSA9PSBcInBvc3RhbF9jb2RlXCIpIHtcclxuXHRcdFx0XHRcdFx0XHRcdGxvY2F0aW9uLlppcCA9IGFkZHJlc3NDb21wb25lbnQuc2hvcnRfbmFtZTtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdFx0XHQvL2RvIG5vdGhpbmdcclxuXHRcdFx0XHRcdFx0XHRcdHZhciB0ID0gYWRkcmVzc0NvbXBvbmVudDtcclxuXHRcdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0bG9jYXRpb24uQWRkcmVzcyA9IHN0cmVldE51bWJlciArICcgJyArIHN0cmVldE5hbWVcclxuXHRcdFx0XHRcdFx0bG9jYXRpb24uTmFtZSA9IGFkZHJlc3MuZm9ybWF0dGVkX2FkZHJlc3M7XHJcblx0XHRcdFx0XHRcdGxvY2F0aW9uLkxhdGl0dWRlID0gYWRkcmVzcy5nZW9tZXRyeS5sb2NhdGlvbi5sYXQ7XHJcblx0XHRcdFx0XHRcdGxvY2F0aW9uLkxvbmdpdHVkZSA9IGFkZHJlc3MuZ2VvbWV0cnkubG9jYXRpb24ubG5nO1xyXG5cdFx0XHRcdFx0XHRsb2NhdGlvbi5Hb29nbGVQbGFjZUlkID0gYWRkcmVzcy5wbGFjZV9pZDtcclxuXHJcblx0XHRcdFx0XHRcdCRzY29wZS5nb29nbGVMb2NhdGlvbnMucHVzaChsb2NhdGlvbik7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0aWYgKCRzY29wZS5nb29nbGVMb2NhdGlvbnMubGVuZ3RoID09IDApIHtcclxuXHRcdFx0XHRcdFx0QWRkcmVzc05vdEZvdW5kKCk7XHJcblx0XHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0XHQkc2NvcGUuaGFzSG9tZUFkZHJlc3MgPSB0cnVlOyAvL2Fzc3VtZSB1c2VyIHdpbGwgY2hvb3NlIGEgaG9tZSBhZGRyZXNzXHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fSwgZnVuY3Rpb24gKGVycikge1xyXG5cdFx0XHRcdFx0QWRkcmVzc05vdEZvdW5kKCk7XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH07XHJcblxyXG5cdFx0XHQvLyB1c2VyIG1lc3NhZ2UgaWYgbm8gYWRkcmVzc2VzIGFyZSBmb3VuZFxyXG5cdFx0XHRmdW5jdGlvbiBBZGRyZXNzTm90Rm91bmQoKSB7XHJcblx0XHRcdFx0VXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcignRmluZCBIb21lIEFkZHJlc3MnLCBcIkhvbWUgbG9jYXRpb24gbm90IGZvdW5kLiBQbGVhc2UgY2hhbmdlIGFkZHJlc3MgYW5kIHRyeSBhZ2Fpbi5cIilcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gdXBkYXRlIGhvbWUgYWRkcmVzc1xyXG5cdFx0XHQkc2NvcGUuVXBkYXRlSG9tZUFkZHJlc3MgPSBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0UHJvZmlsZVNlcnZpY2UuVXBkYXRlSG9tZUFkZHJlc3MoJHNjb3BlLnBhc3NlbmdlcklkLCAkc2NvcGUuSG9tZUFkZHJlc3MpXHJcblx0XHRcdFx0XHQudGhlbihcclxuXHRcdFx0XHRcdGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG5cdFx0XHRcdFx0XHR2YXIgbWVzc2FnZSA9IHJlc3BvbnNlLmRhdGEucmVzdWx0O1xyXG5cdFx0XHRcdFx0XHRpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSkge1xyXG5cdFx0XHRcdFx0XHRcdCRzY29wZS5zdWJtaXR0ZWQgPSB0cnVlO1xyXG5cdFx0XHRcdFx0XHRcdFV0aWxpdHlGYWN0b3J5LnRvYXN0U3VjY2VzcygnU3VjY2VzcycsIG1lc3NhZ2UpO1xyXG5cdFx0XHRcdFx0XHRcdHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0aWYgKCRzY29wZS5oYXNNb2RhbFBhcmVudCkge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHQkdWliTW9kYWxTdGFjay5kaXNtaXNzQWxsKCk7XHJcblx0XHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdFx0XHQkd2luZG93Lmhpc3RvcnkuYmFjaygpO1xyXG5cdFx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRcdH0sIDApO1xyXG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoJ0Vycm9yJywgbWVzc2FnZSk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH0sXHJcblx0XHRcdFx0XHRmdW5jdGlvbiAoZXJyKSB7XHJcblx0XHRcdFx0XHRcdHZhciBtZXNzYWdlID0gZXJyLmRhdGEuUmVzdWx0O1xyXG5cdFx0XHRcdFx0XHRVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKCdFcnJvcicsIG1lc3NhZ2UpO1xyXG5cdFx0XHRcdFx0fSk7XHJcblx0XHRcdH07XHJcblxyXG5cdFx0XHR2YXIgYWN0aXZhdGUgPSBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0Ly8gZGV0ZXJtaW5lIGlmIGhvbWUgbG9jYXRpb24gc2hvdWxkIGJlIGRpc3BsYXllZFxyXG5cdFx0XHQgICAgJHNjb3BlLnNob3dIb21lQWRkcmVzcyA9IFByb2ZpbGVTZXJ2aWNlLlNob3dIb21lQWRkcmVzcygpO1xyXG5cdFx0XHQgICAgaWYgKCRzY29wZS5zaG93SG9tZUFkZHJlc3MpIHtcclxuXHRcdFx0XHRcdC8vIGRldGVybWluZSBpZiBwYXNzZW5nZXIgbWF5IGVkaXQgaG9tZSBsb2NhdGlvblxyXG5cdFx0XHRcdFx0JHNjb3BlLmFsbG93RWRpdEhvbWVBZGRyZXNzID0gUHJvZmlsZVNlcnZpY2UuQWxsb3dFZGl0SG9tZUFkZHJlc3MoKTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHQgICAgLy8gcmVhZCBjdXJyZW50IHBhc3NlbmdlciBob21lIGFkZHJlc3MgaWYgbm90IGluIHRoZSBQcm9maWxlIHBhZ2VcclxuXHRcdFx0XHRpZiAoISRzY29wZS5pc0NvbnRhaW5lck1hbmFnaW5nRGF0YSkge1xyXG5cdFx0XHRcdCAgICBQcm9maWxlU2VydmljZS5HZXRIb21lQWRkcmVzcygkc2NvcGUucGFzc2VuZ2VySWQpXHJcblx0XHRcdFx0XHQudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuXHRcdFx0XHRcdCAgICAkc2NvcGUuSG9tZUFkZHJlc3MgPSByZXNwb25zZSA9PSBudWxsID8ge30gOiByZXNwb25zZTtcclxuXHRcdFx0XHRcdCAgICAkc2NvcGUuaW52YWxpZCA9IGZhbHNlO1xyXG5cdFx0XHRcdFx0fSxcclxuXHRcdFx0XHRcdGZ1bmN0aW9uIChlcnIpIHtcclxuXHRcdFx0XHRcdCAgICAkc2NvcGUuZXJyb3IgPSBlcnIuZXJyb3JfZGVzY3JpcHRpb247XHJcblx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHR9IFxyXG5cdFx0XHR9O1xyXG5cclxuXHRcdFx0Ly8gdXBkYXRlIHRoZSBTdWl0ZSBzZXBhcmF0ZWx5XHJcblx0XHRcdCRzY29wZS5pc1VwZGF0aW5nU3VpdGUgPSBmYWxzZTtcclxuXHRcdFx0JHNjb3BlLiR3YXRjaChcclxuXHRcdFx0XCJIb21lQWRkcmVzc1NlYXJjaC5TdWl0ZVwiLFxyXG5cdFx0XHRmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0JHNjb3BlLmlzVXBkYXRpbmdTdWl0ZSA9IHRydWU7XHJcblx0XHRcdFx0JHNjb3BlLkhvbWVBZGRyZXNzLlN1aXRlID0gJHNjb3BlLkhvbWVBZGRyZXNzU2VhcmNoLlN1aXRlO1xyXG5cdFx0XHR9LCB0cnVlKTtcclxuXHJcblx0XHRcdC8vIEhvbWVBZGRyZXNzIGlzIGxvYWRlZCBlaXRoZXIgZnJvbSB0aGUgY29udGFpbmluZyBwYWdlLCBvciBmcm9tIHRoaXMgY29udHJvbFxyXG5cdFx0XHQkc2NvcGUuJHdhdGNoKFxyXG5cdFx0XHRcIkhvbWVBZGRyZXNzXCIsIFxyXG4gICAgICAgICAgICBcclxuXHRcdFx0ZnVuY3Rpb24gKHNvdXJjZSwgZGF0YSkge1xyXG5cdFx0XHQgICAgaWYgKCRzY29wZS5pc1VwZGF0aW5nU3VpdGUgPT0gdHJ1ZSkge1xyXG5cdFx0XHQgICAgICAgICRzY29wZS5pc1VwZGF0aW5nU3VpdGUgPSBmYWxzZTtcclxuXHRcdFx0ICAgIH1cclxuXHRcdFx0ICAgICRzY29wZS5oYXNIb21lQWRkcmVzcyA9IGZhbHNlO1xyXG5cdFx0XHQgICAgJHNjb3BlLkhvbWVBZGRyZXNzU2VhcmNoID0ge307XHJcblx0XHRcdCAgICBpZiAoJHNjb3BlLkhvbWVBZGRyZXNzKSB7XHJcblx0XHRcdCAgICAgICAgJHNjb3BlLmhhc0hvbWVBZGRyZXNzID0gJHNjb3BlLkhvbWVBZGRyZXNzLkdvb2dsZVBsYWNlSWQ7XHJcblx0XHRcdCAgICAgICAgJHNjb3BlLkhvbWVBZGRyZXNzU2VhcmNoID0gYW5ndWxhci5jb3B5KCRzY29wZS5Ib21lQWRkcmVzcyk7XHJcblx0XHRcdCAgICAgICAgaWYgKCRzY29wZS5Ib21lQWRkcmVzcyAmJiAkc2NvcGUuSG9tZUFkZHJlc3MuR29vZ2xlUGxhY2VJZCkge1xyXG5cdFx0XHQgICAgICAgICAgICAvLyBpbml0aWFsaXplIGdsb2JhbHNcclxuXHRcdFx0ICAgICAgICAgICAgJHNjb3BlLmdvb2dsZUxvY2F0aW9ucyA9IFtdO1xyXG5cclxuXHRcdFx0ICAgICAgICAgICAgLy8gbG9hZCBhbmQgc2VsZWN0IHRoZSBjdXJyZW50IGhvbWUgYWRkcmVzcywgaWYgYW55XHJcblx0XHRcdCAgICAgICAgICAgIGlmICgkc2NvcGUuSG9tZUFkZHJlc3MgJiYgJHNjb3BlLkhvbWVBZGRyZXNzLkdvb2dsZVBsYWNlSWQgJiYgJHNjb3BlLkhvbWVBZGRyZXNzLkdvb2dsZVBsYWNlSWQgIT0gXCJcIikge1xyXG5cdFx0XHQgICAgICAgICAgICAgICAgJHNjb3BlLmdvb2dsZUxvY2F0aW9ucy5wdXNoKCRzY29wZS5Ib21lQWRkcmVzcyk7XHJcblx0XHRcdCAgICAgICAgICAgICAgICAkc2NvcGUuaW52YWxpZCA9IGZhbHNlO1xyXG5cdFx0XHQgICAgICAgICAgICB9XHJcblxyXG5cdFx0XHQgICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IGZhbHNlO1xyXG5cdFx0XHQgICAgICAgIH1cclxuXHRcdFx0ICAgIH1cclxuXHRcdFx0XHRcclxuXHRcdFx0fSwgdHJ1ZSk7XHJcblxyXG5cdFx0XHRcclxuXHRcdCAgICAvL1xyXG5cdFx0ICAgIC8vICRvbkluaXQgZG9lcyBub3Qgd29yayBpbiBJb25pYyB3b3JsZC5cclxuXHRcdCAgICAvLyBtdXN0IGV4ZWN1dGUgYWN0aXZhdGUoKSBvdGhlcndpc2UsIGFkZCBmdW5jdGlvbiB0byAkb25Jbml0LlxyXG5cdFx0ICAgIC8vXHJcblx0XHRcdGlmICgkKCdib2R5JykuaGFzQ2xhc3MoJ2lzLWlvbmljJykpIHtcclxuXHRcdFx0ICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0ICAgICAgICBhY3RpdmF0ZSgpO1xyXG5cdFx0XHQgICAgfSlcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0ICAgIHRoaXMuJG9uSW5pdCA9IGFjdGl2YXRlO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG5cdCd1c2Ugc3RyaWN0JztcclxuXHJcblx0YW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignUHJvZmlsZUNvbnRyb2xsZXInLCBQcm9maWxlQ29udHJvbGxlcik7XHJcblxyXG5cdFByb2ZpbGVDb250cm9sbGVyLiRpbmplY3QgPSBbJyRzY29wZScsICckcm9vdFNjb3BlJywgJyRsb2NhdGlvbicsICckd2luZG93JywgJ0RpdmlzaW9uU2VydmljZScsICdMb2NhdGlvbkZhY3RvcnknLCAnYXV0aFNlcnZpY2UnLCAnUHJvZmlsZVNlcnZpY2UnLCAnQ29tbW9uU2VydmljZScsICdVdGlsaXR5RmFjdG9yeScsICdMb2NhdGlvblNlcnZpY2UnLCAnTWVzc2FnZVNlcnZpY2UnLCAnUmVkaXJlY3Rpb25TZXJ2aWNlJywnUGFnZVNlcnZpY2UnXTtcclxuXHJcblx0ZnVuY3Rpb24gUHJvZmlsZUNvbnRyb2xsZXIoJHNjb3BlLCAkcm9vdFNjb3BlLCAkbG9jYXRpb24sICR3aW5kb3csIERpdmlzaW9uU2VydmljZSwgTG9jYXRpb25GYWN0b3J5LCBhdXRoU2VydmljZSwgUHJvZmlsZVNlcnZpY2UsIENvbW1vblNlcnZpY2UsIFV0aWxpdHlGYWN0b3J5LCBMb2NhdGlvblNlcnZpY2UsIE1lc3NhZ2VTZXJ2aWNlLCBSZWRpcmVjdGlvblNlcnZpY2UsIFBhZ2VTZXJ2aWNlKSB7XHJcblx0XHQvLyBpbml0aWFsaXplIGdsb2JhbHNcclxuXHRcdHZhciB2bSA9IHRoaXM7XHJcblx0XHR2bS5QYWdlU2VydmljZSA9IFBhZ2VTZXJ2aWNlO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlLnNldFRpdGxlKCdQcm9maWxlJyk7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2Uuc2V0SGVhZGxpbmUoJ0xhdGVzdCBTZXJ2aWNlIFVwZGF0ZXMnKTtcclxuXHRcdHZtLmxvYWRpbmcgPSB0cnVlO1xyXG5cdFx0dm0uaW52YWxpZCA9IHRydWU7XHJcblx0XHR2bS5wYXNzZW5nZXIgPSB7fTtcclxuXHRcdHZtLnBhc3Nlbmdlci5Ib21lQWRkcmVzcyA9IHt9O1xyXG5cdFx0dm0ucGFzc2VuZ2VySWQgPSBhdXRoU2VydmljZS5hdXRoZW50aWNhdGlvbi5wYXNzZW5nZXJJZDtcclxuXHRcdHZtLmRpdmlzaW9uSWQgPSBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpO1xyXG5cdFx0dm0uc3VibWl0dGVkID0gZmFsc2U7XHJcblxyXG5cdFx0Ly8gdXBkYXRlIHByb2ZpbGVcclxuXHRcdHZtLkNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0JHdpbmRvdy5oaXN0b3J5LmJhY2soKTtcclxuXHRcdH07XHJcblxyXG5cdFx0dm0uVXBkYXRlUHJvZmlsZSA9IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0Ly8gdXBkYXRlIGhvbWUgYWRkcmVzc1xyXG5cdFx0XHRQcm9maWxlU2VydmljZS5VcGRhdGVQcm9maWxlKHZtLnBhc3NlbmdlcilcclxuICAgICAgICAgICAgICAgIC50aGVuKFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBcdHZhciBtZXNzYWdlID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICBcdGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICBcdFx0dm0uc3VibWl0dGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIFx0XHRVdGlsaXR5RmFjdG9yeS50b2FzdFN1Y2Nlc3MoJ1N1Y2Nlc3MnLCBtZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgIFx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIFx0XHRcdCR3aW5kb3cuaGlzdG9yeS5iYWNrKCk7XHJcbiAgICAgICAgICAgICAgICBcdFx0fSwgMCk7XHJcbiAgICAgICAgICAgICAgICBcdH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBcdFx0VXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcignRXJyb3InLCBtZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgIFx0fVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIFx0dmFyIG1lc3NhZ2UgPSBlcnIuZGF0YS5SZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICBcdFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoJ0Vycm9yJywgbWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHRcdH07XHJcblxyXG5cdFx0dmFyIGFjdGl2YXRlID0gZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRpZiAoIWF1dGhTZXJ2aWNlLmlzTG9nZ2VkSW4oKSkge1xyXG5cdFx0XHRcdFJlZGlyZWN0aW9uU2VydmljZS5zYXZlKCcvc2hhcmVkL3Byb2ZpbGUnKTtcclxuXHRcdFx0XHQkbG9jYXRpb24ucGF0aCgnbG9naW4nKTtcclxuXHRcdFx0fSBlbHNlIHtcclxuXHRcdFx0XHR2bS5zaG93SG9tZUFkZHJlc3MgPSBQcm9maWxlU2VydmljZS5TaG93SG9tZUFkZHJlc3MoKTtcclxuXHRcdFx0XHRpZiAodm0uc2hvd0hvbWVBZGRyZXNzKSB7XHJcblx0XHRcdFx0XHQvLyBkZXRlcm1pbmUgaWYgcGFzc2VuZ2VyIG1heSBlZGl0IGhvbWUgbG9jYXRpb25cclxuXHRcdFx0XHQgICAgdm0uYWxsb3dFZGl0SG9tZUFkZHJlc3MgPSBQcm9maWxlU2VydmljZS5BbGxvd0VkaXRIb21lQWRkcmVzcygpO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0Ly8gcmVhZCBjdXJyZW50IHBhc3NlbmdlciBwcm9maWxlIGluZm9cclxuXHRcdFx0XHRQcm9maWxlU2VydmljZS5HZXRQcm9maWxlKHZtLnBhc3NlbmdlcklkKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG5cdFx0XHRcdCAgICB2bS5wYXNzZW5nZXIgPSByZXNwb25zZTtcclxuXHRcdFx0XHQgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xyXG5cclxuXHRcdFx0XHR9LFxyXG5cdFx0XHRcdGZ1bmN0aW9uIChlcnIpIHtcclxuXHRcdFx0XHRcdHZtLmVycm9yID0gZXJyLmVycm9yX2Rlc2NyaXB0aW9uO1xyXG5cdFx0XHRcdFx0dm0ubG9hZGluZyA9IGZhbHNlO1xyXG5cdFx0XHRcdH0pO1xyXG5cdFx0XHR9XHJcblx0XHR9O1xyXG5cdCAgICAvL1xyXG5cdCAgICAvLyAkb25Jbml0IGRvZXMgbm90IHdvcmsgaW4gSW9uaWMgd29ybGQuXHJcblx0ICAgIC8vIG11c3QgZXhlY3V0ZSBhY3RpdmF0ZSgpIG90aGVyd2lzZSwgYWRkIGZ1bmN0aW9uIHRvICRvbkluaXQuXHJcblx0ICAgIC8vXHJcblx0XHRpZiAoJCgnYm9keScpLmhhc0NsYXNzKCdpcy1pb25pYycpKSB7XHJcblx0XHQgICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xyXG5cdFx0ICAgICAgICBhY3RpdmF0ZSgpO1xyXG5cdFx0ICAgIH0pXHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0ICAgIHZtLiRvbkluaXQgPSBhY3RpdmF0ZTtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBTdGFydCBvZiBjb2RlIGZvciBJb25pY1xyXG5cdFx0dm0uaW9uaWNJbmNsdWRlID0gJ2FwcC9zaGFyZWQvcHJvZmlsZS9wcm9maWxlLmh0bWwnO1xyXG5cdFx0dm0uaW9uaWNDdXN0b21DbGFzc05hbWUgPSAnaW9uaWMtcHJvZmlsZSBjYXJkJztcclxuXHRcdHZtLmlvbmljSGlkZU5hdkJhciA9IGZhbHNlO1xyXG5cdFx0dm0uaW9uaWNVc2VSZWZyZXNoZXIgPSBmYWxzZTtcclxuXHRcdC8vIEVuZCBvZiBjb2RlIGZvciBJb25pY1xyXG5cdH1cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdTZXR0aW5nc0NvbnRyb2xsZXInLCBTZXR0aW5nc0NvbnRyb2xsZXIpO1xyXG5cclxuICAgIFNldHRpbmdzQ29udHJvbGxlci4kaW5qZWN0ID0gWyckcm9vdFNjb3BlJywgJ1NldHRpbmdzU2VydmljZScsICdhdXRoU2VydmljZScsICdVdGlsaXR5RmFjdG9yeScsICdQYWdlU2VydmljZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIFNldHRpbmdzQ29udHJvbGxlcigkcm9vdFNjb3BlLCBTZXR0aW5nc1NlcnZpY2UsIGF1dGhTZXJ2aWNlLCBVdGlsaXR5RmFjdG9yeSwgUGFnZVNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLmlzU2V0dGluZ3NMb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgdm0uaXNTZXR0aW5nc0xvYWRlZCA9IGZhbHNlO1xyXG4gICAgICAgIHZtLmlzU2V0dGluZ3NVcGRhdGluZyA9IGZhbHNlO1xyXG4gICAgICAgIHZtLnNldHRpbmdzID0gbnVsbDtcclxuICAgICAgICB2bS51cGRhdGVTZXR0aW5ncyA9IHVwZGF0ZVNldHRpbmdzO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlID0gUGFnZVNlcnZpY2U7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2Uuc2V0VGl0bGUoJ1NldHRpbmdzJyk7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2Uuc2V0SGVhZGxpbmUoJ01hbmFnZSBBcHAgU2V0dGluZ3MnKTtcclxuICAgICAgICBcclxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcclxuICAgICAgICAgICAgZ2V0U2V0dGluZ3MoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0U2V0dGluZ3MoKSB7XHJcbiAgICAgICAgICAgIHZtLmlzU2V0dGluZ3NMb2FkaW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgdm0uaXNTZXR0aW5nc0xvYWRlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBTZXR0aW5nc1NlcnZpY2VcclxuICAgICAgICAgICAgICAgLmdldFNldHRpbmdzKGF1dGhTZXJ2aWNlLmF1dGhlbnRpY2F0aW9uLnBhc3NlbmdlcklkKVxyXG4gICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2UubGVuZ3RoID4gMTApXHJcbiAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IHJlc3BvbnNlLnN1YnN0cmluZygocmVzcG9uc2UubGVuZ3RoLTEwKSk7XHJcbiAgICAgICAgICAgICAgIHZtLmNsaWVudFRlbGVwaG9uZSA9IHJlc3BvbnNlO1xyXG4gICAgICAgICAgICAgICB2bS5pc1NldHRpbmdzTG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICB2bS5pc1NldHRpbmdzTG9hZGVkID0gdHJ1ZTtcclxuICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgdm0uaXNTZXR0aW5nc0xvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVNldHRpbmdzKCkge1xyXG4gICAgICAgICAgICB2bS5pc1NldHRpbmdzVXBkYXRpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICB2YXIgbW9iaWxlTm8gPSB2bS5jbGllbnRUZWxlcGhvbmU7XHJcbiAgICAgICAgICAgIGlmIChtb2JpbGVObyAhPSBcIlwiICYmICFpc05hTihtb2JpbGVObykgJiYgbW9iaWxlTm8gPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBtb2JpbGVObyA9IFwiKzFcIiArIG1vYmlsZU5vO1xyXG4gICAgICAgICAgICAgICAgdmFyIHNldHRpbmdzID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIFwiUGFzc2VuZ2VySWRcIjogYXV0aFNlcnZpY2UuYXV0aGVudGljYXRpb24ucGFzc2VuZ2VySWQsXHJcbiAgICAgICAgICAgICAgICAgICAgXCJDbGllbnRUZWxlcGhvbmVcIjogbW9iaWxlTm9cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIFNldHRpbmdzU2VydmljZVxyXG4gICAgICAgICAgICAgICAgICAgLnVwZGF0ZVNldHRpbmdzKHNldHRpbmdzKVxyXG4gICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0U3VjY2VzcygnU3VjY2VzcycsICdTZXR0aW5ncyB1cGRhdGVzIHN1Y2Vzc2Z1bGx5Jyk7XHJcbiAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoJ0Vycm9yJywgJ0NvdWxkIG5vdCB1cGRhdGUgc2V0dGluZ3MnKTtcclxuICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgIHZtLmlzU2V0dGluZ3NVcGRhdGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgZ2V0U2V0dGluZ3MoKTtcclxuICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKCdFcnJvcicsICdDb3VsZCBub3QgdXBkYXRlIHNldHRpbmdzJyk7XHJcbiAgICAgICAgICAgICAgICAgICB2bS5pc1NldHRpbmdzVXBkYXRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgIGdldFNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcignRXJyb3InLCAnUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyJyk7XHJcbiAgICAgICAgICAgICAgICB2bS5pc1NldHRpbmdzVXBkYXRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgYWN0aXZhdGUoKTtcclxuICAgICAgICAvLyBTdGFydCBvZiBjb2RlIGZvciBJb25pY1xyXG4gICAgICAgIHZtLmlvbmljSW5jbHVkZSA9ICdhcHAvc2hhcmVkL3NldHRpbmdzL3NldHRpbmdzLmh0bWwnO1xyXG4gICAgICAgIHZtLmlvbmljQ3VzdG9tQ2xhc3NOYW1lID0gJ2lvbmljLXNldHRpbmdzJztcclxuICAgICAgICB2bS5pb25pY0hpZGVOYXZCYXIgPSBmYWxzZTtcclxuICAgICAgICB2bS5pb25pY1VzZVJlZnJlc2hlciA9IHRydWU7XHJcbiAgICAgICAgdm0uaW9uaWNQdWxsaW5nVGV4dCA9ICdSZWZyZXNoIFNldHRpbmdzJztcclxuICAgICAgICB2bS5pb25pY1JlZnJlc2hpbmdUZXh0ID0gJ0xvYWRpbmcgU2V0dGluZ3MnO1xyXG4gICAgICAgIHZtLmlvbmljU3Bpbm5lciA9ICdzcGlyYWwnOyAvLyBub25lIHRvIGRpc2FibGUuXHJcbiAgICAgICAgdm0ucmVmcmVzaCA9IGZ1bmN0aW9uIChyZWZyZXNoZXIpIHtcclxuICAgICAgICAgICAgYWN0aXZhdGUoKTtcclxuICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdzY3JvbGwucmVmcmVzaENvbXBsZXRlJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIEVuZCBvZiBjb2RlIGZvciBJb25pY1xyXG4gICAgfVxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmZhY3RvcnkoJ1NldHRpbmdzU2VydmljZScsIFNldHRpbmdzU2VydmljZSk7XHJcblxyXG4gICAgU2V0dGluZ3NTZXJ2aWNlLiRpbmplY3QgPSBbJyRodHRwJywgJyRxJywgJ2VudiddO1xyXG5cclxuICAgIGZ1bmN0aW9uIFNldHRpbmdzU2VydmljZSgkaHR0cCwgJHEsIGVudikge1xyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgICAgICBnZXRTZXR0aW5nczogZ2V0U2V0dGluZ3MsXHJcbiAgICAgICAgICAgIHVwZGF0ZVNldHRpbmdzOiB1cGRhdGVTZXR0aW5nc1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRTZXR0aW5ncyhwYXNzZW5nZXJJZCkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAvL2dldCB0aGUgYmFzZSB1cmwgZnJvbSBjb25maWcuXHJcbiAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gZW52Lm9uZU1WQXBpVXJsICsgXCJwYXNzZW5nZXIvXCIgKyBwYXNzZW5nZXJJZCArICcvc2V0dGluZ3MnICsgXCI/cm5kPVwiICsgRGF0ZS5wYXJzZShuZXcgRGF0ZSgpKTtcclxuICAgICAgICAgICAgJGh0dHAuZ2V0KHNlcnZpY2VVcmwpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLmRhdGEgJiYgcmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSlcclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlLmRhdGEucmVzdWx0KTtcclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QocmVzcG9uc2UuZGF0YS5lcnJvcnMpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIFxyXG4gICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVNldHRpbmdzKHNldHRpbmdzKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gZW52Lm9uZU1WQXBpVXJsICsgJ3Bhc3Nlbmdlci9zZXR0aW5ncyc7XHJcbiAgICAgICAgICAgICRodHRwLnBvc3Qoc2VydmljZVVybCwgc2V0dGluZ3MpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLmRhdGEgJiYgcmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSlcclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlLmRhdGEucmVzdWx0KTtcclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QocmVzcG9uc2UuZGF0YS5lcnJvcnMpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ1N1cHBvcnRDb250cm9sbGVyJywgU3VwcG9ydENvbnRyb2xsZXIpO1xyXG5cclxuICAgIFN1cHBvcnRDb250cm9sbGVyLiRpbmplY3QgPSBbJyRyb290U2NvcGUnLCAnJGxvY2F0aW9uJywgJ0R5bmFtaWNDb250ZW50U2VydmljZScsICdQYWdlU2VydmljZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIFN1cHBvcnRDb250cm9sbGVyKCRyb290U2NvcGUsJGxvY2F0aW9uLCBEeW5hbWljQ29udGVudFNlcnZpY2UsIFBhZ2VTZXJ2aWNlKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS5QYWdlU2VydmljZSA9IFBhZ2VTZXJ2aWNlO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlLnNldFRpdGxlKCdTdXBwb3J0Jyk7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2Uuc2V0SGVhZGxpbmUoJ0ZBUScpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGZ1bmN0aW9uIGdldERhdGEoKSB7XHJcbiAgICAgICAgICAgIER5bmFtaWNDb250ZW50U2VydmljZS5nZXRTdXBwb3J0RkFRKCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGlmKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEpXHJcbiAgICAgICAgICAgICAgICAgICAgdm0uZGF0YSA9IHJlc3BvbnNlLmRhdGEucmVzdWx0LkZBUUNvbnRlbnQ7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHsgXHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnc29tZXRoaW5nIGlzIHdyb25nJyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZ2V0RGF0YSgpO1xyXG4gICAgICAgIC8vIC8vIFN0YXJ0IG9mIGNvZGUgZm9yIElvbmljXHJcbiAgICAgICAgLy8gdm0uaW9uaWNJbmNsdWRlID0gJ2FwcC9zaGFyZWQvc3VwcG9ydC9zdXBwb3J0Lmh0bWwnO1xyXG4gICAgICAgIC8vIHZtLmlvbmljQ3VzdG9tQ2xhc3NOYW1lID0gJ2lvbmljLXN1cHBvcnQgY2FyZCc7XHJcbiAgICAgICAgLy8gdm0uaW9uaWNIaWRlTmF2QmFyID0gZmFsc2U7XHJcbiAgICAgICAgLy8gdm0uaW9uaWNVc2VSZWZyZXNoZXIgPSB0cnVlO1xyXG4gICAgICAgIC8vIHZtLmlvbmljUHVsbGluZ1RleHQgPSAnUmVmcmVzaCBTdXBwb3J0JztcclxuICAgICAgICAvLyB2bS5pb25pY1JlZnJlc2hpbmdUZXh0ID0gJ0xvYWRpbmcgU3VwcG9ydCc7XHJcbiAgICAgICAgLy8gdm0uaW9uaWNTcGlubmVyID0gJ3NwaXJhbCc7IC8vIG5vbmUgdG8gZGlzYWJsZS5cclxuICAgICAgICAvLyB2bS5yZWZyZXNoID0gZnVuY3Rpb24gKHJlZnJlc2hlcikge1xyXG4gICAgICAgIC8vICAgICBnZXREYXRhKCk7XHJcbiAgICAgICAgLy8gICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnc2Nyb2xsLnJlZnJlc2hDb21wbGV0ZScpO1xyXG4gICAgICAgIC8vIH1cclxuICAgICAgICAvLyAvLyBFbmQgb2YgY29kZSBmb3IgSW9uaWNcclxuICAgIH1cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdFeHRlcm5hbFJlZ2lzdHJhdGlvbkNvbnRyb2xsZXInLCBFeHRlcm5hbFJlZ2lzdHJhdGlvbkNvbnRyb2xsZXIpO1xyXG5cclxuICAgIEV4dGVybmFsUmVnaXN0cmF0aW9uQ29udHJvbGxlci4kaW5qZWN0ID0gWyckbG9jYXRpb24nLCAnJHRpbWVvdXQnLCAnJHJvb3RTY29wZScsICd2Y1JlY2FwdGNoYVNlcnZpY2UnLFxyXG4gICAgICAgICdhdXRoU2VydmljZScsICdWZXJpZmljYXRpb25TZXJ2aWNlJywgJ2VudicsICdEaXZpc2lvblNlcnZpY2UnLCAnQ29uZmlnRmFjdG9yeScsICdSZWRpcmVjdGlvblNlcnZpY2UnLCAnUGFnZVNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBFeHRlcm5hbFJlZ2lzdHJhdGlvbkNvbnRyb2xsZXIoJGxvY2F0aW9uLCAkdGltZW91dCwgJHJvb3RTY29wZSwgdmNSZWNhcHRjaGFTZXJ2aWNlLCBhdXRoU2VydmljZSxcclxuICAgICAgICBWZXJpZmljYXRpb25TZXJ2aWNlLCBlbnYsIERpdmlzaW9uU2VydmljZSwgQ29uZmlnRmFjdG9yeSwgUmVkaXJlY3Rpb25TZXJ2aWNlLCBQYWdlU2VydmljZSkge1xyXG5cclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG5cclxuICAgICAgICB2YXIgd2lkZ2V0SWQgPSAtMTtcclxuICAgICAgICB2bS5jYXB0Y2hhUHVibGljS2V5ID0gZW52LmNhcHRjaGFQdWJsaWNLZXk7XHJcbiAgICAgICAgdm0uV2lkZ2V0Q3JlYXRlID0gd2lkZ2V0Q3JlYXRlO1xyXG4gICAgICAgIHZtLnNldENhcHRjaGFSZXNwb25zZSA9IHNldENhcHRjaGFSZXNwb25zZTtcclxuXHJcbiAgICAgICAgdm0uaXNDbGlja2VkID0gZmFsc2U7XHJcbiAgICAgICAgdm0uc2F2ZWRTdWNjZXNzZnVsbHkgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgdm0ub3JnYW5pc2F0aW9uSWRMYWJlbCA9ICcnO1xyXG4gICAgICAgIHZtLnNob3dPcmdhbmlzYXRpb25JZCA9IGZhbHNlO1xyXG4gICAgICAgIHZtLnNob3dBbGxvd1NtcyA9IGZhbHNlO1xyXG4gICAgICAgIHZtLnNob3dGaXJzdE5hbWUgPSBmYWxzZTtcclxuICAgICAgICB2bS5zaG93TGFzdE5hbWUgPSBmYWxzZTtcclxuICAgICAgICB2bS5zaG93Q2xpZW50VGVsZXBob25lID0gZmFsc2U7XHJcbiAgICAgICAgdm0uYWxsb3dTbXMgPSBmYWxzZTtcclxuICAgICAgICB2bS50ZWxOdW0gPSAnJztcclxuICAgICAgICB2bS5jbGllbnRQYXNzZW5nZXJJZCA9ICcnO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlID0gUGFnZVNlcnZpY2U7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2Uuc2V0VGl0bGUoJ05ldyBBY2NvdW50Jyk7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2Uuc2V0SGVhZGxpbmUoJ0NyZWF0ZSBhIE9ORU1WIExvZ2luJyk7XHJcblxyXG4gICAgICAgIHZhciBmZWVkVHlwZSA9ICcnO1xyXG4gICAgICAgIHZhciByZWdpc3RyYXRpb25GYWlsZWRNc2cgPSBcIkZhaWxlZCB0byByZWdpc3Rlci4gUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci5cIjtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2V0Q2FwdGNoYVJlc3BvbnNlKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIGF1dGhTZXJ2aWNlLnZlcmlmeUNhcHRjaGEocmVzcG9uc2UpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFyZXN1bHQuc3VjY2VzcylcclxuICAgICAgICAgICAgICAgICAgICB2Y1JlY2FwdGNoYVNlcnZpY2UucmVsb2FkKHdpZGdldElkKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiB3aWRnZXRDcmVhdGUoX3dpZGdldElkKSB7XHJcbiAgICAgICAgICAgIHdpZGdldElkID0gX3dpZGdldElkO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGFjdGl2YXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgZGl2aXNpb25JZCA9IERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCk7XHJcblxyXG4gICAgICAgICAgICBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JbmZvKClcclxuICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIGZlZWRUeXBlID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQuRGl2aXNpb25GZWVkVHlwZS5GZWVkVHlwZTtcclxuICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdm0ucmVnaXN0ZXJEYXRhID0ge1xyXG4gICAgICAgICAgICAgICAgdXNlck5hbWU6IGF1dGhTZXJ2aWNlLmV4dGVybmFsQXV0aERhdGEudXNlck5hbWUsXHJcbiAgICAgICAgICAgICAgICBwcm92aWRlcjogYXV0aFNlcnZpY2UuZXh0ZXJuYWxBdXRoRGF0YS5wcm92aWRlcixcclxuICAgICAgICAgICAgICAgIGV4dGVybmFsQWNjZXNzVG9rZW46IGF1dGhTZXJ2aWNlLmV4dGVybmFsQXV0aERhdGEuZXh0ZXJuYWxBY2Nlc3NUb2tlbiwgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBkaXZpc2lvbklkOiBkaXZpc2lvbklkLFxyXG4gICAgICAgICAgICAgICAgZmlyc3ROYW1lOiBhdXRoU2VydmljZS5leHRlcm5hbEF1dGhEYXRhLmZpcnN0TmFtZSxcclxuICAgICAgICAgICAgICAgIGxhc3ROYW1lOiBhdXRoU2VydmljZS5leHRlcm5hbEF1dGhEYXRhLmxhc3ROYW1lXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICB2bS5maXJzdE5hbWUgPSB2bS5yZWdpc3RlckRhdGEuZmlyc3ROYW1lO1xyXG4gICAgICAgICAgICB2bS5sYXN0TmFtZSA9IHZtLnJlZ2lzdGVyRGF0YS5sYXN0TmFtZTtcclxuICAgICAgICAgICAgdm0ucHJvdmlkZXIgPSB2bS5yZWdpc3RlckRhdGEucHJvdmlkZXI7XHJcblxyXG4gICAgICAgICAgICB2bS5QYWdlU2VydmljZS5zZXRIZWFkbGluZSh2bS5wcm92aWRlciArJyBTaWduIFVwJyk7XHJcblxyXG4gICAgICAgICAgICBDb25maWdGYWN0b3J5XHJcbiAgICAgICAgICAgICAgICAuZ2V0RGl2aXNpb25QYXJhbWV0ZXJzKGRpdmlzaW9uSWQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocGFyYW1zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmFtcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5vcmdhbmlzYXRpb25JZExhYmVsID0gcGFyYW1zLk9yZ2FuaXNhdGlvbklkTGFiZWwgPyBwYXJhbXMuT3JnYW5pc2F0aW9uSWRMYWJlbCA6ICdDbGllbnQgUGFzc2VuZ2VyIElkJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uc2hvd09yZ2FuaXNhdGlvbklkID0gcGFyYW1zLlNob3dPcmdhbmlzYXRpb25JZCA/IGV2YWwocGFyYW1zLlNob3dPcmdhbmlzYXRpb25JZC50b0xvd2VyQ2FzZSgpKTogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNob3dBbGxvd1NtcyA9IHBhcmFtcy5TaG93QWxsb3dTbXMgPyBldmFsKHBhcmFtcy5TaG93QWxsb3dTbXMudG9Mb3dlckNhc2UoKSk6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zaG93Rmlyc3ROYW1lID0gcGFyYW1zLlNob3dGaXJzdE5hbWUgPyBldmFsKHBhcmFtcy5TaG93Rmlyc3ROYW1lLnRvTG93ZXJDYXNlKCkpIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNob3dMYXN0TmFtZSA9IHBhcmFtcy5TaG93TGFzdE5hbWUgPyBldmFsKHBhcmFtcy5TaG93TGFzdE5hbWUudG9Mb3dlckNhc2UoKSkgOiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zaG93Q2xpZW50VGVsZXBob25lID0gcGFyYW1zLlNob3dDbGllbnRUZWxlcGhvbmUgPyBldmFsKHBhcmFtcy5TaG93Q2xpZW50VGVsZXBob25lLnRvTG93ZXJDYXNlKCkpIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBhY3RpdmF0ZSgpO1xyXG5cclxuICAgICAgICB2bS5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIFJlZGlyZWN0aW9uU2VydmljZS5yZWRpcmVjdFRvKCdkYXNoYm9hcmQvJyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5yZWdpc3RlckV4dGVybmFsID0gZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICAgICAgdm0ubWVzc2FnZSA9ICcnO1xyXG4gICAgICAgICAgICB2bS5pc0NsaWNrZWQgPSB0cnVlOyAgICAgICAgICAgIFxyXG5cclxuICAgICAgICAgICAgVmVyaWZpY2F0aW9uU2VydmljZVxyXG4gICAgICAgICAgICAgICAucGFzc2VuZ2VyRXhpc3RzKHZtLmNsaWVudFBhc3NlbmdlcklkKVxyXG4gICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgIT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIHZtLm1lc3NhZ2UgPSByZWdpc3RyYXRpb25GYWlsZWRNc2c7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgdm0uaXNDbGlja2VkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgIGlmIChmZWVkVHlwZSA9PSAnRmVlZE9ubHknICYmICFyZXNwb25zZS5kYXRhLnJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgIC8vY2FuJ3QgcmVnaXN0ZXIgYXMgcGFzc2VuZ2VyIG5vdCBmb3VuZCBmb3IgZGl2aXNpb24gdGhhdCBpcyBmZWVkIG9ubHkvXHJcbiAgICAgICAgICAgICAgICAgICAgICAgdm0ubWVzc2FnZSA9IFwiUGFzc2VuZ2VyIG5vdCBmb3VuZC5cIjtcclxuICAgICAgICAgICAgICAgICAgICAgICB2bS5pc0NsaWNrZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgcmVnaXN0ZXIocmVzcG9uc2UuZGF0YS5yZXN1bHQpO1xyXG4gICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVnaXN0ZXIoZGl2aXNpb25TdXBwb3J0c0ZlZWQpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciBtb2JpbGVObyA9IHZtLnRlbE51bTtcclxuICAgICAgICAgICAgaWYgKG1vYmlsZU5vICYmIG1vYmlsZU5vICE9ICcnKVxyXG4gICAgICAgICAgICAgICAgbW9iaWxlTm8gPSBcIisxXCIgKyBtb2JpbGVObztcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgICB2bS5yZWdpc3RlckRhdGEudGVsZXBob25lTnVtYmVyID0gbW9iaWxlTm87XHJcbiAgICAgICAgICAgIHZtLnJlZ2lzdGVyRGF0YS5hbGxvd1NtcyA9IHZtLmFsbG93U21zO1xyXG4gICAgICAgICAgICB2bS5yZWdpc3RlckRhdGEuZGl2aXNpb25TdXBwb3J0c0ZlZWQgPSBkaXZpc2lvblN1cHBvcnRzRmVlZDtcclxuICAgICAgICAgICAgdm0ucmVnaXN0ZXJEYXRhLmNsaWVudFBhc3NlbmdlcklkID0gdm0uY2xpZW50UGFzc2VuZ2VySWQ7XHJcbiAgICAgICAgICAgIHZtLnJlZ2lzdGVyRGF0YS5maXJzdE5hbWUgPSB2bS5maXJzdE5hbWU7XHJcbiAgICAgICAgICAgIHZtLnJlZ2lzdGVyRGF0YS5sYXN0TmFtZSA9IHZtLmxhc3ROYW1lO1xyXG5cclxuICAgICAgICAgICAgYXV0aFNlcnZpY2UucmVnaXN0ZXJFeHRlcm5hbCh2bS5yZWdpc3RlckRhdGEpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5zYXZlZFN1Y2Nlc3NmdWxseSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBzdGFydFRpbWVyKCk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgdm0ubWVzc2FnZSA9IGVycm9yLk1lc3NhZ2U7XHJcbiAgICAgICAgICAgICAgICB2bS5pc0NsaWNrZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHZjUmVjYXB0Y2hhU2VydmljZS5yZWxvYWQod2lkZ2V0SWQpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG5cclxuXHJcbiAgICAgICAgdmFyIHN0YXJ0VGltZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciB0aW1lciA9ICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICR0aW1lb3V0LmNhbmNlbCh0aW1lcik7XHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2xvZ2dlZEluJywgbnVsbCk7XHJcbiAgICAgICAgICAgICAgICBSZWRpcmVjdGlvblNlcnZpY2UucmVkaXJlY3QoKTtcclxuICAgICAgICAgICAgfSwgMjAwMCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBTdGFydCBvZiBjb2RlIGZvciBJb25pY1xyXG4gICAgICAgIHZtLmlvbmljSW5jbHVkZSA9ICdhcHAvc2hhcmVkL3JlZ2lzdHJhdGlvbi9leHRlcm5hbC1yZWdpc3RyYXRpb24uaHRtbCc7XHJcbiAgICAgICAgLy9UT0RPIEtldmluLiBQbGVhc2UgYWRkIGNvcnJlY3QgY3VzdG9tIGNsYXNzIG5hbWUuXHJcbiAgICAgICAgdm0uaW9uaWNDdXN0b21DbGFzc05hbWUgPSAnaW9uaWMtdGVtcGxhdGUtZXh0ZXJuYWwtcmVnaXN0cmF0aW9uJztcclxuICAgICAgICB2bS5pb25pY0hpZGVOYXZCYXIgPSBmYWxzZTtcclxuICAgICAgICB2bS5pb25pY1VzZVJlZnJlc2hlciA9IGZhbHNlO1xyXG4gICAgICAgIHZtLnNob3dSZWNhcHRjaGEgPSAhZW52LmlzSW9uaWM7XHJcbiAgICAgICAgLy8gRW5kIG9mIGNvZGUgZm9yIElvbmljXHJcbiAgICB9XHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignT25lTVZSZWdpc3RyYXRpb25Db250cm9sbGVyJywgT25lTVZSZWdpc3RyYXRpb25Db250cm9sbGVyKTtcclxuXHJcbiAgICBPbmVNVlJlZ2lzdHJhdGlvbkNvbnRyb2xsZXIuJGluamVjdCA9IFsnJGxvY2F0aW9uJywgJyRzY29wZScsICckcm9vdFNjb3BlJyxcclxuICAgICAgICAnYXV0aFNlcnZpY2UnLCAnZW52JywgJ01lc3NhZ2VTZXJ2aWNlJywgJ0RpdmlzaW9uU2VydmljZScsICdDb25maWdGYWN0b3J5JywgJ3ZjUmVjYXB0Y2hhU2VydmljZScsJ1ZlcmlmaWNhdGlvblNlcnZpY2UnLCAnUGFnZVNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBPbmVNVlJlZ2lzdHJhdGlvbkNvbnRyb2xsZXIoJGxvY2F0aW9uLCAkc2NvcGUsICRyb290U2NvcGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRoU2VydmljZSwgZW52LCBNZXNzYWdlU2VydmljZSwgRGl2aXNpb25TZXJ2aWNlLCBDb25maWdGYWN0b3J5LCB2Y1JlY2FwdGNoYVNlcnZpY2UsIFZlcmlmaWNhdGlvblNlcnZpY2UsIFBhZ2VTZXJ2aWNlKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS5jYW5jZWwgPSBjYW5jZWw7XHJcbiAgICAgICAgdm0ucmVnaXN0ZXIgPSByZWdpc3RlcjsgICAgICAgIFxyXG4gICAgICAgIHZtLmNhcHRjaGFQdWJsaWNLZXkgPSBlbnYuY2FwdGNoYVB1YmxpY0tleTtcclxuICAgICAgICB2bS5XaWRnZXRDcmVhdGUgPSB3aWRnZXRDcmVhdGU7XHJcbiAgICAgICAgdm0uc2V0Q2FwdGNoYVJlc3BvbnNlID0gc2V0Q2FwdGNoYVJlc3BvbnNlO1xyXG4gICAgICAgIHZtLm1lc3NhZ2UgPSAnJzsgICAgICAgIFxyXG4gICAgICAgIHZtLm9yZ2FuaXNhdGlvbklkTGFiZWwgPSAnJztcclxuICAgICAgICB2bS5zaG93T3JnYW5pc2F0aW9uSWQgPSBmYWxzZTtcclxuICAgICAgICB2bS5zaG93QWxsb3dTbXMgPSBmYWxzZTtcclxuICAgICAgICB2bS5zaG93Rmlyc3ROYW1lID0gZmFsc2U7XHJcbiAgICAgICAgdm0uc2hvd0xhc3ROYW1lID0gZmFsc2U7XHJcbiAgICAgICAgdm0uc2hvd0NsaWVudFRlbGVwaG9uZSA9IGZhbHNlO1xyXG4gICAgICAgIHZhciB3aWRnZXRJZCA9IC0xO1xyXG4gICAgICAgIHZhciBkaXZpc2lvbklkID0gLTE7XHJcbiAgICAgICAgdmFyIGZlZWRUeXBlID0gJyc7XHJcbiAgICAgICAgdm0uY2xpZW50UGFzc2VuZ2VySWQgPSAnJztcclxuICAgICAgICB2bS5QYWdlU2VydmljZSA9IFBhZ2VTZXJ2aWNlO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlLnNldFRpdGxlKCdOZXcgQWNjb3VudCcpO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlLnNldEhlYWRsaW5lKCdDcmVhdGUgYSBPTkVNViBMb2dpbicpO1xyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY2FuY2VsKCl7XHJcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCdkYXNoYm9hcmQvJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGZ1bmN0aW9uIHNldENhcHRjaGFSZXNwb25zZShyZXNwb25zZSl7XHJcbiAgICAgICAgICAgIGF1dGhTZXJ2aWNlLnZlcmlmeUNhcHRjaGEocmVzcG9uc2UpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgaWYoIXJlc3VsdC5zdWNjZXNzKVxyXG4gICAgICAgICAgICAgICAgICAgIHZjUmVjYXB0Y2hhU2VydmljZS5yZWxvYWQod2lkZ2V0SWQpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gd2lkZ2V0Q3JlYXRlKF93aWRnZXRJZCl7XHJcbiAgICAgICAgICAgIHdpZGdldElkID0gX3dpZGdldElkO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVnaXN0ZXIoKSB7XHJcbiAgICAgICAgICAgIHZtLm1lc3NhZ2UgPSAnJztcclxuICAgICAgICAgICAgdm0uaXNDbGlja2VkID0gdHJ1ZTtcclxuICAgICAgICAgICAgVmVyaWZpY2F0aW9uU2VydmljZVxyXG4gICAgICAgICAgICAgICAucGFzc2VuZ2VyRXhpc3RzKHZtLmNsaWVudFBhc3NlbmdlcklkKVxyXG4gICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyAhPSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgdm0ubWVzc2FnZSA9IFwiRmFpbGVkIHRvIHJlZ2lzdGVyLiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLlwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgIHZtLmlzQ2xpY2tlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICBpZiAoZmVlZFR5cGUgPT0gJ0ZlZWRPbmx5JyAmJiAhcmVzcG9uc2UuZGF0YS5yZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAvL2Nhbid0IHJlZ2lzdGVyIGFzIHBhc3NlbmdlciBub3QgZm91bmQgZm9yIGRpdmlzaW9uIHRoYXQgaXMgZmVlZCBvbmx5L1xyXG4gICAgICAgICAgICAgICAgICAgICAgIHZtLm1lc3NhZ2UgPSBcIlBhc3NlbmdlciBub3QgZm91bmQuXCJcclxuICAgICAgICAgICAgICAgICAgICAgICB2bS5pc0NsaWNrZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgcmVnaXN0ZXJVc2VyKHJlc3BvbnNlLmRhdGEucmVzdWx0KTtcclxuICAgICAgICAgICAgICAgfSk7ICAgICAgICAgICAgXHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVnaXN0ZXJVc2VyKGRpdmlzaW9uU3VwcG9ydHNGZWVkKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgbW9iaWxlTm8gPSB2bS5waG9uZU51bWJlcjtcclxuICAgICAgICAgICAgaWYgKG1vYmlsZU5vICYmIG1vYmlsZU5vICE9ICcnKVxyXG4gICAgICAgICAgICAgICAgbW9iaWxlTm8gPSBcIisxXCIgKyBtb2JpbGVObztcclxuXHJcbiAgICAgICAgICAgIHZhciByZWdpc3RyYXRpb25PYmplY3QgPSB7XHJcbiAgICAgICAgICAgICAgICBUZWxlcGhvbmVOdW1iZXI6IG1vYmlsZU5vLFxyXG4gICAgICAgICAgICAgICAgQWxsb3dTTVM6IHZtLnNlbmRTTVMsXHJcbiAgICAgICAgICAgICAgICBVc2VyTmFtZTogdm0uZW1haWwsXHJcbiAgICAgICAgICAgICAgICBQYXNzd29yZDogdm0ucGFzc3dvcmQsXHJcbiAgICAgICAgICAgICAgICBDb25maXJtUGFzc3dvcmQ6IHZtLmNvbmZpcm1QYXNzd29yZCxcclxuICAgICAgICAgICAgICAgIENsaWVudFBhc3NlbmdlcklkOiB2bS5jbGllbnRQYXNzZW5nZXJJZCxcclxuICAgICAgICAgICAgICAgIERpdmlzaW9uSWQ6IGRpdmlzaW9uSWQsXHJcbiAgICAgICAgICAgICAgICBGaXJzdE5hbWU6IHZtLmZpcnN0TmFtZSxcclxuICAgICAgICAgICAgICAgIExhc3ROYW1lOiB2bS5sYXN0TmFtZSxcclxuICAgICAgICAgICAgICAgIFByb3ZpZGVyOiAnTXZMb2dpbicsXHJcbiAgICAgICAgICAgICAgICBEaXZpc2lvblN1cHBvcnRzRmVlZDogZGl2aXNpb25TdXBwb3J0c0ZlZWRcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgYXV0aFNlcnZpY2UucmVnaXN0ZXJPbmVNVihyZWdpc3RyYXRpb25PYmplY3QpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdsb2dnZWRJbicsIG51bGwpO1xyXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJ2Rhc2hib2FyZC8nKTsgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgdm0ubWVzc2FnZSA9IGVycm9yLk1lc3NhZ2U7XHJcbiAgICAgICAgICAgICAgICB2bS5pc0NsaWNrZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGlmICh3aWRnZXRJZCAhPSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZjUmVjYXB0Y2hhU2VydmljZS5yZWxvYWQod2lkZ2V0SWQpO1xyXG4gICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcclxuXHJcbiAgICAgICAgICAgIGRpdmlzaW9uSWQgPSBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbkluZm8oKVxyXG4gICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgIGZlZWRUeXBlID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQuRGl2aXNpb25GZWVkVHlwZS5GZWVkVHlwZTtcclxuICAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICAgICAgQ29uZmlnRmFjdG9yeS5nZXREaXZpc2lvblBhcmFtZXRlcnMoZGl2aXNpb25JZCkudGhlbihmdW5jdGlvbiAocGFyYW1zKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5vcmdhbmlzYXRpb25JZExhYmVsID0gcGFyYW1zLk9yZ2FuaXNhdGlvbklkTGFiZWwgPyBwYXJhbXMuT3JnYW5pc2F0aW9uSWRMYWJlbCA6ICdQYXNzZW5nZXIgSWQnO1xyXG4gICAgICAgICAgICAgICAgdm0uc2hvd09yZ2FuaXNhdGlvbklkID0gcGFyYW1zLlNob3dPcmdhbmlzYXRpb25JZCA/IGV2YWwocGFyYW1zLlNob3dPcmdhbmlzYXRpb25JZC50b0xvd2VyQ2FzZSgpKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdm0uc2hvd0FsbG93U21zID0gcGFyYW1zLlNob3dBbGxvd1NtcyA/IGV2YWwocGFyYW1zLlNob3dBbGxvd1Ntcy50b0xvd2VyQ2FzZSgpKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdm0uc2hvd0ZpcnN0TmFtZSA9IHBhcmFtcy5TaG93Rmlyc3ROYW1lID8gZXZhbChwYXJhbXMuU2hvd0ZpcnN0TmFtZS50b0xvd2VyQ2FzZSgpKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdm0uc2hvd0xhc3ROYW1lID0gcGFyYW1zLlNob3dMYXN0TmFtZSA/IGV2YWwocGFyYW1zLlNob3dMYXN0TmFtZS50b0xvd2VyQ2FzZSgpKSA6IHRydWU7XHJcbiAgICAgICAgICAgICAgICB2bS5zaG93Q2xpZW50VGVsZXBob25lID0gcGFyYW1zLlNob3dDbGllbnRUZWxlcGhvbmUgPyBldmFsKHBhcmFtcy5TaG93Q2xpZW50VGVsZXBob25lLnRvTG93ZXJDYXNlKCkpIDogZmFsc2U7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgdm0uZGl2aXNpb25IYXNGZWVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgYWN0aXZhdGUoKTtcclxuXHJcbiAgICAgICAgLy8gU3RhcnQgb2YgY29kZSBmb3IgSW9uaWNcclxuICAgICAgICB2bS5pb25pY0luY2x1ZGUgPSAnYXBwL3NoYXJlZC9yZWdpc3RyYXRpb24vb25lbXYtcmVnaXN0cmF0aW9uLmh0bWwnO1xyXG4gICAgICAgIHZtLmlvbmljQ3VzdG9tQ2xhc3NOYW1lID0gJyc7XHJcbiAgICAgICAgdm0uaW9uaWNIaWRlTmF2QmFyID0gZmFsc2U7XHJcbiAgICAgICAgdm0uaW9uaWNVc2VSZWZyZXNoZXIgPSBmYWxzZTtcclxuICAgICAgICB2bS5zaG93UmVjYXB0Y2hhID0gIWVudi5pc0lvbmljO1xyXG4gICAgICAgIC8vIEVuZCBvZiBjb2RlIGZvciBJb25pY1xyXG5cclxuXHJcbiAgICB9XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdWZXJpZmljYXRpb25Db250cm9sbGVyJywgVmVyaWZpY2F0aW9uQ29udHJvbGxlcik7XHJcblxyXG4gICAgVmVyaWZpY2F0aW9uQ29udHJvbGxlci4kaW5qZWN0ID0gWyckdGltZW91dCcsICckcm9vdFNjb3BlJywnYXV0aFNlcnZpY2UnLCAnVmVyaWZpY2F0aW9uU2VydmljZScsICdEaXZpc2lvblNlcnZpY2UnLCAnUmVkaXJlY3Rpb25TZXJ2aWNlJywgJ1BhZ2VTZXJ2aWNlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gVmVyaWZpY2F0aW9uQ29udHJvbGxlcigkdGltZW91dCwgJHJvb3RTY29wZSwgYXV0aFNlcnZpY2UsIFZlcmlmaWNhdGlvblNlcnZpY2UsICBEaXZpc2lvblNlcnZpY2UsIFJlZGlyZWN0aW9uU2VydmljZSwgUGFnZVNlcnZpY2UpIHtcclxuXHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuXHJcbiAgICAgICAgdm0uaXNDbGlja2VkID0gZmFsc2U7XHJcbiAgICAgICAgdm0uc2F2ZWRTdWNjZXNzZnVsbHkgPSBmYWxzZTtcclxuICAgICAgICB2bS5tZXNzYWdlID0gJyc7XHJcbiAgICAgICAgdm0uY29kZSA9ICcnO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlID0gUGFnZVNlcnZpY2U7XHJcbiAgICAgICAgdm0uUGFnZVNlcnZpY2Uuc2V0VGl0bGUoJ1ZlcmlmaWNhdGlvbicpO1xyXG5cclxuICAgICAgICB2YXIgYWN0aXZhdGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZtLnJlZ2lzdGVyRGF0YSA9IHtcclxuICAgICAgICAgICAgICAgIHVzZXJOYW1lOiBhdXRoU2VydmljZS5leHRlcm5hbEF1dGhEYXRhLnVzZXJOYW1lLFxyXG4gICAgICAgICAgICAgICAgcHJvdmlkZXI6IGF1dGhTZXJ2aWNlLmV4dGVybmFsQXV0aERhdGEucHJvdmlkZXIsXHJcbiAgICAgICAgICAgICAgICBleHRlcm5hbEFjY2Vzc1Rva2VuOiBhdXRoU2VydmljZS5leHRlcm5hbEF1dGhEYXRhLmV4dGVybmFsQWNjZXNzVG9rZW4sXHJcbiAgICAgICAgICAgICAgICBkaXZpc2lvbklkOiBEaXZpc2lvblNlcnZpY2UuZ2V0RGl2aXNpb25JZCgpLFxyXG4gICAgICAgICAgICAgICAgZGl2aXNpb25TdXBwb3J0c0ZlZWQ6IGZhbHNlXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHZtLlBhZ2VTZXJ2aWNlLnNldEhlYWRsaW5lKCdWZXJpZnkgeW91ciAnICsgYXV0aFNlcnZpY2UuZXh0ZXJuYWxBdXRoRGF0YS5wcm92aWRlciArJyBhY2NvdW50Jyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgYWN0aXZhdGUoKTtcclxuXHJcbiAgICAgICAgdm0uY2FuY2VsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBSZWRpcmVjdGlvblNlcnZpY2UucmVkaXJlY3RUbygnZGFzaGJvYXJkLycpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdm0ucmVnaXN0ZXJFeHRlcm5hbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdm0ubWVzc2FnZSA9ICcnO1xyXG4gICAgICAgICAgICB2bS5pc0NsaWNrZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBpZiAodm0uY29kZS50cmltKCkgIT09ICcnKVxyXG4gICAgICAgICAgICAgICAgdmFsaWRhdGUoKTtcclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2bS5tZXNzYWdlID0gJ1ZhbGlkYXRpb24gY29kZSBtaXNzaW5nLic7XHJcbiAgICAgICAgICAgICAgICB2bS5pc0NsaWNrZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG5cclxuXHJcbiAgICAgICAgdmFyIHZhbGlkYXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBWZXJpZmljYXRpb25TZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICAudmFsaWRhdGUodm0uY29kZS50cmltKCkpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcy5kYXRhLnN0YXR1cyA9PSAxKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWdpc3RlcigpO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5tZXNzYWdlID0gXCJJbnZhbGlkIGNvZGUuXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmlzQ2xpY2tlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLm1lc3NhZ2UgPSByZXNwb25zZS5kYXRhLk1lc3NhZ2U7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uaXNDbGlja2VkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHJlZ2lzdGVyKCkgeyAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGF1dGhTZXJ2aWNlLnJlZ2lzdGVyRXh0ZXJuYWwodm0ucmVnaXN0ZXJEYXRhKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgdm0uc2F2ZWRTdWNjZXNzZnVsbHkgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgc3RhcnRUaW1lcigpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHZtLm1lc3NhZ2UgPSBcIkFuIGVycm9yIG9jY3VyZWQuIFBsZWFzZSB0cnkgYWdhaW4gbGF0ZXIuXCJcclxuICAgICAgICAgICAgICAgIHZtLmlzQ2xpY2tlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG5cclxuXHJcbiAgICAgICAgdmFyIHN0YXJ0VGltZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciB0aW1lciA9ICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICR0aW1lb3V0LmNhbmNlbCh0aW1lcik7XHJcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2xvZ2dlZEluJywgbnVsbCk7XHJcbiAgICAgICAgICAgICAgICBSZWRpcmVjdGlvblNlcnZpY2UucmVkaXJlY3QoKTtcclxuICAgICAgICAgICAgfSwgMjAwMCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBTdGFydCBvZiBjb2RlIGZvciBJb25pY1xyXG4gICAgICAgIHZtLmlvbmljSW5jbHVkZSA9ICdhcHAvc2hhcmVkL3ZlcmlmaWNhdGlvbi92ZXJpZmljYXRpb24uaHRtbCc7XHJcbiAgICAgICAgdm0uaW9uaWNDdXN0b21DbGFzc05hbWUgPSAnaW9uaWMtdGVtcGxhdGUtdmVyaWZpY2F0aW9uJztcclxuICAgICAgICB2bS5pb25pY0hpZGVOYXZCYXIgPSBmYWxzZTtcclxuICAgICAgICB2bS5pb25pY1VzZVJlZnJlc2hlciA9IGZhbHNlO1xyXG4gICAgICAgIC8vIEVuZCBvZiBjb2RlIGZvciBJb25pY1xyXG4gICAgfVxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmZhY3RvcnkoJ1ZlcmlmaWNhdGlvblNlcnZpY2UnLCBWZXJpZmljYXRpb25TZXJ2aWNlKTtcclxuXHJcbiAgICBWZXJpZmljYXRpb25TZXJ2aWNlLiRpbmplY3QgPSBbJyRodHRwJywnJHEnLCdlbnYnLCdEaXZpc2lvblNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBWZXJpZmljYXRpb25TZXJ2aWNlKCRodHRwLCAkcSwgZW52LCBEaXZpc2lvblNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgdmFsaWRhdGU6IHZhbGlkYXRlLFxyXG4gICAgICAgICAgICBwYXNzZW5nZXJFeGlzdHM6IHBhc3NlbmdlckV4aXN0c1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiB2YWxpZGF0ZShrZXkpIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgLy9nZXQgdGhlIGJhc2UgdXJsIGZyb20gY29uZmlnLlxyXG4gICAgICAgICAgICB2YXIgc2VydmljZVVybCA9IGVudi5vbmVNVkFwaVVybCAgKyAnZGl2aXNpb24vJyArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICcvVmFsaWRhdGU/a2V5PScgKyBrZXk7XHJcbiAgICAgICAgICAgICRodHRwLmdldChzZXJ2aWNlVXJsKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcGFzc2VuZ2VyRXhpc3RzKGNsaWVudFBhc3NlbmdlcklkKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgIHZhciBzZXJ2aWNlVXJsID0gZW52Lm9uZU1WQXBpT3JnVXJsICsgJ3Bhc3Nlbmdlci9leGlzdHMvJyArIERpdmlzaW9uU2VydmljZS5nZXREaXZpc2lvbklkKCkgKyAnLycgKyBjbGllbnRQYXNzZW5nZXJJZDtcclxuICAgICAgICAgICAgJGh0dHAuZ2V0KHNlcnZpY2VVcmwpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignV2hhdHNOZXdDb250cm9sbGVyJywgV2hhdHNOZXdDb250cm9sbGVyKTtcclxuXHJcbiAgICBXaGF0c05ld0NvbnRyb2xsZXIuJGluamVjdCA9IFsnJHJvb3RTY29wZScsJyRsb2NhdGlvbicsICdEeW5hbWljQ29udGVudFNlcnZpY2UnLCAnUGFnZVNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBXaGF0c05ld0NvbnRyb2xsZXIoJHJvb3RTY29wZSwgJGxvY2F0aW9uLCBEeW5hbWljQ29udGVudFNlcnZpY2UsIFBhZ2VTZXJ2aWNlKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS5QYWdlU2VydmljZSA9IFBhZ2VTZXJ2aWNlO1xyXG4gICAgICAgIHZtLlBhZ2VTZXJ2aWNlLnNldFRpdGxlKCdXaGF0cyBOZXcnKTtcclxuICAgICAgICB2bS5QYWdlU2VydmljZS5zZXRIZWFkbGluZSgnTGF0ZXN0IFNlcnZpY2UgVXBkYXRlcycpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXREYXRhKCkge1xyXG4gICAgICAgICAgICBEeW5hbWljQ29udGVudFNlcnZpY2UuZ2V0V2hhdHNOZXdEYXRhKCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIHZtLmRhdGEgPSByZXNwb25zZS5kYXRhLnJlc3VsdDsgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZ2V0RGF0YSgpO1xyXG5cclxuICAgICAgICAvLyBTdGFydCBvZiBjb2RlIGZvciBJb25pY1xyXG4gICAgICAgIHZtLmlvbmljSW5jbHVkZSA9ICdhcHAvc2hhcmVkL3doYXRzLW5ldy93aGF0cy1uZXcuaHRtbCc7XHJcbiAgICAgICAgdm0uaW9uaWNDdXN0b21DbGFzc05hbWUgPSAnaW9uaWMtd2hhdHMtbmV3IGNhcmQnO1xyXG4gICAgICAgIHZtLmlvbmljSGlkZU5hdkJhciA9IGZhbHNlO1xyXG4gICAgICAgIHZtLmlvbmljVXNlUmVmcmVzaGVyID0gdHJ1ZTtcclxuICAgICAgICB2bS5pb25pY1B1bGxpbmdUZXh0ID0gJ1JlZnJlc2gnO1xyXG4gICAgICAgIHZtLmlvbmljUmVmcmVzaGluZ1RleHQgPSAnTG9hZGluZyc7XHJcbiAgICAgICAgdm0uaW9uaWNTcGlubmVyID0gJ3NwaXJhbCc7IC8vIG5vbmUgdG8gZGlzYWJsZS5cclxuICAgICAgICB2bS5yZWZyZXNoID0gZnVuY3Rpb24gKHJlZnJlc2hlcikge1xyXG4gICAgICAgICAgICBnZXREYXRhKCk7XHJcbiAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnc2Nyb2xsLnJlZnJlc2hDb21wbGV0ZScpO1xyXG5cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gRW5kIG9mIGNvZGUgZm9yIElvbmljXHJcbiAgICB9XHJcbn0pKCk7XHJcbiIsIihcclxuICAgIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgICAgIGFuZ3VsYXIubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0NvbW11dGVyVHJpcE1vZGFsQ29udHJvbGxlcicsIENvbW11dGVyVHJpcE1vZGFsQ29udHJvbGxlcik7XHJcblxyXG4gICAgICAgIENvbW11dGVyVHJpcE1vZGFsQ29udHJvbGxlci4kaW5qZWN0ID0gWyckdWliTW9kYWxJbnN0YW5jZScsICckdWliTW9kYWwnLCAnJHJvb3RTY29wZScsICd0cmlwSWQnLCAnYXV0aFNlcnZpY2UnLFxyXG4gICAgICAgICAgICAnTWFwU2VydmljZScsICdSZXNlcnZhdGlvblNlcnZpY2UnLCAnTWFwSWNvblNlcnZpY2UnLCAndmVoaWNsZVNlcnZpY2UnXTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gQ29tbXV0ZXJUcmlwTW9kYWxDb250cm9sbGVyKCR1aWJNb2RhbEluc3RhbmNlLCAkdWliTW9kYWwsICRyb290U2NvcGUsIHRyaXBJZCwgYXV0aFNlcnZpY2UsXHJcbiAgICAgICAgICAgICBNYXBTZXJ2aWNlLCBSZXNlcnZhdGlvblNlcnZpY2UsIE1hcEljb25TZXJ2aWNlLCB2ZWhpY2xlU2VydmljZSkge1xyXG5cclxuICAgICAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICAgICAgdmFyIHBhc3NlbmdlcklkID0gYXV0aFNlcnZpY2UuYXV0aGVudGljYXRpb24ucGFzc2VuZ2VySWQ7XHJcbiAgICAgICAgICAgIHZhciBpc01vZGlmaWVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZhciBtYXJrZXJFdmVudHMgPSBbeyBldmVudDogJ2NsaWNrJywgY2FsbGJhY2s6IGljb25DbGlja0hhbmRsZXIgfV07XHJcbiAgICAgICAgICAgIHZhciBub1ZlaGljbGUgPSB7IGlkOiBudWxsLCBsaWNlbmNlcGxhdGU6ICctLScgfTtcclxuXHJcbiAgICAgICAgICAgIHZtLnNob3cgPSBmYWxzZTtcclxuICAgICAgICAgICAgdm0ucmVzZXJ2YXRpb25JbmZvID0ge307XHJcbiAgICAgICAgICAgIHZtLmRldGFpbHMgPSB0cnVlO1xyXG4gICAgICAgICAgICB2bS5tYXJrZXJzID0gW107XHJcbiAgICAgICAgICAgIHZtLmNhbmNlbCA9IGNhbmNlbENvbW11dGVyVHJpcDtcclxuICAgICAgICAgICAgdm0ubW9kaWZ5UmVzZXJ2YXRpb24gPSBtb2RpZnlSZXNlcnZhdGlvbjsgICAgICAgICAgICBcclxuICAgICAgICAgICAgdm0uY2xvc2UgPSBjbG9zZTtcclxuICAgICAgICAgICAgdm0ubG9hZGluZyA9IHRydWU7XHJcbiAgICAgICAgICAgIHZtLnBhc3NlbmdlclZlaGljbGVzID0gW107XHJcbiAgICAgICAgICAgIHZhciBleGlzdGluZ1ZlaGljbGVJZCA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgdm0udmVoaWNsZUZvclJlc2VydmF0aW9uID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICB2bS5pc1dhaXRsaXN0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICB2bS5zZWxlY3RlZFJhdGluZyA9IDA7XHJcbiAgICAgICAgICAgIHZtLmNhblJhdGVUcmlwID0gY2FuUmF0ZVRyaXA7XHJcbiAgICAgICAgICAgIHZtLnNob3dSYXRpbmdNb2RhbCA9IHNob3dSYXRpbmdNb2RhbDtcclxuXHJcblxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gc2hvd1JhdGluZ01vZGFsKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFjYW5SYXRlVHJpcCgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL21vZHVsZXMvY29tbXV0ZXIvbW9kYWxzL2ZlZWRiYWNrLW1vZGFsL2NvbW11dGVyLWZlZWRiYWNrLW1vZGFsLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDb21tdXRlckZlZWRiYWNrTW9kYWxDb250cm9sbGVyIGFzIHZtJyxcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZlZWRiYWNrSW5mbzogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNlcnZhdGlvbklkOiB2bS5yZXNlcnZhdGlvbkluZm8uaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmF0aW5nOiB2bS5zZWxlY3RlZFJhdGluZyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21tZW50OiAnJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFhbmd1bGFyLmlzVW5kZWZpbmVkKHJlc3VsdCkgJiYgcmVzdWx0LmlzU2F2ZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2V0UmVzZXJ2YXRpb24odm0ucmVzZXJ2YXRpb25JbmZvLmlkKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGRpc21pc3NcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBpbml0aWFsaXplTWFwKCkge1xyXG4gICAgICAgICAgICAgICAgdm0ubWFwID0gTWFwU2VydmljZS5pbml0aWFsaXplTWFwKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xyXG4gICAgICAgICAgICAgICAgZ2V0UmVzZXJ2YXRpb24odHJpcElkKTtcclxuICAgICAgICAgICAgICAgIGluaXRpYWxpemVNYXAoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gc2V0TWFwRGF0YSgpIHtcclxuICAgICAgICAgICAgICAgIGJ1aWxkUXJDb2RlKCk7XHJcbiAgICAgICAgICAgICAgICBzZXRNYXJrZXJzKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXRSZXNlcnZhdGlvbihyZXNlcnZhdGlvbklkKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgUmVzZXJ2YXRpb25TZXJ2aWNlLmdldFJlc2VydmF0aW9uQnlJZChwYXNzZW5nZXJJZCwgcmVzZXJ2YXRpb25JZClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5yZXNlcnZhdGlvbkluZm8gPSByZXNwb25zZS5kYXRhLnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0V2FpdGxpc3RlZFN0YXR1cygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBleGlzdGluZ1ZlaGljbGVJZCA9IHZtLnJlc2VydmF0aW9uSW5mby52ZWhpY2xlSWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkUmF0aW5nID0gdm0ucmVzZXJ2YXRpb25JbmZvLmZlZWRiYWNrUmF0aW5nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBnZXRQYXNzZW5nZXJWZWhpY2xlcygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRNYXBEYXRhKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhblJhdGVUcmlwKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBjYW5SYXRlVHJpcCgpIHsgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdm0ucmVzZXJ2YXRpb25JbmZvLmZlZWRiYWNrUmF0aW5nID09IG51bGwgfHwgdm0ucmVzZXJ2YXRpb25JbmZvLmZlZWRiYWNrUmF0aW5nID09IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gc2V0V2FpdGxpc3RlZFN0YXR1cygpIHtcclxuICAgICAgICAgICAgICAgIHZtLmlzV2FpdGxpc3RlZCA9IHZtLnJlc2VydmF0aW9uSW5mby5zdGF0dXMgPT0gJ1dhaXRsaXN0ZWQnO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXRQYXNzZW5nZXJWZWhpY2xlcygpIHtcclxuICAgICAgICAgICAgICAgIHZlaGljbGVTZXJ2aWNlLmdldFZlaGljbGVzRm9yUGFzc2VuZ2VyKHBhc3NlbmdlcklkKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09PSAxICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0LnBhc3NlbmdlclZlaGljbGVzICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnBhc3NlbmdlclZlaGljbGVzID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQucGFzc2VuZ2VyVmVoaWNsZXM7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2bS5wYXNzZW5nZXJWZWhpY2xlcy5sZW5ndGggPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5wYXNzZW5nZXJWZWhpY2xlcy5zcGxpY2UoMCwgMCwgbm9WZWhpY2xlKTtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnBhc3NlbmdlclZlaGljbGVzLnB1c2gobm9WZWhpY2xlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2bS5wYXNzZW5nZXJWZWhpY2xlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodm0ucGFzc2VuZ2VyVmVoaWNsZXNbaV0uaWQgPT0gZXhpc3RpbmdWZWhpY2xlSWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnZlaGljbGVGb3JSZXNlcnZhdGlvbiA9IHZtLnBhc3NlbmdlclZlaGljbGVzO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGJ1aWxkUXJDb2RlKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RpY2tldFFSY29kZScpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBscXJjb2RlID0gbmV3IFFSQ29kZShlbCwge1xyXG4gICAgICAgICAgICAgICAgICAgIHdpZHRoOiAxMDAsXHJcbiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAxMDAsXHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogdm0ucmVzZXJ2YXRpb25JbmZvLmVuY3J5cHRlZElkLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvcnJlY3RMZXZlbDogMSxcclxuICAgICAgICAgICAgICAgICAgICB1c2VTVkc6IHRydWVcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgYWN0aXZhdGUoKTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGNhbmNlbENvbW11dGVyVHJpcCgpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXNlcnZhdGlvbiA9XHJcbiAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgIHJlc2VydmF0aW9uSWQ6IHZtLnJlc2VydmF0aW9uSW5mby5pZCxcclxuICAgICAgICAgICAgICAgICAgIHJvdXRlTmFtZTogdm0ucmVzZXJ2YXRpb25JbmZvLnJvdXRlTmFtZSxcclxuICAgICAgICAgICAgICAgICAgIHBhc3NlbmdlcklkOiBwYXNzZW5nZXJJZCxcclxuICAgICAgICAgICAgICAgICAgIHN0YXJ0VGltZTogdm0ucmVzZXJ2YXRpb25JbmZvLnBpY2t1cFRpbWUsXHJcbiAgICAgICAgICAgICAgICAgICByZXNlcnZhdGlvbkRhdGU6IHZtLnJlc2VydmF0aW9uSW5mby5yZXNlcnZhdGlvbkRhdGVcclxuICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgbW9kYWxDYW5jZWxSZXNlcnZhdGlvbiA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9tb2R1bGVzL2NvbW11dGVyL21vZGFscy9jYW5jZWwtcmVzZXJ2YXRpb24tbW9kYWwvY2FuY2VsLXJlc2VydmF0aW9uLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDYW5jZWxSZXNlcnZhdGlvbkNvbnRyb2xsZXIgYXMgdm0nLFxyXG4gICAgICAgICAgICAgICAgICAgIHNpemU6ICctZnMnLFxyXG4gICAgICAgICAgICAgICAgICAgIGJhY2tkcm9wOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIGFyaWFMYWJlbGxlZEJ5OiAnQ2FuY2VsIHJlc2VydmF0aW9uJyxcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc2VydmF0aW9uSW5mbzogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc2VydmF0aW9uO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBtb2RhbENhbmNlbFJlc2VydmF0aW9uLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmlzQ2FuY2VsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgncmVzZXJ2YXRpb25DaGFuZ2VkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjYW5jZWxsZWQnOiB0cnVlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBtb2RpZnlSZXNlcnZhdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHZhciBtb2RpZnlSZXNlcnZhdGlvbk1vZGFsID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL21vZHVsZXMvY29tbXV0ZXIvbW9kYWxzL21vZGlmeS1yZXNlcnZhdGlvbi1tb2RhbC9tb2RpZnktcmVzZXJ2YXRpb24tcGlja3VwLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdNb2RpZnlSZXNlcnZhdGlvblBpY2t1cCBhcyB2bScsXHJcbiAgICAgICAgICAgICAgICAgICAgYXJpYUxhYmVsbGVkQnk6ICdNb2RpZnkgcmVzZXJ2YXRpb24gdGltZScsXHJcbiAgICAgICAgICAgICAgICAgICAgYmFja2Ryb3A6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIHNpemU6ICctZnMnLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzZXJ2YXRpb246IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2bS5yZXNlcnZhdGlvbkluZm87XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBtb2RpZnlSZXNlcnZhdGlvbk1vZGFsLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5yZWZyZXNoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzTW9kaWZpZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBnZXRSZXNlcnZhdGlvbihyZXNwb25zZS5yZXNlcnZhdGlvbklkKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBpY29uQ2xpY2tIYW5kbGVyKG1vZGVsKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5zaG93ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHZtLmNvb3JkcyA9IG1vZGVsLmNvb3JkcztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gc2V0TWFya2VycygpIHtcclxuICAgICAgICAgICAgICAgIHZtLnNob3cgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHBvcHVsYXRlTWFya2VycygpO1xyXG4gICAgICAgICAgICAgICAgTWFwU2VydmljZS5zZXRNYXBCb3VuZHModm0ubWFya2VycywgbWFya2VyRXZlbnRzKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHBvcHVsYXRlTWFya2VycygpIHtcclxuICAgICAgICAgICAgICAgIHZtLm1hcmtlcnMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgbGF0aXR1ZGU6IHZtLnJlc2VydmF0aW9uSW5mby5waWNrdXBMYXRpdHVkZSxcclxuICAgICAgICAgICAgICAgICAgICBsb25naXR1ZGU6IHZtLnJlc2VydmF0aW9uSW5mby5waWNrdXBMb25naXR1ZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogZ2V0TWFwSWNvbigncGlja3VwJywgdm0ucmVzZXJ2YXRpb25JbmZvLnNjaGVkdWxlVHlwZSksXHJcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogdm0ucmVzZXJ2YXRpb25JbmZvLnBpY2t1cFN0b3BOYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgIGFkZHJlc3M6IHZtLnJlc2VydmF0aW9uSW5mby5waWNrdXBBZGRyZXNzXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICB2bS5tYXJrZXJzLnB1c2goXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsYXRpdHVkZTogdm0ucmVzZXJ2YXRpb25JbmZvLmRyb3BvZmZMYXRpdHVkZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9uZ2l0dWRlOiB2bS5yZXNlcnZhdGlvbkluZm8uZHJvcG9mZkxvbmdpdHVkZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWNvbjogZ2V0TWFwSWNvbignZHJvcG9mZicsIHZtLnJlc2VydmF0aW9uSW5mby5zY2hlZHVsZVR5cGUpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiB2bS5yZXNlcnZhdGlvbkluZm8uZHJvcG9mZlN0b3BOYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhZGRyZXNzOiB2bS5yZXNlcnZhdGlvbkluZm8uZHJvcG9mZkFkZHJlc3NcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gY2xvc2UoKSB7XHJcbiAgICAgICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgJ2lzTW9kaWZpZWQnOiBpc01vZGlmaWVkXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gZ2V0TWFwSWNvbihzdG9wdHlwZSwgc2NoZWR1bGUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzdG9wdHlwZSA9PT0gJ3BpY2t1cCcpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NoZWR1bGUgPT09ICdBTScpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBNYXBJY29uU2VydmljZS5nZXRDb21tdXRlclN0b3BJY29uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gTWFwSWNvblNlcnZpY2UuZ2V0Q29tbXV0ZXJIdWJJY29uKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NoZWR1bGUgPT09ICdQTScpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBNYXBJY29uU2VydmljZS5nZXRDb21tdXRlclN0b3BJY29uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gTWFwSWNvblNlcnZpY2UuZ2V0Q29tbXV0ZXJIdWJJY29uKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH1cclxuICAgIH0pKCk7IiwiIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAuY29udHJvbGxlcignVHJpcERldGFpbHNNb2RhbENvbnRyb2xsZXInLCBUcmlwRGV0YWlsc01vZGFsQ29udHJvbGxlcik7XHJcblxyXG4gICAgVHJpcERldGFpbHNNb2RhbENvbnRyb2xsZXIuJGluamVjdCA9IFsnJHVpYk1vZGFsSW5zdGFuY2UnLCAnJHRpbWVvdXQnLCAndHJpcE1vZGFsUmVxdWVzdCcsICd1aUdtYXBJc1JlYWR5JywgJ01hcFNlcnZpY2UnLCAnTWFwSWNvblNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBUcmlwRGV0YWlsc01vZGFsQ29udHJvbGxlcigkdWliTW9kYWxJbnN0YW5jZSwgJHRpbWVvdXQsIHRyaXBNb2RhbFJlcXVlc3QsIHVpR21hcElzUmVhZHksIE1hcFNlcnZpY2UsIE1hcEljb25TZXJ2aWNlKSB7XHJcblxyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdmFyIG1hcmtlckV2ZW50cyA9IFt7IGV2ZW50OiAnY2xpY2snLCBjYWxsYmFjazogaWNvbkNsaWNrSGFuZGxlciB9XTtcclxuXHJcblxyXG4gICAgICAgIHZtLnNob3cgPSBmYWxzZTtcclxuICAgICAgICB2bS5wYXNzZW5nZXJUcmlwID0gdHJpcE1vZGFsUmVxdWVzdC5wYXNzZW5nZXJUcmlwO1xyXG4gICAgICAgIHZtLm9wdGlvbnMgPSB0eXBlb2YgdHJpcE1vZGFsUmVxdWVzdC5vcHRpb25zID09ICdzdHJpbmcnID8gSlNPTi5wYXJzZSh0cmlwTW9kYWxSZXF1ZXN0Lm9wdGlvbnMpIDogdHJpcE1vZGFsUmVxdWVzdC5vcHRpb25zO1xyXG4gICAgICAgIHZtLnNlcnZpY2VEYXRlID0gdHJpcE1vZGFsUmVxdWVzdC5zZXJ2aWNlRGF0ZTtcclxuICAgICAgICBcclxuICAgICAgICB2bS5tYXAgPSBNYXBTZXJ2aWNlLmluaXRpYWxpemVNYXAoKTtcclxuICAgICAgIFxyXG5cclxuICAgICAgICAkdGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZtLm1hcmtlcnMgPSBbXTtcclxuICAgICAgICAgICAgdm0ubWFya2Vycy5wdXNoKHtcclxuICAgICAgICAgICAgICAgIGxhdGl0dWRlOiB2bS5wYXNzZW5nZXJUcmlwLnN0YXJ0TGF0aXR1ZGUsXHJcbiAgICAgICAgICAgICAgICBsb25naXR1ZGU6IHZtLnBhc3NlbmdlclRyaXAuc3RhcnRMb25naXR1ZGUsXHJcbiAgICAgICAgICAgICAgICBpY29uOiBNYXBJY29uU2VydmljZS5nZXREcnRQaWNrdXBJY29uKCksXHJcbiAgICAgICAgICAgICAgICBuYW1lOiB2bS5wYXNzZW5nZXJUcmlwLnN0YXJ0TmFtZSxcclxuICAgICAgICAgICAgICAgIGFkZHJlc3MgOiB2bS5wYXNzZW5nZXJUcmlwLnN0YXJ0QWRkcmVzc1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdm0ubWFya2Vycy5wdXNoKHtcclxuICAgICAgICAgICAgICAgIGxhdGl0dWRlOiB2bS5wYXNzZW5nZXJUcmlwLmVuZExhdGl0dWRlLFxyXG4gICAgICAgICAgICAgICAgbG9uZ2l0dWRlOiB2bS5wYXNzZW5nZXJUcmlwLmVuZExvbmdpdHVkZSxcclxuICAgICAgICAgICAgICAgIGljb246IE1hcEljb25TZXJ2aWNlLmdldERydERyb3BvZmZJY29uKCksXHJcbiAgICAgICAgICAgICAgICBuYW1lOiB2bS5wYXNzZW5nZXJUcmlwLmVuZE5hbWUsXHJcbiAgICAgICAgICAgICAgICBhZGRyZXNzOiB2bS5wYXNzZW5nZXJUcmlwLmVuZEFkZHJlc3NcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBNYXBTZXJ2aWNlLnNldE1hcEJvdW5kcyh2bS5tYXJrZXJzLG1hcmtlckV2ZW50cyk7XHJcbiAgICAgICAgfSwgMTAwMCk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGljb25DbGlja0hhbmRsZXIobW9kZWwpIHtcclxuICAgICAgICAgICAgdm0uc2hvdyA9IHRydWU7XHJcbiAgICAgICAgICAgIHZtLmNvb3JkcyA9IG1vZGVsLmNvb3JkcztcclxuICAgICAgICB9XHJcbiAgICAgICAgdm0uY2FuY2VsID0gZnVuY3Rpb24gY2FuY2VsVHJpcCgpIHtcclxuICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2Uoe1xyXG4gICAgICAgICAgICAgICAgJ2FjdGlvbic6ICdjYW5jZWwnXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9O1xyXG4gICAgICAgIHZtLmNsb3NlTW9kYWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKHtcclxuICAgICAgICAgICAgICAgICdhY3Rpb24nOiAnY2xvc2UnXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLmRpc3BsYXlSYXRpbmdPcHRpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2bS5wYXNzZW5nZXJUcmlwLlN0YXR1cyA9PT0gJ0VuZCcgfHxcclxuICAgICAgICAgICAgICAgICh2bS5wYXNzZW5nZXJUcmlwLlN0YXR1cyA9PT0gJ1Jlc2VydmVkJyAmJiAodm0uc2VydmljZURhdGUgPiB2bS5wYXNzZW5nZXJUcmlwLnNlcnZpY2VEYXRlKSk7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgLmNvbnRyb2xsZXIoJ1Bhc3NlbmdlclRyaXBzQ3RybCcsIFBhc3NlbmdlclRyaXBzQ3RybCk7XHJcblxyXG4gICAgUGFzc2VuZ2VyVHJpcHNDdHJsLiRpbmplY3QgPSBbJyRzdGF0ZScsICckdWliTW9kYWwnLCAnYXV0aFNlcnZpY2UnLCAnUmVzZXJ2YXRpb25TZXJ2aWNlJywgJ1BhZ2VTZXJ2aWNlJyxcclxuICAgICAnTHV1bUxpbmtlZFNlcnZpY2UnLCdPbmVNdlNlcnZpY2VzJywnQ29uZmlnRmFjdG9yeScsJ0RpdmlzaW9uU2VydmljZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIFBhc3NlbmdlclRyaXBzQ3RybCgkc3RhdGUsICR1aWJNb2RhbCwgYXV0aFNlcnZpY2UsIFJlc2VydmF0aW9uU2VydmljZSwgUGFnZVNlcnZpY2UsXHJcbiAgICAgICAgIEx1dW1MaW5rZWRTZXJ2aWNlLE9uZU12U2VydmljZXMsQ29uZmlnRmFjdG9yeSxEaXZpc2lvblNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLnBhc3RUcmlwcyA9IFtdO1xyXG4gICAgICAgIHZtLmZ1dHVyZVRyaXBzID0gW107XHJcbiAgICAgICAgdm0udG9kYXlzVHJpcHMgPSBbXTtcclxuICAgICAgICBcclxuICAgICAgICB2bS5QYWdlU2VydmljZSA9IFBhZ2VTZXJ2aWNlO1xyXG4gICAgICAgIFBhZ2VTZXJ2aWNlLnNldFRpdGxlKCdQYXNzZW5nZXIgVHJpcHMnKTtcclxuICAgICAgICBQYWdlU2VydmljZS5zZXRIZWFkbGluZSgnTXkgVHJpcHMnKTtcclxuXHJcbiAgICAgICAgdm0uYWRkcmVzc1Jlc3QgPSBudWxsO1xyXG4gICAgICAgIHZtLmNlbnRlckxhdExvbmc7XHJcbiAgICAgICAgdm0ub25UcmlwQ2FuY2VsbGVkID0gb25UcmlwQ2FuY2VsbGVkO1xyXG4gICAgICAgIHZtLnNob3dUcmlwRGV0YWlscyA9IHNob3dUcmlwRGV0YWlscztcclxuXHJcbiAgICAgICAgdmFyIG9wdGlvbnMgPSB7fTtcclxuICAgICAgICBvcHRpb25zLnJlc2VydmF0aW9uVHlwZSA9ICdjdXJyZW50JztcclxuICAgICAgICBvcHRpb25zLk9wZXJhdG9ySWQgPSAnJztcclxuICAgICAgICBvcHRpb25zLmlzUGFzc2VuZ2VyID0gdHJ1ZTtcclxuICAgICAgICBvcHRpb25zLnJlbG9hZFRyaXBzID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHZhciBkaXZpc2lvbklkID0gRGl2aXNpb25TZXJ2aWNlLmdldERpdmlzaW9uSWQoKTtcclxuICAgICAgICB2YXIgcGFzc2VuZ2VySWQgPSBhdXRoU2VydmljZS5hdXRoZW50aWNhdGlvbi5wYXNzZW5nZXJJZDtcclxuICAgICAgICB2bS5jdXJyZW50UGFzc2VuZ2VyID0geyBcIklkXCI6IHBhc3NlbmdlcklkIH07IFxyXG4gICAgICAgIFxyXG4gICAgICAgIFxyXG4gICAgICAgIGlmICghYXV0aFNlcnZpY2UuaXNMb2dnZWRJbigpKVxyXG4gICAgICAgICAgICAkc3RhdGUuZ28oJ2xvZ2luJyk7XHJcblxyXG4gICAgICAgIHZtLmNvbW11dGVySW5mbyA9IE9uZU12U2VydmljZXMuZ2V0Q29tbXV0ZXJJbmZvKCk7XHJcbiAgICAgICAgdm0uZHJ0SW5mbyA9IE9uZU12U2VydmljZXMuZ2V0RHJ0SW5mbygpOyAgICBcclxuXHJcbiAgICAgICAgdm0uaGFzQ29tbXV0ZXIgPSAhYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5jb21tdXRlckluZm8pO1xyXG4gICAgICAgIHZtLmhhc0RydCA9ICFhbmd1bGFyLmlzVW5kZWZpbmVkKHZtLmRydEluZm8pO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHZtLmxvYWRpbmcgPSB0cnVlOyAgICAgICAgXHJcbiAgICAgICAgdm0udG90YWxUcmlwc0NvdW50ID0gMDtcclxuICAgIFxyXG4gICAgICAgIGFjdGl2YXRlKCk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xyXG4gICAgICAgICAgICBMdXVtTGlua2VkU2VydmljZS52ZXJpZnkoYXV0aFNlcnZpY2UuYXV0aGVudGljYXRpb24ucGFzc2VuZ2VySWQpO1xyXG4gICAgICAgICAgICBwb3B1bGF0ZURpdmlzaW9uUGFyYW1ldGVycygpO1xyXG4gICAgICAgICAgICBnZXRVcGNvbWluZ1RyaXBzKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRVcGNvbWluZ1RyaXBzKCkge1xyXG4gICAgICAgICAgICBSZXNlcnZhdGlvblNlcnZpY2UuZ2V0QWxsUmVzZXJ2YXRpb25zRm9yUGFzc2VuZ2VyKHBhc3NlbmdlcklkKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvcHVsYXRlVHJpcHMocmVzcG9uc2UuZGF0YS5yZXN1bHQucmVzZXJ2YXRpb25zKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdm0ubG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmxvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHBvcHVsYXRlVHJpcHModHJpcHMpIHtcclxuICAgICAgICAgICAgdm0ucGFzdFRyaXBzID0gW107XHJcbiAgICAgICAgICAgIHZtLmZ1dHVyZVRyaXBzID0gW107XHJcbiAgICAgICAgICAgIHZtLnRvZGF5c1RyaXBzID0gW107XHJcbiAgICAgICAgICAgIHZtLnRvdGFsVHJpcHNDb3VudCA9IDA7XHJcblxyXG4gICAgICAgICAgICBpZiAoIXRyaXBzKSByZXR1cm47ICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICB2bS50b3RhbFRyaXBzQ291bnQgPSB0cmlwcy5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRyaXBzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdHJpcCA9IHRyaXBzW2ldOyAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB2YXIgY29tcGFyZSA9IG1vbWVudCgpLmRheU9mWWVhcigpIC0gbW9tZW50KHRyaXBzW2ldLnJlc2VydmF0aW9uRGF0ZSkuZGF5T2ZZZWFyKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGNvbXBhcmUgPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgIHZtLnBhc3RUcmlwcy5wdXNoKHRyaXApO1xyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoY29tcGFyZSA8IDApXHJcbiAgICAgICAgICAgICAgICAgICAgdm0uZnV0dXJlVHJpcHMucHVzaCh0cmlwKTtcclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICB2bS50b2RheXNUcmlwcy5wdXNoKHRyaXBzW2ldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2hvd1RyaXBEZXRhaWxzKHRyaXApIHtcclxuICAgICAgICAgICAgdmFyIGNvbW11dGVyVHJpcE1vZGFsID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvbW9kdWxlcy9zaGFyZWQvdHJpcHMvY29tbXV0ZXItdHJpcC1tb2RhbC5odG1sJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdDb21tdXRlclRyaXBNb2RhbENvbnRyb2xsZXIgYXMgdm0nLFxyXG4gICAgICAgICAgICAgICAgc2l6ZTogJy1mcycsXHJcbiAgICAgICAgICAgICAgICBiYWNrZHJvcDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBrZXlib2FyZCA6dHJ1ZSxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICB0cmlwSWQ6IHRyaXAuaWRcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBjb21tdXRlclRyaXBNb2RhbC5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5jYW5jZWxsZWQgfHwgcmVzcG9uc2UuaXNNb2RpZmllZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGdldFVwY29taW5nVHJpcHMoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSAgICAgXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHBvcHVsYXRlRGl2aXNpb25QYXJhbWV0ZXJzKCkge1xyXG4gICAgICAgICAgICBDb25maWdGYWN0b3J5LmdldERpdmlzaW9uUGFyYW1ldGVycyhkaXZpc2lvbklkKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocGFyYW1zKSB7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgb3B0aW9ucy5wcm9taXNlV2luZG93ID0gcGFyYW1zLlByb21pc2VXaW5kb3c7XHJcbiAgICAgICAgICAgICAgICBvcHRpb25zLkRpdmlzaW9uSWQgPSBkaXZpc2lvbklkO1xyXG4gICAgICAgICAgICAgICAgb3B0aW9ucy5iYXRjaERheXMgPSBwYXJhbXMuQmF0Y2hEYXlzID8gZXZhbChwYXJhbXMuQmF0Y2hEYXlzKSA6IDc7XHJcbiAgICAgICAgICAgICAgICBvcHRpb25zLm1pbkZyb21EYXlzID0gcGFyYW1zLk1pbkZyb21EYXlzID8gZXZhbChwYXJhbXMuTWluRnJvbURheXMpIDogMzA7XHJcbiAgICAgICAgICAgICAgICBvcHRpb25zLmlzQWR2YW5jZWRSZXNlcnZhdGlvbiA9IHBhcmFtcy5BbGxvd0FkdmFuY2VkUmVzZXJ2YXRpb24gPyBldmFsKHBhcmFtcy5BbGxvd0FkdmFuY2VkUmVzZXJ2YXRpb24udG9Mb3dlckNhc2UoKSkgOiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIG9wdGlvbnMuc2hvd0NhbmNlbE9wdGlvbnMgPSBwYXJhbXMuQ2FuY2VsUmVhc29uUmVxdWlyZWQgPyBldmFsKHBhcmFtcy5DYW5jZWxSZWFzb25SZXF1aXJlZC50b0xvd2VyQ2FzZSgpKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgb3B0aW9ucy5hbGxvd0ZhcmluZyA9IHBhcmFtcy5BbGxvd0ZhcmluZyA/IGV2YWwocGFyYW1zLkFsbG93RmFyaW5nLnRvTG93ZXJDYXNlKCkpIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBvcHRpb25zLmFsbG93TG9jYXRpb25Ob3RlcyA9IHBhcmFtcy5BbGxvd0xvY2F0aW9uTm90ZXMgPyBldmFsKHBhcmFtcy5BbGxvd0xvY2F0aW9uTm90ZXMpIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBvcHRpb25zLmFsbG93Q2hpbGRyZW4gPSBwYXJhbXMuQWxsb3dDaGlsZHJlbiA/IGV2YWwocGFyYW1zLkFsbG93Q2hpbGRyZW4pIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBvcHRpb25zLmFsbG93TXVsdGlwbGVTZWF0Qm9va2luZyA9IHBhcmFtcy5BbGxvd011bHRpcGxlU2VhdEJvb2tpbmcgPyBldmFsKHBhcmFtcy5BbGxvd011bHRpcGxlU2VhdEJvb2tpbmcudG9Mb3dlckNhc2UoKSkgOiBmYWxzZTtcclxuXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHZtLnVzZXJSZXNlcnZhdGlvbk9wdGlvbnMgPSBvcHRpb25zO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gb25UcmlwQ2FuY2VsbGVkKCkge31cclxuXHJcbiAgICAgICAgLy8gU3RhcnQgb2YgY29kZSBmb3IgSW9uaWNcclxuICAgICAgICB2bS5pb25pY09uVG91Y2ggPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIC8vIE5lZWQgdG8gcmVzaXplIHRoZSBzY3JlZW4gaWYgb25lIG9mIHRoZSB0cmlwIGNhcmRzIGlzIGNsaWNrZWQuXHJcbiAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnaW9uaWNTY3JvbGxSZXNpemUnLCB7IGFjdGlvbjogJ3Jlc2l6ZScgfSlcclxuICAgICAgICB9XHJcbiAgICAgICAgdm0uaW9uaWNJbmNsdWRlID0gJ2FwcC9tb2R1bGVzL29uLWRlbWFuZC90cmlwcy9teS10cmlwcy5odG1sJztcclxuICAgICAgICB2bS5pb25pY0N1c3RvbUNsYXNzTmFtZSA9ICdpb25pYy5teS10cmlwcyc7XHJcbiAgICAgICAgdm0uaW9uaWNIaWRlTmF2QmFyID0gZmFsc2U7XHJcbiAgICAgICAgdm0uaW9uaWNVc2VSZWZyZXNoZXIgPSB0cnVlO1xyXG4gICAgICAgIHZtLmlvbmljUHVsbGluZ1RleHQgPSAnUmVmcmVzaCBUcmlwcyc7XHJcbiAgICAgICAgdm0uaW9uaWNSZWZyZXNoaW5nVGV4dCA9ICdMb2FkaW5nIFRyaXBzJztcclxuICAgICAgICB2bS5pb25pY1NwaW5uZXIgPSAnc3BpcmFsJzsgLy8gbm9uZSB0byBkaXNhYmxlLlxyXG4gICAgICAgIHZtLnJlZnJlc2ggPSBmdW5jdGlvbiAocmVmcmVzaGVyKSB7XHJcbiAgICAgICAgICAgIC8vXHJcbiAgICAgICAgICAgIC8vIGNoYW5nZSB0aGlzIGZsYWcgdG8gdHJpZ2dlciB0aGUgbXktdHJpcHMgZGlyZWN0aXZlIHRvIHJlbG9hZC5cclxuICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgb3B0aW9ucy5yZWxvYWRUcmlwcyA9ICFvcHRpb25zLnJlbG9hZFRyaXBzO1xyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3Njcm9sbC5yZWZyZXNoQ29tcGxldGUnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKFwib25lTVZBcHBcIikuZGlyZWN0aXZlKCd0cmlwQ2FyZERpcmVjdGl2ZScsIHRyaXBDYXJkRGlyZWN0aXZlKTtcclxuICAgIHRyaXBDYXJkRGlyZWN0aXZlLiRpbmplY3QgPSBbJyR1aWJNb2RhbCcsICdVdGlsaXR5RmFjdG9yeSddO1xyXG4gICAgZnVuY3Rpb24gdHJpcENhcmREaXJlY3RpdmUoJHVpYk1vZGFsLCBVdGlsaXR5RmFjdG9yeSkge1xyXG4gICAgICAgIHZhciBkaXJlY3RpdmUgPSB7XHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IGNvbnRyb2xsZXIsXHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICAgICAgICAgIGxpbms6IGxpbmssXHJcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICAgICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgICAgICB0cmlwOiAnQCcsXHJcbiAgICAgICAgICAgICAgICBvcHRpb25zOiAnQCcsXHJcbiAgICAgICAgICAgICAgICB0cmlwVHlwZTogJ0AnLFxyXG4gICAgICAgICAgICAgICAgZGl2aXNpb25TZXJ2aWNlRGF0ZTogJz0nLFxyXG4gICAgICAgICAgICAgICAgYWxsb3dUcmlwUmF0aW5nOiBcIj1cIixcclxuICAgICAgICAgICAgICAgIG5vdGlmeU9uQ2FuY2VsOiBcIj1vblRyaXBDYW5jZWxcIlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9tb2R1bGVzL3NoYXJlZC90cmlwcy90cmlwQ2FyZC5odG1sJ1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgc2NvcGUuJHdhdGNoKCd0cmlwJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG5ld1ZhbHVlICE9IG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBuZXdWYWx1ZSA9PSBcInN0cmluZ1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5wYXNzZW5nZXJUcmlwID0gSlNPTi5wYXJzZShuZXdWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIG5ld1ZhbHVlID09IFwib2JqZWN0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnBhc3NlbmdlclRyaXAgPSBuZXdWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGZ1bmN0aW9uIGNvbnRyb2xsZXIoJHNjb3BlKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5wYXNzZW5nZXJUcmlwID0gSlNPTi5wYXJzZSgkc2NvcGUudHJpcCk7XHJcbiAgICAgICAgICAgICRzY29wZS5vcHRzID0gSlNPTi5wYXJzZSgkc2NvcGUub3B0aW9ucyk7XHJcbiAgICAgICAgICAgICRzY29wZS5zZXJ2aWNlRGF0ZSA9ICRzY29wZS5kaXZpc2lvblNlcnZpY2VEYXRlO1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLmRldGFpbHNNb2RhbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgdmFyIHRyaXBEZXRhaWwgPSAgJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL21vZHVsZXMvc2hhcmVkL3RyaXBzL2RydC10cmlwLW1vZGFsLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdUcmlwRGV0YWlsc01vZGFsQ29udHJvbGxlciBhcyB2bScsXHJcbiAgICAgICAgICAgICAgICAgICAgc2l6ZTogJy1mcycsXHJcbiAgICAgICAgICAgICAgICAgICAgYmFja2Ryb3A6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHJpcE1vZGFsUmVxdWVzdCA6IGZ1bmN0aW9uKClcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzZW5nZXJUcmlwOiAkc2NvcGUucGFzc2VuZ2VyVHJpcCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zOiAkc2NvcGUub3B0aW9ucyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXJ2aWNlRGF0ZTogJHNjb3BlLnNlcnZpY2VEYXRlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgdHJpcERldGFpbC5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICBpZihyZXN1bHQgJiYgcmVzdWx0LmFjdGlvbiA9PT0gJ2NhbmNlbCcpXHJcbiAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNhbmNlbCgkc2NvcGUucGFzc2VuZ2VyVHJpcCk7XHJcbiAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgIFxyXG4gICAgICAgXHJcbiAgICAgICAgICAgICRzY29wZS5nZXREaXNwbGF5U3RhdHVzID0gZnVuY3Rpb24gKHN0YXR1cykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHN0YXR1cztcclxuXHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHN0YXR1cykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ0NhbmNlbCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9ICdDYW5jZWxsZWQnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdOby1zaG93JzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gJ05vIHNob3cnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdVbi1zY2hlZHVsZWQnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSAnUmVzZXJ2ZWQnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLmNhbmNlbCA9IGZ1bmN0aW9uICh0cmlwKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdHJpcFRvQ2FuY2VsID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICd0cmlwSWQnOiB0cmlwLlRyaXBJZCxcclxuICAgICAgICAgICAgICAgICAgICAncGFzc2VuZ2VySWQnOiB0cmlwLlBhc3NlbmdlcklkLFxyXG4gICAgICAgICAgICAgICAgICAgICdmcm9tJzogdHJpcC5zdGFydE5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgJ3RvJzogdHJpcC5lbmROYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICdzY2hlZHVsZWRUaW1lJzogdHJpcC5zY2hlZFBpY2t1cFRpbWVcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIG1vZGFsQ2FuY2VsVHJpcCA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvbW9kdWxlcy9vbi1kZW1hbmQvYWN0aXZlVHJpcC90cmlwLWNhbmNlbGxhdGlvbi1wcm9tcHQuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1RyaXBDYW5jZWxsYXRpb25Db250cm9sbGVyIGFzIHZtJyxcclxuICAgICAgICAgICAgICAgICAgICBzaXplOiAnLWZzJyxcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyaXBUb0NhbmNlbDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRyaXBUb0NhbmNlbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2hvd0NhbmNlbE9wdGlvbnM6ICRzY29wZS5vcHRzLnNob3dDYW5jZWxPcHRpb25zXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgbW9kYWxDYW5jZWxUcmlwLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmlzQ2FuY2VsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0U3VjY2VzcyhcIlN1Y2Nlc3MhXCIsIFwiVHJpcCBjYW5jZWxsZWRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgKCRzY29wZS5ub3RpZnlPbkNhbmNlbCkgPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm5vdGlmeU9uQ2FuY2VsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcihcIkVycm9yIVwiLCBcIlVuYWJsZSB0byBjYW5jZWwgdGhlIHRyaXAuXCIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgIC5kaXJlY3RpdmUoJ212UGFzc2VuZ2VyVHJpcHMnLCB1c2VyUmVzZXJ2YXRpb25zRGlyZWN0aXZlKTtcclxuXHJcbiAgICB1c2VyUmVzZXJ2YXRpb25zRGlyZWN0aXZlLiRpbmplY3QgPSBbJyRmaWx0ZXInLCAnJGludGVydmFsJywgJyR1aWJNb2RhbCcsXHJcbiAgICAgICAgJ1V0aWxpdHlGYWN0b3J5JywgJ1NjaGVkdWxlU2VydmljZScsICdEaXZpc2lvblNlcnZpY2UnLCAnUGFnZVNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiB1c2VyUmVzZXJ2YXRpb25zRGlyZWN0aXZlKCAkZmlsdGVyLCAgJGludGVydmFsLCAkdWliTW9kYWwsIFxyXG4gICAgICAgIFV0aWxpdHlGYWN0b3J5LCBTY2hlZHVsZVNlcnZpY2UsICBEaXZpc2lvblNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgZGlyZWN0aXZlID0ge1xyXG4gICAgICAgICAgICBjb250cm9sbGVyOiBjb250cm9sbGVyLFxyXG4gICAgICAgICAgICBsaW5rOiBsaW5rLFxyXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgICAgICByZXBsYWNlOiBmYWxzZSxcclxuICAgICAgICAgICAgc2NvcGU6IHtcclxuICAgICAgICAgICAgICAgIHBhc3NlbmdlcjogJ0AnLFxyXG4gICAgICAgICAgICAgICAgbmV3VHJpcDogJ0AnLFxyXG4gICAgICAgICAgICAgICAgb3B0aW9uczogJ0AnLFxyXG4gICAgICAgICAgICAgICAgZGl2aXNpb25JZDogJ0AnLFxyXG4gICAgICAgICAgICAgICAgbm90aWZ5VHJpcENhbmNlbGxlZDogJz1vblRyaXBDYW5jZWxsZWQnLFxyXG4gICAgICAgICAgICAgICAgYWxsb3dUcmlwUmF0aW5nOiBcIj1cIlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9tb2R1bGVzL3NoYXJlZC90cmlwcy91c2VyUmVzZXJ2YXRpb25zLmh0bWwnXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICAgICAgICAvLyBUaGlzIGlzIGhlcmUgdG8gdHJpZ2dlciBzY29wZS5pbml0KCkgd2hlbiB0aGlzIGV2ZW50IGZpcnN0IG9jY3Vycy5cclxuICAgICAgICAgICAgLy8gSW4gdGhlIE1vYmlsZSBBcHAsICdvcHRpb25zJyBnZXRzIGxvYWRlZCBzbyBmYXN0IHRoYXQgYnkgdGhlIHRpbWVcclxuICAgICAgICAgICAgLy8gdGhlICR3YXRjaCgnb3B0aW9ucycpIG9jY3VycywgdGhlIHZhbHVlIGlzIHRoZSBzYW1lLlxyXG4gICAgICAgICAgICB2YXIgaW5pdGlhbFJ1biA9IHRydWU7IFxyXG4gICAgICAgICAgICBzY29wZS4kd2F0Y2goJ29wdGlvbnMnLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgIT0gb2xkVmFsdWUgfHwgaW5pdGlhbFJ1bikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbmV3VmFsdWUgPT0gXCJzdHJpbmdcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUub3B0cyA9IEpTT04ucGFyc2UobmV3VmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBuZXdWYWx1ZSA9PSBcIm9iamVjdFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5vcHRzID0gbmV3VmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5pdGlhbFJ1biA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmluaXQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgIFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY29udHJvbGxlcigkc2NvcGUsIE9uZU12U2VydmljZXMpIHtcclxuICAgICAgICAgICAgdmFyIGRpdmlzaW9uSWQgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIHZhciBvcGVyYXRvcklkID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICB2YXIgYmF0Y2hEYXlzID0gNzsgLy9nZXQgZnJvbSBzeXN0ZW0gcGFyYW1zXHJcbiAgICAgICAgICAgIHZhciBtaW5Gcm9tRGF5cyA9IDMwO1xyXG4gICAgICAgICAgICB2YXIgZGF0ZUZvcm1hdCA9ICdNTS1ERC1ZWVlZJztcclxuICAgICAgICAgICAgJHNjb3BlLmlzQ2FuY2VsbGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IHRydWU7XHJcbiAgICAgICAgICAgIHZhciBhdXRvUmVmcmVzaCA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgdmFyIGF1dG9SZWZyZXNoQWN0aXZlVHJpcCA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgJHNjb3BlLnNob3dUYWJzID0gZmFsc2U7XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuY29tbXV0ZXJJbmZvID0gT25lTXZTZXJ2aWNlcy5nZXRDb21tdXRlckluZm8oKTtcclxuICAgICAgICAgICAgJHNjb3BlLmRydEluZm8gPSBPbmVNdlNlcnZpY2VzLmdldERydEluZm8oKTsgICAgXHJcblxyXG4gICAgICAgICAgICAkc2NvcGUub3B0cyA9IHVuZGVmaW5lZDtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5hY3RpdmVUcmlwID0ge1xyXG4gICAgICAgICAgICAgICAgVHJpcElkOiBudWxsXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUucGFzc2VuZ2VyRnV0dXJlVHJpcHMgPSBbXTtcclxuICAgICAgICAgICAgJHNjb3BlLnBhc3NlbmdlclBhc3RUcmlwcyA9IFtdO1xyXG4gICAgICAgICAgICAkc2NvcGUucGFzc2VuZ2VyQWN0aXZlVHJpcHMgPSBbXTtcclxuXHJcbiAgICAgICAgICAgIGlmICgkc2NvcGUucGFzc2VuZ2VyICE9ICcnKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcGFzcyA9IEpTT04ucGFyc2UoJHNjb3BlLnBhc3Nlbmdlcik7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucGFzc2VuZ2VySWQgPSBwYXNzID8gcGFzcy5JZCA6IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgfSAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAkc2NvcGUuc2hvd1RhYnMgPSAhYW5ndWxhci5pc1VuZGVmaW5lZCgkc2NvcGUuY29tbXV0ZXJJbmZvKSAmJiAhYW5ndWxhci5pc1VuZGVmaW5lZCgkc2NvcGUuZHJ0SW5mbyk7ICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICRzY29wZS5nZXREaXNwbGF5U3RhdHVzID0gZnVuY3Rpb24gKHN0YXR1cykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHN0YXR1cztcclxuXHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHN0YXR1cykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ0NhbmNlbCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9ICdDYW5jZWxlZCdcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnTm8tc2hvdyc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9ICdObyBTaG93J1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLmFjdGl2YXRlID0gZnVuY3Rpb24gKHBhc3Nlbmdlcikge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnBhc3NlbmdlcklkID0gcGFzc2VuZ2VyLklkO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBnZXRTZXJ2aWNlRGF0ZUJ5RGl2aXNpb24oKTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5kaXNwbGF5UmF0aW5nT3B0aW9uID0gZnVuY3Rpb24gKHBhc3NlbmdlclRyaXApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBwYXNzZW5nZXJUcmlwLlN0YXR1cyA9PT0gJ0VuZCcgfHxcclxuICAgICAgICAgICAgICAgICAgICAocGFzc2VuZ2VyVHJpcC5TdGF0dXMgPT09ICdSZXNlcnZlZCdcclxuICAgICAgICAgICAgICAgICAgICAmJiAoJHNjb3BlLnNlcnZpY2VEYXRlID4gcGFzc2VuZ2VyVHJpcC5zZXJ2aWNlRGF0ZSkpO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLmNhbmNlbCA9IGZ1bmN0aW9uICh0cmlwKSB7XHJcbiAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB2YXIgdHJpcFRvQ2FuY2VsID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICd0cmlwSWQnOiB0cmlwLlRyaXBJZCxcclxuICAgICAgICAgICAgICAgICAgICAncGFzc2VuZ2VySWQnOiB0cmlwLlBhc3NlbmdlcklkLFxyXG4gICAgICAgICAgICAgICAgICAgICdmcm9tJzogdHJpcC5zdGFydE5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgJ3RvJzogdHJpcC5lbmROYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICdzY2hlZHVsZWRUaW1lJzogdHJpcC5zY2hlZFBpY2t1cFRpbWVcclxuICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIG1vZGFsQ2FuY2VsVHJpcCA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvbW9kdWxlcy9vbi1kZW1hbmQvYWN0aXZlVHJpcC90cmlwLWNhbmNlbGxhdGlvbi1wcm9tcHQuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1RyaXBDYW5jZWxsYXRpb25Db250cm9sbGVyIGFzIHZtJyxcclxuICAgICAgICAgICAgICAgICAgICBzaXplOiAnLWZzJyxcclxuICAgICAgICAgICAgICAgICAgICBiYWNrZHJvcDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0cmlwVG9DYW5jZWw6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cmlwVG9DYW5jZWw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNob3dDYW5jZWxPcHRpb25zOiAkc2NvcGUub3B0cy5zaG93Q2FuY2VsT3B0aW9uc1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIG1vZGFsQ2FuY2VsVHJpcC5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5pc0NhbmNlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdFN1Y2Nlc3MoXCJTdWNjZXNzIVwiLCBcIlRyaXAgY2FuY2VsbGVkXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBnZXRUcmlwc0ZvclBhc3NlbmdlcihudWxsLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKFwiRXJyb3IhXCIsIFwiVW5hYmxlIHRvIGNhbmNlbCB0aGUgdHJpcC5cIik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuaW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5sb2FkaW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5pc1Bhc3NlbmdlciA9ICRzY29wZS5vcHRzLmlzUGFzc2VuZ2VyO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlc2VydmF0aW9uVHlwZSA9ICRzY29wZS5vcHRzLnJlc2VydmF0aW9uVHlwZTtcclxuICAgICAgICAgICAgICAgIGRpdmlzaW9uSWQgPSAkc2NvcGUub3B0cy5EaXZpc2lvbklkO1xyXG4gICAgICAgICAgICAgICAgb3BlcmF0b3JJZCA9ICRzY29wZS5vcHRzLk9wZXJhdG9ySWQ7XHJcbiAgICAgICAgICAgICAgICBiYXRjaERheXMgPSAkc2NvcGUub3B0cy5iYXRjaERheXM7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUub3B0cy5hdXRvUmVmcmVzaCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBtaW5Gcm9tRGF5cyA9ICRzY29wZS5vcHRzLm1pbkZyb21EYXlzO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuaXNTdGFydERwID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuaXNFbmR0RHAgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5kYXRlID0geyAnZnJvbSc6IHVuZGVmaW5lZCwgJ3RvJzogdW5kZWZpbmVkIH07XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubWluRnJvbURhdGVBbGxvd2VkID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1heEZyb21EYXRlQWxsb3dlZCA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgICRzY29wZS5taW5Ub0RhdGVBbGxvd2VkID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLm1heFRvRGF0ZUFsbG93ZWQgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2hvd01hcCA9IFtdO1xyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5pc1Bhc3NlbmdlcilcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYWN0aXZhdGUoJHNjb3BlLnBhc3Nlbmdlcik7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXRTZXJ2aWNlRGF0ZUJ5RGl2aXNpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBTY2hlZHVsZVNlcnZpY2UuZ2V0U2VydmljZURhdGVCeURpdmlzaW9uKGRpdmlzaW9uSWQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2VydmljZURhdGUgPSByZXNwb25zZS5kYXRhLnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNlcnZpY2VEYXRlID0gc2VydmljZURhdGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldENhbGVuZGFyRGF0ZXMoc2VydmljZURhdGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2FsbGJhY2sgPSAkc2NvcGUub3B0cy5hdXRvUmVmcmVzaCA/IHNldEF1dG9SZWZyZXNoIDogbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2V0VHJpcHNGb3JQYXNzZW5nZXIoY2FsbGJhY2spO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2socmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIFV0aWxpdHlGYWN0b3J5LnRvYXN0RXJyb3IoXCJFcnJvciFcIiwgXCJGYWlsZWQgdG8gZ2V0IFNlcnZpY2UgRGF0ZS5cIik7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBzZXRBdXRvUmVmcmVzaCgpIHtcclxuICAgICAgICAgICAgICAgIGF1dG9SZWZyZXNoQWN0aXZlVHJpcCA9ICRpbnRlcnZhbChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2V0QWN0aXZlVHJpcCgpO1xyXG4gICAgICAgICAgICAgICAgfSwgMzAwMDApO1xyXG4gICAgICAgICAgICAgICAgYXV0b1JlZnJlc2ggPSAkaW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGdldFRyaXBzRm9yUGFzc2VuZ2VyKCk7XHJcbiAgICAgICAgICAgICAgICB9LCA2MDAwMCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldEFjdGl2ZVRyaXAoY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgICAgIHZhciBwYXNzID0gSlNPTi5wYXJzZSgkc2NvcGUucGFzc2VuZ2VyKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5wYXNzZW5nZXJJZCA9IHBhc3MgPyBwYXNzLklkIDogdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBTY2hlZHVsZVNlcnZpY2UuZ2V0bGFzdHJpcGRldGFpbHMoJHNjb3BlLnBhc3NlbmdlcklkLCBkaXZpc2lvbklkKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghYW5ndWxhci5pc1VuZGVmaW5lZCgkc2NvcGUucGFzc2VuZ2VyRnV0dXJlVHJpcHMpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWN0aXZlVHJpcCA9ICRmaWx0ZXIoJ2ZpbHRlcicpKCRzY29wZS5wYXNzZW5nZXJGdXR1cmVUcmlwcyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IFRyaXBJZDogcmVzcG9uc2UuZGF0YS5yZXN1bHQuVHJpcElEIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGl2ZVRyaXAubGVuZ3RoID4gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYWN0aXZlVHJpcCA9IGFjdGl2ZVRyaXBbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYWN0aXZlVHJpcCA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRyaXBJZDogbnVsbFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaylcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcclxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHNldENhbGVuZGFyRGF0ZXMoc2VydmljZURhdGUpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmlzUGFzc2VuZ2VyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEkc2NvcGUub3B0cy5pc0FkdmFuY2VkUmVzZXJ2YXRpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmRhdGUudG8gPSBtb21lbnQoc2VydmljZURhdGUpLmZvcm1hdChkYXRlRm9ybWF0KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0ZS50byA9IG1vbWVudChzZXJ2aWNlRGF0ZSkuYWRkKGJhdGNoRGF5cywgJ2QnKS5mb3JtYXQoZGF0ZUZvcm1hdCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5kYXRlLmZyb20gPSBtb21lbnQoc2VydmljZURhdGUpLmFkZCgtbWluRnJvbURheXMsICdkJykuZm9ybWF0KGRhdGVGb3JtYXQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNlbGVjdGVkTW9tZW50RGF0ZSA9IG1vbWVudChzZXJ2aWNlRGF0ZSkuZm9ybWF0KGRhdGVGb3JtYXQpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0ZS5mcm9tID0gc2VsZWN0ZWRNb21lbnREYXRlO1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5kYXRlLnRvID0gc2VsZWN0ZWRNb21lbnREYXRlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB2YXIgbWF4VG9EYXRlID0gbW9tZW50KHNlbGVjdGVkTW9tZW50RGF0ZSwgZGF0ZUZvcm1hdCkuYWRkKGJhdGNoRGF5cywgJ2QnKTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWluVG9EYXRlQWxsb3dlZCA9IHNlbGVjdGVkTW9tZW50RGF0ZTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWF4VG9EYXRlQWxsb3dlZCA9IG5ldyBEYXRlKG1heFRvRGF0ZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBtaW5Gcm9tRGF0ZSA9IG1vbWVudChzZWxlY3RlZE1vbWVudERhdGUsIGRhdGVGb3JtYXQpLmFkZCgtbWluRnJvbURheXMsICdkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1pbkZyb21EYXRlQWxsb3dlZCA9IG5ldyBEYXRlKG1pbkZyb21EYXRlKTtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubWF4RnJvbURhdGVBbGxvd2VkID0gc2VsZWN0ZWRNb21lbnREYXRlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLm9uVHJpcENhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGdldFRyaXBzRm9yUGFzc2VuZ2VyKG51bGwsIHRydWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICRzY29wZS5kYXRlQ2hhbmdlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBmcm9tRGF0ZSA9ICRzY29wZS5kYXRlLmZyb207XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubWluVG9EYXRlQWxsb3dlZCA9IGZyb21EYXRlO1xyXG4gICAgICAgICAgICAgICAgaWYgKGlzQmVmb3JlKCRzY29wZS5kYXRlLnRvLCAkc2NvcGUuZGF0ZS5mcm9tKSlcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0ZS50byA9IGFuZ3VsYXIuY29weSgkc2NvcGUuZGF0ZS5mcm9tKTtcclxuXHJcbiAgICAgICAgICAgICAgICBnZXRUcmlwc0ZvclBhc3NlbmdlcigpO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gaXNCZWZvcmUoZnJvbSwgdG8pIHtcclxuICAgICAgICAgICAgICAgIHZhciBkaWZmID0gbmV3IERhdGUoZnJvbSkuZ2V0VGltZSgpIDw9IG5ldyBEYXRlKHRvKS5nZXRUaW1lKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGlmZjtcclxuICAgICAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXRUcmlwc0ZvclBhc3NlbmdlcihjYWxsYmFjaywgaXNGcm9tQ2FuY2VsKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdmFyIGZyb21EYXRlID0gJGZpbHRlcignZGF0ZScpKCRzY29wZS5kYXRlLmZyb20sICd5eXl5LU1NLWRkJyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgdG9EYXRlID0gJGZpbHRlcignZGF0ZScpKCRzY29wZS5kYXRlLnRvLCAneXl5eS1NTS1kZCcpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBwYXNzID0gSlNPTi5wYXJzZSgkc2NvcGUucGFzc2VuZ2VyKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5wYXNzZW5nZXJJZCA9IHBhc3MgPyBwYXNzLklkIDogdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgU2NoZWR1bGVTZXJ2aWNlLmdldFBhc3NlbmdlclRyaXBzKGRpdmlzaW9uSWQsICRzY29wZS5wYXNzZW5nZXJJZCwgZnJvbURhdGUsIHRvRGF0ZSlcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXBUcmlwcyhyZXNwb25zZS5kYXRhLnJlc3VsdCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5sb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0QWN0aXZlVHJpcChjYWxsYmFjaylcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGlzRnJvbUNhbmNlbClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldEFjdGl2ZVRyaXAoKTtcclxuICAgICAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3Jtc2cpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcignRXJyb3InLCBlcnJvcm1zZy5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIG1hcFRyaXBzKHRyaXBzKSB7XHJcbiAgICAgICAgICAgICAgICBhZGRQcm9taXNlV2luZG93QW5kRXBvY2hUb1RyaXAodHJpcHMpO1xyXG5cclxuICAgICAgICAgICAgICAgICRzY29wZS5wYXNzZW5nZXJQYXN0VHJpcHMgPSBnZXRUcmlwcyh0cmlwcywgZmlsdGVyUGFzdFRyaXBzLCBzb3J0UGFzdFRyaXBzKTtcclxuICAgICAgICAgICAgICAgICRzY29wZS5wYXNzZW5nZXJGdXR1cmVUcmlwcyA9IGdldEZ1dHVyZVRyaXBzKHRyaXBzKTsvLywgZmlsdGVyRnV0dXJlVHJpcHMsIHNvcnRGdXR1cmVUcmlwcyk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldEZ1dHVyZVRyaXBzKHRyaXBzKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZnV0dXJlVHJpcHMgPSBhbmd1bGFyLmNvcHkodHJpcHMpO1xyXG5cclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgJHNjb3BlLnBhc3NlbmdlclBhc3RUcmlwcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0cmlwSWQgPSAkc2NvcGUucGFzc2VuZ2VyUGFzdFRyaXBzW2ldLlRyaXBJZDtcclxuICAgICAgICAgICAgICAgICAgICBmdXR1cmVUcmlwcyA9ICRmaWx0ZXIoJ2ZpbHRlcicpKGZ1dHVyZVRyaXBzLCB7IFRyaXBJZDogJyEnICsgdHJpcElkIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZ1dHVyZVRyaXBzO1xyXG5cclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIHNvcnRGdXR1cmVUcmlwcyhhLCBiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYS5zY2hlZEVwb2NoIC0gYi5zY2hlZEVwb2NoO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gZmlsdGVyUGFzdFRyaXBzKHRyaXApIHtcclxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50RGl2aXNpb25FcG9jaCA9IG1vbWVudC50eihEaXZpc2lvblNlcnZpY2UuZ2V0VGltZVpvbmUoKSkuZm9ybWF0KCd4Jyk7XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRyaXAuU3RhdHVzID09PSAnQ2FuY2VsJ1xyXG4gICAgICAgICAgICAgICAgICAgIHx8IHRyaXAuU3RhdHVzID09PSAnTm8tc2hvdydcclxuICAgICAgICAgICAgICAgICAgICB8fCB0cmlwLlN0YXR1cyA9PT0gJ0VuZCdcclxuICAgICAgICAgICAgICAgICAgICB8fCAvL3RyaXAuU3RhdHVzID09PSAnUmVzZXJ2ZWQnICYmIFxyXG4gICAgICAgICAgICAgICAgICAgICAgIHRyaXAuc2VydmljZURhdGUgPCAkc2NvcGUuc2VydmljZURhdGU7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBzb3J0UGFzdFRyaXBzKGEsIGIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBiLnNjaGVkRXBvY2ggLSBhLnNjaGVkRXBvY2g7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldFRyaXBzKHRyaXBzLCBmaWx0ZXIsIHNvcnQpIHtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgZmlsdGVyZWQgPSB0cmlwcy5maWx0ZXIoZmlsdGVyKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZmlsdGVyZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJlZC5zb3J0KHNvcnQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZpbHRlcmVkO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmdW5jdGlvbiBtYXBQcm9taXNlV2luZG93QW5kRXBvY2godHJpcCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHByb21pc2VXaW5kb3cgPSAkc2NvcGUub3B0cy5wcm9taXNlV2luZG93O1xyXG4gICAgICAgICAgICAgICAgdHJpcC5zY2hlZEVwb2NoID0gbW9tZW50LnR6KHRyaXAuc2NoZWRQaWNrdXBUaW1lLCBEaXZpc2lvblNlcnZpY2UuZ2V0VGltZVpvbmUoKSkuZm9ybWF0KCd4Jyk7XHJcbiAgICAgICAgICAgICAgICB0cmlwLmVzdEVwb2NoID0gbW9tZW50LnR6KHRyaXAuZXN0aW1hdGVkUGlja3VwVGltZSwgRGl2aXNpb25TZXJ2aWNlLmdldFRpbWVab25lKCkpLmZvcm1hdCgneCcpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0cmlwLmVzdGltYXRlZFBpY2t1cFRpbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAvL3ZhciBwaWNrdXBUaW1lID0gdHJpcC5zY2hlZFBpY2t1cFRpbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgLy92YXIgcHJvbWlzZVdpbmRvd3NFbmRUaW1lID0gRGF0ZUZhY3RvcnkuZ2V0UHJvbWlzZVdpbmRvd0VuZFRpbWUocGlja3VwVGltZSwgcHJvbWlzZVdpbmRvdyk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy90cmlwLnByb21pc2VXaW5kb3dTdGFydFRpbWUgPSAkZmlsdGVyKCdkYXRlJykocGlja3VwVGltZSwgJ2g6bW0gYScpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vdHJpcC5wcm9taXNlV2luZG93RW5kVGltZSA9ICRmaWx0ZXIoJ2RhdGUnKShwcm9taXNlV2luZG93c0VuZFRpbWUsICdoOm1tIGEnKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0YXJ0UGlja3VwV2luZG93VGltZSA9IG5ldyBtb21lbnQodHJpcC5zdGFydFBpY2t1cFdpbmRvd1RpbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBlbmRQaWNrdXBXaW5kb3dUaW1lID0gbmV3IG1vbWVudCh0cmlwLmVuZFBpY2t1cFdpbmRvd1RpbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRyaXAucHJvbWlzZVdpbmRvd1N0YXJ0VGltZSA9IHN0YXJ0UGlja3VwV2luZG93VGltZS5mb3JtYXQoJ2g6bW0gQScpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRyaXAucHJvbWlzZVdpbmRvd0VuZFRpbWUgPSBlbmRQaWNrdXBXaW5kb3dUaW1lLmZvcm1hdCgnaDptbSBBJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0cmlwLnZlaGljbGVMaWNlbnNlID09IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyaXAudmVoaWNsZUxpY2Vuc2UgPSBcIk4vQVwiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gYWRkUHJvbWlzZVdpbmRvd0FuZEVwb2NoVG9UcmlwKHRyaXBzKSB7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdHJpcHMubGVuZ3RoOyBpKyspXHJcbiAgICAgICAgICAgICAgICAgICAgbWFwUHJvbWlzZVdpbmRvd0FuZEVwb2NoKHRyaXBzW2ldKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldE1hcEluZm8odHJpcCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1hcEluZm8gPVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ2FjdGl2ZVRyaXBSdW5JZCc6IHRyaXAuUnVuSWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdGcm9tTGF0JzogdHJpcC5zdGFydExhdGl0dWRlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnRnJvbUxvbmcnOiB0cmlwLnN0YXJ0TG9uZ2l0dWRlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnVG9MYXQnOiB0cmlwLmVuZExhdGl0dWRlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAnVG9Mb25nJzogdHJpcC5lbmRMb25naXR1ZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICd0cmlwSWQnOiB0cmlwLlRyaXBJZFxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG1hcEluZm87XHJcbiAgICAgICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICAgICAgJHNjb3BlLmFkZE5ld1RyaXAgPSBmdW5jdGlvbiAodHJpcCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHRyaXBEYXRlID0gbW9tZW50KHRyaXAuU2NoZWR1bGVkUGlja3VwVGltZSkuZm9ybWF0KGRhdGVGb3JtYXQpO1xyXG4gICAgICAgICAgICAgICAgLy9pZiBuZXcgdHJpcCBmYWxscyBiZXR3ZWVuIGV4aXN0aW5nIHNlbGVjdGVkIGRhdGVzIFxyXG4gICAgICAgICAgICAgICAgaWYgKGlzQmVmb3JlKCRzY29wZS5kYXRlLmZyb20sIHRyaXBEYXRlKSAmJiBpc0JlZm9yZSh0cmlwRGF0ZSwgJHNjb3BlLmRhdGUudG8pKVxyXG4gICAgICAgICAgICAgICAgICAgIGdldFRyaXBzRm9yUGFzc2VuZ2VyKCk7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKGF1dG9SZWZyZXNoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICRpbnRlcnZhbC5jYW5jZWwoYXV0b1JlZnJlc2gpO1xyXG4gICAgICAgICAgICAgICAgICAgIGF1dG9SZWZyZXNoID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuXHJcblxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzRGVmaW5lZChhdXRvUmVmcmVzaEFjdGl2ZVRyaXApKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJGludGVydmFsLmNhbmNlbChhdXRvUmVmcmVzaEFjdGl2ZVRyaXApO1xyXG4gICAgICAgICAgICAgICAgICAgIGF1dG9SZWZyZXNoQWN0aXZlVHJpcCA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignQWRkVmVoaWNsZUNvbnRyb2xsZXInLCBBZGRWZWhpY2xlQ29udHJvbGxlcik7XHJcblxyXG4gICAgQWRkVmVoaWNsZUNvbnRyb2xsZXIuJGluamVjdCA9IFsnYXV0aFNlcnZpY2UnLCAndmVoaWNsZVNlcnZpY2UnLCAnJHVpYk1vZGFsSW5zdGFuY2UnLCAnYXRsZWFzdE9uZVZlaGljbGVFeGlzdCcsJyR0aW1lb3V0J107XHJcblxyXG4gICAgZnVuY3Rpb24gQWRkVmVoaWNsZUNvbnRyb2xsZXIoYXV0aFNlcnZpY2UsIHZlaGljbGVTZXJ2aWNlLCAkdWliTW9kYWxJbnN0YW5jZSwgYXRsZWFzdE9uZVZlaGljbGVFeGlzdCwkdGltZW91dCkge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdm0udmVoaWNsZUluZm8gPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgdm0uYXRsZWFzdE9uZVZlaGljbGVFeGlzdCA9IGF0bGVhc3RPbmVWZWhpY2xlRXhpc3Q7XHJcbiAgICAgICAgdm0ubWVzc2FnZSA9ICcnO1xyXG4gICAgICAgIHZtLmlzU2F2aW5nID0gZmFsc2U7XHJcbiAgICAgICAgdm0uZXJyb3JNZXNzYWdlID0gJ0FkZCBmYWlsZWQnO1xyXG4gICAgICAgIHZtLnNob3dNZXNzYWdlID0gZmFsc2U7XHJcbiAgICAgICAgdmFyIHBhc3NlbmdlcklkID0gYXV0aFNlcnZpY2UuYXV0aGVudGljYXRpb24ucGFzc2VuZ2VySWQ7ICAgICAgICBcclxuICAgICAgICB2YXIgaXNBZGRlZCA9IGZhbHNlO1xyXG4gICAgICAgIHZtLm1heFllYXIgPSBuZXcgRGF0ZSgpLmdldEZ1bGxZZWFyKCkgKyAxO1xyXG4gICAgICAgIHZtLmlzWWVhclZhbGlkID0gaXNZZWFyVmFsaWQ7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldERlZmF1bHRWZWhpY2xlSW5mbygpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIHllYXI6ICcnLFxyXG4gICAgICAgICAgICAgICAgbWFrZTogJycsXHJcbiAgICAgICAgICAgICAgICBtb2RlbDogJycsXHJcbiAgICAgICAgICAgICAgICBjb2xvcjogJycsXHJcbiAgICAgICAgICAgICAgICBsaWNlbmNlUGxhdGU6ICcnLCAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGlzRGVmYXVsdDogIXZtLmF0bGVhc3RPbmVWZWhpY2xlRXhpc3QsXHJcbiAgICAgICAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaXNZZWFyVmFsaWQoKSB7XHJcbiAgICAgICAgICAgIGlmICh2bS52ZWhpY2xlSW5mby55ZWFyICE9PSAnJykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHZtLnZlaGljbGVJbmZvLnllYXIgPj0gJzE5MzAnICYmIHZtLnZlaGljbGVJbmZvLnllYXIgPD0gdm0ubWF4WWVhcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBzaG93TWVzc2FnZShtc2cpIHtcclxuICAgICAgICAgICAgdm0ubWVzc2FnZSA9IG1zZztcclxuICAgICAgICAgICAgdm0uc2hvd01lc3NhZ2UgPSB0cnVlO1xyXG4gICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5zaG93TWVzc2FnZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9LCA1MDAwKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5zYXZlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2bS5pc1NhdmluZyA9IHRydWU7XHJcbiAgICAgICAgICAgIGlzQWRkZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgaWYgKGlzVmFsaWQoKSkge1xyXG4gICAgICAgICAgICAgICAgdmVoaWNsZVNlcnZpY2Uuc2F2ZSh2bS52ZWhpY2xlSW5mbywgcGFzc2VuZ2VySWQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSAmJiByZXNwb25zZS5kYXRhLnN0YXR1cyA9PSAxICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0ID4gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0udmVoaWNsZUluZm8uaWQgPSByZXNwb25zZS5kYXRhLnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9yZXNldFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS52ZWhpY2xlSW5mbyA9IGdldERlZmF1bHRWZWhpY2xlSW5mbygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpc0FkZGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoeyAnaXNBZGRlZCc6IGlzQWRkZWQgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2hvd01lc3NhZ2UocmVzcG9uc2UuZGF0YS5yZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmlzU2F2aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICBzaG93TWVzc2FnZShyZXNwb25zZS5kYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmlzU2F2aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHNob3dNZXNzYWdlKFwiSW52YWxpZCBJbnB1dCFcIik7XHJcbiAgICAgICAgICAgICAgICB2bS5pc1NhdmluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSAgICAgICAgXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGlzVmFsaWQoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAhKHZtLnZlaGljbGVJbmZvLmNvbG9yID09PSAnJyB8fCB2bS52ZWhpY2xlSW5mby5jb2xvci50cmltKCkgPT0gJydcclxuICAgICAgICAgICAgfHwgdm0udmVoaWNsZUluZm8ubGljZW5jZVBsYXRlID09PSAnJyB8fCB2bS52ZWhpY2xlSW5mby5saWNlbmNlUGxhdGUudHJpbSgpID09ICcnXHJcbiAgICAgICAgICAgICAgICB8fCB2bS52ZWhpY2xlSW5mby5tYWtlID09PSAnJyB8fCB2bS52ZWhpY2xlSW5mby5tYWtlLnRyaW0oKSA9PSAnJ1xyXG4gICAgICAgICAgICAgICAgfHwgdm0udmVoaWNsZUluZm8ubW9kZWwgPT09ICcnIHx8IHZtLnZlaGljbGVJbmZvLm1vZGVsLnRyaW0oKSA9PSAnJ1xyXG4gICAgICAgICAgICAgICAgfHwgdm0udmVoaWNsZUluZm8ueWVhciA9PT0gJycpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIFxyXG4gICAgICAgIHZtLmNhbmNlbCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSh7J2lzQWRkZWQnIDogaXNBZGRlZH0pO1xyXG4gICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICBhY3RpdmF0ZSgpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcclxuICAgICAgICAgICAgdm0udmVoaWNsZUluZm8gPSBnZXREZWZhdWx0VmVoaWNsZUluZm8oKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIFxyXG4gICAgfVxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0NhbmNlbFJlc2VydmF0aW9uQ29udHJvbGxlcicsIENhbmNlbFJlc2VydmF0aW9uQ29udHJvbGxlcik7XHJcblxyXG4gICAgQ2FuY2VsUmVzZXJ2YXRpb25Db250cm9sbGVyLiRpbmplY3QgPSBbJyRsb2NhdGlvbicsICckdWliTW9kYWxJbnN0YW5jZScsICdyZXNlcnZhdGlvbkluZm8nLCAnUmVzZXJ2YXRpb25TZXJ2aWNlJywgJ1N0b3BEYXRhU2VydmljZScsICdNZXNzYWdlU2VydmljZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIENhbmNlbFJlc2VydmF0aW9uQ29udHJvbGxlcigkbG9jYXRpb24sICR1aWJNb2RhbEluc3RhbmNlLCByZXNlcnZhdGlvbkluZm8sIFJlc2VydmF0aW9uU2VydmljZSwgU3RvcERhdGFTZXJ2aWNlLCBNZXNzYWdlU2VydmljZSkge1xyXG4gICAgICAgIC8qIGpzaGludCB2YWxpZHRoaXM6dHJ1ZSAqL1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdm0ucmVzZXJ2YXRpb25JbmZvID0gcmVzZXJ2YXRpb25JbmZvO1xyXG4gICAgICAgIHZtLnJvdXRlTmFtZSA9IHZtLnJlc2VydmF0aW9uSW5mby5yb3V0ZU5hbWU7XHJcbiAgICAgICAgdm0uc3RhcnRUaW1lID0gdm0ucmVzZXJ2YXRpb25JbmZvLnN0YXJ0VGltZTtcclxuICAgICAgICB2bS5yZXNlcnZhdGlvbkRhdGUgPSBtb21lbnQodm0ucmVzZXJ2YXRpb25JbmZvLnJlc2VydmF0aW9uRGF0ZSkuZm9ybWF0KCdNTS9ERC9ZWVlZJyk7XHJcbiAgICAgICAgdm0uY2FuY2VsRXJyb3IgPSBmYWxzZTtcclxuICAgICAgICB2bS5kaXNhYmxlID0gZmFsc2U7XHJcbiAgICAgICAgdm0uZXJyb3JNZXNzYWdlID0gJ1NvcnJ5LCB3ZSB3ZXJlIHVuYWJsZSB0byBjYW5jZWwgdGhpcyByZXNlcnZhdGlvbi4nOyAgICBcclxuXHJcbiAgICAgICAgdm0uY2FuY2VsUmVzZXJ2YXRpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZtLmRpc2FibGUgPSB0cnVlO1xyXG4gICAgICAgICAgICBpZiAodm0ucmVzZXJ2YXRpb25JbmZvLnJlc2VydmF0aW9uSWQpIHtcclxuICAgICAgICAgICAgICAgIFJlc2VydmF0aW9uU2VydmljZS5jYW5jZWxSZXNlcnZhdGlvbih2bS5yZXNlcnZhdGlvbkluZm8ucGFzc2VuZ2VySWQsIHZtLnJlc2VydmF0aW9uSW5mby5yZXNlcnZhdGlvbklkKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLmRhdGEgJiYgcmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSh7ICdhY3Rpb24nOiAnY2xvc2UnLCAnaXNDYW5jZWwnOiB0cnVlIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmNhbmNlbEVycm9yID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEucmVzdWx0ICYmIHJlc3BvbnNlLmRhdGEubWVzc2FnZSA9PSAnRmFpbHVyZScpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5lcnJvck1lc3NhZ2UgPSByZXNwb25zZS5kYXRhLnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uZGlzYWJsZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2bS5jYW5jZWxFcnJvciA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIFxyXG4gICAgICAgIHZtLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnY2FuY2VsJyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdGhpcy5NYWtlRGlzYWJsZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKHZtLmRpc2FibGUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxufSkoKTtcclxuXHJcblxyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnb25lTVZBcHAnKTtcclxuICAgIGFwcC5jb250cm9sbGVyKCdDb21tdXRlckZlZWRiYWNrTW9kYWxDb250cm9sbGVyJywgQ29tbXV0ZXJGZWVkYmFja01vZGFsQ29udHJvbGxlcik7XHJcblxyXG4gICAgQ29tbXV0ZXJGZWVkYmFja01vZGFsQ29udHJvbGxlci4kaW5qZWN0ID0gWyckdWliTW9kYWxJbnN0YW5jZScsICdVdGlsaXR5RmFjdG9yeScsICdDb25maWdGYWN0b3J5JywgJ0ZlZWRiYWNrU2VydmljZScsICdmZWVkYmFja0luZm8nXTtcclxuXHJcbiAgICBmdW5jdGlvbiBDb21tdXRlckZlZWRiYWNrTW9kYWxDb250cm9sbGVyKCR1aWJNb2RhbEluc3RhbmNlLFV0aWxpdHlGYWN0b3J5LCBDb25maWdGYWN0b3J5LCBGZWVkYmFja1NlcnZpY2UsIGZlZWRiYWNrSW5mbykge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdm0uZmVlZGJhY2tJbmZvID0gYW5ndWxhci5jb3B5KGZlZWRiYWNrSW5mbyk7XHJcblxyXG4gICAgICAgIHZtLmNhbmNlbCA9IGNhbmNlbDtcclxuICAgICAgICB2bS5zYXZlRmVlZGJhY2sgPSBzYXZlRmVlZGJhY2s7XHJcblxyXG5cclxuICAgICAgICB2bS5kaXNhYmxlU3VibWl0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdm0uZmVlZGJhY2tJbmZvLnJhdGluZyA8PSAwIHx8IHZtLmZlZWRiYWNrSW5mby5yYXRpbmcgPT0gbnVsbDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBjYW5jZWwoKSB7XHJcbiAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKHtpc1NhdmVkOmZhbHNlfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2F2ZUZlZWRiYWNrKCkgeyAgICAgICAgICAgIFxyXG5cclxuICAgICAgICAgICAgRmVlZGJhY2tTZXJ2aWNlXHJcbiAgICAgICAgICAgICAgICAuYWRkQ29tbXV0ZXJGZWVkYmFjayhcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBDb21tZW50OiB2bS5mZWVkYmFja0luZm8uY29tbWVudC50cmltKCksXHJcbiAgICAgICAgICAgICAgICAgICAgUmF0aW5nOiB2bS5mZWVkYmFja0luZm8ucmF0aW5nXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uZmVlZGJhY2tJbmZvLnJlc2VydmF0aW9uSWQpXHJcbiAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmlzU2F2aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RTdWNjZXNzKFwiU3VjY2VzcyFcIiwgXCJGZWVkYmFjayBzYXZlZCBzdWNjZXNzZnVsbHlcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2Uoe2lzU2F2ZWQgOnRydWV9KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uaXNTYXZpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKFwiRXJyb3IhXCIsIFwiQ291bGQgbm90IHNhdmUgZmVlZGJhY2tcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0Vycm9yOiAtICcgKyByZXNwb25zZS5kYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5pc1NhdmluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RFcnJvcihcIkVycm9yIVwiLCBcIkNvdWxkIG5vdCBzYXZlIGZlZWRiYWNrXCIpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0Vycm9yOiAtICcgKyByZXNwb25zZS5kYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignTW9kaWZ5UmVzZXJ2YXRpb25QaWNrdXAnLCBNb2RpZnlSZXNlcnZhdGlvblBpY2t1cCk7XHJcblxyXG4gICAgTW9kaWZ5UmVzZXJ2YXRpb25QaWNrdXAuJGluamVjdCA9IFsnJGxvY2F0aW9uJywgJyR1aWJNb2RhbEluc3RhbmNlJywgJ1Jlc2VydmF0aW9uU2VydmljZScsXHJcbiAgICAgICAgJ3ZlaGljbGVTZXJ2aWNlJywgJ0RpdmlzaW9uU2VydmljZScsICdhdXRoU2VydmljZScsICdyZXNlcnZhdGlvbiddO1xyXG5cclxuICAgIGZ1bmN0aW9uIE1vZGlmeVJlc2VydmF0aW9uUGlja3VwKCRsb2NhdGlvbiwgJHVpYk1vZGFsSW5zdGFuY2UsIFJlc2VydmF0aW9uU2VydmljZSxcclxuICAgICAgICB2ZWhpY2xlU2VydmljZSwgRGl2aXNpb25TZXJ2aWNlLGF1dGhTZXJ2aWNlLCByZXNlcnZhdGlvbikge1xyXG5cclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG5cclxuICAgICAgICB2YXIgcGFzc2VuZ2VySWQgPSBhdXRoU2VydmljZS5hdXRoZW50aWNhdGlvbi5wYXNzZW5nZXJJZDtcclxuICAgICAgICB2YXIgbmV3UmVzZXJ2YXRpb25JbmZvID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHZhciBub1ZlaGljbGUgPSB7IGlkOiBudWxsLCBsaWNlbmNlcGxhdGU6ICctLScgfTtcclxuXHJcbiAgICAgICAgdm0ucmVzZXJ2YXRpb25JbmZvID0gcmVzZXJ2YXRpb247XHJcbiAgICAgICAgdm0ubWVzc2FnZSA9IFwiXCI7XHJcbiAgICAgICAgdm0uaXNTYXZpbmcgPSBmYWxzZTtcclxuICAgICAgICB2bS5jdXJyZW50VHJpcElkID0gdm0ucmVzZXJ2YXRpb25JbmZvLnRyaXBJZDtcclxuICAgICAgICB2bS5zZWxlY3RlZFRyaXBJZCA9IHZtLnJlc2VydmF0aW9uSW5mby50cmlwSWQ7XHJcbiAgICAgICAgdm0uYXZhaWxhYmxlUGFya2luZyA9IDA7XHJcbiAgICAgICAgdm0uc2VsZWN0ZWRWZWhpY2xlSWQgPSBhbmd1bGFyLmNvcHkodm0ucmVzZXJ2YXRpb25JbmZvLnZlaGljbGVJZCk7XHJcbiAgICAgICAgdm0uZGl2aXNpb25BbGxvd3NXYWl0bGlzdCA9IHRydWU7XHJcblxyXG4gICAgICAgIHZtLm1hbmFnZVZlaGljbGUgPSBtYW5hZ2VWZWhpY2xlO1xyXG4gICAgICAgIHZtLm1vZGlmeVRyaXAgPSBtb2RpZnlUcmlwO1xyXG4gICAgICAgIHZtLmNhbmNlbCA9IGNhbmNlbDtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHtcclxuXHJcbiAgICAgICAgICAgIERpdmlzaW9uU2VydmljZVxyXG4gICAgICAgICAgICAgICAuaXNXYWl0bGlzdEFsbG93ZWRCeURpdmlzaW9uKClcclxuICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgdm0uZGl2aXNpb25BbGxvd3NXYWl0bGlzdCA9IHJlc3BvbnNlO1xyXG4gICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgZ2V0QWx0ZXJuYXRlVHJpcHMoKTtcclxuICAgICAgICAgICAgZ2V0UGFzc2VuZ2VyVmVoaWNsZXMoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNhbmNlbCgpIHtcclxuICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2Uoe1xyXG4gICAgICAgICAgICAgICAgJ2FjdGlvbic6ICdjbG9zZSdcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbWFuYWdlVmVoaWNsZSgpIHtcclxuICAgICAgICAgICAgdm0ubWVzc2FnZSA9IFwiXCI7XHJcblxyXG4gICAgICAgICAgICBSZXNlcnZhdGlvblNlcnZpY2VcclxuICAgICAgICAgICAgICAgIC5tYW5hZ2VQYXJraW5nRm9yUmVzZXJ2YXRpb24ocGFzc2VuZ2VySWQsIHZtLnJlc2VydmF0aW9uSW5mby5pZCwgdm0uc2VsZWN0ZWRWZWhpY2xlSWQpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbXNnID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQubWVzc2FnZTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5tZXNzYWdlID0gbXNnO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2Uoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAnYWN0aW9uJzogJ2Nsb3NlJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ3JlZnJlc2gnOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAncmVzZXJ2YXRpb25JZCc6IHJlc3BvbnNlLmRhdGEucmVzdWx0LmlkXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xyXG5cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRBbHRlcm5hdGVUcmlwcygpIHtcclxuICAgICAgICAgICAgUmVzZXJ2YXRpb25TZXJ2aWNlXHJcbiAgICAgICAgICAgICAuZ2V0QWxsVHJpcHNGb3JDdXJyZW50UmVzZXJ2YXRpb24odm0ucmVzZXJ2YXRpb25JbmZvLmlkLCBwYXNzZW5nZXJJZClcclxuICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgdm0udHJpcHMgPSByZXNwb25zZS5kYXRhLnJlc3VsdC5hbHRUcmlwcztcclxuICAgICAgICAgICAgICAgICAgICAgdm0uYXZhaWxhYmxlUGFya2luZyA9IHZtLnRyaXBzWzBdLmF2YWlsYWJsZVBhcmtpbmc7XHJcbiAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRQYXNzZW5nZXJWZWhpY2xlcygpIHtcclxuICAgICAgICAgICAgdmVoaWNsZVNlcnZpY2UuZ2V0VmVoaWNsZXNGb3JQYXNzZW5nZXIocGFzc2VuZ2VySWQpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09PSAxICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0LnBhc3NlbmdlclZlaGljbGVzICE9IG51bGwpXHJcbiAgICAgICAgICAgICAgICAgICAgdm0ucGFzc2VuZ2VyVmVoaWNsZXMgPSByZXNwb25zZS5kYXRhLnJlc3VsdC5wYXNzZW5nZXJWZWhpY2xlcztcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodm0ucGFzc2VuZ2VyVmVoaWNsZXMubGVuZ3RoID4gMClcclxuICAgICAgICAgICAgICAgICAgICB2bS5wYXNzZW5nZXJWZWhpY2xlcy5zcGxpY2UoMCwgMCwgbm9WZWhpY2xlKTtcclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICB2bS5wYXNzZW5nZXJWZWhpY2xlcy5wdXNoKG5vVmVoaWNsZSk7ICAgICAgICAgICAgIFxyXG5cclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIG1vZGlmeVRyaXAoKSB7XHJcbiAgICAgICAgICAgIHZtLmlzU2F2aW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgdm0ubWVzc2FnZSA9ICcnO1xyXG5cclxuICAgICAgICAgICAgUmVzZXJ2YXRpb25TZXJ2aWNlXHJcbiAgICAgICAgICAgIC5tb2RpZnlSZXNlcnZhdGlvbih2bS5yZXNlcnZhdGlvbkluZm8uaWQsIHZtLnNlbGVjdGVkVHJpcElkLCBwYXNzZW5nZXJJZClcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLm1lc3NhZ2UgPSByZXNwb25zZS5kYXRhLnJlc3VsdC5tZXNzYWdlO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmlzU2F2aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pc1NhdmluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ2FjdGlvbic6ICdjbG9zZScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICdyZWZyZXNoJzogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgJ3Jlc2VydmF0aW9uSWQnOiByZXNwb25zZS5kYXRhLnJlc3VsdC5pZFxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5tZXNzYWdlID0gZXJyb3I7XHJcbiAgICAgICAgICAgICAgICB2bS5pc1NhdmluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGluaXQoKTtcclxuICAgIH1cclxufSkoKTtcclxuXHJcblxyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmNvbnRyb2xsZXIoJ1JlbW92ZVZlaGljbGVDb25maXJtYXRpb25Db250cm9sbGVyJywgUmVtb3ZlVmVoaWNsZUNvbmZpcm1hdGlvbkNvbnRyb2xsZXIpO1xyXG5cclxuICAgIFJlbW92ZVZlaGljbGVDb25maXJtYXRpb25Db250cm9sbGVyLiRpbmplY3QgPSBbJyRsb2NhdGlvbicsJyR1aWJNb2RhbEluc3RhbmNlJywndmVoaWNsZVNlcnZpY2UnLCdpZCcsJ2F1dGhTZXJ2aWNlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gUmVtb3ZlVmVoaWNsZUNvbmZpcm1hdGlvbkNvbnRyb2xsZXIoJGxvY2F0aW9uLCAkdWliTW9kYWxJbnN0YW5jZSwgdmVoaWNsZVNlcnZpY2UsIGlkLCBhdXRoU2VydmljZSkge1xyXG5cclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLmlzUmVtb3ZpbmcgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgdm0ucmVtb3ZlVmVoaWNsZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdm0uaXNSZW1vdmluZyA9IHRydWU7XHJcbiAgICAgICAgICAgIHZlaGljbGVTZXJ2aWNlLnJlbW92ZVZlaGljbGUoaWQsIGF1dGhTZXJ2aWNlLmF1dGhlbnRpY2F0aW9uLnBhc3NlbmdlcklkKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgJiYgcmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoeyByZW1vdmVkOiB0cnVlIH0pOyAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEucmVzdWx0ICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0ICE9PSAnJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKHsgcmVtb3ZlZDogZmFsc2UsIGVycm9yTWVzc2FnZTogcmVzcG9uc2UuZGF0YS5yZXN1bHQgfSk7XHJcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3Moe3JlbW92ZWQ6ZmFsc2V9KTtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignUmVzZXJ2YXRpb25NYXBDb250cm9sbGVyJywgUmVzZXJ2YXRpb25NYXBDb250cm9sbGVyKTtcclxuXHJcbiAgICBSZXNlcnZhdGlvbk1hcENvbnRyb2xsZXIuJGluamVjdCA9IFsnJHNjb3BlJywgJyRsb2NhdGlvbicsICckdGltZW91dCcsICckaHR0cCcsICckdWliTW9kYWxJbnN0YW5jZScsJyRpbnRlcnZhbCcsXHJcbiAgICAgICAgJ0dlb0xvY2F0aW9uU2VydmljZScsICAnU3RvcERhdGFTZXJ2aWNlJywgJ3VpR21hcElzUmVhZHknLCAnTG9jYXRpb25TZXJ2aWNlJywgJ3Jlc2VydmF0aW9uX3N0b3BzJ107XHJcblxyXG4gICAgZnVuY3Rpb24gUmVzZXJ2YXRpb25NYXBDb250cm9sbGVyKCRzY29wZSwgJGxvY2F0aW9uLCAkdGltZW91dCwgJGh0dHAsICR1aWJNb2RhbEluc3RhbmNlLCAkaW50ZXJ2YWwsXHJcbiAgICAgICAgR2VvTG9jYXRpb25TZXJ2aWNlLCBTdG9wRGF0YVNlcnZpY2UsdWlHbWFwSXNSZWFkeSwgTG9jYXRpb25TZXJ2aWNlLCByZXNlcnZhdGlvbl9zdG9wcykge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdm0udGl0bGUgPSAnU2NoZWR1bGUgU3RvcHMnO1xyXG4gICAgICAgIHZtLm1hcENvbnRyb2wgPSB7fTtcclxuICAgICAgICB2bS5zdG9wTWFya2VyID0gW107XHJcbiAgICAgICAgdmFyIGF1dG9SZWZyZXNoTWFya2VyID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHZtLm1hcCA9IHtcclxuICAgICAgICAgICAgLy8gaHR0cDovL2FuZ3VsYXItZ29vZ2xlLW1hcHMub3JnL3VzZVxyXG4gICAgICAgICAgICBjZW50ZXI6IHtcclxuICAgICAgICAgICAgICAgIGxhdGl0dWRlOiA0My43NTUxNDIyMTE5MTQwNixcclxuICAgICAgICAgICAgICAgIGxvbmdpdHVkZTogLTExNi41NzU5NzM1MTA3NDIxOVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB6b29tOiAxMCxcclxuICAgICAgICAgICAgbGluZVN0eWxlOiB7XHJcbiAgICAgICAgICAgICAgICBjb2xvcjogJyMzMzMnLFxyXG4gICAgICAgICAgICAgICAgd2VpZ2h0OiA1LFxyXG4gICAgICAgICAgICAgICAgb3BhY2l0eTogMC43XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIHZtLm1hcE9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIG1hcFR5cGVDb250cm9sOiBmYWxzZSxcclxuICAgICAgICAgICAgem9vbUNvbnRyb2w6IGZhbHNlLFxyXG4gICAgICAgICAgICBzdHJlZXRWaWV3Q29udHJvbDogZmFsc2VcclxuXHJcbiAgICAgICAgfTtcclxuICAgICAgICB2YXIgbXlMb2NhdGlvblBpbiA9ICdpbWFnZXMvcGluLW15LWxvY2F0aW9uLnBuZyc7XHJcbiAgICAgICAgdm0ubXlMb2NhdGlvbkljb24gPSB7XHJcbiAgICAgICAgICAgIHVybDogbXlMb2NhdGlvblBpbixcclxuICAgICAgICAgICAgc2l6ZTogbmV3IGdvb2dsZS5tYXBzLlNpemUoNDIsIDQyKSxcclxuICAgICAgICAgICAgb3JpZ2luOiBuZXcgZ29vZ2xlLm1hcHMuUG9pbnQoMCwgMCksXHJcbiAgICAgICAgICAgIGFuY2hvcjogbmV3IGdvb2dsZS5tYXBzLlBvaW50KDIwLCAyMClcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5yZXNlcnZhdGlvblN0b3BzID0gcmVzZXJ2YXRpb25fc3RvcHM7XHJcbiAgICAgICAgaWYgKHZtLnJlc2VydmF0aW9uU3RvcHMuaWQgIT0gbnVsbCB8fCB2bS5yZXNlcnZhdGlvblN0b3BzLmlkICE9ICcnKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKHZtLnJlc2VydmF0aW9uU3RvcHMuc2NoZWR1bGVUeXBlID09ICdBTScpIHtcclxuICAgICAgICAgICAgICAgIHZtLmljb24gPSAnaW1hZ2VzL3Bpbi1idXNzdG9wLWdyZWVuLnN2ZydcclxuICAgICAgICAgICAgICAgIHZtLmh1Ykljb24gPSAnaW1hZ2VzL3Bpbi1odWIuc3ZnJ1xyXG5cclxuICAgICAgICAgICAgICAgIHZtLnN0b3BNYXJrZXIucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgJ3N0b3BJZCc6IHZtLnJlc2VydmF0aW9uU3RvcHMucGlja3VwU3RvcElkLCAnc3RvcE5hbWUnOiB2bS5yZXNlcnZhdGlvblN0b3BzLnBpY2t1cFN0b3BOYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICdsYXRpdHVkZSc6IHZtLnJlc2VydmF0aW9uU3RvcHMucGlja3VwTGF0aXR1ZGUsICdsb25naXR1ZGUnOiB2bS5yZXNlcnZhdGlvblN0b3BzLnBpY2t1cExvbmdpdHVkZSxcclxuICAgICAgICAgICAgICAgICAgICAnaWNvbic6IHZtLmljb24sICdhZGRyZXNzJzogdm0ucmVzZXJ2YXRpb25TdG9wcy5waWNrdXBBZGRyZXNzXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIHZtLnN0b3BNYXJrZXIucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgJ3N0b3BJZCc6IHZtLnJlc2VydmF0aW9uU3RvcHMuZHJvcG9mZlN0b3BJZCwgJ3N0b3BOYW1lJzogdm0ucmVzZXJ2YXRpb25TdG9wcy5kcm9wb2ZmU3RvcE5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgJ2xhdGl0dWRlJzogdm0ucmVzZXJ2YXRpb25TdG9wcy5kcm9wb2ZmTGF0aXR1ZGUsICdsb25naXR1ZGUnOiB2bS5yZXNlcnZhdGlvblN0b3BzLmRyb3BvZmZMb25naXR1ZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgJ2ljb24nOiB2bS5odWJJY29uLCAnYWRkcmVzcyc6IHZtLnJlc2VydmF0aW9uU3RvcHMuZHJvcG9mZkFkZHJlc3NcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdm0uaWNvbiA9ICdpbWFnZXMvcGluLWJ1c3N0b3AtZ3JleS5zdmcnXHJcbiAgICAgICAgICAgICAgICB2bS5odWJJY29uID0gJ2ltYWdlcy9waW4taHViLnN2ZydcclxuXHJcbiAgICAgICAgICAgICAgICB2bS5zdG9wTWFya2VyLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICdzdG9wSWQnOiB2bS5yZXNlcnZhdGlvblN0b3BzLnBpY2t1cFN0b3BJZCwgJ3N0b3BOYW1lJzogdm0ucmVzZXJ2YXRpb25TdG9wcy5waWNrdXBTdG9wTmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAnbGF0aXR1ZGUnOiB2bS5yZXNlcnZhdGlvblN0b3BzLnBpY2t1cExhdGl0dWRlLCAnbG9uZ2l0dWRlJzogdm0ucmVzZXJ2YXRpb25TdG9wcy5waWNrdXBMb25naXR1ZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgJ2ljb24nOiB2bS5odWJJY29uLCAnYWRkcmVzcyc6IHZtLnJlc2VydmF0aW9uU3RvcHMucGlja3VwQWRkcmVzc1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB2bS5zdG9wTWFya2VyLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICdzdG9wSWQnOiB2bS5yZXNlcnZhdGlvblN0b3BzLmRyb3BvZmZTdG9wSWQsICdzdG9wTmFtZSc6IHZtLnJlc2VydmF0aW9uU3RvcHMuZHJvcG9mZlN0b3BOYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICdsYXRpdHVkZSc6IHZtLnJlc2VydmF0aW9uU3RvcHMuZHJvcG9mZkxhdGl0dWRlLCAnbG9uZ2l0dWRlJzogdm0ucmVzZXJ2YXRpb25TdG9wcy5kcm9wb2ZmTG9uZ2l0dWRlLFxyXG4gICAgICAgICAgICAgICAgICAgICdpY29uJzogdm0uaWNvbiwgJ2FkZHJlc3MnOiB2bS5yZXNlcnZhdGlvblN0b3BzLmRyb3BvZmZBZGRyZXNzXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSAgICAgICAgICAgIFxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGF1dG9SZWZyZXNoTWFya2VyID0gJGludGVydmFsKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgZ2V0TXlMb2NhdGlvbigpO1xyXG4gICAgICAgIH0sIDEwMDAwKTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0TXlMb2NhdGlvbigpXHJcbiAgICAgICAgeyAgICAgICAgICAgIFxyXG4gICAgICAgICAgR2VvTG9jYXRpb25TZXJ2aWNlLmdldEN1cnJlbnRQb3NpdGlvbigpICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChwb3NpdGlvbikge1xyXG4gICAgICAgICAgICAgICAgaWYgKHBvc2l0aW9uID09IHVuZGVmaW5lZCB8fCBwb3NpdGlvbiA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHN0b3BBdXRvUmVmcmVzaE1hcmtlcigpXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdm0ubXlMb2NhdGlvbiA9IHtcclxuICAgICAgICAgICAgICAgICAgICBcImNvb3Jkc1wiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibGF0aXR1ZGVcIjogcG9zaXRpb24uY29vcmRzLmxhdGl0dWRlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcImxvbmdpdHVkZVwiOiBwb3NpdGlvbi5jb29yZHMubG9uZ2l0dWRlXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBcImljb25cIjogdm0ubXlMb2NhdGlvbkljb25cclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xyXG5cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB1aUdtYXBJc1JlYWR5LnByb21pc2UoKS50aGVuKGZ1bmN0aW9uIChtYXBzKSB7XHJcbiAgICAgICAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnRyaWdnZXIodm0ubWFwQ29udHJvbC5nZXRHTWFwKCksIFwicmVzaXplXCIpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgdmFyIGJvdW5kcyA9IG5ldyBnb29nbGUubWFwcy5MYXRMbmdCb3VuZHMoKTtcclxuXHJcbiAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh2bS5zdG9wTWFya2VyLCBmdW5jdGlvbiAoc3RvcCkge1xyXG4gICAgICAgICAgICAgICAgYm91bmRzLmV4dGVuZChuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKHN0b3AubGF0aXR1ZGUsIHN0b3AubG9uZ2l0dWRlKSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgdm0ubWFwQ29udHJvbC5nZXRHTWFwKCkuZml0Qm91bmRzKGJvdW5kcyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vbWFya2VyIGNsaWNrIGZ1bmN0aW9uXHJcbiAgICAgICAgdm0ubWFya2VyRXZlbnQgPSB7XHJcbiAgICAgICAgICAgIGNsaWNrOiBmdW5jdGlvbiAoZ01hcmtlciwgZXZlbnROYW1lLCBtb2RlbCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG1vZGVsLiRpZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vbmF2aWdhdGVUb1NlbGVjdGVkU3RvcChtb2RlbC5jb29yZHMpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2bS5zZWxlY3RlZExvY2F0aW9uKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBTdG9wRGF0YVNlcnZpY2Uuc2V0R2VvTG9jYXRpb24odm0uc2VsZWN0ZWRMb2NhdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgU3RvcERhdGFTZXJ2aWNlLnNldFN0b3AobW9kZWwuY29vcmRzKTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5jb29yZHMgPSBtb2RlbC5jb29yZHM7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uc2hvdyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHN0b3BBdXRvUmVmcmVzaE1hcmtlcigpO1xyXG4gICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2NhbmNlbCcpO1xyXG4gICAgICAgICAgIHZtLmlzRG9uZSA9IHRydWU7XHJcbiAgICAgICB9O1xyXG5cclxuICAgICAgIGZ1bmN0aW9uIHN0b3BBdXRvUmVmcmVzaE1hcmtlcigpIHtcclxuICAgICAgICAgICBpZiAoYW5ndWxhci5pc0RlZmluZWQoYXV0b1JlZnJlc2hNYXJrZXIpKSB7XHJcbiAgICAgICAgICAgICAgICRpbnRlcnZhbC5jYW5jZWwoYXV0b1JlZnJlc2hNYXJrZXIpO1xyXG4gICAgICAgICAgICAgICBhdXRvUmVmcmVzaE1hcmtlciA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICB9XHJcbiAgICAgICB9O1xyXG5cclxuICAgICAgICRzY29wZS4kb24oJyRsb2NhdGlvbkNoYW5nZVN0YXJ0JywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgc3RvcEF1dG9SZWZyZXNoTWFya2VyKCk7XHJcbiAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdSZXNlcnZhdGlvbkNvbnRyb2xsZXInLCBSZXNlcnZhdGlvbkNvbnRyb2xsZXIpO1xyXG5cclxuICAgIFJlc2VydmF0aW9uQ29udHJvbGxlci4kaW5qZWN0ID0gWyckbG9jYXRpb24nLCAnJHVpYk1vZGFsSW5zdGFuY2UnLCAncmVzZXJ2YXRpb25JbmZvJywgJyRpbnRlcnZhbCcsICckcm9vdFNjb3BlJyxcclxuICAgICAgICAnaXNBZGQnLCAnUmVzZXJ2YXRpb25TZXJ2aWNlJywgJ01lc3NhZ2VTZXJ2aWNlJywgJ3ZlaGljbGVTZXJ2aWNlJywgJ1N0b3BEYXRhU2VydmljZScsICdEaXZpc2lvblNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBSZXNlcnZhdGlvbkNvbnRyb2xsZXIoJGxvY2F0aW9uLCAkdWliTW9kYWxJbnN0YW5jZSwgcmVzZXJ2YXRpb25JbmZvLCAkaW50ZXJ2YWwsICRyb290U2NvcGUsXHJcbiAgICAgICAgaXNBZGQsIFJlc2VydmF0aW9uU2VydmljZSwgTWVzc2FnZVNlcnZpY2UsIHZlaGljbGVTZXJ2aWNlLCBTdG9wRGF0YVNlcnZpY2UsIERpdmlzaW9uU2VydmljZSkge1xyXG4gICAgICAgIC8qIGpzaGludCB2YWxpZHRoaXM6dHJ1ZSAqL1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdm0uaXNBZGQgPSBpc0FkZDtcclxuICAgICAgICB2bS5kaXNhYmxlID0gZmFsc2U7XHJcbiAgICAgICAgdm0uaXNSZXNlcnZlZCA9IGZhbHNlO1xyXG4gICAgICAgIHZtLmhhc1ZlaGljbGVzID0gZmFsc2U7XHJcbiAgICAgICAgdm0ubmVlZHNQYXJraW5nID0gZmFsc2U7XHJcbiAgICAgICAgdm0udmVoaWNsZXMgPSBbXTtcclxuICAgICAgICB2bS5zZWxlY3RlZFZlaGljbGUgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgdm0ubG9hZGluZ1ZlaGljbGVzID0gdHJ1ZTtcclxuICAgICAgICB2bS5pc0FNUmVzZXJ2YXRpb24gPSByZXNlcnZhdGlvbkluZm8uc2NoZWR1bGVUeXBlID09PSBcIkFNXCI7XHJcbiAgICAgICAgdm0ucGFya2luZ05vdEF2YWlsYWJsZSA9IGZhbHNlO1xyXG4gICAgICAgIHZtLm5vUGFya2luZ01lc3NhZ2UgPSBcIlBhcmtpbmcgbm90IGF2YWlsYWJsZS5cIjtcclxuICAgICAgICB2bS5hdmFpbGFibGVQYXJraW5nU2xvdHMgPSAwO1xyXG4gICAgICAgIHZtLmlzUGFya2luZ0F0dGFjaGVkVG9SZXNlcnZhdGlvbiA9IHRydWU7XHJcbiAgICAgICAgdm0ucmVzZXJ2YXRpb25EYXRhID0gcmVzZXJ2YXRpb25JbmZvO1xyXG4gICAgICAgIHZtLnVwZGF0ZUxhYmVscyA9IHVwZGF0ZUxhYmVscztcclxuICAgICAgICB2YXIgYXZhaWxhYmxlU2VhdHMgPSAwO1xyXG4gICAgICAgIHZtLmRpdmlzaW9uQWxsb3dzV2FpdGxpc3QgPSB0cnVlO1xyXG4gICAgICAgIHZtLm51bUNvbXBhbmlvbnMgPSBbXTtcclxuICAgICAgICB2bS5zZWxlY3RlZENvbXBhbmlvbnMgPSAwO1xyXG5cclxuXHJcbiAgICAgICAgdmFyIG5vVmVoaWNsZSA9IHsgJ2xpY2VuY2VwbGF0ZSc6ICctLScsICdpZCc6IHVuZGVmaW5lZCB9O1xyXG5cclxuICAgICAgICB2bS5yZXNlcnZlID0gcmVzZXJ2ZTtcclxuXHJcbiAgICAgICAgdmFyIGluaXQgPSBmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgICAgICAgICBEaXZpc2lvblNlcnZpY2VcclxuICAgICAgICAgICAgICAgLmlzV2FpdGxpc3RBbGxvd2VkQnlEaXZpc2lvbigpXHJcbiAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgIHZtLmRpdmlzaW9uQWxsb3dzV2FpdGxpc3QgPSByZXNwb25zZTtcclxuICAgICAgICAgICAgICAgZ2V0QXZhaWxhYmxlU2VhdHMoKTtcclxuICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgIGdldEF2YWlsYWJsZVNlYXRzKCk7XHJcbiAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHVwZGF0ZUxhYmVscygpIHtcclxuXHJcbiAgICAgICAgICAgIGlmICghdm0uZGl2aXNpb25BbGxvd3NXYWl0bGlzdClcclxuICAgICAgICAgICAgICAgIHNldFJlc2VydmF0aW9uTGFiZWxzKCk7XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKGlzUGFya2luZ1NlbGVjdGVkQW5kVW5BdmFpbGFibGUoKSB8fCBhdmFpbGFibGVTZWF0cyA8IDEgKyB2bS5zZWxlY3RlZENvbXBhbmlvbnMpXHJcbiAgICAgICAgICAgICAgICAgICAgc2V0V2FpdGxpc3RMYWJlbHMoKTtcclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICBzZXRSZXNlcnZhdGlvbkxhYmVscygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBpc1BhcmtpbmdTZWxlY3RlZEFuZFVuQXZhaWxhYmxlKCkge1xyXG4gICAgICAgICAgICBpZiAoIXZtLmlzQU1SZXNlcnZhdGlvbikgcmV0dXJuIGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHZtLnNlbGVjdGVkVmVoaWNsZSAhPT0gbm9WZWhpY2xlXHJcbiAgICAgICAgICAgICAgICAgICAgJiYgdm0uYXZhaWxhYmxlUGFya2luZ1Nsb3RzIDw9IDA7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRBdmFpbGFibGVTZWF0cygpIHtcclxuICAgICAgICAgICAgUmVzZXJ2YXRpb25TZXJ2aWNlLmdldEF2YWlsYWJsZVNlYXRzRm9yVHJpcChyZXNlcnZhdGlvbkluZm8udHJpcC50cmlwSWQsIERhdGUucGFyc2UocmVzZXJ2YXRpb25JbmZvLnJlc2VydmF0aW9uRGF0ZSkpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBnZXRWZWhpY2xlcygpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhdmFpbGFibGVTZWF0cyA9IHJlc3BvbnNlLmRhdGEucmVzdWx0LmF2YWlsYWJsZUNhcGFjaXR5O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5yZXN1bHQuYWxsb3dlZENvbXBhbmlvbnMgPiAwKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDw9IHJlc3BvbnNlLmRhdGEucmVzdWx0LmFsbG93ZWRDb21wYW5pb25zOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5udW1Db21wYW5pb25zLnB1c2goaSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gZXJyb3IocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBzZXRSZXNlcnZhdGlvbkxhYmVscygpIHtcclxuICAgICAgICAgICAgdm0uYnRuVGV4dCA9ICdSZXNlcnZlIFNlYXQnO1xyXG4gICAgICAgICAgICB2bS5tb2RhbFRleHQgPSAnUmVzZXJ2ZSBhIHNlYXQnO1xyXG4gICAgICAgICAgICB2bS5tb2RhbFN1Y2Nlc3NUZXh0ID0gJ1Jlc2VydmF0aW9uIENyZWF0ZWQnO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2V0V2FpdGxpc3RMYWJlbHMoKSB7XHJcbiAgICAgICAgICAgIHZtLmJ0blRleHQgPSAnQWRkIFRvIFdhaXRsaXN0JztcclxuICAgICAgICAgICAgdm0ubW9kYWxUZXh0ID0gJ0FkZCB0byB3YWl0bGlzdCc7XHJcbiAgICAgICAgICAgIHZtLm1vZGFsU3VjY2Vzc1RleHQgPSAnQWRkZWQgVG8gV2FpdGxpc3QnO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0UGFya2luZ0luZm8oKSB7XHJcblxyXG4gICAgICAgICAgICBpZiAoIXZtLmlzQU1SZXNlcnZhdGlvbikge1xyXG4gICAgICAgICAgICAgICAgdXBkYXRlTGFiZWxzKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIFN0b3BEYXRhU2VydmljZVxyXG4gICAgICAgICAgICAgICAgICAgIC5nZXRBdmFpbGFibGVQYXJraW5nc0ZvclN0b3AocmVzZXJ2YXRpb25JbmZvLnBpY2t1cFN0b3AuaWQsIHJlc2VydmF0aW9uVGltZXNwYW4oKSlcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihcclxuICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5hdmFpbGFibGVQYXJraW5nU2xvdHMgPSByZXNwb25zZS5kYXRhLnJlc3VsdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2bS5hdmFpbGFibGVQYXJraW5nU2xvdHMgPD0gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5wYXJraW5nTm90QXZhaWxhYmxlID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVMYWJlbHMoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNZXNzYWdlU2VydmljZS5zaG93SW5mb3JtYXRpb24oZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRWZWhpY2xlcygpIHtcclxuICAgICAgICAgICAgdmVoaWNsZVNlcnZpY2UuZ2V0VmVoaWNsZXNGb3JQYXNzZW5nZXIocmVzZXJ2YXRpb25JbmZvLnBhc3NlbmdlcklkKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBnZXRQYXJraW5nSW5mbygpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnN0YXR1cyA9PT0gMSAmJiByZXNwb25zZS5kYXRhLnJlc3VsdC5wYXNzZW5nZXJWZWhpY2xlcyAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0udmVoaWNsZXMgPSByZXNwb25zZS5kYXRhLnJlc3VsdC5wYXNzZW5nZXJWZWhpY2xlcztcclxuICAgICAgICAgICAgICAgICAgICB2bS52ZWhpY2xlcy5zcGxpY2UoMCwgMCwgbm9WZWhpY2xlKTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5zZWxlY3RlZFZlaGljbGUgPSBmaW5kRGVmYXVsdCh2bS52ZWhpY2xlcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uaGFzVmVoaWNsZXMgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAodm0uaXNBTVJlc2VydmF0aW9uKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5uZWVkc1BhcmtpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmICghdm0udmVoaWNsZXMgfHwgdm0udmVoaWNsZXMubGVuZ3RoID09PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNlbGVjdGVkVmVoaWNsZSA9IG5vVmVoaWNsZTtcclxuXHJcbiAgICAgICAgICAgICAgICB2bS5sb2FkaW5nVmVoaWNsZXMgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5oYXNWZWhpY2xlcyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdm0ubG9hZGluZ1ZlaGljbGVzID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG5cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGZpbmREZWZhdWx0KHZlaGljbGVzKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmVoaWNsZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIGlmICh2ZWhpY2xlc1tpXS5pc0RlZmF1bHQpIHJldHVybiB2ZWhpY2xlc1tpXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbm9WZWhpY2xlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHJlc2VydmF0aW9uVGltZXNwYW4oKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBEYXRlLnBhcnNlKHJlc2VydmF0aW9uSW5mby5yZXNlcnZhdGlvbkRhdGUpO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG5cclxuICAgICAgICBmdW5jdGlvbiByZXNlcnZlKCkge1xyXG4gICAgICAgICAgICB2bS5kaXNhYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgdmFyIHJlc2VydmF0aW9uID0ge1xyXG4gICAgICAgICAgICAgICAgJ3BpY2t1cFN0b3BJZCc6IHJlc2VydmF0aW9uSW5mby5waWNrdXBTdG9wLmlkLFxyXG4gICAgICAgICAgICAgICAgJ2Ryb3BvZmZTdG9wSWQnOiByZXNlcnZhdGlvbkluZm8uZHJvcG9mZlN0b3AuaWQsXHJcbiAgICAgICAgICAgICAgICAndHJpcElkJzogcmVzZXJ2YXRpb25JbmZvLnRyaXAudHJpcElkLFxyXG4gICAgICAgICAgICAgICAgJ3Jlc2VydmF0aW9uRGF0ZSc6IHJlc2VydmF0aW9uSW5mby5yZXNlcnZhdGlvbkRhdGUsXHJcbiAgICAgICAgICAgICAgICAncGFzc2VuZ2VySWQnOiByZXNlcnZhdGlvbkluZm8ucGFzc2VuZ2VySWQsXHJcbiAgICAgICAgICAgICAgICAnZGl2aXNpb25JZCc6IHJlc2VydmF0aW9uSW5mby5kaXZpc2lvbklkLFxyXG4gICAgICAgICAgICAgICAgJ3JvdXRlSWQnOiByZXNlcnZhdGlvbkluZm8udHJpcC5yb3V0ZUlkLFxyXG4gICAgICAgICAgICAgICAgJ3NjaGVkdWxlJzogcmVzZXJ2YXRpb25JbmZvLnNjaGVkdWxlVHlwZSxcclxuICAgICAgICAgICAgICAgICdjb21wYW5pb25zJyA6dm0uc2VsZWN0ZWRDb21wYW5pb25zXHJcblxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgaWYgKHZtLm5lZWRzUGFya2luZyAmJiAhYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5zZWxlY3RlZFZlaGljbGUuaWQpKSB7XHJcbiAgICAgICAgICAgICAgICByZXNlcnZhdGlvbi52ZWhpY2xlSWQgPSB2bS5zZWxlY3RlZFZlaGljbGUuaWQ7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIFJlc2VydmF0aW9uU2VydmljZS5hZGRSZXNlcnZhdGlvbnMocmVzZXJ2YXRpb25JbmZvLnBhc3NlbmdlcklkLCBbcmVzZXJ2YXRpb25dKS50aGVuKGhhbmRsZVJlc2VydmF0aW9uU3VjY2Vzcyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaGFuZGxlUmVzZXJ2YXRpb25TdWNjZXNzKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEuc3RhdHVzID09IDEpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5yZXN1bHQuZXJyb3JzICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0LmVycm9ycy5sZW5ndGggPiAwKVxyXG4gICAgICAgICAgICAgICAgICAgIE1lc3NhZ2VTZXJ2aWNlLnNob3dJbmZvcm1hdGlvbihyZXNwb25zZS5kYXRhLnJlc3VsdC5lcnJvcnNbMF0pO1xyXG4gICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIGdldFJlc2VydmF0aW9uKHJlc2VydmF0aW9uSW5mby5wYXNzZW5nZXJJZCwgcmVzcG9uc2UuZGF0YS5yZXN1bHQuaWRbMF0pO1xyXG4gICAgICAgICAgICB9IGVsc2VcclxuICAgICAgICAgICAgICAgIE1lc3NhZ2VTZXJ2aWNlLnNob3dJbmZvcm1hdGlvbihcIkVycm9yIHByb2Nlc3NpbmcgcmVzZXJ2YXRpb24uXCIpO1xyXG5cclxuICAgICAgICAgICAgdm0uZGlzYWJsZSA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFJlc2VydmF0aW9uKHBhc3NlbmdlcklkLCBySWQpIHtcclxuICAgICAgICAgICAgUmVzZXJ2YXRpb25TZXJ2aWNlLmdldFJlc2VydmF0aW9uQnlJZChwYXNzZW5nZXJJZCwgcklkKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIHZtLmlzUmVzZXJ2ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdm0uY29uZmlybWF0aW9uTnVtYmVyID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQuY29uZmlybWF0aW9uTnVtYmVyO1xyXG4gICAgICAgICAgICAgICAgLy9oaWRlIHBhcmtpbmcgc2VjdGlvbiBpZiBub3Qgc2VsZWN0ZWQuXHJcbiAgICAgICAgICAgICAgICBpZiAoIXZtLm5lZWRzUGFya2luZylcclxuICAgICAgICAgICAgICAgICAgICB2bS5pc1BhcmtpbmdBdHRhY2hlZFRvUmVzZXJ2YXRpb24gPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgICAgICBTdG9wRGF0YVNlcnZpY2UuZ2V0QXZhaWxhYmxlUGFya2luZ3NGb3JTdG9wKHJlc2VydmF0aW9uSW5mby5waWNrdXBTdG9wLmlkLCByZXNlcnZhdGlvblRpbWVzcGFuKCkpXHJcbiAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09PSAxICYmIHJlc3BvbnNlLmRhdGEucmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgdm0uYXZhaWxhYmxlUGFya2luZ1Nsb3RzID0gcmVzcG9uc2UuZGF0YS5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2Uoe1xyXG4gICAgICAgICAgICAgICAgJ2FjdGlvbic6ICdjbG9zZScsICdpc1Jlc2VydmVkJzogdm0uaXNSZXNlcnZlZFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5uYXZpZ2F0ZVRvUmVzZXJ2YXRpb25QYWdlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSh7XHJcbiAgICAgICAgICAgICAgICAnYWN0aW9uJzogJ3Jlc2VydmF0aW9uJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5uYXZpZ2F0ZVRvQWRkVmVoaWNsZXMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKHtcclxuICAgICAgICAgICAgICAgICdhY3Rpb24nOiAndmVoaWNsZSdcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdGhpcy5NYWtlRGlzYWJsZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKHZtLmRpc2FibGUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgaW5pdCgpO1xyXG4gICAgfVxyXG59KSgpO1xyXG5cclxuXHJcbiIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5jb250cm9sbGVyKCdTdG9wc01hcENvbnRyb2xsZXInLCBTdG9wc01hcENvbnRyb2xsZXIpO1xyXG5cclxuICAgIFN0b3BzTWFwQ29udHJvbGxlci4kaW5qZWN0ID0gWyckbG9jYXRpb24nLCAnR2VvTG9jYXRpb25TZXJ2aWNlJyxcclxuICAgICAgICAnU3RvcERhdGFTZXJ2aWNlJywgJ3VpR21hcElzUmVhZHknLCAnTG9jYXRpb25TZXJ2aWNlJywgJyRodHRwJywgJyR0aW1lb3V0JyxcclxuICAgICAgICAnc2NoZWR1bGVfc3RvcHMnLCAncm91dGVEYXRhJywgJyR1aWJNb2RhbEluc3RhbmNlJywgJyR3aW5kb3cnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBTdG9wc01hcENvbnRyb2xsZXIoJGxvY2F0aW9uLCBHZW9Mb2NhdGlvblNlcnZpY2UsXHJcbiAgICAgICAgU3RvcERhdGFTZXJ2aWNlLCB1aUdtYXBJc1JlYWR5LCBMb2NhdGlvblNlcnZpY2UsICRodHRwLCAkdGltZW91dCxcclxuICAgICAgICBzY2hlZHVsZV9zdG9wcywgcm91dGVEYXRhLCAkdWliTW9kYWxJbnN0YW5jZSwgJHdpbmRvdykge1xyXG5cclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLnRpdGxlID0gJ1NjaGVkdWxlIFN0b3BzJ1xyXG4gICAgICAgIHZtLm1hcENvbnRyb2wgPSB7fTtcclxuICAgICAgICB2bS5zdG9wTWFya2VyID0gW107XHJcbiAgICAgICAgdm0ubWFwID0ge1xyXG4gICAgICAgICAgICAvLyBodHRwOi8vYW5ndWxhci1nb29nbGUtbWFwcy5vcmcvdXNlXHJcbiAgICAgICAgICAgIGNlbnRlcjoge1xyXG4gICAgICAgICAgICAgICAgbGF0aXR1ZGU6IDQzLjc1NTE0MjIxMTkxNDA2LFxyXG4gICAgICAgICAgICAgICAgbG9uZ2l0dWRlOiAtMTE2LjU3NTk3MzUxMDc0MjE5XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHpvb206IDEwLFxyXG4gICAgICAgICAgICBsaW5lU3R5bGU6IHtcclxuICAgICAgICAgICAgICAgIGNvbG9yOiAnIzMzMycsXHJcbiAgICAgICAgICAgICAgICB3ZWlnaHQ6IDUsXHJcbiAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLjdcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdmFyIG15U3R5bGVzID0gW1xyXG4gICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgZmVhdHVyZVR5cGU6IFwicG9pXCIsXHJcbiAgICAgICAgICAgICAgIGVsZW1lbnRUeXBlOiBcImxhYmVsc1wiLFxyXG4gICAgICAgICAgICAgICBzdHlsZXJzOiBbXHJcbiAgICAgICAgICAgICAgICAgICAgIHsgdmlzaWJpbGl0eTogXCJvZmZcIiB9XHJcbiAgICAgICAgICAgICAgIF1cclxuICAgICAgICAgICB9LFxyXG4gICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgXCJmZWF0dXJlVHlwZVwiOiBcInRyYW5zaXRcIixcclxuICAgICAgICAgICAgICAgXCJlbGVtZW50VHlwZVwiOiBcImxhYmVscy5pY29uXCIsXHJcbiAgICAgICAgICAgICAgIFwic3R5bGVyc1wiOiBbXHJcbiAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgXCJ2aXNpYmlsaXR5XCI6IFwib2ZmXCJcclxuICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgXVxyXG4gICAgICAgICAgIH1cclxuICAgICAgICBdO1xyXG4gICAgICAgIHZtLm1hcE9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIG1hcFR5cGVDb250cm9sOiBmYWxzZSxcclxuICAgICAgICAgICAgem9vbUNvbnRyb2w6IGZhbHNlLFxyXG4gICAgICAgICAgICBzdHJlZXRWaWV3Q29udHJvbDogZmFsc2UsXHJcbiAgICAgICAgICAgIHN0eWxlczogbXlTdHlsZXNcclxuXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIGJ1c1N0b3BHcmVlbiwgYnVzU3RvcEdyZXksIGh1Ykljb24sIHBpY2t1cEljb247XHJcbiAgICAgICAgaWYgKCR3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKFwiVHJpZGVudFwiKSA+IDAgfHwgJHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoXCJNU0lFXCIpID4gMCkge1xyXG4gICAgICAgICAgICBidXNTdG9wR3JlZW4gPSAnaW1hZ2VzL3Bpbi1idXNzdG9wLWdyZWVuLnBuZyc7XHJcbiAgICAgICAgICAgIGJ1c1N0b3BHcmV5ID0gJ2ltYWdlcy9waW4tYnVzc3RvcC1ncmV5LnBuZyc7XHJcbiAgICAgICAgICAgIGh1Ykljb24gPSAnaW1hZ2VzL3Bpbi1odWIucG5nJztcclxuICAgICAgICAgICAgcGlja3VwSWNvbiA9ICdpbWFnZXMvcGluX3BpY2t1cC5wbmcnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgYnVzU3RvcEdyZWVuID0gJ2ltYWdlcy9waW4tYnVzc3RvcC1ncmVlbi5zdmcnO1xyXG4gICAgICAgICAgICBidXNTdG9wR3JleSA9ICdpbWFnZXMvcGluLWJ1c3N0b3AtZ3JleS5zdmcnO1xyXG4gICAgICAgICAgICBodWJJY29uID0gJ2ltYWdlcy9waW4taHViLnN2Zyc7XHJcbiAgICAgICAgICAgIHBpY2t1cEljb24gPSAnaW1hZ2VzL3Bpbl9waWNrdXAuc3ZnJztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZtLnNjaGVkdWxlU3RvcHMgPSBzY2hlZHVsZV9zdG9wcztcclxuXHJcbiAgICAgICAgaWYgKHZtLnNjaGVkdWxlU3RvcHMuSXNBTSkgey8vIFRCRCBhZGQgdGhpcyBmaWVsZFxyXG4gICAgICAgICAgICBhbmd1bGFyLmZvckVhY2godm0uc2NoZWR1bGVTdG9wcy5zdG9wcywgZnVuY3Rpb24gKHN0b3ApIHtcclxuICAgICAgICAgICAgICAgIHZtLmljb24gPSB7IHVybDogYnVzU3RvcEdyZWVuIH07XHJcbiAgICAgICAgICAgICAgICBpZiAoc3RvcC5pc0h1Yikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmljb24gPSB7IHVybDogaHViSWNvbiB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2bS5zdG9wTWFya2VyLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgICdzdG9wSWQnOiBzdG9wLnN0b3BJZCwgJ3N0b3BOYW1lJzogc3RvcC5uYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgICdsYXRpdHVkZSc6IHN0b3AubGF0aXR1ZGUsICdsb25naXR1ZGUnOiBzdG9wLmxvbmdpdHVkZSxcclxuICAgICAgICAgICAgICAgICAgICAnaWNvbic6IHZtLmljb24sXHJcbiAgICAgICAgICAgICAgICAgICAgJ2FkZHJlc3MnOiBzdG9wLmFkZHJlc3NcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh2bS5zY2hlZHVsZVN0b3BzLnN0b3BzLCBmdW5jdGlvbiAoc3RvcCkge1xyXG4gICAgICAgICAgICAgICAgdm0uaWNvbiA9IHsgdXJsOiBidXNTdG9wR3JleSB9O1xyXG4gICAgICAgICAgICAgICAgaWYgKHN0b3AuaXNIdWIpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pY29uID0geyB1cmw6IGh1Ykljb24gfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdm0uc3RvcE1hcmtlci5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICAnc3RvcElkJzogc3RvcC5zdG9wSWQsICdzdG9wTmFtZSc6IHN0b3AubmFtZSxcclxuICAgICAgICAgICAgICAgICAgICAnbGF0aXR1ZGUnOiBzdG9wLmxhdGl0dWRlLCAnbG9uZ2l0dWRlJzogc3RvcC5sb25naXR1ZGUsXHJcbiAgICAgICAgICAgICAgICAgICAgJ2ljb24nOiB2bS5pY29uLFxyXG4gICAgICAgICAgICAgICAgICAgICdhZGRyZXNzJzogc3RvcC5hZGRyZXNzXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2bS5pY29uID0gJ2ltYWdlcy9waW5fcGlja3VwLnN2Zyc7XHJcbiAgICAgICAgdm0uaWNvbiA9IHsgdXJsOiBwaWNrdXBJY29uIH07XHJcbiAgICAgICAgdWlHbWFwSXNSZWFkeS5wcm9taXNlKCkudGhlbihmdW5jdGlvbiAobWFwcykge1xyXG5cclxuICAgICAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQudHJpZ2dlcih2bS5tYXBDb250cm9sLmdldEdNYXAoKSwgXCJyZXNpemVcIik7XHJcblxyXG4gICAgICAgICAgICBpZiAocm91dGVEYXRhICE9IG51bGwgJiYgcm91dGVEYXRhLmxlbmd0aCA+IDApIHtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgZGVjb2RlZFBhdGggPSBnb29nbGUubWFwcy5nZW9tZXRyeS5lbmNvZGluZy5kZWNvZGVQYXRoKHJvdXRlRGF0YVswXS5saW5lKTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgbGluZSA9IG5ldyBnb29nbGUubWFwcy5Qb2x5bGluZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgcGF0aDogZGVjb2RlZFBhdGgsXHJcbiAgICAgICAgICAgICAgICAgICAgc3Ryb2tlT3BhY2l0eTogMC41LFxyXG4gICAgICAgICAgICAgICAgICAgIHN0cm9rZVdlaWdodDogNSxcclxuICAgICAgICAgICAgICAgICAgICBpY29uczogW3tcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWNvbjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogZ29vZ2xlLm1hcHMuU3ltYm9sUGF0aC5GT1JXQVJEX09QRU5fQVJST1csXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJva2VPcGFjaXR5OiAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsbE9wYWNpdHk6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2FsZTogMi41XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9mZnNldDogJzI1cHgnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQ6ICcyMDBweCcsXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIH1dLFxyXG4gICAgICAgICAgICAgICAgICAgIHpJbmRleDogMVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgbGluZVN0cm9rZSA9IG5ldyBnb29nbGUubWFwcy5Qb2x5bGluZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgcGF0aDogZGVjb2RlZFBhdGgsXHJcbiAgICAgICAgICAgICAgICAgICAgc3Ryb2tlQ29sb3I6ICcjZmZmJyxcclxuICAgICAgICAgICAgICAgICAgICBzdHJva2VPcGFjaXR5OiAxLjAsXHJcbiAgICAgICAgICAgICAgICAgICAgc3Ryb2tlV2VpZ2h0OiA4LFxyXG4gICAgICAgICAgICAgICAgICAgIHppbmRleDogMFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBsaW5lLnNldE1hcCh2bS5tYXBDb250cm9sLmdldEdNYXAoKSk7XHJcbiAgICAgICAgICAgICAgICBsaW5lU3Ryb2tlLnNldE1hcCh2bS5tYXBDb250cm9sLmdldEdNYXAoKSk7XHJcblxyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgYm91bmRzID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZ0JvdW5kcygpO1xyXG5cclxuICAgICAgICAgICAgaWYgKGRlY29kZWRQYXRoICYmIGRlY29kZWRQYXRoLmxlbmd0aCA+IDApXHJcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2goZGVjb2RlZFBhdGgsIGZ1bmN0aW9uIChsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYm91bmRzLmV4dGVuZChuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKGwubGF0KCksIGwubG5nKCkpKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh2bS5zdG9wTWFya2VyLCBmdW5jdGlvbiAobSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGJvdW5kcy5leHRlbmQobmV3IGdvb2dsZS5tYXBzLkxhdExuZyhtLmxhdGl0dWRlLCBtLmxvbmdpdHVkZSkpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZtLm1hcENvbnRyb2wuZ2V0R01hcCgpLmZpdEJvdW5kcyhib3VuZHMpO1xyXG5cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdm0ucG9seWxpbmVzID0gW3tcclxuICAgICAgICAgICAgaWQ6IDEsXHJcbiAgICAgICAgICAgIHBhdGg6IHZtLnBhdGgsXHJcbiAgICAgICAgICAgIHN0cm9rZToge1xyXG4gICAgICAgICAgICAgICAgY29sb3I6ICcjNjA2MEZCJyxcclxuICAgICAgICAgICAgICAgIHdlaWdodDogNVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBlZGl0YWJsZTogZmFsc2UsXHJcbiAgICAgICAgICAgIGRyYWdnYWJsZTogZmFsc2UsXHJcbiAgICAgICAgICAgIGdlb2Rlc2ljOiB0cnVlLFxyXG4gICAgICAgICAgICB2aXNpYmxlOiB0cnVlLFxyXG4gICAgICAgIH1dO1xyXG5cclxuICAgICAgICAvL21hcmtlciBjbGljayBmdW5jdGlvblxyXG4gICAgICAgIHZtLm1hcmtlckV2ZW50ID0ge1xyXG4gICAgICAgICAgICBjbGljazogZnVuY3Rpb24gKGdNYXJrZXIsIGV2ZW50TmFtZSwgbW9kZWwpIHtcclxuICAgICAgICAgICAgICAgIGlmIChtb2RlbC4kaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAvL25hdmlnYXRlVG9TZWxlY3RlZFN0b3AobW9kZWwuY29vcmRzKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodm0uc2VsZWN0ZWRMb2NhdGlvbilcclxuICAgICAgICAgICAgICAgICAgICAgICAgU3RvcERhdGFTZXJ2aWNlLnNldEdlb0xvY2F0aW9uKHZtLnNlbGVjdGVkTG9jYXRpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgIFN0b3BEYXRhU2VydmljZS5zZXRTdG9wKG1vZGVsLmNvb3Jkcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uY29vcmRzID0gbW9kZWwuY29vcmRzO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNob3cgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uY2FuY2VsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdjYW5jZWwnKTtcclxuICAgICAgICAgICAgdm0uaXNEb25lID0gdHJ1ZTtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAgICAgLmRpcmVjdGl2ZSgnYmFja0NvbnRyb2wnLCBiYWNrQ29udHJvbCk7XHJcblxyXG4gICAgYmFja0NvbnRyb2wuJGluamVjdCA9IFsnJHdpbmRvdyddO1xyXG5cclxuICAgIGZ1bmN0aW9uIGJhY2tDb250cm9sKCR3aW5kb3cpIHtcclxuXHJcbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogY29udHJvbGxlcixcclxuICAgICAgICAgICAgcmVwbGFjZTp0cnVlLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZTogJzxidXR0b24gY2xhc3M9XCJnby1iYWNrXCIgbmctY2xpY2s9XCJnb0JhY2soKVwiPkJhY2s8L2J1dHRvbj4nXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBjb250cm9sbGVyKCRzY29wZSwkd2luZG93KSB7XHJcbiAgICAgICAgICAgICRzY29wZS5nb0JhY2sgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAkd2luZG93Lmhpc3RvcnkuYmFjaygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuZmlsdGVyKCdyb3V0ZVN0b3BzTmFtZScsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChyb3V0ZUxvbmdOYW1lKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocm91dGVMb25nTmFtZSAmJiByb3V0ZUxvbmdOYW1lLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3RhcnRJbmRleCA9IHJvdXRlTG9uZ05hbWUuaW5kZXhPZihcIi1cIikgKyAxO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBlbmRJbmRleCA9IHJvdXRlTG9uZ05hbWUubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByb3V0ZUxvbmdOYW1lLnN1YnN0cmluZyhzdGFydEluZGV4LCBlbmRJbmRleCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnb25lTVZBcHAnKVxyXG4gICAgICAgIC5maWx0ZXIoJ3JvdXRlU2hvcnROYW1lJywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHJvdXRlTG9uZ05hbWUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyb3V0ZUxvbmdOYW1lICYmIHJvdXRlTG9uZ05hbWUubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdGFydEluZGV4ID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZW5kSW5kZXggPSByb3V0ZUxvbmdOYW1lLmluZGV4T2YoXCItXCIpIC0gMTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcm91dGVMb25nTmFtZS5zdWJzdHJpbmcoc3RhcnRJbmRleCwgZW5kSW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuZGlyZWN0aXZlKCdyb3V0ZUNhcmQnLCByb3V0ZUNhcmQpO1xyXG5cclxuICAgIHJvdXRlQ2FyZC4kaW5qZWN0ID0gWyckd2luZG93J107XHJcbiAgICBcclxuICAgIGZ1bmN0aW9uIHJvdXRlQ2FyZCgkd2luZG93KSB7XHJcbiAgICAgICAgLy8gVXNhZ2U6XHJcbiAgICAgICAgLy8gICAgIDxyb3V0ZS1jYXJkPjwvcm91dGUtY2FyZD5cclxuICAgICAgICAvLyBDcmVhdGVzOlxyXG4gICAgICAgIC8vIFxyXG4gICAgICAgIHZhciBkaXJlY3RpdmUgPSB7XHJcbiAgICAgICAgICAgIGxpbms6IGxpbmssXHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRUEnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiBjb250cm9sbGVyLFxyXG4gICAgICAgICAgICBzY29wZTogeyByb3V0ZUluZm86ICc9Jywgb25TZWxlY3Q6ICcmJywgcGlubmFibGU6ICc9J30sXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL21vZHVsZXMvZml4ZWQtcm91dGUvZGlyZWN0aXZlcy9yb3V0ZS1jYXJkL3JvdXRlLWNhcmQuaHRtbCdcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBkaXJlY3RpdmU7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaChcInJvdXRlSW5mb1wiLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAvL1RoaXMgZ2V0cyBjYWxsZWQgd2hlbiBkYXRhIGNoYW5nZXMuXHJcbiAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgIT09IG9sZFZhbHVlICYmIG5ld1ZhbHVlICE9ICcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBuZXdWYWx1ZSA9PSBcInN0cmluZ1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5yb3V0ZUluZm8gPSBKU09OLnBhcnNlKG5ld1ZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgbmV3VmFsdWUgPT0gXCJvYmplY3RcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUucm91dGVJbmZvID0gbmV3VmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuYWN0aXZhdGUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNvbnRyb2xsZXIoJHNjb3BlLCAkbG9jYXRpb24pIHtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgXHJcbiAgICAgICAgICAgICRzY29wZS5hY3RpdmF0ZVRyaXAgPSBhY3RpdmF0ZVRyaXA7XHJcbiAgICAgICAgICAgICRzY29wZS5hY3RpdmF0ZVJvdXRlID0gYWN0aXZhdGVSb3V0ZTtcclxuICAgICAgICAgICAgJHNjb3BlLmdvdG9Sb3V0ZVdpdGhTdG9wcyA9IGdvdG9Sb3V0ZVdpdGhTdG9wcztcclxuICAgICAgICAgICAgJHNjb3BlLmFjdGl2YXRlID0gYWN0aXZhdGU7XHJcbiAgICAgICAgICAgIC8vJHNjb3BlLmlzUm91dGVTZWxlY3RlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAkc2NvcGUuYWN0aXZlVHJpcCA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICBhY3RpdmF0ZSgpO1xyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaXNBbnlUcmlwQWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8ICRzY29wZS5yb3V0ZUluZm8udHJpcHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnJvdXRlSW5mby50cmlwc1tpXS5pc0FjdGl2ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYWN0aXZlVHJpcCA9ICRzY29wZS5yb3V0ZUluZm8udHJpcHNbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzQW55VHJpcEFjdGl2ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgaWYgKCFpc0FueVRyaXBBY3RpdmUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLnJvdXRlSW5mbyAmJiAkc2NvcGUucm91dGVJbmZvLnRyaXBzICYmICEkc2NvcGUuYWN0aXZlVHJpcCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuYWN0aXZlVHJpcCA9ICRzY29wZS5yb3V0ZUluZm8udHJpcHNbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5yb3V0ZUluZm8udHJpcHNbMF0uaXNBY3RpdmUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlVHJpcCh0cmlwKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuYWN0aXZlVHJpcCA9IHRyaXA7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8ICRzY29wZS5yb3V0ZUluZm8udHJpcHMubGVuZ3RoOyBpKyspIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS5yb3V0ZUluZm8udHJpcHNbaV0gPT09IHRyaXApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJvdXRlSW5mby50cmlwc1tpXS5pc0FjdGl2ZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJvdXRlSW5mby50cmlwc1tpXS5pc0FjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlUm91dGUoKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUucm91dGVJbmZvLmlzU2VsZWN0ZWQgPSAhJHNjb3BlLnJvdXRlSW5mby5pc1NlbGVjdGVkXHJcbiAgICAgICAgICAgICAgICAvL1NlbmQgYmFjayB0aGUgc2VsZWN0ZWQgcm91dGUgdG8gcGFyZW50IGNvbnRyb2xsZXJcclxuICAgICAgICAgICAgICAgIGlmICgkc2NvcGUub25TZWxlY3QgJiYgdHlwZW9mICRzY29wZS5vblNlbGVjdCA9PT0gXCJmdW5jdGlvblwiKVxyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5vblNlbGVjdCh7IHNjaGVkdWxlOiAkc2NvcGUucm91dGVJbmZvIH0pO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgZnVuY3Rpb24gZ290b1JvdXRlV2l0aFN0b3BzKCkge1xyXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCJmaXhlZC1yb3V0ZS9yb3V0ZXMvXCIgKyAkc2NvcGUucm91dGVJbmZvLnJvdXRlLmlkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JzsgIFxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuZGlyZWN0aXZlKCdzdG9wQXJyaXZhbEluZm8nLCBzdG9wQXJyaXZhbEluZm8pO1xyXG5cclxuICAgIHN0b3BBcnJpdmFsSW5mby4kaW5qZWN0ID0gW107XHJcblxyXG4gICAgZnVuY3Rpb24gc3RvcEFycml2YWxJbmZvKCkge1xyXG5cclxuICAgICAgICB2YXIgZGlyZWN0aXZlID0ge1xyXG4gICAgICAgICAgICBsaW5rOiBsaW5rLFxyXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiBjb250cm9sbGVyLCAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBzY29wZTogeyByb3V0ZUFycml2YWw6ICc9Jywgc2VsZWN0ZWRTdG9wSWQ6Jz0nIH0sXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL21vZHVsZXMvZml4ZWQtcm91dGUvZGlyZWN0aXZlcy9zdG9wLWFycml2YWwtaW5mby9zdG9wLWFycml2YWwtaW5mby5odG1sJ1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBjb250cm9sbGVyKCRzY29wZSkge1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkQXJyaXZhbEluZGV4ID0gMDtcclxuXHJcbiAgICAgICAgICAgICRzY29wZS5zaG93QXJyaXZhbHMgPSBmdW5jdGlvbiAoaW5kZXgpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZEFycml2YWxJbmRleCA9IGluZGV4O1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2YXIgeCA9ICRzY29wZS5zZWxlY3RlZFN0b3BJZDtcclxuXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAuY29udHJvbGxlcignUmF0aW5nTW9kYWxDb250cm9sbGVyJywgUmF0aW5nTW9kYWxDb250cm9sbGVyKTtcclxuXHJcbiAgICBSYXRpbmdNb2RhbENvbnRyb2xsZXIuJGluamVjdCA9IFsnJHNjb3BlJywgJyRodHRwJywgJ1V0aWxpdHlGYWN0b3J5JyxcclxuICAgICAgICAnQ29uZmlnRmFjdG9yeScsICckdWliTW9kYWxJbnN0YW5jZScsICd0cmlwJywgJ3NlbGVjdGVkUmF0aW5nJywgJ0ZlZWRiYWNrU2VydmljZScsICdhdXRoU2VydmljZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIFJhdGluZ01vZGFsQ29udHJvbGxlcigkc2NvcGUsICRodHRwLCBVdGlsaXR5RmFjdG9yeSwgQ29uZmlnRmFjdG9yeSxcclxuICAgICAgICAkdWliTW9kYWxJbnN0YW5jZSwgdHJpcCwgc2VsZWN0ZWRSYXRpbmcsIEZlZWRiYWNrU2VydmljZSwgYXV0aFNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLnRyaXAgPSB0cmlwO1xyXG5cclxuICAgICAgICB2bS5jYW5jZWwgPSBjYW5jZWw7XHJcbiAgICAgICAgdm0uc2F2ZUZlZWRiYWNrID0gc2F2ZUZlZWRiYWNrO1xyXG5cclxuICAgICAgICB2bS5mZWVkYmFjayA9IHtcclxuICAgICAgICAgICAgcmF0aW5nOiBzZWxlY3RlZFJhdGluZyxcclxuICAgICAgICAgICAgY29tbWVudDogJydcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5kaXNhYmxlU3VibWl0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgaWYgKHZtLmZlZWRiYWNrLnJhdGluZyA+IDApIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNhbmNlbCgpIHtcclxuICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBzYXZlRmVlZGJhY2soKSB7XHJcbiAgICAgICAgICAgIHZhciBmZWVkYmFja1JlcXVlc3QgPSB7XHJcbiAgICAgICAgICAgICAgICBQYXNzZW5nZXJSYXRpbmc6IHZtLmZlZWRiYWNrLnJhdGluZyxcclxuICAgICAgICAgICAgICAgIENvbW1lbnQ6IHZtLmZlZWRiYWNrLmNvbW1lbnQsXHJcbiAgICAgICAgICAgICAgICBUcmlwSWQ6IHZtLnRyaXAuVHJpcElkLFxyXG4gICAgICAgICAgICAgICAgQ3JlYXRlZEJ5OiBhdXRoU2VydmljZS5hdXRoZW50aWNhdGlvbi5wYXNzZW5nZXJJZFxyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgRmVlZGJhY2tTZXJ2aWNlLlNhdmVGZWVkYmFjayhmZWVkYmFja1JlcXVlc3QpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmlzU2F2aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgVXRpbGl0eUZhY3RvcnkudG9hc3RTdWNjZXNzKFwiU3VjY2VzcyFcIiwgXCJGZWVkYmFjayBzYXZlZCBzdWNjZXNzZnVsbHlcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoZmVlZGJhY2tSZXF1ZXN0KTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uaXNTYXZpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKFwiRXJyb3IhXCIsIFwiQ291bGQgbm90IHNhdmUgZmVlZGJhY2tcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgJGxvZy5lcnJvcignRXJyb3I6IC0gJyArIHJlc3BvbnNlLmRhdGEubWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2socmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIHZtLmlzU2F2aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBVdGlsaXR5RmFjdG9yeS50b2FzdEVycm9yKFwiRXJyb3IhXCIsIFwiQ291bGQgbm90IHNhdmUgZmVlZGJhY2tcIik7XHJcbiAgICAgICAgICAgICAgICAkbG9nLmVycm9yKCdFcnJvcjogLSAnICsgcmVzcG9uc2UuZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG4gICAgYW5ndWxhci5tb2R1bGUoXCJvbmVNVkFwcFwiKS5kaXJlY3RpdmUoJ3N0YXJSYXRpbmdEaXJlY3RpdmUnLCBzdGFyUmF0aW5nRGlyZWN0aXZlKTtcclxuXHJcbiAgICBmdW5jdGlvbiBzdGFyUmF0aW5nRGlyZWN0aXZlKCkge1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICAgICAgdHJpcEluZm86ICc9JyxcclxuICAgICAgICAgICAgICAgIG9wdGlvbnM6ICdAJyxcclxuICAgICAgICAgICAgICAgIGFsbG93VHJpcFJhdGluZzogJ0AnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL21vZHVsZXMvb24tZGVtYW5kL3Jlc2VydmF0aW9ucy9yYXRpbmctY29tcG9uZW50L3N0YXJSYXRpbmcuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXIgOiBjb250cm9sbGVyRnVuY3Rpb25cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBjb250cm9sbGVyRnVuY3Rpb24oJHNjb3BlLCAkdWliTW9kYWwpIHtcclxuICAgICAgICAgICAgJHNjb3BlLmpzVHJpcEluZm8gPSAkc2NvcGUudHJpcEluZm87IC8vSlNPTi5wYXJzZSgkc2NvcGUudHJpcEluZm8pO1xyXG4gICAgICAgICAgICAkc2NvcGUuanNPcHRpb25zID0gSlNPTi5wYXJzZSgkc2NvcGUub3B0aW9ucyk7XHJcbiAgICAgICAgICAgICRzY29wZS5yYXRpbmcgPSAkc2NvcGUuanNUcmlwSW5mby5yYXRpbmc7XHJcbiAgICAgICAgICAgICRzY29wZS5yYXRpbmdDb21tZW50ID0gJHNjb3BlLmpzVHJpcEluZm8ucmF0aW5nQ29tbWVudDtcclxuICAgICAgICAgICAgJHNjb3BlLm12UmVhZE9ubHkgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgICAgIHZhciBzZXRSYXRpbmcgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAvL2xldCB0b2RheSA9IG5ldyBEYXRlKCRzY29wZS5zZXJ2aWNlRGF0ZSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2VydmljZURhdGUgPSBuZXcgRGF0ZSgkc2NvcGUuanNUcmlwSW5mby5zZXJ2aWNlRGF0ZSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgYXJyUmVzdHJpY3RlZFZhbHVlcyA9IFtcIk5vLXNob3dcIiwgXCJDYW5jZWxcIl07XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCRzY29wZS5hbGxvd1RyaXBSYXRpbmcgPT0gZmFsc2UgJiYgJHNjb3BlLmpzVHJpcEluZm8ucmF0aW5nIDw9IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUubXZSZWFkT25seSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFyclJlc3RyaWN0ZWRWYWx1ZXMuaW5kZXhPZigkc2NvcGUuanNUcmlwSW5mby5TdGF0dXMpID49IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm12UmVhZE9ubHkgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmpzVHJpcEluZm8ucmF0aW5nID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm12UmVhZE9ubHkgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuXHJcblxyXG5cclxuXHJcbiAgICAgICAgICAgICRzY29wZS5zaG93UmF0aW5nTW9kYWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLm12UmVhZE9ubHkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvbW9kdWxlcy9vbi1kZW1hbmQvcmVzZXJ2YXRpb25zL3JhdGluZy1jb21wb25lbnQvcmF0aW5nTW9kYWwuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1JhdGluZ01vZGFsQ29udHJvbGxlciBhcyB2bScsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0cmlwOiAkc2NvcGUuanNUcmlwSW5mbyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRSYXRpbmc6ICRzY29wZS5yYXRpbmdcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFhbmd1bGFyLmlzVW5kZWZpbmVkKGl0ZW0pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5yYXRpbmcgPSBpdGVtLlBhc3NlbmdlclJhdGluZztcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJhdGluZ0NvbW1lbnQgPSBpdGVtLkNvbW1lbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5qc1RyaXBJbmZvLnJhdGluZ0NvbW1lbnQgPSBpdGVtLkNvbW1lbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5qc1RyaXBJbmZvLnJhdGluZyA9IGl0ZW0uUGFzc2VuZ2VyUmF0aW5nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUubXZSZWFkT25seSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucmF0aW5nID0gMDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGRpc21pc3NcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBzZXRSYXRpbmcoKTtcclxuXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ29uZU1WQXBwJylcclxuICAgICAgICAuY29udHJvbGxlcignTWVudUNvbnRyb2xsZXInLCBNZW51Q29udHJvbGxlcik7XHJcblxyXG4gICAgTWVudUNvbnRyb2xsZXIuJGluamVjdCA9IFsnJHNjb3BlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gTWVudUNvbnRyb2xsZXIoJHNjb3BlKSB7XHJcbiAgICAgICAgLy92YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgICRzY29wZS5vbkhhbW1lciA9IGZ1bmN0aW9uIG9uSGFtbWVyIChldmVudCkge1xyXG4gICAgICAgICAgICAkc2NvcGUuZXZlbnRUeXBlID0gZXZlbnQudHlwZTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coZXZlbnQudHlwZSk7XHJcbiAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAkc2NvcGUuY2Fyb3VzZWxPcHRpb25zID0ge1xyXG4gICAgICAgICAgICBuYXZUZXh0OiBbXCJcIiwgXCJcIl0sXHJcbiAgICAgICAgICAgIHJlc3BvbnNpdmVDbGFzczogZmFsc2UsXHJcbiAgICAgICAgICAgIG5hdjogdHJ1ZSxcclxuICAgICAgICAgICAgb25EcmFnOm5vc2Nyb2xsLFxyXG4gICAgICAgICAgICBvbkRyYWdnZWQ6Z29zY3JvbGwsIFxyXG5cclxuICAgICAgICAgICAgcmVzcG9uc2l2ZToge1xyXG4gICAgICAgICAgICAgICAgMDoge1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgIHN0YWdlUGFkZGluZzogMzQsXHJcbiAgICAgICAgICAgICAgICAgICAgc3RhcnRQb3NpdGlvbjogMSxcclxuICAgICAgICAgICAgICAgICAgICBjZW50ZXI6IHRydWUsXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgMzc1OntcclxuICAgICAgICAgICAgICAgICAgICBpdGVtczogMSxcclxuICAgICAgICAgICAgICAgICAgICBzdGFnZVBhZGRpbmc6IDM0LFxyXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0UG9zaXRpb246IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgY2VudGVyOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIDc2ODoge1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zOiAyLFxyXG4gICAgICAgICAgICAgICAgICAgIHN0YWdlUGFkZGluZzogMTYsXHJcbiAgICAgICAgICAgICAgICAgICAgc3RhcnRQb3NpdGlvbjogMSxcclxuICAgICAgICAgICAgICAgICAgICBjZW50ZXI6IHRydWUsXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgOTkyOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbXM6IDMsXHJcbiAgICAgICAgICAgICAgICAgICAgc3RhZ2VQYWRkaW5nOiAwLFxyXG4gICAgICAgICAgICAgICAgICAgIGNlbnRlcjogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgbWVyZ2VGaXQ6dHJ1ZVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIG5vc2Nyb2xsKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudCgnaHRtbCcpLmFkZENsYXNzKCduby1zY3JvbGwnKTtcclxuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZ1bmN0aW9uIGdvc2Nyb2xsKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudCgnaHRtbCcpLnJlbW92ZUNsYXNzKCduby1zY3JvbGwnKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7XHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdvbmVNVkFwcCcpXHJcbiAgICAuZGlyZWN0aXZlKCdvd2xDYXJvdXNlbCcsIE1WT3dsQ2Fyb3VzZWwpO1xyXG5cclxuICAgIE1WT3dsQ2Fyb3VzZWwuJGluamVjdCA9IFtdO1xyXG5cclxuICAgIGZ1bmN0aW9uIE1WT3dsQ2Fyb3VzZWwoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICAgICAgdHJhbnNjbHVkZTogZmFsc2UsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSkge1xyXG4gICAgICAgICAgICAgICAgc2NvcGUuaW5pdENhcm91c2VsID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBwcm92aWRlIGFueSBkZWZhdWx0IG9wdGlvbnMgeW91IHdhbnRcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZGVmYXVsdE9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY3VzdG9tT3B0aW9ucyA9IHNjb3BlLiRldmFsKCQoZWxlbWVudCkuYXR0cignZGF0YS1vcHRpb25zJykpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbWJpbmUgdGhlIHR3byBvcHRpb25zIG9iamVjdHNcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gY3VzdG9tT3B0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0T3B0aW9uc1trZXldID0gY3VzdG9tT3B0aW9uc1trZXldO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAvLyBpbml0IGNhcm91c2VsXHJcbiAgICAgICAgICAgICAgICAgICAgJChlbGVtZW50KS5vd2xDYXJvdXNlbChkZWZhdWx0T3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxufSkoKTtcclxuXHJcbiJdfQ==
